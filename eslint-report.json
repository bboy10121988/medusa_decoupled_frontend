[{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/__tests__/coverage.test.js","messages":[{"ruleId":null,"nodeType":null,"fatal":true,"severity":2,"message":"Parsing error: \"parserOptions.project\" has been provided for @typescript-eslint/parser.\nThe file was not found in any of the provided project(s): src/__tests__/coverage.test.js"}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":1,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// 這是一個基本的覆蓋率測試，用於檢測未測試的代碼\ndescribe('Code Coverage Analysis', () => {\n  it('should import key modules to check coverage', () => {\n    // 導入關鍵模組來檢查覆蓋率\n    expect(true).toBe(true)\n  })\n})","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(checkout)/checkout/components/address-select/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(checkout)/checkout/components/addresses/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(checkout)/checkout/components/billing_address/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(checkout)/checkout/components/country-select/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(checkout)/checkout/components/discount-code/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(checkout)/checkout/components/error-message/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(checkout)/checkout/components/payment-button/banktransferpaymentbutton.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'cart' is defined but never used.","line":15,"column":38,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":42},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'cart' is defined but never used. Allowed unused args must match /^_/u.","line":15,"column":38,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":42},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":24,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":24,"endColumn":18,"suggestions":[{"fix":{"range":[674,708],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":27,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[792,795],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[792,795],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":28,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":28,"endColumn":20,"suggestions":[{"fix":{"range":[805,838],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { useState } from \"react\"\nimport { Button } from \"@medusajs/ui\"\nimport ErrorMessage from \"../error-message\"\nimport { HttpTypes } from \"@medusajs/types\"\nimport { placeOrder } from \"@lib/data/cart\"\n\ntype Props = {\n  cart: HttpTypes.StoreCart\n  notReady: boolean\n  \"data-testid\"?: string\n}\n\nconst BankTransferPaymentButton = ({ cart, notReady, \"data-testid\": dataTestId }: Props) => {\n  const [submitting, setSubmitting] = useState(false)\n  const [errorMessage, setErrorMessage] = useState<string | null>(null)\n\n  const handlePayment = async () => {\n    setSubmitting(true)\n    setErrorMessage(null)\n    try {\n      const result = await placeOrder()\n      console.log(\"銀行轉帳訂單建立成功:\", result)\n      // placeOrder 成功會自動跳轉到 order confirmed 頁面\n      // 不需要手動跳轉\n    } catch (err: any) {\n      console.error(\"銀行轉帳訂單建立失敗:\", err)\n      // 嘗試顯示更詳細的錯誤內容\n      if (err?.response) {\n        // 若有 response 物件（如 axios），顯示 response.data\n        setErrorMessage(JSON.stringify(err.response.data));\n      } else if (err?.message) {\n        setErrorMessage(err.message);\n      } else {\n        setErrorMessage(\"建立訂單失敗\");\n      }\n    } finally {\n      setSubmitting(false)\n    }\n  }\n\n  return (\n    <>\n      <Button\n        disabled={notReady}\n        onClick={handlePayment}\n        size=\"large\"\n        isLoading={submitting}\n        data-testid={dataTestId}\n      >\n        {submitting ? \"處理中...\" : \"確認訂單\"}\n      </Button>\n      <ErrorMessage\n        error={errorMessage}\n        data-testid=\"bank-transfer-payment-error-message\"\n      />\n    </>\n  )\n}\n\nexport default BankTransferPaymentButton\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(checkout)/checkout/components/payment-button/ecpaypaymentbutton.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'sub' is defined but never used.","line":41,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":41,"endColumn":13},{"ruleId":"unused-imports/no-unused-imports","severity":2,"message":"'sub' is defined but never used.","line":41,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":41,"endColumn":13,"fix":{"range":[346,378],"text":"\n"}},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":65,"column":3,"nodeType":"MemberExpression","messageId":"unexpected","endLine":65,"endColumn":14,"suggestions":[{"fix":{"range":[900,957],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":76,"column":92,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":76,"endColumn":94,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1327,1329],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":79,"column":61,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":79,"endColumn":63,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1418,1420],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":82,"column":62,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":82,"endColumn":64,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1593,1595],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":85,"column":64,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":85,"endColumn":66,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1673,1675],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":88,"column":58,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":88,"endColumn":60,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1751,1753],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":91,"column":56,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":91,"endColumn":58,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1826,1828],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"prefer-const","severity":2,"message":"'data' is never reassigned. Use 'const' instead.","line":118,"column":7,"nodeType":"Identifier","messageId":"useConst","endLine":118,"endColumn":24,"fix":{"range":[2369,2411],"text":"const data: PaymentData = new PaymentData();"}},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":162,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":162,"endColumn":16,"suggestions":[{"fix":{"range":[3253,3294],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":9,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":2,"fixableWarningCount":0,"source":"/**\n * \n * Note !!! 已棄用\n * \n * \n * \n * \n * \n * \n * \n * \n * \n * \n * \n * \n * \n * \n * \n * \n * \n * \n * \n * \n * \n * \n * \n * \n * \n * \n * \n * \n * \n */\n\n\"use client\"\n// 目前這份檔案沒有用到\nimport React, { useState } from \"react\"\nimport { Button } from \"@medusajs/ui\"\nimport { HttpTypes } from \"@medusajs/types\"\nimport { PaymentData } from \"@/internal/ecpayments\"\nimport { sub } from \"date-fns\"\n\ntype Props = {\n  cart: HttpTypes.StoreCart\n  notReady: boolean\n  \"data-testid\"?: string\n}\n\nconst ECPayPaymentButton: React.FC<Props> = ({ cart, notReady, \"data-testid\": dataTestId }) => {\n\n  const action:string = \"ECPayPaymentButton\"\n\n  let defaultError:string | null = null\n\n  const paymentSessions = cart.payment_collection?.payment_sessions\n\n  let paymentSessionID = \"\"\n\n  if (!paymentSessions || paymentSessions.length === 0){\n    defaultError = \"尚未建立支付會話\"\n  }else{\n    paymentSessionID = paymentSessions[0].id\n  }\n\n  console.log(action,\"payment session id\",paymentSessionID)\n\n  const [submitting] = useState(false)\n  let errorMessage: string|null = defaultError\n  // const [errorMessage, setErrorMessage] = useState<string | null>(defaultError)\n\n\n  // 計算總金額（轉換為整數，ECPay 不接受小數）\n  const totalAmount = Math.round(cart.total || 0)\n\n  // 商品名稱（取購物車商品名稱，限制長度）\n  const itemName = cart.items?.map(item => item.product_title).join(',').substring(0, 200) || '購物車商品'\n\n  // ecpay API URL\n  const ecpayAPI = process.env.NEXT_PUBLIC_ECPAY_ACTION_URL || \"https://payment-stage.ecpay.com.tw/Cashier/AioCheckOut/V5\"\n\n  // ecpay在完成付款後callback的網址，這裡要指向medusa ecpay 轉換器\n  const returnURL = process.env.NEXT_PUBLIC_ECPAY_RETURN_URL || \"\"\n\n  // 特店代號\n  const merchantID = process.env.NEXT_PUBLIC_ECPAY_MERCHANT_ID || \"\"\n\n  // hash key\n  const hashKey = process.env.NEXT_PUBLIC_ECPAY_HASH_KEY || \"\"\n\n  // hash iv\n  const hashIV = process.env.NEXT_PUBLIC_ECPAY_HASH_IV || \"\"\n\n  if (returnURL === \"\"){\n    errorMessage = \"missing ECPay return URL\"\n    // setErrorMessage(\"missing ECPay return URL\")\n  }\n\n  if (merchantID === \"\"){\n    errorMessage = \"missing ECPay merchant ID\"\n  }\n\n  if (hashKey === \"\"){\n    errorMessage = \"missing ECPay hash key\"\n  }\n\n  if (hashIV === \"\"){\n    errorMessage = \"missing ECPay hash iv\"\n  }\n\n\n\n\n  // \"使用者\"付款完成後返回的網址\n  const clientBackURL = `${window.location.origin}/order/confirmed`\n\n  const tradeNo = Array.from({ length: 20 }, () => Math.floor(Math.random() * 10)).join(\"\");\n\n  let data: PaymentData = new PaymentData();\n\n  data.setHashKey(hashKey)\n\n  data.setHashIV(hashIV)\n\n  data.setMerchantID(merchantID);\n\n  data.setMerchantTradeNo(tradeNo.toString())\n\n  data.setMerchantTradeDate(new Date().toLocaleDateString('zh-TW', { \n    year: 'numeric', \n    month: '2-digit', \n    day: '2-digit', \n    hour: '2-digit', \n    minute: '2-digit', \n    second: '2-digit',\n    hour12: false,\n    timeZone: 'Asia/Taipei'\n  }).replace(/\\//g, '/').replace(',', ''))\n\n  data.setPaymentType(\"aio\")\n\n  data.setTotalAmount(totalAmount)\n\n  data.setTradeDesc(\"商品購買\")\n\n  data.setItemName(itemName)\n\n  data.setReturnURL(returnURL)\n\n  data.setClientBackURL(clientBackURL)\n\n  data.setChoosePayment(\"ALL\")\n  \n  data.setEncryptType(\"1\")\n\n  data.setCustomField3(\"cart_id\")\n\n  data.setCustomField4(cart.id)\n\n  const params:URLSearchParams = data.getDataParams();\n\n  if (errorMessage){\n    console.log(action,\"error:\",errorMessage)\n  }\n\n  const submitHandler = () => {\n\n    if (errorMessage){  \n      return\n    }\n\n    // 建立隱藏表單\n    const form = document.createElement('form')\n    form.method = 'POST'\n    form.action = ecpayAPI\n    form.target = '_blank' // 開啟新視窗\n    form.encType = 'application/x-www-form-urlencoded'\n\n    // 添加所有參數作為隱藏輸入欄位\n    params.forEach((value, key) => {\n      const input = document.createElement('input')\n      input.type = 'hidden'\n      input.name = key\n      input.value = value\n      form.appendChild(input)\n    })\n  \n    // 將表單添加到頁面並提交\n    document.body.appendChild(form)\n    form.submit()\n\n    // 移除表單\n    document.body.removeChild(form)\n\n  }\n\n\n  return !errorMessage ? (\n    <Button\n      onClick={submitHandler}\n      disabled={notReady || submitting}\n      size=\"large\"\n      isLoading={submitting}\n      data-testid={dataTestId}\n    >\n        {submitting ? \"處理中...\" : \"前往 ECPay 付款223\"}\n    </Button>\n    // <form \n    //   method=\"POST\" \n    //   action={ecpayAPI}\n    //   target=\"_blank\"\n    //   encType=\"application/x-www-form-urlencoded\"\n    // >\n      \n    //   {Array.from(params.entries()).map(([key, value]) => (\n    //     <input key={key} type=\"hidden\" name={key} value={value} />\n    //   ))}\n      \n    //   <Button\n    //     type=\"submit\"\n    //     disabled={notReady || submitting}\n    //     size=\"large\"\n    //     isLoading={submitting}\n    //     data-testid={dataTestId}\n    //   >\n    //     {submitting ? \"處理中...\" : \"前往 ECPay 付款\"}\n    //   </Button>\n    // </form>\n  ):null;\n}\n\nexport default ECPayPaymentButton\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(checkout)/checkout/components/payment-button/index.tsx","messages":[{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":22,"column":5,"nodeType":null,"messageId":"preferOptionalChain","endLine":23,"endColumn":27,"fix":{"range":[499,534],"text":"!cart?.shipping_address"}},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":34,"column":5,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":34,"endColumn":7,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[851,853],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":36,"column":3,"nodeType":"MemberExpression","messageId":"unexpected","endLine":36,"endColumn":14,"suggestions":[{"fix":{"range":[904,958],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"sonarjs/no-small-switch","severity":2,"message":"Replace this \"switch\" statement by \"if\" statements to increase readability.","line":41,"column":3,"nodeType":null,"messageId":"replaceSwitch","endLine":41,"endColumn":9}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":1,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { HttpTypes } from \"@medusajs/types\"\nimport React from \"react\"\nimport ECPayPaymentButton from \"./ecpaypaymentbutton\"\nimport BankTransferPaymentButton from \"./banktransferpaymentbutton\"\nimport ErrorMessage from \"../error-message\"\n\ntype PaymentButtonProps = {\n  cart: HttpTypes.StoreCart\n  \"data-testid\": string\n}\n\nconst PaymentButton: React.FC<PaymentButtonProps> = ({\n  cart,\n  \"data-testid\": dataTestId,\n}) => {\n\n  const action:string = \"PaymentButton\"\n\n  const notReady =\n    !cart ||\n    !cart.shipping_address ||\n    !cart.billing_address ||\n    !cart.email ||\n    (cart.shipping_methods?.length ?? 0) < 1\n\n  if (notReady){\n    return <ErrorMessage error=\"請先完成前置步驟\" data-testid=\"payment-not-ready-error\" />\n  }\n  \n  const paymentSession = cart.payment_collection?.payment_sessions?.find(\n    (s) => s.status === \"pending\"\n  ) || cart.payment_collection?.payment_sessions?.[0]\n\n  console.log(action, \"paymentSession:\", paymentSession)\n\n  const providerId = paymentSession?.provider_id\n\n  // return <ECPayPaymentButton cart={cart} notReady={notReady} data-testid={dataTestId} />;\n  switch(providerId){\n    case process.env.NEXT_PUBLIC_PAYMENT_METHOD_ECPAY_CREDIT:\n      return <ECPayPaymentButton cart={cart} notReady={notReady} data-testid={dataTestId} />;\n    default:\n      return <BankTransferPaymentButton notReady={notReady} cart={cart} data-testid={dataTestId} />;\n  }  \n\n}\n\n// 其餘子按鈕（Stripe、BankTransfer、Manual）已拆分到個別檔案。\n\nexport default PaymentButton\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(checkout)/checkout/components/payment-button/stripepaymentbutton.tsx","messages":[{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":79,"column":14,"nodeType":null,"messageId":"preferOptionalChain","endLine":79,"endColumn":52,"fix":{"range":[2229,2267],"text":"pi?.status === \"requires_capture\""}},{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":80,"column":14,"nodeType":null,"messageId":"preferOptionalChain","endLine":80,"endColumn":45,"fix":{"range":[2285,2316],"text":"pi?.status === \"succeeded\""}},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":85,"column":41,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":85,"endColumn":43,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2418,2420],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":90,"column":12,"nodeType":null,"messageId":"preferOptionalChain","endLine":90,"endColumn":72,"fix":{"range":[2479,2539],"text":"paymentIntent?.status === \"requires_capture\""}},{"ruleId":"sonarjs/no-redundant-jump","severity":2,"message":"Remove this redundant jump.","line":96,"column":9,"nodeType":"ReturnStatement","messageId":"removeRedundantJump","endLine":96,"endColumn":15,"suggestions":[{"messageId":"suggestJumpRemoval","fix":{"range":[2650,2666],"text":""},"desc":"Remove this redundant jump"}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":3,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { useState } from \"react\"\nimport { Button } from \"@medusajs/ui\"\nimport ErrorMessage from \"../error-message\"\nimport { HttpTypes } from \"@medusajs/types\"\nimport { placeOrder } from \"@lib/data/cart\"\nimport { useElements, useStripe } from \"@stripe/react-stripe-js\"\n\ntype Props = {\n  cart: HttpTypes.StoreCart\n  notReady: boolean\n  \"data-testid\"?: string\n}\n\nconst StripePaymentButton = ({\n  cart,\n  notReady,\n  \"data-testid\": dataTestId,\n}: Props) => {\n  const [submitting, setSubmitting] = useState(false)\n  const [errorMessage, setErrorMessage] = useState<string | null>(null)\n\n  const onPaymentCompleted = async () => {\n    await placeOrder()\n      .catch((err) => {\n        setErrorMessage(err.message)\n      })\n      .finally(() => {\n        setSubmitting(false)\n      })\n  }\n\n  const stripe = useStripe()\n  const elements = useElements()\n  const card = elements?.getElement(\"card\")\n\n  const session = cart.payment_collection?.payment_sessions?.find(\n    (s) => s.status === \"pending\"\n  )\n\n  const disabled = !stripe || !elements ? true : false\n\n  const handlePayment = async () => {\n    setSubmitting(true)\n\n    if (!stripe || !elements || !card || !cart) {\n      setSubmitting(false)\n      return\n    }\n\n    await stripe\n      .confirmCardPayment(session?.data.client_secret as string, {\n        payment_method: {\n          card: card,\n          billing_details: {\n            name:\n              cart.billing_address?.first_name +\n              \" \" +\n              cart.billing_address?.last_name,\n            address: {\n              city: cart.billing_address?.city ?? undefined,\n              country: cart.billing_address?.country_code ?? undefined,\n              line1: cart.billing_address?.address_1 ?? undefined,\n              line2: cart.billing_address?.address_2 ?? undefined,\n              postal_code: cart.billing_address?.postal_code ?? undefined,\n              state: cart.billing_address?.province ?? undefined,\n            },\n            email: cart.email,\n            phone: cart.billing_address?.phone ?? undefined,\n          },\n        },\n      })\n      .then(({ error, paymentIntent }) => {\n        if (error) {\n          const pi = error.payment_intent\n\n          if (\n            (pi && pi.status === \"requires_capture\") ||\n            (pi && pi.status === \"succeeded\")\n          ) {\n            onPaymentCompleted()\n          }\n\n          setErrorMessage(error.message || null)\n          return\n        }\n\n        if (\n          (paymentIntent && paymentIntent.status === \"requires_capture\") ||\n          paymentIntent.status === \"succeeded\"\n        ) {\n          return onPaymentCompleted()\n        }\n\n        return\n      })\n  }\n\n  return (\n    <>\n      <Button\n        disabled={disabled || notReady}\n        onClick={handlePayment}\n        size=\"large\"\n        isLoading={submitting}\n        data-testid={dataTestId}\n      >\n        送出訂單\n      </Button>\n      <ErrorMessage\n        error={errorMessage}\n        data-testid=\"stripe-payment-error-message\"\n      />\n    </>\n  )\n}\n\nexport default StripePaymentButton\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(checkout)/checkout/components/payment-container/index.tsx","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":119,"column":43,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":119,"endColumn":45,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[4065,4067],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Radio as RadioGroupOption } from \"@headlessui/react\"\nimport { Text, clx } from \"@medusajs/ui\"\nimport React, { useContext, useMemo, type JSX } from \"react\"\n\nimport Radio from \"@modules/common/components/radio\"\nimport PaymentTest from \"@/app/(main)/[countryCode]/(checkout)/checkout/components/payment-test\"\n\nimport { isManual } from \"../../../../constants\"\nimport SkeletonCardDetails from \"@modules/skeletons/components/skeleton-card-details\"\nimport { CardElement } from \"@stripe/react-stripe-js\"\nimport { StripeCardElementOptions } from \"@stripe/stripe-js\"\nimport { StripeContext } from \"../payment-wrapper/stripe-wrapper\"\n\ntype PaymentContainerProps = {\n  paymentProviderId: string\n  selectedPaymentOptionId: string | null\n  disabled?: boolean\n  paymentInfoMap: Record<string, { title: string; icon: JSX.Element }>\n  children?: React.ReactNode\n}\n\nconst PaymentContainer: React.FC<PaymentContainerProps> = ({\n  paymentProviderId,\n  selectedPaymentOptionId,\n  paymentInfoMap,\n  disabled = false,\n  children,\n}) => {\n  const isDevelopment = process.env.NODE_ENV === \"development\"\n\n  return (\n    <RadioGroupOption\n      key={paymentProviderId}\n      value={paymentProviderId}\n      disabled={disabled}\n      className={clx(\n        \"flex flex-col gap-y-2 text-small-regular cursor-pointer py-4 border rounded-rounded px-8 mb-2 hover:shadow-borders-interactive-with-active\",\n        {\n          \"border-gray-900\":\n            selectedPaymentOptionId === paymentProviderId,\n        }\n      )}\n    >\n      <div className=\"flex items-center justify-between \">\n        <div className=\"flex items-center gap-x-4\">\n          <Radio checked={selectedPaymentOptionId === paymentProviderId} />\n          <Text className=\"text-base-regular\">\n            {paymentInfoMap[paymentProviderId]?.title || paymentProviderId}\n          </Text>\n          {isManual(paymentProviderId) && isDevelopment && (\n            <PaymentTest className=\"hidden small:block\" />\n          )}\n        </div>\n        <span className=\"justify-self-end text-gray-900\">\n          {paymentInfoMap[paymentProviderId]?.icon}\n        </span>\n      </div>\n      {isManual(paymentProviderId) && isDevelopment && (\n        <PaymentTest className=\"small:hidden text-[10px]\" />\n      )}\n      {children}\n    </RadioGroupOption>\n  )\n}\n\nexport default PaymentContainer\n\nexport const StripeCardContainer = ({\n  paymentProviderId,\n  selectedPaymentOptionId,\n  paymentInfoMap,\n  disabled = false,\n  setCardBrand,\n  setError,\n  setCardComplete,\n}: Omit<PaymentContainerProps, \"children\"> & {\n  setCardBrand: (brand: string) => void\n  setError: (error: string | null) => void\n  setCardComplete: (complete: boolean) => void\n}) => {\n  const stripeReady = useContext(StripeContext)\n\n  const useOptions: StripeCardElementOptions = useMemo(() => {\n    return {\n      style: {\n        base: {\n          fontFamily: \"var(--font-base)\",\n          color: \"#424270\",\n          \"::placeholder\": {\n            color: \"rgb(107 114 128)\",\n          },\n        },\n      },\n      classes: {\n        base: \"pt-3 pb-1 block w-full h-11 px-4 mt-0 bg-gray-50 border rounded-md appearance-none focus:outline-none focus:ring-0 focus:shadow-borders-interactive-with-active border-gray-200 hover:bg-gray-100 transition-all duration-300 ease-in-out\",\n      },\n    }\n  }, [])\n\n  return (\n    <PaymentContainer\n      paymentProviderId={paymentProviderId}\n      selectedPaymentOptionId={selectedPaymentOptionId}\n      paymentInfoMap={paymentInfoMap}\n      disabled={disabled}\n    >\n      {selectedPaymentOptionId === paymentProviderId &&\n        (stripeReady ? (\n          <div className=\"my-4 transition-all duration-150 ease-in-out\">\n            <Text className=\"text-sm text-gray-900 mb-1 font-medium\">\n              請輸入信用卡資料：\n            </Text>\n            <CardElement\n              options={useOptions as StripeCardElementOptions}\n              onChange={(e) => {\n                setCardBrand(\n                  e.brand && e.brand.charAt(0).toUpperCase() + e.brand.slice(1)\n                )\n                setError(e.error?.message || null)\n                setCardComplete(e.complete)\n              }}\n            />\n          </div>\n        ) : (\n          <SkeletonCardDetails />\n        ))}\n    </PaymentContainer>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(checkout)/checkout/components/payment-test/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(checkout)/checkout/components/payment-wrapper/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(checkout)/checkout/components/payment-wrapper/stripe-wrapper.tsx","messages":[{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":24,"column":19,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":24,"endColumn":34,"suggestions":[{"messageId":"suggestOptionalChain","fix":{"range":[638,639],"text":"?"},"desc":"Consider using the optional chain operator `?.` instead. This operator includes runtime checks, so it is safer than the compile-only non-null assertion operator."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":28,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":28,"endColumn":17,"suggestions":[{"fix":{"range":[712,745],"text":""},"messageId":"removeConsole","data":{"propertyName":"info"},"desc":"Remove the console.info()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":33,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":33,"endColumn":17,"suggestions":[{"fix":{"range":[812,845],"text":""},"messageId":"removeConsole","data":{"propertyName":"info"},"desc":"Remove the console.info()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { Stripe, StripeElementsOptions } from \"@stripe/stripe-js\"\nimport { Elements } from \"@stripe/react-stripe-js\"\nimport { HttpTypes } from \"@medusajs/types\"\nimport { createContext } from \"react\"\n\ntype StripeWrapperProps = {\n  paymentSession: HttpTypes.StorePaymentSession\n  stripeKey?: string\n  stripePromise: Promise<Stripe | null> | null\n  children: React.ReactNode\n}\n\nexport const StripeContext = createContext(false)\n\nconst StripeWrapper: React.FC<StripeWrapperProps> = ({\n  paymentSession,\n  stripeKey,\n  stripePromise,\n  children,\n}) => {\n  const options: StripeElementsOptions = {\n    clientSecret: paymentSession!.data?.client_secret as string | undefined,\n  }\n\n  if (!stripeKey) {\n    console.info(\"ℹ️ Stripe 功能已暫時停用\")\n    return <div>{children}</div>\n  }\n\n  if (!stripePromise) {\n    console.info(\"ℹ️ Stripe 功能已暫時停用\")\n    return <div>{children}</div>\n  }\n\n  if (!paymentSession?.data?.client_secret) {\n    throw new Error(\n      \"Stripe client secret is missing. Cannot initialize Stripe.\"\n    )\n  }\n\n  return (\n    <StripeContext.Provider value={true}>\n      <Elements options={options} stripe={stripePromise}>\n        {children}\n      </Elements>\n    </StripeContext.Provider>\n  )\n}\n\nexport default StripeWrapper\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(checkout)/checkout/components/payment/index.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'PaymentContainer' is defined but never used.","line":10,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":24},{"ruleId":"unused-imports/no-unused-imports","severity":2,"message":"'PaymentContainer' is defined but never used.","line":10,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":24,"fix":{"range":[381,399],"text":""}},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'StripeCardContainer' is defined but never used.","line":10,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":47},{"ruleId":"unused-imports/no-unused-imports","severity":2,"message":"'StripeCardContainer' is defined but never used.","line":10,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":47,"fix":{"range":[398,423],"text":""}},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'availablePaymentMethods' is defined but never used.","line":23,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":26},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'availablePaymentMethods' is defined but never used. Allowed unused args must match /^_/u.","line":23,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":26},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":25,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[826,829],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[826,829],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":26,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[857,860],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[857,860],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":33,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1137,1140],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1137,1140],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'setCardBrand' is assigned a value but never used.","line":38,"column":21,"nodeType":null,"messageId":"unusedVar","endLine":38,"endColumn":33},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'setCardBrand' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":38,"column":21,"nodeType":null,"messageId":"unusedVar","endLine":38,"endColumn":33},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'setCardComplete' is assigned a value but never used.","line":39,"column":24,"nodeType":null,"messageId":"unusedVar","endLine":39,"endColumn":39},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'setCardComplete' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":39,"column":24,"nodeType":null,"messageId":"unusedVar","endLine":39,"endColumn":39},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'isEcpayMethod' is assigned a value but never used.","line":51,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":51,"endColumn":22},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'isEcpayMethod' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":51,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":51,"endColumn":22},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":57,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":57,"endColumn":16,"suggestions":[{"fix":{"range":[1919,1955],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":67,"column":60,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":67,"endColumn":62,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2186,2188],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":91,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":91,"endColumn":16,"suggestions":[{"fix":{"range":[2683,2744],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":97,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":97,"endColumn":20,"suggestions":[{"fix":{"range":[2767,2825],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":104,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":104,"endColumn":20,"suggestions":[{"fix":{"range":[2954,3042],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":115,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":115,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3232,3235],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3232,3235],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":116,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":116,"endColumn":18,"suggestions":[{"fix":{"range":[3245,3281],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":215,"column":47,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":215,"endColumn":49,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[6636,6638],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":237,"column":70,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":237,"endColumn":72,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[7444,7446],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":250,"column":66,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":250,"endColumn":68,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[8035,8037],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":16,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":2,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { RadioGroup } from \"@headlessui/react\"\nimport { isStripe as isStripeFunc, paymentInfoMap } from \"../../../../constants\"\nimport { initiatePaymentSession } from \"@lib/data/cart\"\nimport { CheckCircleSolid, CreditCard } from \"@medusajs/icons\"\nimport { Button, Container, Heading, Text, clx } from \"@medusajs/ui\"\n\nimport ErrorMessage from \"../error-message\"\nimport PaymentContainer, { StripeCardContainer } from \"../payment-container\"\nimport Divider from \"@modules/common/components/divider\"\nimport { usePathname, useRouter, useSearchParams } from \"next/navigation\"\nimport { useCallback, useEffect, useState } from \"react\"\n\n// 檢查是否為綠界支付方式\nconst isEcpay = (providerId: string | undefined) => {\n  return providerId === \"ecpay_credit_card\";\n}\n\n\nconst Payment = ({\n  cart,\n  availablePaymentMethods,\n}: {\n  cart: any\n  availablePaymentMethods: any[]\n}) => {\n\n  const payment_method_default = process.env.NEXT_PUBLIC_PAYMENT_METHOD_DEFAULT\n  const payment_method_ecpay_credit = process.env.NEXT_PUBLIC_PAYMENT_METHOD_ECPAY_CREDIT\n\n  const activeSession = cart.payment_collection?.payment_sessions?.find(\n    (paymentSession: any) => paymentSession.status === \"pending\"\n  )\n\n  const [isLoading, setIsLoading] = useState(false)\n  const [error, setError] = useState<string | null>(null)\n  const [cardBrand, setCardBrand] = useState<string | null>(null)\n  const [cardComplete, setCardComplete] = useState(false)\n  const [selectedPaymentMethod, setSelectedPaymentMethod] = useState(\n    activeSession?.provider_id ?? \"\"\n  )\n\n  const searchParams = useSearchParams()\n  const router = useRouter()\n  const pathname = usePathname()\n\n  const isOpen = searchParams.get(\"step\") === \"payment\"\n\n  const isStripe = isStripeFunc(selectedPaymentMethod)\n  const isEcpayMethod = isEcpay(selectedPaymentMethod)\n\n  const setPaymentMethod = async (method: string) => {\n    \n    const action: string = \"setPaymentMethod\"\n    \n    console.log(action,\"選擇支付方式：\",method)\n\n    setSelectedPaymentMethod(method)\n    \n  }\n\n  const paidByGiftcard =\n    cart?.gift_cards && cart?.gift_cards?.length > 0 && cart?.total === 0\n\n  const paymentReady =\n    (activeSession && cart?.shipping_methods.length !== 0) || paidByGiftcard\n\n  const createQueryString = useCallback(\n    (name: string, value: string) => {\n      const params = new URLSearchParams(searchParams)\n      params.set(name, value)\n\n      return params.toString()\n    },\n    [searchParams]\n  )\n\n  const handleEdit = () => {\n    router.push(pathname + \"?\" + createQueryString(\"step\", \"payment\"), {\n      scroll: false,\n    })\n  }\n\n  const handleSubmit = async () => {\n    \n    const action: string = \"handleSubmit\"\n  \n    setIsLoading(true)\n\n    console.log(action,\"支付方式(providerID):\",selectedPaymentMethod)\n\n\n\n    try {\n\n        console.log(action,\":執行initiatePaymentSession(更新支付方式到訂單)\")\n\n        const initResp = await initiatePaymentSession(cart,{\n          provider_id: selectedPaymentMethod\n        })\n\n\n        console.log(action,\"執行initiatePaymentSession(更新支付方式到訂單)結果：\",initResp.payment_collection)\n\n        \n\n        return router.push(\n          pathname + \"?\" + createQueryString(\"step\", \"review\"),\n          {\n            scroll: false,\n          }\n        )\n      \n    } catch (err: any) {\n      console.log(action,\"has error:\",err)\n      setError(err.message)\n    } finally {\n      setIsLoading(false)\n    }\n  }\n\n  useEffect(() => {\n    setError(null)\n  }, [isOpen])\n\n  return (\n    <div className=\"bg-white\">\n      <div className=\"flex flex-row items-center justify-between mb-6\">\n        <Heading\n          level=\"h2\"\n          className={clx(\n            \"flex flex-row text-2xl gap-x-2 items-baseline\",\n            {\n              \"opacity-50 pointer-events-none select-none\":\n                !isOpen && !paymentReady,\n            }\n          )}\n        >\n          付款方式\n          {!isOpen && paymentReady && <CheckCircleSolid />}\n        </Heading>\n        {!isOpen && paymentReady && (\n          <Text>\n            <button\n              onClick={handleEdit}\n              className=\"text-blue-600 hover:text-blue-600-hover\"\n              data-testid=\"edit-payment-button\"\n            >\n              編輯\n            </button>\n          </Text>\n        )}\n      </div>\n      <div>\n        <div className={isOpen ? \"block\" : \"hidden\"}>\n          {!paidByGiftcard && (\n            <>\n              {/* 只顯示兩個硬編碼選項：綠界支付（含刷卡）與銀行轉帳 */}\n              <RadioGroup value={selectedPaymentMethod} onChange={setPaymentMethod}>\n                <RadioGroup.Option value={payment_method_ecpay_credit}>\n                  {({ checked }) => (\n                    <div className={`border p-4 rounded mb-2 ${checked ? 'border-blue-500' : 'border-gray-200'}`}>\n                      <Heading level=\"h3\" className=\"text-base font-medium mb-1\">綠界支付（含刷卡）</Heading>\n                      <Text className=\"text-sm text-gray-600\">信用卡 / 金融卡 (VISA、Mastercard、JCB)</Text>\n                    </div>\n                  )}\n                </RadioGroup.Option>\n                <RadioGroup.Option value={payment_method_default}>\n                  {({ checked }) => (\n                    <div className={`border p-4 rounded mb-2 ${checked ? 'border-blue-500' : 'border-gray-200'}`}>\n                      <Heading level=\"h3\" className=\"text-base font-medium mb-1\">銀行轉帳</Heading>\n                      <Text className=\"text-sm text-gray-600\">手動銀行轉帳 (需要人工核帳)</Text>\n                    </div>\n                  )}\n                </RadioGroup.Option>\n              </RadioGroup>\n            </>\n          )}\n\n          {paidByGiftcard && (\n            <div className=\"flex flex-col w-1/3\">\n              <Text className=\"text-sm text-gray-900 mb-1 font-medium\">\n                付款方式\n              </Text>\n              <Text\n                className=\"text-xs text-gray-600\"\n                data-testid=\"payment-method-summary\"\n              >\n                禮品卡\n              </Text>\n            </div>\n          )}\n\n          <ErrorMessage\n            error={error}\n            data-testid=\"payment-method-error-message\"\n          />\n\n          <div className=\"flex gap-4 mt-6\">\n            <Button\n              variant=\"secondary\"\n              onClick={() => router.push(pathname + \"?\" + createQueryString(\"step\", \"delivery\"), { scroll: false })}\n              className=\"flex-1\"\n            >\n              上一步：修改配送方式\n            </Button>\n            <div className=\"flex-2\">\n              <Button\n                size=\"large\"\n                className=\"w-full\"\n                onClick={handleSubmit}\n                isLoading={isLoading}\n                disabled={\n                  (isStripe && !cardComplete) ||\n                  (!selectedPaymentMethod && !paidByGiftcard)\n                }\n                data-testid=\"submit-payment-button\"\n              >\n                繼續檢視訂單\n              </Button>\n            </div>\n          </div>\n        </div>\n\n        <div className={isOpen ? \"hidden\" : \"block\"}>\n          {cart && paymentReady && activeSession ? (\n            <div className=\"flex items-start gap-x-1 w-full\">\n              <div className=\"flex flex-col w-1/3\">\n                <Text className=\"text-sm text-gray-900 mb-1 font-medium\">\n                  付款方式\n                </Text>\n                <Text\n                  className=\"text-xs text-gray-600\"\n                  data-testid=\"payment-method-summary\"\n                >\n                  {paymentInfoMap[activeSession?.provider_id]?.title ||\n                    activeSession?.provider_id}\n                </Text>\n              </div>\n              <div className=\"flex flex-col w-1/3\">\n                <Text className=\"text-sm text-gray-900 mb-1 font-medium\">\n                  付款詳情\n                </Text>\n                <div\n                  className=\"flex gap-2 text-xs text-gray-600 items-center\"\n                  data-testid=\"payment-details-summary\"\n                >\n                  <Container className=\"flex items-center h-7 w-fit p-2 bg-gray-200\">\n                    {paymentInfoMap[selectedPaymentMethod]?.icon || (\n                      <CreditCard />\n                    )}\n                  </Container>\n                  <Text>\n                    {isStripeFunc(selectedPaymentMethod) && cardBrand\n                      ? cardBrand\n                      : \"將於下一步顯示\"}\n                  </Text>\n                </div>\n              </div>\n            </div>\n          ) : paidByGiftcard ? (\n            <div className=\"flex flex-col w-1/3\">\n              <Text className=\"txt-medium-plus text-gray-900 mb-1\">\n                付款方式\n              </Text>\n              <Text\n                className=\"txt-medium text-gray-600\"\n                data-testid=\"payment-method-summary\"\n              >\n                禮品卡\n              </Text>\n            </div>\n          ) : null}\n        </div>\n      </div>\n      <Divider className=\"mt-8\" />\n    </div>\n  )\n}\n\nexport default Payment\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(checkout)/checkout/components/review/index.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'placeOrder' is defined but never used.","line":8,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":20},{"ruleId":"unused-imports/no-unused-imports","severity":2,"message":"'placeOrder' is defined but never used.","line":8,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":20,"fix":{"range":[205,250],"text":"\n"}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":10,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[284,287],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[284,287],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":20,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[649,652],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[649,652],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":27,"column":30,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":27,"endColumn":32,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[821,862],"text":"(cart.payment_collection ?? paidByGiftcard)"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":27,"column":48,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":27,"endColumn":50,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[863,865],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":30,"column":5,"nodeType":null,"messageId":"preferOptionalChain","endLine":31,"endColumn":27,"fix":{"range":[906,941],"text":"!cart?.shipping_address"}}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":2,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { Heading, Text, clx } from \"@medusajs/ui\"\n\nimport PaymentButton from \"../payment-button\"\nimport { useSearchParams } from \"next/navigation\"\nimport ErrorMessage from \"../error-message\"\nimport { placeOrder } from \"@lib/data/cart\"\n\nconst Review = ({ cart }: { cart: any }) => {\n  const searchParams = useSearchParams()\n\n  const isOpen = searchParams.get(\"step\") === \"review\"\n\n  const paidByGiftcard =\n    cart?.gift_cards && cart?.gift_cards?.length > 0 && cart?.total === 0\n\n  // 檢查是否為銀行轉帳\n  const isBankTransfer = searchParams.get(\"payment\") === \"bank_transfer\" || \n    cart?.payment_collection?.payment_sessions?.some((session: any) => \n      session.provider_id === 'pp_bank_transfer'\n    )\n\n  const previousStepsCompleted =\n    cart.shipping_address &&\n    cart.shipping_methods.length > 0 &&\n    (cart.payment_collection || paidByGiftcard || isBankTransfer)\n\n  const notReady =\n    !cart ||\n    !cart.shipping_address ||\n    !cart.billing_address ||\n    !cart.email ||\n    (cart.shipping_methods?.length ?? 0) < 1\n\n  if (notReady){\n    return <ErrorMessage error=\"請先完成前置步驟\" data-testid=\"payment-not-ready-error\" />\n  }\n\n  return (\n    <div className=\"bg-white\">\n      <div className=\"flex flex-row items-center justify-between mb-6\">\n        <Heading\n          level=\"h2\"\n          className={clx(\n            \"flex flex-row text-3xl-regular gap-x-2 items-baseline\",\n            {\n              \"opacity-50 pointer-events-none select-none\": !isOpen,\n            }\n          )}\n        >\n          Review\n        </Heading>\n      </div>\n      {isOpen && previousStepsCompleted && (\n        <>\n          <div className=\"flex items-start gap-x-1 w-full mb-6\">\n            <div className=\"w-full\">\n              <Text className=\"txt-medium-plus text-ui-fg-base mb-1\">\n                By clicking the Place Order button, you confirm that you have\n                read, understand and accept our Terms of Use, Terms of Sale and\n                Returns Policy and acknowledge that you have read Medusa\n                Store&apos;s Privacy Policy.\n              </Text>\n            </div>\n          </div>\n          <PaymentButton cart={cart} data-testid=\"submit-order-button\" />\n        </>\n      )}\n    </div>\n  )\n}\n\nexport default Review\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(checkout)/checkout/components/shipping-address/index.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":21,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[644,647],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[644,647],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":22,"column":71,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":22,"endColumn":73,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[722,724],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":23,"column":69,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":23,"endColumn":71,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[797,799],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":24,"column":69,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":24,"endColumn":71,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[872,874],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":25,"column":65,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":25,"endColumn":67,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[943,945],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":26,"column":73,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":26,"endColumn":75,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1022,1024],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":27,"column":59,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":27,"endColumn":61,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1087,1089],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":28,"column":75,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":28,"endColumn":77,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1168,1170],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":29,"column":67,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":29,"endColumn":69,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1241,1243],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":30,"column":61,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":30,"endColumn":63,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1308,1310],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":31,"column":24,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":31,"endColumn":26,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1338,1340],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":53,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":53,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1916,1919],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1916,1919],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":55,"column":60,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":55,"endColumn":62,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2009,2011],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":56,"column":58,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":56,"endColumn":60,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2073,2075],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":57,"column":58,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":57,"endColumn":60,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2137,2139],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":58,"column":54,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":58,"endColumn":56,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2197,2199],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":59,"column":62,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":59,"endColumn":64,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2265,2267],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":60,"column":48,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":60,"endColumn":50,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2319,2321],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":61,"column":64,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":61,"endColumn":66,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2389,2391],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":62,"column":56,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":62,"endColumn":58,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2451,2453],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":63,"column":50,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":63,"endColumn":52,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2507,2509],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":67,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2583,2586],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2583,2586],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":75,"column":9,"nodeType":null,"messageId":"preferOptionalChain","endLine":75,"endColumn":38,"fix":{"range":[2765,2794],"text":"cart?.shipping_address"}},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":97,"column":47,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":97,"endColumn":49,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3289,3291],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":21,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import { HttpTypes } from \"@medusajs/types\"\nimport { Container } from \"@medusajs/ui\"\nimport Checkbox from \"@modules/common/components/checkbox\"\nimport Input from \"@modules/common/components/input\"\nimport { mapKeys } from \"lodash\"\nimport React, { useEffect, useMemo, useState } from \"react\"\nimport AddressSelect from \"../address-select\"\nimport CountrySelect from \"../country-select\"\n\nconst ShippingAddress = ({\n  customer,\n  cart,\n  checked,\n  onChange,\n}: {\n  customer: HttpTypes.StoreCustomer | null\n  cart: HttpTypes.StoreCart | null\n  checked: boolean\n  onChange: () => void\n}) => {\n  const [formData, setFormData] = useState<Record<string, any>>({\n    \"shipping_address.first_name\": cart?.shipping_address?.first_name || \"\",\n    \"shipping_address.last_name\": cart?.shipping_address?.last_name || \"\",\n    \"shipping_address.address_1\": cart?.shipping_address?.address_1 || \"\",\n    \"shipping_address.company\": cart?.shipping_address?.company || \"\",\n    \"shipping_address.postal_code\": cart?.shipping_address?.postal_code || \"\",\n    \"shipping_address.city\": cart?.shipping_address?.city || \"\",\n    \"shipping_address.country_code\": cart?.shipping_address?.country_code || \"\",\n    \"shipping_address.province\": cart?.shipping_address?.province || \"\",\n    \"shipping_address.phone\": cart?.shipping_address?.phone || \"\",\n    email: cart?.email || \"\",\n  })\n\n  const countriesInRegion = useMemo(\n    () => cart?.region?.countries?.map((c) => c.iso_2),\n    [cart?.region]\n  )\n\n  // check if customer has saved addresses that are in the current region\n  const addressesInRegion = useMemo(\n    () =>\n      customer?.addresses.filter(\n        (a) => a.country_code && countriesInRegion?.includes(a.country_code)\n      ),\n    [customer?.addresses, countriesInRegion]\n  )\n\n  const setFormAddress = (\n    address?: HttpTypes.StoreCartAddress,\n    email?: string\n  ) => {\n    address &&\n      setFormData((prevState: Record<string, any>) => ({\n        ...prevState,\n        \"shipping_address.first_name\": address?.first_name || \"\",\n        \"shipping_address.last_name\": address?.last_name || \"\",\n        \"shipping_address.address_1\": address?.address_1 || \"\",\n        \"shipping_address.company\": address?.company || \"\",\n        \"shipping_address.postal_code\": address?.postal_code || \"\",\n        \"shipping_address.city\": address?.city || \"\",\n        \"shipping_address.country_code\": address?.country_code || \"\",\n        \"shipping_address.province\": address?.province || \"\",\n        \"shipping_address.phone\": address?.phone || \"\",\n      }))\n\n    email &&\n      setFormData((prevState: Record<string, any>) => ({\n        ...prevState,\n        email: email,\n      }))\n  }\n\n  useEffect(() => {\n    // Ensure cart is not null and has a shipping_address before setting form data\n    if (cart && cart.shipping_address) {\n      setFormAddress(cart?.shipping_address, cart?.email)\n    }\n\n    if (cart && !cart.email && customer?.email) {\n      setFormAddress(undefined, customer.email)\n    }\n  }, [cart]) // Add cart as a dependency\n\n  const handleChange = (\n    e: React.ChangeEvent<\n      HTMLInputElement | HTMLInputElement | HTMLSelectElement\n    >\n  ) => {\n    setFormData({\n      ...formData,\n      [e.target.name]: e.target.value,\n    })\n  }\n\n  return (\n    <>\n      {customer && (addressesInRegion?.length || 0) > 0 && (\n        <Container className=\"mb-6 flex flex-col gap-y-4 p-5\">\n          <p className=\"text-small-regular\">\n            {`Hi ${customer.first_name}, do you want to use one of your saved addresses?`}\n          </p>\n          <AddressSelect\n            addresses={customer.addresses}\n            addressInput={\n              mapKeys(formData, (_, key) =>\n                key.replace(\"shipping_address.\", \"\")\n              ) as HttpTypes.StoreCartAddress\n            }\n            onSelect={setFormAddress}\n          />\n        </Container>\n      )}\n      <div className=\"grid grid-cols-2 gap-4\">\n        <Input\n          label=\"First name\"\n          name=\"shipping_address.first_name\"\n          autoComplete=\"given-name\"\n          value={formData[\"shipping_address.first_name\"]}\n          onChange={handleChange}\n          required\n          data-testid=\"shipping-first-name-input\"\n        />\n        <Input\n          label=\"Last name\"\n          name=\"shipping_address.last_name\"\n          autoComplete=\"family-name\"\n          value={formData[\"shipping_address.last_name\"]}\n          onChange={handleChange}\n          required\n          data-testid=\"shipping-last-name-input\"\n        />\n        <Input\n          label=\"Address\"\n          name=\"shipping_address.address_1\"\n          autoComplete=\"address-line1\"\n          value={formData[\"shipping_address.address_1\"]}\n          onChange={handleChange}\n          required\n          data-testid=\"shipping-address-input\"\n        />\n        <Input\n          label=\"Company\"\n          name=\"shipping_address.company\"\n          value={formData[\"shipping_address.company\"]}\n          onChange={handleChange}\n          autoComplete=\"organization\"\n          data-testid=\"shipping-company-input\"\n        />\n        <Input\n          label=\"Postal code\"\n          name=\"shipping_address.postal_code\"\n          autoComplete=\"postal-code\"\n          value={formData[\"shipping_address.postal_code\"]}\n          onChange={handleChange}\n          required\n          data-testid=\"shipping-postal-code-input\"\n        />\n        <Input\n          label=\"City\"\n          name=\"shipping_address.city\"\n          autoComplete=\"address-level2\"\n          value={formData[\"shipping_address.city\"]}\n          onChange={handleChange}\n          required\n          data-testid=\"shipping-city-input\"\n        />\n        <CountrySelect\n          name=\"shipping_address.country_code\"\n          autoComplete=\"country\"\n          region={cart?.region}\n          value={formData[\"shipping_address.country_code\"]}\n          onChange={handleChange}\n          required\n          data-testid=\"shipping-country-select\"\n        />\n        <Input\n          label=\"State / Province\"\n          name=\"shipping_address.province\"\n          autoComplete=\"address-level1\"\n          value={formData[\"shipping_address.province\"]}\n          onChange={handleChange}\n          data-testid=\"shipping-province-input\"\n        />\n      </div>\n      <div className=\"my-8\">\n        <Checkbox\n          label=\"帳單地址與收貨地址相同\"\n          name=\"same_as_billing\"\n          checked={checked}\n          onChange={onChange}\n          data-testid=\"billing-address-checkbox\"\n        />\n      </div>\n      <div className=\"grid grid-cols-2 gap-4 mb-4\">\n        <Input\n          label=\"Email\"\n          name=\"email\"\n          type=\"email\"\n          title=\"Enter a valid email address.\"\n          autoComplete=\"email\"\n          value={formData.email}\n          onChange={handleChange}\n          required\n          data-testid=\"shipping-email-input\"\n        />\n        <Input\n          label=\"Phone\"\n          name=\"shipping_address.phone\"\n          autoComplete=\"tel\"\n          value={formData[\"shipping_address.phone\"]}\n          onChange={handleChange}\n          data-testid=\"shipping-phone-input\"\n        />\n      </div>\n    </>\n  )\n}\n\nexport default ShippingAddress\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(checkout)/checkout/components/shipping/index.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":24,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[945,948],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[945,948],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":64,"column":55,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":64,"endColumn":57,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1917,1919],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":74,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":74,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2172,2175],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2172,2175],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":78,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2309,2312],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2309,2312],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":96,"column":52,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":96,"endColumn":54,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2929,2931],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":96,"column":61,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":96,"endColumn":77},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":128,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":128,"endColumn":16,"suggestions":[{"fix":{"range":[3660,3711],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":146,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":146,"endColumn":16,"suggestions":[{"fix":{"range":[4034,4111],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":164,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":164,"endColumn":18,"suggestions":[{"fix":{"range":[4510,4535],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":165,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":165,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4554,4557],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4554,4557],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":166,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":166,"endColumn":20,"suggestions":[{"fix":{"range":[4567,4600],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":177,"column":30,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":177,"endColumn":32,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[5008,5010],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'value' is defined but never used.","line":237,"column":32,"nodeType":null,"messageId":"unusedVar","endLine":237,"endColumn":37},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'value' is defined but never used. Allowed unused args must match /^_/u.","line":237,"column":32,"nodeType":null,"messageId":"unusedVar","endLine":237,"endColumn":37},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":313,"column":39,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":313,"endColumn":53},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":378,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":378,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13379,13382],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13379,13382],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":386,"column":39,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":386,"endColumn":53},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":431,"column":67,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":431,"endColumn":69,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[15258,15260],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":12,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { RadioGroup, Radio } from \"@headlessui/react\"\nimport { setShippingMethod } from \"@lib/data/cart\"\nimport { calculatePriceForShippingOption } from \"@lib/data/fulfillment\"\nimport { convertToLocale } from \"@lib/util/money\"\nimport { CheckCircleSolid, Loader } from \"@medusajs/icons\"\nimport { HttpTypes } from \"@medusajs/types\"\nimport { Button, Heading, Text, clx } from \"@medusajs/ui\"\nimport ErrorMessage from \"@modules/checkout/components/error-message\"\nimport Divider from \"@modules/common/components/divider\"\nimport MedusaRadio from \"@modules/common/components/radio\"\nimport { usePathname, useRouter, useSearchParams } from \"next/navigation\"\nimport { useEffect, useState } from \"react\"\n\nconst PICKUP_OPTION_ON = \"__PICKUP_ON\"\nconst PICKUP_OPTION_OFF = \"__PICKUP_OFF\"\n\ntype ShippingProps = {\n  cart: HttpTypes.StoreCart\n  availableShippingMethods: HttpTypes.StoreCartShippingOption[] | null\n}\n\nfunction formatAddress(address: any) {\n  if (!address) {\n    return \"\"\n  }\n\n  let ret = \"\"\n\n  if (address.address_1) {\n    ret += ` ${address.address_1}`\n  }\n\n  if (address.address_2) {\n    ret += `, ${address.address_2}`\n  }\n\n  if (address.postal_code) {\n    ret += `, ${address.postal_code} ${address.city}`\n  }\n\n  if (address.country_code) {\n    ret += `, ${address.country_code.toUpperCase()}`\n  }\n\n  return ret\n}\n\nconst Shipping: React.FC<ShippingProps> = ({\n  cart,\n  availableShippingMethods,\n}) => {\n  const [isLoading, setIsLoading] = useState(false)\n  const [isLoadingPrices, setIsLoadingPrices] = useState(true)\n\n  const [showPickupOptions, setShowPickupOptions] =\n    useState<string>(PICKUP_OPTION_OFF)\n  const [calculatedPricesMap, setCalculatedPricesMap] = useState<\n    Record<string, number>\n  >({})\n  const [error, setError] = useState<string | null>(null)\n  const [shippingMethodId, setShippingMethodId] = useState<string | null>(\n    cart.shipping_methods?.at(-1)?.shipping_option_id || null\n  )\n\n  const searchParams = useSearchParams()\n  const router = useRouter()\n  const pathname = usePathname()\n\n  const isOpen = searchParams.get(\"step\") === \"delivery\"\n\n  const _shippingMethods = availableShippingMethods?.filter(\n    (sm) => (sm as any).service_zone?.fulfillment_set?.type !== \"pickup\"\n  )\n\n  const _pickupMethods = availableShippingMethods?.filter(\n    (sm) => (sm as any).service_zone?.fulfillment_set?.type === \"pickup\"\n  )\n\n  const hasPickupOptions = !!_pickupMethods?.length\n\n  useEffect(() => {\n    setIsLoadingPrices(true)\n\n    if (_shippingMethods?.length) {\n      const promises = _shippingMethods\n        .filter((sm) => sm.price_type === \"calculated\")\n        .map((sm) => calculatePriceForShippingOption(sm.id, cart.id))\n\n      if (promises.length) {\n        Promise.allSettled(promises).then((res) => {\n          const pricesMap: Record<string, number> = {}\n          res\n            .filter((r) => r.status === \"fulfilled\")\n            .forEach((p) => (pricesMap[p.value?.id || \"\"] = p.value?.amount!))\n\n          setCalculatedPricesMap(pricesMap)\n          setIsLoadingPrices(false)\n        })\n      }\n    }\n\n    if (_pickupMethods?.find((m) => m.id === shippingMethodId)) {\n      setShowPickupOptions(PICKUP_OPTION_ON)\n    }\n  }, [availableShippingMethods])\n\n  const handleEdit = () => {\n    router.push(pathname + \"?step=delivery\", { scroll: false })\n  }\n\n  const handleSubmit = () => {\n    // 檢查是否有可用的配送方式\n    if (!_shippingMethods || _shippingMethods.length === 0) {\n      setError('目前沒有可用的配送方式，請聯繫客服或稍後再試')\n      return\n    }\n\n    // 檢查是否已選擇配送方式\n    if (!cart.shipping_methods?.[0] && !shippingMethodId) {\n      setError('請先選擇配送方式')\n      return\n    }\n    \n    // 清除錯誤並跳轉到付款頁面\n    setError(null)\n    console.log('✅ 跳轉到付款頁面，選中的配送方式:', shippingMethodId)\n    router.push(pathname + \"?step=payment\", { scroll: false })\n  }\n\n  const handleSetShippingMethod = async (\n    id: string | null,\n    variant: \"shipping\" | \"pickup\"\n  ) => {\n    if (!id) {\n      setError('請選擇配送方式')\n      return\n    }\n\n    if (!cart?.id) {\n      setError('購物車資訊不完整，請重新整理頁面')\n      return\n    }\n    \n    console.log('🚚 設置配送方式:', { cartId: cart.id, shippingMethodId: id, variant })\n    setError(null)\n\n    if (variant === \"pickup\") {\n      setShowPickupOptions(PICKUP_OPTION_ON)\n    } else {\n      setShowPickupOptions(PICKUP_OPTION_OFF)\n    }\n\n    let currentId: string | null = null\n    setIsLoading(true)\n    setShippingMethodId((prev) => {\n      currentId = prev\n      return id\n    })\n\n    try {\n      await setShippingMethod({ cartId: cart.id, shippingMethodId: id })\n      console.log('✅ 配送方式設置成功')\n    } catch (err: any) {\n      console.error('❌ 配送方式設置錯誤:', err)\n      setShippingMethodId(currentId)\n      \n      // 提供更友好的錯誤訊息\n      if (err.message.includes('Error setting up the request')) {\n        setError('配送方式設定失敗，請檢查網路連線。如果問題持續存在，請聯繫客服。')\n      } else if (err.message.includes('shipping')) {\n        setError('配送選項設定錯誤，請重新選擇配送方式')\n      } else if (err.message.includes('cart')) {\n        setError('購物車狀態錯誤，請重新整理頁面後重試')\n      } else {\n        setError(err.message || '設定配送方式時發生未知錯誤，請重試')\n      }\n    } finally {\n      setIsLoading(false)\n    }\n  }\n\n  useEffect(() => {\n    setError(null)\n  }, [isOpen])\n\n  return (\n    <div className=\"bg-white\">\n      <div className=\"flex flex-row items-center justify-between mb-6\">\n        <Heading\n          level=\"h2\"\n          className={clx(\n            \"flex flex-row text-3xl-regular gap-x-2 items-baseline\",\n            {\n              \"opacity-50 pointer-events-none select-none\":\n                !isOpen && cart.shipping_methods?.length === 0,\n            }\n          )}\n        >\n          配送方式\n          {!isOpen && (cart.shipping_methods?.length ?? 0) > 0 && (\n            <CheckCircleSolid />\n          )}\n        </Heading>\n        {!isOpen &&\n          cart?.shipping_address &&\n          cart?.billing_address &&\n          cart?.email && (\n            <Text>\n              <button\n                onClick={handleEdit}\n                className=\"text-ui-fg-interactive hover:text-ui-fg-interactive-hover\"\n                data-testid=\"edit-delivery-button\"\n              >\n                編輯\n              </button>\n            </Text>\n          )}\n      </div>\n      {isOpen ? (\n        <>\n          <div className=\"grid\">\n            <div className=\"flex flex-col\">\n              <span className=\"font-medium txt-medium text-ui-fg-base\">\n                運送方式\n              </span>\n              <span className=\"mb-4 text-ui-fg-muted txt-medium\">\n                請選擇您希望的運送方式\n              </span>\n            </div>\n            <div data-testid=\"delivery-options-container\">\n              <div className=\"pb-8 md:pt-0 pt-2\">\n                {hasPickupOptions && (\n                  <RadioGroup\n                    value={showPickupOptions}\n                    onChange={(value) => {\n                      const id = _pickupMethods.find(\n                        (option) => !option.insufficient_inventory\n                      )?.id\n\n                      if (id) {\n                        handleSetShippingMethod(id, \"pickup\")\n                      }\n                    }}\n                  >\n                    <Radio\n                      value={PICKUP_OPTION_ON}\n                      data-testid=\"delivery-option-radio\"\n                      className={clx(\n                        \"flex items-center justify-between text-small-regular cursor-pointer py-4 border rounded-lg px-8 mb-2 transition-all duration-200\",\n                        {\n                          \"border-blue-500 bg-blue-50 ring-2 ring-blue-200\":\n                            showPickupOptions === PICKUP_OPTION_ON,\n                          \"border-gray-300 hover:border-gray-400 bg-white\":\n                            showPickupOptions !== PICKUP_OPTION_ON,\n                        }\n                      )}\n                    >\n                      <div className=\"flex items-center gap-x-4\">\n                        <MedusaRadio\n                          checked={showPickupOptions === PICKUP_OPTION_ON}\n                        />\n                        <span className=\"text-base-regular\">\n                          Pick up your order\n                        </span>\n                      </div>\n                      <span className=\"justify-self-end text-ui-fg-base\">\n                        -\n                      </span>\n                    </Radio>\n                  </RadioGroup>\n                )}\n                <RadioGroup\n                  value={shippingMethodId}\n                  onChange={(v) => handleSetShippingMethod(v, \"shipping\")}\n                >\n                  {_shippingMethods?.map((option) => {\n                    const isDisabled =\n                      option.price_type === \"calculated\" &&\n                      !isLoadingPrices &&\n                      typeof calculatedPricesMap[option.id] !== \"number\"\n\n                    return (\n                      <Radio\n                        key={option.id}\n                        value={option.id}\n                        data-testid=\"delivery-option-radio\"\n                        disabled={isDisabled}\n                        className={clx(\n                          \"flex items-center justify-between text-small-regular cursor-pointer py-4 border rounded-lg px-8 mb-2 transition-all duration-200\",\n                          {\n                            \"border-blue-500 bg-blue-50 ring-2 ring-blue-200\":\n                              option.id === shippingMethodId,\n                            \"border-gray-300 hover:border-gray-400 bg-white\":\n                              option.id !== shippingMethodId && !isDisabled,\n                            \"border-gray-200 bg-gray-50 cursor-not-allowed opacity-50\":\n                              isDisabled,\n                          }\n                        )}\n                      >\n                        <div className=\"flex items-center gap-x-4\">\n                          <MedusaRadio\n                            checked={option.id === shippingMethodId}\n                          />\n                          <span className=\"text-base-regular\">\n                            {option.name}\n                          </span>\n                        </div>\n                        <span className=\"justify-self-end text-ui-fg-base\">\n                          {option.price_type === \"flat\" ? (\n                            convertToLocale({\n                              amount: option.amount!,\n                              currency_code: cart?.currency_code,\n                            })\n                          ) : calculatedPricesMap[option.id] ? (\n                            convertToLocale({\n                              amount: calculatedPricesMap[option.id],\n                              currency_code: cart?.currency_code,\n                            })\n                          ) : isLoadingPrices ? (\n                            <Loader />\n                          ) : (\n                            \"-\"\n                          )}\n                        </span>\n                      </Radio>\n                    )\n                  })}\n                </RadioGroup>\n              </div>\n            </div>\n          </div>\n\n          {showPickupOptions === PICKUP_OPTION_ON && (\n            <div className=\"grid\">\n              <div className=\"flex flex-col\">\n                <span className=\"font-medium txt-medium text-ui-fg-base\">\n                  門市取貨\n                </span>\n                <span className=\"mb-4 text-ui-fg-muted txt-medium\">\n                  選擇距離您最近的門市\n                </span>\n              </div>\n              <div data-testid=\"delivery-options-container\">\n                <div className=\"pb-8 md:pt-0 pt-2\">\n                  <RadioGroup\n                    value={shippingMethodId}\n                    onChange={(v) => handleSetShippingMethod(v, \"pickup\")}\n                  >\n                    {_pickupMethods?.map((option) => {\n                      return (\n                        <Radio\n                          key={option.id}\n                          value={option.id}\n                          disabled={option.insufficient_inventory}\n                          data-testid=\"delivery-option-radio\"\n                          className={clx(\n                            \"flex items-center justify-between text-small-regular cursor-pointer py-4 border rounded-rounded px-8 mb-2 hover:shadow-borders-interactive-with-active\",\n                            {\n                              \"border-ui-border-interactive\":\n                                option.id === shippingMethodId,\n                              \"hover:shadow-brders-none cursor-not-allowed\":\n                                option.insufficient_inventory,\n                            }\n                          )}\n                        >\n                          <div className=\"flex items-start gap-x-4\">\n                            <MedusaRadio\n                              checked={option.id === shippingMethodId}\n                            />\n                            <div className=\"flex flex-col\">\n                              <span className=\"text-base-regular\">\n                                {option.name}\n                              </span>\n                              <span className=\"text-base-regular text-ui-fg-muted\">\n                                {formatAddress(\n                                  (option as any).service_zone?.fulfillment_set?.location\n                                    ?.address\n                                )}\n                              </span>\n                            </div>\n                          </div>\n                          <span className=\"justify-self-end text-ui-fg-base\">\n                            {convertToLocale({\n                              amount: option.amount!,\n                              currency_code: cart?.currency_code,\n                            })}\n                          </span>\n                        </Radio>\n                      )\n                    })}\n                  </RadioGroup>\n                </div>\n              </div>\n            </div>\n          )}\n\n          <div>\n            <ErrorMessage\n              error={error}\n              data-testid=\"delivery-option-error-message\"\n            />\n            <Button\n              size=\"large\"\n              className=\"mt\"\n              onClick={handleSubmit}\n              isLoading={isLoading}\n              disabled={\n                !cart.shipping_methods?.[0] || \n                !_shippingMethods || \n                _shippingMethods.length === 0\n              }\n              data-testid=\"submit-delivery-option-button\"\n            >\n              繼續付款\n            </Button>\n          </div>\n        </>\n      ) : (\n        <div>\n          <div className=\"text-small-regular\">\n            {cart && (cart.shipping_methods?.length ?? 0) > 0 && (\n              <div className=\"flex flex-col w-1/3\">\n                <Text className=\"txt-medium-plus text-ui-fg-base mb-1\">\n                  配送方式\n                </Text>\n                <Text className=\"txt-medium text-ui-fg-subtle\">\n                  {cart.shipping_methods?.at(-1)?.name}{\" \"}\n                  {convertToLocale({\n                    amount: cart.shipping_methods?.at(-1)?.amount || 0,\n                    currency_code: cart?.currency_code,\n                  })}\n                </Text>\n              </div>\n            )}\n          </div>\n        </div>\n      )}\n      <Divider className=\"mt-8\" />\n    </div>\n  )\n}\n\nexport default Shipping\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(checkout)/checkout/components/submit-button/index.tsx","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":26,"column":24,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":26,"endColumn":26,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[561,563],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { Button } from \"@medusajs/ui\"\nimport React from \"react\"\nimport { useFormStatus } from \"react-dom\"\n\nexport function SubmitButton({\n  children,\n  variant = \"primary\",\n  className,\n  \"data-testid\": dataTestId,\n}: {\n  children: React.ReactNode\n  variant?: \"primary\" | \"secondary\" | \"transparent\" | \"danger\" | null\n  className?: string\n  \"data-testid\"?: string\n}) {\n  const { pending } = useFormStatus()\n\n  return (\n    <Button\n      size=\"large\"\n      className={className}\n      type=\"submit\"\n      isLoading={pending}\n      variant={variant || \"primary\"}\n      data-testid={dataTestId}\n    >\n      {children}\n    </Button>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(checkout)/checkout/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'HttpTypes' is defined but never used.","line":3,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":19},{"ruleId":"unused-imports/no-unused-imports","severity":2,"message":"'HttpTypes' is defined but never used.","line":3,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":19,"fix":{"range":[100,144],"text":""}},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":15,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":15,"endColumn":18,"suggestions":[{"fix":{"range":[460,506],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":24,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":24,"endColumn":18,"suggestions":[{"fix":{"range":[644,694],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import { retrieveCart } from \"@lib/data/cart\"\nimport { retrieveCustomer } from \"@lib/data/customer\"\nimport { HttpTypes } from \"@medusajs/types\"\nimport CheckoutTemplate from \"@modules/checkout/templates\"\nimport { Metadata } from \"next\"\nimport { notFound } from \"next/navigation\"\n\nexport const metadata: Metadata = {\n  title: \"結帳\",\n  description: \"安全結帳流程\",\n}\n\nexport default async function Checkout() {\n  const cart = await retrieveCart().catch((error) => {\n    console.error(\"Error retrieving cart:\", error)\n    return notFound()\n  })\n\n  if (!cart) {\n    return notFound()\n  }\n\n  const customer = await retrieveCustomer().catch((error) => {\n    console.error(\"Error retrieving customer:\", error)\n    return null\n  })\n\n  return (\n    <CheckoutTemplate cart={cart} customer={customer} />\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(checkout)/checkout/templates/checkout-form/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(checkout)/checkout/templates/checkout-summary/index.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":8,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[342,345],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[342,345],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Heading } from \"@medusajs/ui\"\n\nimport ItemsPreviewTemplate from \"@modules/cart/templates/preview\"\nimport DiscountCode from \"@modules/checkout/components/discount-code\"\nimport CartTotals from \"@modules/common/components/cart-totals\"\nimport Divider from \"@modules/common/components/divider\"\n\nconst CheckoutSummary = ({ cart }: { cart: any }) => {\n  return (\n    <div className=\"sticky top-0 flex flex-col-reverse small:flex-col gap-y-8 py-8 small:py-0 \">\n      <div className=\"w-full bg-white flex flex-col\">\n        <Divider className=\"my-6 small:hidden\" />\n        <Heading\n          level=\"h2\"\n          className=\"flex flex-row text-3xl-regular items-baseline\"\n        >\n          In your Cart\n        </Heading>\n        <Divider className=\"my-6\" />\n        <CartTotals totals={cart} />\n        <ItemsPreviewTemplate cart={cart} />\n        <div className=\"my-6\">\n          <DiscountCode cart={cart} />\n        </div>\n      </div>\n    </div>\n  )\n}\n\nexport default CheckoutSummary\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(checkout)/layout.tsx","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":15,"column":52,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":15,"endColumn":54,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[470,525],"text":"(headerData?.logoSize?.desktop ?? headerData?.logoHeight)"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":15,"column":78,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":15,"endColumn":80,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[526,528],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":44,"column":26,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":44,"endColumn":46},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":45,"column":46,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":45,"endColumn":48,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1688,1690],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":50,"column":64,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":50,"endColumn":66,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1968,1970],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":57,"column":26,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":57,"endColumn":46},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":58,"column":46,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":58,"endColumn":48,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2251,2253],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":60,"column":58,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":60,"endColumn":60,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2357,2359],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":63,"column":63,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":63,"endColumn":65,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2548,2550],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":71,"column":42,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":71,"endColumn":44,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2818,2820],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import LocalizedClientLink from \"@/modules/common/components/localized-client-link\"\nimport ChevronDown from \"@/modules/common/icons/chevron-down\"\nimport Image from \"next/image\"\nimport { getHeader } from \"@/lib/sanity\"\nimport { SanityHeader } from \"@/types/global\"\n\nexport default async function CheckoutLayout({\n  children,\n}: {\n  children: React.ReactNode\n}) {\n  const headerData = await getHeader() as SanityHeader\n  \n  // 與首頁 nav 保持一致的 logo 高度計算\n  const logoHeight = headerData?.logoSize?.desktop || headerData?.logoHeight || 36\n\n  return (\n    <div className=\"w-full bg-white relative small:min-h-screen\">\n      <div className=\"h-16 bg-white border-b border-ui-border-base\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-full\">\n          <div className=\"flex items-center justify-between h-full\">\n            {/* 左側 - 返回購物車 */}\n            <LocalizedClientLink\n              href=\"/cart\"\n              className=\"flex items-center gap-x-2 text-ui-fg-base hover:text-ui-fg-base transition-colors\"\n              data-testid=\"back-to-cart-link\"\n            >\n              <ChevronDown className=\"rotate-90\" size={16} />\n              <span className=\"text-sm font-medium\">\n                返回購物車\n              </span>\n            </LocalizedClientLink>\n\n            {/* 中間 - Logo */}\n            <LocalizedClientLink\n              href=\"/\"\n              className=\"flex items-center justify-center\"\n              data-testid=\"store-link\"\n            >\n              {headerData?.logo?.url ? (\n                <>\n                  {/* Desktop Logo */}\n                  <Image\n                    src={headerData.logo.url!}\n                    alt={headerData.logo.alt || \"Store logo\"}\n                    width={200}\n                    height={logoHeight}\n                    className=\"w-auto object-contain transition-all duration-300 hidden md:block\"\n                    style={{ \n                      height: `${headerData?.logoSize?.desktop || logoHeight}px`,\n                      width: 'auto'\n                    }}\n                    priority\n                  />\n                  {/* Mobile Logo */}\n                  <Image\n                    src={headerData.logo.url!}\n                    alt={headerData.logo.alt || \"Store logo\"}\n                    width={200}\n                    height={headerData?.logoSize?.mobile || 28}\n                    className=\"w-auto object-contain transition-all duration-300 md:hidden\"\n                    style={{ \n                      height: `${headerData?.logoSize?.mobile || 28}px`,\n                      width: 'auto'\n                    }}\n                    priority\n                  />\n                </>\n              ) : (\n                <span className=\"text-xl font-bold text-ui-fg-base\">\n                  {headerData?.storeName || \"Medusa Store\"}\n                </span>\n              )}\n            </LocalizedClientLink>\n\n            {/* 右側 - 空白區域用於平衡佈局 */}\n            <div className=\"w-24\"></div>\n          </div>\n        </div>\n      </div>\n      <div className=\"relative\" data-testid=\"checkout-container\">{children}</div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(checkout)/not-found.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(main)/[...slug]/page.tsx","messages":[{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":74,"column":9,"nodeType":null,"messageId":"preferOptionalChain","endLine":74,"endColumn":45,"fix":{"range":[1864,1900],"text":"page?.status !== 'published'"}},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":82,"column":28,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":82,"endColumn":30,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2016,2043],"text":"(page.seoTitle ?? page.title)"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":82,"column":42,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":82,"endColumn":44,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2044,2046],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":83,"column":40,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":83,"endColumn":42,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2092,2094],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":87,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":87,"endColumn":18,"suggestions":[{"fix":{"range":[2225,2259],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":169,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":169,"endColumn":18,"suggestions":[{"fix":{"range":[4250,4301],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":175,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":175,"endColumn":18,"suggestions":[{"fix":{"range":[4405,4559],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":184,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":184,"endColumn":16,"suggestions":[{"fix":{"range":[4640,4867],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":201,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":201,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5248,5251],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5248,5251],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":209,"column":49,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":209,"endColumn":51,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[5523,5525],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":211,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":211,"endColumn":24,"suggestions":[{"fix":{"range":[5567,5600],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":223,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":223,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5812,5815],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5812,5815],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":224,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":224,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5871,5874],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5871,5874],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":224,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":224,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5879,5882],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5879,5882],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":224,"column":50,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":224,"endColumn":52,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[5896,5898],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":224,"column":67,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":224,"endColumn":69,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[5913,5915],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":225,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":225,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5948,5951],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5948,5951],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":246,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":246,"endColumn":18,"suggestions":[{"fix":{"range":[6496,6527],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":253,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":253,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6611,6614],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6611,6614],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":254,"column":32,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":254,"endColumn":34,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[6664,6666],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":255,"column":48,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":255,"endColumn":50,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[6717,6719],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":257,"column":3,"nodeType":"MemberExpression","messageId":"unexpected","endLine":257,"endColumn":14,"suggestions":[{"fix":{"range":[6728,6834],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":264,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":264,"endColumn":18,"suggestions":[{"fix":{"range":[6908,6971],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":272,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":272,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7127,7130],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7127,7130],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":273,"column":30,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":273,"endColumn":32,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[7167,7169],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":274,"column":36,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":274,"endColumn":38,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[7209,7211],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":275,"column":40,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":275,"endColumn":42,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[7255,7257],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":276,"column":46,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":276,"endColumn":48,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[7307,7309],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":277,"column":38,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":277,"endColumn":40,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[7351,7353],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":278,"column":44,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":278,"endColumn":46,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[7401,7403],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":279,"column":34,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":279,"endColumn":36,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[7441,7443],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":298,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":298,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7848,7851],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7848,7851],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":299,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":299,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7922,7925],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7922,7925],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":301,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":301,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7989,7992],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7989,7992],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":304,"column":45,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":304,"endColumn":47,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[8101,8103],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":305,"column":37,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":305,"endColumn":39,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[8144,8146],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":308,"column":7,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":308,"endColumn":9,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[8184,8186],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":313,"column":33,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":313,"endColumn":35,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[8299,8301],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":314,"column":41,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":314,"endColumn":43,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[8346,8348],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":321,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":321,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8447,8450],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8447,8450],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":325,"column":33,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":325,"endColumn":35,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[8568,8570],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":326,"column":33,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":326,"endColumn":35,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[8607,8609],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":328,"column":42,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":328,"endColumn":44,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[8687,8689],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":329,"column":34,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":329,"endColumn":36,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[8727,8729],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":331,"column":31,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":331,"endColumn":33,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[8784,8786],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":333,"column":46,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":333,"endColumn":48,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[8880,8882],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":334,"column":38,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":334,"endColumn":40,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[8924,8926],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":337,"column":47,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":337,"endColumn":49,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[9039,9041],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":338,"column":39,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":338,"endColumn":41,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[9084,9086],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":340,"column":41,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":340,"endColumn":43,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[9151,9153],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":341,"column":43,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":341,"endColumn":45,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[9200,9202],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":342,"column":37,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":342,"endColumn":39,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[9243,9245],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":349,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":349,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9324,9327],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9324,9327],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":355,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":355,"endColumn":18,"suggestions":[{"fix":{"range":[9479,9538],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":361,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":361,"endColumn":17,"suggestions":[{"fix":{"range":[9639,9708],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":366,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":366,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9793,9796],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9793,9796],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":371,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":371,"endColumn":18,"suggestions":[{"fix":{"range":[9896,9961],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":379,"column":17,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":379,"endColumn":24},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":384,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":384,"endColumn":18,"suggestions":[{"fix":{"range":[10199,10257],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":390,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":390,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10333,10336],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10333,10336],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":393,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":393,"endColumn":17,"suggestions":[{"fix":{"range":[10435,10515],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":408,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":408,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10764,10767],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10764,10767],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":415,"column":36,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":415,"endColumn":38,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[10974,10976],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":419,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":419,"endColumn":16,"suggestions":[{"fix":{"range":[11032,11121],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":438,"column":35,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":438,"endColumn":37,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[11672,11674],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":439,"column":41,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":439,"endColumn":43,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[11719,11721],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":440,"column":35,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":440,"endColumn":37,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[11760,11762],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":441,"column":47,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":441,"endColumn":49,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[11812,11814],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":466,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":466,"endColumn":21,"suggestions":[{"fix":{"range":[12549,12599],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":470,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":470,"endColumn":18,"suggestions":[{"fix":{"range":[12650,12711],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":38,"fatalErrorCount":0,"warningCount":32,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import { notFound } from 'next/navigation'\nimport { client } from '@/sanity-client'\nimport { Metadata } from 'next'\nimport SimplePageRenderer from '@/components/grapesjs/SimplePageRenderer'\nimport { urlForImage } from '@lib/sanity-utils/image'\n\n// 導入模組組件\nimport HeroSection from \"@modules/home/components/hero-section\"\nimport ServiceCardsSection from \"@modules/home/components/service-cards-section\"\nimport ImageTextBlock from \"@modules/home/components/image-text-block\"\nimport FeaturedProducts from \"@modules/home/components/featured-products\"\nimport BlogPosts from \"@modules/blog/components/blog-posts\"\nimport YoutubeSection from \"@modules/home/components/youtube-section\"\nimport ContentSection from \"@modules/home/components/content-section\"\n\n// 導入類型\nimport type { \n  MainBanner \n} from '@lib/types/page-sections'\nimport { listCollections } from '@lib/data/collections'\nimport { getRegion } from '@lib/data/regions'\nimport type { HttpTypes } from '@medusajs/types'\n\n// 已知的系統路由，這些路由不應該被 GrapesJS 頁面處理\nconst SYSTEM_ROUTES = [\n  'account',\n  'affiliate',\n  'affiliate-admin', \n  'blog',\n  'cart',\n  'categories',\n  'collections',\n  'login-affiliate',\n  'order',\n  'products',\n  'regitster-affiliate',\n  'store',\n  'test-footer',\n  // 管理相關路由\n  'pages-manager',\n  'cms',\n  // 其他系統路由\n  'checkout',\n  'admin',\n  'api'\n]\n\ninterface PageProps {\n  params: Promise<{\n    countryCode: string\n    slug: string[]\n  }>\n}\n\n// 動態生成頁面元數據\nexport async function generateMetadata({ params }: PageProps): Promise<Metadata> {\n  const { slug } = await params\n  \n  // 將 slug 數組轉換為字符串，處理多層路由\n  const slugString = slug.join('/')\n  \n  try {\n    const page = await client.fetch(\n      `*[_type == \"grapesJSPageV2\" && slug.current == $slug][0] {\n        title,\n        status,\n        seoTitle,\n        seoDescription,\n        seoKeywords\n      }`,\n      { slug: slugString }\n    )\n\n    if (!page || page.status !== 'published') {\n      return {\n        title: '頁面未找到',\n        description: '請求的頁面不存在'\n      }\n    }\n\n    return {\n      title: page.seoTitle || page.title || '頁面',\n      description: page.seoDescription || '使用 GrapesJS 編輯器創建的頁面',\n      keywords: page.seoKeywords ? page.seoKeywords.join(', ') : undefined,\n    }\n  } catch (error) {\n    console.error('生成頁面元數據失敗:', error)\n    return {\n      title: '頁面',\n      description: '頁面內容'\n    }\n  }\n}\n\n// 主頁面組件\nexport default async function CountryCodeCatchAllPage({ params }: PageProps) {\n  const { countryCode, slug } = await params\n  \n  // 將 slug 數組轉換為字符串\n  const slugString = slug.join('/')\n  \n  // 檢查第一個路由段是否為系統路由\n  const firstSegment = slug[0]\n  if (SYSTEM_ROUTES.includes(firstSegment)) {\n    notFound()\n  }\n  \n  try {\n    // 從 Sanity 獲取頁面數據\n    const page = await client.fetch(\n      `*[_type == \"grapesJSPageV2\" && slug.current == $slug][0] {\n        _id,\n        title,\n        slug,\n        status,\n        grapesHtml,\n        grapesCss,\n        grapesComponents,\n        grapesStyles,\n        \"homeModules\": homeModules[] {\n          _type,\n          moduleType,\n          isActive,\n          order,\n          _type == \"mainBannerModule\" => {\n            _type,\n            moduleType,\n            isActive,\n            order,\n            \"slides\": settings.slides[] {\n              heading,\n              subheading,\n              \"desktopImage\": desktopImage.asset->url,\n              \"desktopImageAlt\": desktopImage.alt,\n              \"mobileImage\": mobileImage.asset->url,\n              \"mobileImageAlt\": mobileImage.alt,\n              buttonText,\n              buttonLink\n            },\n            \"bannerSettings\": settings.settings {\n              autoplay,\n              autoplaySpeed,\n              showArrows,\n              showDots\n            }\n          },\n          _type == \"contentSectionModule\" => {\n            _type,\n            moduleType,\n            isActive,\n            order,\n            \"settings\": {\n              \"title\": settings.title,\n              \"hideTitle\": settings.hideTitle,\n              \"content\": settings.content\n            }\n          },\n          _type != \"mainBannerModule\" && _type != \"contentSectionModule\" => {\n            settings\n          }\n        },\n        createdAt,\n        updatedAt\n      }`,\n      { slug: slugString }\n    )\n\n    if (!page) {\n      console.log(`頁面未找到: /${countryCode}/${slugString}`)\n      notFound()\n    }\n\n    // 檢查頁面發布狀態 - 只有已發布的頁面可以在前端顯示\n    if (page.status !== 'published') {\n      console.log(`頁面未發布，靜默返回404: /${countryCode}/${slugString}`, { \n        pageId: page._id, \n        status: page.status,\n        title: page.title \n      })\n      // 使用 notFound() 是 Next.js 的標準做法，錯誤信息是正常的內部機制\n      notFound()\n    }\n\n    console.log(`載入頁面: /${countryCode}/${slugString}`, { \n      pageId: page._id, \n      title: page.title,\n      status: page.status,\n      hasHomeModules: !!page.homeModules?.length,\n      hasGrapesHtml: !!page.grapesHtml \n    })\n\n    // 檢查是否有模組配置\n    const hasModules = page.homeModules && Array.isArray(page.homeModules) && page.homeModules.length > 0\n    \n    // 如果有模組配置，需要獲取額外的數據\n    let collections: HttpTypes.StoreCollection[] | null = null\n    let region: HttpTypes.StoreRegion | null = null\n    \n    if (hasModules) {\n      // 檢查是否需要商品收藏數據\n      const needsCollections = page.homeModules.some((module: any) => \n        module.moduleType === 'featuredProducts'\n      )\n      \n      if (needsCollections) {\n        try {\n          const collectionsData = await listCollections()\n          collections = collectionsData.collections\n          region = await getRegion(countryCode) || null\n        } catch (error) {\n          console.error('獲取商品數據失敗:', error)\n        }\n      }\n    }\n\n    // 渲染頁面內容\n    return (\n      <div>\n        {/* 渲染模組設定 */}\n        {hasModules && (\n          <div className=\"space-y-8\">\n            {page.homeModules\n              .filter((module: any) => module.isActive !== false)\n              .sort((a: any, b: any) => (a.order || 0) - (b.order || 0))\n              .map((module: any, index: number) => renderModule(module, index, collections, region))}\n          </div>\n        )}\n        \n        {/* 渲染 GrapesJS HTML 內容 */}\n        {page.grapesHtml && (\n          <SimplePageRenderer \n            htmlContent={page.grapesHtml} \n            cssContent={page.grapesCss}\n          />\n        )}\n        \n        {/* 如果沒有任何內容 */}\n        {!hasModules && !page.grapesHtml && (\n          <div className=\"container mx-auto px-4 py-8\">\n            <p>頁面內容為空</p>\n          </div>\n        )}\n      </div>\n    )\n  } catch (error) {\n    console.error('載入頁面失敗:', error)\n    notFound()\n  }\n}\n\n// 拆分模組渲染為更小的函數\n// 渲染主橫幅模組\nfunction renderMainBanner(module: any, index: number) {\n  const slides = module.slides || []\n  const bannerSettings = module.bannerSettings || {}\n  \n  console.log('🎯 MainBanner data:', { \n    slides, \n    bannerSettings, \n    moduleType: module._type,\n  })\n  \n  if (!slides || !Array.isArray(slides) || slides.length === 0) {\n    console.error(\"Invalid mainBanner module - no slides:\", module)\n    return null\n  }\n  \n  // 構建正確的 MainBanner 對象\n  const banner: MainBanner = {\n    _type: \"mainBanner\",\n    isActive: true,\n    slides: slides.map((slide: any) => ({\n      heading: slide.heading || '',\n      subheading: slide.subheading || '',\n      desktopImage: slide.desktopImage || '',\n      desktopImageAlt: slide.desktopImageAlt || '',\n      mobileImage: slide.mobileImage || '',\n      mobileImageAlt: slide.mobileImageAlt || '',\n      imageLink: slide.imageLink || ''\n    })),\n    settings: {\n      autoplay: bannerSettings.autoplay ?? true,\n      autoplaySpeed: bannerSettings.autoplaySpeed ?? 5,\n      showArrows: bannerSettings.showArrows ?? true,\n      showDots: bannerSettings.showDots ?? true\n    }\n  }\n  \n  return (\n    <HeroSection\n      key={`module-banner-${index}`}\n      banner={banner}\n    />\n  )\n}\n\n// 渲染服務卡片模組\nfunction renderServiceCardSection(settings: any, index: number) {\n  const processedCards = settings.cards?.map((card: any) => ({\n    ...card,\n    stylists: card.stylists?.map((stylist: any) => ({\n      ...stylist,\n      cardImage: stylist.cardImage ? {\n        url: urlForImage(stylist.cardImage) || '',\n        alt: stylist.cardImage?.alt || ''\n      } : undefined\n    }))\n  })) || []\n  \n  return (\n    <ServiceCardsSection\n      key={`module-service-${index}`}\n      heading={settings.heading || ''}\n      cardsPerRow={settings.cardsPerRow || 3}\n      cards={processedCards}\n    />\n  )\n}\n\n// 渲染圖文區塊模組\nfunction renderImageTextBlock(settings: any, index: number) {\n  return (\n    <ImageTextBlock\n      key={`module-image-${index}`}\n      heading={settings.heading || ''}\n      content={settings.content || ''}\n      image={settings.image ? {\n        url: urlForImage(settings.image) || '',\n        alt: settings.image?.alt || ''\n      } : undefined}\n      layout={settings.layout || 'left'}\n      leftImage={settings.leftImage ? {\n        url: urlForImage(settings.leftImage) || '',\n        alt: settings.leftImage?.alt || ''\n      } : undefined}\n      rightImage={settings.rightImage ? {\n        url: urlForImage(settings.rightImage) || '',\n        alt: settings.rightImage?.alt || ''\n      } : undefined}\n      leftContent={settings.leftContent || ''}\n      rightContent={settings.rightContent || ''}\n      hideTitle={settings.hideTitle || false}\n    />\n  )\n}\n\n// 渲染精選商品模組\nfunction renderFeaturedProducts(\n  settings: any, \n  index: number, \n  collections: HttpTypes.StoreCollection[] | null,\n  region: HttpTypes.StoreRegion | null\n) {\n  if (!settings.collection_id) {\n    console.error(\"Invalid featuredProducts module:\", settings)\n    return null\n  }\n\n  // 安全檢查 collections\n  if (!collections || !Array.isArray(collections)) {\n    console.warn(\"Featured products skipped - collections not available\")\n    return null\n  }\n\n  try {\n    const featuredCollections = collections.filter((c: any) =>\n      settings.collection_id === c.id\n    )\n\n    if (featuredCollections.length === 0) {\n      console.log(\"No matching collection found for featured products\")\n      return null\n    }\n\n    return (\n      <FeaturedProducts\n        key={`module-featured-${index}`}\n        collections={featuredCollections}\n        region={region!}\n        settings={settings}\n      />\n    )\n  } catch (error) {\n    console.error(\"Featured products rendering error:\", error)\n    return null\n  }\n}\n\n// 渲染內容區塊模組\nfunction renderContentSection(settings: any, index: number) {\n  // 檢查是否有內容\n  if (!settings.content || !Array.isArray(settings.content)) {\n    console.warn(\"Invalid contentSection module - missing content array:\", settings)\n    return null\n  }\n  \n  return (\n    <ContentSection\n      key={`module-content-${index}`}\n      heading={settings.hideTitle ? undefined : settings.title}\n      content={settings.content}\n    />\n  )\n}\n\n// 主要模組渲染函數\nfunction renderModule(\n  module: any, \n  index: number, \n  collections: HttpTypes.StoreCollection[] | null,\n  region: HttpTypes.StoreRegion | null\n) {\n  if (!module || module.isActive === false) return null\n\n  const settings = module.settings || {}\n  const moduleType = module.moduleType\n\n  try {\n    console.log(`🎯 Rendering module ${index}: ${moduleType}`, { isActive: module.isActive })\n    \n    switch (moduleType) {\n      case \"mainBanner\":\n        return renderMainBanner(module, index)\n      \n      case \"serviceCardSection\":\n        return renderServiceCardSection(settings, index)\n      \n      case \"imageTextBlock\":\n        return renderImageTextBlock(settings, index)\n      \n      case \"featuredProducts\":\n        return renderFeaturedProducts(settings, index, collections, region)\n      \n      case \"blogSection\":\n        return (\n          <BlogPosts \n            key={`module-blog-${index}`}\n            title={settings.title || ''}\n            category={settings.category || ''}\n            limit={settings.limit || 2}\n            postsPerRow={settings.postsPerRow || 3}\n          />\n        )\n      \n      case \"youtubeSection\":\n        return (\n          <YoutubeSection\n            key={`module-youtube-${index}`}\n            _type=\"youtubeSection\"\n            isActive={true}\n            heading={settings.heading}\n            description={settings.description}\n            videoUrl={settings.videoUrl}\n            videoMode={settings.videoMode}\n            youtubeSettings={settings.youtubeSettings}\n            uploadSettings={settings.uploadSettings}\n            videoSettings={settings.videoSettings}\n            fullWidth={settings.fullWidth ?? true}\n          />\n        )\n      \n      case \"contentSection\":\n        return renderContentSection(settings, index)\n      \n      default:\n        console.warn(`Unknown module type: ${moduleType}`)\n        return null\n    }\n  } catch (error) {\n    console.error(`Error rendering module ${moduleType}:`, error)\n    return null\n  }\n}\n\n// 生成靜態路徑（可選，用於預渲染）\n// 移除預產生的靜態參數，避免影響其他動態路由的建置\n// export async function generateStaticParams() { /* removed to force dynamic */ }\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(main)/affiliate-admin/analytics/page.tsx","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":75,"column":46,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":75,"endColumn":48,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1758,1760],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect } from 'react'\n\ntype AnalyticsData = {\n  overview: {\n    totalRevenue: number\n    totalCommission: number\n    totalOrders: number\n    averageOrderValue: number\n    conversionRate: number\n    topPerformingAffiliate: string\n  }\n  trends: {\n    date: string\n    revenue: number\n    orders: number\n    commission: number\n  }[]\n  topAffiliates: {\n    id: string\n    name: string\n    revenue: number\n    orders: number\n    commission: number\n    conversionRate: number\n  }[]\n  topProducts: {\n    productId: string\n    productName: string\n    orders: number\n    revenue: number\n  }[]\n}\n\nexport default function AffiliateAnalytics() {\n  const [data, setData] = useState<AnalyticsData | null>(null)\n  const [loading, setLoading] = useState(true)\n  const [error, setError] = useState<string | null>(null)\n  const [timeRange, setTimeRange] = useState<'7d' | '30d' | '90d' | '1y'>('30d')\n\n  useEffect(() => {\n    fetchAnalytics()\n  }, [timeRange])\n\n  const fetchAnalytics = async () => {\n    try {\n      setLoading(true)\n      const response = await fetch(`/api/affiliate-admin/analytics?range=${timeRange}`)\n      \n      if (!response.ok) {\n        throw new Error('獲取分析數據失敗')\n      }\n      \n      const analyticsData = await response.json()\n      setData(analyticsData)\n    } catch (err) {\n      setError(err instanceof Error ? err.message : '發生未知錯誤')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center py-12\">\n        <div className=\"text-gray-500\">載入中...</div>\n      </div>\n    )\n  }\n\n  if (error || !data) {\n    return (\n      <div className=\"rounded-lg bg-red-50 border border-red-200 p-4\">\n        <div className=\"text-red-800\">{error || '無法載入分析數據'}</div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <h2 className=\"text-xl font-medium text-gray-900\">數據分析</h2>\n        <div className=\"flex space-x-2\">\n          <button\n            onClick={() => setTimeRange('7d')}\n            className={`px-3 py-1 rounded-md text-sm ${\n              timeRange === '7d'\n                ? 'bg-blue-100 text-blue-800'\n                : 'bg-gray-100 text-gray-600 hover:bg-gray-200'\n            }`}\n          >\n            7天\n          </button>\n          <button\n            onClick={() => setTimeRange('30d')}\n            className={`px-3 py-1 rounded-md text-sm ${\n              timeRange === '30d'\n                ? 'bg-blue-100 text-blue-800'\n                : 'bg-gray-100 text-gray-600 hover:bg-gray-200'\n            }`}\n          >\n            30天\n          </button>\n          <button\n            onClick={() => setTimeRange('90d')}\n            className={`px-3 py-1 rounded-md text-sm ${\n              timeRange === '90d'\n                ? 'bg-blue-100 text-blue-800'\n                : 'bg-gray-100 text-gray-600 hover:bg-gray-200'\n            }`}\n          >\n            90天\n          </button>\n          <button\n            onClick={() => setTimeRange('1y')}\n            className={`px-3 py-1 rounded-md text-sm ${\n              timeRange === '1y'\n                ? 'bg-blue-100 text-blue-800'\n                : 'bg-gray-100 text-gray-600 hover:bg-gray-200'\n            }`}\n          >\n            1年\n          </button>\n        </div>\n      </div>\n\n      {/* 總覽統計 */}\n      <div className=\"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3\">\n        <StatCard\n          title=\"總營收\"\n          value={`$${data.overview.totalRevenue.toFixed(2)}`}\n          icon=\"💰\"\n          color=\"green\"\n        />\n        <StatCard\n          title=\"總佣金\"\n          value={`$${data.overview.totalCommission.toFixed(2)}`}\n          icon=\"💳\"\n          color=\"blue\"\n        />\n        <StatCard\n          title=\"總訂單\"\n          value={data.overview.totalOrders.toString()}\n          icon=\"📦\"\n          color=\"purple\"\n        />\n        <StatCard\n          title=\"平均訂單價值\"\n          value={`$${data.overview.averageOrderValue.toFixed(2)}`}\n          icon=\"📊\"\n          color=\"yellow\"\n        />\n        <StatCard\n          title=\"轉換率\"\n          value={`${(data.overview.conversionRate * 100).toFixed(2)}%`}\n          icon=\"📈\"\n          color=\"green\"\n        />\n        <StatCard\n          title=\"頂級聯盟商\"\n          value={data.overview.topPerformingAffiliate}\n          icon=\"🏆\"\n          color=\"gold\"\n        />\n      </div>\n\n      <div className=\"grid grid-cols-1 gap-6 lg:grid-cols-2\">\n        {/* 趨勢圖表 */}\n        <div className=\"bg-white rounded-lg border p-6\">\n          <h3 className=\"text-lg font-medium text-gray-900 mb-4\">營收趨勢</h3>\n          <div className=\"h-64 flex items-end justify-between space-x-2\">\n            {data.trends.slice(-7).map((trend, index) => {\n              const maxRevenue = Math.max(...data.trends.map(t => t.revenue))\n              const height = maxRevenue > 0 ? (trend.revenue / maxRevenue) * 200 : 0\n              \n              return (\n                <div key={index} className=\"flex-1 flex flex-col items-center\">\n                  <div\n                    className=\"bg-blue-500 w-full rounded-t\"\n                    style={{ height: `${height}px` }}\n                  />\n                  <div className=\"text-xs text-gray-500 mt-2\">\n                    {new Date(trend.date).toLocaleDateString('zh-TW', { \n                      month: 'short', \n                      day: 'numeric' \n                    })}\n                  </div>\n                  <div className=\"text-xs text-gray-700 font-medium\">\n                    ${trend.revenue.toFixed(0)}\n                  </div>\n                </div>\n              )\n            })}\n          </div>\n        </div>\n\n        {/* 頂級聯盟商 */}\n        <div className=\"bg-white rounded-lg border p-6\">\n          <h3 className=\"text-lg font-medium text-gray-900 mb-4\">頂級聯盟商</h3>\n          <div className=\"space-y-4\">\n            {data.topAffiliates.slice(0, 5).map((affiliate, index) => (\n              <div key={affiliate.id} className=\"flex items-center justify-between\">\n                <div className=\"flex items-center space-x-3\">\n                  <div className=\"flex-shrink-0 w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center\">\n                    <span className=\"text-sm font-medium text-gray-600\">#{index + 1}</span>\n                  </div>\n                  <div>\n                    <p className=\"text-sm font-medium text-gray-900\">{affiliate.name}</p>\n                    <p className=\"text-xs text-gray-500\">\n                      {affiliate.orders} 筆訂單 • {(affiliate.conversionRate * 100).toFixed(1)}% 轉換率\n                    </p>\n                  </div>\n                </div>\n                <div className=\"text-right\">\n                  <p className=\"text-sm font-medium text-gray-900\">${affiliate.commission.toFixed(2)}</p>\n                  <p className=\"text-xs text-gray-500\">${affiliate.revenue.toFixed(2)} 營收</p>\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n      </div>\n\n      {/* 熱門產品 */}\n      <div className=\"bg-white rounded-lg border p-6\">\n        <h3 className=\"text-lg font-medium text-gray-900 mb-4\">熱門產品</h3>\n        <div className=\"overflow-x-auto\">\n          <table className=\"min-w-full divide-y divide-gray-200\">\n            <thead>\n              <tr>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  產品\n                </th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  訂單數\n                </th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  營收\n                </th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  佔比\n                </th>\n              </tr>\n            </thead>\n            <tbody className=\"bg-white divide-y divide-gray-200\">\n              {data.topProducts.slice(0, 10).map((product) => {\n                const percentage = (product.revenue / data.overview.totalRevenue * 100).toFixed(1)\n                \n                return (\n                  <tr key={product.productId}>\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\n                      <div className=\"text-sm font-medium text-gray-900\">{product.productName}</div>\n                      <div className=\"text-sm text-gray-500\">{product.productId}</div>\n                    </td>\n                    <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n                      {product.orders}\n                    </td>\n                    <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n                      ${product.revenue.toFixed(2)}\n                    </td>\n                    <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\n                      {percentage}%\n                    </td>\n                  </tr>\n                )\n              })}\n            </tbody>\n          </table>\n        </div>\n      </div>\n    </div>\n  )\n}\n\nfunction StatCard({ \n  title, \n  value, \n  icon, \n  color = 'blue' \n}: { \n  title: string\n  value: string\n  icon: string\n  color?: 'blue' | 'green' | 'yellow' | 'purple' | 'gold'\n}) {\n  const colorClasses = {\n    blue: 'from-blue-50 to-blue-100 border-blue-200',\n    green: 'from-green-50 to-green-100 border-green-200',\n    yellow: 'from-yellow-50 to-yellow-100 border-yellow-200',\n    purple: 'from-purple-50 to-purple-100 border-purple-200',\n    gold: 'from-amber-50 to-amber-100 border-amber-200',\n  }\n\n  return (\n    <div className={`rounded-lg border bg-gradient-to-br ${colorClasses[color]} p-6`}>\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <p className=\"text-sm font-medium text-gray-600\">{title}</p>\n          <p className=\"text-2xl font-bold text-gray-900\">{value}</p>\n        </div>\n        <div className=\"text-2xl\">{icon}</div>\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(main)/affiliate-admin/commissions/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'showCreate' is defined but never used.","line":161,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":161,"endColumn":13},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'showCreate' is defined but never used. Allowed unused args must match /^_/u.","line":161,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":161,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'setShowCreate' is defined but never used.","line":162,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":162,"endColumn":16},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'setShowCreate' is defined but never used. Allowed unused args must match /^_/u.","line":162,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":162,"endColumn":16},{"ruleId":"no-alert","severity":2,"message":"Unexpected alert.","line":183,"column":7,"nodeType":"CallExpression","messageId":"unexpected","endLine":183,"endColumn":57},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'onRefresh' is defined but never used.","line":299,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":299,"endColumn":12},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'onRefresh' is defined but never used. Allowed unused args must match /^_/u.","line":299,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":299,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'showCreate' is defined but never used.","line":300,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":300,"endColumn":13},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'showCreate' is defined but never used. Allowed unused args must match /^_/u.","line":300,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":300,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'setShowCreate' is defined but never used.","line":301,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":301,"endColumn":16},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'setShowCreate' is defined but never used. Allowed unused args must match /^_/u.","line":301,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":301,"endColumn":16}],"suppressedMessages":[],"errorCount":11,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect } from 'react'\n\ntype CommissionRule = {\n  id: string\n  name: string\n  type: 'percentage' | 'fixed'\n  value: number\n  minOrderValue?: number\n  maxOrderValue?: number\n  productCategories?: string[]\n  isActive: boolean\n  createdAt: string\n  updatedAt: string\n}\n\ntype CommissionAdjustment = {\n  id: string\n  affiliateId: string\n  affiliateName: string\n  orderId: string\n  originalCommission: number\n  adjustedCommission: number\n  reason: string\n  createdAt: string\n  createdBy: string\n}\n\nexport default function AffiliateCommissions() {\n  const [rules, setRules] = useState<CommissionRule[]>([])\n  const [adjustments, setAdjustments] = useState<CommissionAdjustment[]>([])\n  const [loading, setLoading] = useState(true)\n  const [error, setError] = useState<string | null>(null)\n  const [activeTab, setActiveTab] = useState<'rules' | 'adjustments'>('rules')\n  const [showCreateRule, setShowCreateRule] = useState(false)\n  const [showCreateAdjustment, setShowCreateAdjustment] = useState(false)\n\n  useEffect(() => {\n    fetchData()\n  }, [])\n\n  const fetchData = async () => {\n    try {\n      setLoading(true)\n      \n      // 同時獲取規則和調整記錄\n      const [rulesResponse, adjustmentsResponse] = await Promise.all([\n        fetch('/api/affiliate-admin/commission-rules'),\n        fetch('/api/affiliate-admin/commission-adjustments')\n      ])\n      \n      if (!rulesResponse.ok || !adjustmentsResponse.ok) {\n        throw new Error('獲取佣金數據失敗')\n      }\n      \n      const [rulesData, adjustmentsData] = await Promise.all([\n        rulesResponse.json(),\n        adjustmentsResponse.json()\n      ])\n      \n      setRules(rulesData.rules)\n      setAdjustments(adjustmentsData.adjustments)\n    } catch (err) {\n      setError(err instanceof Error ? err.message : '發生未知錯誤')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center py-12\">\n        <div className=\"text-gray-500\">載入中...</div>\n      </div>\n    )\n  }\n\n  if (error) {\n    return (\n      <div className=\"rounded-lg bg-red-50 border border-red-200 p-4\">\n        <div className=\"text-red-800\">{error}</div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <h2 className=\"text-xl font-medium text-gray-900\">佣金管理</h2>\n        <div className=\"flex space-x-3\">\n          {activeTab === 'rules' && (\n            <button\n              onClick={() => setShowCreateRule(true)}\n              className=\"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700\"\n            >\n              新增規則\n            </button>\n          )}\n          {activeTab === 'adjustments' && (\n            <button\n              onClick={() => setShowCreateAdjustment(true)}\n              className=\"bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700\"\n            >\n              新增調整\n            </button>\n          )}\n        </div>\n      </div>\n\n      {/* 標籤切換 */}\n      <div className=\"border-b border-gray-200\">\n        <nav className=\"-mb-px flex space-x-8\">\n          <button\n            onClick={() => setActiveTab('rules')}\n            className={`whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm ${\n              activeTab === 'rules'\n                ? 'border-blue-500 text-blue-600'\n                : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n            }`}\n          >\n            佣金規則 ({rules.length})\n          </button>\n          <button\n            onClick={() => setActiveTab('adjustments')}\n            className={`whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm ${\n              activeTab === 'adjustments'\n                ? 'border-blue-500 text-blue-600'\n                : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n            }`}\n          >\n            手動調整 ({adjustments.length})\n          </button>\n        </nav>\n      </div>\n\n      {activeTab === 'rules' && (\n        <CommissionRulesTab \n          rules={rules} \n          onRefresh={fetchData}\n          showCreate={showCreateRule}\n          setShowCreate={setShowCreateRule}\n        />\n      )}\n\n      {activeTab === 'adjustments' && (\n        <CommissionAdjustmentsTab \n          adjustments={adjustments} \n          onRefresh={fetchData}\n          showCreate={showCreateAdjustment}\n          setShowCreate={setShowCreateAdjustment}\n        />\n      )}\n    </div>\n  )\n}\n\nfunction CommissionRulesTab({ \n  rules, \n  onRefresh,\n  showCreate,\n  setShowCreate\n}: { \n  rules: CommissionRule[]\n  onRefresh: () => void\n  showCreate: boolean\n  setShowCreate: (show: boolean) => void\n}) {\n  const handleToggleRule = async (ruleId: string, isActive: boolean) => {\n    try {\n      const response = await fetch(`/api/affiliate-admin/commission-rules/${ruleId}/toggle`, {\n        method: 'PATCH',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ isActive })\n      })\n\n      if (!response.ok) {\n        throw new Error('更新規則狀態失敗')\n      }\n\n      onRefresh()\n    } catch (err) {\n      alert(err instanceof Error ? err.message : '更新失敗')\n    }\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* 規則統計 */}\n      <div className=\"grid grid-cols-1 gap-6 sm:grid-cols-3\">\n        <div className=\"bg-white rounded-lg border p-6\">\n          <div className=\"text-sm font-medium text-gray-500\">總規則數</div>\n          <div className=\"text-2xl font-bold text-gray-900\">{rules.length}</div>\n        </div>\n        <div className=\"bg-white rounded-lg border p-6\">\n          <div className=\"text-sm font-medium text-gray-500\">啟用規則</div>\n          <div className=\"text-2xl font-bold text-green-600\">\n            {rules.filter(r => r.isActive).length}\n          </div>\n        </div>\n        <div className=\"bg-white rounded-lg border p-6\">\n          <div className=\"text-sm font-medium text-gray-500\">停用規則</div>\n          <div className=\"text-2xl font-bold text-gray-500\">\n            {rules.filter(r => !r.isActive).length}\n          </div>\n        </div>\n      </div>\n\n      {/* 規則列表 */}\n      <div className=\"bg-white rounded-lg border overflow-hidden\">\n        <div className=\"overflow-x-auto\">\n          <table className=\"min-w-full divide-y divide-gray-200\">\n            <thead className=\"bg-gray-50\">\n              <tr>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  規則名稱\n                </th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  類型\n                </th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  數值\n                </th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  條件\n                </th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  狀態\n                </th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  操作\n                </th>\n              </tr>\n            </thead>\n            <tbody className=\"bg-white divide-y divide-gray-200\">\n              {rules.map((rule) => (\n                <tr key={rule.id} className=\"hover:bg-gray-50\">\n                  <td className=\"px-6 py-4 whitespace-nowrap\">\n                    <div className=\"text-sm font-medium text-gray-900\">{rule.name}</div>\n                    <div className=\"text-sm text-gray-500\">{rule.id}</div>\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap\">\n                    <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${\n                      rule.type === 'percentage' \n                        ? 'bg-blue-100 text-blue-800' \n                        : 'bg-green-100 text-green-800'\n                    }`}>\n                      {rule.type === 'percentage' ? '百分比' : '固定金額'}\n                    </span>\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n                    {rule.type === 'percentage' ? `${rule.value}%` : `$${rule.value.toFixed(2)}`}\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\n                    <div>\n                      {rule.minOrderValue && `最小: $${rule.minOrderValue}`}\n                      {rule.maxOrderValue && `最大: $${rule.maxOrderValue}`}\n                    </div>\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap\">\n                    <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${\n                      rule.isActive\n                        ? 'bg-green-100 text-green-800'\n                        : 'bg-gray-100 text-gray-800'\n                    }`}>\n                      {rule.isActive ? '啟用' : '停用'}\n                    </span>\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium\">\n                    <button\n                      onClick={() => handleToggleRule(rule.id, !rule.isActive)}\n                      className={`${\n                        rule.isActive\n                          ? 'text-red-600 hover:text-red-900'\n                          : 'text-green-600 hover:text-green-900'\n                      }`}\n                    >\n                      {rule.isActive ? '停用' : '啟用'}\n                    </button>\n                  </td>\n                </tr>\n              ))}\n            </tbody>\n          </table>\n        </div>\n\n        {rules.length === 0 && (\n          <div className=\"text-center py-12\">\n            <div className=\"text-gray-500\">暫無佣金規則</div>\n          </div>\n        )}\n      </div>\n    </div>\n  )\n}\n\nfunction CommissionAdjustmentsTab({ \n  adjustments, \n  onRefresh,\n  showCreate,\n  setShowCreate\n}: { \n  adjustments: CommissionAdjustment[]\n  onRefresh: () => void\n  showCreate: boolean\n  setShowCreate: (show: boolean) => void\n}) {\n  return (\n    <div className=\"space-y-6\">\n      {/* 調整統計 */}\n      <div className=\"grid grid-cols-1 gap-6 sm:grid-cols-2\">\n        <div className=\"bg-white rounded-lg border p-6\">\n          <div className=\"text-sm font-medium text-gray-500\">調整次數</div>\n          <div className=\"text-2xl font-bold text-gray-900\">{adjustments.length}</div>\n        </div>\n        <div className=\"bg-white rounded-lg border p-6\">\n          <div className=\"text-sm font-medium text-gray-500\">調整總額</div>\n          <div className=\"text-2xl font-bold text-blue-600\">\n            ${adjustments.reduce((sum, adj) => sum + (adj.adjustedCommission - adj.originalCommission), 0).toFixed(2)}\n          </div>\n        </div>\n      </div>\n\n      {/* 調整列表 */}\n      <div className=\"bg-white rounded-lg border overflow-hidden\">\n        <div className=\"overflow-x-auto\">\n          <table className=\"min-w-full divide-y divide-gray-200\">\n            <thead className=\"bg-gray-50\">\n              <tr>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  調整資訊\n                </th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  會員\n                </th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  佣金變更\n                </th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  調整原因\n                </th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  調整時間\n                </th>\n              </tr>\n            </thead>\n            <tbody className=\"bg-white divide-y divide-gray-200\">\n              {adjustments.map((adjustment) => {\n                const difference = adjustment.adjustedCommission - adjustment.originalCommission\n                const isIncrease = difference > 0\n                \n                return (\n                  <tr key={adjustment.id} className=\"hover:bg-gray-50\">\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\n                      <div className=\"text-sm font-medium text-gray-900\">{adjustment.id}</div>\n                      <div className=\"text-sm text-gray-500\">訂單: {adjustment.orderId}</div>\n                    </td>\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\n                      <div className=\"text-sm font-medium text-gray-900\">{adjustment.affiliateName}</div>\n                      <div className=\"text-sm text-gray-500\">{adjustment.affiliateId}</div>\n                    </td>\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\n                      <div className=\"text-sm text-gray-900\">\n                        ${adjustment.originalCommission.toFixed(2)} → ${adjustment.adjustedCommission.toFixed(2)}\n                      </div>\n                      <div className={`text-sm font-medium ${\n                        isIncrease ? 'text-green-600' : 'text-red-600'\n                      }`}>\n                        {isIncrease ? '+' : ''}${difference.toFixed(2)}\n                      </div>\n                    </td>\n                    <td className=\"px-6 py-4\">\n                      <div className=\"text-sm text-gray-900 max-w-xs truncate\">\n                        {adjustment.reason}\n                      </div>\n                    </td>\n                    <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\n                      <div>{new Date(adjustment.createdAt).toLocaleString('zh-TW')}</div>\n                      <div className=\"text-xs\">by {adjustment.createdBy}</div>\n                    </td>\n                  </tr>\n                )\n              })}\n            </tbody>\n          </table>\n        </div>\n\n        {adjustments.length === 0 && (\n          <div className=\"text-center py-12\">\n            <div className=\"text-gray-500\">暫無調整記錄</div>\n          </div>\n        )}\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(main)/affiliate-admin/layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(main)/affiliate-admin/login/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(main)/affiliate-admin/members/page.tsx","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":79,"column":36,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":79,"endColumn":38,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2013,2015],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-alert","severity":2,"message":"Unexpected confirm.","line":125,"column":10,"nodeType":"CallExpression","messageId":"unexpected","endLine":125,"endColumn":40},{"ruleId":"no-alert","severity":2,"message":"Unexpected confirm.","line":141,"column":10,"nodeType":"CallExpression","messageId":"unexpected","endLine":141,"endColumn":48},{"ruleId":"no-alert","severity":2,"message":"Unexpected confirm.","line":162,"column":10,"nodeType":"CallExpression","messageId":"unexpected","endLine":162,"endColumn":52},{"ruleId":"no-alert","severity":2,"message":"Unexpected confirm.","line":194,"column":10,"nodeType":"CallExpression","messageId":"unexpected","endLine":194,"endColumn":60},{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":239,"column":6,"nodeType":null,"messageId":"preferOptionalChain","endLine":239,"endColumn":81,"fix":{"range":[6975,7050],"text":"app.website?.toLowerCase().includes(searchTerm.toLowerCase())"}},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":355,"column":75,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":355,"endColumn":77,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[11786,11788],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":359,"column":84,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":359,"endColumn":86,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[12028,12030],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":364,"column":38,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":364,"endColumn":40,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[12197,12199],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":470,"column":67,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":470,"endColumn":69,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[17075,17122],"text":"(application.created_at ?? application.appliedAt)"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":470,"column":92,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":470,"endColumn":94,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[17123,17125],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":496,"column":43,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":496,"endColumn":45,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[18233,18280],"text":"(application.website ?? application.social_media)"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":496,"column":71,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":496,"endColumn":73,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[18281,18283],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":13,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":1,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect, useTransition } from 'react'\nimport { Button, Badge, Input, Label } from '@medusajs/ui'\n\ninterface Member {\n  id: string\n  displayName: string\n  email: string\n  phone?: string\n  status: 'active' | 'pending' | 'suspended'\n  registeredAt: string\n  totalOrders?: number\n  totalRevenue?: number\n  totalCommission?: number\n  referralCode?: string\n  commissionRate?: number\n  website?: string\n  socialMedia?: string\n  lastActive?: string\n  description?: string\n}\n\ninterface Application {\n  id: string\n  name: string\n  email: string\n  phone?: string\n  appliedAt?: string\n  created_at?: string\n  website?: string\n  description?: string\n  social_media?: string\n  status?: string\n}\n\ntype TabType = 'approved' | 'applications'\n\nexport default function MembersPage() {\n  const [activeTab, setActiveTab] = useState<TabType>('approved')\n  const [members, setMembers] = useState<Member[]>([])\n  const [applications, setApplications] = useState<Application[]>([])\n  const [loading, setLoading] = useState(true)\n  const [error, setError] = useState('')\n  const [success, setSuccess] = useState('')\n  const [isPending, startTransition] = useTransition()\n  \n  // Search and filter states\n  const [searchTerm, setSearchTerm] = useState('')\n  const [selectedApplications, setSelectedApplications] = useState<Set<string>>(new Set())\n\n  useEffect(() => {\n    fetchMembers()\n    fetchApplications()\n  }, [])\n\n  useEffect(() => {\n    if (success) {\n      const timer = setTimeout(() => setSuccess(''), 3000)\n      return () => clearTimeout(timer)\n    }\n  }, [success])\n\n  useEffect(() => {\n    if (error) {\n      const timer = setTimeout(() => setError(''), 5000)\n      return () => clearTimeout(timer)\n    }\n  }, [error])\n\n  const fetchMembers = async () => {\n    try {\n      const response = await fetch('/api/affiliate-admin/members')\n      const data = await response.json()\n      \n      if (response.ok) {\n        setMembers(data.members)\n      } else {\n        throw new Error(data.error || '獲取會員列表失敗')\n      }\n    } catch (err) {\n      setError(err instanceof Error ? err.message : '獲取會員列表失敗')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const fetchApplications = async () => {\n    try {\n      const response = await fetch('/api/affiliate-admin/applications')\n      if (!response.ok) throw new Error('獲取申請列表失敗')\n      const data = await response.json()\n      setApplications(data.applications)\n    } catch (err) {\n      setError(err instanceof Error ? err.message : '獲取申請列表失敗')\n    }\n  }\n\n  const handleStatusChange = async (memberId: string, newStatus: 'active' | 'suspended') => {\n    try {\n      const response = await fetch(`/api/affiliate-admin/members/${memberId}/status`, {\n        method: 'PATCH',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({ status: newStatus }),\n      })\n\n      if (!response.ok) {\n        throw new Error('更新會員狀態失敗')\n      }\n\n      setMembers(prev => \n        prev.map(member => \n          member.id === memberId ? { ...member, status: newStatus } : member\n        )\n      )\n      setSuccess('會員狀態更新成功')\n    } catch (err) {\n      setError(err instanceof Error ? err.message : '更新狀態失敗')\n    }\n  }\n\n  const approveApplication = async (id: string, name: string) => {\n    if (!confirm(`確定要通過「${name}」的申請嗎？`)) return\n    \n    startTransition(async () => {\n      try {\n        const res = await fetch(`/api/affiliate-admin/applications/${id}/approve`, { method: 'POST' })\n        if (!res.ok) throw new Error('審核通過失敗')\n        setApplications(prev => prev.filter(app => app.id !== id))\n        setSuccess(`已通過「${name}」的申請`)\n        fetchMembers()\n      } catch (err) {\n        setError(err instanceof Error ? err.message : '審核通過失敗')\n      }\n    })\n  }\n\n  const rejectApplication = async (id: string, name: string) => {\n    if (!confirm(`確定要拒絕「${name}」的申請嗎？此操作無法撤銷。`)) return\n    \n    startTransition(async () => {\n      try {\n        const res = await fetch(`/api/affiliate-admin/applications/${id}/reject`, { method: 'POST' })\n        if (!res.ok) throw new Error('審核拒絕失敗')\n        setApplications(prev => prev.filter(app => app.id !== id))\n        setSuccess(`已拒絕「${name}」的申請`)\n      } catch (err) {\n        setError(err instanceof Error ? err.message : '審核拒絕失敗')\n      }\n    })\n  }\n\n  const handleBatchApprove = async () => {\n    const selectedCount = selectedApplications.size\n    if (selectedCount === 0) {\n      setError('請選擇要審核的申請')\n      return\n    }\n    \n    if (!confirm(`確定要通過選中的 ${selectedCount} 個申請嗎？`)) return\n    \n    startTransition(async () => {\n      try {\n        const promises = Array.from(selectedApplications).map(id =>\n          fetch(`/api/affiliate-admin/applications/${id}/approve`, { method: 'POST' })\n        )\n        \n        const results = await Promise.all(promises)\n        const failedCount = results.filter(r => !r.ok).length\n        \n        if (failedCount > 0) {\n          throw new Error(`${failedCount} 個申請審核失敗`)\n        }\n        \n        setApplications(prev => prev.filter(app => !selectedApplications.has(app.id)))\n        setSelectedApplications(new Set())\n        setSuccess(`已通過 ${selectedCount} 個申請`)\n        fetchMembers()\n      } catch (err) {\n        setError(err instanceof Error ? err.message : '批量審核失敗')\n      }\n    })\n  }\n\n  const handleBatchReject = async () => {\n    const selectedCount = selectedApplications.size\n    if (selectedCount === 0) {\n      setError('請選擇要拒絕的申請')\n      return\n    }\n    \n    if (!confirm(`確定要拒絕選中的 ${selectedCount} 個申請嗎？此操作無法撤銷。`)) return\n    \n    startTransition(async () => {\n      try {\n        const promises = Array.from(selectedApplications).map(id =>\n          fetch(`/api/affiliate-admin/applications/${id}/reject`, { method: 'POST' })\n        )\n        \n        const results = await Promise.all(promises)\n        const failedCount = results.filter(r => !r.ok).length\n        \n        if (failedCount > 0) {\n          throw new Error(`${failedCount} 個申請拒絕失敗`)\n        }\n        \n        setApplications(prev => prev.filter(app => !selectedApplications.has(app.id)))\n        setSelectedApplications(new Set())\n        setSuccess(`已拒絕 ${selectedCount} 個申請`)\n      } catch (err) {\n        setError(err instanceof Error ? err.message : '批量拒絕失敗')\n      }\n    })\n  }\n\n  const toggleSelectApplication = (id: string) => {\n    const newSelected = new Set(selectedApplications)\n    if (newSelected.has(id)) {\n      newSelected.delete(id)\n    } else {\n      newSelected.add(id)\n    }\n    setSelectedApplications(newSelected)\n  }\n\n  const toggleSelectAll = () => {\n    if (selectedApplications.size === filteredApplications.length) {\n      setSelectedApplications(new Set())\n    } else {\n      setSelectedApplications(new Set(filteredApplications.map(app => app.id)))\n    }\n  }\n\n  const filteredApplications = applications.filter(app =>\n    app.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    app.email.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    (app.website && app.website.toLowerCase().includes(searchTerm.toLowerCase()))\n  )\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center py-12\">\n        <div className=\"text-gray-500\">載入中...</div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <h2 className=\"text-xl font-medium text-gray-900\">會員管理</h2>\n        <div className=\"flex items-center space-x-4\">\n          <span className=\"text-sm text-gray-500\">\n            已通過會員: {members.length} | 待審申請: {applications.length}\n          </span>\n        </div>\n      </div>\n\n      {/* Success/Error Messages */}\n      {success && (\n        <div className=\"rounded-lg bg-green-50 border border-green-200 p-4\">\n          <div className=\"text-green-800\">{success}</div>\n        </div>\n      )}\n      \n      {error && (\n        <div className=\"rounded-lg bg-red-50 border border-red-200 p-4\">\n          <div className=\"text-red-800\">{error}</div>\n        </div>\n      )}\n\n      {/* Tab Navigation */}\n      <div className=\"bg-white rounded-lg border\">\n        <div className=\"border-b border-gray-200\">\n          <nav className=\"-mb-px flex\">\n            <button\n              onClick={() => setActiveTab('approved')}\n              className={`px-6 py-3 text-sm font-medium border-b-2 ${\n                activeTab === 'approved'\n                  ? 'border-blue-500 text-blue-600'\n                  : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n              }`}\n            >\n              已通過會員 ({members.length})\n            </button>\n            <button\n              onClick={() => setActiveTab('applications')}\n              className={`px-6 py-3 text-sm font-medium border-b-2 ${\n                activeTab === 'applications'\n                  ? 'border-blue-500 text-blue-600'\n                  : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n              }`}\n            >\n              待審申請 ({applications.length})\n            </button>\n          </nav>\n        </div>\n\n        {/* Approved Members Tab */}\n        {activeTab === 'approved' && (\n          <div className=\"p-6\">\n            {members.length === 0 ? (\n              <div className=\"text-center py-8 text-gray-500\">\n                尚無已通過的會員\n              </div>\n            ) : (\n              <div className=\"space-y-4\">\n                {members.map((member) => (\n                  <div key={member.id} className=\"border rounded-lg p-4 space-y-3\">\n                    <div className=\"flex items-start justify-between\">\n                      <div className=\"space-y-1\">\n                        <div className=\"flex items-center space-x-2\">\n                          <h3 className=\"font-medium text-gray-900\">{member.displayName}</h3>\n                          <Badge color={member.status === 'active' ? 'green' : 'red'}>\n                            {member.status === 'active' ? '正常' : '已停權'}\n                          </Badge>\n                        </div>\n                        <p className=\"text-sm text-gray-600\">{member.email}</p>\n                        {member.phone && (\n                          <p className=\"text-sm text-gray-600\">{member.phone}</p>\n                        )}\n                        <p className=\"text-xs text-gray-500\">\n                          加入時間：{new Date(member.registeredAt).toLocaleDateString('zh-TW')}\n                        </p>\n                      </div>\n                      <div className=\"flex space-x-2\">\n                        {member.status === 'active' ? (\n                          <Button\n                            variant=\"secondary\"\n                            size=\"small\"\n                            onClick={() => handleStatusChange(member.id, 'suspended')}\n                            className=\"text-red-600 border-red-200 hover:bg-red-50\"\n                          >\n                            停權\n                          </Button>\n                        ) : (\n                          <Button\n                            variant=\"secondary\"\n                            size=\"small\"\n                            onClick={() => handleStatusChange(member.id, 'active')}\n                            className=\"text-green-600 border-green-200 hover:bg-green-50\"\n                          >\n                            恢復\n                          </Button>\n                        )}\n                      </div>\n                    </div>\n\n                    {/* Member Stats */}\n                    <div className=\"grid grid-cols-2 gap-4 pt-2 border-t\">\n                      <div className=\"text-sm\">\n                        <span className=\"text-gray-500\">總訂單數：</span>\n                        <span className=\"font-medium\">{member.totalOrders || 0}</span>\n                      </div>\n                      <div className=\"text-sm\">\n                        <span className=\"text-gray-500\">累計佣金：</span>\n                        <span className=\"font-medium\">NT$ {(member.totalCommission || 0).toLocaleString()}</span>\n                      </div>\n                    </div>\n\n                    {/* Additional Info */}\n                    {(member.website || member.socialMedia) && (\n                      <div className=\"space-y-2 pt-2 border-t\">\n                        {member.website && (\n                          <div className=\"text-sm\">\n                            <span className=\"text-gray-500\">網站：</span>\n                            <a href={member.website} target=\"_blank\" rel=\"noopener noreferrer\" \n                               className=\"text-blue-600 hover:underline ml-1\">\n                              {member.website}\n                            </a>\n                          </div>\n                        )}\n                        {member.socialMedia && (\n                          <div className=\"text-sm\">\n                            <span className=\"text-gray-500\">社群媒體：</span>\n                            <div className=\"text-xs text-gray-600 mt-1\">\n                              {member.socialMedia}\n                            </div>\n                          </div>\n                        )}\n                      </div>\n                    )}\n                  </div>\n                ))}\n              </div>\n            )}\n          </div>\n        )}\n\n        {/* Applications Tab */}\n        {activeTab === 'applications' && (\n          <div className=\"p-6\">\n            {/* Search and Batch Actions */}\n            <div className=\"mb-6 space-y-4\">\n              <div className=\"flex items-center justify-between\">\n                <div className=\"flex-1 max-w-sm\">\n                  <Label htmlFor=\"search\" className=\"sr-only\">搜尋申請</Label>\n                  <Input\n                    id=\"search\"\n                    type=\"text\"\n                    placeholder=\"搜尋姓名、Email 或網站...\"\n                    value={searchTerm}\n                    onChange={(e: React.ChangeEvent<HTMLInputElement>) => setSearchTerm(e.target.value)}\n                    className=\"w-full\"\n                  />\n                </div>\n                \n                {selectedApplications.size > 0 && (\n                  <div className=\"flex space-x-2\">\n                    <Button\n                      onClick={handleBatchApprove}\n                      disabled={isPending}\n                      className=\"bg-green-600 hover:bg-green-700\"\n                    >\n                      批量通過 ({selectedApplications.size})\n                    </Button>\n                    <Button\n                      onClick={handleBatchReject}\n                      disabled={isPending}\n                      variant=\"secondary\"\n                      className=\"text-red-600 border-red-200 hover:bg-red-50\"\n                    >\n                      批量拒絕 ({selectedApplications.size})\n                    </Button>\n                  </div>\n                )}\n              </div>\n\n              {filteredApplications.length > 0 && (\n                <div className=\"flex items-center space-x-2\">\n                  <input\n                    type=\"checkbox\"\n                    checked={selectedApplications.size === filteredApplications.length && filteredApplications.length > 0}\n                    onChange={toggleSelectAll}\n                    className=\"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded\"\n                  />\n                  <span className=\"text-sm text-gray-600\">\n                    全選 ({selectedApplications.size}/{filteredApplications.length})\n                  </span>\n                </div>\n              )}\n            </div>\n\n            {/* Applications List */}\n            {filteredApplications.length === 0 ? (\n              <div className=\"text-center py-8 text-gray-500\">\n                {applications.length === 0 ? '尚無待審申請' : '找不到符合條件的申請'}\n              </div>\n            ) : (\n              <div className=\"space-y-4\">\n                {filteredApplications.map((application) => (\n                  <div key={application.id} className=\"border rounded-lg p-4 space-y-3\">\n                    <div className=\"flex items-start justify-between\">\n                      <div className=\"flex items-start space-x-3\">\n                        <input\n                          type=\"checkbox\"\n                          checked={selectedApplications.has(application.id)}\n                          onChange={() => toggleSelectApplication(application.id)}\n                          className=\"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded mt-1\"\n                        />\n                        <div className=\"space-y-1\">\n                          <h3 className=\"font-medium text-gray-900\">{application.name}</h3>\n                          <p className=\"text-sm text-gray-600\">{application.email}</p>\n                          {application.phone && (\n                            <p className=\"text-sm text-gray-600\">{application.phone}</p>\n                          )}\n                          <p className=\"text-xs text-gray-500\">\n                            申請時間：{new Date(application.created_at || application.appliedAt || '').toLocaleDateString('zh-TW')}\n                          </p>\n                        </div>\n                      </div>\n                      <div className=\"flex space-x-2\">\n                        <Button\n                          onClick={() => approveApplication(application.id, application.name)}\n                          disabled={isPending}\n                          size=\"small\"\n                          className=\"bg-green-600 hover:bg-green-700\"\n                        >\n                          通過\n                        </Button>\n                        <Button\n                          onClick={() => rejectApplication(application.id, application.name)}\n                          disabled={isPending}\n                          variant=\"secondary\"\n                          size=\"small\"\n                          className=\"text-red-600 border-red-200 hover:bg-red-50\"\n                        >\n                          拒絕\n                        </Button>\n                      </div>\n                    </div>\n\n                    {/* Application Details */}\n                    {(application.website || application.social_media || application.description) && (\n                      <div className=\"space-y-2 pt-3 border-t\">\n                        {application.website && (\n                          <div className=\"text-sm\">\n                            <span className=\"text-gray-500\">網站：</span>\n                            <a href={application.website} target=\"_blank\" rel=\"noopener noreferrer\" \n                               className=\"text-blue-600 hover:underline ml-1\">\n                              {application.website}\n                            </a>\n                          </div>\n                        )}\n                        {application.social_media && (\n                          <div className=\"text-sm\">\n                            <span className=\"text-gray-500\">社群媒體：</span>\n                            <div className=\"text-xs text-gray-600 mt-1\">\n                              {application.social_media}\n                            </div>\n                          </div>\n                        )}\n                        {application.description && (\n                          <div className=\"text-sm\">\n                            <span className=\"text-gray-500\">申請說明：</span>\n                            <p className=\"text-gray-700 mt-1\">{application.description}</p>\n                          </div>\n                        )}\n                      </div>\n                    )}\n                  </div>\n                ))}\n              </div>\n            )}\n          </div>\n        )}\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(main)/affiliate-admin/page.tsx","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":71,"column":46,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":71,"endColumn":48,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1682,1684],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect } from 'react'\n\ntype AdminOverviewData = {\n  summary: {\n    totalAffiliates: number\n    activeAffiliates: number\n    pendingAffiliates: number\n    totalCommission: number\n    totalSettled: number\n    pendingSettlement: number\n    thisMonthOrders: number\n    thisMonthRevenue: number\n  }\n  recentActivities: {\n    id: string\n    type: 'registration' | 'order' | 'settlement' | 'commission'\n    description: string\n    amount?: number\n    timestamp: string\n    affiliateId: string\n  }[]\n  topAffiliates: {\n    id: string\n    name: string\n    orders: number\n    revenue: number\n    commission: number\n  }[]\n}\n\nexport default function AffiliateAdminDashboard() {\n  const [data, setData] = useState<AdminOverviewData | null>(null)\n  const [loading, setLoading] = useState(true)\n  const [error, setError] = useState<string | null>(null)\n\n  useEffect(() => {\n    fetchOverviewData()\n  }, [])\n\n  const fetchOverviewData = async () => {\n    try {\n      setLoading(true)\n      const response = await fetch('/api/affiliate-admin/overview')\n      \n      if (!response.ok) {\n        throw new Error('獲取總覽數據失敗')\n      }\n      \n      const adminData = await response.json()\n      setData(adminData)\n    } catch (err) {\n      setError(err instanceof Error ? err.message : '發生未知錯誤')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center py-12\">\n        <div className=\"text-gray-500\">載入中...</div>\n      </div>\n    )\n  }\n\n  if (error || !data) {\n    return (\n      <div className=\"rounded-lg bg-red-50 border border-red-200 p-4\">\n        <div className=\"text-red-800\">{error || '無法載入數據'}</div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <h2 className=\"text-xl font-medium text-gray-900\">管理總覽</h2>\n\n      {/* 統計卡片 */}\n      <div className=\"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-4\">\n        <StatCard\n          title=\"聯盟會員總數\"\n          value={data.summary.totalAffiliates.toString()}\n          subtitle={`活躍: ${data.summary.activeAffiliates} | 待審: ${data.summary.pendingAffiliates}`}\n          icon=\"👥\"\n          color=\"blue\"\n        />\n        <StatCard\n          title=\"本月訂單\"\n          value={data.summary.thisMonthOrders.toString()}\n          subtitle={`營收: $${data.summary.thisMonthRevenue.toFixed(2)}`}\n          icon=\"📦\"\n          color=\"green\"\n        />\n        <StatCard\n          title=\"總佣金\"\n          value={`$${data.summary.totalCommission.toFixed(2)}`}\n          subtitle={`已結算: $${data.summary.totalSettled.toFixed(2)}`}\n          icon=\"💰\"\n          color=\"yellow\"\n        />\n        <StatCard\n          title=\"待結算\"\n          value={`$${data.summary.pendingSettlement.toFixed(2)}`}\n          subtitle=\"等待下次結算\"\n          icon=\"⏳\"\n          color=\"purple\"\n        />\n      </div>\n\n      <div className=\"grid grid-cols-1 gap-6 lg:grid-cols-2\">\n        {/* 最近活動 */}\n        <div className=\"bg-white rounded-lg border p-6\">\n          <h3 className=\"text-lg font-medium text-gray-900 mb-4\">最近活動</h3>\n          <div className=\"space-y-4\">\n            {data.recentActivities.slice(0, 5).map((activity) => (\n              <div key={activity.id} className=\"flex items-center space-x-3\">\n                <div className=\"flex-shrink-0\">\n                  <span className=\"text-lg\">\n                    {activity.type === 'registration' ? '👤' : \n                     activity.type === 'order' ? '📦' :\n                     activity.type === 'settlement' ? '💰' : '💳'}\n                  </span>\n                </div>\n                <div className=\"flex-1 min-w-0\">\n                  <p className=\"text-sm text-gray-900\">{activity.description}</p>\n                  <p className=\"text-xs text-gray-500\">\n                    {activity.affiliateId} • {new Date(activity.timestamp).toLocaleString('zh-TW')}\n                  </p>\n                </div>\n                {activity.amount && (\n                  <div className=\"text-sm font-medium text-green-600\">\n                    +${activity.amount.toFixed(2)}\n                  </div>\n                )}\n              </div>\n            ))}\n          </div>\n        </div>\n\n        {/* 頂級聯盟商 */}\n        <div className=\"bg-white rounded-lg border p-6\">\n          <h3 className=\"text-lg font-medium text-gray-900 mb-4\">頂級聯盟商</h3>\n          <div className=\"space-y-4\">\n            {data.topAffiliates.slice(0, 5).map((affiliate, index) => (\n              <div key={affiliate.id} className=\"flex items-center justify-between\">\n                <div className=\"flex items-center space-x-3\">\n                  <div className=\"flex-shrink-0 w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center\">\n                    <span className=\"text-sm font-medium text-gray-600\">#{index + 1}</span>\n                  </div>\n                  <div>\n                    <p className=\"text-sm font-medium text-gray-900\">{affiliate.name}</p>\n                    <p className=\"text-xs text-gray-500\">{affiliate.id}</p>\n                  </div>\n                </div>\n                <div className=\"text-right\">\n                  <p className=\"text-sm font-medium text-gray-900\">${affiliate.commission.toFixed(2)}</p>\n                  <p className=\"text-xs text-gray-500\">{affiliate.orders} 筆訂單</p>\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n      </div>\n\n      {/* 快速操作 */}\n      <div className=\"bg-white rounded-lg border p-6\">\n        <h3 className=\"text-lg font-medium text-gray-900 mb-4\">快速操作</h3>\n        <div className=\"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4\">\n          <QuickActionButton\n            href=\"/tw/affiliate-admin/settlements\"\n            icon=\"💰\"\n            title=\"執行結算\"\n            description=\"處理月度結算\"\n          />\n          <QuickActionButton\n            href=\"/tw/affiliate-admin/members\"\n            icon=\"👥\"\n            title=\"審核會員\"\n            description=\"審核待審會員\"\n          />\n          <QuickActionButton\n            href=\"/tw/affiliate-admin/commissions\"\n            icon=\"💳\"\n            title=\"調整佣金\"\n            description=\"管理佣金設定\"\n          />\n          <QuickActionButton\n            href=\"/tw/affiliate-admin/analytics\"\n            icon=\"📈\"\n            title=\"查看報表\"\n            description=\"詳細數據分析\"\n          />\n        </div>\n      </div>\n    </div>\n  )\n}\n\nfunction StatCard({ \n  title, \n  value, \n  subtitle, \n  icon, \n  color = 'blue' \n}: { \n  title: string\n  value: string\n  subtitle: string\n  icon: string\n  color?: 'blue' | 'green' | 'yellow' | 'purple'\n}) {\n  const colorClasses = {\n    blue: 'from-blue-50 to-blue-100 border-blue-200',\n    green: 'from-green-50 to-green-100 border-green-200',\n    yellow: 'from-yellow-50 to-yellow-100 border-yellow-200',\n    purple: 'from-purple-50 to-purple-100 border-purple-200',\n  }\n\n  return (\n    <div className={`rounded-lg border bg-gradient-to-br ${colorClasses[color]} p-6`}>\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <p className=\"text-sm font-medium text-gray-600\">{title}</p>\n          <p className=\"text-2xl font-bold text-gray-900\">{value}</p>\n          <p className=\"text-xs text-gray-500\">{subtitle}</p>\n        </div>\n        <div className=\"text-2xl\">{icon}</div>\n      </div>\n    </div>\n  )\n}\n\nfunction QuickActionButton({ \n  href, \n  icon, \n  title, \n  description \n}: { \n  href: string\n  icon: string\n  title: string\n  description: string\n}) {\n  return (\n    <a\n      href={href}\n      className=\"block p-4 border border-gray-200 rounded-lg hover:border-blue-300 hover:shadow-sm transition-all duration-200\"\n    >\n      <div className=\"text-2xl mb-2\">{icon}</div>\n      <h4 className=\"text-sm font-medium text-gray-900\">{title}</h4>\n      <p className=\"text-xs text-gray-500\">{description}</p>\n    </a>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(main)/affiliate-admin/settlements/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":15,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[349,352],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[349,352],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-alert","severity":2,"message":"Unexpected alert.","line":61,"column":7,"nodeType":"CallExpression","messageId":"unexpected","endLine":61,"endColumn":59},{"ruleId":"no-alert","severity":2,"message":"Unexpected alert.","line":70,"column":7,"nodeType":"CallExpression","messageId":"unexpected","endLine":70,"endColumn":24},{"ruleId":"no-alert","severity":2,"message":"Unexpected confirm.","line":74,"column":10,"nodeType":"CallExpression","messageId":"unexpected","endLine":74,"endColumn":63},{"ruleId":"no-alert","severity":2,"message":"Unexpected alert.","line":95,"column":7,"nodeType":"CallExpression","messageId":"unexpected","endLine":95,"endColumn":22},{"ruleId":"no-alert","severity":2,"message":"Unexpected alert.","line":97,"column":7,"nodeType":"CallExpression","messageId":"unexpected","endLine":97,"endColumn":59},{"ruleId":"sonarjs/no-duplicate-string","severity":2,"message":"Define a constant instead of duplicating this literal 5 times.","line":146,"column":19,"nodeType":"Literal","endLine":146,"endColumn":64}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect } from 'react'\n\ntype Settlement = {\n  id: string\n  affiliateId: string\n  affiliateName: string\n  period: string\n  amount: number\n  status: 'pending' | 'processing' | 'completed' | 'failed'\n  createdAt: string\n  processedAt?: string\n  paymentMethod: 'bank_transfer' | 'paypal' | 'stripe'\n  paymentDetails?: any\n}\n\nexport default function AffiliateSettlements() {\n  const [settlements, setSettlements] = useState<Settlement[]>([])\n  const [loading, setLoading] = useState(true)\n  const [error, setError] = useState<string | null>(null)\n  const [statusFilter, setStatusFilter] = useState<'all' | 'pending' | 'processing' | 'completed' | 'failed'>('all')\n  const [processing, setProcessing] = useState<string | null>(null)\n\n  useEffect(() => {\n    fetchSettlements()\n  }, [])\n\n  const fetchSettlements = async () => {\n    try {\n      setLoading(true)\n      const response = await fetch('/api/affiliate-admin/settlements')\n      \n      if (!response.ok) {\n        throw new Error('獲取結算列表失敗')\n      }\n      \n      const data = await response.json()\n      setSettlements(data.settlements)\n    } catch (err) {\n      setError(err instanceof Error ? err.message : '發生未知錯誤')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const handleProcessSettlement = async (settlementId: string) => {\n    try {\n      setProcessing(settlementId)\n      const response = await fetch(`/api/affiliate-admin/settlements/${settlementId}/process`, {\n        method: 'POST',\n      })\n\n      if (!response.ok) {\n        throw new Error('處理結算失敗')\n      }\n\n      // 重新獲取結算列表\n      await fetchSettlements()\n    } catch (err) {\n      alert(err instanceof Error ? err.message : '處理結算失敗')\n    } finally {\n      setProcessing(null)\n    }\n  }\n\n  const handleBatchProcess = async () => {\n    const pendingSettlements = filteredSettlements.filter(s => s.status === 'pending')\n    if (pendingSettlements.length === 0) {\n      alert('沒有待處理的結算')\n      return\n    }\n\n    if (!confirm(`確定要批量處理 ${pendingSettlements.length} 筆結算嗎？`)) {\n      return\n    }\n\n    try {\n      setProcessing('batch')\n      const response = await fetch('/api/affiliate-admin/settlements/batch-process', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          settlementIds: pendingSettlements.map(s => s.id)\n        }),\n      })\n\n      if (!response.ok) {\n        throw new Error('批量處理失敗')\n      }\n\n      await fetchSettlements()\n      alert('批量處理完成')\n    } catch (err) {\n      alert(err instanceof Error ? err.message : '批量處理失敗')\n    } finally {\n      setProcessing(null)\n    }\n  }\n\n  const filteredSettlements = settlements.filter(settlement => \n    statusFilter === 'all' || settlement.status === statusFilter\n  )\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center py-12\">\n        <div className=\"text-gray-500\">載入中...</div>\n      </div>\n    )\n  }\n\n  if (error) {\n    return (\n      <div className=\"rounded-lg bg-red-50 border border-red-200 p-4\">\n        <div className=\"text-red-800\">{error}</div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <h2 className=\"text-xl font-medium text-gray-900\">結算管理</h2>\n        <div className=\"flex items-center space-x-4\">\n          <button\n            onClick={handleBatchProcess}\n            disabled={processing === 'batch' || filteredSettlements.filter(s => s.status === 'pending').length === 0}\n            className=\"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed\"\n          >\n            {processing === 'batch' ? '處理中...' : '批量處理'}\n          </button>\n        </div>\n      </div>\n\n      {/* 狀態篩選 */}\n      <div className=\"bg-white rounded-lg border p-4\">\n        <div className=\"flex space-x-4\">\n          <button\n            onClick={() => setStatusFilter('all')}\n            className={`px-3 py-1 rounded-md text-sm ${\n              statusFilter === 'all'\n                ? 'bg-blue-100 text-blue-800'\n                : 'bg-gray-100 text-gray-600 hover:bg-gray-200'\n            }`}\n          >\n            全部 ({settlements.length})\n          </button>\n          <button\n            onClick={() => setStatusFilter('pending')}\n            className={`px-3 py-1 rounded-md text-sm ${\n              statusFilter === 'pending'\n                ? 'bg-yellow-100 text-yellow-800'\n                : 'bg-gray-100 text-gray-600 hover:bg-gray-200'\n            }`}\n          >\n            待處理 ({settlements.filter(s => s.status === 'pending').length})\n          </button>\n          <button\n            onClick={() => setStatusFilter('processing')}\n            className={`px-3 py-1 rounded-md text-sm ${\n              statusFilter === 'processing'\n                ? 'bg-blue-100 text-blue-800'\n                : 'bg-gray-100 text-gray-600 hover:bg-gray-200'\n            }`}\n          >\n            處理中 ({settlements.filter(s => s.status === 'processing').length})\n          </button>\n          <button\n            onClick={() => setStatusFilter('completed')}\n            className={`px-3 py-1 rounded-md text-sm ${\n              statusFilter === 'completed'\n                ? 'bg-green-100 text-green-800'\n                : 'bg-gray-100 text-gray-600 hover:bg-gray-200'\n            }`}\n          >\n            已完成 ({settlements.filter(s => s.status === 'completed').length})\n          </button>\n          <button\n            onClick={() => setStatusFilter('failed')}\n            className={`px-3 py-1 rounded-md text-sm ${\n              statusFilter === 'failed'\n                ? 'bg-red-100 text-red-800'\n                : 'bg-gray-100 text-gray-600 hover:bg-gray-200'\n            }`}\n          >\n            失敗 ({settlements.filter(s => s.status === 'failed').length})\n          </button>\n        </div>\n      </div>\n\n      {/* 結算統計 */}\n      <div className=\"grid grid-cols-1 gap-6 sm:grid-cols-3\">\n        <div className=\"bg-white rounded-lg border p-6\">\n          <div className=\"text-sm font-medium text-gray-500\">本月總結算金額</div>\n          <div className=\"text-2xl font-bold text-gray-900\">\n            ${settlements.reduce((sum, s) => sum + s.amount, 0).toFixed(2)}\n          </div>\n        </div>\n        <div className=\"bg-white rounded-lg border p-6\">\n          <div className=\"text-sm font-medium text-gray-500\">待處理金額</div>\n          <div className=\"text-2xl font-bold text-yellow-600\">\n            ${settlements.filter(s => s.status === 'pending').reduce((sum, s) => sum + s.amount, 0).toFixed(2)}\n          </div>\n        </div>\n        <div className=\"bg-white rounded-lg border p-6\">\n          <div className=\"text-sm font-medium text-gray-500\">已完成金額</div>\n          <div className=\"text-2xl font-bold text-green-600\">\n            ${settlements.filter(s => s.status === 'completed').reduce((sum, s) => sum + s.amount, 0).toFixed(2)}\n          </div>\n        </div>\n      </div>\n\n      {/* 結算列表 */}\n      <div className=\"bg-white rounded-lg border overflow-hidden\">\n        <div className=\"overflow-x-auto\">\n          <table className=\"min-w-full divide-y divide-gray-200\">\n            <thead className=\"bg-gray-50\">\n              <tr>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  結算資訊\n                </th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  會員\n                </th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  金額\n                </th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  收款方式\n                </th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  狀態\n                </th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  操作\n                </th>\n              </tr>\n            </thead>\n            <tbody className=\"bg-white divide-y divide-gray-200\">\n              {filteredSettlements.map((settlement) => (\n                <tr key={settlement.id} className=\"hover:bg-gray-50\">\n                  <td className=\"px-6 py-4 whitespace-nowrap\">\n                    <div>\n                      <div className=\"text-sm font-medium text-gray-900\">{settlement.id}</div>\n                      <div className=\"text-sm text-gray-500\">期間: {settlement.period}</div>\n                      <div className=\"text-xs text-gray-400\">\n                        建立: {new Date(settlement.createdAt).toLocaleString('zh-TW')}\n                      </div>\n                    </div>\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap\">\n                    <div>\n                      <div className=\"text-sm font-medium text-gray-900\">{settlement.affiliateName}</div>\n                      <div className=\"text-sm text-gray-500\">{settlement.affiliateId}</div>\n                    </div>\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap\">\n                    <div className=\"text-sm font-bold text-gray-900\">${settlement.amount.toFixed(2)}</div>\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap\">\n                    <PaymentMethodBadge method={settlement.paymentMethod} />\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap\">\n                    <SettlementStatusBadge status={settlement.status} />\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium\">\n                    {settlement.status === 'pending' && (\n                      <button\n                        onClick={() => handleProcessSettlement(settlement.id)}\n                        disabled={processing === settlement.id}\n                        className=\"text-blue-600 hover:text-blue-900 disabled:opacity-50\"\n                      >\n                        {processing === settlement.id ? '處理中...' : '處理'}\n                      </button>\n                    )}\n                    {settlement.status === 'completed' && settlement.processedAt && (\n                      <span className=\"text-xs text-gray-500\">\n                        已於 {new Date(settlement.processedAt).toLocaleDateString('zh-TW')} 完成\n                      </span>\n                    )}\n                  </td>\n                </tr>\n              ))}\n            </tbody>\n          </table>\n        </div>\n\n        {filteredSettlements.length === 0 && (\n          <div className=\"text-center py-12\">\n            <div className=\"text-gray-500\">暫無結算記錄</div>\n          </div>\n        )}\n      </div>\n    </div>\n  )\n}\n\nfunction SettlementStatusBadge({ status }: { status: Settlement['status'] }) {\n  const config = {\n    pending: { text: '待處理', className: 'bg-yellow-100 text-yellow-800' },\n    processing: { text: '處理中', className: 'bg-blue-100 text-blue-800' },\n    completed: { text: '已完成', className: 'bg-green-100 text-green-800' },\n    failed: { text: '失敗', className: 'bg-red-100 text-red-800' },\n  }\n\n  const { text, className } = config[status]\n\n  return (\n    <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${className}`}>\n      {text}\n    </span>\n  )\n}\n\nfunction PaymentMethodBadge({ method }: { method: Settlement['paymentMethod'] }) {\n  const config = {\n    bank_transfer: { text: '銀行轉帳', className: 'bg-blue-100 text-blue-800' },\n    paypal: { text: 'PayPal', className: 'bg-yellow-100 text-yellow-800' },\n    stripe: { text: 'Stripe', className: 'bg-purple-100 text-purple-800' },\n  }\n\n  const { text, className } = config[method]\n\n  return (\n    <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${className}`}>\n      {text}\n    </span>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(main)/affiliate/layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(main)/affiliate/links/components.tsx","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":62,"column":46,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":62,"endColumn":48,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1601,1603],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-alert","severity":2,"message":"Unexpected alert.","line":63,"column":9,"nodeType":"CallExpression","messageId":"unexpected","endLine":63,"endColumn":28},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":66,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":66,"endColumn":20,"suggestions":[{"fix":{"range":[1698,1742],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-alert","severity":2,"message":"Unexpected alert.","line":67,"column":7,"nodeType":"CallExpression","messageId":"unexpected","endLine":67,"endColumn":53},{"ruleId":"no-alert","severity":2,"message":"Unexpected alert.","line":160,"column":9,"nodeType":"CallExpression","messageId":"unexpected","endLine":160,"endColumn":22},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":163,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":163,"endColumn":20,"suggestions":[{"fix":{"range":[4255,4299],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-alert","severity":2,"message":"Unexpected alert.","line":164,"column":7,"nodeType":"CallExpression","messageId":"unexpected","endLine":164,"endColumn":23},{"ruleId":"no-alert","severity":2,"message":"Unexpected alert.","line":172,"column":7,"nodeType":"CallExpression","messageId":"unexpected","endLine":172,"endColumn":25}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState } from 'react'\nimport { Button, Input, Label } from '@medusajs/ui'\n\n// 暫時內嵌類型定義\ntype AffiliateLink = {\n  id: string\n  name: string\n  url: string\n  createdAt: string\n  clicks: number\n  conversions: number\n}\n\ninterface LinkListProps {\n  links: AffiliateLink[]\n}\n\nexport function LinkGeneratorForm() {\n  const [isLoading, setIsLoading] = useState(false)\n  const [linkName, setLinkName] = useState('')\n  const [targetUrl, setTargetUrl] = useState('')\n  const [utmSource, setUtmSource] = useState('')\n  const [utmMedium, setUtmMedium] = useState('')\n  const [utmCampaign, setUtmCampaign] = useState('')\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault()\n    if (!linkName.trim() || !targetUrl.trim()) return\n\n    setIsLoading(true)\n    try {\n      const response = await fetch('/api/affiliate/links', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          name: linkName,\n          targetUrl,\n          utmParams: {\n            utm_source: utmSource || 'affiliate',\n            utm_medium: utmMedium || 'referral',\n            utm_campaign: utmCampaign || 'default'\n          }\n        })\n      })\n\n      if (response.ok) {\n        // 重置表單\n        setLinkName('')\n        setTargetUrl('')\n        setUtmSource('')\n        setUtmMedium('')\n        setUtmCampaign('')\n        \n        // 重新整理頁面以顯示新連結\n        window.location.reload()\n      } else {\n        const errorData = await response.json().catch(() => ({}))\n        const errorMessage = errorData.error || `創建連結失敗 (${response.status})`\n        alert(errorMessage)\n      }\n    } catch (error) {\n      console.error('Error creating link:', error)\n      alert('創建連結時發生錯誤：' + (error as Error).message)\n    } finally {\n      setIsLoading(false)\n    }\n  }\n\n  return (\n    <form onSubmit={handleSubmit} className=\"space-y-4 rounded-lg border p-6\">\n      <div className=\"grid gap-4 md:grid-cols-2\">\n        <div>\n          <Label htmlFor=\"linkName\">連結名稱 *</Label>\n          <Input\n            id=\"linkName\"\n            type=\"text\"\n            value={linkName}\n            onChange={(e) => setLinkName(e.target.value)}\n            placeholder=\"例如：首頁推廣\"\n            required\n          />\n        </div>\n        \n        <div>\n          <Label htmlFor=\"targetUrl\">目標網址 *</Label>\n          <Input\n            id=\"targetUrl\"\n            type=\"url\"\n            value={targetUrl}\n            onChange={(e) => setTargetUrl(e.target.value)}\n            placeholder=\"例如：/products/special-offer\"\n            required\n          />\n        </div>\n      </div>\n\n      <div className=\"grid gap-4 md:grid-cols-3\">\n        <div>\n          <Label htmlFor=\"utmSource\">UTM Source</Label>\n          <Input\n            id=\"utmSource\"\n            type=\"text\"\n            value={utmSource}\n            onChange={(e) => setUtmSource(e.target.value)}\n            placeholder=\"affiliate\"\n          />\n        </div>\n        \n        <div>\n          <Label htmlFor=\"utmMedium\">UTM Medium</Label>\n          <Input\n            id=\"utmMedium\"\n            type=\"text\"\n            value={utmMedium}\n            onChange={(e) => setUtmMedium(e.target.value)}\n            placeholder=\"referral\"\n          />\n        </div>\n        \n        <div>\n          <Label htmlFor=\"utmCampaign\">UTM Campaign</Label>\n          <Input\n            id=\"utmCampaign\"\n            type=\"text\"\n            value={utmCampaign}\n            onChange={(e) => setUtmCampaign(e.target.value)}\n            placeholder=\"default\"\n          />\n        </div>\n      </div>\n\n      <Button\n        type=\"submit\"\n        disabled={isLoading || !linkName.trim() || !targetUrl.trim()}\n        className=\"w-full\"\n      >\n        {isLoading ? '創建中...' : '創建推廣連結'}\n      </Button>\n    </form>\n  )\n}\n\nexport function LinkList({ links }: LinkListProps) {\n  const [deletingId, setDeletingId] = useState<string | null>(null)\n\n  const handleDelete = async (id: string) => {\n    setDeletingId(id)\n    try {\n      const response = await fetch(`/api/affiliate/links?id=${id}`, {\n        method: 'DELETE'\n      })\n\n      if (response.ok) {\n        window.location.reload()\n      } else {\n        alert('刪除失敗')\n      }\n    } catch (error) {\n      console.error('Error deleting link:', error)\n      alert('刪除時發生錯誤')\n    } finally {\n      setDeletingId(null)\n    }\n  }\n\n  const copyToClipboard = (url: string) => {\n    navigator.clipboard.writeText(url).then(() => {\n      alert('連結已複製到剪貼簿')\n    })\n  }\n\n  if (links.length === 0) {\n    return (\n      <div className=\"rounded-lg border p-8 text-center text-gray-500\">\n        尚未創建任何推廣連結\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      {links.map((link) => (\n        <div key={link.id} className=\"rounded-lg border p-4\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex-1\">\n              <h3 className=\"font-medium text-gray-900\">{link.name}</h3>\n              <p className=\"text-sm text-gray-500 break-all\">{link.url}</p>\n              <div className=\"mt-2 flex gap-4 text-xs text-gray-500\">\n                <span>點擊次數: {link.clicks}</span>\n                <span>轉換次數: {link.conversions}</span>\n                <span>創建時間: {new Date(link.createdAt).toLocaleDateString('zh-TW')}</span>\n              </div>\n            </div>\n            \n            <div className=\"flex gap-2\">\n              <Button\n                variant=\"secondary\"\n                size=\"small\"\n                onClick={() => copyToClipboard(link.url)}\n              >\n                複製\n              </Button>\n              <Button\n                variant=\"danger\"\n                size=\"small\"\n                onClick={() => handleDelete(link.id)}\n                disabled={deletingId === link.id}\n              >\n                {deletingId === link.id ? '刪除中...' : '刪除'}\n              </Button>\n            </div>\n          </div>\n        </div>\n      ))}\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(main)/affiliate/links/page.tsx","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":36,"column":27,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":36,"endColumn":29,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1125,1127],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":38,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":38,"endColumn":20,"suggestions":[{"fix":{"range":[1150,1204],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":41,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":41,"endColumn":18,"suggestions":[{"fix":{"range":[1235,1271],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { retrieveAffiliate } from '@lib/data/affiliate-auth'\nimport { redirect } from 'next/navigation'\nimport { getRequestOrigin } from '@lib/util/absolute-url'\nimport { LinkGeneratorForm, LinkList } from './components'\n\n// 暫時內嵌類型定義\ntype AffiliateLink = {\n  id: string\n  name: string\n  url: string\n  createdAt: string\n  clicks: number\n  conversions: number\n}\n\nexport default async function AffiliateLinksPage({ params }: { params: Promise<{ countryCode: string }> }) {\n  const { countryCode } = await params\n  const session = await retrieveAffiliate()\n  if (!session) redirect(`/${countryCode}/login-affiliate`)\n  if (session.status !== 'approved') redirect(`/${countryCode}/affiliate/pending`)\n\n  // 直接使用會員 session 中的 ID 獲取連結，而不是透過 API\n  const origin = await getRequestOrigin()\n  let links: AffiliateLink[] = []\n  \n  try {\n    const res = await fetch(`${origin}/api/affiliate/links`, { \n      cache: 'no-store',\n      headers: {\n        'Cookie': `_affiliate_jwt=${Buffer.from(JSON.stringify(session)).toString('base64')}`\n      }\n    })\n    \n    if (res.ok) {\n      const json = await res.json()\n      links = json?.links || []\n    } else {\n      console.error('無法取得連結列表:', res.status, res.statusText)\n    }\n  } catch (error) {\n    console.error('取得連結列表時發生錯誤:', error)\n  }\n\n  return (\n    <div className=\"space-y-8\">\n      <div>\n        <h2 className=\"mb-4 text-xl font-medium\">創建推廣連結</h2>\n        <LinkGeneratorForm />\n      </div>\n      \n      <div>\n        <h2 className=\"mb-4 text-xl font-medium\">我的推廣連結</h2>\n        <LinkList links={links} />\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(main)/affiliate/login/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(main)/affiliate/page.tsx","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":95,"column":33,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":95,"endColumn":35,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2615,2617],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":98,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":98,"endColumn":20,"suggestions":[{"fix":{"range":[2678,2709],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":186,"column":74,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":186,"endColumn":76,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[5369,5371],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":190,"column":43,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":190,"endColumn":45,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[5544,5546],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":195,"column":48,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":195,"endColumn":50,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[5687,5689],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":200,"column":49,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":200,"endColumn":51,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[5970,5972],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":205,"column":52,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":205,"endColumn":54,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[6130,6132],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'linkId' is defined but never used.","line":231,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":231,"endColumn":35},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'linkId' is defined but never used. Allowed unused args must match /^_/u.","line":231,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":231,"endColumn":35},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":235,"column":81,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":235,"endColumn":83,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[7938,7940],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":9,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect } from 'react'\n\n// 型別定義\ntype AffiliateStatPoint = {\n  date: string\n  clicks: number\n  conversions: number\n  revenue: number\n  commission: number\n}\n\ntype AffiliateStatsSummary = {\n  period: string\n  totalClicks: number\n  totalConversions: number\n  totalRevenue: number\n  totalCommission: number\n  trend: AffiliateStatPoint[]\n}\n\ntype AffiliateLink = {\n  id: string\n  name: string\n  url: string\n  createdAt: string\n  clicks: number\n  conversions: number\n}\n\ntype AffiliateOrder = {\n  id: string\n  clickId: string\n  linkId: string\n  linkName: string\n  orderValue: number\n  commission: number\n  customerEmail?: string\n  createdAt: string\n  status: 'pending' | 'confirmed' | 'cancelled'\n}\n\ntype AffiliateOrdersResponse = {\n  summary: {\n    totalOrders: number\n    totalValue: number\n    totalCommission: number\n    pendingCommission: number\n  }\n  orders: AffiliateOrder[]\n}\n\ntype ExtendedAffiliateStats = AffiliateStatsSummary & { \n  linkStats?: { [linkId: string]: { clicks: number, conversions: number, revenue: number, commission: number } } \n}\n\nexport default function AffiliateHomePage() {\n  const [statsData, setStatsData] = useState<ExtendedAffiliateStats | null>(null)\n  const [linksData, setLinksData] = useState<AffiliateLink[]>([])\n  const [ordersData, setOrdersData] = useState<AffiliateOrdersResponse | null>(null)\n  const [loading, setLoading] = useState(true)\n  const [dateRange, setDateRange] = useState(7) // 預設 7 天\n  const [startDate, setStartDate] = useState('')\n  const [endDate, setEndDate] = useState('')\n  const [filterMode, setFilterMode] = useState<'preset' | 'custom'>('preset')\n\n  // 設定預設日期範圍\n  useEffect(() => {\n    const today = new Date()\n    const weekAgo = new Date(today.getTime() - 6 * 24 * 60 * 60 * 1000) // 7天前\n    \n    setEndDate(today.toISOString().split('T')[0])\n    setStartDate(weekAgo.toISOString().split('T')[0])\n  }, [])\n\n  // 載入資料\n  const fetchData = async () => {\n    setLoading(true)\n    try {\n      const [statsRes, linksRes, ordersRes] = await Promise.all([\n        fetch(`/api/affiliate/stats?days=${dateRange}`, { cache: 'no-store' }),\n        fetch(`/api/affiliate/links`, { cache: 'no-store' }),\n        fetch(`/api/affiliate/orders`, { cache: 'no-store' })\n      ])\n\n      const stats = await statsRes.json()\n      const links = linksRes.ok ? await linksRes.json() : { links: [] }\n      const orders = ordersRes.ok ? await ordersRes.json() : {\n        summary: { totalOrders: 0, totalValue: 0, totalCommission: 0, pendingCommission: 0 },\n        orders: []\n      }\n\n      setStatsData(stats)\n      setLinksData(links?.links || [])\n      setOrdersData(orders)\n    } catch (error) {\n      console.error('載入資料失敗:', error)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  useEffect(() => {\n    fetchData()\n  }, [dateRange])\n\n  // 處理日期範圍變更\n  const handleDateRangeChange = (days: number) => {\n    setFilterMode('preset')\n    setDateRange(days)\n  }\n\n  const handleCustomDateChange = () => {\n    setFilterMode('custom')\n    // 計算自訂日期範圍的天數\n    if (startDate && endDate) {\n      const start = new Date(startDate)\n      const end = new Date(endDate)\n      const diffTime = Math.abs(end.getTime() - start.getTime())\n      const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1\n      setDateRange(diffDays)\n    }\n  }\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <div className=\"text-gray-500\">載入中...</div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"space-y-8\">\n      {/* 日期篩選器 */}\n      <div className=\"bg-white border rounded-lg p-4\">\n        <h3 className=\"text-lg font-medium mb-4\">篩選條件</h3>\n        \n        <div className=\"flex flex-wrap items-center gap-4\">\n          {/* 預設日期範圍 */}\n          <div className=\"flex flex-wrap gap-2\">\n            {[7, 14, 30, 90].map((days) => (\n              <button\n                key={days}\n                onClick={() => handleDateRangeChange(days)}\n                className={`px-3 py-1 text-sm rounded-md border ${\n                  filterMode === 'preset' && dateRange === days\n                    ? 'bg-blue-500 text-white border-blue-500'\n                    : 'bg-white text-gray-700 border-gray-300 hover:bg-gray-50'\n                }`}\n              >\n                最近 {days} 天\n              </button>\n            ))}\n          </div>\n\n          {/* 自訂日期範圍 */}\n          <div className=\"flex items-center gap-2\">\n            <span className=\"text-sm text-gray-500\">自訂：</span>\n            <input\n              type=\"date\"\n              value={startDate}\n              onChange={(e) => setStartDate(e.target.value)}\n              className=\"text-sm border border-gray-300 rounded px-2 py-1\"\n            />\n            <span className=\"text-sm text-gray-500\">到</span>\n            <input\n              type=\"date\"\n              value={endDate}\n              onChange={(e) => setEndDate(e.target.value)}\n              className=\"text-sm border border-gray-300 rounded px-2 py-1\"\n            />\n            <button\n              onClick={handleCustomDateChange}\n              className=\"px-3 py-1 text-sm bg-blue-500 text-white rounded-md hover:bg-blue-600\"\n            >\n              套用\n            </button>\n          </div>\n        </div>\n      </div>\n\n      {/* 整體統計摘要 */}\n      <div>\n        <h2 className=\"mb-4 text-xl font-medium\">統計總覽（{statsData?.period || '最近 7 天'}）</h2>\n        <div className=\"grid grid-cols-2 gap-4 small:grid-cols-4\">\n          <StatCard \n            label=\"總點擊數\" \n            value={statsData?.totalClicks || 0}\n            subtitle=\"所有連結累計\"\n          />\n          <StatCard \n            label=\"總轉換數\" \n            value={statsData?.totalConversions || 0}\n            subtitle={`整體轉換率：${statsData?.totalClicks && statsData.totalClicks > 0 ? ((statsData.totalConversions || 0) / statsData.totalClicks * 100).toFixed(1) : 0}%`}\n          />\n          <StatCard \n            label=\"總營收\" \n            value={`$${(statsData?.totalRevenue || 0).toFixed(2)}`}\n            subtitle=\"客戶消費金額\"\n          />\n          <StatCard \n            label=\"總佣金\" \n            value={`$${(statsData?.totalCommission || 0).toFixed(2)}`}\n            subtitle=\"您的總收入\"\n          />\n        </div>\n      </div>\n\n      {/* 各連結詳細表現 */}\n      <div>\n        <h3 className=\"mb-4 text-lg font-medium\">各連結表現分析</h3>\n        {statsData?.linkStats && Object.keys(statsData.linkStats).length > 0 ? (\n          <div className=\"overflow-x-auto\">\n            <table className=\"min-w-full divide-y divide-gray-200\">\n              <thead className=\"bg-gray-50\">\n                <tr>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">連結名稱</th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">目標網址</th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">點擊</th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">轉換</th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">轉換率</th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">營收</th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">佣金</th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">建立時間</th>\n                </tr>\n              </thead>\n              <tbody className=\"divide-y divide-gray-200\">\n                {Object.entries(statsData.linkStats)\n                  .filter(([linkId, linkStat]) => linkStat.clicks > 0 || linkStat.conversions > 0) // 只顯示有數據的連結\n                  .sort(([, a], [, b]) => b.clicks - a.clicks) // 按點擊數排序\n                  .map(([linkId, linkStat]) => {\n                    // 從連結資料中獲取補充資訊\n                    const linkInfo = linksData.find(link => link.id === linkId) || {\n                      name: `連結 ${linkId}`,\n                      url: '',\n                      createdAt: new Date().toISOString()\n                    }\n                    \n                    return (\n                      <tr key={linkId} className=\"hover:bg-gray-50\">\n                        <td className=\"px-6 py-4\">\n                          <div className=\"text-sm font-medium text-gray-900\">{linkInfo.name}</div>\n                          <div className=\"text-xs text-gray-500\">ID: {linkId}</div>\n                        </td>\n                        <td className=\"px-6 py-4\" style={{ maxWidth: '250px' }}>\n                          {linkInfo.url ? (\n                            <div className=\"overflow-x-auto\">\n                              <div className=\"text-sm text-gray-600\" style={{ \n                                whiteSpace: 'nowrap',\n                                minWidth: 'max-content'\n                              }}>\n                                <a \n                                  href={linkInfo.url} \n                                  target=\"_blank\" \n                                  rel=\"noopener noreferrer\" \n                                  className=\"hover:text-blue-600\"\n                                  title={linkInfo.url}\n                                >\n                                  {linkInfo.url}\n                                </a>\n                              </div>\n                            </div>\n                          ) : (\n                            <div className=\"text-sm text-gray-400\">連結資訊不完整</div>\n                          )}\n                        </td>\n                        <td className=\"px-6 py-4 text-sm\">\n                          <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800\">\n                            {linkStat.clicks}\n                          </span>\n                        </td>\n                        <td className=\"px-6 py-4 text-sm\">\n                          <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800\">\n                            {linkStat.conversions}\n                          </span>\n                        </td>\n                        <td className=\"px-6 py-4 text-sm text-gray-900\">\n                          <div className=\"flex items-center\">\n                            <span className=\"font-medium\">\n                              {linkStat.clicks > 0 ? (linkStat.conversions / linkStat.clicks * 100).toFixed(1) : 0}%\n                            </span>\n                            <div className=\"ml-2 w-16 bg-gray-200 rounded-full h-2\">\n                              <div \n                                className=\"bg-blue-600 h-2 rounded-full\" \n                                style={{ \n                                  width: `${linkStat.clicks > 0 ? Math.min((linkStat.conversions / linkStat.clicks * 100), 100) : 0}%` \n                                }}\n                              ></div>\n                            </div>\n                          </div>\n                        </td>\n                        <td className=\"px-6 py-4 text-sm font-medium text-gray-900\">\n                          ${linkStat.revenue.toFixed(2)}\n                        </td>\n                        <td className=\"px-6 py-4 text-sm font-medium text-green-600\">\n                          ${linkStat.commission.toFixed(2)}\n                        </td>\n                        <td className=\"px-6 py-4 text-sm text-gray-500\">\n                          {linkInfo.createdAt ? \n                            new Date(linkInfo.createdAt).toLocaleDateString('zh-TW', { \n                              year: 'numeric',\n                              month: 'short', \n                              day: 'numeric'\n                            }) : '-'\n                          }\n                        </td>\n                      </tr>\n                    )\n                  })}\n              </tbody>\n            </table>\n          </div>\n        ) : (\n          <div className=\"text-center py-8\">\n            <div className=\"text-gray-500\">在選定日期範圍內沒有連結活動</div>\n            <div className=\"mt-2\">\n              <a \n                href=\"/tw/affiliate/links\"\n                className=\"text-blue-600 hover:text-blue-500 text-sm font-medium\"\n              >\n                管理推廣連結 →\n              </a>\n            </div>\n          </div>\n        )}\n      </div>\n\n      {/* 每日趨勢 */}\n      {statsData?.trend && statsData.trend.length > 0 && (\n        <div>\n          <h3 className=\"mb-4 text-lg font-medium\">每日趨勢分析</h3>\n          <div className=\"overflow-x-auto\">\n            <table className=\"min-w-full divide-y divide-gray-200\">\n              <thead className=\"bg-gray-50\">\n                <tr>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">日期</th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">點擊</th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">轉換</th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">轉換率</th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">營收</th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">佣金</th>\n                </tr>\n              </thead>\n              <tbody className=\"divide-y divide-gray-200\">\n                {statsData.trend.map((day) => (\n                  <tr key={day.date} className=\"hover:bg-gray-50\">\n                    <td className=\"px-6 py-4 text-sm text-gray-900\">\n                      {new Date(day.date).toLocaleDateString('zh-TW', { month: 'short', day: 'numeric' })}\n                    </td>\n                    <td className=\"px-6 py-4 text-sm text-gray-900\">{day.clicks}</td>\n                    <td className=\"px-6 py-4 text-sm text-gray-900\">{day.conversions}</td>\n                    <td className=\"px-6 py-4 text-sm text-gray-900\">\n                      {day.clicks > 0 ? (day.conversions / day.clicks * 100).toFixed(1) : 0}%\n                    </td>\n                    <td className=\"px-6 py-4 text-sm text-gray-900\">${day.revenue.toFixed(2)}</td>\n                    <td className=\"px-6 py-4 text-sm text-gray-900\">${day.commission.toFixed(2)}</td>\n                  </tr>\n                ))}\n              </tbody>\n            </table>\n          </div>\n        </div>\n      )}\n\n      {/* 最近成交訂單 */}\n      <div>\n        <h3 className=\"mb-4 text-lg font-medium\">最近成交訂單</h3>\n        \n        {ordersData && ordersData.orders.length > 0 ? (\n          <div className=\"bg-white border rounded-lg overflow-hidden\">\n            <table className=\"min-w-full divide-y divide-gray-200\">\n              <thead className=\"bg-gray-50\">\n                <tr>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">訂單編號</th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">連結名稱</th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">訂單金額</th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">佣金</th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">狀態</th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">時間</th>\n                </tr>\n              </thead>\n              <tbody className=\"divide-y divide-gray-200\">\n                {ordersData.orders.slice(0, 10).map((order) => (\n                  <tr key={order.id} className=\"hover:bg-gray-50\">\n                    <td className=\"px-6 py-4 text-sm font-medium text-gray-900\">\n                      {order.id}\n                    </td>\n                    <td className=\"px-6 py-4 text-sm text-gray-600\">\n                      {order.linkName}\n                    </td>\n                    <td className=\"px-6 py-4 text-sm text-gray-900\">\n                      ${order.orderValue.toFixed(2)}\n                    </td>\n                    <td className=\"px-6 py-4 text-sm font-medium text-green-600\">\n                      ${order.commission.toFixed(2)}\n                    </td>\n                    <td className=\"px-6 py-4 text-sm\">\n                      <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${\n                        order.status === 'confirmed' \n                          ? 'bg-green-100 text-green-800'\n                          : order.status === 'pending'\n                          ? 'bg-yellow-100 text-yellow-800'\n                          : 'bg-red-100 text-red-800'\n                      }`}>\n                        {order.status === 'confirmed' ? '已確認' : \n                         order.status === 'pending' ? '待確認' : '已取消'}\n                      </span>\n                    </td>\n                    <td className=\"px-6 py-4 text-sm text-gray-500\">\n                      {new Date(order.createdAt).toLocaleDateString('zh-TW', { \n                        month: 'short', \n                        day: 'numeric',\n                        hour: '2-digit',\n                        minute: '2-digit'\n                      })}\n                    </td>\n                  </tr>\n                ))}\n              </tbody>\n            </table>\n          </div>\n        ) : (\n          <div className=\"text-center py-8 bg-white border rounded-lg\">\n            <div className=\"text-gray-500\">尚未有透過聯盟連結產生的訂單</div>\n          </div>\n        )}\n      </div>\n    </div>\n  )\n}\n\nfunction StatCard({ label, value, subtitle }: { label: string; value: number | string; subtitle?: string }) {\n  return (\n    <div className=\"rounded-lg border bg-gradient-to-r from-blue-50 to-indigo-50 p-4\">\n      <div className=\"text-sm font-medium text-gray-700\">{label}</div>\n      <div className=\"mt-1 text-2xl font-bold text-gray-900\">{value}</div>\n      {subtitle && <div className=\"mt-1 text-xs text-gray-500\">{subtitle}</div>}\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(main)/affiliate/payouts/page.tsx","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":47,"column":39,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":47,"endColumn":41,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1300,1302],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":109,"column":56,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":109,"endColumn":58,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2825,2827],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":115,"column":57,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":115,"endColumn":59,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3019,3021],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":121,"column":62,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":121,"endColumn":64,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3220,3222],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":235,"column":40,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":235,"endColumn":42,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[8474,8476],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect } from 'react'\n\n// 型別定義\ntype SettlementRecord = {\n  id: string\n  amount: number\n  currency: string\n  status: 'pending' | 'settled'\n  settlementDate: string\n  period: string // 結算期間，如 \"2025-08\"\n  method: 'bank_transfer' | 'paypal' | 'stripe'\n  reference?: string\n  note?: string\n}\n\ntype SettlementSummary = {\n  totalEarned: number // 總收入\n  totalSettled: number // 已結算金額\n  pendingSettlement: number // 未結算金額\n  nextSettlementDate: string // 下次結算日期（每月25號）\n}\n\nexport default function AffiliatePayoutsPage() {\n  const [settlementSummary, setSettlementSummary] = useState<SettlementSummary | null>(null)\n  const [settlements, setSettlements] = useState<SettlementRecord[]>([])\n  const [loading, setLoading] = useState(true)\n  const [error, setError] = useState<string | null>(null)\n  const [activeTab, setActiveTab] = useState<'pending' | 'settled'>('pending')\n\n  useEffect(() => {\n    fetchSettlementData()\n  }, [])\n\n  const fetchSettlementData = async () => {\n    try {\n      setLoading(true)\n      const response = await fetch('/api/affiliate/settlements')\n      \n      if (!response.ok) {\n        throw new Error('獲取結算資料失敗')\n      }\n      \n      const data = await response.json()\n      setSettlementSummary(data.summary)\n      setSettlements(data.settlements || [])\n    } catch (err) {\n      setError(err instanceof Error ? err.message : '發生未知錯誤')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center py-12\">\n        <div className=\"text-gray-500\">載入中...</div>\n      </div>\n    )\n  }\n\n  if (error) {\n    return (\n      <div className=\"rounded-lg bg-red-50 border border-red-200 p-4\">\n        <div className=\"text-red-800\">{error}</div>\n      </div>\n    )\n  }\n\n  const pendingSettlements = settlements.filter(s => s.status === 'pending')\n  const settledSettlements = settlements.filter(s => s.status === 'settled')\n\n  // 計算下次結算日期\n  const getNextSettlementDate = () => {\n    const now = new Date()\n    const year = now.getFullYear()\n    const month = now.getMonth()\n    const day = now.getDate()\n    \n    // 如果今天是25號之前，下次結算就是本月25號\n    // 如果今天是25號之後，下次結算是下個月25號\n    let nextMonth = month\n    let nextYear = year\n    \n    if (day >= 25) {\n      nextMonth += 1\n      if (nextMonth > 11) {\n        nextMonth = 0\n        nextYear += 1\n      }\n    }\n    \n    return new Date(nextYear, nextMonth, 25).toLocaleDateString('zh-TW', {\n      year: 'numeric',\n      month: 'long',\n      day: 'numeric'\n    })\n  }\n\n  return (\n    <div className=\"space-y-8\">\n      {/* 結算總覽 */}\n      <div>\n        <h2 className=\"mb-4 text-xl font-medium\">佣金結算</h2>\n        <div className=\"grid grid-cols-1 gap-4 small:grid-cols-3\">\n          <SummaryCard\n            label=\"總收入\"\n            value={`$${(settlementSummary?.totalEarned || 0).toFixed(2)}`}\n            description=\"累計佣金收入\"\n            color=\"blue\"\n          />\n          <SummaryCard\n            label=\"已結算\"\n            value={`$${(settlementSummary?.totalSettled || 0).toFixed(2)}`}\n            description=\"已完成結算金額\"\n            color=\"green\"\n          />\n          <SummaryCard\n            label=\"未結算\"\n            value={`$${(settlementSummary?.pendingSettlement || 0).toFixed(2)}`}\n            description=\"等待下次結算\"\n            color=\"yellow\"\n          />\n        </div>\n      </div>\n\n      {/* 結算說明 */}\n      <div className=\"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border p-6\">\n        <div className=\"flex items-start space-x-4\">\n          <div className=\"flex-shrink-0\">\n            <div className=\"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center\">\n              <svg className=\"w-6 h-6 text-blue-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z\" />\n              </svg>\n            </div>\n          </div>\n          <div className=\"flex-1\">\n            <h3 className=\"text-lg font-medium text-gray-900 mb-2\">自動結算制度</h3>\n            <div className=\"space-y-2 text-sm text-gray-600\">\n              <p>• <strong>結算日期：</strong>每月 25 日自動結算上個月的佣金</p>\n              <p>• <strong>結算方式：</strong>由聯盟管理後台統一處理，無需申請</p>\n              <p>• <strong>下次結算：</strong>{getNextSettlementDate()}</p>\n              <p>• <strong>結算後：</strong>款項將通過您設定的收款方式發放</p>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* 結算記錄 */}\n      <div>\n        <div className=\"flex items-center justify-between mb-4\">\n          <h3 className=\"text-lg font-medium\">結算記錄</h3>\n          <div className=\"flex rounded-md border border-gray-300 overflow-hidden\">\n            <button\n              onClick={() => setActiveTab('pending')}\n              className={`px-4 py-2 text-sm font-medium ${\n                activeTab === 'pending'\n                  ? 'bg-blue-600 text-white'\n                  : 'bg-white text-gray-700 hover:bg-gray-50'\n              }`}\n            >\n              未結算 ({pendingSettlements.length})\n            </button>\n            <button\n              onClick={() => setActiveTab('settled')}\n              className={`px-4 py-2 text-sm font-medium ${\n                activeTab === 'settled'\n                  ? 'bg-blue-600 text-white'\n                  : 'bg-white text-gray-700 hover:bg-gray-50'\n              }`}\n            >\n              已結算 ({settledSettlements.length})\n            </button>\n          </div>\n        </div>\n\n        <div className=\"bg-white border rounded-lg overflow-hidden\">\n          {(activeTab === 'pending' ? pendingSettlements : settledSettlements).length > 0 ? (\n            <table className=\"min-w-full divide-y divide-gray-200\">\n              <thead className=\"bg-gray-50\">\n                <tr>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">\n                    結算編號\n                  </th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">\n                    結算期間\n                  </th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">\n                    金額\n                  </th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">\n                    狀態\n                  </th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">\n                    結算日期\n                  </th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">\n                    備註\n                  </th>\n                </tr>\n              </thead>\n              <tbody className=\"divide-y divide-gray-200\">\n                {(activeTab === 'pending' ? pendingSettlements : settledSettlements).map((settlement) => (\n                  <tr key={settlement.id} className=\"hover:bg-gray-50\">\n                    <td className=\"px-6 py-4 text-sm font-medium text-gray-900\">\n                      {settlement.id}\n                    </td>\n                    <td className=\"px-6 py-4 text-sm text-gray-900\">\n                      {settlement.period}\n                    </td>\n                    <td className=\"px-6 py-4 text-sm text-gray-900\">\n                      ${settlement.amount.toFixed(2)}\n                    </td>\n                    <td className=\"px-6 py-4 text-sm\">\n                      <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${\n                        settlement.status === 'settled'\n                          ? 'bg-green-100 text-green-800'\n                          : 'bg-yellow-100 text-yellow-800'\n                      }`}>\n                        {settlement.status === 'settled' ? '已結算' : '未結算'}\n                      </span>\n                    </td>\n                    <td className=\"px-6 py-4 text-sm text-gray-500\">\n                      {settlement.status === 'settled' \n                        ? new Date(settlement.settlementDate).toLocaleDateString('zh-TW', {\n                            year: 'numeric',\n                            month: 'short',\n                            day: 'numeric'\n                          })\n                        : '待結算'\n                      }\n                    </td>\n                    <td className=\"px-6 py-4 text-sm text-gray-500\">\n                      {settlement.note || '-'}\n                    </td>\n                  </tr>\n                ))}\n              </tbody>\n            </table>\n          ) : (\n            <div className=\"text-center py-8\">\n              <div className=\"text-gray-500\">\n                {activeTab === 'pending' ? '目前沒有未結算的佣金' : '尚未有已結算的記錄'}\n              </div>\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nfunction SummaryCard({ \n  label, \n  value, \n  description, \n  color = 'blue' \n}: { \n  label: string\n  value: string\n  description: string\n  color?: 'blue' | 'green' | 'yellow' | 'purple'\n}) {\n  const colorClasses = {\n    blue: 'from-blue-50 to-indigo-50',\n    green: 'from-green-50 to-emerald-50',\n    yellow: 'from-yellow-50 to-amber-50',\n    purple: 'from-purple-50 to-violet-50',\n  }\n\n  return (\n    <div className={`rounded-lg border bg-gradient-to-r ${colorClasses[color]} p-4`}>\n      <div className=\"text-sm font-medium text-gray-700\">{label}</div>\n      <div className=\"mt-1 text-2xl font-bold text-gray-900\">{value}</div>\n      <div className=\"mt-1 text-xs text-gray-500\">{description}</div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(main)/affiliate/pending/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(main)/affiliate/register/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(main)/affiliate/settings/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":97,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":97,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2414,2417],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2414,2417],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":112,"column":46,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":112,"endColumn":48,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2769,2771],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":155,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":155,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4104,4107],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4104,4107],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":196,"column":53,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":196,"endColumn":55,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[5711,5713],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":208,"column":45,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":208,"endColumn":47,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[6243,6245],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":220,"column":51,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":220,"endColumn":53,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[6776,6778],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":231,"column":53,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":231,"endColumn":55,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[7313,7315],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":244,"column":51,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":244,"endColumn":53,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[7879,7881],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":284,"column":91,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":284,"endColumn":94,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9730,9733],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9730,9733],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":312,"column":63,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":312,"endColumn":65,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[11021,11023],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":325,"column":66,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":325,"endColumn":68,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[11658,11660],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":338,"column":68,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":338,"endColumn":70,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[12301,12303],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":351,"column":61,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":351,"endColumn":63,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[12937,12939],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":371,"column":51,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":371,"endColumn":53,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[13816,13818],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":394,"column":55,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":394,"endColumn":57,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[14824,14826],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":12,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect } from 'react'\n\ntype AffiliateSettings = {\n  displayName: string\n  website?: string\n  payoutMethod: 'bank_transfer' | 'paypal' | 'stripe'\n  paypalEmail?: string\n  bankAccount?: {\n    bankName: string\n    accountName: string\n    accountNumber: string\n    branch?: string\n  }\n  stripeAccountId?: string\n  notifications: {\n    emailOnNewOrder: boolean\n    emailOnPayment: boolean\n    emailOnCommissionUpdate: boolean\n  }\n  profile: {\n    company?: string\n    phone?: string\n    address?: string\n    taxId?: string\n  }\n}\n\nexport default function AffiliateSettingsPage() {\n  const [settings, setSettings] = useState<AffiliateSettings | null>(null)\n  const [loading, setLoading] = useState(true)\n  const [saving, setSaving] = useState(false)\n  const [error, setError] = useState<string | null>(null)\n  const [success, setSuccess] = useState(false)\n  const [activeTab, setActiveTab] = useState<'profile' | 'payment' | 'notifications'>('profile')\n\n  useEffect(() => {\n    fetchSettings()\n  }, [])\n\n  const fetchSettings = async () => {\n    try {\n      setLoading(true)\n      const response = await fetch('/api/affiliate/settings')\n      \n      if (!response.ok) {\n        throw new Error('獲取設定失敗')\n      }\n      \n      const data = await response.json()\n      setSettings(data)\n    } catch (err) {\n      setError(err instanceof Error ? err.message : '發生未知錯誤')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const handleSave = async () => {\n    if (!settings) return\n\n    try {\n      setSaving(true)\n      setError(null)\n      \n      const response = await fetch('/api/affiliate/settings', {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(settings),\n      })\n\n      if (!response.ok) {\n        throw new Error('保存設定失敗')\n      }\n\n      setSuccess(true)\n      setTimeout(() => setSuccess(false), 3000)\n    } catch (err) {\n      setError(err instanceof Error ? err.message : '保存失敗')\n    } finally {\n      setSaving(false)\n    }\n  }\n\n  const updateSettings = (updates: Partial<AffiliateSettings>) => {\n    if (!settings) return\n    setSettings(prev => prev ? { ...prev, ...updates } : null)\n  }\n\n  const updateNestedSettings = <T,>(path: keyof AffiliateSettings, updates: Partial<T>) => {\n    if (!settings) return\n    setSettings(prev => prev ? {\n      ...prev,\n      [path]: { ...(prev[path] as any), ...updates }\n    } : null)\n  }\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center py-12\">\n        <div className=\"text-gray-500\">載入中...</div>\n      </div>\n    )\n  }\n\n  if (!settings) {\n    return (\n      <div className=\"rounded-lg bg-red-50 border border-red-200 p-4\">\n        <div className=\"text-red-800\">{error || '無法載入設定'}</div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* 頁面標題 */}\n      <div className=\"flex items-center justify-between\">\n        <h2 className=\"text-xl font-medium\">帳戶設定</h2>\n        <button\n          onClick={handleSave}\n          disabled={saving}\n          className=\"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed\"\n        >\n          {saving ? '保存中...' : '保存設定'}\n        </button>\n      </div>\n\n      {/* 成功提示 */}\n      {success && (\n        <div className=\"rounded-lg bg-green-50 border border-green-200 p-4\">\n          <div className=\"text-green-800\">✅ 設定已保存成功</div>\n        </div>\n      )}\n\n      {/* 錯誤提示 */}\n      {error && (\n        <div className=\"rounded-lg bg-red-50 border border-red-200 p-4\">\n          <div className=\"text-red-800\">❌ {error}</div>\n        </div>\n      )}\n\n      {/* 標籤導航 */}\n      <div className=\"border-b border-gray-200\">\n        <nav className=\"-mb-px flex space-x-8\">\n          {[\n            { key: 'profile', label: '基本資料', icon: '👤' },\n            { key: 'payment', label: '收款設定', icon: '💳' },\n            { key: 'notifications', label: '通知設定', icon: '🔔' },\n          ].map((tab) => (\n            <button\n              key={tab.key}\n              onClick={() => setActiveTab(tab.key as any)}\n              className={`py-2 px-1 border-b-2 font-medium text-sm ${\n                activeTab === tab.key\n                  ? 'border-blue-500 text-blue-600'\n                  : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n              }`}\n            >\n              <span className=\"mr-2\">{tab.icon}</span>\n              {tab.label}\n            </button>\n          ))}\n        </nav>\n      </div>\n\n      {/* 標籤內容 */}\n      <div className=\"space-y-6\">\n        {/* 基本資料標籤 */}\n        {activeTab === 'profile' && (\n          <div className=\"space-y-6\">\n            <div className=\"bg-white border rounded-lg p-6\">\n              <h3 className=\"text-lg font-medium mb-4\">個人資料</h3>\n              <div className=\"grid grid-cols-1 gap-6 small:grid-cols-2\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                    顯示名稱 *\n                  </label>\n                  <input\n                    type=\"text\"\n                    value={settings.displayName}\n                    onChange={(e) => updateSettings({ displayName: e.target.value })}\n                    className=\"w-full border border-gray-300 rounded-md px-3 py-2\"\n                    placeholder=\"請輸入顯示名稱\"\n                    required\n                  />\n                </div>\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                    公司名稱\n                  </label>\n                  <input\n                    type=\"text\"\n                    value={settings.profile.company || ''}\n                    onChange={(e) => updateNestedSettings('profile', { company: e.target.value })}\n                    className=\"w-full border border-gray-300 rounded-md px-3 py-2\"\n                    placeholder=\"請輸入公司名稱\"\n                  />\n                </div>\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                    網站網址\n                  </label>\n                  <input\n                    type=\"url\"\n                    value={settings.website || ''}\n                    onChange={(e) => updateSettings({ website: e.target.value })}\n                    className=\"w-full border border-gray-300 rounded-md px-3 py-2\"\n                    placeholder=\"https://example.com\"\n                  />\n                </div>\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                    聯絡電話\n                  </label>\n                  <input\n                    type=\"tel\"\n                    value={settings.profile.phone || ''}\n                    onChange={(e) => updateNestedSettings('profile', { phone: e.target.value })}\n                    className=\"w-full border border-gray-300 rounded-md px-3 py-2\"\n                    placeholder=\"請輸入聯絡電話\"\n                  />\n                </div>\n                <div className=\"small:col-span-2\">\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                    地址\n                  </label>\n                  <textarea\n                    value={settings.profile.address || ''}\n                    onChange={(e) => updateNestedSettings('profile', { address: e.target.value })}\n                    rows={3}\n                    className=\"w-full border border-gray-300 rounded-md px-3 py-2\"\n                    placeholder=\"請輸入地址\"\n                  />\n                </div>\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                    統一編號\n                  </label>\n                  <input\n                    type=\"text\"\n                    value={settings.profile.taxId || ''}\n                    onChange={(e) => updateNestedSettings('profile', { taxId: e.target.value })}\n                    className=\"w-full border border-gray-300 rounded-md px-3 py-2\"\n                    placeholder=\"請輸入統一編號（如適用）\"\n                  />\n                </div>\n              </div>\n            </div>\n          </div>\n        )}\n\n        {/* 收款設定標籤 */}\n        {activeTab === 'payment' && (\n          <div className=\"space-y-6\">\n            <div className=\"bg-white border rounded-lg p-6\">\n              <h3 className=\"text-lg font-medium mb-4\">收款方式</h3>\n              \n              {/* 收款方式選擇 */}\n              <div className=\"mb-6\">\n                <label className=\"block text-sm font-medium text-gray-700 mb-3\">\n                  選擇收款方式 *\n                </label>\n                <div className=\"grid grid-cols-1 gap-4 small:grid-cols-3\">\n                  {[\n                    { key: 'bank_transfer', label: '銀行轉帳', icon: '🏦', desc: '直接轉帳到銀行帳戶' },\n                    { key: 'paypal', label: 'PayPal', icon: '💙', desc: '透過 PayPal 接收款項' },\n                    { key: 'stripe', label: 'Stripe', icon: '💜', desc: '透過 Stripe 接收款項' },\n                  ].map((method) => (\n                    <label\n                      key={method.key}\n                      className={`relative flex cursor-pointer rounded-lg border p-4 focus:outline-none ${\n                        settings.payoutMethod === method.key\n                          ? 'border-blue-500 bg-blue-50'\n                          : 'border-gray-300'\n                      }`}\n                    >\n                      <input\n                        type=\"radio\"\n                        value={method.key}\n                        checked={settings.payoutMethod === method.key}\n                        onChange={(e) => updateSettings({ payoutMethod: e.target.value as any })}\n                        className=\"sr-only\"\n                      />\n                      <div className=\"flex flex-col flex-1\">\n                        <div className=\"flex items-center\">\n                          <span className=\"text-xl mr-2\">{method.icon}</span>\n                          <span className=\"block text-sm font-medium text-gray-900\">\n                            {method.label}\n                          </span>\n                        </div>\n                        <span className=\"mt-1 text-xs text-gray-500\">{method.desc}</span>\n                      </div>\n                    </label>\n                  ))}\n                </div>\n              </div>\n\n              {/* 銀行轉帳設定 */}\n              {settings.payoutMethod === 'bank_transfer' && (\n                <div className=\"bg-gray-50 rounded-lg p-4\">\n                  <h4 className=\"font-medium text-gray-900 mb-3\">銀行帳戶資訊</h4>\n                  <div className=\"grid grid-cols-1 gap-4 small:grid-cols-2\">\n                    <div>\n                      <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                        銀行名稱 *\n                      </label>\n                      <input\n                        type=\"text\"\n                        value={settings.bankAccount?.bankName || ''}\n                        onChange={(e) => updateNestedSettings('bankAccount', { bankName: e.target.value })}\n                        className=\"w-full border border-gray-300 rounded-md px-3 py-2\"\n                        placeholder=\"例：台灣銀行\"\n                        required\n                      />\n                    </div>\n                    <div>\n                      <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                        帳戶名稱 *\n                      </label>\n                      <input\n                        type=\"text\"\n                        value={settings.bankAccount?.accountName || ''}\n                        onChange={(e) => updateNestedSettings('bankAccount', { accountName: e.target.value })}\n                        className=\"w-full border border-gray-300 rounded-md px-3 py-2\"\n                        placeholder=\"請輸入帳戶名稱\"\n                        required\n                      />\n                    </div>\n                    <div>\n                      <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                        帳戶號碼 *\n                      </label>\n                      <input\n                        type=\"text\"\n                        value={settings.bankAccount?.accountNumber || ''}\n                        onChange={(e) => updateNestedSettings('bankAccount', { accountNumber: e.target.value })}\n                        className=\"w-full border border-gray-300 rounded-md px-3 py-2\"\n                        placeholder=\"請輸入帳戶號碼\"\n                        required\n                      />\n                    </div>\n                    <div>\n                      <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                        分行名稱\n                      </label>\n                      <input\n                        type=\"text\"\n                        value={settings.bankAccount?.branch || ''}\n                        onChange={(e) => updateNestedSettings('bankAccount', { branch: e.target.value })}\n                        className=\"w-full border border-gray-300 rounded-md px-3 py-2\"\n                        placeholder=\"請輸入分行名稱\"\n                      />\n                    </div>\n                  </div>\n                </div>\n              )}\n\n              {/* PayPal 設定 */}\n              {settings.payoutMethod === 'paypal' && (\n                <div className=\"bg-gray-50 rounded-lg p-4\">\n                  <h4 className=\"font-medium text-gray-900 mb-3\">PayPal 帳戶資訊</h4>\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                      PayPal 電子郵件 *\n                    </label>\n                    <input\n                      type=\"email\"\n                      value={settings.paypalEmail || ''}\n                      onChange={(e) => updateSettings({ paypalEmail: e.target.value })}\n                      className=\"w-full border border-gray-300 rounded-md px-3 py-2\"\n                      placeholder=\"請輸入 PayPal 註冊的電子郵件\"\n                      required\n                    />\n                    <div className=\"mt-2 text-xs text-gray-500\">\n                      請確保此電子郵件已註冊 PayPal 帳戶\n                    </div>\n                  </div>\n                </div>\n              )}\n\n              {/* Stripe 設定 */}\n              {settings.payoutMethod === 'stripe' && (\n                <div className=\"bg-gray-50 rounded-lg p-4\">\n                  <h4 className=\"font-medium text-gray-900 mb-3\">Stripe 帳戶資訊</h4>\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                      Stripe 帳戶 ID\n                    </label>\n                    <input\n                      type=\"text\"\n                      value={settings.stripeAccountId || ''}\n                      onChange={(e) => updateSettings({ stripeAccountId: e.target.value })}\n                      className=\"w-full border border-gray-300 rounded-md px-3 py-2\"\n                      placeholder=\"acct_xxxxxxxxxxxxxxxxxxxx\"\n                    />\n                    <div className=\"mt-2 text-xs text-gray-500\">\n                      如果沒有 Stripe 帳戶，我們會協助您設定\n                    </div>\n                  </div>\n                </div>\n              )}\n            </div>\n          </div>\n        )}\n\n        {/* 通知設定標籤 */}\n        {activeTab === 'notifications' && (\n          <div className=\"space-y-6\">\n            <div className=\"bg-white border rounded-lg p-6\">\n              <h3 className=\"text-lg font-medium mb-4\">電子郵件通知</h3>\n              <div className=\"space-y-4\">\n                {[\n                  { key: 'emailOnNewOrder', label: '新訂單通知', desc: '當有新訂單通過您的推廣連結時發送通知' },\n                  { key: 'emailOnPayment', label: '結算通知', desc: '當佣金結算完成時發送通知' },\n                  { key: 'emailOnCommissionUpdate', label: '佣金更新通知', desc: '當佣金狀態有變更時發送通知' },\n                ].map((notification) => (\n                  <div key={notification.key} className=\"flex items-start\">\n                    <div className=\"flex items-center h-5\">\n                      <input\n                        type=\"checkbox\"\n                        checked={settings.notifications[notification.key as keyof typeof settings.notifications]}\n                        onChange={(e) => updateNestedSettings('notifications', { [notification.key]: e.target.checked })}\n                        className=\"h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500\"\n                      />\n                    </div>\n                    <div className=\"ml-3 text-sm\">\n                      <label className=\"font-medium text-gray-900\">\n                        {notification.label}\n                      </label>\n                      <div className=\"text-gray-500\">{notification.desc}</div>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(main)/affiliate/stats/page.tsx","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":39,"column":51,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":39,"endColumn":53,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1393,1395],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":91,"column":62,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":91,"endColumn":64,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3731,3733],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { AffiliateStatsSummary } from 'types/affiliate'\nimport { retrieveAffiliate } from '@lib/data/affiliate-auth'\nimport { redirect } from 'next/navigation'\nimport { getRequestOrigin } from '@lib/util/absolute-url'\n\n// 臨時類型定義\ntype AffiliateLink = {\n  id: string\n  name: string\n  url: string\n  createdAt: string\n  clicks: number\n  conversions: number\n}\n\nexport default async function AffiliateStatsPage({ params }: { params: Promise<{ countryCode: string }> }) {\n  const { countryCode } = await params\n  const session = await retrieveAffiliate()\n  if (!session) redirect(`/${countryCode}/login-affiliate`)\n  if (session.status !== 'approved') redirect(`/${countryCode}/affiliate/pending`)\n\n  const origin = await getRequestOrigin()\n  \n  // 同時獲取統計數據和連結列表\n  const [statsRes, linksRes] = await Promise.all([\n    fetch(`${origin}/api/affiliate/stats`, { cache: 'no-store' }),\n    fetch(`${origin}/api/affiliate/links`, { \n      cache: 'no-store',\n      headers: {\n        'Cookie': `_affiliate_jwt=${Buffer.from(JSON.stringify(session)).toString('base64')}`\n      }\n    })\n  ])\n\n  const data = (await statsRes.json()) as AffiliateStatsSummary & { \n    linkStats?: { [linkId: string]: { clicks: number, conversions: number, revenue: number, commission: number } } \n  }\n  const linksData = linksRes.ok ? await linksRes.json() : { links: [] }\n  const links: AffiliateLink[] = linksData?.links || []\n\n  return (\n    <div className=\"space-y-8\">\n      {/* 整體統計摘要 */}\n      <div>\n        <h2 className=\"mb-4 text-xl font-medium\">整體表現（{data.period || '最近 7 天'}）</h2>\n        <div className=\"grid grid-cols-2 gap-4 small:grid-cols-4\">\n          <StatCard \n            label=\"總點擊數\" \n            value={data.totalClicks || 0}\n            subtitle=\"所有連結累計\"\n          />\n          <StatCard \n            label=\"總轉換數\" \n            value={data.totalConversions || 0}\n            subtitle={`整體轉換率：${data.totalClicks > 0 ? ((data.totalConversions || 0) / data.totalClicks * 100).toFixed(1) : 0}%`}\n          />\n          <StatCard \n            label=\"總營收\" \n            value={`$${(data.totalRevenue || 0).toFixed(2)}`}\n            subtitle=\"客戶消費金額\"\n          />\n          <StatCard \n            label=\"總佣金\" \n            value={`$${(data.totalCommission || 0).toFixed(2)}`}\n            subtitle=\"您的總收入\"\n          />\n        </div>\n      </div>\n\n      {/* 各連結詳細表現 */}\n      <div>\n        <h3 className=\"mb-4 text-lg font-medium\">各連結表現分析</h3>\n        {links.length > 0 ? (\n          <div className=\"overflow-x-auto\">\n            <table className=\"min-w-full divide-y divide-gray-200\">\n              <thead className=\"bg-gray-50\">\n                <tr>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">連結名稱</th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">目標網址</th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">點擊</th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">轉換</th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">轉換率</th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">營收</th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">佣金</th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">建立時間</th>\n                </tr>\n              </thead>\n              <tbody className=\"divide-y divide-gray-200\">\n                {links.map((link) => {\n                  // 從統計資料中獲取該連結的真實數據\n                  const linkStat = data.linkStats?.[link.id] || {\n                    clicks: link.clicks || 0,\n                    conversions: link.conversions || 0,\n                    revenue: 0,\n                    commission: 0\n                  }\n                  \n                  return (\n                    <tr key={link.id} className=\"hover:bg-gray-50\">\n                      <td className=\"px-6 py-4\">\n                        <div className=\"text-sm font-medium text-gray-900\">{link.name}</div>\n                        <div className=\"text-xs text-gray-500\">ID: {link.id}</div>\n                      </td>\n                      <td className=\"px-6 py-4\" style={{ maxWidth: '250px' }}>\n                        <div className=\"overflow-x-auto\">\n                          <div className=\"text-sm text-gray-600\" style={{ \n                            whiteSpace: 'nowrap',\n                            minWidth: 'max-content'\n                          }}>\n                            <a \n                              href={link.url} \n                              target=\"_blank\" \n                              rel=\"noopener noreferrer\" \n                              className=\"hover:text-blue-600\"\n                              title={link.url}\n                            >\n                              {link.url}\n                            </a>\n                          </div>\n                        </div>\n                      </td>\n                      <td className=\"px-6 py-4 text-sm\">\n                        <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800\">\n                          {linkStat.clicks}\n                        </span>\n                      </td>\n                      <td className=\"px-6 py-4 text-sm\">\n                        <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800\">\n                          {linkStat.conversions}\n                        </span>\n                      </td>\n                      <td className=\"px-6 py-4 text-sm text-gray-900\">\n                        <div className=\"flex items-center\">\n                          <span className=\"font-medium\">\n                            {linkStat.clicks > 0 ? (linkStat.conversions / linkStat.clicks * 100).toFixed(1) : 0}%\n                          </span>\n                          <div className=\"ml-2 w-16 bg-gray-200 rounded-full h-2\">\n                            <div \n                              className=\"bg-blue-600 h-2 rounded-full\" \n                              style={{ \n                                width: `${linkStat.clicks > 0 ? Math.min((linkStat.conversions / linkStat.clicks * 100), 100) : 0}%` \n                              }}\n                            ></div>\n                          </div>\n                        </div>\n                      </td>\n                      <td className=\"px-6 py-4 text-sm font-medium text-gray-900\">\n                        ${linkStat.revenue.toFixed(2)}\n                      </td>\n                      <td className=\"px-6 py-4 text-sm font-medium text-green-600\">\n                        ${linkStat.commission.toFixed(2)}\n                      </td>\n                      <td className=\"px-6 py-4 text-sm text-gray-500\">\n                        {new Date(link.createdAt).toLocaleDateString('zh-TW', { \n                          year: 'numeric',\n                          month: 'short', \n                          day: 'numeric'\n                        })}\n                      </td>\n                    </tr>\n                  )\n                })}\n              </tbody>\n            </table>\n          </div>\n        ) : (\n          <div className=\"text-center py-8\">\n            <div className=\"text-gray-500\">尚未建立任何推廣連結</div>\n            <div className=\"mt-2\">\n              <a \n                href={`/${countryCode}/affiliate/links`}\n                className=\"text-blue-600 hover:text-blue-500 text-sm font-medium\"\n              >\n                立即建立連結 →\n              </a>\n            </div>\n          </div>\n        )}\n      </div>\n\n      {/* 每日趨勢 */}\n      {data.trend && data.trend.length > 0 && (\n        <div>\n          <h3 className=\"mb-4 text-lg font-medium\">每日趨勢分析</h3>\n          <div className=\"overflow-x-auto\">\n            <table className=\"min-w-full divide-y divide-gray-200\">\n              <thead className=\"bg-gray-50\">\n                <tr>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">日期</th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">點擊</th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">轉換</th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">轉換率</th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">營收</th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">佣金</th>\n                </tr>\n              </thead>\n              <tbody className=\"divide-y divide-gray-200\">\n                {data.trend.map((day) => (\n                  <tr key={day.date} className=\"hover:bg-gray-50\">\n                    <td className=\"px-6 py-4 text-sm text-gray-900\">\n                      {new Date(day.date).toLocaleDateString('zh-TW', { month: 'short', day: 'numeric' })}\n                    </td>\n                    <td className=\"px-6 py-4 text-sm text-gray-900\">{day.clicks}</td>\n                    <td className=\"px-6 py-4 text-sm text-gray-900\">{day.conversions}</td>\n                    <td className=\"px-6 py-4 text-sm text-gray-900\">\n                      {day.clicks > 0 ? (day.conversions / day.clicks * 100).toFixed(1) : 0}%\n                    </td>\n                    <td className=\"px-6 py-4 text-sm text-gray-900\">${day.revenue.toFixed(2)}</td>\n                    <td className=\"px-6 py-4 text-sm text-gray-900\">${day.commission.toFixed(2)}</td>\n                  </tr>\n                ))}\n              </tbody>\n            </table>\n          </div>\n        </div>\n      )}\n    </div>\n  )\n}\n\nfunction StatCard({ label, value, subtitle }: { label: string; value: number | string; subtitle?: string }) {\n  return (\n    <div className=\"rounded-lg border bg-gradient-to-r from-blue-50 to-indigo-50 p-4\">\n      <div className=\"text-sm font-medium text-gray-700\">{label}</div>\n      <div className=\"mt-1 text-2xl font-bold text-gray-900\">{value}</div>\n      {subtitle && <div className=\"mt-1 text-xs text-gray-500\">{subtitle}</div>}\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(main)/blog/[slug]/page.tsx","messages":[{"ruleId":"sonarjs/prefer-immediate-return","severity":2,"message":"Immediately return this expression instead of assigning it to the temporary variable \"uniqueCategories\".","line":24,"column":30,"nodeType":"CallExpression","messageId":"doImmediateAction","endLine":26,"endColumn":6,"fix":{"range":[541,680],"text":"return Array.from(\n      new Map(categories.map(cat => [cat.title, cat])).values()\n    )"}},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":30,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":30,"endColumn":18,"suggestions":[{"fix":{"range":[705,755],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":52,"column":18,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":52,"endColumn":20,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1198,1200],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":54,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":54,"endColumn":18,"suggestions":[{"fix":{"range":[1228,1280],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":122,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":122,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3855,3858],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3855,3858],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":142,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":142,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4725,4728],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4725,4728],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":218,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":218,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8794,8797],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8794,8797],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":242,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":242,"endColumn":18,"suggestions":[{"fix":{"range":[9498,9540],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import client, { getPostBySlug } from \"@lib/sanity\"\nimport SanityContent from \"../components/sanity-content\"\nimport Image from \"next/image\"\nimport Link from \"next/link\"\nimport { notFound } from \"next/navigation\"\n\ninterface Category {\n  _id: string\n  title: string\n}\n\n// 取得所有分類\nasync function getCategories() {\n  try {\n    const query = `*[_type == \"category\"] | order(title asc) {\n      _id,\n      title\n    }`\n    const categories = await client.fetch<Category[]>(query)\n    \n    if (!categories) return []\n    \n    // 確保分類是唯一的（以標題為基準）\n    const uniqueCategories = Array.from(\n      new Map(categories.map(cat => [cat.title, cat])).values()\n    )\n    \n    return uniqueCategories\n  } catch (error) {\n    console.error(\"Error fetching categories:\", error)\n    return []\n  }\n}\n\n// 取得最新文章\nasync function getLatestPosts(excludeSlug?: string) {\n  try {\n    const query = `*[_type == \"post\" ${excludeSlug ? `&& slug.current != \"${excludeSlug}\"` : ''}] | order(publishedAt desc)[0...4] {\n      _id,\n      title,\n      slug {\n        current\n      },\n      publishedAt,\n      mainImage {\n        asset->{\n          url\n        }\n      }\n    }`\n    const posts = await client.fetch(query)\n    return posts || []\n  } catch (error) {\n    console.error(\"Error fetching latest posts:\", error)\n    return []\n  }\n}\n\nexport default async function BlogPost({ \n  params \n}: { \n  params: Promise<{ slug: string; countryCode: string }> \n}) {\n  try {\n    const { slug, countryCode } = await params\n    const [post, categories, latestPosts] = await Promise.all([\n      getPostBySlug(slug),\n      getCategories(),\n      getLatestPosts(slug)\n    ])\n\n    if (!post) {\n      notFound()\n    }\n\n  return (\n    <div className=\"bg-white min-h-screen mt-[72px]\">\n      <div className=\"mx-auto\">\n        <div className=\"grid grid-cols-12 gap-0\">\n          {/* 左側分類側邊欄 */}\n          <aside className=\"col-span-12 md:col-span-3\">\n            <nav className=\"bg-white px-6 md:px-12 xl:px-16 2xl:px-20 py-6 sticky top-[96px] shadow-sm border-r border-gray-200\">\n              <h2 className=\"text-lg font-semibold text-gray-900 border-b border-gray-200 pb-3 mb-4\">\n                文章分類\n              </h2>\n              <ul className=\"space-y-2\">\n                <li>\n                  <Link \n                    href={`/${countryCode}/blog`}\n                    className=\"text-sm text-gray-600 hover:text-blue-600 hover:bg-blue-50 block w-full py-2 px-3 rounded-lg transition-all duration-200\"\n                  >\n                    ← 返回部落格\n                  </Link>\n                </li>\n                <li className=\"border-t border-gray-100 pt-2 mt-3\">\n                  <Link \n                    href={`/${countryCode}/blog`}\n                    className=\"text-sm text-gray-600 hover:text-blue-600 hover:bg-blue-50 block w-full py-2 px-3 rounded-lg transition-all duration-200\"\n                  >\n                    全部文章\n                  </Link>\n                </li>\n                {categories.map((cat: Category) => (\n                  <li key={cat._id}>\n                    <Link \n                      href={`/${countryCode}/blog?category=${encodeURIComponent(cat.title)}`}\n                      className=\"text-sm text-gray-600 hover:text-blue-600 hover:bg-blue-50 block w-full py-2 px-3 rounded-lg transition-all duration-200\"\n                    >\n                      {cat.title}\n                    </Link>\n                  </li>\n                ))}\n              </ul>\n\n              {/* 相關文章快速導航 */}\n              {post.categories && post.categories.length > 0 && (\n                <div className=\"mt-8 pt-6 border-t border-gray-200\">\n                  <h3 className=\"text-sm font-semibold text-gray-900 mb-3\">\n                    本文分類\n                  </h3>\n                  <div className=\"flex flex-wrap gap-2\">\n                    {post.categories.map((cat: any) => (\n                      <Link\n                        key={cat.title}\n                        href={`/${countryCode}/blog?category=${encodeURIComponent(cat.title)}`}\n                        className=\"text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full hover:bg-blue-200 transition-colors duration-200\"\n                      >\n                        {cat.title}\n                      </Link>\n                    ))}\n                  </div>\n                </div>\n              )}\n\n              {/* 最新文章四則 */}\n              {latestPosts && latestPosts.length > 0 && (\n                <div className=\"mt-8 pt-6 border-t border-gray-200\">\n                  <h3 className=\"text-sm font-semibold text-gray-900 mb-4\">\n                    最新文章\n                  </h3>\n                  <div className=\"space-y-3\">\n                    {latestPosts.map((article: any) => (\n                      <Link\n                        key={article._id}\n                        href={`/${countryCode}/blog/${article.slug?.current}`}\n                        className=\"block group hover:bg-gray-50 p-2 rounded-lg transition-all duration-200\"\n                      >\n                        <div className=\"flex space-x-4\">\n                          {article.mainImage?.asset?.url && (\n                            <div className=\"w-12 h-12 relative flex-shrink-0\">\n                              <Image\n                                src={article.mainImage.asset.url}\n                                alt={article.title}\n                                fill\n                                className=\"object-cover rounded\"\n                                sizes=\"48px\"\n                              />\n                            </div>\n                          )}\n                          <div className=\"flex-1 min-w-0\">\n                            <h4 className=\"text-xs font-medium text-gray-900 group-hover:text-blue-600 line-clamp-2 leading-tight\">\n                              {article.title}\n                            </h4>\n                            {article.publishedAt && (\n                              <p className=\"text-xs text-gray-500 mt-1\">\n                                {new Date(article.publishedAt).toLocaleDateString(\"zh-TW\")}\n                              </p>\n                            )}\n                          </div>\n                        </div>\n                      </Link>\n                    ))}\n                  </div>\n                </div>\n              )}\n            </nav>\n          </aside>\n\n          {/* 右側主要內容區 */}\n          <main className=\"col-span-12 md:col-span-9\">\n            <article className=\"bg-white\">\n              <div className=\"max-w-4xl mx-auto px-4 md:px-8 xl:px-12 2xl:px-16 py-8 md:py-12\">\n                {post.mainImage?.asset?.url && (\n                  <div className=\"aspect-[4/3] relative mb-10 rounded-xl overflow-hidden shadow-lg\">\n                    <Image \n                      src={post.mainImage.asset.url} \n                      alt={post.title || \"文章封面圖片\"}\n                      fill\n                      priority\n                      className=\"object-cover hover:scale-105 transition-transform duration-500\"\n                      sizes=\"(max-width: 768px) 100vw, (max-width: 1200px) 75vw, 50vw\"\n                      quality={95}\n                    />\n                  </div>\n                )}\n                \n                <header className=\"mb-8\">\n                  <h1 className=\"text-3xl md:text-4xl font-bold text-gray-900 mb-4 leading-tight\">\n                    {post.title}\n                  </h1>\n                  <div className=\"flex flex-wrap items-center gap-4 text-sm text-gray-600\">\n                    {post.publishedAt && (\n                      <span className=\"flex items-center space-x-1\">\n                        <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z\" />\n                        </svg>\n                        <span>\n                          {new Date(post.publishedAt).toLocaleDateString(\"zh-TW\")}\n                        </span>\n                      </span>\n                    )}\n                    {post.categories && post.categories.length > 0 && (\n                      <div className=\"flex items-center space-x-2\">\n                        <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z\" />\n                        </svg>\n                        <div className=\"flex flex-wrap gap-1\">\n                          {post.categories.map((cat: any) => (\n                            <span key={cat.title} className=\"bg-gray-100 px-2 py-1 rounded-md text-xs font-medium\">\n                              {cat.title}\n                            </span>\n                          ))}\n                        </div>\n                      </div>\n                    )}\n                  </div>\n                </header>\n\n                {post.body && (\n                  <div className=\"prose prose-lg max-w-none space-y-6\">\n                    <SanityContent content={post.body} />\n                  </div>\n                )}\n              </div>\n            </article>\n          </main>\n        </div>\n      </div>\n    </div>\n  )\n  } catch (error) {\n    console.error(\"Error in BlogPost:\", error)\n    return (\n      <div className=\"bg-gray-50 min-h-screen mt-[72px]\">\n        <div className=\"mx-auto text-center py-12\">\n          <h1 className=\"text-2xl font-bold text-red-600\">載入發生錯誤</h1>\n          <p className=\"mt-4 text-gray-600\">請稍後再試</p>\n        </div>\n      </div>\n    )\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(main)/blog/components/blog-card.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":33,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[790,793],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[790,793],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":42,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1095,1098],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1095,1098],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":43,"column":21,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":43,"endColumn":23,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1135,1137],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import Image from \"next/image\"\nimport Link from \"next/link\"\nimport { format } from \"date-fns\"\nimport { zhTW } from \"date-fns/locale\"\nimport type { PortableTextBlock } from '@portabletext/types'\n\nexport type BlogPost = {\n  _id?: string\n  _type?: string\n  title: string\n  body?: PortableTextBlock[] // 修正為 PortableTextBlock[] 以符合 Sanity 內容格式\n  slug?: {\n    current?: string\n    _type?: string\n  } | null\n  mainImage?: {\n    asset?: {\n      url?: string\n      _type?: string\n    } | null\n    _type?: string\n  } | null\n  publishedAt?: string\n  categories?: Array<{\n    title?: string\n    _type?: string\n  } | null> | null\n  cstatus?: string\n}\n\nexport default function BlogCard({ post, countryCode = \"tw\" }: { post: BlogPost; countryCode?: string }) {\n  // 處理摘要內容\n  const getExcerpt = (content: any) => {\n    if (typeof content === 'string') {\n      return content.slice(0, 80) + '...'\n    }\n    // 如果是 Portable Text 格式,只取純文字內容\n    if (Array.isArray(content)) {\n      const text = content\n        .filter(block => block._type === 'block')\n        .map(block => block.children\n          ?.map((child: any) => child.text)\n          .join('') || ''\n        )\n        .join(' ')\n      return text.slice(0, 80) + '...'\n    }\n    return ''\n  }\n\n  return (\n    <li className=\"group relative\">\n      <Link href={`/${countryCode}/blog/${post.slug?.current ?? \"\"}`}>\n        <article className=\"h-full flex flex-col border border-transparent hover:border-gray-200 transition-all duration-200\">\n          <div className=\"aspect-[4/3] w-full relative\">\n            {post.mainImage?.asset?.url ? (\n              <Image \n                src={post.mainImage.asset.url}\n                alt={post.title}\n                className=\"absolute inset-0 object-cover\"\n                fill\n                sizes=\"(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw\"\n              />\n            ) : (\n              <div className=\"absolute inset-0 bg-gray-100\" />\n            )}\n          </div>\n          <div className=\"flex flex-col flex-1 px-4 md:px-8 py-4\">\n            <div className=\"mb-4\">\n              {post.categories?.map((category) => (\n                <span key={category?.title} className=\"text-sm text-gray-500 font-base mr-2\">\n                  {category?.title}\n                </span>\n              ))}\n            </div>\n            <h2 className=\"text-lg md:text-xl lg:text-2xl font-light text-gray-900 mb-2 leading-tight\">\n              {post.title}\n            </h2>\n            <p className=\"text-sm md:text-base text-gray-600 mb-4 leading-relaxed overflow-hidden\" \n               style={{ \n                 display: '-webkit-box',\n                 WebkitLineClamp: 3,\n                 WebkitBoxOrient: 'vertical' as const\n               }}>\n              {post.body && getExcerpt(post.body)}\n            </p>\n            <div className=\"mt-auto flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2\">\n              <div>\n                {post.publishedAt && (\n                  <time className=\"text-sm text-gray-500 font-base\">\n                    {format(new Date(post.publishedAt), \"yyyy年MM月dd日\", { locale: zhTW })}\n                  </time>\n                )}\n              </div>\n              <span className=\"text-sm text-gray-900 hover:text-black font-medium transition-colors duration-200 self-start sm:self-auto\">\n                閱讀更多 →\n              </span>\n            </div>\n          </div>\n        </article>\n      </Link>\n    </li>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(main)/blog/components/blog-list.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'categories' is defined but never used.","line":20,"column":50,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":60},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'categories' is defined but never used. Allowed unused args must match /^_/u.","line":20,"column":50,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":60}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect } from \"react\"\nimport clsx from \"clsx\"\nimport BlogCard, { BlogPost } from \"./blog-card\"\n\ninterface Category {\n  _id: string\n  title: string\n}\n\ninterface BlogListProps {\n  initialPosts: BlogPost[]\n  categories: Category[]\n  countryCode?: string\n}\n\nconst POSTS_PER_PAGE = 9\n\nexport default function BlogList({ initialPosts, categories, countryCode = \"tw\" }: BlogListProps) {\n  const [posts, setPosts] = useState<BlogPost[]>([])\n  const [currentPage, setCurrentPage] = useState(1)\n  \n  useEffect(() => {\n    if (Array.isArray(initialPosts)) {\n      setPosts(initialPosts)\n      setCurrentPage(1)\n    }\n  }, [initialPosts])\n\n  const totalPages = Math.ceil(posts.length / POSTS_PER_PAGE)\n  const currentPosts = posts.slice(\n    (currentPage - 1) * POSTS_PER_PAGE,\n    currentPage * POSTS_PER_PAGE\n  )\n\n  if (!Array.isArray(posts) || posts.length === 0) {\n    return null\n  }\n\n  return (\n    <div>\n      {/* 文章列表 */}\n      <ul className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-0\">\n        {currentPosts.map((post) => (\n          <BlogCard key={post._id} post={post} countryCode={countryCode} />\n        ))}\n      </ul>\n\n      {/* 分頁導航 */}\n      {totalPages > 1 && (\n        <div className=\"mt-8 flex justify-center\">\n          <nav className=\"flex items-center gap-2\" aria-label=\"文章分頁\">\n            <button\n              onClick={() => setCurrentPage(p => Math.max(1, p - 1))}\n              disabled={currentPage === 1}\n              className={clsx(\n                \"px-3 py-1 text-sm font-medium\",\n                currentPage === 1\n                  ? \"text-gray-400 cursor-not-allowed\"\n                  : \"text-gray-700 hover:bg-gray-100\"\n              )}\n            >\n              上一頁\n            </button>\n\n            {Array.from({ length: totalPages }, (_, i) => i + 1).map((pageNum) => (\n              <button\n                key={pageNum}\n                onClick={() => setCurrentPage(pageNum)}\n                className={clsx(\n                  \"px-3 py-1 text-sm font-medium\",\n                  pageNum === currentPage\n                    ? \"bg-blue-600 text-white\"\n                    : \"text-gray-700 hover:bg-gray-100\"\n                )}\n              >\n                {pageNum}\n              </button>\n            ))}\n\n            <button\n              onClick={() => setCurrentPage(p => Math.min(totalPages, p + 1))}\n              disabled={currentPage === totalPages}\n              className={clsx(\n                \"px-3 py-1 text-sm font-medium\",\n                currentPage === totalPages\n                  ? \"text-gray-400 cursor-not-allowed\"\n                  : \"text-gray-700 hover:bg-gray-100\"\n              )}\n            >\n              下一頁\n            </button>\n          </nav>\n        </div>\n      )}\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(main)/blog/components/blog-posts-client.tsx","messages":[{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":22,"column":7,"nodeType":null,"messageId":"preferOptionalChain","endLine":23,"endColumn":17,"suggestions":[{"fix":{"range":[448,473],"text":"post?.title"},"messageId":"optionalChainSuggest","desc":"Change to an optional chain."}]},{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":43,"column":9,"nodeType":null,"messageId":"preferOptionalChain","endLine":43,"endColumn":47,"fix":{"range":[970,1008],"text":"validPosts?.length === 0"}},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":72,"column":33,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":72,"endColumn":35,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2124,2126],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":96,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":96,"endColumn":18,"suggestions":[{"fix":{"range":[2694,2731],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import BlogCard from \"./blog-card\"\nimport type { BlogPost } from \"./blog-card\"\n\ninterface BlogPostsClientProps {\n  posts: BlogPost[]\n  title?: string \n  postsPerRow?: number\n  showTitle?: boolean\n  limit?: number\n}\n\nexport default function BlogPostsClient({ \n  posts,\n  title,\n  postsPerRow = 3,\n  showTitle = true,\n  limit = 2\n}: BlogPostsClientProps) {\n  try {\n    // 檢查並過濾無效的文章 - 移除對主圖片的強制要求\n    const validPosts = posts?.filter(post => (\n      post && \n      post.title && \n      post.slug?.current\n    ))\n\n    // 根據 postsPerRow 設置網格樣式\n    const getGridCols = (cols: number) => {\n      switch (cols) {\n        case 1:\n          return \"grid-cols-1\"\n        case 2:\n          return \"grid-cols-2 md:grid-cols-2\"\n        case 3:\n          return \"grid-cols-2 md:grid-cols-2 lg:grid-cols-3\"\n        case 4:\n          return \"grid-cols-2 md:grid-cols-2 lg:grid-cols-4\"\n        default:\n          return \"grid-cols-2 md:grid-cols-2 lg:grid-cols-3\"\n      }\n    }\n\n    if (!validPosts || validPosts.length === 0) {\n      return (\n        <div className={(showTitle && title) ? \"py-8 md:py-12 bg-gray-50\" : \"py-0 bg-gray-50\"}>\n          <div className=\"container mx-auto px-4\">\n            <div className=\"text-center text-gray-500\">\n              目前還沒有已發布的文章\n            </div>\n          </div>\n        </div>\n      )\n    }\n\n    return (\n      <div className={(showTitle && title) ? \"py-8 md:py-12 bg-gray-50\" : \"py-0 bg-gray-50\"}>\n        <div className=\"content-container\">\n          {/* 標題區塊 - 作為整體處理，只有在 showTitle 為 true 且有標題時才顯示 */}\n          {showTitle && title && (\n            <div className=\"section-header-container\">\n              <h2 className=\"h1\">{title}</h2>\n              {/* 調試信息作為標題的一部分 */}\n              <div className=\"text-sm text-gray-500 mt-2\">\n                {`找到 ${posts?.length || 0} 篇文章，其中 ${validPosts?.length || 0} 篇可顯示`}\n              </div>\n            </div>\n          )}\n          {validPosts && validPosts.length > 0 ? (\n            <ul className={`grid ${getGridCols(postsPerRow)} gap-0`}>\n              {validPosts.map((post) => (\n                <BlogCard \n                  key={post._id || post.title} \n                  post={post} \n                />\n              ))}\n            </ul>\n          ) : (\n            <div className=\"text-center text-gray-500\">\n              目前還沒有已發布的文章\n            </div>\n          )}\n          {validPosts?.length >= limit && (\n            <div className=\"flex justify-center mt-12\">\n              <a \n                href=\"/blog\" \n                className=\"btn-secondary\"\n              >\n                查看更多文章\n              </a>\n            </div>\n          )}\n        </div>\n      </div>\n    )\n  } catch (error) {\n    console.error('顯示部落格文章時發生錯誤:', error)\n    return (\n      <div className={(showTitle && title) ? \"py-8 md:py-12 bg-gray-50\" : \"py-0 bg-gray-50\"}>\n        <div className=\"container mx-auto px-4\">\n          <div className=\"text-center text-gray-500\">\n            載入文章時發生錯誤，請稍後再試\n          </div>\n        </div>\n      </div>\n    )\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(main)/blog/components/blog-posts.tsx","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":37,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":37,"endColumn":16,"suggestions":[{"fix":{"range":[885,936],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":40,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":40,"endColumn":18,"suggestions":[{"fix":{"range":[978,1015],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":63,"column":7,"nodeType":null,"messageId":"preferOptionalChain","endLine":64,"endColumn":17,"suggestions":[{"fix":{"range":[1423,1448],"text":"post?.title"},"messageId":"optionalChainSuggest","desc":"Change to an optional chain."}]},{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":84,"column":9,"nodeType":null,"messageId":"preferOptionalChain","endLine":84,"endColumn":47,"fix":{"range":[1945,1983],"text":"validPosts?.length === 0"}},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":113,"column":33,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":113,"endColumn":35,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3109,3111],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":137,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":137,"endColumn":18,"suggestions":[{"fix":{"range":[3679,3716],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import BlogCard from \"./blog-card\"\nimport type { BlogPost } from \"./blog-card\"\nimport client from \"@lib/sanity\"\n\nasync function getBlogPosts(category?: string, limit: number = 6) {\n  try {\n    // 1. 建立基本查詢條件\n    const baseQuery = `_type == \"post\"`\n    \n    // 2. 建立分類過濾條件\n    const categoryFilter = category ? `&& $category in categories[]->title` : ''\n    \n    // 3. 組合完整查詢 - 使用 _createdAt 而不是 publishedAt\n    const query = `*[${baseQuery} ${categoryFilter}] | order(_createdAt desc) [0...${limit}] {\n      title,\n      slug,\n      mainImage {\n        asset->{\n          url\n        }\n      },\n      publishedAt,\n      _createdAt,\n      categories[]->{\n        title\n      },\n      _id,\n      status,\n      body // 添加文章內文\n    }`\n\n    // 4. 設置查詢參數\n    const params = category ? { category } : {}\n\n    // 5. 執行查詢並傳入參數\n    const posts = await client.fetch<BlogPost[]>(query, params)\n    console.log('BlogPosts - 查詢到的文章數量:', posts?.length)\n    return posts\n  } catch (error) {\n    console.error('取得部落格文章時發生錯誤:', error)\n    return []\n  }\n}\n\nexport default async function BlogPosts({ \n  category,\n  limit = 2,\n  title,\n  postsPerRow = 3,\n  showTitle = true\n}: { \n  category?: string\n  limit?: number\n  title?: string \n  postsPerRow?: number\n  showTitle?: boolean\n}) {\n  try {\n    const posts = await getBlogPosts(category, limit)\n\n    // 檢查並過濾無效的文章 - 移除對主圖片的強制要求\n    const validPosts = posts?.filter((post: BlogPost) => (\n      post && \n      post.title && \n      post.slug?.current\n    ))\n\n    // 根據 postsPerRow 設置網格樣式\n    const getGridCols = (cols: number) => {\n      switch (cols) {\n        case 1:\n          return \"grid-cols-1\"\n        case 2:\n          return \"grid-cols-2 md:grid-cols-2\"\n        case 3:\n          return \"grid-cols-2 md:grid-cols-2 lg:grid-cols-3\"\n        case 4:\n          return \"grid-cols-2 md:grid-cols-2 lg:grid-cols-4\"\n        default:\n          return \"grid-cols-2 md:grid-cols-2 lg:grid-cols-3\"\n      }\n    }\n\n    if (!validPosts || validPosts.length === 0) {\n      return (\n        <div className={(showTitle && title) ? \"py-8 md:py-12 bg-gray-50\" : \"py-0 bg-gray-50\"}>\n          <div className=\"container mx-auto px-4\">\n            <div className=\"text-center text-gray-500\">\n              目前還沒有已發布的文章\n            </div>\n          </div>\n        </div>\n      )\n    }\n\n    return (\n      <div className={(showTitle && title) ? \"py-8 md:py-12 bg-gray-50\" : \"py-0 bg-gray-50\"}>\n        <div className=\"content-container\">\n          {/* 標題區塊 - 作為整體處理，只有在 showTitle 為 true 且有標題時才顯示 */}\n          {showTitle && title && (\n            <div className=\"section-header-container\">\n              <h2 className=\"h1\">{title}</h2>\n              {/* 調試信息作為標題的一部分 */}\n              <div className=\"text-sm text-gray-500 mt-2\">\n                {`找到 ${posts?.length || 0} 篇文章，其中 ${validPosts?.length || 0} 篇可顯示`}\n              </div>\n            </div>\n          )}\n          {validPosts && validPosts.length > 0 ? (\n            <ul className={`grid ${getGridCols(postsPerRow)} gap-0`}>\n              {validPosts.map((post: BlogPost) => (\n                <BlogCard \n                  key={post._id || post.title} \n                  post={post} \n                />\n              ))}\n            </ul>\n          ) : (\n            <div className=\"text-center text-gray-500\">\n              目前還沒有已發布的文章\n            </div>\n          )}\n          {validPosts?.length >= limit && (\n            <div className=\"flex justify-center mt-12\">\n              <a \n                href=\"/blog\" \n                className=\"btn-secondary\"\n              >\n                查看更多文章\n              </a>\n            </div>\n          )}\n        </div>\n      </div>\n    )\n  } catch (error) {\n    console.error('顯示部落格文章時發生錯誤:', error)\n    return (\n      <div className={(showTitle && title) ? \"py-8 md:py-12 bg-gray-50\" : \"py-0 bg-gray-50\"}>\n        <div className=\"container mx-auto px-4\">\n          <div className=\"text-center text-gray-500\">\n            載入文章時發生錯誤，請稍後再試\n          </div>\n        </div>\n      </div>\n    )\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(main)/blog/components/category-filter.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(main)/blog/components/sanity-content.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":29,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[908,911],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[908,911],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":67,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2100,2103],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2100,2103],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { PortableText } from '@portabletext/react'\nimport type { PortableTextBlock } from '@portabletext/types'\n\ninterface SanityContentProps {\n  content?: PortableTextBlock[] | null\n}\n\nconst components = {\n  block: {\n    h1: ({children}: {children: React.ReactNode}) => (\n      <h1 className=\"h1 mt-8 mb-4\">{children}</h1>\n    ),\n    h2: ({children}: {children: React.ReactNode}) => (\n      <h2 className=\"h2 mt-6 mb-3\">{children}</h2>\n    ),\n    h3: ({children}: {children: React.ReactNode}) => (\n      <h3 className=\"h3 mt-4 mb-2\">{children}</h3>\n    ),\n    normal: ({children}: {children: React.ReactNode}) => (\n      <p className=\"text-content mb-4\">{children}</p>\n    ),\n    blockquote: ({children}: {children: React.ReactNode}) => (\n      <blockquote className=\"text-content border-l-4 border-gray-300 pl-4 italic my-4\">\n        {children}\n      </blockquote>\n    ),\n  },\n  marks: {\n    link: (props: any) => {\n      const { children, value } = props\n      const rel = !value?.href?.startsWith('/') ? 'noreferrer noopener' : undefined\n      return (\n        <a \n          href={value?.href}\n          rel={rel}\n          className=\"text-content text-blue-600 hover:underline\"\n        >\n          {children}\n        </a>\n      )\n    },\n    strong: ({children}: {children: React.ReactNode}) => (\n      <strong className=\"text-content font-semibold\">{children}</strong>\n    ),\n    em: ({children}: {children: React.ReactNode}) => (\n      <em className=\"text-content italic\">{children}</em>\n    ),\n  },\n  list: {\n    bullet: ({children}: {children: React.ReactNode}) => (\n      <ul className=\"text-content list-disc list-inside mb-4 space-y-2\">{children}</ul>\n    ),\n    number: ({children}: {children: React.ReactNode}) => (\n      <ol className=\"text-content list-decimal list-inside mb-4 space-y-2\">{children}</ol>\n    ),\n  },\n}\n\nexport default function SanityContent({ content }: SanityContentProps) {\n  if (!content || content.length === 0) {\n    return <div className=\"text-gray-500 italic\">無內容可顯示</div>\n  }\n\n  return (\n    <PortableText\n      value={content}\n      components={components as any}\n    />\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(main)/blog/loading.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(main)/blog/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[441,444],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[441,444],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":73,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":73,"endColumn":16,"suggestions":[{"fix":{"range":[1383,1427],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":74,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":74,"endColumn":16,"suggestions":[{"fix":{"range":[1432,1500],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":77,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":77,"endColumn":19,"suggestions":[{"fix":{"range":[1530,1560],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":83,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":83,"endColumn":18,"suggestions":[{"fix":{"range":[1629,1674],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":97,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":97,"endColumn":16,"suggestions":[{"fix":{"range":[1919,1973],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":100,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":100,"endColumn":19,"suggestions":[{"fix":{"range":[2008,2043],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"sonarjs/prefer-immediate-return","severity":2,"message":"Immediately return this expression instead of assigning it to the temporary variable \"uniqueCategories\".","line":104,"column":30,"nodeType":"CallExpression","messageId":"doImmediateAction","endLine":106,"endColumn":6,"fix":{"range":[2075,2214],"text":"return Array.from(\n      new Map(categories.map(cat => [cat.title, cat])).values()\n    )"}},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":110,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":110,"endColumn":18,"suggestions":[{"fix":{"range":[2239,2289],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":133,"column":18,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":133,"endColumn":20,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2666,2668],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":135,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":135,"endColumn":18,"suggestions":[{"fix":{"range":[2696,2748],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":151,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":151,"endColumn":16,"suggestions":[{"fix":{"range":[3007,3050],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":152,"column":21,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":152,"endColumn":23,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3071,3073],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":159,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":159,"endColumn":18,"suggestions":[{"fix":{"range":[3223,3272],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":173,"column":39,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":173,"endColumn":41,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3563,3565],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":174,"column":42,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":174,"endColumn":44,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3638,3640],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'siteInfo' is assigned a value but never used.","line":188,"column":31,"nodeType":null,"messageId":"unusedVar","endLine":188,"endColumn":39},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'siteInfo' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":188,"column":31,"nodeType":null,"messageId":"unusedVar","endLine":188,"endColumn":39},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":235,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":235,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5978,5981],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5978,5981],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":314,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":314,"endColumn":18,"suggestions":[{"fix":{"range":[9225,9271],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":13,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import { unstable_noStore as noStore } from 'next/cache'\nimport Image from 'next/image'\nimport Link from 'next/link'\nimport client from \"@lib/sanity\"\nimport BlogList from \"@modules/blog/components/blog-list\"\n\ninterface Post {\n  _id: string\n  title: string\n  slug: {\n    current?: string\n    _type?: string\n  }\n  publishedAt: string\n  mainImage: {\n    asset: {\n      url: string\n    }\n  }\n  categories: Array<{\n    title: string\n  }>\n  body: any\n}\n\ninterface Category {\n  _id: string\n  title: string\n}\n\n// 取得所有部落格文章\nasync function getAllPosts(category?: string) {\n  try {\n    noStore()\n    \n    const query = category \n      ? `*[_type == \"post\" && \"${category}\" in categories[]->title] | order(publishedAt desc) {\n          _id,\n          title,\n          slug {\n            current\n          },\n          publishedAt,\n          mainImage {\n            asset->{\n              url\n            }\n          },\n          categories[]->{\n            title\n          },\n          body\n        }`\n      : `*[_type == \"post\"] | order(publishedAt desc) {\n          _id,\n          title,\n          slug {\n            current\n          },\n          publishedAt,\n          mainImage {\n            asset->{\n              url\n            }\n          },\n          categories[]->{\n            title\n          },\n          body\n        }`\n    \n    const posts = await client.fetch<Post[]>(query)\n    console.log('Fetched posts:', posts?.length)\n    console.log('First post data:', JSON.stringify(posts?.[0], null, 2))\n    \n    if (!posts) {\n      console.warn(\"No posts found\")\n      return []\n    }\n    \n    return posts\n  } catch (error) {\n    console.error(\"Error fetching posts:\", error)\n    return []\n  }\n}\n\n// 取得所有分類\nasync function getCategories() {\n  try {\n    noStore()\n    const query = `*[_type == \"category\"] | order(title asc) {\n      _id,\n      title\n    }`\n    const categories = await client.fetch<Category[]>(query)\n    console.log('Fetched categories:', categories?.length)\n    \n    if (!categories) {\n      console.warn(\"No categories found\")\n      return []\n    }\n    \n    const uniqueCategories = Array.from(\n      new Map(categories.map(cat => [cat.title, cat])).values()\n    )\n    \n    return uniqueCategories\n  } catch (error) {\n    console.error(\"Error fetching categories:\", error)\n    return []\n  }\n}\n\n// 取得最新文章\nasync function getLatestPosts() {\n  try {\n    noStore()\n    const query = `*[_type == \"post\"] | order(publishedAt desc)[0...4] {\n      _id,\n      title,\n      slug {\n        current\n      },\n      publishedAt,\n      mainImage {\n        asset->{\n          url\n        }\n      }\n    }`\n    const posts = await client.fetch(query)\n    return posts || []\n  } catch (error) {\n    console.error(\"Error fetching latest posts:\", error)\n    return []\n  }\n}\n\n// 取得網站資訊\nasync function getSiteInfo() {\n  try {\n    noStore()\n    const query = `*[_type == \"homePage\"][0] {\n      title,\n      description,\n      seoDescription,\n      seoTitle\n    }`\n    const siteInfo = await client.fetch(query)\n    console.log('Fetched site info:', siteInfo)\n    return siteInfo || { \n      title: \"首頁\", \n      description: \"\", \n      seoDescription: \"\", \n      seoTitle: \"Fantasy World Barber Shop\" \n    }\n  } catch (error) {\n    console.error(\"Error fetching site info:\", error)\n    return { \n      title: \"首頁\", \n      description: \"\", \n      seoDescription: \"\", \n      seoTitle: \"Fantasy World Barber Shop\" \n    }\n  }\n}\n\n// 動態生成metadata\nexport async function generateMetadata() {\n  const siteInfo = await getSiteInfo()\n  return {\n    title: `部落格 | ${siteInfo.seoTitle || 'Fantasy World Barber Shop'}`,\n    description: siteInfo.seoDescription || '最新消息與文章'\n  }\n}\n\nexport default async function BlogListPage({\n  params,\n  searchParams,\n}: {\n  params: Promise<{ countryCode: string }>\n  searchParams: Promise<{ category?: string }>\n}) {\n  try {\n    const { countryCode } = await params\n    const { category } = await searchParams\n    const [posts, categories, siteInfo, latestPosts] = await Promise.all([\n      getAllPosts(category),\n      getCategories(),\n      getSiteInfo(),\n      getLatestPosts()\n    ])\n\n    return (\n      <div className=\"bg-white min-h-[80vh] mt-[72px]\">\n        <div className=\"mx-auto\">\n          <div className=\"grid grid-cols-12\">\n            {/* 左側分類側邊欄 */}\n            <aside className=\"col-span-12 md:col-span-3\">\n              <nav className=\"bg-white pl-6 md:pl-12 xl:pl-16 2xl:pl-20 pr-6 py-6 sticky top-[96px]\">\n                <h2 className=\"text-xl font-semibold border-b pb-2\">文章分類</h2>\n                <ul className=\"space-y-3 mt-4\">\n                  <li>\n                    <a \n                      href={`/${countryCode}/blog`}\n                      className={`text-sm hover:text-blue-600 block w-full py-1 transition-colors duration-200 ${\n                        !category ? 'text-blue-600 font-medium' : 'text-gray-500'\n                      }`}\n                    >\n                      全部文章\n                    </a>\n                  </li>\n                  {categories.map((cat) => (\n                    <li key={cat._id}>\n                      <a \n                        href={`/${countryCode}/blog?category=${encodeURIComponent(cat.title)}`}\n                        className={`text-sm hover:text-blue-600 block w-full py-1 transition-colors duration-200 ${\n                          category === cat.title ? 'text-blue-600 font-medium' : 'text-gray-500'\n                        }`}\n                      >\n                        {cat.title}\n                      </a>\n                    </li>\n                  ))}\n                </ul>\n\n                {/* 最新文章四則 */}\n                {latestPosts && latestPosts.length > 0 && (\n                  <div className=\"mt-8 pt-6 border-t border-gray-200\">\n                    <h3 className=\"text-sm font-semibold text-gray-900 mb-4\">\n                      最新文章\n                    </h3>\n                    <div className=\"space-y-3\">\n                      {latestPosts.map((article: any) => (\n                        <Link\n                          key={article._id}\n                          href={`/${countryCode}/blog/${article.slug?.current}`}\n                          className=\"block group hover:bg-gray-50 p-2 rounded-lg transition-all duration-200\"\n                        >\n                          <div className=\"flex space-x-4\">\n                            {article.mainImage?.asset?.url && (\n                              <div className=\"w-12 h-12 relative flex-shrink-0\">\n                                <Image\n                                  src={article.mainImage.asset.url}\n                                  alt={article.title}\n                                  fill\n                                  className=\"object-cover rounded\"\n                                  sizes=\"48px\"\n                                />\n                              </div>\n                            )}\n                            <div className=\"flex-1 min-w-0\">\n                              <h4 className=\"text-xs font-medium text-gray-900 group-hover:text-blue-600 leading-tight overflow-hidden\" \n                                  style={{ \n                                    display: '-webkit-box',\n                                    WebkitLineClamp: 2,\n                                    WebkitBoxOrient: 'vertical'\n                                  }}>\n                                {article.title}\n                              </h4>\n                              {article.publishedAt && (\n                                <p className=\"text-xs text-gray-500 mt-1\">\n                                  {new Date(article.publishedAt).toLocaleDateString(\"zh-TW\")}\n                                </p>\n                              )}\n                            </div>\n                          </div>\n                        </Link>\n                      ))}\n                    </div>\n                  </div>\n                )}\n              </nav>\n            </aside>\n\n            {/* 右側主要內容區 */}\n            <main className=\"col-span-12 md:col-span-9 pr-6 md:pr-12 xl:pr-16 2xl:pr-20\">\n              {/* 隱藏頁面標題和副標題\n              <header className=\"bg-white p-8\">\n                <h1 className=\"text-3xl font-bold\">\n                  {category \n                    ? `${category}`\n                    : '部落格文章'}\n                </h1>\n                <p className=\"text-gray-500 mt-2\">探索我們的最新消息與文章</p>\n              </header>\n              */}\n\n              {/* 文章列表 */}\n              <section className=\"bg-white -mt-8\">\n                {Array.isArray(posts) && posts.length > 0 ? (\n                  <BlogList \n                    initialPosts={posts} \n                    categories={categories}\n                    countryCode={countryCode}\n                  />\n                ) : (\n                  <div className=\"text-center py-12 bg-white\">\n                    <p className=\"text-gray-500\">\n                      {category \n                        ? `在 \"${category}\" 分類中還沒有文章`\n                        : '目前還沒有任何文章'}\n                    </p>\n                  </div>\n                )}\n              </section>\n            </main>\n          </div>\n        </div>\n      </div>\n    )\n  } catch (error) {\n    console.error(\"Error in BlogListPage:\", error)\n    return (\n      <div className=\"py-12 bg-white min-h-[80vh]\">\n        <div className=\"mx-auto text-center\">\n          <h1 className=\"text-2xl font-bold text-red-600\">載入發生錯誤</h1>\n          <p className=\"mt-4 text-gray-600\">請稍後再試</p>\n          <button \n            onClick={() => window.location.reload()} \n            className=\"mt-4 px-6 py-2 bg-blue-600 text-white hover:bg-blue-700 transition-colors duration-200\"\n          >\n            重新整理\n          </button>\n        </div>\n      </div>\n    )\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(main)/cart/components/cart-item-select/index.tsx","messages":[{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":32,"column":11,"nodeType":null,"messageId":"preferOptionalChain","endLine":32,"endColumn":60,"fix":{"range":[843,892],"text":"innerRef.current?.value === \"\""}}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":1,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { IconBadge, clx } from \"@medusajs/ui\"\nimport {\n  SelectHTMLAttributes,\n  forwardRef,\n  useEffect,\n  useImperativeHandle,\n  useRef,\n  useState,\n} from \"react\"\n\nimport ChevronDown from \"@modules/common/icons/chevron-down\"\n\ntype NativeSelectProps = {\n  placeholder?: string\n  errors?: Record<string, unknown>\n  touched?: Record<string, unknown>\n} & Omit<SelectHTMLAttributes<HTMLSelectElement>, \"size\">\n\nconst CartItemSelect = forwardRef<HTMLSelectElement, NativeSelectProps>(\n  ({ placeholder = \"Select...\", className, children, ...props }, ref) => {\n    const innerRef = useRef<HTMLSelectElement>(null)\n    const [isPlaceholder, setIsPlaceholder] = useState(false)\n\n    useImperativeHandle<HTMLSelectElement | null, HTMLSelectElement | null>(\n      ref,\n      () => innerRef.current\n    )\n\n    useEffect(() => {\n      if (innerRef.current && innerRef.current.value === \"\") {\n        setIsPlaceholder(true)\n      } else {\n        setIsPlaceholder(false)\n      }\n    }, [innerRef.current?.value])\n\n    return (\n      <div>\n        <IconBadge\n          onFocus={() => innerRef.current?.focus()}\n          onBlur={() => innerRef.current?.blur()}\n          className={clx(\n            \"relative flex items-center txt-compact-small border text-ui-fg-base group\",\n            className,\n            {\n              \"text-ui-fg-subtle\": isPlaceholder,\n            }\n          )}\n        >\n          <select\n            ref={innerRef}\n            {...props}\n            className=\"appearance-none bg-transparent border-none px-4 transition-colors duration-150 focus:border-gray-700 outline-none w-16 h-16 items-center justify-center\"\n          >\n            <option disabled value=\"\">\n              {placeholder}\n            </option>\n            {children}\n          </select>\n          <span className=\"absolute flex pointer-events-none justify-end w-8 group-hover:animate-pulse\">\n            <ChevronDown />\n          </span>\n        </IconBadge>\n      </div>\n    )\n  }\n)\n\nCartItemSelect.displayName = \"CartItemSelect\"\n\nexport default CartItemSelect\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(main)/cart/components/empty-cart-message/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(main)/cart/components/item/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(main)/cart/components/sign-in-prompt/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(main)/cart/loading.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(main)/cart/not-found.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(main)/cart/page.tsx","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":13,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":13,"endColumn":18,"suggestions":[{"fix":{"range":[363,383],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { retrieveCart } from \"@lib/data/cart\"\nimport { retrieveCustomer } from \"@lib/data/customer\"\nimport CartTemplate from \"@modules/cart/templates\"\nimport { Metadata } from \"next\"\n\nexport const metadata: Metadata = {\n  title: \"購物車\",\n  description: \"查看您的購物車\",\n}\n\nexport default async function Cart() {\n  const cart = await retrieveCart().catch((error) => {\n    console.error(error)\n    return null // 返回 null 而不是 notFound()，讓 CartTemplate 處理空購物車的情況\n  })\n\n  const customer = await retrieveCustomer()\n\n  return <CartTemplate cart={cart} customer={customer} />\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(main)/cart/templates/index.tsx","messages":[{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":31,"column":18,"nodeType":null,"messageId":"preferOptionalChain","endLine":31,"endColumn":37,"fix":{"range":[1054,1073],"text":"cart?.region"}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":34,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1197,1200],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1197,1200],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import ItemsTemplate from \"./items\"\nimport Summary from \"./summary\"\nimport EmptyCartMessage from \"../components/empty-cart-message\"\nimport SignInPrompt from \"../components/sign-in-prompt\"\nimport Divider from \"@modules/common/components/divider\"\nimport { HttpTypes } from \"@medusajs/types\"\n\nconst CartTemplate = ({\n  cart,\n  customer,\n}: {\n  cart: HttpTypes.StoreCart | null\n  customer: HttpTypes.StoreCustomer | null\n}) => {\n  return (\n    <div className=\"py-12\">\n      <div className=\"content-container\" data-testid=\"cart-container\">\n        {cart?.items?.length ? (\n          <div className=\"grid grid-cols-1 small:grid-cols-[1fr_360px] gap-x-40\">\n            <div className=\"flex flex-col bg-white py-6 gap-y-6\">\n              {!customer && (\n                <>\n                  <SignInPrompt />\n                  <Divider />\n                </>\n              )}\n              <ItemsTemplate cart={cart} />\n            </div>\n            <div className=\"relative\">\n              <div className=\"flex flex-col gap-y-8 sticky top-12\">\n                {cart && cart.region && (\n                  <>\n                    <div className=\"bg-white py-6\">\n                      <Summary cart={cart as any} />\n                    </div>\n                  </>\n                )}\n              </div>\n            </div>\n          </div>\n        ) : (\n          <div>\n            <EmptyCartMessage />\n          </div>\n        )}\n      </div>\n    </div>\n  )\n}\n\nexport default CartTemplate\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(main)/cart/templates/items.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(main)/cart/templates/preview.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(main)/cart/templates/summary.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(main)/categories/[...category]/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'listCategories' is defined but never used.","line":4,"column":31,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":45},{"ruleId":"unused-imports/no-unused-imports","severity":2,"message":"'listCategories' is defined but never used.","line":4,"column":31,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":45,"fix":{"range":[104,120],"text":""}},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'listRegions' is defined but never used.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":21},{"ruleId":"unused-imports/no-unused-imports","severity":2,"message":"'listRegions' is defined but never used.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":21,"fix":{"range":[151,199],"text":""}},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'StoreRegion' is defined but never used.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":21},{"ruleId":"unused-imports/no-unused-imports","severity":2,"message":"'StoreRegion' is defined but never used.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":21,"fix":{"range":[199,245],"text":""}},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":47,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":47,"endColumn":17},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":47,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":47,"endColumn":17}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":3,"fixableWarningCount":0,"source":"import { Metadata } from \"next\"\nimport { notFound } from \"next/navigation\"\n\nimport { getCategoryByHandle, listCategories } from \"@lib/data/categories\"\nimport { listRegions } from \"@lib/data/regions\"\nimport { StoreRegion } from \"@medusajs/types\"\nimport CategoryTemplate from \"@modules/categories/templates\"\nimport { SortOptions } from \"@modules/store/components/refinement-list/sort-products\"\n\n// 強制動態渲染，避免預渲染問題\nexport const dynamic = 'force-dynamic'\n\ntype Props = {\n  params: Promise<{ category: string[]; countryCode: string }>\n  searchParams: Promise<{\n    sortBy?: SortOptions\n    page?: string\n  }>\n}\n\n// 移除預產生的靜態參數，避免影響其他動態路由的建置\n// export async function generateStaticParams() { /* removed to force dynamic */ }\n\nexport async function generateMetadata(props: Props): Promise<Metadata> {\n  const params = await props.params\n  try {\n    const productCategory = await getCategoryByHandle(params.category)\n\n    if (!productCategory) {\n      return {\n        title: \"Category Not Found | Medusa Store\",\n        description: \"The requested category could not be found.\",\n      }\n    }\n\n    const title = productCategory.name + \" | Medusa Store\"\n\n    const description = productCategory.description ?? `${title} category.`\n\n    return {\n      title: `${title} | Medusa Store`,\n      description,\n      alternates: {\n        canonical: `${params.category.join(\"/\")}`,\n      },\n    }\n  } catch (error) {\n    notFound()\n  }\n}\n\nexport default async function CategoryPage(props: Props) {\n  const searchParams = await props.searchParams\n  const params = await props.params\n  const { sortBy, page } = searchParams\n\n  const productCategory = await getCategoryByHandle(params.category)\n\n  if (!productCategory) {\n    notFound()\n  }\n\n  return (\n    <CategoryTemplate\n      category={productCategory}\n      sortBy={sortBy}\n      page={page}\n      countryCode={params.countryCode}\n    />\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(main)/collections/[handle]/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'listCollections' is defined but never used.","line":4,"column":33,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":48},{"ruleId":"unused-imports/no-unused-imports","severity":2,"message":"'listCollections' is defined but never used.","line":4,"column":33,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":48,"fix":{"range":[106,123],"text":""}},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'listRegions' is defined but never used.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":21},{"ruleId":"unused-imports/no-unused-imports","severity":2,"message":"'listRegions' is defined but never used.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":21,"fix":{"range":[155,203],"text":""}},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'StoreRegion' is defined but never used.","line":6,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":38},{"ruleId":"unused-imports/no-unused-imports","severity":2,"message":"'StoreRegion' is defined but never used.","line":6,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":38,"fix":{"range":[227,240],"text":""}},{"ruleId":"sonarjs/prefer-immediate-return","severity":2,"message":"Immediately return this expression instead of assigning it to the temporary variable \"metadata\".","line":34,"column":20,"nodeType":"TSAsExpression","messageId":"doImmediateAction","endLine":37,"endColumn":16,"fix":{"range":[989,1142],"text":"return {\n    title: `${collection.title} | Medusa Store`,\n    description: `${collection.title} collection`,\n  } as Metadata"}}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":4,"fixableWarningCount":0,"source":"import { Metadata } from \"next\"\nimport { notFound } from \"next/navigation\"\n\nimport { getCollectionByHandle, listCollections } from \"@lib/data/collections\"\nimport { listRegions } from \"@lib/data/regions\"\nimport { StoreCollection, StoreRegion } from \"@medusajs/types\"\nimport CollectionTemplate from \"@modules/collections/templates\"\nimport { SortOptions } from \"@modules/store/components/refinement-list/sort-products\"\n\n// 強制動態渲染，避免預渲染問題\nexport const dynamic = 'force-dynamic'\n\ntype Props = {\n  params: Promise<{ handle: string; countryCode: string }>\n  searchParams: Promise<{\n    page?: string\n    sortBy?: SortOptions\n  }>\n}\n\nexport const PRODUCT_LIMIT = 12\n\n// 移除預產生的靜態參數，避免影響其他動態路由的建置\n// export async function generateStaticParams() { /* removed to force dynamic */ }\n\nexport async function generateMetadata(props: Props): Promise<Metadata> {\n  const params = await props.params\n  const collection = await getCollectionByHandle(params.handle)\n\n  if (!collection) {\n    notFound()\n  }\n\n  const metadata = {\n    title: `${collection.title} | Medusa Store`,\n    description: `${collection.title} collection`,\n  } as Metadata\n\n  return metadata\n}\n\nexport default async function CollectionPage(props: Props) {\n  const searchParams = await props.searchParams\n  const params = await props.params\n  const { sortBy, page } = searchParams\n\n  const collection = await getCollectionByHandle(params.handle).then(\n    (collection: StoreCollection) => collection\n  )\n\n  if (!collection) {\n    notFound()\n  }\n\n  return (\n    <CollectionTemplate\n      collection={collection}\n      page={page}\n      sortBy={sortBy}\n      countryCode={params.countryCode}\n    />\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(main)/layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(main)/login-affiliate/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(main)/not-found.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(main)/order/[id]/confirmed/loading.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(main)/order/[id]/confirmed/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(main)/order/[id]/transfer/[token]/accept/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(main)/order/[id]/transfer/[token]/decline/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(main)/order/[id]/transfer/[token]/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(main)/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'HomePageData' is defined but never used.","line":14,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":27},{"ruleId":"unused-imports/no-unused-imports","severity":2,"message":"'HomePageData' is defined but never used.","line":14,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":27,"fix":{"range":[767,820],"text":""}},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":30,"column":46,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":30,"endColumn":48,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1519,1564],"text":"(homepageData?.seoTitle ?? homepageData?.title)"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":31,"column":58,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":31,"endColumn":60,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1654,1656],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":32,"column":43,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":32,"endColumn":45,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1780,1782],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":33,"column":55,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":33,"endColumn":57,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1847,1849],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":73,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":73,"endColumn":18,"suggestions":[{"fix":{"range":[2997,3037],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"sonarjs/cognitive-complexity","severity":2,"message":"Refactor this function to reduce its Cognitive Complexity from 17 to the 15 allowed.","line":87,"column":31,"nodeType":null,"messageId":"refactorFunction","endLine":87,"endColumn":35},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":101,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":101,"endColumn":19,"suggestions":[{"fix":{"range":[3825,3865],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":105,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":105,"endColumn":19,"suggestions":[{"fix":{"range":[3973,4013],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":117,"column":47,"nodeType":"MemberExpression","messageId":"unexpected","endLine":117,"endColumn":58},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":119,"column":56,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":119,"endColumn":58,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[4472,4474],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":129,"column":49,"nodeType":"MemberExpression","messageId":"unexpected","endLine":129,"endColumn":60},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":131,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":131,"endColumn":16,"suggestions":[{"fix":{"range":[4821,5068],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":134,"column":24,"nodeType":null,"messageId":"preferOptionalChain","endLine":134,"endColumn":65,"suggestions":[{"fix":{"range":[4979,5020],"text":"homepageData?.mainSections"},"messageId":"optionalChainSuggest","desc":"Change to an optional chain."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":137,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":137,"endColumn":18,"suggestions":[{"fix":{"range":[5093,5149],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":142,"column":25,"nodeType":null,"messageId":"preferOptionalChain","endLine":142,"endColumn":66,"suggestions":[{"fix":{"range":[5225,5266],"text":"homepageData?.mainSections"},"messageId":"optionalChainSuggest","desc":"Change to an optional chain."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":144,"column":3,"nodeType":"MemberExpression","messageId":"unexpected","endLine":144,"endColumn":14,"suggestions":[{"fix":{"range":[5310,5501],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":146,"column":54,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":146,"endColumn":56,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[5436,5438],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":153,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":153,"endColumn":17,"suggestions":[{"fix":{"range":[5555,5626],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":172,"column":51,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":172,"endColumn":53,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[6323,6325],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":187,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":187,"endColumn":16,"suggestions":[{"fix":{"range":[6529,6626],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":194,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":194,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6783,6786],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6783,6786],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":197,"column":17,"nodeType":"MemberExpression","messageId":"unexpected","endLine":197,"endColumn":29,"suggestions":[{"fix":{"range":[6964,7038],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"sonarjs/prefer-single-boolean-return","severity":2,"message":"Replace this if-then-else flow by a single return statement.","line":201,"column":15,"nodeType":"IfStatement","messageId":"replaceIfThenElseByReturn","endLine":203,"endColumn":16,"suggestions":[{"messageId":"suggest","fix":{"range":[7133,7239],"text":"return !(section.isActive === false);"},"desc":"Replace with single return statement"}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":206,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":206,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7282,7285],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7282,7285],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"sonarjs/cognitive-complexity","severity":2,"message":"Refactor this function to reduce its Cognitive Complexity from 16 to the 15 allowed.","line":206,"column":48,"nodeType":null,"messageId":"refactorFunction","endLine":206,"endColumn":50},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":209,"column":17,"nodeType":"MemberExpression","messageId":"unexpected","endLine":209,"endColumn":28,"suggestions":[{"fix":{"range":[7392,7484],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":217,"column":23,"nodeType":"MemberExpression","messageId":"unexpected","endLine":217,"endColumn":34,"suggestions":[{"fix":{"range":[7791,7837],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":234,"column":23,"nodeType":"MemberExpression","messageId":"unexpected","endLine":234,"endColumn":36,"suggestions":[{"fix":{"range":[8536,8595],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":263,"column":21,"nodeType":"MemberExpression","messageId":"unexpected","endLine":263,"endColumn":32,"suggestions":[{"fix":{"range":[9793,9862],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":266,"column":23,"nodeType":"MemberExpression","messageId":"unexpected","endLine":266,"endColumn":36,"suggestions":[{"fix":{"range":[9962,10027],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":271,"column":25,"nodeType":null,"messageId":"preferOptionalChain","endLine":271,"endColumn":65,"fix":{"range":[10149,10189],"text":"!collections?.collections"}},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":272,"column":23,"nodeType":"MemberExpression","messageId":"unexpected","endLine":272,"endColumn":35,"suggestions":[{"fix":{"range":[10258,10321],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":276,"column":21,"nodeType":"MemberExpression","messageId":"unexpected","endLine":276,"endColumn":32,"suggestions":[{"fix":{"range":[10417,10553],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":276,"column":143,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":276,"endColumn":146,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10539,10542],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10539,10542],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":279,"column":86,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":279,"endColumn":89,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10666,10669],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10666,10669],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":283,"column":23,"nodeType":"MemberExpression","messageId":"unexpected","endLine":283,"endColumn":34,"suggestions":[{"fix":{"range":[10782,10892],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":283,"column":119,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":283,"endColumn":122,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10878,10881],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10878,10881],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":286,"column":25,"nodeType":"MemberExpression","messageId":"unexpected","endLine":286,"endColumn":36,"suggestions":[{"fix":{"range":[10980,11045],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":290,"column":23,"nodeType":"MemberExpression","messageId":"unexpected","endLine":290,"endColumn":34,"suggestions":[{"fix":{"range":[11129,11218],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":295,"column":35,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":295,"endColumn":46},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":300,"column":23,"nodeType":"MemberExpression","messageId":"unexpected","endLine":300,"endColumn":36,"suggestions":[{"fix":{"range":[11599,11657],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":320,"column":82,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":320,"endColumn":84,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[12502,12627],"text":"(youtubeBlock.videoSettings?.desktopVideoUrl ?? \n                                   youtubeBlock.videoSettings?.mobileVideoUrl)"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":321,"column":79,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":321,"endColumn":81,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[12628,12630],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":324,"column":21,"nodeType":"MemberExpression","messageId":"unexpected","endLine":324,"endColumn":32,"suggestions":[{"fix":{"range":[12730,13188],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":334,"column":23,"nodeType":"MemberExpression","messageId":"unexpected","endLine":334,"endColumn":36,"suggestions":[{"fix":{"range":[13269,13344],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":358,"column":55,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":358,"endColumn":57,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[14429,14431],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":365,"column":21,"nodeType":"MemberExpression","messageId":"unexpected","endLine":365,"endColumn":32,"suggestions":[{"fix":{"range":[14671,14746],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":369,"column":21,"nodeType":"MemberExpression","messageId":"unexpected","endLine":369,"endColumn":34,"suggestions":[{"fix":{"range":[14846,14897],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":373,"column":17,"nodeType":"MemberExpression","messageId":"unexpected","endLine":373,"endColumn":30,"suggestions":[{"fix":{"range":[14996,15057],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":18,"fatalErrorCount":0,"warningCount":33,"fixableErrorCount":2,"fixableWarningCount":0,"source":"import { Metadata } from \"next\"\n\nimport HeroSection from \"@modules/home/components/hero-section\"\nimport BlogPosts from \"@modules/blog/components/blog-posts\"\nimport FeaturedProducts from \"@modules/home/components/featured-products\"\nimport ImageTextBlock from \"@modules/home/components/image-text-block\"\nimport YoutubeSection from \"@modules/home/components/youtube-section\"\nimport ServiceCardsSection from \"@modules/home/components/service-cards-section\"\nimport ContentSection from \"@modules/home/components/content-section\"\nimport { listCollections } from \"@lib/data/collections\"\nimport { getRegion } from \"@lib/data/regions\"\nimport { getHomepage } from \"@lib/sanity\"; // 使用 getHomepage 並移除 getServiceSection\nimport type { MainBanner } from '@lib/types/page-sections'\nimport type { HomePageData } from '@lib/types/pages'\nimport type { ImageTextBlock as ImageTextBlockType } from '@lib/types/page-sections'\nimport type { FeaturedProductsSection } from '@lib/types/page-sections'\nimport type { BlogSection } from '@lib/types/page-sections'\nimport type { YoutubeSection as YoutubeSectionType } from '@lib/types/page-sections'\nimport type { ServiceCards } from '@lib/types/service-cards'\nimport type { ContentSection as ContentSectionType } from '@lib/types/sections'\nimport { getStoreName } from \"@lib/store-name\"\n\n\nexport async function generateMetadata(): Promise<Metadata> {\n  try {\n    const homepageData = await getHomepage()\n    const storeName = await getStoreName()\n    \n    // 從Sanity獲取SEO資料\n    const pageTitle = homepageData?.seoTitle || homepageData?.title || `${storeName} - 專業美髮沙龍與造型產品`\n    const pageDescription = homepageData?.seoDescription || '專業美髮沙龍服務，提供剪髮、染髮、燙髮等服務。銷售優質美髮產品，包含洗髮精、護髮乳、造型產品等。Tim\\'s Fantasy World 為您打造完美髮型。'\n    const ogTitle = homepageData?.ogTitle || pageTitle\n    const ogDescription = homepageData?.ogDescription || pageDescription\n    \n    return {\n      title: pageTitle,\n      description: pageDescription,\n      keywords: [\n        '美髮沙龍', '剪髮', '染髮', '燙髮', '造型', \n        '洗髮精', '護髮乳', '造型產品', '美髮用品',\n        'Tim\\'s Fantasy World', '專業美髮', '髮型設計'\n      ].join(', '),\n      openGraph: {\n        title: ogTitle,\n        description: ogDescription,\n        type: 'website',\n        locale: 'zh_TW',\n        siteName: storeName,\n        images: homepageData?.ogImage?.asset?.url ? [{\n          url: homepageData.ogImage.asset.url,\n          alt: homepageData.ogImage.alt || pageTitle\n        }] : undefined\n      },\n      twitter: {\n        card: 'summary_large_image',\n        title: ogTitle,\n        description: ogDescription,\n        images: homepageData?.ogImage?.asset?.url ? [homepageData.ogImage.asset.url] : undefined\n      },\n      robots: {\n        index: !homepageData?.noIndex,\n        follow: !homepageData?.noFollow,\n        googleBot: {\n          index: !homepageData?.noIndex,\n          follow: !homepageData?.noFollow,\n        }\n      },\n      alternates: {\n        canonical: homepageData?.canonicalUrl\n      }\n    }\n  } catch (error) {\n    console.error('生成metadata時發生錯誤:', error)\n    const storeName = await getStoreName()\n    \n    return {\n      title: `${storeName} - 專業美髮沙龍與造型產品`,\n      description: '專業美髮沙龍服務，提供剪髮、染髮、燙髮等服務。銷售優質美髮產品，包含洗髮精、護髮乳、造型產品等。Tim\\'s Fantasy World 為您打造完美髮型。',\n      openGraph: {\n        title: `${storeName} - 專業美髮沙龍與造型產品`,\n        description: '專業美髮沙龍服務，提供剪髮、染髮、燙髮等服務。銷售優質美髮產品，包含洗髮精、護髮乳、造型產品等。',\n      }\n    }\n  }\n}\n\nexport default async function Home({\n  params,\n}: {\n  params: Promise<{ countryCode: string }>\n}) {\n  const { countryCode } = await params\n  \n  // 並行獲取數據以提升性能，添加超時控制\n  const timeoutPromise = new Promise((_, reject) => {\n    setTimeout(() => reject(new Error('請求超時')), 5000);\n  });\n  \n  const [collectionsData, region] = await Promise.allSettled([\n    Promise.race([listCollections({}), timeoutPromise]).catch(err => {\n      console.warn('獲取商品集合時出錯:', err.message);\n      return null;\n    }),\n    Promise.race([getRegion(countryCode), timeoutPromise]).catch(err => {\n      console.warn('獲取地區資訊時出錯:', err.message);\n      return null;\n    })\n  ])\n\n  // 處理數據獲取結果\n  const collections = collectionsData.status === 'fulfilled' && collectionsData.value ? \n    collectionsData.value : { collections: [], count: 0 }\n  const regionData = region.status === 'fulfilled' && region.value ? \n    region.value : null\n\n  // 添加調試資訊\n  if (process.env.NODE_ENV === 'development') console.log('🔍 Data fetch results:', {\n    countryCode,\n    collectionsCount: collections?.collections?.length || 0,\n    regionId: regionData?.id,\n    regionName: regionData?.name,\n    collectionsStatus: collectionsData.status,\n    regionStatus: region.status\n  })\n\n  // 獲取首頁內容，並添加錯誤處理\n  let homepageData\n  try {\n    if (process.env.NODE_ENV === 'development') console.log('🔍 Fetching homepage data from Sanity...')\n    homepageData = await getHomepage()\n    console.log('✅ Homepage data fetched:', { \n      title: homepageData?.title, \n      sectionsCount: homepageData?.mainSections?.length,\n      hasValidData: !!(homepageData && homepageData.mainSections && homepageData.mainSections.length > 0)\n    })\n  } catch (error) {\n    console.error('❌ Failed to fetch homepage data:', error)\n    homepageData = null\n  }\n\n  // 檢查是否有有效的Sanity數據\n  const hasSanityData = homepageData && homepageData.mainSections && homepageData.mainSections.length > 0\n\n  console.log('🎯 Data check result:', {\n    homepageData: !!homepageData,\n    mainSections: homepageData?.mainSections?.length || 0,\n    hasSanityData,\n    willUseFallback: !hasSanityData\n  })\n\n  // 如果沒有數據或數據無效，顯示備用內容\n  if (!hasSanityData) {\n    console.warn('⚠️ No valid Sanity data found, showing fallback content')\n    \n    return (\n      <>\n        <div className=\"mt-16\">\n          <a \n            href=\"https://page.line.me/timsfantasyworld?fbclid=PARlRTSAMmHoRleHRuA2FlbQIxMAABp_nJitfDUH8W4pRlcRgKeusvIELFdTvXpbu791GiXgPIOarBh8LO2Hg2YJrV_aem_9pdT5ans7oJyF7F17iQPHw\" \n            target=\"_blank\" \n            rel=\"noopener noreferrer\"\n            className=\"inline-block bg-gray-900 text-white px-8 py-4 rounded-lg font-semibold text-lg hover:bg-gray-800 transition-colors\"\n          >\n            立即預約 LINE 諮詢\n          </a>\n        </div>\n        \n        {/* 精選商品區塊 */}\n        {regionData && (\n          <FeaturedProducts\n            region={regionData}\n            collections={collections?.collections || []}\n          />\n        )}\n      </>\n    )\n  }\n\n  // 如果有有效的Sanity數據，使用它\n  if (hasSanityData && homepageData) {\n    const { mainSections } = homepageData\n\n    if (!region) {\n      return null\n    }\n\n    console.log(\"🎨 Rendering Sanity content - mainSections:\", JSON.stringify(mainSections, null, 2))\n\n    return (\n      <>\n        {/* 動態區塊（如果存在） */}\n        {mainSections && mainSections.length > 0 ? (\n          mainSections\n            .filter((section: any, index: number) => {\n              // 過濾掉空物件或無效的 section\n              if (!section || typeof section !== \"object\" || !(\"_type\" in section) || !section._type) {\n                console.warn(`Filtering out invalid section at index ${index}:`, section);\n                return false;\n              }\n              // 過濾掉非作用中的 section\n              if (section.isActive === false) {\n                return false;\n              }\n              return true;\n            })\n            .map((section: any, index: number) => {\n              const sectionType = section._type;\n              try {\n                console.log(`🎯 Rendering section ${index}: ${sectionType}`, { isActive: section.isActive })\n                \n                switch (sectionType) {\n                  case \"serviceCardSection\": {\n                    const serviceSection = section as ServiceCards;\n                    \n                    // 檢查是否被停用\n                    if (serviceSection.isActive === false) {\n                      console.log(\"❌ ServiceCardSection 已被停用，跳過渲染\");\n                      return null;\n                    }\n                    \n                    // 直接渲染從 Sanity 獲取的資料\n                    return (\n                      <ServiceCardsSection\n                        key={`service-${index}`}\n                        heading={serviceSection.heading}\n                        cardsPerRow={serviceSection.cardsPerRow}\n                        cards={serviceSection.cards}\n                      />\n                    );\n                  }\n                  case \"mainBanner\": {\n                    const bannerSection = section as MainBanner\n                    if (!bannerSection.slides || !Array.isArray(bannerSection.slides)) {\n                      console.error(\"Invalid mainBanner section:\", bannerSection)\n                      return null\n                    }\n                    return (\n                      <HeroSection\n                        key={index}\n                        banner={bannerSection}\n                      />\n                    )\n                  }\n                  case \"imageTextBlock\": {\n                    const imageBlock = section as ImageTextBlockType\n                    return (\n                      <ImageTextBlock\n                        key={index}\n                        heading={imageBlock.heading}\n                        content={imageBlock.content}\n                        image={imageBlock.image}\n                        layout={imageBlock.layout}\n                        leftImage={imageBlock.leftImage}\n                        rightImage={imageBlock.rightImage}\n                        leftContent={imageBlock.leftContent}\n                        rightContent={imageBlock.rightContent}\n                        hideTitle={imageBlock.hideTitle}\n                      />\n                    )\n                  }\n                  case \"featuredProducts\": {\n                    const featuredBlock = section as FeaturedProductsSection\n                    console.log(\"🎯 Processing featuredProducts section:\", featuredBlock)\n                    \n                    if (!featuredBlock.collection_id) {\n                      console.error(\"Invalid featuredProducts section:\", featuredBlock)\n                      return null\n                    }\n\n                    // 安全檢查 collections\n                    if (!collections || !collections.collections || !Array.isArray(collections.collections)) {\n                      console.warn(\"Featured products skipped - backend unavailable\")\n                      return null  // 安靜地跳過，不阻塞其他區塊\n                    }\n\n                    console.log(\"🔍 Looking for collection:\", featuredBlock.collection_id, \"in collections:\", collections.collections.map((c: any) => c.id))\n\n                    try {\n                      const featuredCollections = collections.collections.filter((c: any) =>\n                        featuredBlock.collection_id === c.id\n                      )\n\n                      console.log(\"📦 Filtered collections:\", featuredCollections.length, featuredCollections.map((c: any) => c.id))\n\n                      if (featuredCollections.length === 0) {\n                        console.log(\"No matching collection found for featured products\")\n                        return null\n                      }\n\n                      console.log(\"✅ Rendering FeaturedProducts with collections:\", featuredCollections.length)\n                      return (\n                        <FeaturedProducts\n                          key={index}\n                          collections={featuredCollections}\n                          region={regionData!}\n                          settings={featuredBlock}\n                        />\n                      )\n                    } catch (error) {\n                      console.error(\"Featured products rendering error:\", error)\n                      return null  // 安靜地跳過，不阻塞其他區塊\n                    }\n                  }\n                  case \"blogSection\": {\n                    const blogSection = section as BlogSection\n                    return (\n                      <BlogPosts \n                        key={index}\n                        title={blogSection.title}\n                        category={blogSection.category}\n                        limit={blogSection.limit || 2}\n                        postsPerRow={blogSection.postsPerRow || 3}\n                        showTitle={!!blogSection.title}\n                      />\n                    )\n                  }\n                  case \"youtubeSection\": {\n                    const youtubeBlock = section as YoutubeSectionType\n                    // 檢查是否有響應式設定或舊的 videoUrl\n                    const hasVideo = youtubeBlock.videoSettings?.desktopVideoUrl || \n                                   youtubeBlock.videoSettings?.mobileVideoUrl || \n                                   youtubeBlock.videoUrl\n                    \n                    console.log('🏠 Homepage YouTube section data:', {\n                      hasVideo,\n                      videoUrl: youtubeBlock.videoUrl,\n                      videoSettings: youtubeBlock.videoSettings,\n                      desktopUrl: youtubeBlock.videoSettings?.desktopVideoUrl,\n                      mobileUrl: youtubeBlock.videoSettings?.mobileVideoUrl,\n                      useSameVideo: youtubeBlock.videoSettings?.useSameVideo\n                    })\n                    \n                    if (!hasVideo) {\n                      console.error(\"Invalid YouTube section (missing video URL):\", youtubeBlock)\n                      return null\n                    }\n                    return (\n                      <YoutubeSection\n                        key={index}\n                        _type=\"youtubeSection\"\n                        isActive={true}\n                        heading={youtubeBlock.heading}\n                        description={youtubeBlock.description}\n                        videoUrl={youtubeBlock.videoUrl}\n                        videoMode={youtubeBlock.videoMode}\n                        youtubeSettings={youtubeBlock.youtubeSettings}\n                        uploadSettings={youtubeBlock.uploadSettings}\n                        videoSettings={youtubeBlock.videoSettings}\n                        fullWidth={youtubeBlock.fullWidth}\n                      />\n                    )\n                  }\n                  case \"contentSection\": {\n                    const contentBlock = section as ContentSectionType\n                    return (\n                      <ContentSection\n                        key={index}\n                        heading={contentBlock.heading || \"\"}\n                        content={contentBlock.content}\n                      />\n                    )\n                  }\n                  case \"googleMapsSection\": {\n                    // 地圖區塊在 Sanity 中可用但不在前端顯示\n                    console.log(\"🗺️ GoogleMapsSection found but skipped for frontend display\")\n                    return null\n                  }\n                  default:\n                    console.error(\"Unknown section type:\", sectionType)\n                    return null\n                }\n              } catch (error) {\n                console.error(\"Error rendering section:\", sectionType, error)\n                return null\n              }\n            })\n        ) : null}\n\n        {/* 硬編碼的地圖已移除 - 現在地圖功能通過 Sanity 管理但不在前端顯示 */}\n      </>\n    )\n  }\n\n  // 如果沒有有效數據，返回null或空內容\n  return null\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(main)/products/[handle]/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'listProducts' is defined but never used.","line":3,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":34},{"ruleId":"unused-imports/no-unused-imports","severity":2,"message":"'listProducts' is defined but never used.","line":3,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":34,"fix":{"range":[94,108],"text":""}},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'listRegions' is defined but never used.","line":4,"column":21,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":32},{"ruleId":"unused-imports/no-unused-imports","severity":2,"message":"'listRegions' is defined but never used.","line":4,"column":21,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":32,"fix":{"range":[155,168],"text":""}},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":45,"column":42,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":45,"endColumn":44,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1289,1291],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":49,"column":44,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":49,"endColumn":46,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1471,1473],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":54,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":54,"endColumn":20,"suggestions":[{"fix":{"range":[1620,1697],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":63,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":63,"endColumn":18,"suggestions":[{"fix":{"range":[1855,1936],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":101,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":101,"endColumn":20,"suggestions":[{"fix":{"range":[2640,2717],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":105,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":105,"endColumn":18,"suggestions":[{"fix":{"range":[2765,2843],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":2,"fixableWarningCount":0,"source":"import { Metadata } from \"next\"\nimport { notFound } from \"next/navigation\"\nimport { getProduct, listProducts } from \"@lib/data/products\"\nimport { getRegion, listRegions } from \"@lib/data/regions\"\nimport { generateProductKeywords } from \"@lib/seo\"\nimport ProductTemplate from \"@modules/products/templates\"\nimport { getStoreName } from \"@lib/store-name\"\n\n// 強制動態渲染，避免預渲染問題\nexport const dynamic = 'force-dynamic'\n\ntype Props = {\n  params: Promise<{ countryCode: string; handle: string }>\n}\n\n// 移除 generateStaticParams，使用完全動態渲染\n\nexport async function generateMetadata({ params }: Props): Promise<Metadata> {\n  try {\n    const { handle, countryCode } = await params\n    const region = await getRegion(countryCode)\n    const storeName = await getStoreName()\n\n    if (!region) {\n      return {\n        title: `商品不存在 | ${storeName}`,\n        description: \"找不到您請求的商品\",\n      }\n    }\n\n    // 嘗試使用 getProduct 函數直接獲取產品\n    try {\n      const product = await getProduct({\n        handle,\n        countryCode,\n      })\n\n      const keywords = generateProductKeywords(product, {\n        presetKeywords: {},\n        extractFields: ['title', 'subtitle', 'description', 'tags', 'collection']\n      })\n\n      return {\n        title: `${product.title} | ${storeName}`,\n        description: product.description || `${product.title} - ${storeName}`,\n        keywords: keywords,\n        openGraph: {\n          title: `${product.title} | ${storeName}`,\n          description: product.description || `${product.title} - ${storeName}`,\n          images: product.thumbnail ? [product.thumbnail] : [],\n        },\n      }\n    } catch (error) {\n      console.error(`無法獲取產品詳情: ${error instanceof Error ? error.message : \"未知錯誤\"}`)\n      \n      // 回退到基本元數據\n      return {\n        title: `商品 | ${storeName}`,\n        description: `${storeName} 的商品頁面`,\n      }\n    }\n  } catch (error) {\n    console.error(`生成商品頁面元數據時出錯: ${error instanceof Error ? error.message : \"未知錯誤\"}`)\n    \n    // 由於不知道是否能獲取 storeName，所以返回固定文字\n    return {\n      title: \"商品頁面\",\n      description: \"商品頁面\",\n    }\n  }\n}\n\nexport default async function ProductPage({ params }: Props) {\n  try {\n    const { countryCode, handle } = await params\n    const region = await getRegion(countryCode)\n\n    if (!region) {\n      notFound()\n    }\n\n    // 使用 getProduct 函數獲取完整產品資訊\n    try {\n      const pricedProduct = await getProduct({\n        handle,\n        countryCode,\n      })\n\n      if (!pricedProduct) {\n        notFound()\n      }\n\n      return (\n        <ProductTemplate\n          product={pricedProduct}\n          region={region}\n          countryCode={countryCode}\n        />\n      )\n    } catch (error) {\n      console.error(`無法獲取產品資料: ${error instanceof Error ? error.message : \"未知錯誤\"}`)\n      notFound()\n    }\n  } catch (error) {\n    console.error(`獲取商品資料時出錯: ${error instanceof Error ? error.message : \"未知錯誤\"}`)\n    notFound()\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(main)/regitster-affiliate/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/(main)/store/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/account/addresses/page.tsx","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":26,"column":47,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":26,"endColumn":49,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[925,927],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":30,"column":35,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":30,"endColumn":37,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1111,1138],"text":"(currentRegion ?? regions[0])"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":30,"column":49,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":30,"endColumn":51,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1139,1141],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":33,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":33,"endColumn":22,"suggestions":[{"fix":{"range":[1188,1219],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { useEffect, useState } from \"react\"\nimport { useParams } from \"next/navigation\"\nimport AddressBook from \"@modules/account/components/address-book\"\nimport { useAccount } from \"@lib/context/account-context\"\nimport { HttpTypes } from \"@medusajs/types\"\n\nexport default function Addresses() {\n  const params = useParams()\n  const countryCode = params.countryCode as string\n  const { customer } = useAccount()\n  const [region, setRegion] = useState<HttpTypes.StoreRegion | null>(null)\n  const [loading, setLoading] = useState(true)\n\n  useEffect(() => {\n    const fetchRegions = async () => {\n      try {\n        const regionsResponse = await fetch('/api/regions', {\n          credentials: 'include',\n          headers: { 'Content-Type': 'application/json' }\n        })\n\n        if (regionsResponse.ok) {\n          const regionsData = await regionsResponse.json()\n          const regions = regionsData.regions || []\n          const currentRegion = regions.find((r: HttpTypes.StoreRegion) => \n            r.countries?.some(country => country.iso_2 === countryCode)\n          )\n          setRegion(currentRegion || regions[0] || null)\n        }\n      } catch (err) {\n        console.error('獲取地址資料失敗:', err)\n      } finally {\n        setLoading(false)\n      }\n    }\n\n    fetchRegions()\n  }, [countryCode])\n\n  if (loading || !customer) {\n    return (\n      <div className=\"w-full flex items-center justify-center py-12\">\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900\"></div>\n      </div>\n    )\n  }\n\n  if (!region) {\n    return (\n      <div className=\"w-full flex items-center justify-center py-12\">\n        <div className=\"text-red-500\">載入資料時發生錯誤</div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"flex-1\" data-testid=\"addresses-page-wrapper\">\n      <div className=\"mb-8 flex flex-col gap-y-4\">\n        <h1 className=\"text-2xl-semi\">地址簿</h1>\n        <p className=\"text-base-regular\">\n          查看和更新您的送貨地址，您可以新增多個地址來加速結帳流程。\n        </p>\n      </div>\n      <AddressBook customer={customer} region={region} />\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/account/client-layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/account/layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/account/orders/details/[id]/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/account/orders/page.tsx","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":25,"column":39,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":25,"endColumn":41,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[947,949],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":28,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":28,"endColumn":22,"suggestions":[{"fix":{"range":[994,1025],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { useEffect, useState } from \"react\"\nimport OrderOverview from \"@modules/account/components/order-overview\"\nimport Divider from \"@modules/common/components/divider\"\nimport TransferRequestForm from \"@modules/account/components/transfer-request-form\"\nimport { useAccount } from \"@lib/context/account-context\"\nimport { HttpTypes } from \"@medusajs/types\"\n\nexport default function Orders() {\n  const { customer } = useAccount()\n  const [orders, setOrders] = useState<HttpTypes.StoreOrder[] | null>(null)\n  const [loading, setLoading] = useState(true)\n\n  useEffect(() => {\n    const fetchOrders = async () => {\n      try {\n        const ordersResponse = await fetch('/api/customer/orders', {\n          credentials: 'include',\n          headers: { 'Content-Type': 'application/json' }\n        })\n        \n        if (ordersResponse.ok) {\n          const ordersData = await ordersResponse.json()\n          setOrders(ordersData.orders || [])\n        }\n      } catch (err) {\n        console.error('獲取訂單資料失敗:', err)\n      } finally {\n        setLoading(false)\n      }\n    }\n\n    fetchOrders()\n  }, [])\n\n  if (loading) {\n    return (\n      <div className=\"w-full flex items-center justify-center py-12\">\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900\"></div>\n      </div>\n    )\n  }\n\n  if (!customer) {\n    return (\n      <div className=\"w-full flex items-center justify-center py-12\">\n        <div className=\"text-red-500\">載入資料時發生錯誤</div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"flex-1\" data-testid=\"orders-page-wrapper\">\n      <div className=\"mb-8 flex flex-col gap-y-4\">\n        <h1 className=\"text-2xl-semi\">訂單</h1>\n        <p className=\"text-base-regular\">\n          查看您之前的訂單和其狀態。您也可以建立退貨或交換請求（如果需要的話）。\n        </p>\n      </div>\n      <div className=\"w-full\">\n        {orders && orders.length > 0 ? (\n          <div className=\"flex flex-col gap-y-8\">\n            <OrderOverview orders={orders} />\n            <Divider />\n            <TransferRequestForm />\n          </div>\n        ) : (\n          <div data-testid=\"no-orders-container\">\n            <p className=\"text-base-regular\">您目前沒有任何訂單。</p>\n          </div>\n        )}\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/account/page.tsx","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":20,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":20,"endColumn":18,"suggestions":[{"fix":{"range":[647,681],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":35,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":35,"endColumn":22,"suggestions":[{"fix":{"range":[1177,1200],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":43,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":43,"endColumn":22,"suggestions":[{"fix":{"range":[1447,1472],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":59,"column":39,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":59,"endColumn":41,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1890,1892],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":62,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":62,"endColumn":22,"suggestions":[{"fix":{"range":[1937,1968],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":79,"column":55,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":79,"endColumn":57,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2340,2342],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { useEffect, useState } from \"react\"\nimport { useSearchParams } from \"next/navigation\"\nimport Overview from \"@modules/account/components/overview\"\nimport { useAccount } from \"@lib/context/account-context\"\nimport { HttpTypes } from \"@medusajs/types\"\n\nexport const dynamic = 'force-dynamic'\n\nexport default function AccountPage() {\n  const { customer } = useAccount()\n  const searchParams = useSearchParams()\n  const [orders, setOrders] = useState<HttpTypes.StoreOrder[] | null>(null)\n  const [loading, setLoading] = useState(true)\n\n  // 檢查是否有強制登出參數\n  useEffect(() => {\n    if (searchParams.get('force_logout') === '1') {\n      console.log('🔄 檢測到強制登出參數，清除所有狀態')\n      \n      if (typeof window !== 'undefined') {\n        // 完全清除所有狀態\n        try {\n          localStorage.clear()\n          sessionStorage.clear()\n          \n          // 清除所有 cookies\n          document.cookie.split(';').forEach(cookie => {\n            const eqPos = cookie.indexOf('=')\n            const name = eqPos > -1 ? cookie.substr(0, eqPos).trim() : cookie.trim()\n            document.cookie = `${name}=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/`\n          })\n          \n          console.log('✅ 強制清除完成')\n          \n          // 移除 URL 參數並重新加載\n          const url = new URL(window.location.href)\n          url.searchParams.delete('force_logout')\n          window.history.replaceState({}, '', url.toString())\n          \n        } catch (e) {\n          console.log('強制清除失敗:', e)\n        }\n      }\n    }\n  }, [searchParams])\n\n  useEffect(() => {\n    const fetchOrders = async () => {\n      try {\n        const ordersResponse = await fetch('/api/customer/orders', {\n          credentials: 'include',\n          headers: { 'Content-Type': 'application/json' }\n        })\n\n        if (ordersResponse.ok) {\n          const ordersData = await ordersResponse.json()\n          setOrders(ordersData.orders || [])\n        }\n      } catch (err) {\n        console.error('獲取訂單資料失敗:', err)\n      } finally {\n        setLoading(false)\n      }\n    }\n\n    fetchOrders()\n  }, [])\n\n  if (loading || !customer) {\n    return (\n      <div className=\"w-full flex items-center justify-center py-12\">\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900\"></div>\n      </div>\n    )\n  }\n\n  return <Overview customer={customer} orders={orders || []} />\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/account/profile/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'customerLoading' is assigned a value but never used.","line":12,"column":30,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":45},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'customerLoading' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":12,"column":30,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":45},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":26,"column":42,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":26,"endColumn":44,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1050,1052],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":29,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":29,"endColumn":22,"suggestions":[{"fix":{"range":[1097,1128],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { useEffect, useState } from \"react\"\nimport ProfilePhone from \"@modules/account/components/profile-phone\"\nimport ProfileBillingAddress from \"@modules/account/components/profile-billing-address\"\nimport ProfileEmail from \"@modules/account/components/profile-email\"\nimport ProfileName from \"@modules/account/components/profile-name\"\nimport { useAccount } from \"@lib/context/account-context\"\nimport { HttpTypes } from \"@medusajs/types\"\n\nexport default function Profile() {\n  const { customer, loading: customerLoading } = useAccount()\n  const [regions, setRegions] = useState<HttpTypes.StoreRegion[] | null>(null)\n  const [loading, setLoading] = useState(true)\n\n  useEffect(() => {\n    const fetchRegions = async () => {\n      try {\n        const regionsResponse = await fetch('/api/regions', {\n          credentials: 'include',\n          headers: { 'Content-Type': 'application/json' }\n        })\n\n        if (regionsResponse.ok) {\n          const regionsData = await regionsResponse.json()\n          setRegions(regionsData.regions || [])\n        }\n      } catch (err) {\n        console.error('獲取區域資料失敗:', err)\n      } finally {\n        setLoading(false)\n      }\n    }\n\n    fetchRegions()\n  }, [])\n\n  if (loading || !customer) {\n    return (\n      <div className=\"w-full flex items-center justify-center py-12\">\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900\"></div>\n      </div>\n    )\n  }\n\n  if (!regions) {\n    return (\n      <div className=\"w-full flex items-center justify-center py-12\">\n        <div className=\"text-red-500\">載入區域資料失敗</div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"flex-1\" data-testid=\"profile-page-wrapper\">\n      <div className=\"mb-8 flex flex-col gap-y-4\">\n        <h1 className=\"text-2xl-semi\">個人檔案</h1>\n        <p className=\"text-base-regular\">\n          查看和更新您的個人檔案資訊，包括姓名、電子郵件和電話號碼。您也可以更新帳單地址，或變更密碼。\n        </p>\n      </div>\n      <div className=\"w-full\">\n        <div className=\"flex flex-col gap-y-8 w-full\">\n          <ProfileName customer={customer} />\n          <Divider />\n          <ProfileEmail customer={customer} />\n          <Divider />  \n          <ProfilePhone customer={customer} />\n          <Divider />\n          <ProfileBillingAddress customer={customer} regions={regions} />\n        </div>\n      </div>\n    </div>\n  )\n}\n\nconst Divider = () => {\n  return <div className=\"w-full h-px bg-gray-200\" />\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/forgot-password/page.tsx","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":38,"column":43,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":38,"endColumn":45,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1125,1127],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":43,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1233,1236],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1233,1236],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":44,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":44,"endColumn":20,"suggestions":[{"fix":{"range":[1246,1279],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":45,"column":30,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":45,"endColumn":32,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1309,1311],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { useState } from \"react\"\nimport Input from \"@modules/common/components/input\"\nimport { SubmitButton } from \"@modules/checkout/components/submit-button\"\nimport ErrorMessage from \"@modules/checkout/components/error-message\"\n\nexport default function ForgotPasswordPage() {\n  const [email, setEmail] = useState(\"\")\n  const [loading, setLoading] = useState(false)\n  const [message, setMessage] = useState(\"\")\n  const [error, setError] = useState(\"\")\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault()\n    \n    if (!email) {\n      setError(\"請輸入電子郵件地址\")\n      return\n    }\n\n    setLoading(true)\n    setError(\"\")\n    setMessage(\"\")\n\n    try {\n      // 呼叫自定義密碼重設 API\n      const response = await fetch(`${process.env.NEXT_PUBLIC_MEDUSA_BACKEND_URL}/auth/customer/emailpass/reset-password-custom`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({ identifier: email }),\n      })\n      \n      if (!response.ok) {\n        const errorData = await response.json()\n        throw new Error(errorData.message || '發送失敗')\n      }\n      \n      setMessage(\"密碼重設連結已發送到您的電子郵件信箱，請檢查郵件並點擊連結重設密碼。\")\n      \n    } catch (error: any) {\n      console.error(\"發送重設郵件失敗:\", error)\n      setError(error.message || \"發送失敗，請確認電子郵件地址是否正確或稍後重試\")\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8\">\n      <div className=\"max-w-md w-full space-y-8\">\n        <div>\n          <h2 className=\"mt-6 text-center text-3xl font-extrabold text-gray-900\">\n            忘記密碼\n          </h2>\n          <p className=\"mt-2 text-center text-sm text-gray-600\">\n            請輸入您的電子郵件地址，我們將發送密碼重設連結給您\n          </p>\n        </div>\n        \n        <div className=\"bg-white rounded-lg shadow-md p-8\">\n          {message ? (\n            <div className=\"text-center\">\n              <div className=\"mb-4 p-4 bg-green-50 border border-green-200 rounded-md\">\n                <p className=\"text-sm text-green-700\">{message}</p>\n              </div>\n              <button\n                onClick={() => window.location.href = '/tw/account'}\n                className=\"w-full px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors\"\n              >\n                返回登入頁面\n              </button>\n            </div>\n          ) : (\n            <form onSubmit={handleSubmit} className=\"space-y-6\">\n              <Input\n                label=\"電子郵件\"\n                name=\"email\"\n                type=\"email\"\n                value={email}\n                onChange={(e) => setEmail(e.target.value)}\n                required\n                autoComplete=\"email\"\n              />\n              \n              <ErrorMessage error={error} />\n              \n              <SubmitButton className=\"w-full\">\n                {loading ? \"發送中...\" : \"發送重設連結\"}\n              </SubmitButton>\n              \n              <div className=\"text-center\">\n                <button\n                  type=\"button\"\n                  onClick={() => window.location.href = '/tw/account'}\n                  className=\"text-sm text-gray-600 hover:text-gray-800 underline\"\n                >\n                  返回登入頁面\n                </button>\n              </div>\n            </form>\n          )}\n        </div>\n      </div>\n    </div>\n  )\n}","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/[countryCode]/reset-password/page.tsx","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":65,"column":43,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":65,"endColumn":45,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1698,1700],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":75,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":75,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1896,1899],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1896,1899],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":76,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":76,"endColumn":20,"suggestions":[{"fix":{"range":[1909,1940],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":77,"column":30,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":77,"endColumn":32,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1970,1972],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { useState, useEffect } from \"react\"\nimport { useSearchParams } from \"next/navigation\"\nimport Input from \"@modules/common/components/input\"\nimport { SubmitButton } from \"@modules/checkout/components/submit-button\"\nimport ErrorMessage from \"@modules/checkout/components/error-message\"\n\nexport default function ResetPasswordPage() {\n  const searchParams = useSearchParams()\n  const [formData, setFormData] = useState({\n    password: \"\",\n    confirmPassword: \"\",\n  })\n  const [loading, setLoading] = useState(false)\n  const [message, setMessage] = useState(\"\")\n  const [error, setError] = useState(\"\")\n  \n  const token = searchParams.get(\"token\")\n  const email = searchParams.get(\"email\")\n\n  useEffect(() => {\n    if (!token || !email) {\n      setError(\"無效的重設連結\")\n    }\n  }, [token, email])\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault()\n    \n    if (!token || !email) {\n      setError(\"無效的重設連結\")\n      return\n    }\n\n    if (formData.password !== formData.confirmPassword) {\n      setError(\"密碼不匹配\")\n      return\n    }\n\n    if (formData.password.length < 8) {\n      setError(\"密碼長度至少需要 8 個字元\")\n      return\n    }\n\n    setLoading(true)\n    setError(\"\")\n\n    try {\n      // 呼叫 Medusa API 重設密碼\n      const response = await fetch(`${process.env.NEXT_PUBLIC_MEDUSA_BACKEND_URL}/auth/customer/emailpass/update`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          email,\n          token,\n          password: formData.password,\n        }),\n      })\n\n      if (!response.ok) {\n        const errorData = await response.json()\n        throw new Error(errorData.message || '密碼重設失敗')\n      }\n\n      setMessage(\"密碼重設成功！您現在可以使用新密碼登入。\")\n      \n      // 3 秒後重導向到登入頁面\n      setTimeout(() => {\n        window.location.href = \"/tw/account\"\n      }, 3000)\n\n    } catch (error: any) {\n      console.error(\"密碼重設失敗:\", error)\n      setError(error.message || \"密碼重設失敗，請重試或聯繫客服\")\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    setFormData(prev => ({\n      ...prev,\n      [e.target.name]: e.target.value\n    }))\n  }\n\n  if (!token || !email) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-gray-50\">\n        <div className=\"max-w-md w-full space-y-8\">\n          <div className=\"text-center\">\n            <h2 className=\"text-3xl font-bold text-gray-900\">無效的重設連結</h2>\n            <p className=\"mt-2 text-gray-600\">\n              此連結可能已過期或無效，請重新申請密碼重設。\n            </p>\n            <button\n              onClick={() => window.location.href = '/tw/forgot-password'}\n              className=\"mt-4 px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600\"\n            >\n              重新申請密碼重設\n            </button>\n          </div>\n        </div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8\">\n      <div className=\"max-w-md w-full space-y-8\">\n        <div>\n          <h2 className=\"mt-6 text-center text-3xl font-extrabold text-gray-900\">\n            重設密碼\n          </h2>\n          <p className=\"mt-2 text-center text-sm text-gray-600\">\n            為帳戶 {email} 設置新密碼\n          </p>\n        </div>\n        \n        <div className=\"bg-white rounded-lg shadow-md p-8\">\n          {message ? (\n            <div className=\"text-center\">\n              <div className=\"mb-4 p-4 bg-green-50 border border-green-200 rounded-md\">\n                <p className=\"text-sm text-green-700\">{message}</p>\n              </div>\n              <p className=\"text-sm text-gray-600\">\n                正在自動跳轉到登入頁面...\n              </p>\n            </div>\n          ) : (\n            <form onSubmit={handleSubmit} className=\"space-y-6\">\n              <Input\n                label=\"新密碼\"\n                name=\"password\"\n                type=\"password\"\n                value={formData.password}\n                onChange={handleInputChange}\n                required\n                autoComplete=\"new-password\"\n              />\n              \n              <Input\n                label=\"確認新密碼\"\n                name=\"confirmPassword\"\n                type=\"password\"\n                value={formData.confirmPassword}\n                onChange={handleInputChange}\n                required\n                autoComplete=\"new-password\"\n              />\n              \n              <div className=\"text-sm text-gray-600\">\n                <p>密碼要求：</p>\n                <ul className=\"list-disc list-inside mt-1\">\n                  <li>至少 8 個字元</li>\n                  <li>建議包含大小寫字母、數字和特殊符號</li>\n                </ul>\n              </div>\n              \n              <ErrorMessage error={error} />\n              \n              <SubmitButton className=\"w-full\">\n                {loading ? \"重設中...\" : \"重設密碼\"}\n              </SubmitButton>\n              \n              <div className=\"text-center\">\n                <button\n                  type=\"button\"\n                  onClick={() => window.location.href = '/tw/account'}\n                  className=\"text-sm text-gray-600 hover:text-gray-800 underline\"\n                >\n                  返回登入頁面\n                </button>\n              </div>\n            </form>\n          )}\n        </div>\n      </div>\n    </div>\n  )\n}","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/auth/google/callback/page.tsx","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":29,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":29,"endColumn":18,"suggestions":[{"fix":{"range":[758,787],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":56,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":56,"endColumn":18,"suggestions":[{"fix":{"range":[1465,1665],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":70,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":70,"endColumn":18,"suggestions":[{"fix":{"range":[1880,2004],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":75,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":75,"endColumn":20,"suggestions":[{"fix":{"range":[2033,2075],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-alert","severity":2,"message":"Unexpected alert.","line":76,"column":7,"nodeType":"CallExpression","messageId":"unexpected","endLine":76,"endColumn":37},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":85,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":85,"endColumn":16,"suggestions":[{"fix":{"range":[2228,2279],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":98,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":98,"endColumn":18,"suggestions":[{"fix":{"range":[2658,2715],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":112,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":112,"endColumn":18,"suggestions":[{"fix":{"range":[3120,3173],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":116,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":116,"endColumn":18,"suggestions":[{"fix":{"range":[3230,3258],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":121,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":121,"endColumn":20,"suggestions":[{"fix":{"range":[3335,3368],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'email' is defined but never used.","line":126,"column":33,"nodeType":null,"messageId":"unusedVar","endLine":126,"endColumn":38},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'email' is defined but never used. Allowed unused args must match /^_/u.","line":126,"column":33,"nodeType":null,"messageId":"unusedVar","endLine":126,"endColumn":38},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":127,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":127,"endColumn":16,"suggestions":[{"fix":{"range":[3455,3497],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":130,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":130,"endColumn":18,"suggestions":[{"fix":{"range":[3519,3547],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":134,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":134,"endColumn":20,"suggestions":[{"fix":{"range":[3674,3720],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":138,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":138,"endColumn":18,"suggestions":[{"fix":{"range":[3804,3849],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":145,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":145,"endColumn":18,"suggestions":[{"fix":{"range":[4042,4071],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"sonarjs/cognitive-complexity","severity":2,"message":"Refactor this function to reduce its Cognitive Complexity from 64 to the 15 allowed.","line":155,"column":37,"nodeType":null,"messageId":"refactorFunction","endLine":155,"endColumn":39},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":157,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":157,"endColumn":18,"suggestions":[{"fix":{"range":[4285,4317],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":158,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":158,"endColumn":18,"suggestions":[{"fix":{"range":[4324,4357],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":162,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":162,"endColumn":22,"suggestions":[{"fix":{"range":[4419,4460],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":170,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":170,"endColumn":22,"suggestions":[{"fix":{"range":[4593,4629],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":188,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":188,"endColumn":18,"suggestions":[{"fix":{"range":[5009,5053],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":192,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":192,"endColumn":20,"suggestions":[{"fix":{"range":[5153,5206],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":197,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":197,"endColumn":24,"suggestions":[{"fix":{"range":[5391,5446],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":199,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":199,"endColumn":22,"suggestions":[{"fix":{"range":[5474,5520],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":201,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":201,"endColumn":22,"suggestions":[{"fix":{"range":[5566,5596],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":205,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":205,"endColumn":22,"suggestions":[{"fix":{"range":[5705,5757],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":210,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":210,"endColumn":18,"suggestions":[{"fix":{"range":[5883,6174],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":217,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":217,"endColumn":18,"suggestions":[{"fix":{"range":[6188,6395],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":226,"column":33,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":226,"endColumn":35,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[6450,6512],"text":"(decoded.email ?? \n                (queryParams.email as string)"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":232,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":232,"endColumn":20,"suggestions":[{"fix":{"range":[6637,6679],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":236,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":236,"endColumn":22,"suggestions":[{"fix":{"range":[6755,6801],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":241,"column":17,"nodeType":null,"messageId":"preferOptionalChain","endLine":241,"endColumn":48,"suggestions":[{"fix":{"range":[6956,6987],"text":"customerData?.id"},"messageId":"optionalChainSuggest","desc":"Change to an optional chain."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":242,"column":15,"nodeType":"MemberExpression","messageId":"unexpected","endLine":242,"endColumn":26,"suggestions":[{"fix":{"range":[7005,7065],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":248,"column":51,"nodeType":null,"messageId":"preferOptionalChain","endLine":248,"endColumn":111,"fix":{"range":[7380,7440],"text":"googleIdentityResult.data?.email"}},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":250,"column":17,"nodeType":"MemberExpression","messageId":"unexpected","endLine":250,"endColumn":28,"suggestions":[{"fix":{"range":[7517,7565],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"sonarjs/no-duplicate-string","severity":2,"message":"Define a constant instead of duplicating this literal 6 times.","line":253,"column":44,"nodeType":"Literal","endLine":253,"endColumn":66},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":255,"column":21,"nodeType":"MemberExpression","messageId":"unexpected","endLine":255,"endColumn":32,"suggestions":[{"fix":{"range":[7758,7795],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":258,"column":72,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":258,"endColumn":74,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[7944,8029],"text":"(googleIdentityResult.data.given_name ?? googleIdentityResult.data.name?.split(' ')[0])"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":258,"column":121,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":258,"endColumn":123,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[8030,8032],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":259,"column":72,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":259,"endColumn":74,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[8070,8172],"text":"(googleIdentityResult.data.family_name ?? googleIdentityResult.data.name?.split(' ').slice(1).join(' '))"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":259,"column":137,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":259,"endColumn":139,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[8173,8175],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":265,"column":21,"nodeType":"MemberExpression","messageId":"unexpected","endLine":265,"endColumn":32,"suggestions":[{"fix":{"range":[8379,8418],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":267,"column":21,"nodeType":"MemberExpression","messageId":"unexpected","endLine":267,"endColumn":34,"suggestions":[{"fix":{"range":[8481,8521],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":271,"column":17,"nodeType":"MemberExpression","messageId":"unexpected","endLine":271,"endColumn":28,"suggestions":[{"fix":{"range":[8599,8682],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":271,"column":88,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":271,"endColumn":90,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[8670,8672],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":274,"column":15,"nodeType":"MemberExpression","messageId":"unexpected","endLine":274,"endColumn":26,"suggestions":[{"fix":{"range":[8734,8769],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":277,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":277,"endColumn":26,"suggestions":[{"fix":{"range":[8826,8873],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":286,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":286,"endColumn":24,"suggestions":[{"fix":{"range":[9141,9184],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":289,"column":17,"nodeType":null,"messageId":"preferOptionalChain","endLine":289,"endColumn":51,"suggestions":[{"fix":{"range":[9298,9332],"text":"customerData?.email"},"messageId":"optionalChainSuggest","desc":"Change to an optional chain."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":291,"column":15,"nodeType":"MemberExpression","messageId":"unexpected","endLine":291,"endColumn":26,"suggestions":[{"fix":{"range":[9441,9484],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":293,"column":15,"nodeType":"MemberExpression","messageId":"unexpected","endLine":293,"endColumn":26,"suggestions":[{"fix":{"range":[9520,9575],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":296,"column":15,"nodeType":"MemberExpression","messageId":"unexpected","endLine":296,"endColumn":26,"suggestions":[{"fix":{"range":[9660,9701],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":305,"column":21,"nodeType":"MemberExpression","messageId":"unexpected","endLine":305,"endColumn":32,"suggestions":[{"fix":{"range":[10223,10272],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":309,"column":17,"nodeType":"MemberExpression","messageId":"unexpected","endLine":309,"endColumn":30,"suggestions":[{"fix":{"range":[10372,10428],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":314,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":314,"endColumn":24,"suggestions":[{"fix":{"range":[10507,10542],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":317,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":317,"endColumn":20,"suggestions":[{"fix":{"range":[10576,10612],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":322,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":322,"endColumn":21,"suggestions":[{"fix":{"range":[10690,10733],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":328,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":328,"endColumn":18,"suggestions":[{"fix":{"range":[10869,10932],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":333,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":333,"endColumn":20,"suggestions":[{"fix":{"range":[11036,11097],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":339,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":339,"endColumn":22,"suggestions":[{"fix":{"range":[11261,11287],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":341,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":341,"endColumn":22,"suggestions":[{"fix":{"range":[11329,11353],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":345,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":345,"endColumn":24,"suggestions":[{"fix":{"range":[11437,11468],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":352,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":352,"endColumn":24,"suggestions":[{"fix":{"range":[11667,11702],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"sonarjs/cognitive-complexity","severity":2,"message":"Refactor this function to reduce its Cognitive Complexity from 48 to the 15 allowed.","line":357,"column":73,"nodeType":null,"messageId":"refactorFunction","endLine":357,"endColumn":75},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":362,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":362,"endColumn":22,"suggestions":[{"fix":{"range":[11982,12040],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":366,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":366,"endColumn":24,"suggestions":[{"fix":{"range":[12107,12152],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":372,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":372,"endColumn":24,"suggestions":[{"fix":{"range":[12353,12548],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":381,"column":15,"nodeType":"MemberExpression","messageId":"unexpected","endLine":381,"endColumn":26,"suggestions":[{"fix":{"range":[12623,12648],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":385,"column":17,"nodeType":"MemberExpression","messageId":"unexpected","endLine":385,"endColumn":28,"suggestions":[{"fix":{"range":[12759,12795],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":389,"column":21,"nodeType":"MemberExpression","messageId":"unexpected","endLine":389,"endColumn":32,"suggestions":[{"fix":{"range":[12954,12982],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":394,"column":19,"nodeType":"MemberExpression","messageId":"unexpected","endLine":394,"endColumn":32,"suggestions":[{"fix":{"range":[13134,13172],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":398,"column":15,"nodeType":"MemberExpression","messageId":"unexpected","endLine":398,"endColumn":26,"suggestions":[{"fix":{"range":[13236,13259],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":403,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":403,"endColumn":24,"suggestions":[{"fix":{"range":[13402,13549],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":411,"column":15,"nodeType":"MemberExpression","messageId":"unexpected","endLine":411,"endColumn":26,"suggestions":[{"fix":{"range":[13710,13868],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":420,"column":17,"nodeType":"MemberExpression","messageId":"unexpected","endLine":420,"endColumn":28,"suggestions":[{"fix":{"range":[14082,14137],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":425,"column":19,"nodeType":"MemberExpression","messageId":"unexpected","endLine":425,"endColumn":30,"suggestions":[{"fix":{"range":[14368,14430],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":430,"column":21,"nodeType":null,"messageId":"preferOptionalChain","endLine":430,"endColumn":54,"suggestions":[{"fix":{"range":[14587,14620],"text":"freshCustomer?.id"},"messageId":"optionalChainSuggest","desc":"Change to an optional chain."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":431,"column":19,"nodeType":"MemberExpression","messageId":"unexpected","endLine":431,"endColumn":30,"suggestions":[{"fix":{"range":[14642,14695],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":436,"column":21,"nodeType":"MemberExpression","messageId":"unexpected","endLine":436,"endColumn":32,"suggestions":[{"fix":{"range":[15029,15105],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":439,"column":23,"nodeType":"MemberExpression","messageId":"unexpected","endLine":439,"endColumn":34,"suggestions":[{"fix":{"range":[15231,15287],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"sonarjs/prefer-immediate-return","severity":2,"message":"Immediately return this expression instead of assigning it to the temporary variable \"updatedCustomer\".","line":443,"column":45,"nodeType":"ObjectExpression","messageId":"doImmediateAction","endLine":458,"endColumn":22,"fix":{"range":[15386,16382],"text":"return {\n                      ...freshCustomer,\n                      email: googleIdentityResult.data.email,\n                      // 如果 Google 數據中有名字，也可以更新\n                      first_name: googleIdentityResult.data.given_name || googleIdentityResult.data.name?.split(' ')[0] || freshCustomer.first_name,\n                      last_name: googleIdentityResult.data.family_name || googleIdentityResult.data.name?.split(' ').slice(1).join(' ') || freshCustomer.last_name,\n                      // 添加 Google 身份數據到元數據\n                      metadata: {\n                        ...freshCustomer.metadata,\n                        googleIdentity: {\n                          name: googleIdentityResult.data.name,\n                          picture: googleIdentityResult.data.picture,\n                          provider_user_id: googleIdentityResult.data.provider_user_id,\n                        }\n                      }\n                    }"}},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":447,"column":72,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":447,"endColumn":74,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[15596,15681],"text":"(googleIdentityResult.data.given_name ?? googleIdentityResult.data.name?.split(' ')[0])"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":447,"column":121,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":447,"endColumn":123,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[15682,15684],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":448,"column":72,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":448,"endColumn":74,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[15744,15846],"text":"(googleIdentityResult.data.family_name ?? googleIdentityResult.data.name?.split(' ').slice(1).join(' '))"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":448,"column":137,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":448,"endColumn":139,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[15847,15849],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":461,"column":21,"nodeType":"MemberExpression","messageId":"unexpected","endLine":461,"endColumn":32,"suggestions":[{"fix":{"range":[16430,16502],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":465,"column":17,"nodeType":"MemberExpression","messageId":"unexpected","endLine":465,"endColumn":30,"suggestions":[{"fix":{"range":[16595,16651],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":477,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":477,"endColumn":26,"suggestions":[{"fix":{"range":[16973,17037],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":484,"column":17,"nodeType":"MemberExpression","messageId":"unexpected","endLine":484,"endColumn":28,"suggestions":[{"fix":{"range":[17261,17290],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":486,"column":17,"nodeType":"MemberExpression","messageId":"unexpected","endLine":486,"endColumn":30,"suggestions":[{"fix":{"range":[17346,17389],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":497,"column":43,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":497,"endColumn":45,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[17573,17644],"text":"(decoded.email ?? \n                         (queryParams.email as string)"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":504,"column":32,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":504,"endColumn":34,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[17846,17848],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":507,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":507,"endColumn":20,"suggestions":[{"fix":{"range":[17912,17948],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":537,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":537,"endColumn":16,"suggestions":[{"fix":{"range":[18502,18545],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":541,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":541,"endColumn":18,"suggestions":[{"fix":{"range":[18685,18731],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":551,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":551,"endColumn":24,"suggestions":[{"fix":{"range":[19119,19153],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":554,"column":15,"nodeType":"MemberExpression","messageId":"unexpected","endLine":554,"endColumn":26,"suggestions":[{"fix":{"range":[19255,19298],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":555,"column":15,"nodeType":"MemberExpression","messageId":"unexpected","endLine":555,"endColumn":26,"suggestions":[{"fix":{"range":[19313,19385],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":561,"column":45,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":561,"endColumn":47,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[19626,19628],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":561,"column":78,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":561,"endColumn":80,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[19659,19661],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":570,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":570,"endColumn":24,"suggestions":[{"fix":{"range":[19929,19979],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":574,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":574,"endColumn":24,"suggestions":[{"fix":{"range":[20102,20145],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":620,"column":53,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":620,"endColumn":55,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[21832,21834],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":624,"column":57,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":624,"endColumn":59,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[22015,22117],"text":"(realGoogleIdentity.picture ?? \n                           (customer.metadata?.google_picture as string)"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":626,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":626,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22188,22191],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22188,22191],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":633,"column":17,"nodeType":"JSXOpeningElement","endLine":644,"endColumn":19},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":638,"column":21,"nodeType":"MemberExpression","messageId":"unexpected","endLine":638,"endColumn":32,"suggestions":[{"fix":{"range":[22738,22777],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":642,"column":21,"nodeType":"MemberExpression","messageId":"unexpected","endLine":642,"endColumn":32,"suggestions":[{"fix":{"range":[22913,22952],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":27,"fatalErrorCount":0,"warningCount":83,"fixableErrorCount":2,"fixableWarningCount":0,"source":"\"use client\" // include with Next.js 13+\n\nimport { HttpTypes } from \"@medusajs/types\"\nimport { useEffect, useMemo, useState } from \"react\"\nimport { decodeToken } from \"react-jwt\"\nimport { sdk } from \"@/lib/config\"\n\n// 檢查 JWT token 有效性的工具函數\nconst isValidJWT = (token: string): boolean => {\n  if (!token) return false\n  \n  // JWT 應該由三部分組成，以點分隔\n  const parts = token.split('.')\n  if (parts.length !== 3) return false\n  \n  try {\n    // 嘗試解析 payload 部分\n    const payload = JSON.parse(atob(parts[1].replace(/-/g, '+').replace(/_/g, '/')))\n    \n    // 檢查是否有基本的 JWT 欄位\n    if (!payload.iat || !payload.exp) return false\n    \n    // 檢查是否過期\n    const now = Math.floor(Date.now() / 1000)\n    if (payload.exp < now) return false\n    \n    return true\n  } catch (e) {\n    console.error(\"JWT 驗證失敗:\", e)\n    return false\n  }\n}\n\nexport default function GoogleCallback() {\n  const [loading, setLoading] = useState(true)\n  const [customer, setCustomer] = useState<HttpTypes.StoreCustomer>()\n  const [tokenStatus, setTokenStatus] = useState<{\n    received: boolean;\n    valid: boolean;\n    error?: string;\n  }>({ received: false, valid: false })\n  \n  // 安全地獲取 URL 參數，避免伺服器端渲染問題\n  const queryParams = useMemo(() => {\n    if (typeof window === 'undefined') {\n      return {}\n    }\n    const searchParams = new URLSearchParams(window.location.search)\n    return Object.fromEntries(searchParams.entries())\n  }, [])\n\n  const sendCallback = async () => {\n    let token = \"\"\n\n    try {\n      console.log(\"正在發送 Google 授權碼到後端...\", {\n        hasCode: !!queryParams.code,\n        codeLength: queryParams.code ? queryParams.code.length : 0,\n        endpoint: \"/store/auth/google/callback\"\n      })\n      \n      token = await sdk.auth.callback(\n        \"customer\", \n        \"google\", \n        // pass all query parameters received from the\n        // third party provider\n        queryParams\n      )\n      \n      console.log(\"後端成功處理 Google 授權並返回 token\", {\n        hasToken: !!token,\n        tokenLength: token ? token.length : 0\n      })\n    } catch (error) {\n      console.error(\"後端處理 Google 授權碼失敗:\", error)\n      alert(\"Authentication Failed\")\n      \n      throw error\n    }\n\n    return token\n  }\n\n  const createCustomerFromGoogleIdentity = async () => {\n    console.log(\"🔄 檢測到孤立的 Google 身份，嘗試創建客戶記錄並建立關聯...\")\n    \n    try {\n      // 使用從數據庫查詢得到的 Google 用戶資料\n      // 基於我們的檢查，我們知道有一個包含完整用戶資料的孤立 Google 身份\n      const googleUserData = {\n        email: \"bboy10121988@gmail.com\",\n        name: \"周震宇\",\n        given_name: \"震宇\",\n        family_name: \"周\",\n        picture: \"https://lh3.googleusercontent.com/a/ACg8ocI4DbBZPvsKREDNKhOrEl1o4m7_2UbrbBwjcu4KUWm6bXCCzArh=s96-c\"\n      }\n      \n      console.log(\"📝 使用 Google 資料創建客戶:\", googleUserData.email)\n      \n      // 創建新客戶\n      const newCustomer = await sdk.store.customer.create({\n        email: googleUserData.email,\n        first_name: googleUserData.given_name,\n        last_name: googleUserData.family_name,\n        metadata: {\n          google_name: googleUserData.name,\n          google_picture: googleUserData.picture,\n          google_email: googleUserData.email\n        }\n      })\n      \n      console.log(\"✅ 成功創建客戶:\", newCustomer.customer?.email)\n      \n      // 刷新認證狀態\n      await refreshToken()\n      console.log(\"✅ 已刷新認證 token\")\n      \n      return newCustomer.customer\n      \n    } catch (error) {\n      console.error(\"❌ 創建客戶失敗:\", error)\n      throw error\n    }\n  }\n\n  const createCustomer = async (email?: string) => {\n    console.log(\"createCustomer 被調用 - 檢查客戶狀態\")\n    \n    try {\n      console.log(\"檢查是否已經存在客戶...\")\n      const { customer: existingCustomer } = await sdk.store.customer.retrieve()\n      \n      if (existingCustomer) {\n        console.log(\"找到現有客戶:\", existingCustomer.email)\n        return { customer: existingCustomer, existing: true }\n      }\n      \n      console.log(\"沒有找到客戶記錄，檢查是否有孤立的 Google 身份...\")\n      \n      // 嘗試創建客戶從 Google 身份\n      const newCustomer = await createCustomerFromGoogleIdentity()\n      return { customer: newCustomer, existing: false }\n      \n    } catch (error) {\n      console.log(\"客戶創建失敗:\", error)\n      return { customer: null, existing: false }\n    }\n  }\n\n  const refreshToken = async () => {\n    // refresh the token\n    await sdk.auth.refresh()\n  }\n\n  const validateCallback = async () => {\n    try {\n      console.log(\"開始驗證 Google 回調...\")\n      console.log(\"查詢參數:\", queryParams)\n      \n      // 檢查授權碼\n      if (!queryParams.code) {\n        console.error(\"錯誤: 缺少 Google 授權碼 (code)\")\n        setLoading(false)\n        return\n      }\n      \n      const token = await sendCallback()\n      \n      if (!token) {\n        console.error(\"錯誤: 後端未返回 JWT token\")\n        setTokenStatus({ \n          received: false, \n          valid: false, \n          error: \"後端未返回 JWT token\" \n        })\n        setLoading(false)\n        return\n      }\n      \n      // 驗證 token 格式\n      const valid = isValidJWT(token)\n      setTokenStatus({ \n        received: true, \n        valid, \n        error: valid ? undefined : \"JWT 格式無效或已過期\" \n      })\n      \n      console.log(\"已獲取 token, 開始解析...\", { valid })\n      \n      // 1. 使用 lib/data/customer.ts 中的 handleGoogleCallback 函數來處理 token\n      try {\n        console.log(\"透過 handleGoogleCallback 設置和處理 token...\")\n        const { handleGoogleCallback } = await import('@/lib/data/customer')\n        const result = await handleGoogleCallback(token)\n        \n        if (!result.success) {\n          console.error(\"handleGoogleCallback 失敗:\", result.error)\n        } else {\n          console.log(\"handleGoogleCallback 成功處理 token\")\n          // 等待一小段時間確保 cookie 完全設置\n          console.log(\"等待 cookie 同步...\")\n          await new Promise(resolve => setTimeout(resolve, 1000))\n        }\n      } catch (error) {\n        console.error(\"調用 handleGoogleCallback 時出錯:\", error)\n      }\n      \n      const decoded = decodeToken(token) as { actor_id: string; email?: string }\n      // 檢查 token 是否有效\n      console.log(\"JWT Token 驗證:\", {\n        hasToken: !!token,\n        tokenLength: token ? token.length : 0,\n        tokenFormat: token ? (token.split('.').length === 3 ? \"有效的 JWT 格式\" : \"無效的 JWT 格式\") : \"無 token\",\n        tokenPreview: token ? `${token.substring(0, 20)}...` : \"無 token\",\n      })\n      \n      console.log(\"Token 解析結果:\", {\n        hasActorId: !!decoded.actor_id,\n        actorId: decoded.actor_id,\n        hasEmail: !!decoded.email,\n        email: decoded.email,\n        tokenPayload: decoded\n      })\n\n      // 檢查是否可以從 token 或查詢參數獲取電子郵件\n      let email = decoded.email || \n                (queryParams.email as string) || \n                (queryParams.login_hint as string)\n      \n      // 如果沒有獲取到電子郵件，需要向後端請求用戶資料\n      if (!email) {\n        console.log(\"沒有從初始資料獲取到電子郵件，將嘗試多種方式獲取...\")\n        \n        try {\n          // 1. 首先嘗試通過數據庫直接查詢 Google 身份資料\n          console.log(\"嘗試通過伺服器操作直接查詢數據庫 Google 身份資料...\")\n          try {\n            // 首先獲取客戶 ID\n            const { customer: customerData } = await sdk.store.customer.retrieve();\n            \n            if (customerData && customerData.id) {\n              console.log(\"✅ 獲取到客戶 ID，尋找關聯的 Google 身份:\", customerData.id);\n              \n              // 使用伺服器操作查詢 Google 身份\n              const { getGoogleIdentityByCustomerId } = await import('@/lib/data/google-identity');\n              const googleIdentityResult = await getGoogleIdentityByCustomerId(customerData.id);\n              \n              if (googleIdentityResult.success && googleIdentityResult.data && googleIdentityResult.data.email) {\n                email = googleIdentityResult.data.email;\n                console.log(\"✅ 從數據庫成功獲取 Google 身份電子郵件:\", email);\n                \n                // 如果客戶的電子郵件是預設值，嘗試更新為 Google 身份電子郵件\n                if (customerData.email === \"example@medusajs.com\" && email) {\n                  try {\n                    console.log(\"檢測到預設電子郵件，嘗試更新客戶資料...\");\n                    // 注意: Medusa SDK 可能不允許更新電子郵件，這裡使用可用的欄位\n                    await sdk.store.customer.update({\n                      first_name: googleIdentityResult.data.given_name || googleIdentityResult.data.name?.split(' ')[0] || '',\n                      last_name: googleIdentityResult.data.family_name || googleIdentityResult.data.name?.split(' ').slice(1).join(' ') || '',\n                      // 使用 metadata 來儲存 Google 電子郵件\n                      metadata: {\n                        google_email: email\n                      }\n                    });\n                    console.log(\"✅ 客戶資料已使用 Google 身份資料更新\");\n                  } catch (updateError) {\n                    console.error(\"更新客戶資料失敗:\", updateError);\n                  }\n                }\n              } else {\n                console.log(\"從數據庫查詢 Google 身份失敗或未獲取到電子郵件:\", googleIdentityResult.error || '未找到資料');\n              }\n            } else {\n              console.log(\"❌ 無法獲取客戶 ID，跳過數據庫查詢\");\n            }\n          } catch (dbError) {\n            console.error(\"從數據庫獲取 Google 身份時出錯:\", dbError);\n          }\n          \n          // 2. 如果仍未獲取電子郵件，跳過不必要的 API 調用\n          // 注意：Medusa v2 不需要額外的 /store/auth/google/me API 調用\n          // 用戶資料應該已經從 token 或數據庫查詢中獲取\n          \n          // 3. 如果仍未獲取電子郵件，嘗試使用標準 SDK 方法（可能會獲取到預設電子郵件）\n          if (!email) {\n            console.log(\"嘗試使用標準 Medusa SDK 獲取用戶資料...\");\n            const { customer: customerData } = await sdk.store.customer.retrieve();\n            \n            if (customerData && customerData.email && customerData.email !== \"example@medusajs.com\") {\n              email = customerData.email;\n              console.log(\"✅ 從 SDK 成功獲取非預設電子郵件:\", email);\n            } else {\n              console.log(\"從 SDK 獲取到預設或空電子郵件:\", customerData?.email);\n              \n              // 4. 最後嘗試，嘗試從數據庫中獲取所有 Google 身份並尋找最新的一個\n              console.log(\"嘗試從數據庫獲取所有 Google 身份資料...\");\n              try {\n                const { getAllGoogleIdentities } = await import('@/lib/data/google-identity');\n                const allIdentitiesResult = await getAllGoogleIdentities();\n                \n                if (allIdentitiesResult.success && allIdentitiesResult.data && allIdentitiesResult.data.length > 0) {\n                  const latestIdentity = allIdentitiesResult.data[0]; // 最新的身份\n                  if (latestIdentity.email) {\n                    email = latestIdentity.email;\n                    console.log(\"✅ 從所有 Google 身份中找到最新的電子郵件:\", email);\n                  }\n                }\n              } catch (allIdentitiesError) {\n                console.error(\"獲取所有 Google 身份時出錯:\", allIdentitiesError);\n              }\n            }\n          }\n        } catch (error) {\n          console.error(\"獲取用戶資料時出錯:\", error);\n        }\n      } else {\n        console.log(\"從初始資料獲取到電子郵件:\", email);\n      }\n      \n      // 即使在這個階段還是沒有電子郵件，我們也要繼續流程\n      if (!email) {\n        console.warn(\"無法獲取用戶電子郵件，將使用後續流程嘗試獲取用戶資訊\");\n      }\n      \n      // 檢查是否需要創建客戶\n      // actor_id 為空時表示可能需要創建或關聯客戶\n      const shouldCreateCustomer = decoded.actor_id === \"\"\n      console.log(\"需要創建客戶?\", shouldCreateCustomer, \"可用的電子郵件:\", email)\n\n      // 即使沒有電子郵件，也嘗試進行後續流程\n      // Medusa 後端可能已經有足夠的資訊來處理\n      if (shouldCreateCustomer) {\n        console.log(\"認證成功，但 token 中沒有 actor_id，這表示可能需要創建客戶或刷新 token\")\n        try {\n          // 檢查客戶狀態，email 可選\n          const { existing } = await createCustomer(email)\n          \n          // 無論客戶是否存在，都刷新 token 以獲取最新狀態\n          console.log(\"刷新 token...\")\n          await refreshToken()\n          console.log(\"token 已刷新\")\n          \n          if (!existing) {\n            // 如果客戶不存在，給後端一些時間處理\n            console.log(\"等待後端完成客戶創建和關聯...\")\n            await new Promise(resolve => setTimeout(resolve, 2000))\n            \n            // 再次刷新 token 以確保獲取最新狀態\n            await refreshToken()\n          }\n        } catch (error) {\n          console.error(\"處理認證後操作時出錯:\", error)\n        }\n      }\n\n      // 使用改進的重試邏輯獲取客戶資料\n      const getCustomerWithRetry = async (expectedEmail: string | null) => {\n        let customerData = null\n        const maxAttempts = 5 // 增加嘗試次數\n        \n        for (let attempt = 1; attempt <= maxAttempts; attempt++) {\n          console.log(`嘗試獲取客戶資料... (第 ${attempt}/${maxAttempts} 次)`)\n          \n          try {\n            // 檢查 SDK 認證狀態\n            console.log(`檢查 SDK 認證狀態 (嘗試 ${attempt})...`)\n            \n            // 嘗試使用服務器端函數來檢查認證狀態\n            const { retrieveCustomer } = await import('@/lib/data/customer')\n            customerData = await retrieveCustomer()\n            \n            console.log(`服務器端客戶獲取結果 (嘗試 ${attempt}):`, {\n              hasCustomer: !!customerData,\n              customerId: customerData?.id,\n              customerEmail: customerData?.email\n            })\n            \n\n            \n            if (!customerData) {\n              console.log(\"未返回客戶數據...\")\n              \n              // 如果是最後一次嘗試，嘗試創建客戶\n              if (attempt === maxAttempts) {\n                console.log(\"❌ 所有重試都失敗，嘗試創建客戶記錄...\")\n                try {\n                  const newCustomer = await createCustomerFromGoogleIdentity()\n                  if (newCustomer) {\n                    console.log(\"✅ 成功創建客戶，獲取資料\")\n                    customerData = newCustomer\n                    break\n                  }\n                } catch (createError) {\n                  console.error(\"創建客戶也失敗:\", createError)\n                }\n              }\n              \n              console.log(\"等待後重試...\")\n              await new Promise(resolve => setTimeout(resolve, 2000)) // 增加等待時間\n              continue\n            }\n            \n            console.log(\"客戶資料獲取結果:\", {\n              customerId: customerData.id,\n              email: customerData.email,\n              attempt\n            })\n            \n            // 檢查是否獲取到預設 email (這表示後端還沒有完成客戶資料的更新)\n            if (customerData.email === \"example@medusajs.com\" && expectedEmail) {\n              console.log(\"獲取到默認 email，而非預期的 Google email，等待後重試...\", {\n                current: customerData.email,\n                expected: expectedEmail\n              })\n              \n              // 嘗試使用 server action 直接從後端獲取最新數據\n              try {\n                // 1. 首先嘗試獲取客戶數據\n                const { retrieveCustomer } = await import('@/lib/data/customer')\n                console.log(\"使用 retrieveCustomer server action 獲取最新資料\")\n                const freshCustomer = await retrieveCustomer()\n                \n                // 2. 如果獲取到客戶數據，且不是預設郵箱，直接返回\n                if (freshCustomer && freshCustomer.email !== \"example@medusajs.com\") {\n                  console.log(\"從 server action 獲取到有效客戶數據:\", freshCustomer.email)\n                  return freshCustomer\n                }\n                \n                // 3. 如果是預設郵箱，但客戶 ID 存在，嘗試從 Google 身份表中獲取真實郵箱\n                if (freshCustomer && freshCustomer.id) {\n                  console.log(\"檢測到預設郵箱，嘗試從 Google Identity 表獲取真實郵箱...\")\n                  const { getGoogleIdentityByCustomerId } = await import('@/lib/data/google-identity')\n                  const googleIdentityResult = await getGoogleIdentityByCustomerId(freshCustomer.id)\n                  \n                  if (googleIdentityResult.success && googleIdentityResult.data?.email) {\n                    console.log(\"✅ 從 Google Identity 獲取到真實郵箱:\", googleIdentityResult.data.email)\n                    // 只在開發環境中顯示詳細資料\n                    if (process.env.NODE_ENV === 'development') {\n                      console.log(\"Google 身份完整資料:\", googleIdentityResult.data)\n                    }\n                    \n                    // 克隆客戶對象並更新郵箱\n                    const updatedCustomer = {\n                      ...freshCustomer,\n                      email: googleIdentityResult.data.email,\n                      // 如果 Google 數據中有名字，也可以更新\n                      first_name: googleIdentityResult.data.given_name || googleIdentityResult.data.name?.split(' ')[0] || freshCustomer.first_name,\n                      last_name: googleIdentityResult.data.family_name || googleIdentityResult.data.name?.split(' ').slice(1).join(' ') || freshCustomer.last_name,\n                      // 添加 Google 身份數據到元數據\n                      metadata: {\n                        ...freshCustomer.metadata,\n                        googleIdentity: {\n                          name: googleIdentityResult.data.name,\n                          picture: googleIdentityResult.data.picture,\n                          provider_user_id: googleIdentityResult.data.provider_user_id,\n                        }\n                      }\n                    }\n                    return updatedCustomer\n                  } else {\n                    console.log(\"❌ 無法從 Google Identity 獲取真實郵箱:\", googleIdentityResult.error)\n                  }\n                }\n              } catch (serverError) {\n                console.error(\"使用 server action 獲取客戶資料失敗:\", serverError)\n              }\n              \n              await new Promise(resolve => setTimeout(resolve, 2000))\n              // 嘗試刷新 token 再試一次\n              await refreshToken()\n              continue\n            }\n            \n            // 找到有效的客戶數據，退出循環\n            return customerData\n          } catch (error) {\n            console.error(`獲取客戶資料失敗 (嘗試 ${attempt}/${maxAttempts}):`, error)\n            await new Promise(resolve => setTimeout(resolve, 1500))\n            \n            // 在某些嘗試失敗後刷新 token\n            if (attempt % 2 === 0) {\n              try {\n                await refreshToken()\n                console.log(\"已刷新 token，繼續嘗試\")\n              } catch (refreshError) {\n                console.error(\"刷新 token 失敗:\", refreshError)\n              }\n            }\n          }\n        }\n        \n        // 返回最後一次嘗試的結果，可能為 null\n        return customerData\n      }\n      \n      // 預期的 email\n      const expectedEmail = decoded.email || \n                         (queryParams.email as string) || \n                         (queryParams.login_hint as string)\n      \n      // 使用重試函數獲取客戶資料\n      const customerData = await getCustomerWithRetry(expectedEmail)\n      \n      setCustomer(customerData || undefined)\n      setLoading(false)\n    } catch (error) {\n      console.error(\"驗證回調過程中發生錯誤:\", error)\n      setLoading(false)\n    }\n  }\n\n  // 只有在客戶端並且有參數時才執行回調驗證\n  useEffect(() => {\n    if (!loading) {\n      return\n    }\n\n    // 確保我們在客戶端環境並且有查詢參數\n    if (typeof window !== 'undefined' && Object.keys(queryParams).length > 0) {\n      validateCallback()\n    }\n  }, [loading, queryParams])\n\n  const [realGoogleIdentity, setRealGoogleIdentity] = useState<{\n    email?: string;\n    name?: string;\n    picture?: string;\n    loading: boolean;\n  }>({ loading: false });\n  \n  useEffect(() => {\n    if (!customer) {\n      return\n    }\n\n    // 認證成功後顯示客戶信息，但不重定向\n    console.log(\"認證成功，顯示客戶信息:\", customer.email)\n    \n    // 如果客戶電子郵件仍然是 example@medusajs.com，嘗試獲取真實的 Google 身份數據\n    if (customer.email === \"example@medusajs.com\" && customer.id) {\n      console.log(\"檢測到預設電子郵件，嘗試獲取真實 Google 身份數據...\")\n      setRealGoogleIdentity(prev => ({ ...prev, loading: true }));\n      \n      // 使用客戶 ID 從數據庫中獲取 Google 身份數據\n      (async () => {\n        try {\n          const { getGoogleIdentityByCustomerId } = await import('@/lib/data/google-identity');\n          const result = await getGoogleIdentityByCustomerId(customer.id);\n          \n          if (result.success && result.data) {\n            console.log(\"✅ 成功獲取 Google 身份數據\");\n            // 只在開發環境中顯示詳細資料\n            if (process.env.NODE_ENV === 'development') {\n              console.log(\"Google 身份數據詳情:\", result.data);\n              console.log(\"完整的 Google 身份數據結構:\", JSON.stringify(result.data, null, 2));\n            }\n            \n            setRealGoogleIdentity({\n              email: result.data.email,\n              name: result.data.name || (result.data.given_name && result.data.family_name) \n                ? `${result.data.given_name || ''} ${result.data.family_name || ''}`.trim() \n                : undefined,\n              picture: result.data.picture,\n              loading: false\n            });\n            \n            // 理想情況下這裡還可以向 Medusa 後端發送請求，更新客戶資料\n            // 但這需要後端提供相應的 API，現在只在前端顯示正確信息\n          } else {\n            console.log(\"⚠️ 無法獲取 Google 身份數據:\", result.error);\n            setRealGoogleIdentity(prev => ({ ...prev, loading: false }));\n          }\n        } catch (error) {\n          console.error(\"獲取 Google 身份數據時出錯:\", error);\n          setRealGoogleIdentity(prev => ({ ...prev, loading: false }));\n        }\n      })();\n    }\n  }, [customer])\n\n  // 渲染不同的內容根據當前狀態\n  const renderContent = () => {\n    // 統一返回一致的消息，等待客戶端邏輯接管\n    if (loading) {\n      return (\n        <div className=\"min-h-screen flex items-center justify-center p-4\">\n          <div className=\"bg-white rounded-lg shadow-lg p-8 max-w-sm w-full text-center\">\n            <p className=\"text-gray-600 mb-4\">正在處理 Google 登入請求...</p>\n            <div className=\"animate-pulse flex space-x-4 justify-center\">\n              <div className=\"h-3 w-3 bg-blue-400 rounded-full\"></div>\n              <div className=\"h-3 w-3 bg-blue-400 rounded-full\"></div>\n              <div className=\"h-3 w-3 bg-blue-400 rounded-full\"></div>\n            </div>\n          </div>\n        </div>\n      )\n    }\n    \n    // 缺少認證參數 (僅在客戶端執行時才會檢查)\n    if (typeof window !== 'undefined' && Object.keys(queryParams).length === 0) {\n      return (\n        <div className=\"min-h-screen flex items-center justify-center p-4\">\n          <div className=\"bg-white rounded-lg shadow-lg p-8 max-w-sm w-full text-center\">\n            <p className=\"text-red-500 mb-4\">缺少 Google 認證參數</p>\n            <p className=\"text-gray-600 mb-6\">無法處理認證回調，請重新嘗試登入</p>\n            <button \n              onClick={() => window.location.href = '/tw/account'}\n              className=\"w-full px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors\"\n            >\n              返回登入頁面\n            </button>\n          </div>\n        </div>\n      )\n    }\n    \n    // 認證成功\n    if (customer) {\n      // 決定顯示的郵箱：如果有真實 Google 郵箱則使用它，否則使用客戶的郵箱\n      const displayEmail = realGoogleIdentity.email || customer.email;\n      const isDefaultEmail = customer.email === \"example@medusajs.com\";\n      \n      // 獲取頭像圖片 - 優先使用 realGoogleIdentity，其次使用 metadata\n      const profilePicture = realGoogleIdentity.picture || \n                           (customer.metadata?.google_picture as string) ||\n                           ((customer.metadata?.googleIdentity as any)?.picture as string);\n      \n      return (\n        <div className=\"min-h-screen flex items-center justify-center p-4\">\n          <div className=\"bg-white rounded-lg shadow-lg p-8 max-w-sm w-full text-center\">\n            {profilePicture && (\n              <div className=\"flex justify-center mb-4\">\n                <img \n                  src={profilePicture} \n                  alt=\"Google profile\" \n                  className=\"w-16 h-16 rounded-full border-3 border-blue-400 shadow-md\"\n                  onError={(e) => {\n                    console.log(\"圖片載入失敗:\", profilePicture);\n                    e.currentTarget.style.display = 'none';\n                  }}\n                  onLoad={() => {\n                    console.log(\"圖片載入成功:\", profilePicture);\n                  }}\n                />\n              </div>\n            )}\n            \n            <h2 className=\"text-xl font-semibold text-gray-800 mb-3\">登入成功！</h2>\n            <p className=\"text-green-600 mb-6 text-sm\">\n              已使用 {displayEmail} 登入系統\n              {isDefaultEmail && realGoogleIdentity.loading && (\n                <span className=\"text-xs text-gray-500 block mt-1\">\n                  (正在獲取實際的 Google 郵箱...)\n                </span>\n              )}\n            </p>\n            \n            <div className=\"space-y-3\">\n              <button \n                onClick={() => window.location.href = '/tw'}\n                className=\"w-full px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors\"\n              >\n                返回首頁\n              </button>\n              <button \n                onClick={() => window.location.href = '/tw/account'}\n                className=\"w-full px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600 transition-colors\"\n              >\n                前往會員中心\n              </button>\n            </div>\n          </div>\n        </div>\n      )\n    }\n    \n    // 其他錯誤情況，但有認證參數 - 顯示更詳細的狀態\n    return (\n      <div className=\"min-h-screen flex items-center justify-center p-4\">\n        <div className=\"bg-white rounded-lg shadow-lg p-6 max-w-md w-full\">\n          <p className=\"text-red-500 mb-4 text-center font-medium\">認證處理中遇到問題</p>\n        <div className=\"text-left bg-gray-50 p-3 rounded mb-4 text-xs overflow-auto max-h-60\">\n          <h3 className=\"font-medium mb-2 text-base\">認證狀態：</h3>\n          \n          <div className=\"mb-3\">\n            <p><strong>Google 授權碼：</strong> {queryParams.code ? \"已接收\" : \"未接收\"}</p>\n            <p><strong>授權狀態：</strong> {queryParams.state ? \"已接收\" : \"未接收\"}</p>\n            <p><strong>授權範圍：</strong> {queryParams.scope || \"未知\"}</p>\n            <p><strong>回調參數數量：</strong> {Object.keys(queryParams).length}</p>\n          </div>\n          \n          <div className=\"mb-3 pt-3 border-t border-gray-200\">\n            <h4 className=\"font-medium text-base\">JWT Token 狀態：</h4>\n            <p><strong>Token 是否接收：</strong> \n              <span className={tokenStatus.received ? \"text-green-600\" : \"text-red-600\"}>\n                {tokenStatus.received ? \"是\" : \"否\"}\n              </span>\n            </p>\n            {tokenStatus.received && (\n              <p><strong>Token 是否有效：</strong> \n                <span className={tokenStatus.valid ? \"text-green-600\" : \"text-red-600\"}>\n                  {tokenStatus.valid ? \"是\" : \"否\"}\n                </span>\n              </p>\n            )}\n            {tokenStatus.error && (\n              <p><strong>錯誤訊息：</strong> <span className=\"text-red-600\">{tokenStatus.error}</span></p>\n            )}\n          </div>\n          \n          <div className=\"mt-3 pt-3 border-t border-gray-200\">\n            <p className=\"font-medium\">可能的問題：</p>\n            <ol className=\"list-decimal pl-5 mt-2\">\n              <li>授權碼已接收，但後端無法與 Google 交換 access token</li>\n              <li>後端成功獲取 access token，但無法從 Google 獲取用戶資料</li>\n              <li>後端無法生成有效的 JWT token</li>\n              <li>前端無法正確解析 JWT token</li>\n            </ol>\n          </div>\n        </div>\n        <div className=\"mt-4 flex justify-center space-x-4\">\n          <button \n            onClick={() => window.location.href = '/tw/account'}\n            className=\"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600\"\n          >\n            返回登入頁面\n          </button>\n          <button \n            onClick={() => window.location.reload()}\n            className=\"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600\"\n          >\n            重新嘗試\n          </button>\n        </div>\n        </div>\n      </div>\n    )\n  }\n  \n  return renderContent()\n}","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/debug/google-identities/page.tsx","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":15,"column":71,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":15,"endColumn":73,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[529,531],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":47,"column":42,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":47,"endColumn":44,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2257,2341],"text":"(identity.name ?? `${identity.given_name || ''} ${identity.family_name || ''}`.trim())"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":47,"column":68,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":47,"endColumn":70,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2297,2299],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":47,"column":98,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":47,"endColumn":100,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2327,2329],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":50,"column":54,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":50,"endColumn":56,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2528,2530],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":53,"column":49,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":53,"endColumn":51,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2710,2712],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { getAllGoogleIdentities } from '@/lib/data/google-identity';\n\nexport const dynamic = 'force-dynamic'; // 確保頁面不會被快取\n\nexport default async function GoogleIdentitiesPage() {\n  const result = await getAllGoogleIdentities();\n  \n  return (\n    <div className=\"p-8\">\n      <h1 className=\"text-2xl font-bold mb-6\">Google 身份測試頁面</h1>\n      \n      {result.success ? (\n        <>\n          <div className=\"mb-4 p-2 bg-green-100 border border-green-300 rounded\">\n            <p className=\"text-green-700\">✅ 成功獲取 {result.data?.length || 0} 筆 Google 身份資料</p>\n          </div>\n          \n          {result.data && result.data.length > 0 ? (\n            <div>\n              <h2 className=\"text-xl font-semibold mb-4\">身份資料列表</h2>\n              \n              <div className=\"overflow-x-auto\">\n                <table className=\"min-w-full divide-y divide-gray-200\">\n                  <thead className=\"bg-gray-50\">\n                    <tr>\n                      <th scope=\"col\" className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                        電子郵件\n                      </th>\n                      <th scope=\"col\" className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                        名稱\n                      </th>\n                      <th scope=\"col\" className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                        Google ID\n                      </th>\n                      <th scope=\"col\" className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                        客戶 ID\n                      </th>\n                    </tr>\n                  </thead>\n                  <tbody className=\"bg-white divide-y divide-gray-200\">\n                    {result.data.map((identity, index) => (\n                      <tr key={index} className={index % 2 === 0 ? 'bg-white' : 'bg-gray-50'}>\n                        <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n                          {identity.email || '(無電子郵件)'}\n                        </td>\n                        <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n                          {identity.name || `${identity.given_name || ''} ${identity.family_name || ''}`.trim() || '(無名稱)'}\n                        </td>\n                        <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n                          {identity.provider_user_id || '(無 ID)'}\n                        </td>\n                        <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n                          {identity.customer_id || '(未關聯客戶)'}\n                        </td>\n                      </tr>\n                    ))}\n                  </tbody>\n                </table>\n              </div>\n              \n              <div className=\"mt-6\">\n                <h3 className=\"text-lg font-semibold mb-3\">原始資料</h3>\n                <pre className=\"bg-gray-100 p-4 rounded overflow-auto max-h-96 text-xs\">\n                  {JSON.stringify(result.data, null, 2)}\n                </pre>\n              </div>\n            </div>\n          ) : (\n            <div className=\"p-4 bg-yellow-100 border border-yellow-300 rounded\">\n              <p className=\"text-yellow-700\">查詢成功但沒有找到任何 Google 身份資料</p>\n            </div>\n          )}\n        </>\n      ) : (\n        <div className=\"p-4 bg-red-100 border border-red-300 rounded\">\n          <p className=\"text-red-700\">❌ 查詢失敗: {result.error}</p>\n        </div>\n      )}\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/forgot-password/page.tsx","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":38,"column":43,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":38,"endColumn":45,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1125,1127],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":43,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1233,1236],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1233,1236],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":44,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":44,"endColumn":20,"suggestions":[{"fix":{"range":[1246,1279],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":45,"column":30,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":45,"endColumn":32,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1309,1311],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { useState } from \"react\"\nimport Input from \"@modules/common/components/input\"\nimport { SubmitButton } from \"@modules/checkout/components/submit-button\"\nimport ErrorMessage from \"@modules/checkout/components/error-message\"\n\nexport default function ForgotPasswordPage() {\n  const [email, setEmail] = useState(\"\")\n  const [loading, setLoading] = useState(false)\n  const [message, setMessage] = useState(\"\")\n  const [error, setError] = useState(\"\")\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault()\n    \n    if (!email) {\n      setError(\"請輸入電子郵件地址\")\n      return\n    }\n\n    setLoading(true)\n    setError(\"\")\n    setMessage(\"\")\n\n    try {\n      // 呼叫自定義密碼重設 API\n      const response = await fetch(`${process.env.NEXT_PUBLIC_MEDUSA_BACKEND_URL}/auth/customer/emailpass/reset-password-custom`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({ identifier: email }),\n      })\n      \n      if (!response.ok) {\n        const errorData = await response.json()\n        throw new Error(errorData.message || '發送失敗')\n      }\n      \n      setMessage(\"密碼重設連結已發送到您的電子郵件信箱，請檢查郵件並點擊連結重設密碼。\")\n      \n    } catch (error: any) {\n      console.error(\"發送重設郵件失敗:\", error)\n      setError(error.message || \"發送失敗，請確認電子郵件地址是否正確或稍後重試\")\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8\">\n      <div className=\"max-w-md w-full space-y-8\">\n        <div>\n          <h2 className=\"mt-6 text-center text-3xl font-extrabold text-gray-900\">\n            忘記密碼\n          </h2>\n          <p className=\"mt-2 text-center text-sm text-gray-600\">\n            請輸入您的電子郵件地址，我們將發送密碼重設連結給您\n          </p>\n        </div>\n        \n        <div className=\"bg-white rounded-lg shadow-md p-8\">\n          {message ? (\n            <div className=\"text-center\">\n              <div className=\"mb-4 p-4 bg-green-50 border border-green-200 rounded-md\">\n                <p className=\"text-sm text-green-700\">{message}</p>\n              </div>\n              <button\n                onClick={() => window.location.href = '/tw/account'}\n                className=\"w-full px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors\"\n              >\n                返回登入頁面\n              </button>\n            </div>\n          ) : (\n            <form onSubmit={handleSubmit} className=\"space-y-6\">\n              <Input\n                label=\"電子郵件\"\n                name=\"email\"\n                type=\"email\"\n                value={email}\n                onChange={(e) => setEmail(e.target.value)}\n                required\n                autoComplete=\"email\"\n              />\n              \n              <ErrorMessage error={error} />\n              \n              <SubmitButton className=\"w-full\">\n                {loading ? \"發送中...\" : \"發送重設連結\"}\n              </SubmitButton>\n              \n              <div className=\"text-center\">\n                <button\n                  type=\"button\"\n                  onClick={() => window.location.href = '/tw/account'}\n                  className=\"text-sm text-gray-600 hover:text-gray-800 underline\"\n                >\n                  返回登入頁面\n                </button>\n              </div>\n            </form>\n          )}\n        </div>\n      </div>\n    </div>\n  )\n}","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/reset-password/page.tsx","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":65,"column":43,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":65,"endColumn":45,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1696,1698],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":75,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":75,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1894,1897],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1894,1897],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":76,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":76,"endColumn":20,"suggestions":[{"fix":{"range":[1907,1938],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":77,"column":30,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":77,"endColumn":32,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1968,1970],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { useState, useEffect, Suspense } from \"react\"\nimport { useSearchParams } from \"next/navigation\"\nimport Input from \"@modules/common/components/input\"\nimport { SubmitButton } from \"@modules/checkout/components/submit-button\"\nimport ErrorMessage from \"@modules/checkout/components/error-message\"\n\nfunction ResetPasswordContent() {\n  const searchParams = useSearchParams()\n  const [formData, setFormData] = useState({\n    password: \"\",\n    confirmPassword: \"\",\n  })\n  const [loading, setLoading] = useState(false)\n  const [message, setMessage] = useState(\"\")\n  const [error, setError] = useState(\"\")\n  \n  const token = searchParams.get(\"token\")\n  const email = searchParams.get(\"email\")\n\n  useEffect(() => {\n    if (!token || !email) {\n      setError(\"無效的重設連結\")\n    }\n  }, [token, email])\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault()\n    \n    if (!token || !email) {\n      setError(\"無效的重設連結\")\n      return\n    }\n\n    if (formData.password !== formData.confirmPassword) {\n      setError(\"密碼不匹配\")\n      return\n    }\n\n    if (formData.password.length < 8) {\n      setError(\"密碼長度至少需要 8 個字元\")\n      return\n    }\n\n    setLoading(true)\n    setError(\"\")\n\n    try {\n      // 呼叫 Medusa API 重設密碼\n      const response = await fetch(`${process.env.NEXT_PUBLIC_MEDUSA_BACKEND_URL}/auth/customer/emailpass/update`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          email,\n          token,\n          password: formData.password,\n        }),\n      })\n\n      if (!response.ok) {\n        const errorData = await response.json()\n        throw new Error(errorData.message || '密碼重設失敗')\n      }\n\n      setMessage(\"密碼重設成功！您現在可以使用新密碼登入。\")\n      \n      // 3 秒後重導向到登入頁面\n      setTimeout(() => {\n        window.location.href = \"/tw/account\"\n      }, 3000)\n\n    } catch (error: any) {\n      console.error(\"密碼重設失敗:\", error)\n      setError(error.message || \"密碼重設失敗，請重試或聯繫客服\")\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    setFormData(prev => ({\n      ...prev,\n      [e.target.name]: e.target.value\n    }))\n  }\n\n  if (!token || !email) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-gray-50\">\n        <div className=\"max-w-md w-full space-y-8\">\n          <div className=\"text-center\">\n            <h2 className=\"text-3xl font-bold text-gray-900\">無效的重設連結</h2>\n            <p className=\"mt-2 text-gray-600\">\n              此連結可能已過期或無效，請重新申請密碼重設。\n            </p>\n            <button\n              onClick={() => window.location.href = '/tw/forgot-password'}\n              className=\"mt-4 px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600\"\n            >\n              重新申請密碼重設\n            </button>\n          </div>\n        </div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8\">\n      <div className=\"max-w-md w-full space-y-8\">\n        <div>\n          <h2 className=\"mt-6 text-center text-3xl font-extrabold text-gray-900\">\n            重設密碼\n          </h2>\n          <p className=\"mt-2 text-center text-sm text-gray-600\">\n            為帳戶 {email} 設置新密碼\n          </p>\n        </div>\n        \n        <div className=\"bg-white rounded-lg shadow-md p-8\">\n          {message ? (\n            <div className=\"text-center\">\n              <div className=\"mb-4 p-4 bg-green-50 border border-green-200 rounded-md\">\n                <p className=\"text-sm text-green-700\">{message}</p>\n              </div>\n              <p className=\"text-sm text-gray-600\">\n                正在自動跳轉到登入頁面...\n              </p>\n            </div>\n          ) : (\n            <form onSubmit={handleSubmit} className=\"space-y-6\">\n              <Input\n                label=\"新密碼\"\n                name=\"password\"\n                type=\"password\"\n                value={formData.password}\n                onChange={handleInputChange}\n                required\n                autoComplete=\"new-password\"\n              />\n              \n              <Input\n                label=\"確認新密碼\"\n                name=\"confirmPassword\"\n                type=\"password\"\n                value={formData.confirmPassword}\n                onChange={handleInputChange}\n                required\n                autoComplete=\"new-password\"\n              />\n              \n              <div className=\"text-sm text-gray-600\">\n                <p>密碼要求：</p>\n                <ul className=\"list-disc list-inside mt-1\">\n                  <li>至少 8 個字元</li>\n                  <li>建議包含大小寫字母、數字和特殊符號</li>\n                </ul>\n              </div>\n              \n              <ErrorMessage error={error} />\n              \n              <SubmitButton className=\"w-full\">\n                {loading ? \"重設中...\" : \"重設密碼\"}\n              </SubmitButton>\n              \n              <div className=\"text-center\">\n                <button\n                  type=\"button\"\n                  onClick={() => window.location.href = '/tw/account'}\n                  className=\"text-sm text-gray-600 hover:text-gray-800 underline\"\n                >\n                  返回登入頁面\n                </button>\n              </div>\n            </form>\n          )}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nexport default function ResetPasswordPage() {\n  return (\n    <Suspense fallback={<div className=\"flex justify-center items-center min-h-screen\">載入中...</div>}>\n      <ResetPasswordContent />\n    </Suspense>\n  )\n}","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/(main)/sanity-test/page.tsx","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":14,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":14,"endColumn":18,"suggestions":[{"fix":{"range":[289,330],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":20,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":20,"endColumn":20,"suggestions":[{"fix":{"range":[536,566],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":23,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":23,"endColumn":22,"suggestions":[{"fix":{"range":[675,705],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":28,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":28,"endColumn":20,"suggestions":[{"fix":{"range":[810,839],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":39,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":39,"endColumn":18,"suggestions":[{"fix":{"range":[989,1016],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":44,"column":19,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":44,"endColumn":43},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":49,"column":41,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":49,"endColumn":46},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":64,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":64,"endColumn":20,"suggestions":[{"fix":{"range":[1748,1776],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":67,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":67,"endColumn":22,"suggestions":[{"fix":{"range":[1883,1911],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":72,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":72,"endColumn":20,"suggestions":[{"fix":{"range":[2016,2045],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":136,"column":82,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":136,"endColumn":84,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3849,3851],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":137,"column":81,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":137,"endColumn":83,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3946,3948],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":138,"column":84,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":138,"endColumn":86,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[4046,4048],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState } from 'react'\n\nexport default function SanityTestPage() {\n  const [result, setResult] = useState<string>('')\n  const [loading, setLoading] = useState(false)\n\n  const testAssetsAPI = async () => {\n    setLoading(true)\n    setResult('')\n    \n    try {\n      console.log('🔍 測試 Sanity Assets API...')\n      const response = await fetch('/api/sanity/assets?page=1&pageSize=5')\n      const data = await response.json()\n      \n      if (response.ok) {\n        setResult(JSON.stringify(data, null, 2))\n        console.log('✅ API 回應:', data)\n      } else {\n        setResult(`❌ API 錯誤 (${response.status}): ${JSON.stringify(data, null, 2)}`)\n        console.error('API 錯誤:', data)\n      }\n    } catch (error) {\n      const errorMsg = `❌ 網路錯誤: ${error}`\n      setResult(errorMsg)\n      console.error('網路錯誤:', error)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const testUploadAPI = async () => {\n    setLoading(true)\n    setResult('')\n    \n    try {\n      console.log('🔍 測試上傳權限...')\n      // 創建一個小的測試圖片\n      const canvas = document.createElement('canvas')\n      canvas.width = 10\n      canvas.height = 10\n      const ctx = canvas.getContext('2d')!\n      ctx.fillStyle = '#ff0000'\n      ctx.fillRect(0, 0, 10, 10)\n      \n      const blob = await new Promise<Blob>((resolve) => {\n        canvas.toBlob((blob) => resolve(blob!), 'image/png')\n      })\n      \n      const formData = new FormData()\n      formData.append('file', blob, 'test.png')\n      \n      const response = await fetch('/api/sanity/upload', {\n        method: 'POST',\n        body: formData\n      })\n      \n      const data = await response.json()\n      \n      if (response.ok) {\n        setResult(`✅ 上傳成功: ${JSON.stringify(data, null, 2)}`)\n        console.log('✅ 上傳成功:', data)\n      } else {\n        setResult(`❌ 上傳失敗 (${response.status}): ${JSON.stringify(data, null, 2)}`)\n        console.error('上傳失敗:', data)\n      }\n    } catch (error) {\n      const errorMsg = `❌ 上傳錯誤: ${error}`\n      setResult(errorMsg)\n      console.error('上傳錯誤:', error)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  return (\n    <div style={{ padding: '2rem', maxWidth: '1200px', margin: '0 auto' }}>\n      <h1>Sanity 連接測試</h1>\n      \n      <div style={{ marginBottom: '2rem', display: 'flex', gap: '1rem' }}>\n        <button \n          onClick={testAssetsAPI}\n          disabled={loading}\n          style={{\n            padding: '0.75rem 1.5rem',\n            backgroundColor: '#3b82f6',\n            color: 'white',\n            border: 'none',\n            borderRadius: '6px',\n            cursor: loading ? 'not-allowed' : 'pointer',\n            opacity: loading ? 0.6 : 1\n          }}\n        >\n          {loading ? '測試中...' : '測試圖片列表 API'}\n        </button>\n        \n        <button \n          onClick={testUploadAPI}\n          disabled={loading}\n          style={{\n            padding: '0.75rem 1.5rem',\n            backgroundColor: '#10b981',\n            color: 'white',\n            border: 'none',\n            borderRadius: '6px',\n            cursor: loading ? 'not-allowed' : 'pointer',\n            opacity: loading ? 0.6 : 1\n          }}\n        >\n          {loading ? '測試中...' : '測試上傳權限'}\n        </button>\n      </div>\n\n      {result && (\n        <div>\n          <h2>測試結果</h2>\n          <pre style={{\n            backgroundColor: '#f8f9fa',\n            padding: '1rem',\n            borderRadius: '6px',\n            overflow: 'auto',\n            maxHeight: '400px',\n            fontSize: '0.9rem',\n            whiteSpace: 'pre-wrap'\n          }}>\n            {result}\n          </pre>\n        </div>\n      )}\n\n      <div style={{ marginTop: '2rem', padding: '1rem', backgroundColor: '#e9ecef', borderRadius: '6px' }}>\n        <h3>環境變數檢查</h3>\n        <ul style={{ margin: 0 }}>\n          <li><strong>專案 ID:</strong> {process.env.NEXT_PUBLIC_SANITY_PROJECT_ID || '❌ 未設定'}</li>\n          <li><strong>Dataset:</strong> {process.env.NEXT_PUBLIC_SANITY_DATASET || '❌ 未設定'}</li>\n          <li><strong>API 版本:</strong> {process.env.NEXT_PUBLIC_SANITY_API_VERSION || '❌ 未設定'}</li>\n        </ul>\n      </div>\n    </div>\n  )\n}","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/affiliate-admin/analytics/route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'AnalyticsResponse' is defined but never used.","line":9,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":20},{"ruleId":"unused-imports/no-unused-imports","severity":2,"message":"'AnalyticsResponse' is defined but never used.","line":9,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":20,"fix":{"range":[201,223],"text":""}},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":19,"column":49,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":19,"endColumn":51,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[586,588],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":54,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1585,1588],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1585,1588],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":64,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2058,2061],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2058,2061],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":72,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2335,2338],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2335,2338],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":73,"column":76,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":79,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2445,2448],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2445,2448],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":77,"column":56,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":77,"endColumn":58,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2578,2652],"text":"(affiliateSettings.profile?.displayName ?? affiliateSettings.profile?.email)"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":77,"column":92,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":77,"endColumn":94,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2653,2655],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":86,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":86,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2894,2897],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2894,2897],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":87,"column":43,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":87,"endColumn":45,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2946,2948],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":91,"column":38,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":91,"endColumn":40,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3113,3115],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":113,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":113,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3880,3883],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3880,3883],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":113,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":113,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3888,3891],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3888,3891],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":116,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":116,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4016,4019],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4016,4019],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":150,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":150,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5073,5076],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5073,5076],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":150,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":150,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5081,5084],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5081,5084],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":156,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":156,"endColumn":18,"suggestions":[{"fix":{"range":[5209,5242],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":11,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server'\nimport * as fs from 'fs'\nimport * as path from 'path'\nimport { \n  AffiliateStatsData, \n  AffiliateSettingsData, \n  AffiliatePerformance, \n  ProductPerformance, \n  AnalyticsResponse \n} from '../../../../types/affiliate-admin'\n\nconst dataDir = path.join(process.cwd(), 'data')\nconst statsPath = path.join(dataDir, 'affiliate-stats.json')\nconst settingsPath = path.join(dataDir, 'affiliate-settings.json')\n\nexport async function GET(request: Request) {\n  try {\n    const url = new URL(request.url)\n    const range = url.searchParams.get('range') || '30d'\n\n    // 計算日期範圍\n    const now = new Date()\n    let startDate: Date\n    \n    switch (range) {\n      case '7d':\n        startDate = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000)\n        break\n      case '90d':\n        startDate = new Date(now.getTime() - 90 * 24 * 60 * 60 * 1000)\n        break\n      case '1y':\n        startDate = new Date(now.getTime() - 365 * 24 * 60 * 60 * 1000)\n        break\n      default: // 30d\n        startDate = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000)\n    }\n\n    // 讀取統計數據\n    let stats: AffiliateStatsData = { affiliateStats: {} }\n    if (fs.existsSync(statsPath)) {\n      const statsContent = fs.readFileSync(statsPath, 'utf8')\n      stats = JSON.parse(statsContent)\n    }\n\n    // 讀取設置數據\n    let settings: AffiliateSettingsData = { settings: {} }\n    if (fs.existsSync(settingsPath)) {\n      const settingsContent = fs.readFileSync(settingsPath, 'utf8')\n      settings = JSON.parse(settingsContent)\n    }\n\n    // 收集所有在時間範圍內的訂單\n    const allOrders: any[] = []\n    const affiliatePerformance: Record<string, AffiliatePerformance> = {}\n    const productPerformance: Record<string, ProductPerformance> = {}\n\n    Object.keys(stats.affiliateStats || {}).forEach(affiliateId => {\n      const affiliateStats = stats.affiliateStats[affiliateId]\n      const affiliateSettings = settings.settings[affiliateId] || {}\n      \n      if (!affiliateStats?.orders) return\n\n      const filteredOrders = affiliateStats.orders.filter((order: any) => {\n        const orderDate = new Date(order.date)\n        return orderDate >= startDate && orderDate <= now\n      })\n\n      allOrders.push(...filteredOrders)\n\n      if (filteredOrders.length > 0) {\n        const totalRevenue = filteredOrders.reduce((sum: number, order: any) => sum + order.orderValue, 0)\n        const totalCommission = filteredOrders.reduce((sum: number, order: any) => sum + order.commission, 0)\n        \n        affiliatePerformance[affiliateId] = {\n          id: affiliateId,\n          name: affiliateSettings.profile?.displayName || affiliateSettings.profile?.email || affiliateId,\n          revenue: totalRevenue,\n          orders: filteredOrders.length,\n          commission: totalCommission,\n          conversionRate: 0.05 // 模擬轉換率\n        }\n      }\n\n      // 統計產品表現\n      filteredOrders.forEach((order: any) => {\n        const productId = order.productId || 'unknown'\n        if (!productPerformance[productId]) {\n          productPerformance[productId] = {\n            id: productId,\n            title: order.productName || `產品 ${productId}`,\n            sales: 0,\n            revenue: 0,\n            affiliateCount: 1,\n            orders: 0\n          }\n        }\n        productPerformance[productId].orders += 1\n        productPerformance[productId].revenue += order.orderValue\n        productPerformance[productId].sales += 1\n      })\n    })\n\n    // 計算總覽數據\n    const totalRevenue = allOrders.reduce((sum, order) => sum + order.orderValue, 0)\n    const totalCommission = allOrders.reduce((sum, order) => sum + order.commission, 0)\n    const totalOrders = allOrders.length\n    const averageOrderValue = totalOrders > 0 ? totalRevenue / totalOrders : 0\n    const conversionRate = 0.05 // 模擬轉換率\n\n    // 找出頂級聯盟商\n    const topAffiliates = Object.values(affiliatePerformance)\n      .sort((a: any, b: any) => b.commission - a.commission)\n\n    const topPerformingAffiliate = topAffiliates.length > 0 \n      ? (topAffiliates[0] as any).name \n      : '暫無'\n\n    // 生成趨勢數據\n    const trends = []\n    const daysToShow = range === '7d' ? 7 : range === '30d' ? 30 : range === '90d' ? 90 : 365\n    \n    for (let i = daysToShow - 1; i >= 0; i--) {\n      const date = new Date(now.getTime() - i * 24 * 60 * 60 * 1000)\n      const dayOrders = allOrders.filter(order => {\n        const orderDate = new Date(order.date)\n        return orderDate.toDateString() === date.toDateString()\n      })\n      \n      trends.push({\n        date: date.toISOString(),\n        revenue: dayOrders.reduce((sum, order) => sum + order.orderValue, 0),\n        orders: dayOrders.length,\n        commission: dayOrders.reduce((sum, order) => sum + order.commission, 0)\n      })\n    }\n\n    const analyticsData = {\n      overview: {\n        totalRevenue,\n        totalCommission,\n        totalOrders,\n        averageOrderValue,\n        conversionRate,\n        topPerformingAffiliate\n      },\n      trends,\n      topAffiliates: topAffiliates.slice(0, 10),\n      topProducts: Object.values(productPerformance)\n        .sort((a: any, b: any) => b.revenue - a.revenue)\n        .slice(0, 10)\n    }\n\n    return NextResponse.json(analyticsData)\n  } catch (error) {\n    console.error('獲取分析數據錯誤:', error)\n    return NextResponse.json(\n      { error: '無法獲取分析數據' },\n      { status: 500 }\n    )\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/affiliate-admin/applications/[id]/approve/route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'path' is defined but never used.","line":4,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":17},{"ruleId":"unused-imports/no-unused-imports","severity":2,"message":"'path' is defined but never used.","line":4,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":17,"fix":{"range":[151,180],"text":""}},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'crypto' is defined but never used.","line":5,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":19},{"ruleId":"unused-imports/no-unused-imports","severity":2,"message":"'crypto' is defined but never used.","line":5,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":19,"fix":{"range":[180,214],"text":"\n"}},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":61,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":61,"endColumn":20,"suggestions":[{"fix":{"range":[1602,1662],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":68,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":68,"endColumn":21,"suggestions":[{"fix":{"range":[1847,1917],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":72,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":72,"endColumn":19,"suggestions":[{"fix":{"range":[1980,2071],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":78,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":78,"endColumn":16,"suggestions":[{"fix":{"range":[2245,2320],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":86,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":86,"endColumn":20,"suggestions":[{"fix":{"range":[2504,2552],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":93,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":93,"endColumn":20,"suggestions":[{"fix":{"range":[2770,2813],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":98,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":98,"endColumn":16,"suggestions":[{"fix":{"range":[2958,3013],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":120,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":120,"endColumn":16,"suggestions":[{"fix":{"range":[3618,3691],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":134,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":134,"endColumn":18,"suggestions":[{"fix":{"range":[4000,4052],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":2,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server'\nimport { retrieveAffiliateAdmin } from '@lib/data/affiliate-admin-auth'\nimport { promises as fs } from 'fs'\nimport * as path from 'path'\nimport * as crypto from 'crypto'\n\ntype AffiliateApplication = {\n  id: string\n  email: string\n  displayName: string\n  website?: string\n  passwordHash: string\n  status: 'pending' | 'approved' | 'rejected'\n  created_at: string\n}\n\ntype AffiliateAccount = {\n  id: string\n  email: string\n  displayName: string\n  website?: string\n  passwordHash: string\n  status: 'approved'\n  created_at: string\n  reviewedBy?: string\n  reviewedAt?: string\n}\n\ntype StoreShape = {\n  applications: AffiliateApplication[]\n  accounts: AffiliateAccount[]\n  rejected: AffiliateApplication[]\n}\n\nexport async function POST(_req: Request, { params }: { params: Promise<{ id: string }> }) {\n  const admin = await retrieveAffiliateAdmin()\n  if (!admin) return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n  \n  const { id } = await params\n  \n  try {\n    // 首先嘗試使用VM後端 API\n    const backendUrl = 'http://35.236.182.29:9000'\n    \n    try {\n      const approveResponse = await fetch(`${backendUrl}/admin/affiliate-applications/${id}/approve`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Accept': 'application/json',\n        },\n        body: JSON.stringify({\n          reviewedBy: admin.email,\n          reviewedAt: new Date().toISOString()\n        }),\n        cache: 'no-store',\n      })\n      \n      if (approveResponse.ok) {\n        const result = await approveResponse.json()\n        console.log('Application approved via backend API:', result)\n        return NextResponse.json({ \n          success: true, \n          message: 'Application approved successfully',\n          source: 'backend-api'\n        })\n      } else {\n        console.warn('Backend API not available, falling back to file system')\n        // 回退到檔案系統操作\n      }\n    } catch (fetchError) {\n      console.warn('Failed to approve via backend API, falling back to file system:', fetchError)\n      // 回退到檔案系統操作\n    }\n    \n    // 直接操作 JSON 檔案（回退方案）\n    const dataPath = '/Users/raychou/tim-web/medusa_decoupled/backend_vm/medusa-backend/src/data/affiliate.json'\n    console.log('Approving application directly in JSON:', dataPath, 'ID:', id)\n    \n    // 讀取當前資料\n    let store: StoreShape\n    try {\n      const fileContent = await fs.readFile(dataPath, 'utf8')\n      store = JSON.parse(fileContent)\n    } catch (error) {\n      console.error('Error reading JSON file:', error)\n      return NextResponse.json({ error: 'Failed to read data file' }, { status: 500 })\n    }\n    \n    // 找到要審核的申請\n    const appIndex = store.applications.findIndex((a) => a.id === id)\n    if (appIndex === -1) {\n      console.error('Application not found:', id)\n      return NextResponse.json({ error: 'Application not found' }, { status: 404 })\n    }\n    \n    const app = store.applications[appIndex]\n    console.log('Found application to approve:', app.email)\n    \n    // 從 applications 移除\n    store.applications.splice(appIndex, 1)\n    \n    // 新增到 accounts\n    const newAccount: AffiliateAccount = {\n      id: 'aff_' + Math.random().toString(36).slice(2, 10),\n      email: app.email,\n      displayName: app.displayName,\n      website: app.website,\n      passwordHash: app.passwordHash,\n      status: 'approved',\n      created_at: new Date().toISOString(),\n      reviewedBy: admin.email,\n      reviewedAt: new Date().toISOString()\n    }\n    \n    store.accounts.push(newAccount)\n    \n    // 寫回檔案\n    await fs.writeFile(dataPath, JSON.stringify(store, null, 2))\n    console.log('Application approved and moved to accounts:', newAccount.id)\n    \n    return NextResponse.json({ \n      success: true, \n      message: 'Application approved successfully',\n      account: {\n        id: newAccount.id,\n        email: newAccount.email,\n        displayName: newAccount.displayName,\n        status: 'approved'\n      }\n    })\n        \n  } catch (error) {\n    console.error('Error approving application:', error)\n    return NextResponse.json({ \n      error: 'Failed to approve application',\n      details: error instanceof Error ? error.message : 'Unknown error'\n    }, { status: 500 })\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/affiliate-admin/applications/[id]/reject/route-new.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":21,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[516,519],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[516,519],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":36,"column":37,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":36,"endColumn":39,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[946,981],"text":"(body.reason ?? body.rejectionReason)"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":36,"column":61,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":36,"endColumn":63,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[982,984],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":43,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":43,"endColumn":16,"suggestions":[{"fix":{"range":[1157,1232],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":51,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":51,"endColumn":20,"suggestions":[{"fix":{"range":[1416,1464],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":58,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":58,"endColumn":20,"suggestions":[{"fix":{"range":[1682,1725],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":63,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":63,"endColumn":16,"suggestions":[{"fix":{"range":[1870,1924],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":79,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":79,"endColumn":16,"suggestions":[{"fix":{"range":[2324,2395],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":94,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":94,"endColumn":18,"suggestions":[{"fix":{"range":[2714,2766],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server'\nimport { retrieveAffiliateAdmin } from '@lib/data/affiliate-admin-auth'\nimport { promises as fs } from 'fs'\nimport * as path from 'path'\n\ntype AffiliateApplication = {\n  id: string\n  email: string\n  displayName: string\n  website?: string\n  passwordHash: string\n  status: 'pending' | 'approved' | 'rejected'\n  created_at: string\n  rejectionReason?: string\n  reviewedBy?: string\n  reviewedAt?: string\n}\n\ntype StoreShape = {\n  applications: AffiliateApplication[]\n  accounts: any[]\n  rejected: AffiliateApplication[]\n}\n\nexport async function POST(req: Request, { params }: { params: Promise<{ id: string }> }) {\n  const admin = await retrieveAffiliateAdmin()\n  if (!admin) return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n  \n  const { id } = await params\n  \n  try {\n    // 獲取拒絕原因（如果有的話）\n    let rejectionReason = ''\n    try {\n      const body = await req.json()\n      rejectionReason = body.reason || body.rejectionReason || ''\n    } catch {\n      // 如果沒有 body 或解析失敗，使用空字串\n    }\n    \n    // 直接操作 JSON 檔案\n    const dataPath = path.join(process.cwd(), '..', 'backend', 'data', 'affiliate.json')\n    console.log('Rejecting application directly in JSON:', dataPath, 'ID:', id)\n    \n    // 讀取當前資料\n    let store: StoreShape\n    try {\n      const fileContent = await fs.readFile(dataPath, 'utf8')\n      store = JSON.parse(fileContent)\n    } catch (error) {\n      console.error('Error reading JSON file:', error)\n      return NextResponse.json({ error: 'Failed to read data file' }, { status: 500 })\n    }\n    \n    // 找到要拒絕的申請\n    const appIndex = store.applications.findIndex((a) => a.id === id)\n    if (appIndex === -1) {\n      console.error('Application not found:', id)\n      return NextResponse.json({ error: 'Application not found' }, { status: 404 })\n    }\n    \n    const app = store.applications[appIndex]\n    console.log('Found application to reject:', app.email)\n    \n    // 從 applications 移除\n    store.applications.splice(appIndex, 1)\n    \n    // 設置拒絕狀態和審核資訊\n    app.status = 'rejected'\n    app.rejectionReason = rejectionReason || '未提供拒絕原因'\n    app.reviewedBy = admin.email\n    app.reviewedAt = new Date().toISOString()\n    \n    // 新增到 rejected\n    store.rejected.push(app)\n    \n    // 寫回檔案\n    await fs.writeFile(dataPath, JSON.stringify(store, null, 2))\n    console.log('Application rejected and moved to rejected list:', app.id)\n    \n    return NextResponse.json({ \n      success: true, \n      message: 'Application rejected successfully',\n      rejection: {\n        id: app.id,\n        email: app.email,\n        displayName: app.displayName,\n        status: 'rejected',\n        reason: rejectionReason\n      }\n    })\n    \n  } catch (error) {\n    console.error('Error rejecting application:', error)\n    return NextResponse.json({ \n      error: 'Failed to reject application',\n      details: error instanceof Error ? error.message : 'Unknown error'\n    }, { status: 500 })\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/affiliate-admin/applications/[id]/reject/route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'path' is defined but never used.","line":4,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":17},{"ruleId":"unused-imports/no-unused-imports","severity":2,"message":"'path' is defined but never used.","line":4,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":17,"fix":{"range":[151,181],"text":"\n"}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":21,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[516,519],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[516,519],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":36,"column":37,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":36,"endColumn":39,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[946,981],"text":"(body.reason ?? body.rejectionReason)"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":36,"column":61,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":36,"endColumn":63,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[982,984],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":61,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":61,"endColumn":20,"suggestions":[{"fix":{"range":[1669,1729],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":68,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":68,"endColumn":21,"suggestions":[{"fix":{"range":[1914,1984],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":72,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":72,"endColumn":19,"suggestions":[{"fix":{"range":[2047,2137],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":78,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":78,"endColumn":16,"suggestions":[{"fix":{"range":[2311,2386],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":86,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":86,"endColumn":20,"suggestions":[{"fix":{"range":[2570,2618],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":93,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":93,"endColumn":20,"suggestions":[{"fix":{"range":[2836,2879],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":98,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":98,"endColumn":16,"suggestions":[{"fix":{"range":[3024,3078],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":114,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":114,"endColumn":16,"suggestions":[{"fix":{"range":[3478,3549],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":129,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":129,"endColumn":18,"suggestions":[{"fix":{"range":[3868,3920],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server'\nimport { retrieveAffiliateAdmin } from '@lib/data/affiliate-admin-auth'\nimport { promises as fs } from 'fs'\nimport * as path from 'path'\n\ntype AffiliateApplication = {\n  id: string\n  email: string\n  displayName: string\n  website?: string\n  passwordHash: string\n  status: 'pending' | 'approved' | 'rejected'\n  created_at: string\n  rejectionReason?: string\n  reviewedBy?: string\n  reviewedAt?: string\n}\n\ntype StoreShape = {\n  applications: AffiliateApplication[]\n  accounts: any[]\n  rejected: AffiliateApplication[]\n}\n\nexport async function POST(req: Request, { params }: { params: Promise<{ id: string }> }) {\n  const admin = await retrieveAffiliateAdmin()\n  if (!admin) return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n  \n  const { id } = await params\n  \n  try {\n    // 獲取拒絕原因（如果有的話）\n    let rejectionReason = ''\n    try {\n      const body = await req.json()\n      rejectionReason = body.reason || body.rejectionReason || ''\n    } catch {\n      // 如果沒有 body 或解析失敗，使用空字串\n    }\n    \n    // 首先嘗試使用VM後端 API  \n    const backendUrl = 'http://35.236.182.29:9000'\n    \n    try {\n      const rejectResponse = await fetch(`${backendUrl}/admin/affiliate-applications/${id}/reject`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Accept': 'application/json',\n        },\n        body: JSON.stringify({\n          reason: rejectionReason,\n          reviewedBy: admin.email,\n          reviewedAt: new Date().toISOString()\n        }),\n        cache: 'no-store',\n      })\n      \n      if (rejectResponse.ok) {\n        const result = await rejectResponse.json()\n        console.log('Application rejected via backend API:', result)\n        return NextResponse.json({ \n          success: true, \n          message: 'Application rejected successfully',\n          source: 'backend-api'\n        })\n      } else {\n        console.warn('Backend API not available, falling back to file system')\n        // 回退到檔案系統操作\n      }\n    } catch (fetchError) {\n      console.warn('Failed to reject via backend API, falling back to file system:', fetchError)\n      // 回退到檔案系統操作\n    }\n    \n    // 直接操作 JSON 檔案（回退方案）\n    const dataPath = '/Users/raychou/tim-web/medusa_decoupled/backend_vm/medusa-backend/src/data/affiliate.json'\n    console.log('Rejecting application directly in JSON:', dataPath, 'ID:', id)\n    \n    // 讀取當前資料\n    let store: StoreShape\n    try {\n      const fileContent = await fs.readFile(dataPath, 'utf8')\n      store = JSON.parse(fileContent)\n    } catch (error) {\n      console.error('Error reading JSON file:', error)\n      return NextResponse.json({ error: 'Failed to read data file' }, { status: 500 })\n    }\n    \n    // 找到要拒絕的申請\n    const appIndex = store.applications.findIndex((a) => a.id === id)\n    if (appIndex === -1) {\n      console.error('Application not found:', id)\n      return NextResponse.json({ error: 'Application not found' }, { status: 404 })\n    }\n    \n    const app = store.applications[appIndex]\n    console.log('Found application to reject:', app.email)\n    \n    // 從 applications 移除\n    store.applications.splice(appIndex, 1)\n    \n    // 設置拒絕狀態和審核資訊\n    app.status = 'rejected'\n    app.rejectionReason = rejectionReason || '未提供拒絕原因'\n    app.reviewedBy = admin.email\n    app.reviewedAt = new Date().toISOString()\n    \n    // 新增到 rejected\n    store.rejected.push(app)\n    \n    // 寫回檔案\n    await fs.writeFile(dataPath, JSON.stringify(store, null, 2))\n    console.log('Application rejected and moved to rejected list:', app.id)\n    \n    return NextResponse.json({ \n      success: true, \n      message: 'Application rejected successfully',\n      rejection: {\n        id: app.id,\n        email: app.email,\n        displayName: app.displayName,\n        status: 'rejected',\n        reason: rejectionReason\n      }\n    })\n    \n  } catch (error) {\n    console.error('Error rejecting application:', error)\n    return NextResponse.json({ \n      error: 'Failed to reject application',\n      details: error instanceof Error ? error.message : 'Unknown error'\n    }, { status: 500 })\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/affiliate-admin/applications/route.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":11,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":11,"endColumn":18,"suggestions":[{"fix":{"range":[241,297],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":23,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":23,"endColumn":20,"suggestions":[{"fix":{"range":[647,712],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":24,"column":63,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":24,"endColumn":65,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[775,777],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":27,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":27,"endColumn":18,"suggestions":[{"fix":{"range":[805,874],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":29,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":29,"endColumn":18,"suggestions":[{"fix":{"range":[906,978],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":36,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":36,"endColumn":18,"suggestions":[{"fix":{"range":[1208,1271],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":39,"column":46,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":39,"endColumn":48,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1423,1425],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":41,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":41,"endColumn":18,"suggestions":[{"fix":{"range":[1442,1516],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":49,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":49,"endColumn":18,"suggestions":[{"fix":{"range":[1732,1796],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":52,"column":46,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":52,"endColumn":48,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1949,1951],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":54,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":54,"endColumn":18,"suggestions":[{"fix":{"range":[1968,2043],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":58,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":58,"endColumn":16,"suggestions":[{"fix":{"range":[2104,2162],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":62,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":62,"endColumn":18,"suggestions":[{"fix":{"range":[2239,2291],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server'\nimport * as path from 'path'\nimport * as fs from 'fs'\n\nexport async function GET() {\n  try {\n    // 首先嘗試從後端 API 獲取數據（與註冊路徑一致）\n    const backendUrl = 'http://35.236.182.29:9000'\n    \n    try {\n      console.log('Fetching applications from backend API...')\n      const response = await fetch(`${backendUrl}/admin/affiliate/applications`, {\n        method: 'GET',\n        headers: {\n          'Content-Type': 'application/json',\n          'Accept': 'application/json',\n        },\n        cache: 'no-store',\n      })\n      \n      if (response.ok) {\n        const applications = await response.json()\n        console.log('Successfully fetched applications from backend API')\n        return NextResponse.json({ applications: applications || [] })\n      }\n      \n      console.log('Backend API not available, falling back to file system')\n    } catch (apiError) {\n      console.log('Backend API error, falling back to file system:', apiError)\n    }\n\n    // 備用方案：讀取檔案系統（保持與註冊相同的資料來源）\n    const backendPath = path.join(process.cwd(), '..', 'medusa_decoupled', 'backend_vm', 'medusa-backend', 'src', 'data', 'affiliate.json')\n    \n    if (fs.existsSync(backendPath)) {\n      console.log('Reading applications from backend file system...')\n      const fileContent = fs.readFileSync(backendPath, 'utf8')\n      const data = JSON.parse(fileContent)\n      const applications = data.applications || []\n      \n      console.log(`Found ${applications.length} applications from backend file`)\n      return NextResponse.json({ applications })\n    }\n\n    // 如果後端檔案不存在，嘗試前端本地檔案\n    const frontendPath = path.join(process.cwd(), 'src', 'data', 'affiliate.json')\n    \n    if (fs.existsSync(frontendPath)) {\n      console.log('Reading applications from frontend file system...')\n      const fileContent = fs.readFileSync(frontendPath, 'utf8')\n      const data = JSON.parse(fileContent)\n      const applications = data.applications || []\n      \n      console.log(`Found ${applications.length} applications from frontend file`)\n      return NextResponse.json({ applications })\n    }\n\n    console.log('No data source found, returning empty array')\n    return NextResponse.json({ applications: [] })\n\n  } catch (error) {\n    console.error('Error fetching applications:', error)\n    return NextResponse.json(\n      { error: 'Failed to fetch applications', applications: [] },\n      { status: 500 }\n    )\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/affiliate-admin/members/[id]/status/route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":33,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[967,970],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[967,970],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":41,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1311,1314],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1311,1314],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":96,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":96,"endColumn":18,"suggestions":[{"fix":{"range":[3010,3041],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":115,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":115,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3444,3447],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3444,3447],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":124,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":124,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3641,3644],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3641,3644],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server'\nimport * as fs from 'fs'\nimport * as path from 'path'\n\n// 後端資料檔案路徑\nconst backendDataPath = path.join('/Users/raychou/tim-web/medusa_decoupled/backend_vm/medusa-backend/src/data/affiliate.json')\n\nexport async function PATCH(request: Request, { params }: { params: { id: string } }) {\n  try {\n    const { id } = params\n    const { status } = await request.json()\n    \n    // 驗證狀態值\n    if (!['active', 'pending', 'suspended'].includes(status)) {\n      return NextResponse.json(\n        { error: '無效的狀態值' },\n        { status: 400 }\n      )\n    }\n\n    // 讀取現有的聯盟資料\n    if (!fs.existsSync(backendDataPath)) {\n      return NextResponse.json(\n        { error: '找不到聯盟資料檔案' },\n        { status: 404 }\n      )\n    }\n\n    const backendContent = fs.readFileSync(backendDataPath, 'utf8')\n    const affiliateData = JSON.parse(backendContent)\n\n    // 首先檢查是否為現有的聯盟夥伴\n    const affiliateIndex = affiliateData.affiliates.findIndex((affiliate: any) => affiliate.id === id)\n    \n    if (affiliateIndex !== -1) {\n      // 更新現有聯盟夥伴的狀態\n      affiliateData.affiliates[affiliateIndex].status = status\n      affiliateData.affiliates[affiliateIndex].updated_at = new Date().toISOString()\n    } else {\n      // 檢查是否為待審核的申請\n      const applicationIndex = affiliateData.applications.findIndex((app: any) => app.id === id)\n      \n      if (applicationIndex === -1) {\n        return NextResponse.json(\n          { error: '找不到指定的聯盟會員或申請' },\n          { status: 404 }\n        )\n      }\n\n      const application = affiliateData.applications[applicationIndex]\n\n      if (status === 'active') {\n        // 申請通過，移動到聯盟夥伴列表\n        const newAffiliate = {\n          id: `aff_${Date.now()}`, // 生成新的聯盟夥伴ID\n          name: application.name,\n          email: application.email,\n          referral_code: generateReferralCode(),\n          commission_rate: 0.05, // 預設佣金率\n          status: 'active',\n          total_earnings: 0,\n          pending_earnings: 0,\n          website: application.website,\n          social_media: application.social_media ? parseJsonString(application.social_media) : {},\n          created_at: application.created_at,\n          updated_at: new Date().toISOString()\n        }\n\n        // 添加到聯盟夥伴列表\n        affiliateData.affiliates.push(newAffiliate)\n        \n        // 更新申請狀態為已批准\n        affiliateData.applications[applicationIndex].status = 'approved'\n        affiliateData.applications[applicationIndex].updated_at = new Date().toISOString()\n        \n      } else if (status === 'suspended') {\n        // 申請被拒絕\n        affiliateData.applications[applicationIndex].status = 'rejected'\n        affiliateData.applications[applicationIndex].updated_at = new Date().toISOString()\n      }\n    }\n\n    // 寫回檔案\n    fs.writeFileSync(backendDataPath, JSON.stringify(affiliateData, null, 2))\n\n    return NextResponse.json({ \n      success: true, \n      message: '狀態更新成功',\n      data: {\n        id,\n        status,\n        updated_at: new Date().toISOString()\n      }\n    })\n  } catch (error) {\n    console.error('更新狀態錯誤:', error)\n    return NextResponse.json(\n      { error: '無法更新狀態' },\n      { status: 500 }\n    )\n  }\n}\n\n// 生成推薦碼的輔助函數\nfunction generateReferralCode(): string {\n  const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'\n  let result = ''\n  for (let i = 0; i < 6; i++) {\n    result += chars.charAt(Math.floor(Math.random() * chars.length))\n  }\n  return result\n}\n\n// 解析社群媒體字符串的輔助函數\nfunction parseJsonString(str: string): any {\n  try {\n    // 如果已經是對象，直接返回\n    if (typeof str === 'object') return str\n    \n    // 嘗試解析 JSON\n    return JSON.parse(str)\n  } catch {\n    // 如果不是 JSON，嘗試解析為簡單的 key: value 格式\n    const result: any = {}\n    const pairs = str.split(', ')\n    pairs.forEach(pair => {\n      const [key, value] = pair.split(': ')\n      if (key && value) {\n        result[key.toLowerCase().trim()] = value.trim()\n      }\n    })\n    return result\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/affiliate-admin/members/route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'path' is defined but never used.","line":3,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":17},{"ruleId":"unused-imports/no-unused-imports","severity":2,"message":"'path' is defined but never used.","line":3,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":17,"fix":{"range":[68,98],"text":"\n"}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":30,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[727,730],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[727,730],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":45,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":45,"endColumn":20,"suggestions":[{"fix":{"range":[1169,1260],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":45,"column":95,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":45,"endColumn":97,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1255,1257],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":47,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":47,"endColumn":21,"suggestions":[{"fix":{"range":[1284,1354],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":52,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":52,"endColumn":22,"suggestions":[{"fix":{"range":[1557,1641],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":52,"column":90,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":52,"endColumn":92,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1636,1638],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":56,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":56,"endColumn":19,"suggestions":[{"fix":{"range":[1693,1783],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":61,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":61,"endColumn":20,"suggestions":[{"fix":{"range":[1976,2071],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":61,"column":99,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":61,"endColumn":101,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2066,2068],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":66,"column":80,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":83,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2193,2196],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2193,2196],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":99,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":99,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3315,3318],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3315,3318],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":100,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":100,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3366,3369],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3366,3369],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":127,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":127,"endColumn":18,"suggestions":[{"fix":{"range":[4187,4220],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server'\nimport * as fs from 'fs'\nimport * as path from 'path'\n\n// 定義會員資料的類型\ntype Member = {\n  id: string\n  email: string\n  displayName: string\n  status: 'active' | 'pending' | 'suspended'\n  totalOrders: number\n  totalRevenue: number\n  totalCommission: number\n  registeredAt: string\n  lastActive: string\n  referralCode: string\n  commissionRate: number\n  website?: string\n  socialMedia?: string\n  description?: string // 申請說明\n}\n\n// 後端資料檔案路徑 - 指向VM後端\nconst backendUrl = 'http://35.236.182.29:9000'\nconst backendDataPath = '/Users/raychou/tim-web/medusa_decoupled/backend_vm/medusa-backend/src/data/affiliate.json'\n\nexport async function GET() {\n  try {\n    // 讀取後端的真實聯盟資料\n    let affiliateData: any = { affiliates: [], applications: [] }\n    \n    try {\n      // 首先嘗試使用本機後端 API\n      const membersResponse = await fetch(`${backendUrl}/admin/affiliate-members`, {\n        method: 'GET',\n        headers: {\n          'Content-Type': 'application/json',\n          'Accept': 'application/json',\n        },\n        cache: 'no-store',\n      })\n      \n      if (membersResponse.ok) {\n        affiliateData = await membersResponse.json()\n        console.log('Members data loaded from backend API:', affiliateData.affiliates?.length || 0)\n      } else {\n        console.warn('Backend API not available, falling back to file system')\n        // 回退到讀取檔案\n        if (fs.existsSync(backendDataPath)) {\n          const backendContent = fs.readFileSync(backendDataPath, 'utf8')\n          affiliateData = JSON.parse(backendContent)\n          console.log('Members data loaded from file:', affiliateData.affiliates?.length || 0)\n        }\n      }\n    } catch (fetchError) {\n      console.warn('Failed to fetch from backend API, falling back to file system:', fetchError)\n      // 回退到讀取檔案\n      if (fs.existsSync(backendDataPath)) {\n        const backendContent = fs.readFileSync(backendDataPath, 'utf8')\n        affiliateData = JSON.parse(backendContent)\n        console.log('Members data loaded from file (fallback):', affiliateData.affiliates?.length || 0)\n      }\n    }\n\n    // 將已批准的聯盟夥伴轉換為前端需要的格式\n    const approvedMembers: Member[] = affiliateData.affiliates.map((affiliate: any) => {\n      // 計算總收入和總佣金\n      const totalRevenue = affiliate.total_earnings + affiliate.pending_earnings\n      const totalCommission = affiliate.total_earnings\n      \n      // 估算訂單數量（基於收入，假設平均單價為1000元）\n      const totalOrders = Math.floor(totalRevenue / 1000) || 0\n      \n      // 解析社群媒體資訊\n      const socialMediaText = affiliate.social_media ? \n        Object.entries(affiliate.social_media)\n          .map(([platform, url]) => `${platform}: ${url}`)\n          .join(', ') : ''\n\n      return {\n        id: affiliate.id,\n        email: affiliate.email,\n        displayName: affiliate.name,\n        status: affiliate.status as 'active' | 'pending' | 'suspended',\n        totalOrders,\n        totalRevenue,\n        totalCommission,\n        registeredAt: affiliate.created_at,\n        lastActive: affiliate.updated_at,\n        referralCode: affiliate.referral_code,\n        commissionRate: affiliate.commission_rate,\n        website: affiliate.website,\n        socialMedia: socialMediaText\n      }\n    })\n\n    // 將待審核的申請轉換為前端需要的格式\n    const pendingApplications: Member[] = affiliateData.applications\n      .filter((app: any) => app.status === 'pending')\n      .map((app: any) => {\n        return {\n          id: app.id,\n          email: app.email,\n          displayName: app.name,\n          status: 'pending' as const,\n          totalOrders: 0,\n          totalRevenue: 0,\n          totalCommission: 0,\n          registeredAt: app.created_at,\n          lastActive: app.updated_at,\n          referralCode: '', // 申請階段還沒有推薦碼\n          commissionRate: 0.05, // 預設佣金率\n          website: app.website,\n          socialMedia: app.social_media,\n          description: app.description // 新增申請說明\n        }\n      })\n\n    // 合併所有會員資料\n    const members = [...approvedMembers, ...pendingApplications]\n\n    // 按註冊時間排序（最新的在前）\n    members.sort((a: Member, b: Member) => new Date(b.registeredAt).getTime() - new Date(a.registeredAt).getTime())\n\n    return NextResponse.json({ members })\n  } catch (error) {\n    console.error('獲取會員列表錯誤:', error)\n    return NextResponse.json(\n      { error: '無法獲取會員列表' },\n      { status: 500 }\n    )\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/affiliate-admin/overview/route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":7,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[166,169],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[166,169],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":11,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[222,225],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[222,225],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":15,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[288,291],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[288,291],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'request' is defined but never used.","line":32,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":32,"endColumn":34},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'request' is defined but never used. Allowed unused args must match /^_/u.","line":32,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":32,"endColumn":34},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":59,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":59,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1687,1690],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1687,1690],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":78,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2260,2263],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2260,2263],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":89,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":89,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2570,2573],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2570,2573],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":106,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":106,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3053,3056],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3053,3056],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":119,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":119,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3421,3424],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3421,3424],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":144,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":144,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4304,4307],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4304,4307],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":145,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":145,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4410,4413],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4410,4413],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":150,"column":55,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":150,"endColumn":57,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[4508,4584],"text":"(affiliateSettings?.profile?.displayName ?? affiliateSettings?.profile?.email)"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":150,"column":92,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":150,"endColumn":94,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[4585,4587],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":174,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":174,"endColumn":18,"suggestions":[{"fix":{"range":[5153,5187],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":11,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server'\nimport * as fs from 'fs'\nimport * as path from 'path'\n\n// 類型定義\ninterface AffiliateStats {\n  affiliateStats: Record<string, any>\n}\n\ninterface AffiliateSettlements {\n  settlements: any[]\n}\n\ninterface AffiliateSettings {\n  settings: Record<string, any>\n}\n\ninterface RecentActivity {\n  id: string\n  type: string\n  affiliateId: string\n  description: string\n  timestamp: string\n  amount?: number\n}\n\nconst dataDir = path.join(process.cwd(), 'data')\nconst statsPath = path.join(dataDir, 'affiliate-stats.json')\nconst settlementsPath = path.join(dataDir, 'affiliate-settlements.json')\nconst settingsPath = path.join(dataDir, 'affiliate-settings.json')\n\nexport async function GET(request: Request) {\n  try {\n    // 讀取統計數據\n    let stats: AffiliateStats = { affiliateStats: {} }\n    if (fs.existsSync(statsPath)) {\n      const statsContent = fs.readFileSync(statsPath, 'utf8')\n      stats = JSON.parse(statsContent)\n    }\n\n    // 讀取結算數據\n    let settlements: AffiliateSettlements = { settlements: [] }\n    if (fs.existsSync(settlementsPath)) {\n      const settlementsContent = fs.readFileSync(settlementsPath, 'utf8')\n      settlements = JSON.parse(settlementsContent)\n    }\n\n    // 讀取設定數據\n    let settings: AffiliateSettings = { settings: {} }\n    if (fs.existsSync(settingsPath)) {\n      const settingsContent = fs.readFileSync(settingsPath, 'utf8')\n      settings = JSON.parse(settingsContent)\n    }\n\n    // 計算統計摘要\n    const affiliateIds = Object.keys(stats.affiliateStats || {})\n    const totalAffiliates = affiliateIds.length\n    const activeAffiliates = affiliateIds.filter(id => {\n      const affiliateStats = (stats.affiliateStats as Record<string, any>)?.[id]\n      return affiliateStats?.orders?.length > 0\n    }).length\n    const pendingAffiliates = 0 // 需要實際的申請系統\n\n    // 計算本月數據\n    const now = new Date()\n    const thisMonthStart = new Date(now.getFullYear(), now.getMonth(), 1)\n    \n    let thisMonthOrders = 0\n    let thisMonthRevenue = 0\n    let totalCommission = 0\n    let totalSettled = 0\n    let pendingSettlement = 0\n\n    affiliateIds.forEach(affiliateId => {\n      const affiliateStats = stats.affiliateStats[affiliateId]\n      if (!affiliateStats?.orders) return\n\n      affiliateStats.orders.forEach((order: any) => {\n        const orderDate = new Date(order.date)\n        if (orderDate >= thisMonthStart) {\n          thisMonthOrders++\n          thisMonthRevenue += order.orderValue\n        }\n        totalCommission += order.commission\n      })\n    })\n\n    // 計算已結算金額\n    settlements.settlements.forEach((settlement: any) => {\n      if (settlement.status === 'completed') {\n        totalSettled += settlement.amount\n      } else {\n        pendingSettlement += settlement.amount\n      }\n    })\n\n    // 生成最近活動\n    const recentActivities: RecentActivity[] = []\n    let activityId = 1\n\n    // 從訂單中生成活動\n    affiliateIds.forEach(affiliateId => {\n      const affiliateStats = stats.affiliateStats[affiliateId]\n      if (!affiliateStats?.orders) return\n\n      affiliateStats.orders.slice(-3).forEach((order: any) => {\n        recentActivities.push({\n          id: `act_${activityId++}`,\n          type: 'order' as const,\n          description: `新訂單 #${order.orderId}`,\n          amount: order.commission,\n          timestamp: order.date,\n          affiliateId: affiliateId\n        })\n      })\n    })\n\n    // 從結算中生成活動\n    settlements.settlements.slice(-2).forEach((settlement: any) => {\n      recentActivities.push({\n        id: `act_${activityId++}`,\n        type: 'settlement' as const,\n        description: `結算處理 - ${settlement.status === 'completed' ? '已完成' : '待處理'}`,\n        amount: settlement.amount,\n        timestamp: settlement.createdAt,\n        affiliateId: settlement.affiliateId\n      })\n    })\n\n    // 按時間排序，取最新5個\n    recentActivities.sort((a, b) => new Date(b.timestamp).getTime() - new Date(a.timestamp).getTime())\n\n    // 計算頂級聯盟商\n    const topAffiliates = affiliateIds.map(affiliateId => {\n      const affiliateStats = stats.affiliateStats[affiliateId]\n      const affiliateSettings = settings.settings[affiliateId]\n      \n      let orders = 0\n      let revenue = 0\n      let commission = 0\n\n      if (affiliateStats?.orders) {\n        orders = affiliateStats.orders.length\n        revenue = affiliateStats.orders.reduce((sum: number, order: any) => sum + order.orderValue, 0)\n        commission = affiliateStats.orders.reduce((sum: number, order: any) => sum + order.commission, 0)\n      }\n\n      return {\n        id: affiliateId,\n        name: affiliateSettings?.profile?.displayName || affiliateSettings?.profile?.email || affiliateId,\n        orders,\n        revenue,\n        commission\n      }\n    }).sort((a, b) => b.commission - a.commission)\n\n    const adminOverviewData = {\n      summary: {\n        totalAffiliates,\n        activeAffiliates,\n        pendingAffiliates,\n        totalCommission,\n        totalSettled,\n        pendingSettlement,\n        thisMonthOrders,\n        thisMonthRevenue\n      },\n      recentActivities: recentActivities.slice(0, 5),\n      topAffiliates: topAffiliates.slice(0, 5)\n    }\n\n    return NextResponse.json(adminOverviewData)\n  } catch (error) {\n    console.error('管理總覽API錯誤:', error)\n    return NextResponse.json(\n      { error: '無法獲取管理總覽數據' },\n      { status: 500 }\n    )\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/affiliate-admin/settlements/[settlementId]/process/route.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":66,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":66,"endColumn":18,"suggestions":[{"fix":{"range":[1738,1769],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server'\nimport * as fs from 'fs'\nimport * as path from 'path'\nimport { SettlementsData, Settlement } from '../../../../../../types/affiliate'\n\nconst dataDir = path.join(process.cwd(), 'data')\nconst settlementsPath = path.join(dataDir, 'affiliate-settlements.json')\n\nexport async function POST(\n  request: Request,\n  { params }: { params: Promise<{ settlementId: string }> }\n) {\n  try {\n    const { settlementId } = await params\n\n    // 確保數據目錄存在\n    if (!fs.existsSync(dataDir)) {\n      fs.mkdirSync(dataDir, { recursive: true })\n    }\n\n    // 讀取現有結算\n    let settlements: SettlementsData = { settlements: [] }\n    if (fs.existsSync(settlementsPath)) {\n      const settlementsContent = fs.readFileSync(settlementsPath, 'utf8')\n      settlements = JSON.parse(settlementsContent)\n    }\n\n    // 查找要處理的結算\n    const settlementIndex = settlements.settlements.findIndex(\n      (s: Settlement) => s.id === settlementId\n    )\n\n    if (settlementIndex === -1) {\n      return NextResponse.json(\n        { error: '結算不存在' },\n        { status: 404 }\n      )\n    }\n\n    const settlement = settlements.settlements[settlementIndex]\n\n    if (settlement.status !== 'pending') {\n      return NextResponse.json(\n        { error: '只能處理待處理狀態的結算' },\n        { status: 400 }\n      )\n    }\n\n    // 模擬處理結算（在實際應用中這裡會調用支付服務）\n    // 這裡我們直接標記為已完成\n    settlements.settlements[settlementIndex] = {\n      ...settlement,\n      status: 'completed',\n      processedAt: new Date().toISOString(),\n      updatedAt: new Date().toISOString()\n    }\n\n    // 保存到檔案\n    fs.writeFileSync(settlementsPath, JSON.stringify(settlements, null, 2))\n\n    return NextResponse.json({ \n      success: true,\n      message: '結算處理成功'\n    })\n  } catch (error) {\n    console.error('處理結算錯誤:', error)\n    return NextResponse.json(\n      { error: '無法處理結算' },\n      { status: 500 }\n    )\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/affiliate-admin/settlements/batch-process/route.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":61,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":61,"endColumn":18,"suggestions":[{"fix":{"range":[1778,1811],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server'\nimport * as fs from 'fs'\nimport * as path from 'path'\nimport { SettlementsData, Settlement } from '../../../../../types/affiliate'\n\nconst dataDir = path.join(process.cwd(), 'data')\nconst settlementsPath = path.join(dataDir, 'affiliate-settlements.json')\n\nexport async function POST(request: Request) {\n  try {\n    const { settlementIds } = await request.json()\n\n    if (!Array.isArray(settlementIds) || settlementIds.length === 0) {\n      return NextResponse.json(\n        { error: '無效的結算ID列表' },\n        { status: 400 }\n      )\n    }\n\n    // 確保數據目錄存在\n    if (!fs.existsSync(dataDir)) {\n      fs.mkdirSync(dataDir, { recursive: true })\n    }\n\n    // 讀取現有結算\n    let settlements: SettlementsData = { settlements: [] }\n    if (fs.existsSync(settlementsPath)) {\n      const settlementsContent = fs.readFileSync(settlementsPath, 'utf8')\n      settlements = JSON.parse(settlementsContent)\n    }\n\n    let processedCount = 0\n    let failedCount = 0\n\n    // 批量處理結算\n    settlements.settlements = settlements.settlements.map((settlement: Settlement) => {\n      if (settlementIds.includes(settlement.id) && settlement.status === 'pending') {\n        processedCount++\n        return {\n          ...settlement,\n          status: 'completed',\n          processedAt: new Date().toISOString(),\n          updatedAt: new Date().toISOString()\n        }\n      } else if (settlementIds.includes(settlement.id)) {\n        failedCount++\n      }\n      return settlement\n    })\n\n    // 保存到檔案\n    fs.writeFileSync(settlementsPath, JSON.stringify(settlements, null, 2))\n\n    return NextResponse.json({ \n      success: true,\n      message: `批量處理完成: ${processedCount} 筆成功, ${failedCount} 筆失敗`,\n      processedCount,\n      failedCount\n    })\n  } catch (error) {\n    console.error('批量處理結算錯誤:', error)\n    return NextResponse.json(\n      { error: '無法批量處理結算' },\n      { status: 500 }\n    )\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/affiliate-admin/settlements/route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":20,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[713,716],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[713,716],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":28,"column":75,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":28,"endColumn":77,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1076,1078],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":32,"column":63,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":32,"endColumn":65,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1150,1247],"text":"(affiliateSettings.profile?.displayName ?? \n                      affiliateSettings.profile?.email)"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":33,"column":56,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":33,"endColumn":58,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1248,1250],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":39,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1361,1364],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1361,1364],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":39,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1369,1372],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1369,1372],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":45,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":45,"endColumn":18,"suggestions":[{"fix":{"range":[1548,1581],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server'\nimport * as fs from 'fs'\nimport * as path from 'path'\nimport { SettlementsData, Settlement } from '../../../../types/affiliate'\n\nconst dataDir = path.join(process.cwd(), 'data')\nconst settlementsPath = path.join(dataDir, 'affiliate-settlements.json')\nconst settingsPath = path.join(dataDir, 'affiliate-settings.json')\n\nexport async function GET() {\n  try {\n    // 讀取結算數據\n    let settlements: SettlementsData = { settlements: [] }\n    if (fs.existsSync(settlementsPath)) {\n      const settlementsContent = fs.readFileSync(settlementsPath, 'utf8')\n      settlements = JSON.parse(settlementsContent)\n    }\n\n    // 讀取設置數據來獲取會員名稱\n    let settings: { settings: Record<string, any> } = { settings: {} }\n    if (fs.existsSync(settingsPath)) {\n      const settingsContent = fs.readFileSync(settingsPath, 'utf8')\n      settings = JSON.parse(settingsContent)\n    }\n\n    // 豐富結算數據\n    const enrichedSettlements = settlements.settlements.map((settlement: Settlement) => {\n      const affiliateSettings = settings.settings[settlement.affiliateId] || {}\n      \n      return {\n        ...settlement,\n        affiliateName: affiliateSettings.profile?.displayName || \n                      affiliateSettings.profile?.email || \n                      settlement.affiliateId\n      }\n    })\n\n    // 按創建時間排序\n    enrichedSettlements.sort((a: any, b: any) => \n      new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime()\n    )\n\n    return NextResponse.json({ settlements: enrichedSettlements })\n  } catch (error) {\n    console.error('獲取結算列表錯誤:', error)\n    return NextResponse.json(\n      { error: '無法獲取結算列表' },\n      { status: 500 }\n    )\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/affiliate-admin/signout/route.ts","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":8,"column":57,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":8,"endColumn":59,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[316,318],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":13,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[441,444],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[441,444],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":20,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":20,"endColumn":18,"suggestions":[{"fix":{"range":[605,659],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { affiliateAdminSignout } from '../../../../lib/data/affiliate-admin-auth'\nimport { NextRequest } from 'next/server'\n\nexport async function POST(request: NextRequest) {\n  try {\n    // 從請求參數獲取國家代碼，預設為 tw\n    const { searchParams } = new URL(request.url)\n    const countryCode = searchParams.get('countryCode') || 'tw'\n    \n    await affiliateAdminSignout(countryCode)\n    \n    return Response.json({ success: true })\n  } catch (error: any) {\n    // 檢查是否是 Next.js redirect 錯誤\n    if (error?.digest?.startsWith?.('NEXT_REDIRECT')) {\n      // 這是正常的重定向，重新拋出讓 Next.js 處理\n      throw error\n    }\n    \n    console.error('Affiliate admin signout error:', error)\n    return Response.json({ error: '登出失敗' }, { status: 500 })\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/affiliate/links/click/route.ts","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":6,"column":57,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":6,"endColumn":59,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[241,243],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":16,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":17},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":16,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":17},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":26,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":26,"endColumn":18,"suggestions":[{"fix":{"range":[930,964],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":69,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":69,"endColumn":18,"suggestions":[{"fix":{"range":[2026,2058],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\nimport { promises as fs } from 'fs'\nimport path from 'path'\nimport type { AffiliateLink } from '../../../../../types/affiliate'\n\nconst STORAGE_MODE = process.env.AFFILIATE_STORAGE_MODE || 'memory'\nconst STORAGE_DIR = path.join(process.cwd(), 'data', 'affiliate-links')\nconst STORAGE_FILE = path.join(STORAGE_DIR, 'links.json')\n\nlet memoryStorage: { [affiliateId: string]: AffiliateLink[] } = {}\n\nasync function loadLinksFromFile(): Promise<{ [affiliateId: string]: AffiliateLink[] }> {\n  try {\n    const data = await fs.readFile(STORAGE_FILE, 'utf-8')\n    return JSON.parse(data)\n  } catch (error) {\n    return {}\n  }\n}\n\nasync function saveLinksToFile(allLinks: { [affiliateId: string]: AffiliateLink[] }) {\n  try {\n    await fs.mkdir(STORAGE_DIR, { recursive: true })\n    await fs.writeFile(STORAGE_FILE, JSON.stringify(allLinks, null, 2), 'utf-8')\n  } catch (error) {\n    console.error('儲存連結到檔案失敗:', error)\n  }\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const { linkId, affiliateId } = await request.json()\n\n    if (!linkId || !affiliateId) {\n      return NextResponse.json({ error: '缺少必要參數' }, { status: 400 })\n    }\n\n    // 獲取所有連結\n    let allLinks: { [affiliateId: string]: AffiliateLink[] }\n    if (STORAGE_MODE === 'json') {\n      allLinks = await loadLinksFromFile()\n    } else {\n      allLinks = memoryStorage\n    }\n\n    // 找到並更新指定連結的點擊數\n    const affiliateLinks = allLinks[affiliateId] || []\n    const linkIndex = affiliateLinks.findIndex(link => link.id === linkId)\n    \n    if (linkIndex !== -1) {\n      affiliateLinks[linkIndex].clicks += 1\n      \n      // 保存更新\n      if (STORAGE_MODE === 'json') {\n        await saveLinksToFile(allLinks)\n      } else {\n        memoryStorage = allLinks\n      }\n      \n      return NextResponse.json({ \n        success: true, \n        clickCount: affiliateLinks[linkIndex].clicks \n      })\n    } else {\n      return NextResponse.json({ error: '連結不存在' }, { status: 404 })\n    }\n\n  } catch (error) {\n    console.error('更新點擊數失敗:', error)\n    return NextResponse.json({ error: '更新點擊數失敗' }, { status: 500 })\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/affiliate/links/route.ts","messages":[{"ruleId":"prefer-const","severity":2,"message":"'memoryStorage' is never reassigned. Use 'const' instead.","line":8,"column":5,"nodeType":"Identifier","messageId":"useConst","endLine":8,"endColumn":62,"fix":{"range":[237,303],"text":"const memoryStorage: { [affiliateId: string]: AffiliateLink[] } = {}"}},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":11,"column":57,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":11,"endColumn":59,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[371,373],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":19,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":17},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":19,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":30,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":30,"endColumn":17},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":30,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":30,"endColumn":17},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":42,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":42,"endColumn":18,"suggestions":[{"fix":{"range":[1227,1261],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":110,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":110,"endColumn":16,"suggestions":[{"fix":{"range":[3045,3128],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":114,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":114,"endColumn":18,"suggestions":[{"fix":{"range":[3198,3229],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":138,"column":54,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":138,"endColumn":56,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3801,3803],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":143,"column":62,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":143,"endColumn":64,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3998,4000],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":144,"column":62,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":144,"endColumn":64,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[4075,4077],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":145,"column":66,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":145,"endColumn":68,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[4155,4157],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":160,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":160,"endColumn":16,"suggestions":[{"fix":{"range":[4449,4648],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":177,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":177,"endColumn":18,"suggestions":[{"fix":{"range":[4782,4813],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":205,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":205,"endColumn":16,"suggestions":[{"fix":{"range":[5389,5499],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":217,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":217,"endColumn":18,"suggestions":[{"fix":{"range":[5610,5641],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":10,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import { NextResponse, NextRequest } from 'next/server'\nimport { cookies } from 'next/headers'\nimport { promises as fs } from 'fs'\nimport path from 'path'\nimport type { AffiliateLink } from '../../../../types/affiliate'\n\n// 記憶體儲存 (開發模式)\nlet memoryStorage: { [affiliateId: string]: AffiliateLink[] } = {}\n\n// 檔案儲存設定\nconst STORAGE_MODE = process.env.AFFILIATE_STORAGE_MODE || 'memory' // 'memory' | 'json'\nconst STORAGE_DIR = path.join(process.cwd(), 'data', 'affiliate-links')\nconst STORAGE_FILE = path.join(STORAGE_DIR, 'links.json')\n\n// 確保儲存目錄存在\nasync function ensureStorageDir() {\n  try {\n    await fs.mkdir(STORAGE_DIR, { recursive: true })\n  } catch (error) {\n    // 目錄已存在或其他錯誤，繼續執行\n  }\n}\n\n// 從檔案讀取所有連結\nasync function loadLinksFromFile(): Promise<{ [affiliateId: string]: AffiliateLink[] }> {\n  try {\n    await ensureStorageDir()\n    const data = await fs.readFile(STORAGE_FILE, 'utf-8')\n    return JSON.parse(data)\n  } catch (error) {\n    // 檔案不存在或讀取錯誤，返回空物件\n    return {}\n  }\n}\n\n// 儲存所有連結到檔案\nasync function saveLinksToFile(allLinks: { [affiliateId: string]: AffiliateLink[] }) {\n  try {\n    await ensureStorageDir()\n    await fs.writeFile(STORAGE_FILE, JSON.stringify(allLinks, null, 2), 'utf-8')\n  } catch (error) {\n    console.error('儲存連結到檔案失敗:', error)\n    throw error\n  }\n}\n\n// 取得聯盟會員的連結\nasync function getAffiliateLinks(affiliateId: string): Promise<AffiliateLink[]> {\n  if (STORAGE_MODE === 'json') {\n    const allLinks = await loadLinksFromFile()\n    return allLinks[affiliateId] || []\n  } else {\n    return memoryStorage[affiliateId] || []\n  }\n}\n\n// 新增連結\nasync function addAffiliateLink(affiliateId: string, link: AffiliateLink) {\n  if (STORAGE_MODE === 'json') {\n    const allLinks = await loadLinksFromFile()\n    if (!allLinks[affiliateId]) {\n      allLinks[affiliateId] = []\n    }\n    allLinks[affiliateId].push(link)\n    await saveLinksToFile(allLinks)\n  } else {\n    if (!memoryStorage[affiliateId]) {\n      memoryStorage[affiliateId] = []\n    }\n    memoryStorage[affiliateId].push(link)\n  }\n}\n\n// 刪除連結\nasync function removeAffiliateLink(affiliateId: string, linkId: string) {\n  if (STORAGE_MODE === 'json') {\n    const allLinks = await loadLinksFromFile()\n    if (allLinks[affiliateId]) {\n      allLinks[affiliateId] = allLinks[affiliateId].filter(link => link.id !== linkId)\n      await saveLinksToFile(allLinks)\n    }\n  } else {\n    if (memoryStorage[affiliateId]) {\n      memoryStorage[affiliateId] = memoryStorage[affiliateId].filter(link => link.id !== linkId)\n    }\n  }\n}\n\n// 輔助函數：獲取當前聯盟會員\nasync function getCurrentAffiliate() {\n  try {\n    const cookieStore = await cookies()\n    const token = cookieStore.get('_affiliate_jwt')?.value\n    if (!token) return null\n    const json = Buffer.from(token, 'base64').toString()\n    return JSON.parse(json)\n  } catch {\n    return null\n  }\n}\n\nexport async function GET() {\n  const affiliate = await getCurrentAffiliate()\n  if (!affiliate) {\n    return NextResponse.json({ error: '未授權' }, { status: 401 })\n  }\n\n  try {\n    const links = await getAffiliateLinks(affiliate.id)\n    console.log(`取得聯盟會員 ${affiliate.id} 的 ${links.length} 個連結 (儲存模式: ${STORAGE_MODE})`)\n    \n    return NextResponse.json({ links })\n  } catch (error) {\n    console.error('獲取連結失敗:', error)\n    return NextResponse.json({ error: '伺服器錯誤' }, { status: 500 })\n  }\n}\n\nexport async function POST(request: NextRequest) {\n  const affiliate = await getCurrentAffiliate()\n  if (!affiliate) {\n    return NextResponse.json({ error: '未授權' }, { status: 401 })\n  }\n\n  try {\n    const body = await request.json()\n    const { name, targetUrl, utmParams } = body\n\n    // 驗證必填欄位\n    if (!name || !targetUrl) {\n      return NextResponse.json(\n        { error: '缺少必填欄位' },\n        { status: 400 }\n      )\n    }\n\n    // 建構完整的推廣連結\n    const baseUrl = process.env.NEXT_PUBLIC_BASE_URL || 'http://localhost:3000'\n    const url = new URL(targetUrl, baseUrl)\n    \n    // 添加聯盟參數\n    url.searchParams.set('ref', affiliate.id)\n    url.searchParams.set('utm_source', utmParams?.utm_source || 'affiliate')\n    url.searchParams.set('utm_medium', utmParams?.utm_medium || 'referral')\n    url.searchParams.set('utm_campaign', utmParams?.utm_campaign || name)\n    \n    // 創建新連結\n    const newLink: AffiliateLink = {\n      id: `lnk_${Date.now()}`,\n      name,\n      url: url.toString(),\n      createdAt: new Date().toISOString(),\n      clicks: 0,\n      conversions: 0,\n    }\n\n    // 儲存連結\n    await addAffiliateLink(affiliate.id, newLink)\n    \n    console.log('創建新的聯盟連結:', {\n      affiliateId: affiliate.id,\n      linkId: newLink.id,\n      name,\n      targetUrl,\n      finalUrl: newLink.url,\n      utmParams,\n      storageMode: STORAGE_MODE\n    })\n\n    return NextResponse.json({ \n      success: true, \n      link: newLink,\n      message: '連結創建成功' \n    })\n\n  } catch (error) {\n    console.error('創建連結失敗:', error)\n    return NextResponse.json(\n      { error: '伺服器錯誤' },\n      { status: 500 }\n    )\n  }\n}\n\nexport async function DELETE(request: NextRequest) {\n  const affiliate = await getCurrentAffiliate()\n  if (!affiliate) {\n    return NextResponse.json({ error: '未授權' }, { status: 401 })\n  }\n\n  try {\n    const { searchParams } = new URL(request.url)\n    const linkId = searchParams.get('id')\n\n    if (!linkId) {\n      return NextResponse.json(\n        { error: '缺少連結 ID' },\n        { status: 400 }\n      )\n    }\n\n    // 刪除連結\n    await removeAffiliateLink(affiliate.id, linkId)\n    \n    console.log('刪除聯盟連結:', {\n      affiliateId: affiliate.id,\n      linkId,\n      storageMode: STORAGE_MODE\n    })\n\n    return NextResponse.json({ \n      success: true,\n      message: '連結已刪除' \n    })\n\n  } catch (error) {\n    console.error('刪除連結失敗:', error)\n    return NextResponse.json(\n      { error: '伺服器錯誤' },\n      { status: 500 }\n    )\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/affiliate/orders/route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ClickRecord' is defined but never used.","line":4,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":21},{"ruleId":"unused-imports/no-unused-imports","severity":2,"message":"'ClickRecord' is defined but never used.","line":4,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":21,"fix":{"range":[182,241],"text":"\n"}},{"ruleId":"prefer-const","severity":2,"message":"'linkNames' is never reassigned. Use 'const' instead.","line":30,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":30,"endColumn":48,"fix":{"range":[750,798],"text":"const linkNames: { [linkId: string]: string } = {}"}},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":32,"column":72,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":32,"endColumn":74,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[880,882],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":39,"column":40,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":39,"endColumn":42,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1178,1180],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":40,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":40,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1213,1216],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1213,1216],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":45,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":45,"endColumn":19,"suggestions":[{"fix":{"range":[1311,1343],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":50,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1441,1444],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1441,1444],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":54,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1612,1615],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1612,1615],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":59,"column":41,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":59,"endColumn":43,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1812,1814],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":60,"column":42,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":60,"endColumn":44,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1859,1861],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":61,"column":42,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":61,"endColumn":44,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1923,1925],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":84,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":84,"endColumn":18,"suggestions":[{"fix":{"range":[2609,2642],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":2,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server'\nimport { retrieveAffiliate } from '../../../../lib/data/affiliate-auth'\nimport { getAllStats } from '../../../../lib/data/affiliate-stats'\nimport { ClickRecord } from '../../../../types/affiliate'\n\n// 訂單類型定義\ntype AffiliateOrder = {\n  id: string\n  clickId: string\n  linkId: string\n  linkName: string\n  orderValue: number\n  commission: number\n  customerEmail?: string\n  createdAt: string\n  status: 'pending' | 'confirmed' | 'cancelled'\n}\n\nexport async function GET() {\n  try {\n    const session = await retrieveAffiliate()\n    if (!session) {\n      return NextResponse.json({ error: '未授權' }, { status: 401 })\n    }\n\n    // 獲取統計資料中的轉換記錄\n    const stats = await getAllStats()\n    \n    // 獲取聯盟連結資料（用於獲取連結名稱）\n    let linkNames: { [linkId: string]: string } = {}\n    try {\n      const response = await fetch(`${process.env.NEXT_PUBLIC_BASE_URL || 'http://localhost:3000'}/api/affiliate/links`, {\n        headers: {\n          'Cookie': `_affiliate_jwt=${Buffer.from(JSON.stringify(session)).toString('base64')}`\n        }\n      })\n      if (response.ok) {\n        const linksData = await response.json()\n        const links = linksData?.links || []\n        links.forEach((link: any) => {\n          linkNames[link.id] = link.name\n        })\n      }\n    } catch (error) {\n      console.warn('無法獲取連結資料:', error)\n    }\n    \n    // 篩選該聯盟夥伴的已轉換點擊記錄\n    const affiliateClicks = stats.clicks.filter(\n      (click: any) => click.affiliateId === session.id && click.converted && click.conversionValue\n    )\n\n    // 生成訂單資料\n    const orders: AffiliateOrder[] = affiliateClicks.map((click: any) => ({\n      id: `order_${click.id}`,\n      clickId: click.id,\n      linkId: click.linkId,\n      linkName: linkNames[click.linkId] || `連結 ${click.linkId}`,\n      orderValue: click.conversionValue || 0,\n      commission: (click.conversionValue || 0) * 0.1, // 10% 佣金\n      customerEmail: click.customerEmail || '',\n      createdAt: click.timestamp,\n      status: 'confirmed' as const,\n    }))\n\n    // 按日期倒序排列\n    orders.sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime())\n\n    const summary = {\n      totalOrders: orders.length,\n      totalValue: orders.reduce((sum, order) => sum + order.orderValue, 0),\n      totalCommission: orders.reduce((sum, order) => sum + order.commission, 0),\n      pendingCommission: orders\n        .filter(order => order.status === 'pending')\n        .reduce((sum, order) => sum + order.commission, 0),\n    }\n\n    return NextResponse.json({\n      summary,\n      orders: orders.slice(0, 20), // 最近 20 筆訂單\n    })\n\n  } catch (error) {\n    console.error('獲取聯盟訂單失敗:', error)\n    return NextResponse.json({ \n      summary: {\n        totalOrders: 0,\n        totalValue: 0,\n        totalCommission: 0,\n        pendingCommission: 0,\n      },\n      orders: []\n    })\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/affiliate/payouts/route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":33,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":33,"endColumn":17},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":33,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":33,"endColumn":17},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":85,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":85,"endColumn":18,"suggestions":[{"fix":{"range":[2402,2435],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":116,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":116,"endColumn":18,"suggestions":[{"fix":{"range":[3187,3220],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":167,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":167,"endColumn":16,"suggestions":[{"fix":{"range":[4613,4677],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":175,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":175,"endColumn":18,"suggestions":[{"fix":{"range":[4788,4819],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\nimport { retrieveAffiliate } from '../../../../lib/data/affiliate-auth'\nimport { promises as fs } from 'fs'\nimport path from 'path'\n\n// 結算記錄型別\ntype PayoutRecord = {\n  id: string\n  affiliateId: string\n  amount: number\n  currency: string\n  status: 'pending' | 'processing' | 'paid' | 'failed'\n  requestedAt: string\n  processedAt?: string\n  method: 'bank_transfer' | 'paypal' | 'stripe'\n  reference?: string\n  note?: string\n}\n\ntype PayoutData = {\n  payouts: PayoutRecord[]\n  lastUpdated: string\n}\n\nconst PAYOUT_FILE = path.join(process.cwd(), 'data', 'affiliate-payouts.json')\n\n// 確保數據文件存在\nasync function ensurePayoutFile(): Promise<PayoutData> {\n  try {\n    await fs.mkdir(path.dirname(PAYOUT_FILE), { recursive: true })\n    const data = await fs.readFile(PAYOUT_FILE, 'utf-8')\n    return JSON.parse(data)\n  } catch (error) {\n    const initialData: PayoutData = {\n      payouts: [],\n      lastUpdated: new Date().toISOString()\n    }\n    await savePayoutData(initialData)\n    return initialData\n  }\n}\n\n// 儲存數據\nasync function savePayoutData(data: PayoutData): Promise<void> {\n  data.lastUpdated = new Date().toISOString()\n  await fs.writeFile(PAYOUT_FILE, JSON.stringify(data, null, 2))\n}\n\n// 計算結算摘要\nasync function calculatePayoutSummary(affiliateId: string): Promise<{\n  totalEarned: number\n  totalPaid: number\n  pendingAmount: number\n  availableForPayout: number\n  minimumPayout: number\n  nextPayoutDate?: string\n}> {\n  // 從統計系統獲取總收入\n  try {\n    const { getAffiliateStats } = await import('../../../../lib/data/affiliate-stats')\n    const stats = await getAffiliateStats(affiliateId, 365) // 一年內的數據\n    \n    const payoutData = await ensurePayoutFile()\n    const affiliatePayouts = payoutData.payouts.filter(p => p.affiliateId === affiliateId)\n    \n    const totalPaid = affiliatePayouts\n      .filter(p => p.status === 'paid')\n      .reduce((sum, p) => sum + p.amount, 0)\n    \n    const pendingAmount = affiliatePayouts\n      .filter(p => p.status === 'pending' || p.status === 'processing')\n      .reduce((sum, p) => sum + p.amount, 0)\n    \n    const availableForPayout = Math.max(0, stats.totalCommission - totalPaid - pendingAmount)\n    \n    return {\n      totalEarned: stats.totalCommission,\n      totalPaid,\n      pendingAmount,\n      availableForPayout,\n      minimumPayout: 50,\n      nextPayoutDate: '每月 15 日',\n    }\n  } catch (error) {\n    console.error('計算結算摘要失敗:', error)\n    return {\n      totalEarned: 0,\n      totalPaid: 0,\n      pendingAmount: 0,\n      availableForPayout: 0,\n      minimumPayout: 50,\n    }\n  }\n}\n\n// GET - 獲取結算資料\nexport async function GET() {\n  try {\n    const session = await retrieveAffiliate()\n    if (!session) {\n      return NextResponse.json({ error: '未授權' }, { status: 401 })\n    }\n\n    const payoutData = await ensurePayoutFile()\n    const affiliatePayouts = payoutData.payouts.filter(p => p.affiliateId === session.id)\n    const summary = await calculatePayoutSummary(session.id)\n\n    return NextResponse.json({\n      summary,\n      payouts: affiliatePayouts.sort((a, b) => \n        new Date(b.requestedAt).getTime() - new Date(a.requestedAt).getTime()\n      )\n    })\n\n  } catch (error) {\n    console.error('獲取結算資料失敗:', error)\n    return NextResponse.json({ error: '獲取結算資料失敗' }, { status: 500 })\n  }\n}\n\n// POST - 申請提款\nexport async function POST(request: NextRequest) {\n  try {\n    const session = await retrieveAffiliate()\n    if (!session) {\n      return NextResponse.json({ error: '未授權' }, { status: 401 })\n    }\n\n    const { amount, method } = await request.json()\n\n    if (!amount || amount <= 0) {\n      return NextResponse.json({ error: '無效的提款金額' }, { status: 400 })\n    }\n\n    if (!method || !['bank_transfer', 'paypal', 'stripe'].includes(method)) {\n      return NextResponse.json({ error: '無效的提款方式' }, { status: 400 })\n    }\n\n    // 檢查可用餘額\n    const summary = await calculatePayoutSummary(session.id)\n    \n    if (amount > summary.availableForPayout) {\n      return NextResponse.json({ error: '提款金額超過可用餘額' }, { status: 400 })\n    }\n\n    if (amount < summary.minimumPayout) {\n      return NextResponse.json({ \n        error: `最低提款金額為 $${summary.minimumPayout}` \n      }, { status: 400 })\n    }\n\n    // 創建提款記錄\n    const payoutData = await ensurePayoutFile()\n    const newPayout: PayoutRecord = {\n      id: `payout_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`,\n      affiliateId: session.id,\n      amount,\n      currency: 'USD',\n      status: 'pending',\n      requestedAt: new Date().toISOString(),\n      method,\n    }\n\n    payoutData.payouts.push(newPayout)\n    await savePayoutData(payoutData)\n\n    console.log(`💰 新提款申請: ${session.id} -> $${amount} (${method})`)\n\n    return NextResponse.json({ \n      success: true,\n      payout: newPayout\n    })\n\n  } catch (error) {\n    console.error('提款申請失敗:', error)\n    return NextResponse.json({ error: '提款申請失敗' }, { status: 500 })\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/affiliate/settings/route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":44,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":44,"endColumn":17},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":44,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":44,"endColumn":17},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":87,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":87,"endColumn":18,"suggestions":[{"fix":{"range":[2215,2246],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":124,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":124,"endColumn":16,"suggestions":[{"fix":{"range":[3362,3403],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":131,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":131,"endColumn":18,"suggestions":[{"fix":{"range":[3517,3548],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\nimport { retrieveAffiliate } from '../../../../lib/data/affiliate-auth'\nimport { promises as fs } from 'fs'\nimport path from 'path'\n\ntype AffiliateSettings = {\n  displayName: string\n  website?: string\n  payoutMethod: 'bank_transfer' | 'paypal' | 'stripe'\n  paypalEmail?: string\n  bankAccount?: {\n    bankName: string\n    accountName: string\n    accountNumber: string\n    branch?: string\n  }\n  stripeAccountId?: string\n  notifications: {\n    emailOnNewOrder: boolean\n    emailOnPayment: boolean\n    emailOnCommissionUpdate: boolean\n  }\n  profile: {\n    company?: string\n    phone?: string\n    address?: string\n    taxId?: string\n  }\n}\n\ntype AffiliateSettingsData = {\n  settings: { [affiliateId: string]: AffiliateSettings }\n  lastUpdated: string\n}\n\nconst SETTINGS_FILE = path.join(process.cwd(), 'data', 'affiliate-settings.json')\n\n// 確保數據文件存在\nasync function ensureSettingsFile(): Promise<AffiliateSettingsData> {\n  try {\n    await fs.mkdir(path.dirname(SETTINGS_FILE), { recursive: true })\n    const data = await fs.readFile(SETTINGS_FILE, 'utf-8')\n    return JSON.parse(data)\n  } catch (error) {\n    const initialData: AffiliateSettingsData = {\n      settings: {},\n      lastUpdated: new Date().toISOString()\n    }\n    await saveSettingsData(initialData)\n    return initialData\n  }\n}\n\n// 儲存數據\nasync function saveSettingsData(data: AffiliateSettingsData): Promise<void> {\n  data.lastUpdated = new Date().toISOString()\n  await fs.writeFile(SETTINGS_FILE, JSON.stringify(data, null, 2))\n}\n\n// 獲取預設設定\nfunction getDefaultSettings(): AffiliateSettings {\n  return {\n    displayName: '聯盟會員',\n    payoutMethod: 'bank_transfer',\n    notifications: {\n      emailOnNewOrder: true,\n      emailOnPayment: true,\n      emailOnCommissionUpdate: false\n    },\n    profile: {}\n  }\n}\n\n// GET - 獲取設定\nexport async function GET() {\n  try {\n    const session = await retrieveAffiliate()\n    if (!session) {\n      return NextResponse.json({ error: '未授權' }, { status: 401 })\n    }\n\n    const settingsData = await ensureSettingsFile()\n    const userSettings = settingsData.settings[session.id] || getDefaultSettings()\n\n    return NextResponse.json(userSettings)\n  } catch (error) {\n    console.error('獲取設定失敗:', error)\n    return NextResponse.json({ error: '獲取設定失敗' }, { status: 500 })\n  }\n}\n\n// PUT - 更新設定\nexport async function PUT(request: NextRequest) {\n  try {\n    const session = await retrieveAffiliate()\n    if (!session) {\n      return NextResponse.json({ error: '未授權' }, { status: 401 })\n    }\n\n    const newSettings = await request.json() as AffiliateSettings\n\n    // 基本驗證\n    if (!newSettings.displayName?.trim()) {\n      return NextResponse.json({ error: '顯示名稱不能為空' }, { status: 400 })\n    }\n\n    if (newSettings.payoutMethod === 'bank_transfer') {\n      if (!newSettings.bankAccount?.bankName || \n          !newSettings.bankAccount?.accountName || \n          !newSettings.bankAccount?.accountNumber) {\n        return NextResponse.json({ error: '銀行轉帳需要完整的帳戶資訊' }, { status: 400 })\n      }\n    }\n\n    if (newSettings.payoutMethod === 'paypal' && !newSettings.paypalEmail) {\n      return NextResponse.json({ error: 'PayPal 收款需要提供電子郵件' }, { status: 400 })\n    }\n\n    // 儲存設定\n    const settingsData = await ensureSettingsFile()\n    settingsData.settings[session.id] = newSettings\n    await saveSettingsData(settingsData)\n\n    console.log(`💾 聯盟會員 ${session.id} 更新設定`)\n\n    return NextResponse.json({ \n      success: true,\n      settings: newSettings\n    })\n  } catch (error) {\n    console.error('更新設定失敗:', error)\n    return NextResponse.json({ error: '更新設定失敗' }, { status: 500 })\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/affiliate/settlements/route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":33,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":33,"endColumn":17},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":33,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":33,"endColumn":17},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":99,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":99,"endColumn":18,"suggestions":[{"fix":{"range":[2704,2737],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":129,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":129,"endColumn":18,"suggestions":[{"fix":{"range":[3515,3548],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server'\nimport { retrieveAffiliate } from '../../../../lib/data/affiliate-auth'\nimport { promises as fs } from 'fs'\nimport path from 'path'\n\n// 結算記錄型別\ntype SettlementRecord = {\n  id: string\n  affiliateId: string\n  amount: number\n  currency: string\n  status: 'pending' | 'settled'\n  settlementDate: string\n  period: string // 結算期間，如 \"2025-08\"\n  method: 'bank_transfer' | 'paypal' | 'stripe'\n  reference?: string\n  note?: string\n}\n\ntype SettlementData = {\n  settlements: SettlementRecord[]\n  lastUpdated: string\n}\n\nconst SETTLEMENT_FILE = path.join(process.cwd(), 'data', 'affiliate-settlements.json')\n\n// 確保數據文件存在\nasync function ensureSettlementFile(): Promise<SettlementData> {\n  try {\n    await fs.mkdir(path.dirname(SETTLEMENT_FILE), { recursive: true })\n    const data = await fs.readFile(SETTLEMENT_FILE, 'utf-8')\n    return JSON.parse(data)\n  } catch (error) {\n    const initialData: SettlementData = {\n      settlements: [],\n      lastUpdated: new Date().toISOString()\n    }\n    await saveSettlementData(initialData)\n    return initialData\n  }\n}\n\n// 儲存數據\nasync function saveSettlementData(data: SettlementData): Promise<void> {\n  data.lastUpdated = new Date().toISOString()\n  await fs.writeFile(SETTLEMENT_FILE, JSON.stringify(data, null, 2))\n}\n\n// 計算結算摘要\nasync function calculateSettlementSummary(affiliateId: string): Promise<{\n  totalEarned: number\n  totalSettled: number\n  pendingSettlement: number\n  nextSettlementDate: string\n}> {\n  try {\n    const { getAffiliateStats } = await import('../../../../lib/data/affiliate-stats')\n    const stats = await getAffiliateStats(affiliateId, 365) // 一年內的數據\n    \n    const settlementData = await ensureSettlementFile()\n    const affiliateSettlements = settlementData.settlements.filter(s => s.affiliateId === affiliateId)\n    \n    const totalSettled = affiliateSettlements\n      .filter(s => s.status === 'settled')\n      .reduce((sum, s) => sum + s.amount, 0)\n    \n    const pendingSettlement = Math.max(0, stats.totalCommission - totalSettled)\n    \n    // 計算下次結算日期（每月25號）\n    const now = new Date()\n    const year = now.getFullYear()\n    const month = now.getMonth()\n    const day = now.getDate()\n    \n    let nextMonth = month\n    let nextYear = year\n    \n    if (day >= 25) {\n      nextMonth += 1\n      if (nextMonth > 11) {\n        nextMonth = 0\n        nextYear += 1\n      }\n    }\n    \n    const nextSettlementDate = new Date(nextYear, nextMonth, 25).toLocaleDateString('zh-TW', {\n      year: 'numeric',\n      month: 'long',\n      day: 'numeric'\n    })\n    \n    return {\n      totalEarned: stats.totalCommission,\n      totalSettled,\n      pendingSettlement,\n      nextSettlementDate\n    }\n  } catch (error) {\n    console.error('計算結算摘要失敗:', error)\n    return {\n      totalEarned: 0,\n      totalSettled: 0,\n      pendingSettlement: 0,\n      nextSettlementDate: '計算中...'\n    }\n  }\n}\n\n// GET - 獲取結算資料\nexport async function GET() {\n  try {\n    const session = await retrieveAffiliate()\n    if (!session) {\n      return NextResponse.json({ error: '未授權' }, { status: 401 })\n    }\n\n    const settlementData = await ensureSettlementFile()\n    const affiliateSettlements = settlementData.settlements.filter(s => s.affiliateId === session.id)\n    const summary = await calculateSettlementSummary(session.id)\n\n    return NextResponse.json({\n      summary,\n      settlements: affiliateSettlements.sort((a, b) => \n        new Date(b.settlementDate).getTime() - new Date(a.settlementDate).getTime()\n      )\n    })\n\n  } catch (error) {\n    console.error('獲取結算資料失敗:', error)\n    return NextResponse.json({ error: '獲取結算資料失敗' }, { status: 500 })\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/affiliate/signout/route.ts","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":8,"column":57,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":8,"endColumn":59,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[305,307],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":13,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[425,428],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[425,428],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":20,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":20,"endColumn":18,"suggestions":[{"fix":{"range":[589,637],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { affiliateSignout } from '../../../../lib/data/affiliate-auth'\nimport { NextRequest } from 'next/server'\n\nexport async function POST(request: NextRequest) {\n  try {\n    // 從請求參數獲取國家代碼，預設為 tw\n    const { searchParams } = new URL(request.url)\n    const countryCode = searchParams.get('countryCode') || 'tw'\n    \n    await affiliateSignout(countryCode)\n    \n    return Response.json({ success: true })\n  } catch (error: any) {\n    // 檢查是否是 Next.js redirect 錯誤\n    if (error?.digest?.startsWith?.('NEXT_REDIRECT')) {\n      // 這是正常的重定向，重新拋出讓 Next.js 處理\n      throw error\n    }\n    \n    console.error('Affiliate signout error:', error)\n    return Response.json({ error: '登出失敗' }, { status: 500 })\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/affiliate/stats/route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'cookies' is defined but never used.","line":2,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":17},{"ruleId":"unused-imports/no-unused-imports","severity":2,"message":"'cookies' is defined but never used.","line":2,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":17,"fix":{"range":[43,82],"text":""}},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":16,"column":52,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":16,"endColumn":54,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[558,560],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":34,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":34,"endColumn":18,"suggestions":[{"fix":{"range":[1077,1110],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server'\nimport { cookies } from 'next/headers'\nimport { getAffiliateStats } from '../../../../lib/data/affiliate-stats'\nimport { retrieveAffiliate } from '../../../../lib/data/affiliate-auth'\n\nexport async function GET(request: Request) {\n  try {\n    // 獲取聯盟會員會話\n    const session = await retrieveAffiliate()\n    if (!session) {\n      return NextResponse.json({ error: '未授權' }, { status: 401 })\n    }\n\n    // 從 URL 參數獲取天數\n    const { searchParams } = new URL(request.url)\n    const days = parseInt(searchParams.get('days') || '7', 10)\n\n    // 獲取真實統計資料\n    const stats = await getAffiliateStats(session.id, days)\n    \n    // 確保資料結構完整\n    const safeStats = {\n      period: stats.period || `最近 ${days} 天`,\n      totalClicks: stats.totalClicks || 0,\n      totalConversions: stats.totalConversions || 0,\n      totalRevenue: stats.totalRevenue || 0,\n      totalCommission: stats.totalCommission || 0,\n      trend: stats.trend || [],\n      linkStats: stats.linkStats || {},\n    }\n    \n    return NextResponse.json(safeStats)\n  } catch (error) {\n    console.error('獲取統計資料失敗:', error)\n    \n    // 返回空資料結構而不是錯誤\n    const fallbackStats = {\n      period: '最近 7 天',\n      totalClicks: 0,\n      totalConversions: 0,\n      totalRevenue: 0,\n      totalCommission: 0,\n      trend: [],\n      linkStats: {},\n    }\n    \n    return NextResponse.json(fallbackStats)\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/affiliate/track/route.ts","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":9,"column":48,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":9,"endColumn":50,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[406,408],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":15,"column":57,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":15,"endColumn":59,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[495,569],"text":"(request.headers.get('x-forwarded-for') ?? request.headers.get('x-real-ip'))"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":15,"column":93,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":15,"endColumn":95,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[570,572],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":16,"column":59,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":16,"endColumn":61,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[641,643],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":17,"column":55,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":17,"endColumn":57,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[708,710],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":21,"column":13,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":21,"endColumn":15,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[792,810],"text":"(ref ?? affiliateId)"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":21,"column":28,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":21,"endColumn":30,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[811,813],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":22,"column":16,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":22,"endColumn":18,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[840,842],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":28,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":28,"endColumn":18,"suggestions":[{"fix":{"range":[916,1103],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":30,"column":26,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":30,"endColumn":28,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[988,990],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":62,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":62,"endColumn":20,"suggestions":[{"fix":{"range":[1806,1839],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":9,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\nimport { recordClick } from '../../../../lib/data/affiliate-stats'\n\nexport async function GET(request: NextRequest) {\n  const { searchParams } = new URL(request.url)\n  const ref = searchParams.get('ref')\n  const affiliateId = searchParams.get('affiliate_id')\n  const linkId = searchParams.get('linkId')\n  const targetUrl = searchParams.get('target') || '/'\n\n  // 記錄點擊\n  if (ref || affiliateId) {\n    try {\n      // 獲取請求資訊\n      const ip = request.headers.get('x-forwarded-for') || request.headers.get('x-real-ip') || 'unknown'\n      const userAgent = request.headers.get('user-agent') || 'unknown'\n      const referrer = request.headers.get('referer') || undefined\n\n      // 記錄到 JSON 檔案\n      const clickId = await recordClick(\n        ref || affiliateId || 'unknown',\n        linkId || 'direct',\n        ip,\n        userAgent,\n        referrer\n      )\n\n      console.log('✅ 聯盟連結點擊已記錄:', {\n        clickId,\n        affiliateId: ref || affiliateId,\n        linkId,\n        timestamp: new Date().toISOString(),\n        ip,\n        targetUrl\n      })\n\n      // 設置響應 headers 來追蹤轉換\n      const response = NextResponse.redirect(new URL(targetUrl, request.url))\n      \n      // 設置 cookie 來追蹤這個用戶的聯盟來源\n      if (ref) {\n        response.cookies.set('affiliate_ref', ref, {\n          maxAge: 30 * 24 * 60 * 60, // 30 天\n          httpOnly: true,\n          secure: process.env.NODE_ENV === 'production',\n          sameSite: 'lax'\n        })\n      }\n\n      if (affiliateId) {\n        response.cookies.set('affiliate_id', affiliateId, {\n          maxAge: 30 * 24 * 60 * 60, // 30 天  \n          httpOnly: true,\n          secure: process.env.NODE_ENV === 'production',\n          sameSite: 'lax'\n        })\n      }\n\n      return response\n\n    } catch (error) {\n      console.error('追蹤聯盟點擊失敗:', error)\n    }\n  }\n\n  // 如果沒有聯盟參數，直接重定向到目標頁面\n  return NextResponse.redirect(new URL(targetUrl, request.url))\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/auth/check-email/route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":33,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[850,853],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[850,853],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":57,"column":64,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":57,"endColumn":66,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1370,1372],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":65,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":65,"endColumn":18,"suggestions":[{"fix":{"range":[1579,1615],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\"\nimport Medusa from \"@medusajs/js-sdk\"\nimport { getApiConfig } from \"@lib/config\"\n\nexport async function POST(request: NextRequest) {\n  try {\n    const { email } = await request.json()\n\n    if (!email || typeof email !== \"string\") {\n      return NextResponse.json(\n        {\n          exists: false,\n          authProvider: null,\n          message: \"請提供有效的電子郵件\",\n        },\n        { status: 400 }\n      )\n    }\n\n    const adminToken = process.env.MEDUSA_ADMIN_TOKEN\n\n    if (!adminToken) {\n      return NextResponse.json({\n        exists: false,\n        authProvider: null,\n        message: \"無法檢查電子郵件，缺少管理員權杖\",\n      })\n    }\n\n    const medusa = new Medusa(getApiConfig())\n\n    const { customers } = await medusa.client.fetch<{\n      customers: Array<{ email: string; metadata?: Record<string, any> }>\n    }>(\"/admin/customers\", {\n      query: {\n        q: email,\n        limit: 1,\n      },\n      headers: {\n        \"x-medusa-access-token\": adminToken,\n      },\n    })\n\n    const customer = customers?.find(\n      (c) => c.email?.toLowerCase() === email.toLowerCase()\n    )\n\n    if (!customer) {\n      return NextResponse.json({\n        exists: false,\n        authProvider: null,\n        message: \"此電子郵件尚未註冊\",\n      })\n    }\n\n    const authProvider =\n      (customer.metadata?.auth_provider as string | undefined) || \"password\"\n\n    return NextResponse.json({\n      exists: true,\n      authProvider,\n      message: authProvider === \"password\" ? \"此電子郵件可使用密碼登入\" : `此電子郵件綁定 ${authProvider} 登入`,\n    })\n  } catch (error) {\n    console.error(\"檢查電子郵件時發生錯誤:\", error)\n    return NextResponse.json({\n      exists: false,\n      authProvider: null,\n      message: \"暫時無法檢查電子郵件\",\n    })\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/auth/check/route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'request' is defined but never used.","line":4,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":34},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'request' is defined but never used. Allowed unused args must match /^_/u.","line":4,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":34},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":18,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":18,"endColumn":18,"suggestions":[{"fix":{"range":[461,502],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\"\nimport { cookies } from \"next/headers\"\n\nexport async function GET(request: NextRequest) {\n  try {\n    const cookieStore = await cookies()\n    const token = cookieStore.get(\"_medusa_jwt\")?.value\n    \n    if (!token) {\n      return NextResponse.json({ authenticated: false }, { status: 200 })\n    }\n\n    return NextResponse.json({ \n      authenticated: true\n    }, { status: 200 })\n\n  } catch (error) {\n    console.error(\"Auth check error:\", error)\n    return NextResponse.json({ authenticated: false }, { status: 200 })\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/auth/customer/route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_request' is defined but never used.","line":4,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":35},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":14,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":14,"endColumn":18,"suggestions":[{"fix":{"range":[380,413],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\"\nimport { retrieveCustomer } from \"@lib/data/customer\"\n\nexport async function GET(_request: NextRequest) {\n  try {\n    const customer = await retrieveCustomer()\n\n    if (!customer) {\n      return NextResponse.json({ customer: null }, { status: 401 })\n    }\n\n    return NextResponse.json({ customer })\n  } catch (error) {\n    console.error(\"取得客戶資料失敗:\", error)\n    return NextResponse.json({ customer: null }, { status: 500 })\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/auth/google/profile/route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'request' is defined but never used.","line":8,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":34},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'request' is defined but never used. Allowed unused args must match /^_/u.","line":8,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":34},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":13,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[360,363],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[360,363],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":21,"column":67,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":21,"endColumn":69,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[593,595],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":25,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[750,753],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[750,753],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":30,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":30,"endColumn":20,"suggestions":[{"fix":{"range":[830,919],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":41,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":41,"endColumn":18,"suggestions":[{"fix":{"range":[1270,1304],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":47,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1520,1523],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1520,1523],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":60,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":60,"endColumn":22,"suggestions":[{"fix":{"range":[1906,1948],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":71,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":71,"endColumn":18,"suggestions":[{"fix":{"range":[2138,2183],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// 向 Medusa 後端請求獲取 Google 用戶資料的 API Endpoint\n// 建議將此檔案保存到前端專案中的相應位置\n\nimport { NextRequest, NextResponse } from 'next/server'\nimport { getAuthHeaders } from '@/lib/data/cookies'\n\n// 這個端點用於向 Medusa 後端查詢用戶的 Google 身份資料\nexport async function GET(request: NextRequest) {\n  try {\n    // 檢查是否有認證標頭\n    const headers = await getAuthHeaders()\n    \n    if (!(headers as any)?.authorization) {\n      return NextResponse.json(\n        { error: 'Authorization header required' }, \n        { status: 401 }\n      )\n    }\n    \n    // 設置後端 URL\n    const backendUrl = process.env.NEXT_PUBLIC_MEDUSA_BACKEND_URL || 'http://localhost:9000'\n    \n    // 首先嘗試獲取當前客戶資料\n    const customerResponse = await fetch(`${backendUrl}/store/customers/me`, {\n      headers: headers as any,\n      cache: 'no-cache',\n    })\n    \n    if (!customerResponse.ok) {\n      console.error('從 Medusa 獲取客戶資料失敗:', customerResponse.status, customerResponse.statusText)\n      return NextResponse.json(\n        { error: `Failed to fetch customer data: ${customerResponse.statusText}` }, \n        { status: customerResponse.status }\n      )\n    }\n    \n    const customerData = await customerResponse.json()\n    \n    // 如果客戶郵件是預設值，嘗試獲取 Google 提供者身份資訊\n    if (customerData.customer.email === 'example@medusajs.com') {\n      console.log('檢測到預設郵件，嘗試查詢提供者身份資訊')\n      \n      // 向後端發送請求以獲取關聯的 OAuth 提供者身份資訊\n      // 這需要後端提供相應的 API，這只是一個示例\n      try {\n        const providerResponse = await fetch(`${backendUrl}/store/customers/me/auth-provider`, {\n          headers: headers as any,\n          cache: 'no-cache',\n        })\n        \n        if (providerResponse.ok) {\n          const providerData = await providerResponse.json()\n          return NextResponse.json({\n            customer: customerData.customer,\n            providerInfo: providerData,\n            message: 'Retrieved provider identity'\n          })\n        }\n      } catch (providerError) {\n        console.error('獲取提供者資訊失敗:', providerError)\n        // 繼續使用可用的客戶資料\n      }\n    }\n    \n    return NextResponse.json({\n      customer: customerData.customer,\n      message: 'Customer data retrieved'\n    })\n    \n  } catch (error) {\n    console.error('處理獲取 Google 用戶資料請求失敗:', error)\n    return NextResponse.json(\n      { error: 'Failed to process request' }, \n      { status: 500 }\n    )\n  }\n}","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/auth/login/route.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":43,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":43,"endColumn":19,"suggestions":[{"fix":{"range":[1084,1122],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":52,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":52,"endColumn":19,"suggestions":[{"fix":{"range":[1293,1327],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":56,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1401,1404],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1401,1404],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":57,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":57,"endColumn":18,"suggestions":[{"fix":{"range":[1412,1448],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\"\nimport Medusa from \"@medusajs/js-sdk\"\nimport { getApiConfig } from \"@lib/config\"\nimport { getCacheTag, getCartId, setAuthToken } from \"@lib/data/cookies\"\nimport { revalidateTag } from \"next/cache\"\n\nexport async function POST(request: NextRequest) {\n  try {\n    const { email, password } = await request.json()\n\n    if (!email || !password) {\n      return NextResponse.json(\n        {\n          success: false,\n          error: \"請輸入電子郵件和密碼\",\n        },\n        { status: 400 }\n      )\n    }\n\n    const medusa = new Medusa(getApiConfig())\n    const result = await medusa.auth.login(\"customer\", \"emailpass\", { email, password })\n\n    if (typeof result !== \"string\") {\n      return NextResponse.json(\n        {\n          success: false,\n          error: \"登入流程需要額外驗證，請使用預設登入表單。\",\n        },\n        { status: 400 }\n      )\n    }\n\n    await setAuthToken(result)\n\n    try {\n      const cartId = await getCartId()\n\n      if (cartId) {\n        await medusa.store.cart.transferCart(cartId, {}, {})\n      }\n    } catch (cartError) {\n      console.warn(\"登入後轉移購物車失敗:\", cartError)\n    }\n\n    try {\n      const customerTag = await getCacheTag(\"customers\")\n      if (customerTag) {\n        revalidateTag(customerTag)\n      }\n    } catch (error) {\n      console.warn(\"重新驗證客戶快取失敗:\", error)\n    }\n\n    return NextResponse.json({ success: true })\n  } catch (error: any) {\n    console.error(\"登入 API 發生錯誤:\", error)\n\n    const message =\n      error?.message?.includes(\"unauthorized\") || error?.message?.includes(\"401\")\n        ? \"電子郵件或密碼錯誤，請重新輸入\"\n        : \"登入失敗，請稍後再試\"\n\n    return NextResponse.json(\n      {\n        success: false,\n        error: message,\n      },\n      { status: 500 }\n    )\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/auth/logout/route.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":23,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":23,"endColumn":19,"suggestions":[{"fix":{"range":[707,755],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":111,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":111,"endColumn":17,"suggestions":[{"fix":{"range":[2741,2797],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":129,"column":70,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":129,"endColumn":72,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3188,3190],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\"\nimport Medusa from \"@medusajs/js-sdk\"\nimport { getApiConfig } from \"@lib/config\"\nimport { getCacheTag, removeAuthToken, removeCartId } from \"@lib/data/cookies\"\nimport { cookies as nextCookies } from \"next/headers\"\nimport { revalidateTag } from \"next/cache\"\n\nconst performLogout = async () => {\n  const config = getApiConfig()\n  const medusa = new Medusa({\n    baseUrl: config.baseUrl,\n    publishableKey: config.publishableKey,\n  })\n\n  const cookieStore = await nextCookies()\n  const token = cookieStore.get(\"_medusa_jwt\")?.value\n\n  if (token) {\n    medusa.client.setToken(token)\n    try {\n      await medusa.auth.logout()\n    } catch (error) {\n      console.warn(\"Medusa SDK logout failed:\", error)\n    }\n  }\n\n  await removeAuthToken()\n  await removeCartId()\n\n  // 清除額外的認證相關 cookies，包括 Google OAuth 相關\n  const additionalCookiesToClear = [\n    \"_medusa_customer_id\",\n    \"medusa-auth-token\", \n    \"next-auth.session-token\",\n    \"next-auth.callback-url\",\n    \"next-auth.csrf-token\",\n    \"auth-token\",\n    \"auth_session\",\n    \"__Secure-next-auth.session-token\",\n    \"__Host-next-auth.csrf-token\",\n    \"connect.sid\",\n    \"session\",\n    // Google OAuth 相關 cookies\n    \"g_state\",\n    \"g_csrf_token\",\n    \"google_oauth_state\",\n    \"oauth_state\",\n    \"gsi_callback_data\",\n    \"__gads\",\n    \"__gpi\",\n    \"_gcl_au\",\n    // Google Identity Services cookies\n    \"g_enabled_idps\",\n    \"g_session_check\",\n    \"g_accounts_check\", \n    \"google_auto_select\",\n    \"1P_JAR\",\n    \"APISID\",\n    \"SAPISID\",\n    \"HSID\",\n    \"SSID\",\n    \"SID\",\n    // Google 帳戶選擇相關\n    \"ACCOUNT_CHOOSER\",\n    \"LSOLH\",\n    \"LSID\",\n    // 調試用 cookies\n    \"_debug_jwt_preview\",\n    \"_debug_jwt_full\"\n  ]\n\n  for (const cookieName of additionalCookiesToClear) {\n    // 清除多個路徑和域名的 cookies\n    const paths = [\"/\", \"/tw\", \"/tw/\", \"/auth\", \"/auth/google\"]\n    const domains = [\"\", \"localhost\", \".localhost\", \".google.com\", \".accounts.google.com\"]\n    \n    paths.forEach(path => {\n      domains.forEach(domain => {\n        cookieStore.set(cookieName, \"\", {\n          maxAge: -1,\n          httpOnly: false,\n          sameSite: \"lax\",\n          secure: process.env.NODE_ENV === \"production\",\n          path: path,\n          ...(domain && { domain: domain })\n        })\n      })\n    })\n    \n    // 基本清除\n    cookieStore.set(cookieName, \"\", {\n      maxAge: -1,\n      httpOnly: false,\n      sameSite: \"lax\",\n      secure: process.env.NODE_ENV === \"production\",\n      path: \"/\",\n    })\n  }\n\n  try {\n    const customerTag = await getCacheTag(\"customers\")\n    if (customerTag) {\n      revalidateTag(customerTag)\n    }\n\n    const cartTag = await getCacheTag(\"carts\")\n    if (cartTag) {\n      revalidateTag(cartTag)\n    }\n  } catch (error) {\n    console.warn(\"Failed to revalidate auth caches:\", error)\n  }\n}\n\nexport async function POST(request: NextRequest) {\n  await performLogout()\n\n  const redirectParam = request.nextUrl.searchParams.get(\"redirect\")\n\n  return NextResponse.json({\n    success: true,\n    redirect: redirectParam ?? null,\n  })\n}\n\nexport async function GET(request: NextRequest) {\n  await performLogout()\n\n  const redirectParam = request.nextUrl.searchParams.get(\"redirect\") || \"/\"\n  const redirectUrl = new URL(redirectParam, request.nextUrl.origin)\n  \n  // 添加一個查詢參數來強制頁面重新載入，清除任何殘留的 Google OAuth 狀態\n  redirectUrl.searchParams.set('_logout', Date.now().toString())\n  redirectUrl.searchParams.set('_clear_oauth', '1')\n\n  const response = NextResponse.redirect(redirectUrl.toString(), {\n    status: 302,\n  })\n  \n  // 額外設置響應標頭來清除緩存\n  response.headers.set('Cache-Control', 'no-cache, no-store, must-revalidate')\n  response.headers.set('Pragma', 'no-cache')\n  response.headers.set('Expires', '0')\n  \n  return response\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/auth/set-token/route.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":8,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":8,"endColumn":16,"suggestions":[{"fix":{"range":[213,427],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":11,"column":34,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":11,"endColumn":36,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[349,351],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":16,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":16,"endColumn":20,"suggestions":[{"fix":{"range":[482,531],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":25,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":25,"endColumn":16,"suggestions":[{"fix":{"range":[691,737],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":32,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":32,"endColumn":18,"suggestions":[{"fix":{"range":[877,928],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\"\nimport { setAuthToken } from \"@lib/data/cookies\"\n\nexport async function POST(request: NextRequest) {\n  try {\n    const { token } = await request.json()\n\n    console.log(\"🔐 API Route: 收到 set-token 請求\", {\n      hasToken: !!token,\n      tokenType: typeof token,\n      tokenLength: token?.length || 0,\n      tokenPreview: token ? token.substring(0, 50) + \"...\" : null\n    })\n\n    if (!token || typeof token !== \"string\") {\n      console.error(\"❌ API Route: Token 無效\", { token })\n      return NextResponse.json(\n        { success: false, message: \"缺少 token\" },\n        { status: 400 }\n      )\n    }\n\n    await setAuthToken(token)\n    \n    console.log(\"✅ API Route: Token 已存儲到 cookies\")\n\n    return NextResponse.json({ \n      success: true,\n      message: \"Token successfully stored in cookies\"\n    })\n  } catch (error) {\n    console.error(\"❌ API Route: 設定認證 token 失敗:\", error)\n    return NextResponse.json(\n      { success: false, message: \"設定認證 cookie 失敗\" },\n      { status: 500 }\n    )\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/blogs/search/route.ts","messages":[{"ruleId":"sonarjs/cognitive-complexity","severity":2,"message":"Refactor this function to reduce its Cognitive Complexity from 20 to the 15 allowed.","line":39,"column":23,"nodeType":null,"messageId":"refactorFunction","endLine":39,"endColumn":26},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":71,"column":49,"nodeType":"MemberExpression","messageId":"unexpected","endLine":71,"endColumn":60},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":75,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":75,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2059,2062],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2059,2062],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":76,"column":35,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":76,"endColumn":37,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2103,2105],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":77,"column":41,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":77,"endColumn":43,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2165,2167],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":78,"column":45,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":78,"endColumn":47,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2231,2233],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":82,"column":43,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":82,"endColumn":45,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2358,2433],"text":"(title.includes(lowerQuery) ?? \n               bodyText.includes(lowerQuery))"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":83,"column":46,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":83,"endColumn":48,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2434,2436],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":87,"column":51,"nodeType":"MemberExpression","messageId":"unexpected","endLine":87,"endColumn":62},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":93,"column":51,"nodeType":"MemberExpression","messageId":"unexpected","endLine":93,"endColumn":62},{"ruleId":"prefer-const","severity":2,"message":"'searchConditions' is never reassigned. Use 'const' instead.","line":99,"column":11,"nodeType":"Identifier","messageId":"useConst","endLine":99,"endColumn":27,"fix":{"range":[2921,3102],"text":"const searchConditions = characters\n        .filter(char => isChinese(char))\n        .map(char => `title match \"*${char}*\" || pt::text(body) match \"*${char}*\"`)\n        .join(' || ');"}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":120,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":120,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3675,3678],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3675,3678],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":121,"column":37,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":121,"endColumn":39,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3721,3723],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":122,"column":43,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":122,"endColumn":45,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3785,3787],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":123,"column":47,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":123,"endColumn":49,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3853,3855],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":127,"column":48,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":127,"endColumn":50,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3978,4066],"text":"(title.includes(char.toLowerCase()) ?? \n            bodyText.includes(char.toLowerCase()))"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":128,"column":51,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":128,"endColumn":53,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[4067,4069],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":134,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":134,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4218,4221],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4218,4221],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":134,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":134,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4226,4229],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4226,4229],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":135,"column":97,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":135,"endColumn":99,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[4332,4334],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":136,"column":97,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":136,"endColumn":99,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[4449,4451],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":141,"column":53,"nodeType":"MemberExpression","messageId":"unexpected","endLine":141,"endColumn":64},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":146,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":146,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4762,4765],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4762,4765],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":149,"column":38,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":149,"endColumn":40,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[4871,4873],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":150,"column":36,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":150,"endColumn":38,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[4913,4915],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":192,"column":37,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":192,"endColumn":39,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[6300,6302],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":198,"column":51,"nodeType":"MemberExpression","messageId":"unexpected","endLine":198,"endColumn":62},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":205,"column":49,"nodeType":"MemberExpression","messageId":"unexpected","endLine":205,"endColumn":62},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":235,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":235,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7469,7472],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7469,7472],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":241,"column":29,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":241,"endColumn":31,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[7638,7640],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":243,"column":35,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":243,"endColumn":37,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[7781,7783],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":246,"column":49,"nodeType":"MemberExpression","messageId":"unexpected","endLine":246,"endColumn":62}],"suppressedMessages":[],"errorCount":19,"fatalErrorCount":0,"warningCount":13,"fixableErrorCount":1,"fixableWarningCount":0,"source":"// filepath: /Users/raychou/medusa_0525/frontend/src/app/api/blogs/search/route.ts\nimport { NextRequest, NextResponse } from 'next/server'\nimport { getClient } from '@lib/sanity-utils/utils'\n\nexport const maxDuration = 10 // 設置函數的最大執行時間為10秒\n\n// 檢查字符串是否包含中文字符\nfunction isChinese(str: string): boolean {\n  return /[\\u4e00-\\u9fa5]/.test(str);\n}\n\n// 計算字符串相關性（用於排序結果）\nfunction calculateRelevance(text: string, query: string): number {\n  if (!text || !query) return 0;\n  \n  const lowerText = text.toLowerCase();\n  const lowerQuery = query.toLowerCase();\n  \n  // 完全匹配得分最高\n  if (lowerText === lowerQuery) return 100;\n  \n  // 包含整個查詢得分次之\n  if (lowerText.includes(lowerQuery)) return 80;\n  \n  // 計算有多少查詢字符出現在文本中\n  const queryChars = Array.from(lowerQuery);\n  let matchCount = 0;\n  \n  for (const char of queryChars) {\n    if (lowerText.includes(char)) {\n      matchCount++;\n    }\n  }\n  \n  // 返回匹配百分比\n  return (matchCount / queryChars.length) * 60;\n}\n\nexport async function GET(request: NextRequest) {\n  const { searchParams } = new URL(request.url)\n  const query = searchParams.get('q')\n  \n  if (!query || query.length < 1) {\n    // 如果沒有搜尋詞，返回最新文章\n    const recentPosts = await fetchRecentPosts()\n    return NextResponse.json({ posts: recentPosts })\n  }\n\n  try {\n    const client = getClient()\n    \n    // 首先使用原始搜尋詞進行查詢\n    // 使用 Sanity 的 GROQ 查詢語言搜尋文章\n    let posts = await client.fetch(`\n      *[_type == \"post\" && (\n        title match \"*${query}*\" || \n        pt::text(body) match \"*${query}*\" ||\n        count(categories[]->title[@ match \"*${query}*\"]) > 0\n      )] | order(publishedAt desc) [0...10] {\n        _id,\n        title,\n        \"slug\": slug.current,\n        \"image\": mainImage.asset->url,\n        publishedAt,\n        \"excerpt\": pt::text(excerpt),\n        \"bodyText\": pt::text(body),\n        \"categories\": categories[]->title\n      }\n    `)\n\n    if (process.env.NODE_ENV === 'development') console.log(`找到 ${posts.length} 篇文章匹配查詢: \"${query}\"`);\n    \n    // 對搜尋結果進行二次過濾，確保真正匹配關鍵字\n    if (posts.length > 0) {\n      const filteredPosts = posts.filter((post: any) => {\n        const title = (post.title || '').toLowerCase();\n        const bodyText = (post.bodyText || '').toLowerCase();\n        const categories = (post.categories || []).join(' ').toLowerCase();\n        const lowerQuery = query.toLowerCase();\n        \n        // 檢查是否真的包含關鍵字\n        return title.includes(lowerQuery) || \n               bodyText.includes(lowerQuery) || \n               categories.includes(lowerQuery);\n      });\n      \n      if (process.env.NODE_ENV === 'development') console.log(`二次過濾後剩餘 ${filteredPosts.length} 篇文章`);\n      posts = filteredPosts;\n    }\n    \n    // 如果沒有找到結果，而且是中文搜尋詞，嘗試按字符拆分搜尋\n    if (posts.length === 0 && isChinese(query)) {\n      if (process.env.NODE_ENV === 'development') console.log('沒有找到匹配的中文文章，嘗試拆分搜尋');\n      \n      // 將中文查詢拆分為單個字符\n      const characters = Array.from(query);\n      \n      // 構建更寬鬆的搜尋條件\n      let searchConditions = characters\n        .filter(char => isChinese(char))\n        .map(char => `title match \"*${char}*\" || pt::text(body) match \"*${char}*\"`)\n        .join(' || ');\n      \n      if (searchConditions) {\n        // 使用拆分的字符進行搜尋\n        let splitResults = await client.fetch(`\n          *[_type == \"post\" && (${searchConditions})] | order(publishedAt desc) [0...10] {\n            _id,\n            title,\n            \"slug\": slug.current,\n            \"image\": mainImage.asset->url,\n            publishedAt,\n            \"excerpt\": pt::text(excerpt),\n            \"bodyText\": pt::text(body),\n            \"categories\": categories[]->title\n          }\n        `);\n        \n        // 對拆分搜尋結果也進行過濾\n        splitResults = splitResults.filter((post: any) => {\n          const title = (post.title || '').toLowerCase();\n          const bodyText = (post.bodyText || '').toLowerCase();\n          const categories = (post.categories || []).join(' ').toLowerCase();\n          \n          // 檢查是否包含查詢中的任一字符\n          return characters.some(char => \n            title.includes(char.toLowerCase()) || \n            bodyText.includes(char.toLowerCase()) ||\n            categories.includes(char.toLowerCase())\n          );\n        });\n        \n        // 根據標題與原始查詢的相關性對結果進行排序\n        splitResults.sort((a: any, b: any) => {\n          const aRelevance = calculateRelevance(a.title, query) + calculateRelevance(a.bodyText || '', query) * 0.5;\n          const bRelevance = calculateRelevance(b.title, query) + calculateRelevance(b.bodyText || '', query) * 0.5;\n          return bRelevance - aRelevance;\n        });\n        \n        posts = splitResults;\n        if (process.env.NODE_ENV === 'development') console.log(`拆分搜尋找到 ${posts.length} 篇文章`);\n      }\n    }\n\n    // 將 Sanity _id 映射到 id 屬性，確保與前端元件期望的格式一致\n    const formattedPosts = posts.map((post: any) => {\n      // 從內文中提取匹配關鍵字的片段作為搜尋結果摘要\n      let searchSnippet = '';\n      const bodyText = post.bodyText || '';\n      const excerpt = post.excerpt || '';\n      \n      // 優先使用摘要\n      if (excerpt) {\n        searchSnippet = excerpt;\n      } \n      // 如果沒有摘要但有內文，從內文提取片段\n      else if (bodyText) {\n        // 嘗試找出包含關鍵字的片段\n        const lowerBodyText = bodyText.toLowerCase();\n        const lowerQuery = query.toLowerCase();\n        const keywordIndex = lowerBodyText.indexOf(lowerQuery);\n        \n        if (keywordIndex >= 0) {\n          // 提取關鍵字前後的文字（前50個字符，後100個字符）\n          const startIndex = Math.max(0, keywordIndex - 50);\n          const endIndex = Math.min(bodyText.length, keywordIndex + lowerQuery.length + 100);\n          searchSnippet = bodyText.slice(startIndex, endIndex);\n          \n          // 如果不是從頭開始，則加上省略號\n          if (startIndex > 0) {\n            searchSnippet = '...' + searchSnippet;\n          }\n          \n          // 如果不是到結尾結束，則加上省略號\n          if (endIndex < bodyText.length) {\n            searchSnippet = searchSnippet + '...';\n          }\n        } else {\n          // 如果在內文中找不到精確匹配，則使用前150個字符\n          searchSnippet = bodyText.slice(0, 150) + (bodyText.length > 150 ? '...' : '');\n        }\n      }\n      \n      return {\n        id: post._id,\n        title: post.title,\n        slug: post.slug,\n        image: post.image,\n        publishedAt: post.publishedAt,\n        excerpt: searchSnippet,  // 提供優化後的摘要\n        bodyText: post.bodyText,  // 加入 bodyText 以便前端可以靈活使用\n        categories: post.categories || []  // 提供分類標籤\n      };\n    })\n\n    // 如果沒有找到匹配的文章，則獲取最新文章\n    if (formattedPosts.length === 0) {\n      if (process.env.NODE_ENV === 'development') console.log('沒有找到匹配的文章，獲取最新文章')\n      const recentPosts = await fetchRecentPosts()\n      return NextResponse.json({ posts: recentPosts })\n    }\n\n    return NextResponse.json({ posts: formattedPosts })\n  } catch (error) {\n    if (process.env.NODE_ENV === 'development') console.error('搜尋部落格文章時出錯:', error)\n    // 發生錯誤時，返回最新文章\n    const recentPosts = await fetchRecentPosts()\n    return NextResponse.json({\n      message: '搜尋部落格文章時出錯，顯示最新文章',\n      posts: recentPosts\n    })\n  }\n}\n\n// 獲取最新文章（當沒有匹配關鍵字時使用）\nasync function fetchRecentPosts() {\n  try {\n    const client = getClient()\n    \n    // 查詢最新發布的2篇文章（當無匹配關鍵字時顯示）\n    const recentPosts = await client.fetch(`\n      *[_type == \"post\"] | order(publishedAt desc) [0...2] {\n        _id,\n        title,\n        \"slug\": slug.current,\n        \"image\": mainImage.asset->url,\n        publishedAt,\n        \"excerpt\": pt::text(excerpt),\n        \"bodyText\": pt::text(body),\n        \"categories\": categories[]->title\n      }\n    `)\n\n    // 格式化文章數據\n    return recentPosts.map((post: any) => ({\n      id: post._id,\n      title: post.title,\n      slug: post.slug,\n      image: post.image,\n      publishedAt: post.publishedAt,\n      excerpt: post.excerpt || (post.bodyText ? post.bodyText.substring(0, 150) + '...' : '這篇文章沒有摘要...'),\n      bodyText: post.bodyText,\n      categories: post.categories || []\n    }))\n  } catch (error) {\n    if (process.env.NODE_ENV === 'development') console.error('獲取最新文章時出錯:', error)\n    return [] // 發生錯誤時返回空數組\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/cart/add/route.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":9,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":9,"endColumn":16,"suggestions":[{"fix":{"range":[281,360],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":24,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":24,"endColumn":16,"suggestions":[{"fix":{"range":[649,696],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":32,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":32,"endColumn":16,"suggestions":[{"fix":{"range":[784,810],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":50,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":50,"endColumn":16,"suggestions":[{"fix":{"range":[1173,1231],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":54,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":54,"endColumn":18,"suggestions":[{"fix":{"range":[1277,1325],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { addToCart, getOrSetCart } from \"@lib/data/cart\"\nimport { NextRequest, NextResponse } from \"next/server\"\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json()\n    const { variantId, quantity = 1, countryCode = \"tw\" } = body\n\n    console.log(\"🛒 Add to Cart API called:\", { variantId, quantity, countryCode })\n\n    if (!variantId) {\n      return NextResponse.json(\n        { error: \"Missing variant ID\" },\n        { status: 400 }\n      )\n    }\n\n    // 先獲取或建立購物車\n    const cart = await getOrSetCart(countryCode)\n    if (!cart) {\n      throw new Error(\"Failed to create or retrieve cart\")\n    }\n\n    console.log(\"📦 Cart 資訊:\", { cartId: cart.id })\n\n    await addToCart({\n      variantId,\n      quantity,\n      countryCode,\n    })\n\n    console.log(\"✅ 商品成功加入購物車\")\n\n    // 建立 response 並設定 cookie\n    const response = NextResponse.json({ \n      success: true,\n      message: \"商品已加入購物車\",\n      cartId: cart.id\n    })\n\n    // 在 response 中設定 cookie\n    response.cookies.set(\"_medusa_cart_id\", cart.id, {\n      maxAge: 60 * 60 * 24 * 7,\n      httpOnly: false,\n      sameSite: \"lax\",\n      secure: false,\n      path: \"/\"\n    })\n\n    console.log(\"🍪 API Response 設定 Cart ID cookie:\", cart.id)\n\n    return response\n  } catch (error) {\n    console.error(\"❌ Add to cart API error:\", error)\n    return NextResponse.json(\n      { \n        error: \"Failed to add to cart\",\n        details: error instanceof Error ? error.message : String(error)\n      },\n      { status: 500 }\n    )\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/cart/get/route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'request' is defined but never used.","line":3,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":34},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'request' is defined but never used. Allowed unused args must match /^_/u.","line":3,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":34},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":4,"column":47,"nodeType":"MemberExpression","messageId":"unexpected","endLine":4,"endColumn":58},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":14,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":14,"endColumn":20,"suggestions":[{"fix":{"range":[423,480],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":16,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":16,"endColumn":20,"suggestions":[{"fix":{"range":[504,566],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":23,"column":49,"nodeType":"MemberExpression","messageId":"unexpected","endLine":23,"endColumn":62}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\n\nexport async function GET(request: NextRequest) {\n  if (process.env.NODE_ENV === 'development') console.log('🛒 Get Cart API called')\n  \n  try {\n    // 使用與 retrieveCart 相同的邏輯，確保認證一致\n    const { retrieveCart } = await import('@lib/data/cart')\n    \n    const cart = await retrieveCart()\n    \n    if (process.env.NODE_ENV === 'development') {\n      if (cart) {\n        console.log('✅ Cart data retrieved successfully via SDK')\n      } else {\n        console.log('ℹ️ No cart found (this is normal for new users)')\n      }\n    }\n    \n    return NextResponse.json({ cart })\n    \n  } catch (error) {\n    if (process.env.NODE_ENV === 'development') console.error('❌ Get Cart API error:', error)\n    return NextResponse.json({ cart: null })\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/cart/id/route.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":11,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":11,"endColumn":16,"suggestions":[{"fix":{"range":[278,344],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":11,"column":47,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":11,"endColumn":49,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[320,322],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":14,"column":22,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":14,"endColumn":24,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[403,405],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":17,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":17,"endColumn":18,"suggestions":[{"fix":{"range":[442,486],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\"\n\nexport async function GET(request: NextRequest) {\n  try {\n    // 嘗試從前端 localStorage 或 cookie 獲取 cart ID\n    let cartId = null\n    \n    // 從 cookie 中嘗試獲取\n    cartId = request.cookies.get(\"_medusa_cart_id\")?.value\n    \n    console.log(\"🛒 Get Cart ID API:\", cartId || \"❌ No cart ID found\")\n    \n    return NextResponse.json({ \n      cartId: cartId || null\n    })\n  } catch (error) {\n    console.error(\"❌ Get cart ID error:\", error)\n    return NextResponse.json(\n      { error: \"Failed to get cart ID\" },\n      { status: 500 }\n    )\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/cart/route.ts","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":8,"column":61,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":8,"endColumn":63,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[300,302],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":12,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":17},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":12,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":17},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":29,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":29,"endColumn":16,"suggestions":[{"fix":{"range":[795,869],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":41,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":41,"endColumn":16,"suggestions":[{"fix":{"range":[1061,1095],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":48,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":48,"endColumn":18,"suggestions":[{"fix":{"range":[1256,1300],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\"\nimport { getOrSetCart, addToCart } from \"@lib/data/cart\"\n\nexport async function GET(request: NextRequest) {\n  try {\n    // 從查詢參數或預設值獲取 countryCode\n    const url = new URL(request.url)\n    const countryCode = url.searchParams.get('countryCode') || 'tw'\n    \n    const cart = await getOrSetCart(countryCode)\n    return NextResponse.json({ cart })\n  } catch (error) {\n    return NextResponse.json({ cart: null }, { status: 200 })\n  }\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json()\n    const { variantId, quantity = 1, countryCode = 'tw' } = body\n\n    if (!variantId) {\n      return NextResponse.json(\n        { error: \"Variant ID is required\" },\n        { status: 400 }\n      )\n    }\n\n    console.log(\"🛒 API Route 處理加入購物車:\", { variantId, quantity, countryCode })\n\n    // 使用現有的 addToCart 函數\n    await addToCart({\n      variantId,\n      quantity,\n      countryCode,\n    })\n\n    // 重新獲取購物車資料\n    const updatedCart = await getOrSetCart(countryCode)\n    \n    console.log(\"✅ API Route 加入購物車成功\")\n    return NextResponse.json({ \n      success: true, \n      cart: updatedCart,\n      message: \"Item added to cart successfully\" \n    })\n  } catch (error) {\n    console.error(\"❌ API Route 加入購物車失敗:\", error)\n    return NextResponse.json(\n      { \n        error: error instanceof Error ? error.message : \"Failed to add item to cart\",\n        success: false \n      },\n      { status: 500 }\n    )\n  }\n}","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/cart/transfer/route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'request' is defined but never used.","line":6,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":35},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'request' is defined but never used. Allowed unused args must match /^_/u.","line":6,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":35},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":27,"column":49,"nodeType":"MemberExpression","messageId":"unexpected","endLine":27,"endColumn":62}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\nimport { getCartId, getAuthHeaders, getCacheTag } from '@lib/data/cookies'\nimport { revalidateTag } from 'next/cache'\nimport { sdk } from '@lib/config'\n\nexport async function POST(request: NextRequest) {\n  try {\n    const cartId = await getCartId()\n    \n    if (!cartId) {\n      return NextResponse.json({ message: 'No cart to transfer' })\n    }\n    \n    const headers = await getAuthHeaders()\n    \n    if (!headers) {\n      return NextResponse.json({ error: 'Not authenticated' }, { status: 401 })\n    }\n    \n    await sdk.store.cart.transferCart(cartId, {}, headers)\n    \n    const cartCacheTag = await getCacheTag(\"carts\")\n    revalidateTag(cartCacheTag)\n    \n    return NextResponse.json({ success: true })\n  } catch (error) {\n    if (process.env.NODE_ENV === 'development') console.error('購物車轉移錯誤:', error)\n    return NextResponse.json({ error: 'Failed to transfer cart' }, { status: 500 })\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/checkout/bank-transfer/route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":43,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1150,1153],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1150,1153],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":44,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":44,"endColumn":20,"suggestions":[{"fix":{"range":[1163,1199],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":51,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1353,1356],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1353,1356],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":52,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":52,"endColumn":18,"suggestions":[{"fix":{"range":[1364,1398],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\"\nimport { sdk } from \"@lib/config\"\n\nexport async function POST(request: NextRequest) {\n  try {\n    const { cartId } = await request.json()\n\n    if (!cartId) {\n      return NextResponse.json({ error: '購物車ID不能為空' }, { status: 400 })\n    }\n\n    // 首先獲取購物車\n    const cart = await sdk.store.cart.retrieve(cartId)\n    \n    if (!cart) {\n      return NextResponse.json({ error: '找不到購物車' }, { status: 404 })\n    }\n\n    // 創建訂單 - 使用銀行轉帳付款方式\n    try {\n      const result = await sdk.store.cart.complete(cartId, {})\n      \n      if (result.type === \"order\") {\n        // 訂單創建成功\n        return NextResponse.json({\n          success: true,\n          order: {\n            id: result.order.id,\n            display_id: result.order.display_id,\n            total: result.order.total,\n            status: result.order.status,\n            payment_status: result.order.payment_status\n          }\n        })\n      } else {\n        // 還是購物車，可能需要付款方式\n        return NextResponse.json({ \n          error: '無法完成訂單，可能缺少付款方式',\n          type: result.type\n        }, { status: 400 })\n      }\n      \n    } catch (orderError: any) {\n      console.error('創建訂單失敗:', orderError)\n      return NextResponse.json({ \n        error: '創建訂單失敗，請稍後重試',\n        details: orderError.message \n      }, { status: 500 })\n    }\n\n  } catch (error: any) {\n    console.error('銀行轉帳API錯誤:', error)\n    return NextResponse.json({ \n      error: '服務器錯誤',\n      details: error.message \n    }, { status: 500 })\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/customer/me/route.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":9,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":9,"endColumn":16,"suggestions":[{"fix":{"range":[215,337],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":11,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[311,314],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[311,314],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":14,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[372,375],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[372,375],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":23,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":23,"endColumn":16,"suggestions":[{"fix":{"range":[583,679],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":30,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":30,"endColumn":18,"suggestions":[{"fix":{"range":[748,794],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\"\nimport { sdk } from \"@lib/config\"\nimport { getAuthHeaders } from \"@lib/data/cookies\"\n\nexport async function GET() {\n  try {\n    const headers = await getAuthHeaders()\n\n    console.log(\"📡 API Route: 獲取客戶資料\", {\n      hasHeaders: !!headers,\n      hasAuth: !!(headers as any)?.authorization\n    })\n\n    if (!headers || !(headers as any)?.authorization) {\n      return NextResponse.json(\n        { error: \"Not authenticated\" },\n        { status: 401 }\n      )\n    }\n\n    const { customer } = await sdk.store.customer.retrieve({}, headers)\n\n    console.log(\"✅ API Route: 成功獲取客戶資料\", {\n      email: customer.email,\n      id: customer.id\n    })\n\n    return NextResponse.json({ customer })\n  } catch (error) {\n    console.error(\"❌ API Route: 獲取客戶資料失敗:\", error)\n    return NextResponse.json(\n      { error: \"Failed to retrieve customer\" },\n      { status: 500 }\n    )\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/customer/orders/[orderId]/route.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":15,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":15,"endColumn":16,"suggestions":[{"fix":{"range":[348,382],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":24,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":24,"endColumn":16,"suggestions":[{"fix":{"range":[591,641],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":30,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[733,736],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[733,736],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":31,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":31,"endColumn":18,"suggestions":[{"fix":{"range":[744,779],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":44,"column":30,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":44,"endColumn":32,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1128,1130],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\nimport { sdk } from '@lib/config'\n\nexport async function GET(\n  request: NextRequest,\n  { params }: { params: Promise<{ orderId: string }> }\n) {\n  try {\n    const { orderId } = await params\n\n    if (!orderId) {\n      return NextResponse.json({ error: '缺少訂單 ID' }, { status: 400 })\n    }\n\n    console.log('🔍 獲取訂單詳情:', orderId)\n\n    // 使用 Medusa SDK 獲取訂單詳情\n    const orderResponse = await sdk.store.order.retrieve(orderId)\n\n    if (!orderResponse?.order) {\n      return NextResponse.json({ error: '訂單不存在' }, { status: 404 })\n    }\n\n    console.log('✅ 成功獲取訂單詳情:', orderResponse.order.id)\n\n    return NextResponse.json({\n      order: orderResponse.order\n    })\n\n  } catch (error: any) {\n    console.error('❌ 獲取訂單詳情失敗:', error)\n    \n    // 處理不同類型的錯誤\n    if (error?.response?.status === 404) {\n      return NextResponse.json({ error: '訂單不存在' }, { status: 404 })\n    }\n    \n    if (error?.response?.status === 401) {\n      return NextResponse.json({ error: '未授權訪問' }, { status: 401 })\n    }\n\n    return NextResponse.json({ \n      error: '獲取訂單詳情失敗',\n      details: error.message || String(error)\n    }, { status: 500 })\n  }\n}","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/customer/orders/route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'request' is defined but never used.","line":4,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":34},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'request' is defined but never used. Allowed unused args must match /^_/u.","line":4,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":34},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":9,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":9,"endColumn":18,"suggestions":[{"fix":{"range":[298,331],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\"\nimport { listOrders } from \"@lib/data/orders\"\n\nexport async function GET(request: NextRequest) {\n  try {\n    const orders = await listOrders(20, 0) // 獲取最近 20 筆訂單\n    return NextResponse.json({ orders: orders || [] })\n  } catch (error) {\n    console.error('獲取客戶訂單失敗:', error)\n    return NextResponse.json({ orders: [] }, { status: 200 })\n  }\n}","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/customer/route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'request' is defined but never used.","line":4,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":34},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'request' is defined but never used. Allowed unused args must match /^_/u.","line":4,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":34},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":8,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":17},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":8,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":17}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\"\nimport { retrieveCustomer } from \"@lib/data/customer\"\n\nexport async function GET(request: NextRequest) {\n  try {\n    const customer = await retrieveCustomer()\n    return NextResponse.json({ customer })\n  } catch (error) {\n    return NextResponse.json({ customer: null }, { status: 404 })\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/debug/cookies/route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_request' is defined but never used.","line":4,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":35},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":13,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":13,"endColumn":16,"suggestions":[{"fix":{"range":[426,744],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":43,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":43,"endColumn":18,"suggestions":[{"fix":{"range":[1390,1429],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\"\nimport { cookies } from \"next/headers\"\n\nexport async function GET(_request: NextRequest) {\n  try {\n    const cookieStore = await cookies()\n    const allCookies = cookieStore.getAll()\n    \n    const jwtCookie = cookieStore.get(\"_medusa_jwt\")\n    const debugPreview = cookieStore.get(\"_debug_jwt_preview\")\n    const debugFull = cookieStore.get(\"_debug_jwt_full\")\n    \n    console.log(\"🍪 調試 Cookie 狀態:\", {\n      totalCookies: allCookies.length,\n      hasJwtCookie: !!jwtCookie,\n      jwtValue: jwtCookie?.value ? `${jwtCookie.value.substring(0, 50)}...` : null,\n      hasDebugPreview: !!debugPreview,\n      hasDebugFull: !!debugFull,\n      allCookieNames: allCookies.map(c => c.name)\n    })\n\n    return NextResponse.json({\n      success: true,\n      cookies: {\n        total: allCookies.length,\n        jwt: jwtCookie ? {\n          name: jwtCookie.name,\n          hasValue: !!jwtCookie.value,\n          valuePreview: jwtCookie.value ? `${jwtCookie.value.substring(0, 100)}...` : null\n        } : null,\n        debugPreview: debugPreview ? {\n          name: debugPreview.name,\n          value: debugPreview.value\n        } : null,\n        all: allCookies.map(cookie => ({\n          name: cookie.name,\n          hasValue: !!cookie.value,\n          valueLength: cookie.value?.length || 0\n        }))\n      }\n    })\n  } catch (error) {\n    console.error(\"❌ 調試 Cookie 失敗:\", error)\n    return NextResponse.json({\n      success: false,\n      error: error instanceof Error ? error.message : String(error)\n    }, { status: 500 })\n  }\n}","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/debug/medusa/route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_request' is defined but never used.","line":4,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":35},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":6,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":6,"endColumn":16,"suggestions":[{"fix":{"range":[171,206],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":10,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":10,"endColumn":16,"suggestions":[{"fix":{"range":[283,325],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":14,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":14,"endColumn":16,"suggestions":[{"fix":{"range":[467,509],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":21,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":21,"endColumn":16,"suggestions":[{"fix":{"range":[626,818],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":31,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":31,"endColumn":18,"suggestions":[{"fix":{"range":[904,948],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":33,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":33,"endColumn":18,"suggestions":[{"fix":{"range":[981,1027],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":35,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":35,"endColumn":18,"suggestions":[{"fix":{"range":[1079,1122],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":50,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":50,"endColumn":18,"suggestions":[{"fix":{"range":[1544,1584],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\"\nimport { getAuthHeaders } from \"@lib/data/cookies\"\n\nexport async function GET(_request: NextRequest) {\n  try {\n    console.log('🔍 測試 Medusa 後端連接...')\n    \n    // 檢查認證 headers\n    const authHeaders = await getAuthHeaders()\n    console.log('📋 認證 headers:', authHeaders)\n    \n    // 直接調用 Medusa 後端的 /store/customers/me\n    const medusaUrl = `${process.env.NEXT_PUBLIC_MEDUSA_BACKEND_URL}/store/customers/me`\n    console.log('🎯 調用 Medusa 端點:', medusaUrl)\n    \n    const response = await fetch(medusaUrl, {\n      method: 'GET',\n      headers: authHeaders,\n    })\n    \n    console.log('📡 Medusa 回應:', {\n      status: response.status,\n      statusText: response.statusText,\n      ok: response.ok,\n      headers: Object.fromEntries(response.headers.entries())\n    })\n    \n    let responseData\n    try {\n      responseData = await response.json()\n      console.log('📄 Medusa 回應內容:', responseData)\n    } catch (jsonError) {\n      console.log('⚠️ 無法解析 JSON，嘗試讀取文本:', jsonError)\n      const textData = await response.text()\n      console.log('📄 Medusa 回應 (文本):', textData)\n      responseData = { error: 'Non-JSON response', text: textData }\n    }\n    \n    return NextResponse.json({\n      success: response.ok,\n      status: response.status,\n      statusText: response.statusText,\n      headers: Object.fromEntries(response.headers.entries()),\n      data: responseData,\n      authHeaders: authHeaders,\n      medusaUrl: medusaUrl\n    }, { status: response.status })\n    \n  } catch (error) {\n    console.error('❌ Medusa 連接測試錯誤:', error)\n    return NextResponse.json({\n      success: false,\n      error: String(error),\n      stack: error instanceof Error ? error.stack : undefined\n    }, { status: 500 })\n  }\n}","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/ecpay/callback/route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'NextResponse' is defined but never used.","line":1,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":22},{"ruleId":"unused-imports/no-unused-imports","severity":2,"message":"'NextResponse' is defined but never used.","line":1,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":22,"fix":{"range":[0,44],"text":"\n"}},{"ruleId":"sonarjs/cognitive-complexity","severity":2,"message":"Refactor this function to reduce its Cognitive Complexity from 28 to the 15 allowed.","line":3,"column":23,"nodeType":null,"messageId":"refactorFunction","endLine":3,"endColumn":27},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":4,"column":47,"nodeType":"MemberExpression","messageId":"unexpected","endLine":4,"endColumn":58},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":5,"column":47,"nodeType":"MemberExpression","messageId":"unexpected","endLine":5,"endColumn":58},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":10,"column":49,"nodeType":"MemberExpression","messageId":"unexpected","endLine":10,"endColumn":60},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":16,"column":49,"nodeType":"MemberExpression","messageId":"unexpected","endLine":16,"endColumn":60},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'RtnMsg' is assigned a value but never used.","line":22,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":13},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'RtnMsg' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":22,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'TradeNo' is assigned a value but never used.","line":23,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":14},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'TradeNo' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":23,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'PaymentType' is assigned a value but never used.","line":26,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":26,"endColumn":18},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'PaymentType' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":26,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":26,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'TradeDate' is assigned a value but never used.","line":27,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":16},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'TradeDate' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":27,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":16},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":31,"column":51,"nodeType":"MemberExpression","messageId":"unexpected","endLine":31,"endColumn":64},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":35,"column":49,"nodeType":"MemberExpression","messageId":"unexpected","endLine":35,"endColumn":60},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":36,"column":49,"nodeType":"MemberExpression","messageId":"unexpected","endLine":36,"endColumn":60},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":37,"column":49,"nodeType":"MemberExpression","messageId":"unexpected","endLine":37,"endColumn":60},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":42,"column":49,"nodeType":"MemberExpression","messageId":"unexpected","endLine":42,"endColumn":60},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":53,"column":49,"nodeType":"MemberExpression","messageId":"unexpected","endLine":53,"endColumn":60},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":57,"column":51,"nodeType":"MemberExpression","messageId":"unexpected","endLine":57,"endColumn":62},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":61,"column":53,"nodeType":"MemberExpression","messageId":"unexpected","endLine":61,"endColumn":64},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":68,"column":51,"nodeType":"MemberExpression","messageId":"unexpected","endLine":68,"endColumn":64},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":73,"column":49,"nodeType":"MemberExpression","messageId":"unexpected","endLine":73,"endColumn":62},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":80,"column":3,"nodeType":"MemberExpression","messageId":"unexpected","endLine":80,"endColumn":14,"suggestions":[{"fix":{"range":[2709,2738],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":85,"column":3,"nodeType":"MemberExpression","messageId":"unexpected","endLine":85,"endColumn":14,"suggestions":[{"fix":{"range":[2842,2875],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":11,"fatalErrorCount":0,"warningCount":16,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\"\n\nexport async function POST(req: Request) {\n  if (process.env.NODE_ENV === 'development') console.log('🎯 ECPay 付款回調處理開始')\n  if (process.env.NODE_ENV === 'development') console.log('⏰ 回調時間:', new Date().toISOString())\n  \n  try {\n    // 解析回調資料\n    const body = await req.text()\n    if (process.env.NODE_ENV === 'development') console.log('📨 收到 ECPay 回調資料:', body)\n    \n    // 如果是 form data 格式，需要解析\n    const formData = new URLSearchParams(body)\n    const callbackData = Object.fromEntries(formData.entries())\n    \n    if (process.env.NODE_ENV === 'development') console.log('📋 解析後的回調資料:', callbackData)\n    \n    // 必要欄位驗證\n    const {\n      MerchantTradeNo,\n      RtnCode,\n      RtnMsg,\n      TradeNo,\n      TradeAmt,\n      PaymentDate,\n      PaymentType,\n      TradeDate\n    } = callbackData\n    \n    if (!MerchantTradeNo) {\n      if (process.env.NODE_ENV === 'development') console.error('❌ 缺少商戶交易號碼')\n      return new Response(\"0|Missing MerchantTradeNo\", { status: 400 })\n    }\n    \n    if (process.env.NODE_ENV === 'development') console.log(`📊 付款狀態: ${RtnCode === '1' ? '成功' : '失敗'}`)\n    if (process.env.NODE_ENV === 'development') console.log(`💰 交易金額: ${TradeAmt}`)\n    if (process.env.NODE_ENV === 'development') console.log(`📅 付款時間: ${PaymentDate}`)\n    \n    // 直接轉發給後端處理\n    const backendUrl = `${process.env.NEXT_PUBLIC_MEDUSA_BACKEND_URL}/store/ecpay/callback`\n    \n    if (process.env.NODE_ENV === 'development') console.log('🔄 轉發回調資料到後端:', backendUrl)\n    \n    const response = await fetch(backendUrl, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n        'User-Agent': 'ECPay-Frontend-Proxy/1.0'\n      },\n      body: body\n    })\n    \n    if (process.env.NODE_ENV === 'development') console.log('後端處理結果:', response.status, response.statusText)\n    \n    if (response.ok) {\n      const result = await response.text()\n      if (process.env.NODE_ENV === 'development') console.log('✅ 後端處理成功:', result)\n      \n      // 如果付款成功，可以重定向到成功頁面\n      if (RtnCode === '1') {\n        if (process.env.NODE_ENV === 'development') console.log('🎉 付款成功，準備重定向')\n        // 可以根據需要返回重定向指令或其他響應\n      }\n      \n      return new Response(result)\n    } else {\n      const errorText = await response.text()\n      if (process.env.NODE_ENV === 'development') console.error('❌ 後端處理失敗:', errorText)\n      return new Response(\"0|Backend Error\", { status: 500 })\n    }\n    \n  } catch (error) {\n    if (process.env.NODE_ENV === 'development') console.error('💥 付款回調處理錯誤:', error)\n    return new Response(\"0|System Error\", { status: 500 })\n  }\n}\n\n// 支援 GET 請求（有些情況下 ECPay 可能使用 GET）\nexport async function GET(req: Request) {\n  console.log('📥 收到 GET 付款回調')\n  \n  const url = new URL(req.url)\n  const params = Object.fromEntries(url.searchParams.entries())\n  \n  console.log('🔍 GET 參數:', params)\n  \n  // 轉換為 POST 處理\n  const formData = new URLSearchParams(params)\n  const mockRequest = {\n    text: async () => formData.toString()\n  } as Request\n  \n  return POST(mockRequest)\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/ecpay/checkout/route.ts","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":8,"column":68,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":8,"endColumn":70,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[292,294],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":24,"column":23,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":24,"endColumn":25,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[719,721],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":50,"column":19,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":50,"endColumn":21,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1371,1373],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":52,"column":58,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":52,"endColumn":60,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1475,1477],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":69,"column":36,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":69,"endColumn":38,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2036,2038],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":83,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":83,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2297,2300],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2297,2300],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":84,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":84,"endColumn":18,"suggestions":[{"fix":{"range":[2308,2346],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":86,"column":30,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":86,"endColumn":32,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2406,2408],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Next.js API route handler\nimport type { NextRequest } from 'next/server'\nimport { NextResponse } from 'next/server'\nimport { cookies } from 'next/headers'\nimport { retrieveCart } from '@lib/data/cart'\n\n// 設定綠界後端 API 的 URL\nconst BACKEND_API_URL = process.env.NEXT_PUBLIC_MEDUSA_BACKEND_URL || 'http://localhost:9000'\n\nexport async function POST(req: NextRequest) {\n  try {\n    // 取得請求資料\n    const { cartId, paymentMethod } = await req.json()\n    \n    if (!cartId) {\n      return NextResponse.json(\n        { error: '購物車 ID 不能為空' },\n        { status: 400 }\n      )\n    }\n    \n    // 從 cookies 取得購物車 (optional，如果你已經傳入 cartId)\n    const cartCookie = (await cookies()).get('_medusa_cart_id')?.value\n    const id = cartId || cartCookie\n    \n    if (!id) {\n      return NextResponse.json(\n        { error: '無法找到購物車' },\n        { status: 400 }\n      )\n    }\n    \n    // 取得購物車詳細資料\n    const cart = await retrieveCart(id)\n    \n    if (!cart) {\n      return NextResponse.json(\n        { error: '購物車不存在' },\n        { status: 404 }\n      )\n    }\n    \n    // 準備發送到後端的資料\n    const ecpayPaymentData = {\n      MerchantTradeNo: `${id.substring(0, 8)}${Date.now()}`,\n      TotalAmount: cart.total?.toString() || \"0\",\n      TradeDesc: `訂單 ${id}`,\n      ItemName: cart.items?.map((item: { title: string; quantity: number }) => \n        `${item.title} x ${item.quantity}`\n      ).join('#') || '商品',\n      CustomField1: id, // 用於儲存購物車 ID\n      ClientBackURL: `${process.env.NEXT_PUBLIC_BASE_URL || ''}/checkout/confirmation?cart_id=${id}`,\n      // 根據支付方式設定不同參數\n      ChoosePayment: paymentMethod === 'ecpay_credit_card' ? 'Credit' : 'ALL',\n    }\n    \n    // 呼叫後端 API 建立付款\n    const response = await fetch(`${BACKEND_API_URL}/ecpay/create-payment`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify(ecpayPaymentData),\n    })\n    \n    if (!response.ok) {\n      const errorData = await response.json().catch(() => ({}))\n      return NextResponse.json(\n        { error: errorData.message || '建立付款時發生錯誤' },\n        { status: response.status }\n      )\n    }\n    \n    // 取得後端回應\n    const data = await response.json()\n    \n    // 回傳綠界付款表單 HTML\n    return NextResponse.json({\n      htmlForm: data.html,\n      success: true,\n    })\n    \n  } catch (error: any) {\n    console.error('處理綠界付款請求時發生錯誤:', error)\n    return NextResponse.json(\n      { error: error.message || '處理付款時發生錯誤' },\n      { status: 500 }\n    )\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/ecpay/create-payment/route.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":21,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":21,"endColumn":18,"suggestions":[{"fix":{"range":[519,566],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\"\n\nexport async function POST(req: Request) {\n  try {\n    const { order_id } = await req.json()\n\n    const response = await fetch(\n      `${process.env.NEXT_PUBLIC_MEDUSA_BACKEND_URL}/store/ecpay/create-payment`,\n      {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({ order_id }),\n      }\n    )\n\n    const data = await response.json()\n    return NextResponse.json(data)\n  } catch (error) {\n    console.error(\"Error creating payment:\", error)\n    return NextResponse.json(\n      { error: \"Failed to create payment\" },\n      { status: 500 }\n    )\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/ecpay/express-map/route.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":5,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":5,"endColumn":16,"suggestions":[{"fix":{"range":[120,156],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":9,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":9,"endColumn":16,"suggestions":[{"fix":{"range":[218,247],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":12,"column":67,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":12,"endColumn":69,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[301,401],"text":"(process.env.NEXT_PUBLIC_MEDUSA_BACKEND_URL ?? \n                       process.env.MEDUSA_BACKEND_URL)"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":13,"column":55,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":13,"endColumn":57,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[402,404],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":20,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":20,"endColumn":20,"suggestions":[{"fix":{"range":[683,731],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":33,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":33,"endColumn":16,"suggestions":[{"fix":{"range":[1025,1055],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":34,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":34,"endColumn":16,"suggestions":[{"fix":{"range":[1060,1129],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":47,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":47,"endColumn":16,"suggestions":[{"fix":{"range":[1429,1471],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":51,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":51,"endColumn":20,"suggestions":[{"fix":{"range":[1553,1590],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":64,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":64,"endColumn":16,"suggestions":[{"fix":{"range":[1885,1921],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":66,"column":9,"nodeType":null,"messageId":"preferOptionalChain","endLine":66,"endColumn":64,"suggestions":[{"fix":{"range":[1935,1990],"text":"contentType?.includes('application/json')"},"messageId":"optionalChainSuggest","desc":"Change to an optional chain."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":69,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":69,"endColumn":18,"suggestions":[{"fix":{"range":[2060,2093],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":74,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":74,"endColumn":18,"suggestions":[{"fix":{"range":[2231,2268],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":85,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":85,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2482,2485],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2482,2485],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":86,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":86,"endColumn":18,"suggestions":[{"fix":{"range":[2493,2526],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":12,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\n\nexport async function POST(request: NextRequest) {\n  try {\n    console.log('🗺️ 前端代理：ECPay 電子地圖請求')\n    \n    // 獲取請求參數\n    const body = await request.json()\n    console.log('📝 請求參數:', body)\n    \n    // 準備後端 URL 和 API 密鑰\n    const backendUrl = process.env.NEXT_PUBLIC_MEDUSA_BACKEND_URL || \n                       process.env.MEDUSA_BACKEND_URL || \n                       'http://localhost:9000'\n    \n    const { getPublishableKeyForBackend } = await import('@lib/medusa-publishable-key')\n    const publishableKey = getPublishableKeyForBackend(process.env.NEXT_PUBLIC_MEDUSA_BACKEND_URL)\n    \n    if (!publishableKey) {\n      console.error('❌ 缺少 Medusa Publishable API Key')\n      return NextResponse.json(\n        { \n          success: false, \n          message: '缺少 Medusa API 密鑰',\n          error: 'NEXT_PUBLIC_MEDUSA_PUBLISHABLE_KEY 環境變數未設定'\n        },\n        { status: 500 }\n      )\n    }\n    \n    const apiUrl = `${backendUrl}/store/ecpay/express-map`\n    \n    console.log('🔗 代理到:', apiUrl)\n    console.log('🔑 使用 API 密鑰:', publishableKey.substring(0, 10) + '...')\n    \n    // 代理請求到後端\n    const response = await fetch(apiUrl, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'x-publishable-api-key': publishableKey,\n        'User-Agent': 'Medusa-Frontend-Proxy'\n      },\n      body: JSON.stringify(body)\n    })\n    \n    console.log('📡 後端回應狀態:', response.status)\n    \n    if (!response.ok) {\n      const errorText = await response.text()\n      console.error('❌ 後端回應錯誤:', errorText)\n      return NextResponse.json(\n        { \n          success: false, \n          message: `後端 API 錯誤: ${response.status}`,\n          error: errorText\n        },\n        { status: response.status }\n      )\n    }\n    \n    // 檢查回應類型\n    const contentType = response.headers.get('content-type')\n    console.log('📄 回應類型:', contentType)\n    \n    if (contentType && contentType.includes('application/json')) {\n      // JSON 回應\n      const result = await response.json()\n      console.log('✅ JSON 回應:', result)\n      return NextResponse.json(result)\n    } else {\n      // HTML 回應（ECPay 電子地圖頁面）\n      const htmlContent = await response.text()\n      console.log('🗺️ ECPay 電子地圖 HTML 頁面')\n      \n      // 回傳 HTML 內容\n      return new NextResponse(htmlContent, {\n        status: 200,\n        headers: {\n          'Content-Type': 'text/html; charset=utf-8'\n        }\n      })\n    }\n    \n  } catch (error: any) {\n    console.error('❌ 代理請求失敗:', error)\n    return NextResponse.json(\n      {\n        success: false,\n        message: '代理請求失敗',\n        error: error.message\n      },\n      { status: 500 }\n    )\n  }\n}\n\nexport async function GET() {\n  return NextResponse.json({\n    success: true,\n    message: \"ECPay 電子地圖代理 API\",\n    description: \"此端點代理請求到 Medusa 後端的 ECPay 電子地圖 API\",\n    targetUrl: \"https://logistics-stage.ecpay.com.tw/Express/map\"\n  })\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/ecpay/logistics-selection/route.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":5,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":5,"endColumn":16,"suggestions":[{"fix":{"range":[120,155],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":9,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":9,"endColumn":16,"suggestions":[{"fix":{"range":[217,246],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":12,"column":67,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":12,"endColumn":69,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[300,400],"text":"(process.env.NEXT_PUBLIC_MEDUSA_BACKEND_URL ?? \n                       process.env.MEDUSA_BACKEND_URL)"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":13,"column":55,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":13,"endColumn":57,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[401,403],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":20,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":20,"endColumn":20,"suggestions":[{"fix":{"range":[682,730],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":33,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":33,"endColumn":16,"suggestions":[{"fix":{"range":[1032,1062],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":34,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":34,"endColumn":16,"suggestions":[{"fix":{"range":[1067,1136],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":47,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":47,"endColumn":16,"suggestions":[{"fix":{"range":[1436,1478],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":51,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":51,"endColumn":20,"suggestions":[{"fix":{"range":[1560,1597],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":64,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":64,"endColumn":16,"suggestions":[{"fix":{"range":[1892,1928],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":66,"column":9,"nodeType":null,"messageId":"preferOptionalChain","endLine":66,"endColumn":64,"suggestions":[{"fix":{"range":[1942,1997],"text":"contentType?.includes('application/json')"},"messageId":"optionalChainSuggest","desc":"Change to an optional chain."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":69,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":69,"endColumn":18,"suggestions":[{"fix":{"range":[2067,2100],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":74,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":74,"endColumn":18,"suggestions":[{"fix":{"range":[2236,2263],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":85,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":85,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2477,2480],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2477,2480],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":86,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":86,"endColumn":18,"suggestions":[{"fix":{"range":[2488,2521],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":12,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\n\nexport async function POST(request: NextRequest) {\n  try {\n    console.log('🚚 前端代理：ECPay 物流選擇請求')\n    \n    // 獲取請求參數\n    const body = await request.json()\n    console.log('📝 請求參數:', body)\n    \n    // 準備後端 URL 和 API 密鑰\n    const backendUrl = process.env.NEXT_PUBLIC_MEDUSA_BACKEND_URL || \n                       process.env.MEDUSA_BACKEND_URL || \n                       'http://localhost:9000'\n    \n    const { getPublishableKeyForBackend } = await import('@lib/medusa-publishable-key')\n    const publishableKey = getPublishableKeyForBackend(process.env.NEXT_PUBLIC_MEDUSA_BACKEND_URL)\n    \n    if (!publishableKey) {\n      console.error('❌ 缺少 Medusa Publishable API Key')\n      return NextResponse.json(\n        { \n          success: false, \n          message: '缺少 Medusa API 密鑰',\n          error: 'NEXT_PUBLIC_MEDUSA_PUBLISHABLE_KEY 環境變數未設定'\n        },\n        { status: 500 }\n      )\n    }\n    \n    const apiUrl = `${backendUrl}/store/ecpay/logistics-selection`\n    \n    console.log('🔗 代理到:', apiUrl)\n    console.log('🔑 使用 API 密鑰:', publishableKey.substring(0, 10) + '...')\n    \n    // 代理請求到後端\n    const response = await fetch(apiUrl, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'x-publishable-api-key': publishableKey,\n        'User-Agent': 'Medusa-Frontend-Proxy'\n      },\n      body: JSON.stringify(body)\n    })\n    \n    console.log('📡 後端回應狀態:', response.status)\n    \n    if (!response.ok) {\n      const errorText = await response.text()\n      console.error('❌ 後端回應錯誤:', errorText)\n      return NextResponse.json(\n        { \n          success: false, \n          message: `後端 API 錯誤: ${response.status}`,\n          error: errorText\n        },\n        { status: response.status }\n      )\n    }\n    \n    // 檢查回應類型\n    const contentType = response.headers.get('content-type')\n    console.log('📄 回應類型:', contentType)\n    \n    if (contentType && contentType.includes('application/json')) {\n      // JSON 回應\n      const result = await response.json()\n      console.log('✅ JSON 回應:', result)\n      return NextResponse.json(result)\n    } else {\n      // HTML 回應（ECPay 跳轉頁面）\n      const htmlContent = await response.text()\n      console.log('🔗 HTML 跳轉頁面')\n      \n      // 回傳 HTML 內容\n      return new NextResponse(htmlContent, {\n        status: 200,\n        headers: {\n          'Content-Type': 'text/html; charset=utf-8'\n        }\n      })\n    }\n    \n  } catch (error: any) {\n    console.error('❌ 代理請求失敗:', error)\n    return NextResponse.json(\n      {\n        success: false,\n        message: '代理請求失敗',\n        error: error.message\n      },\n      { status: 500 }\n    )\n  }\n}\n\nexport async function GET() {\n  return NextResponse.json({\n    success: true,\n    message: \"ECPay 物流選擇代理 API\",\n    description: \"此端點代理請求到 Medusa 後端的 ECPay 物流選擇 API\"\n  })\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/ecpay/logistics/callback/route.ts","messages":[{"ruleId":"sonarjs/cognitive-complexity","severity":2,"message":"Refactor this function to reduce its Cognitive Complexity from 18 to the 15 allowed.","line":3,"column":23,"nodeType":null,"messageId":"refactorFunction","endLine":3,"endColumn":27},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":5,"column":49,"nodeType":"MemberExpression","messageId":"unexpected","endLine":5,"endColumn":60},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":8,"column":49,"nodeType":"MemberExpression","messageId":"unexpected","endLine":8,"endColumn":60},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":11,"column":67,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":11,"endColumn":69,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[404,406],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":16,"column":49,"nodeType":"MemberExpression","messageId":"unexpected","endLine":16,"endColumn":60},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":17,"column":49,"nodeType":"MemberExpression","messageId":"unexpected","endLine":17,"endColumn":60},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":20,"column":51,"nodeType":"MemberExpression","messageId":"unexpected","endLine":20,"endColumn":64},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":41,"column":51,"nodeType":"MemberExpression","messageId":"unexpected","endLine":41,"endColumn":64},{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":52,"column":9,"nodeType":null,"messageId":"preferOptionalChain","endLine":52,"endColumn":57,"suggestions":[{"fix":{"range":[1866,1914],"text":"contentType?.includes('text/html')"},"messageId":"optionalChainSuggest","desc":"Change to an optional chain."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":67,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2290,2293],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2290,2293],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":68,"column":49,"nodeType":"MemberExpression","messageId":"unexpected","endLine":68,"endColumn":62}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\n\nexport async function POST(request: NextRequest) {\n  try {\n    if (process.env.NODE_ENV === 'development') console.log('📞 前端物流選擇回調 API 被調用')\n    \n    const body = await request.json()\n    if (process.env.NODE_ENV === 'development') console.log('📝 回調參數:', body)\n\n    // 轉發回調請求到後端\n    const backendUrl = process.env.NEXT_PUBLIC_MEDUSA_BACKEND_URL || 'http://localhost:9000'\n    const { getPublishableKeyForBackend } = await import('@lib/medusa-publishable-key')\n    const publishableKey = getPublishableKeyForBackend(process.env.NEXT_PUBLIC_MEDUSA_BACKEND_URL)\n    const apiEndpoint = `${backendUrl}/store/ecpay/logistics-callback`\n\n    if (process.env.NODE_ENV === 'development') console.log('🔄 轉發回調到:', apiEndpoint)\n    if (process.env.NODE_ENV === 'development') console.log('🔑 使用 Publishable Key:', publishableKey ? '已設定' : '未設定')\n\n    if (!publishableKey) {\n      if (process.env.NODE_ENV === 'development') console.error('❌ 缺少 Publishable Key')\n      return NextResponse.json(\n        { \n          success: false, \n          message: \"系統配置錯誤：缺少必要的API金鑰\" \n        },\n        { status: 500 }\n      )\n    }\n\n    const response = await fetch(apiEndpoint, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'x-publishable-api-key': publishableKey\n      },\n      body: JSON.stringify(body)\n    })\n\n    if (!response.ok) {\n      const errorData = await response.json().catch(() => ({}))\n      if (process.env.NODE_ENV === 'development') console.error('❌ 後端回調 API 錯誤:', response.status, errorData)\n      return NextResponse.json({\n        success: false,\n        message: `後端回調 API 錯誤: ${response.status}`,\n        error: errorData\n      }, { status: response.status })\n    }\n\n    // 檢查回應內容類型\n    const contentType = response.headers.get('content-type')\n    \n    if (contentType && contentType.includes('text/html')) {\n      // 如果是 HTML，直接回傳\n      const htmlContent = await response.text()\n      return new NextResponse(htmlContent, {\n        status: 200,\n        headers: {\n          'Content-Type': 'text/html; charset=utf-8'\n        }\n      })\n    } else {\n      // 如果是 JSON，解析後回傳\n      const result = await response.json()\n      return NextResponse.json(result)\n    }\n\n  } catch (error: any) {\n    if (process.env.NODE_ENV === 'development') console.error('❌ 前端物流選擇回調 API 錯誤:', error)\n    return NextResponse.json({\n      success: false,\n      message: '物流選擇回調 API 錯誤',\n      error: error.message\n    }, { status: 500 })\n  }\n}\n\nexport async function GET() {\n  return NextResponse.json({\n    success: true,\n    message: \"ECPay 物流選擇回調前端 API\",\n    description: \"此端點用於接收綠界物流選擇完成後的回調\",\n    usage: {\n      method: \"POST\",\n      description: \"綠界會透過此端點回傳物流選擇結果\"\n    }\n  })\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/ecpay/payment/route.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":4,"column":3,"nodeType":"MemberExpression","messageId":"unexpected","endLine":4,"endColumn":14,"suggestions":[{"fix":{"range":[89,130],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":5,"column":3,"nodeType":"MemberExpression","messageId":"unexpected","endLine":5,"endColumn":14,"suggestions":[{"fix":{"range":[133,179],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":10,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":10,"endColumn":16,"suggestions":[{"fix":{"range":[296,322],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":11,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":11,"endColumn":16,"suggestions":[{"fix":{"range":[327,362],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":12,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":12,"endColumn":16,"suggestions":[{"fix":{"range":[367,408],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":13,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":13,"endColumn":16,"suggestions":[{"fix":{"range":[413,467],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":13,"column":54,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":13,"endColumn":56,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[462,464],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":14,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":14,"endColumn":16,"suggestions":[{"fix":{"range":[472,515],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":15,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":15,"endColumn":16,"suggestions":[{"fix":{"range":[521,593],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-extra-boolean-cast","severity":2,"message":"Redundant double negation.","line":15,"column":39,"nodeType":"UnaryExpression","messageId":"unexpectedNegation","endLine":15,"endColumn":56,"fix":{"range":[555,572],"text":"shippingAddress"}},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":16,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":16,"endColumn":16,"suggestions":[{"fix":{"range":[598,646],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":17,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":17,"endColumn":16,"suggestions":[{"fix":{"range":[651,719],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-extra-boolean-cast","severity":2,"message":"Redundant double negation.","line":17,"column":37,"nodeType":"UnaryExpression","messageId":"unexpectedNegation","endLine":17,"endColumn":52,"fix":{"range":[683,698],"text":"selectedStore"}},{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":20,"column":9,"nodeType":null,"messageId":"preferOptionalChain","endLine":20,"endColumn":26,"fix":{"range":[743,760],"text":"!cart?.id"}},{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":27,"column":9,"nodeType":null,"messageId":"preferOptionalChain","endLine":28,"endColumn":36,"fix":{"range":[891,946],"text":"!shippingAddress?.first_name"}},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":39,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":39,"endColumn":16,"suggestions":[{"fix":{"range":[1220,1251],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":40,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":40,"endColumn":16,"suggestions":[{"fix":{"range":[1256,1354],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":42,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":42,"endColumn":16,"suggestions":[{"fix":{"range":[1447,1563],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":53,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":53,"endColumn":16,"suggestions":[{"fix":{"range":[1802,1874],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":64,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":64,"endColumn":16,"suggestions":[{"fix":{"range":[2184,2244],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":68,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":68,"endColumn":20,"suggestions":[{"fix":{"range":[2326,2363],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":73,"column":36,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":73,"endColumn":38,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2484,2520],"text":"(errorData.error ?? errorData.message)"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":73,"column":57,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":73,"endColumn":59,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2521,2523],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":85,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":85,"endColumn":16,"suggestions":[{"fix":{"range":[2818,2846],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":89,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":89,"endColumn":20,"suggestions":[{"fix":{"range":[2894,2930],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":96,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":96,"endColumn":16,"suggestions":[{"fix":{"range":[3047,3078],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":99,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":99,"endColumn":18,"suggestions":[{"fix":{"range":[3138,3185],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":20,"fixableErrorCount":4,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\"\n\nexport async function POST(req: Request) {\n  console.log('🌐🌐🌐 前端 ECPay API 被呼叫！！！')\n  console.log('⏰ 時間:', new Date().toISOString())\n  \n  try {\n    const { cart, customer, shippingAddress, shippingMethod, selectedStore } = await req.json()\n    \n    console.log('📦 前端收到的參數:')\n    console.log('- cart ID:', cart?.id)\n    console.log('- cart total:', cart?.total)\n    console.log('- cart items:', cart?.items?.length || 0)\n    console.log('- customer ID:', customer?.id) \n    console.log('- shippingAddress:', !!shippingAddress ? '✅ 有地址' : '❌ 無地址')\n    console.log('- shippingMethod:', shippingMethod)\n    console.log('- selectedStore:', !!selectedStore ? '✅ 有門市' : '❌ 無門市')\n\n    // 驗證必要資訊\n    if (!cart || !cart.id) {\n      return NextResponse.json(\n        { success: false, message: \"購物車資訊無效\" },\n        { status: 400 }\n      )\n    }\n\n    if (!shippingAddress ||\n        !shippingAddress.first_name || \n        !shippingAddress.last_name ||\n        !shippingAddress.address_1 ||\n        !shippingAddress.city ||\n        !shippingAddress.phone) {\n      return NextResponse.json(\n        { success: false, message: \"請先填寫完整收件資訊\" },\n        { status: 400 }\n      )\n    }\n\n    console.log('🔄 準備調用後端 API...')\n    console.log('後端 URL:', `${process.env.NEXT_PUBLIC_MEDUSA_BACKEND_URL}/store/ecpay/create-payment`)\n    const { getPublishableKeyForBackend } = await import('@lib/medusa-publishable-key')\n    console.log('API Key:', getPublishableKeyForBackend(process.env.NEXT_PUBLIC_MEDUSA_BACKEND_URL) ? 'SET' : 'NOT_SET')\n    \n    const backendUrl = `${process.env.NEXT_PUBLIC_MEDUSA_BACKEND_URL}/store/ecpay/create-payment`\n    const requestBody = { \n      cart,\n      customer,\n      shippingAddress,\n      shippingMethod,\n      selectedStore\n    }\n    \n    console.log('🔄 Request payload:', JSON.stringify(requestBody, null, 2))\n    \n    const response = await fetch(backendUrl, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        \"x-publishable-api-key\": getPublishableKeyForBackend(process.env.NEXT_PUBLIC_MEDUSA_BACKEND_URL) || \"\",\n      },\n      body: JSON.stringify(requestBody),\n    })\n\n    console.log('後端回應狀態:', response.status, response.statusText)\n    \n    if (!response.ok) {\n      const errorText = await response.text()\n      console.error('❌ 後端錯誤回應:', errorText)\n      \n      try {\n        const errorData = JSON.parse(errorText)\n        return NextResponse.json(\n          { error: errorData.error || errorData.message || \"後端處理失敗\" },\n          { status: response.status }\n        )\n      } catch {\n        return NextResponse.json(\n          { error: `後端處理失敗: ${response.status} ${response.statusText}` },\n          { status: response.status }\n        )\n      }\n    }\n    \n    const data = await response.json()\n    console.log('後端回應數據:', data)\n    \n    // 驗證回應數據\n    if (!data.html) {\n      console.error('❌ 後端未返回 HTML:', data)\n      return NextResponse.json(\n        { error: \"後端未返回付款表單 HTML\" },\n        { status: 500 }\n      )\n    }\n    \n    console.log('✅ 付款表單 HTML 驗證通過')\n    return NextResponse.json(data)\n  } catch (error) {\n    console.error(\"Error creating payment:\", error)\n    return NextResponse.json(\n      { error: \"Failed to create payment\" },\n      { status: 500 }\n    )\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/ecpay/success/route.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":8,"column":3,"nodeType":"MemberExpression","messageId":"unexpected","endLine":8,"endColumn":14,"suggestions":[{"fix":{"range":[275,414],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":20,"column":69,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":20,"endColumn":71,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[693,695],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":30,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":30,"endColumn":20,"suggestions":[{"fix":{"range":[1084,1150],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\"\n\nexport async function GET(request: NextRequest) {\n  const searchParams = request.nextUrl.searchParams\n  const orderId = searchParams.get('order_id')\n  const merchantTradeNo = searchParams.get('merchant_trade_no')\n  \n  console.log('🎉 ECPay payment success callback received:', {\n    orderId,\n    merchantTradeNo,\n    timestamp: new Date().toISOString()\n  })\n\n  if (orderId) {\n    // 重定向到訂單確認頁面\n    return NextResponse.redirect(new URL(`/tw/order/${orderId}/confirmed`, request.url))\n  } else if (merchantTradeNo) {\n    // 如果沒有orderId但有merchantTradeNo，嘗試查詢訂單\n    try {\n      const backendUrl = process.env.NEXT_PUBLIC_MEDUSA_BACKEND_URL || process.env.MEDUSA_BACKEND_URL\n      const response = await fetch(`${backendUrl}/store/orders/by-merchant-trade-no/${merchantTradeNo}`)\n      \n      if (response.ok) {\n        const data = await response.json()\n        if (data.order?.id) {\n          return NextResponse.redirect(new URL(`/tw/order/${data.order.id}/confirmed`, request.url))\n        }\n      }\n    } catch (error) {\n      console.error('Error fetching order by merchant trade no:', error)\n    }\n  }\n\n  // 如果找不到訂單，重定向到首頁或錯誤頁面\n  return NextResponse.redirect(new URL('/tw?payment_success=true', request.url))\n}\n\nexport async function POST(request: NextRequest) {\n  // 也處理POST請求，以防ECPay使用POST\n  return GET(request)\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/grapesjs-pages/route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":11,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[223,226],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[223,226],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":12,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[237,240],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[237,240],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":25,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":25,"endColumn":17},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":25,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":25,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":36,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":36,"endColumn":17},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":36,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":36,"endColumn":17},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":48,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":48,"endColumn":18,"suggestions":[{"fix":{"range":[1084,1118],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":82,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":82,"endColumn":18,"suggestions":[{"fix":{"range":[1947,1978],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":112,"column":18,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":112,"endColumn":20,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2683,2685],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":113,"column":16,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":113,"endColumn":18,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2705,2707],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":114,"column":30,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":114,"endColumn":32,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2741,2743],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":115,"column":22,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":115,"endColumn":24,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2769,2771],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":130,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":130,"endColumn":18,"suggestions":[{"fix":{"range":[3090,3121],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":169,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":169,"endColumn":18,"suggestions":[{"fix":{"range":[3923,3954],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\nimport { promises as fs } from 'fs'\nimport path from 'path'\n\n// 頁面資料類型\ninterface GrapesJSPage {\n  id: string\n  name: string\n  html: string\n  css: string\n  components: any\n  styles: any\n  createdAt: string\n  updatedAt: string\n}\n\n// 儲存設定\nconst STORAGE_DIR = path.join(process.cwd(), 'data', 'grapesjs-pages')\nconst PAGES_FILE = path.join(STORAGE_DIR, 'pages.json')\n\n// 確保儲存目錄存在\nasync function ensureStorageDir() {\n  try {\n    await fs.mkdir(STORAGE_DIR, { recursive: true })\n  } catch (error) {\n    // 目錄已存在或其他錯誤，繼續執行\n  }\n}\n\n// 從檔案讀取所有頁面\nasync function loadPagesFromFile(): Promise<{ [pageId: string]: GrapesJSPage }> {\n  try {\n    await ensureStorageDir()\n    const data = await fs.readFile(PAGES_FILE, 'utf-8')\n    return JSON.parse(data)\n  } catch (error) {\n    // 檔案不存在或讀取錯誤，返回空物件\n    return {}\n  }\n}\n\n// 儲存頁面到檔案\nasync function savePagesToFile(pages: { [pageId: string]: GrapesJSPage }) {\n  try {\n    await ensureStorageDir()\n    await fs.writeFile(PAGES_FILE, JSON.stringify(pages, null, 2), 'utf-8')\n  } catch (error) {\n    console.error('儲存頁面到檔案失敗:', error)\n    throw error\n  }\n}\n\n// GET - 獲取所有頁面或特定頁面\nexport async function GET(request: NextRequest) {\n  try {\n    const { searchParams } = new URL(request.url)\n    const pageId = searchParams.get('id')\n    \n    const pages = await loadPagesFromFile()\n    \n    if (pageId) {\n      // 獲取特定頁面\n      const page = pages[pageId]\n      if (!page) {\n        return NextResponse.json(\n          { success: false, message: '頁面不存在' },\n          { status: 404 }\n        )\n      }\n      return NextResponse.json({ success: true, page })\n    } else {\n      // 獲取所有頁面列表\n      const pageList = Object.values(pages).map(page => ({\n        id: page.id,\n        name: page.name,\n        createdAt: page.createdAt,\n        updatedAt: page.updatedAt\n      }))\n      return NextResponse.json({ success: true, pages: pageList })\n    }\n  } catch (error) {\n    console.error('獲取頁面失敗:', error)\n    return NextResponse.json(\n      { success: false, message: '獲取頁面失敗' },\n      { status: 500 }\n    )\n  }\n}\n\n// POST - 創建新頁面或更新現有頁面\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json()\n    const { pageId, name, html, css, components, styles } = body\n    \n    if (!pageId || !name) {\n      return NextResponse.json(\n        { success: false, message: '頁面 ID 和名稱為必填項' },\n        { status: 400 }\n      )\n    }\n    \n    const pages = await loadPagesFromFile()\n    const now = new Date().toISOString()\n    \n    // 檢查是否為更新現有頁面\n    const isUpdate = pages[pageId] !== undefined\n    \n    const pageData: GrapesJSPage = {\n      id: pageId,\n      name,\n      html: html || '',\n      css: css || '',\n      components: components || {},\n      styles: styles || {},\n      createdAt: isUpdate ? pages[pageId].createdAt : now,\n      updatedAt: now\n    }\n    \n    pages[pageId] = pageData\n    await savePagesToFile(pages)\n    \n    return NextResponse.json({\n      success: true,\n      message: isUpdate ? '頁面更新成功' : '頁面創建成功',\n      page: pageData\n    })\n    \n  } catch (error) {\n    console.error('儲存頁面失敗:', error)\n    return NextResponse.json(\n      { success: false, message: '儲存頁面失敗' },\n      { status: 500 }\n    )\n  }\n}\n\n// DELETE - 刪除頁面\nexport async function DELETE(request: NextRequest) {\n  try {\n    const { searchParams } = new URL(request.url)\n    const pageId = searchParams.get('id')\n    \n    if (!pageId) {\n      return NextResponse.json(\n        { success: false, message: '頁面 ID 為必填項' },\n        { status: 400 }\n      )\n    }\n    \n    const pages = await loadPagesFromFile()\n    \n    if (!pages[pageId]) {\n      return NextResponse.json(\n        { success: false, message: '頁面不存在' },\n        { status: 404 }\n      )\n    }\n    \n    delete pages[pageId]\n    await savePagesToFile(pages)\n    \n    return NextResponse.json({\n      success: true,\n      message: '頁面刪除成功'\n    })\n    \n  } catch (error) {\n    console.error('刪除頁面失敗:', error)\n    return NextResponse.json(\n      { success: false, message: '刪除頁面失敗' },\n      { status: 500 }\n    )\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/grapesjs/sanity-sync/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/header-data/route.ts","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":9,"column":40,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":9,"endColumn":42,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[259,261],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":10,"column":40,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":10,"endColumn":42,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[323,325],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":13,"column":49,"nodeType":"MemberExpression","messageId":"unexpected","endLine":13,"endColumn":62}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server'\nimport { getHeaderData } from '@lib/store-name'\n\n// API 路由處理函數\nexport async function GET() {\n  try {\n    const headerData = await getHeaderData()\n    return NextResponse.json({\n      storeName: headerData?.storeName || \"TIMS FANTACY WORLD\",\n      logoWidth: headerData?.logoWidth || 150,\n    })\n  } catch (error) {\n    if (process.env.NODE_ENV === 'development') console.error('API 路由中獲取 header 數據時出錯:', error)\n    return NextResponse.json(\n      { error: 'Failed to fetch header data' },\n      { status: 500 }\n    )\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/health/route.ts","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":9,"column":86,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":9,"endColumn":88,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[257,259],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":39,"column":49,"nodeType":"MemberExpression","messageId":"unexpected","endLine":39,"endColumn":62},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":45,"column":83,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":45,"endColumn":85,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1376,1378],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\"\nimport { MEDUSA_BACKEND_URL } from \"@lib/config\"\n\n/**\n * API 路由處理程序 - 檢查 Medusa 後端連接狀態\n */\nexport async function GET() {\n  try {\n    const baseUrl = MEDUSA_BACKEND_URL || process.env.NEXT_PUBLIC_MEDUSA_BACKEND_URL || \"http://localhost:9000\"\n    \n    // 檢查 Medusa 後端是否可訪問\n    const response = await fetch(`${baseUrl}/health`, {\n      method: \"GET\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n      cache: \"no-store\",\n    })\n    \n    if (!response.ok) {\n      return NextResponse.json({\n        status: \"error\",\n        message: \"Medusa backend is not responding correctly\",\n        medusaStatus: response.status,\n        medusaUrl: baseUrl\n      }, { status: 500 })\n    }\n    \n    const data = await response.json()\n    \n    return NextResponse.json({\n      status: \"success\",\n      message: \"Connected to Medusa backend\",\n      medusaStatus: response.status,\n      medusaHealth: data,\n      medusaUrl: baseUrl\n    })\n  } catch (error) {\n    if (process.env.NODE_ENV === 'development') console.error(\"Error checking Medusa backend:\", error)\n    \n    return NextResponse.json({\n      status: \"error\",\n      message: \"Failed to connect to Medusa backend\",\n      error: error instanceof Error ? error.message : \"Unknown error\",\n      medusaUrl: MEDUSA_BACKEND_URL || process.env.NEXT_PUBLIC_MEDUSA_BACKEND_URL || \"http://localhost:9000\"\n    }, { status: 500 })\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/inventory/route.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":21,"column":49,"nodeType":"MemberExpression","messageId":"unexpected","endLine":21,"endColumn":62}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\n\nexport async function GET(request: NextRequest) {\n  const { searchParams } = new URL(request.url)\n  const variantId = searchParams.get('variant_id')\n  \n  if (!variantId) {\n    return NextResponse.json({ error: 'Variant ID is required' }, { status: 400 })\n  }\n\n  try {\n    // TODO: 實作實際的庫存檢查\n    // 目前返回基本的庫存資訊，表示商品可用\n    \n    return NextResponse.json({\n      available_quantity: 0, // TODO: 從 Medusa Admin API 獲取實際庫存\n      reserved_quantity: 0,\n      stocked_quantity: 0\n    })\n  } catch (error) {\n    if (process.env.NODE_ENV === 'development') console.error('Error fetching inventory:', error)\n    return NextResponse.json({ error: 'Failed to fetch inventory' }, { status: 500 })\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/medusa-proxy/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/medusa/[...slug]/route.ts","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":7,"column":48,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":7,"endColumn":50,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[267,269],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":22,"column":44,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":22,"endColumn":46,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[750,752],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":26,"column":16,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":26,"endColumn":18,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[918,920],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"sonarjs/prefer-immediate-return","severity":2,"message":"Immediately return this expression instead of assigning it to the temporary variable \"safe\".","line":42,"column":16,"nodeType":"CallExpression","messageId":"doImmediateAction","endLine":45,"endColumn":31,"fix":{"range":[1349,1481],"text":"return segments\n    .filter((s) => !!s && s !== '.' && s !== '..')\n    .join('/')\n    .replace(/^\\/+|\\/+$/g, '')"}},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":50,"column":57,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":50,"endColumn":59,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1589,1591],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"sonarjs/prefer-immediate-return","severity":2,"message":"Immediately return this expression instead of assigning it to the temporary variable \"res\".","line":92,"column":17,"nodeType":"CallExpression","messageId":"doImmediateAction","endLine":92,"endColumn":95,"fix":{"range":[3193,3298],"text":"return NextResponse.json(body, { status: resp.status, headers: corsHeaders(origin) })"}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":94,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":94,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3313,3316],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3313,3316],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":95,"column":49,"nodeType":"MemberExpression","messageId":"unexpected","endLine":95,"endColumn":62}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":2,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\nimport { getPublishableKeyForBackend } from '@lib/medusa-publishable-key'\n\ntype RouteCtx = { params: { slug: string[] } }\n\nfunction getAllowedOrigins(): string[] {\n  const env = process.env.ALLOWED_CORS_ORIGINS || ''\n  const defaults = [\n    process.env.NEXT_PUBLIC_APP_URL,\n    process.env.NEXT_PUBLIC_VERCEL_URL && `https://${process.env.NEXT_PUBLIC_VERCEL_URL}`,\n    'http://localhost:8000',\n    'http://localhost:3000',\n  ].filter(Boolean) as string[]\n  const extra = env\n    .split(',')\n    .map((s) => s.trim())\n    .filter(Boolean)\n  return Array.from(new Set([...defaults, ...extra]))\n}\n\nfunction pickOrigin(req: NextRequest): string | null {\n  const origin = req.headers.get('origin') || req.headers.get('referer')\n  if (!origin) return null\n  const allowed = getAllowedOrigins()\n  const found = allowed.find((o) => origin.startsWith(o))\n  return found || null\n}\n\nfunction corsHeaders(origin: string | null) {\n  return origin\n    ? {\n        'Access-Control-Allow-Origin': origin,\n        Vary: 'Origin',\n        'Access-Control-Allow-Methods': 'GET, POST, DELETE, OPTIONS',\n        'Access-Control-Allow-Headers': 'Content-Type, Authorization, x-publishable-api-key',\n        'Access-Control-Max-Age': '600',\n      }\n    : {}\n}\n\nfunction sanitizePath(segments: string[]): string {\n  const safe = segments\n    .filter((s) => !!s && s !== '.' && s !== '..')\n    .join('/')\n    .replace(/^\\/+|\\/+$/g, '')\n  return safe\n}\n\nfunction isAllowedPath(path: string): boolean {\n  const env = process.env.MEDUSA_PROXY_ALLOWED_PREFIXES || ''\n  const defaults = ['store/', 'auth/', 'products/', 'collections/', 'variants/', 'inventory/', 'regions/']\n  const prefixes = (env ? env.split(',') : defaults).map((p) => p.trim()).filter(Boolean)\n  return prefixes.some((p) => path.startsWith(p))\n}\n\nasync function proxyFetch(method: 'GET' | 'POST' | 'DELETE', req: NextRequest, pathSegments: string[]) {\n  const origin = pickOrigin(req)\n  const path = sanitizePath(pathSegments)\n  if (!isAllowedPath(path)) {\n    return NextResponse.json({ error: 'Forbidden path' }, { status: 403, headers: corsHeaders(origin) })\n  }\n\n  const backend = process.env.NEXT_PUBLIC_MEDUSA_BACKEND_URL\n  if (!backend) {\n    return NextResponse.json({ error: 'Medusa backend not configured' }, { status: 500, headers: corsHeaders(origin) })\n  }\n\n  const url = new URL(`${backend.replace(/\\/$/, '')}/${path}`)\n  if (method === 'GET') {\n    req.nextUrl.searchParams.forEach((v, k) => url.searchParams.set(k, v))\n  }\n\n  const headers: Record<string, string> = {\n    'Content-Type': 'application/json',\n    'x-publishable-api-key': getPublishableKeyForBackend(backend),\n  }\n\n  // 可選：將 Authorization 轉發（若有需要保留會話語義）\n  const auth = req.headers.get('authorization')\n  if (auth) headers['authorization'] = auth\n\n  const init: RequestInit = { method, headers }\n  if (method === 'POST') {\n    init.body = await req.text()\n  }\n\n  try {\n    const resp = await fetch(url.toString(), init)\n    const text = await resp.text()\n    const isJson = resp.headers.get('content-type')?.includes('application/json')\n    const body = isJson ? (text ? JSON.parse(text) : {}) : { data: text }\n    const res = NextResponse.json(body, { status: resp.status, headers: corsHeaders(origin) })\n    return res\n  } catch (e: any) {\n    if (process.env.NODE_ENV === 'development') console.error('Medusa proxy error:', e)\n    return NextResponse.json({ error: 'Upstream fetch failed' }, { status: 502, headers: corsHeaders(origin) })\n  }\n}\n\n// Handlers\nexport async function GET(request: NextRequest, ctx: RouteCtx) {\n  return proxyFetch('GET', request, ctx.params.slug)\n}\n\nexport async function POST(request: NextRequest, ctx: RouteCtx) {\n  return proxyFetch('POST', request, ctx.params.slug)\n}\n\nexport async function DELETE(request: NextRequest, ctx: RouteCtx) {\n  return proxyFetch('DELETE', request, ctx.params.slug)\n}\n\nexport async function OPTIONS(request: NextRequest) {\n  const origin = pickOrigin(request)\n  return new NextResponse(null, { status: 204, headers: corsHeaders(origin) })\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/orders/[id]/route.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":11,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":11,"endColumn":16,"suggestions":[{"fix":{"range":[250,287],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":21,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":21,"endColumn":16,"suggestions":[{"fix":{"range":[466,510],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[569,572],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[569,572],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":24,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":24,"endColumn":18,"suggestions":[{"fix":{"range":[580,623],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":26,"column":30,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":26,"endColumn":32,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[683,685],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { retrieveOrder } from \"../../../../lib/data/orders\"\nimport { NextRequest, NextResponse } from \"next/server\"\n\nexport async function GET(\n  request: NextRequest,\n  { params }: { params: { id: string } }\n) {\n  const { id } = params\n\n  try {\n    console.log(\"🔍 API route: 獲取訂單\", id)\n    const order = await retrieveOrder(id)\n    \n    if (!order) {\n      return NextResponse.json(\n        { error: \"Order not found\" },\n        { status: 404 }\n      )\n    }\n\n    console.log(\"✅ API route: 訂單獲取成功\", order.id)\n    return NextResponse.json({ order })\n  } catch (error: any) {\n    console.error(\"❌ API route: 訂單獲取失敗\", error)\n    return NextResponse.json(\n      { error: error.message || \"Failed to retrieve order\" },\n      { status: 500 }\n    )\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/orders/by-merchant-trade-no/[merchantTradeNo]/route.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":30,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":30,"endColumn":18,"suggestions":[{"fix":{"range":[798,843],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\"\n\nexport async function GET(\n  request: Request,\n  { params }: { params: { merchantTradeNo: string } }\n) {\n  const { merchantTradeNo } = params\n\n  try {\n    // 調用後端 API 查詢訂單\n    const response = await fetch(\n      `${process.env.NEXT_PUBLIC_MEDUSA_BACKEND_URL}/store/orders/by-merchant-trade-no/${merchantTradeNo}`,\n      {\n        headers: {\n          \"x-publishable-api-key\": (await import('@lib/medusa-publishable-key')).getPublishableKeyForBackend(process.env.NEXT_PUBLIC_MEDUSA_BACKEND_URL),\n        },\n      }\n    )\n\n    if (!response.ok) {\n      return NextResponse.json(\n        { error: \"Order not found\" },\n        { status: 404 }\n      )\n    }\n\n    const order = await response.json()\n    return NextResponse.json(order)\n  } catch (error) {\n    console.error(\"Error fetching order:\", error)\n    return NextResponse.json(\n      { error: \"Failed to fetch order\" },\n      { status: 500 }\n    )\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/pages/[slug]/route.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":33,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":33,"endColumn":18,"suggestions":[{"fix":{"range":[806,837],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\nimport { grapesJSPageService } from '@/lib/services/grapesjs-page-service'\n\nexport async function GET(\n  request: NextRequest,\n  { params }: { params: { slug: string } }\n) {\n  try {\n    const { slug } = params\n    const searchParams = request.nextUrl.searchParams\n    const preview = searchParams.get('preview') === 'true'\n    \n    // 獲取頁面數據\n    const page = await grapesJSPageService.getPageBySlug(slug)\n    \n    if (!page) {\n      return NextResponse.json(\n        { error: '頁面不存在' },\n        { status: 404 }\n      )\n    }\n\n    // 檢查頁面狀態\n    if (!preview && page.status !== 'published') {\n      return NextResponse.json(\n        { error: '頁面尚未發布' },\n        { status: 404 }\n      )\n    }\n\n    return NextResponse.json(page)\n  } catch (error) {\n    console.error('API 錯誤:', error)\n    return NextResponse.json(\n      { error: '伺服器錯誤' },\n      { status: 500 }\n    )\n  }\n}","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/pages/delete/route.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":15,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":15,"endColumn":16,"suggestions":[{"fix":{"range":[347,377],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":20,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":20,"endColumn":16,"suggestions":[{"fix":{"range":[452,481],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":29,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":29,"endColumn":18,"suggestions":[{"fix":{"range":[616,656],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":56,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":56,"endColumn":16,"suggestions":[{"fix":{"range":[1222,1251],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":65,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":65,"endColumn":18,"suggestions":[{"fix":{"range":[1386,1426],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\nimport { client } from '@/sanity-client'\n\nexport async function POST(request: NextRequest) {\n  try {\n    const { pageId } = await request.json()\n\n    if (!pageId) {\n      return NextResponse.json(\n        { success: false, error: '缺少 pageId 參數' },\n        { status: 400 }\n      )\n    }\n\n    console.log('正在刪除頁面:', pageId)\n\n    // 從 Sanity 刪除頁面\n    const result = await client.delete(pageId)\n\n    console.log('頁面已刪除:', result)\n\n    return NextResponse.json({\n      success: true,\n      message: '頁面刪除成功',\n      deletedId: pageId\n    })\n\n  } catch (error) {\n    console.error('從 Sanity 刪除頁面失敗:', error)\n    return NextResponse.json(\n      { \n        success: false, \n        error: error instanceof Error ? error.message : '刪除失敗' \n      },\n      { status: 500 }\n    )\n  }\n}\n\n// 保持向後兼容的 DELETE 方法\nexport async function DELETE(request: NextRequest) {\n  try {\n    const { searchParams } = new URL(request.url)\n    const pageId = searchParams.get('pageId')\n\n    if (!pageId) {\n      return NextResponse.json(\n        { success: false, error: '缺少 pageId 參數' },\n        { status: 400 }\n      )\n    }\n\n    // 從 Sanity 刪除頁面\n    const result = await client.delete(pageId)\n\n    console.log('頁面已刪除:', result)\n\n    return NextResponse.json({\n      success: true,\n      message: '頁面刪除成功',\n      deletedId: pageId\n    })\n\n  } catch (error) {\n    console.error('從 Sanity 刪除頁面失敗:', error)\n    return NextResponse.json(\n      { \n        success: false, \n        error: error instanceof Error ? error.message : '刪除失敗' \n      },\n      { status: 500 }\n    )\n  }\n}","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/pages/list/route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'request' is defined but never used.","line":4,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":34},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'request' is defined but never used. Allowed unused args must match /^_/u.","line":4,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":34},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":20,"column":20,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":20,"endColumn":22,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[471,473],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":25,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":25,"endColumn":18,"suggestions":[{"fix":{"range":[536,578],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\nimport { client } from '@/sanity-client'\n\nexport async function GET(request: NextRequest) {\n  try {\n    // 從 Sanity 查詢所有 GrapesJS 頁面\n    const pages = await client.fetch(\n      `*[_type == \"grapesJSPageV2\"] | order(updatedAt desc) {\n        _id,\n        title,\n        slug,\n        status,\n        createdAt,\n        updatedAt\n      }`\n    )\n\n    return NextResponse.json({\n      success: true,\n      pages: pages || [],\n      message: '頁面列表載入成功'\n    })\n\n  } catch (error) {\n    console.error('從 Sanity 載入頁面列表失敗:', error)\n    return NextResponse.json(\n      { \n        success: false, \n        error: error instanceof Error ? error.message : '載入失敗' \n      },\n      { status: 500 }\n    )\n  }\n}","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/pages/load/route.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":19,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":19,"endColumn":16,"suggestions":[{"fix":{"range":[498,569],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":72,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":72,"endColumn":18,"suggestions":[{"fix":{"range":[1670,1710],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\nimport { client } from '@/sanity-client'\n\nexport async function GET(request: NextRequest) {\n  try {\n    const { searchParams } = new URL(request.url)\n    const pageId = searchParams.get('pageId')\n\n    if (!pageId) {\n      return NextResponse.json(\n        { success: false, error: '缺少 pageId 參數' },\n        { status: 400 }\n      )\n    }\n\n    // 將 pageId 轉換為 slug 格式（如果需要）\n    const slug = pageId.toLowerCase().replace(/[^a-z0-9]/g, '-')\n\n    console.log('載入頁面查詢:', { originalPageId: pageId, processedSlug: slug })\n\n    // 從 Sanity 查詢頁面 - 嘗試多種查詢方式\n    let page = await client.fetch(\n      `*[_type == \"grapesJSPageV2\" && slug.current == $slug][0] {\n        _id,\n        title,\n        slug,\n        status,\n        grapesHtml,\n        grapesCss,\n        grapesComponents,\n        grapesStyles,\n        createdAt,\n        updatedAt\n      }`,\n      { slug: pageId } // 先嘗試原始 pageId\n    )\n\n    // 如果沒找到，嘗試處理後的 slug\n    if (!page && pageId !== slug) {\n      page = await client.fetch(\n        `*[_type == \"grapesJSPageV2\" && slug.current == $slug][0] {\n          _id,\n          title,\n          slug,\n          status,\n          grapesHtml,\n          grapesCss,\n          grapesComponents,\n          grapesStyles,\n          createdAt,\n          updatedAt\n        }`,\n        { slug }\n      )\n    }\n\n    if (!page) {\n      return NextResponse.json({\n        success: false,\n        error: '頁面不存在',\n        message: `找不到 pageId: ${pageId} (slug: ${slug}) 對應的頁面`\n      }, { status: 404 })\n    }\n\n    return NextResponse.json({\n      success: true,\n      page: page,\n      message: '頁面載入成功'\n    })\n\n  } catch (error) {\n    console.error('從 Sanity 載入頁面失敗:', error)\n    return NextResponse.json(\n      { \n        success: false, \n        error: error instanceof Error ? error.message : '載入失敗' \n      },\n      { status: 500 }\n    )\n  }\n}","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/pages/save/route.ts","messages":[{"ruleId":"sonarjs/cognitive-complexity","severity":2,"message":"Refactor this function to reduce its Cognitive Complexity from 27 to the 15 allowed.","line":4,"column":23,"nodeType":null,"messageId":"refactorFunction","endLine":4,"endColumn":27},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":15,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[421,424],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[421,424],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":19,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":19,"endColumn":16,"suggestions":[{"fix":{"range":[480,679],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":23,"column":75,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":23,"endColumn":77,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[635,637],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":29,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":29,"endColumn":20,"suggestions":[{"fix":{"range":[723,752],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":37,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":37,"endColumn":20,"suggestions":[{"fix":{"range":[900,930],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":46,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":46,"endColumn":20,"suggestions":[{"fix":{"range":[1133,1167],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":54,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":54,"endColumn":20,"suggestions":[{"fix":{"range":[1349,1382],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":76,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":76,"endColumn":20,"suggestions":[{"fix":{"range":[1933,1978],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":88,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":88,"endColumn":20,"suggestions":[{"fix":{"range":[2270,2299],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":92,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":92,"endColumn":16,"suggestions":[{"fix":{"range":[2330,2410],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":95,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":95,"endColumn":20,"suggestions":[{"fix":{"range":[2443,2494],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":109,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":109,"endColumn":20,"suggestions":[{"fix":{"range":[2786,2844],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":122,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":122,"endColumn":20,"suggestions":[{"fix":{"range":[3226,3262],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":129,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":129,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3422,3425],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3422,3425],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":132,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":132,"endColumn":22,"suggestions":[{"fix":{"range":[3490,3560],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":142,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":142,"endColumn":22,"suggestions":[{"fix":{"range":[3826,3861],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":149,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":149,"endColumn":18,"suggestions":[{"fix":{"range":[3973,4027],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":161,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":161,"endColumn":18,"suggestions":[{"fix":{"range":[4265,4305],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":17,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\nimport { client } from '@/sanity-client'\n\nexport async function POST(request: NextRequest) {\n  try {\n    // 設定請求超時處理\n    const requestTimeout = new Promise((_, reject) => \n      setTimeout(() => reject(new Error('請求超時，請稍後再試')), 30000)\n    )\n    \n    // 解析請求內容，加上超時處理\n    const requestData = await Promise.race([\n      request.json(),\n      requestTimeout\n    ]) as any\n    \n    const { pageId, pageData } = requestData\n\n    console.log('收到保存請求:', { \n      pageId, \n      pageData: { \n        ...pageData,\n        grapesHtml: pageData?.grapesHtml ? `[${pageData.grapesHtml.length || 0} chars]` : 'undefined' \n      } \n    })\n\n    // 詳細的輸入驗證\n    if (!pageData) {\n      console.error('保存失敗: 缺少頁面數據')\n      return NextResponse.json(\n        { success: false, error: '缺少頁面數據' },\n        { status: 400 }\n      )\n    }\n\n    if (!pageData._id) {\n      console.error('保存失敗: 缺少頁面 ID')\n      return NextResponse.json(\n        { success: false, error: '缺少頁面 ID' },\n        { status: 400 }\n      )\n    }\n\n    // 驗證 HTML 和 CSS 數據是否有效\n    if (typeof pageData.grapesHtml !== 'string') {\n      console.error('保存失敗: HTML 內容格式無效')\n      return NextResponse.json(\n        { success: false, error: 'HTML 內容格式無效' },\n        { status: 400 }\n      )\n    }\n    \n    if (typeof pageData.grapesCss !== 'string') {\n      console.error('保存失敗: CSS 內容格式無效')\n      return NextResponse.json(\n        { success: false, error: 'CSS 內容格式無效' },\n        { status: 400 }\n      )\n    }\n\n    // 檢查 JSON 數據是否有效\n    try {\n      if (pageData.grapesComponents) {\n        // 確保是有效的 JSON\n        if (typeof pageData.grapesComponents === 'string') {\n          JSON.parse(pageData.grapesComponents)\n        }\n      }\n      if (pageData.grapesStyles) {\n        // 確保是有效的 JSON\n        if (typeof pageData.grapesStyles === 'string') {\n          JSON.parse(pageData.grapesStyles)\n        }\n      }\n    } catch (jsonError) {\n      console.error('保存失敗: 組件或樣式數據格式無效', jsonError)\n      return NextResponse.json(\n        { success: false, error: '組件或樣式數據格式無效' },\n        { status: 400 }\n      )\n    }\n\n    // 驗證頁面是否存在\n    const existingPage = await client.fetch(\n      `*[_type == \"grapesJSPageV2\" && _id == $id][0]`,\n      { id: pageData._id }\n    ).catch(err => {\n      console.error('查詢頁面失敗:', err)\n      return null\n    })\n\n    console.log('查找現有頁面結果:', existingPage ? `找到頁面: ${existingPage._id}` : '未找到現有頁面')\n\n    if (!existingPage) {\n      console.error(`保存失敗: 找不到 ID 為 ${pageData._id} 的頁面`)\n      return NextResponse.json(\n        { success: false, error: `找不到 ID 為 ${pageData._id} 的頁面` },\n        { status: 404 }\n      )\n    }\n\n    // 嘗試更新頁面，使用重試邏輯\n    const maxRetries = 3\n    let retryCount = 0\n    let lastError = null\n\n    while (retryCount < maxRetries) {\n      try {\n        console.log(`嘗試更新頁面 (嘗試 ${retryCount + 1}/${maxRetries})`)\n        \n        const result = await client\n          .patch(existingPage._id)\n          .set({\n            grapesHtml: pageData.grapesHtml,\n            grapesCss: pageData.grapesCss,\n            grapesComponents: pageData.grapesComponents,\n            grapesStyles: pageData.grapesStyles,\n            updatedAt: new Date().toISOString()\n          })\n          .commit()\n\n        console.log('頁面已成功更新:', result?._id)\n        \n        return NextResponse.json({\n          success: true,\n          data: result,\n          message: '頁面已更新'\n        })\n      } catch (updateError: any) {\n        lastError = updateError\n        retryCount++\n        console.error(`更新頁面失敗 (嘗試 ${retryCount}/${maxRetries}):`, updateError)\n        \n        // 如果是權限錯誤，立即失敗不重試\n        if (updateError.message?.includes('permission')) {\n          break\n        }\n        \n        // 增加延遲時間，使用指數退避策略\n        if (retryCount < maxRetries) {\n          const delay = 1000 * Math.pow(2, retryCount - 1)\n          console.log(`等待 ${delay}ms 後重試...`)\n          await new Promise(resolve => setTimeout(resolve, delay))\n        }\n      }\n    }\n\n    // 所有重試都失敗\n    console.error('保存頁面到 Sanity 失敗，已達到最大重試次數:', lastError)\n    return NextResponse.json(\n      { \n        success: false, \n        error: lastError instanceof Error \n          ? `保存失敗 (${lastError.message})` \n          : '保存失敗，請稍後再試'\n      },\n      { status: 500 }\n    )\n\n  } catch (error) {\n    console.error('保存頁面到 Sanity 失敗:', error)\n    return NextResponse.json(\n      { \n        success: false, \n        error: error instanceof Error \n          ? `保存處理錯誤: ${error.message}` \n          : '保存處理發生未知錯誤' \n      },\n      { status: 500 }\n    )\n  }\n}","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/pages/update-settings/route.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":15,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":15,"endColumn":16,"suggestions":[{"fix":{"range":[364,408],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":31,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":31,"endColumn":16,"suggestions":[{"fix":{"range":[713,744],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":40,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":40,"endColumn":18,"suggestions":[{"fix":{"range":[875,908],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\nimport { client } from '@/sanity-client'\n\nexport async function POST(request: NextRequest) {\n  try {\n    const { pageId, settings } = await request.json()\n\n    if (!pageId || !settings) {\n      return NextResponse.json(\n        { success: false, error: '缺少必要參數' },\n        { status: 400 }\n      )\n    }\n\n    console.log('更新頁面設定:', { pageId, settings })\n\n    // 更新頁面設定\n    const result = await client\n      .patch(pageId)\n      .set({\n        title: settings.title,\n        slug: {\n          _type: 'slug',\n          current: settings.slug\n        },\n        status: settings.status,\n        updatedAt: new Date().toISOString()\n      })\n      .commit()\n\n    console.log('頁面設定已更新:', result)\n\n    return NextResponse.json({\n      success: true,\n      data: result,\n      message: '頁面設定已更新'\n    })\n\n  } catch (error) {\n    console.error('更新頁面設定失敗:', error)\n    return NextResponse.json(\n      { \n        success: false, \n        error: error instanceof Error ? error.message : '更新失敗' \n      },\n      { status: 500 }\n    )\n  }\n}","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/posts/route.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":43,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":43,"endColumn":18,"suggestions":[{"fix":{"range":[1038,1070],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import client from \"@lib/sanity\"\nimport { NextRequest, NextResponse } from \"next/server\"\n\nexport async function GET(request: NextRequest) {\n  const searchParams = request.nextUrl.searchParams\n  const categoryId = searchParams.get('category')\n\n  try {\n    const query = categoryId\n      ? `*[_type == \"post\" && $categoryId in categories[]->_id] | order(publishedAt desc) {\n          _id,\n          title,\n          \"slug\": slug.current,\n          publishedAt,\n          mainImage {\n            asset->{\n              url\n            }\n          },\n          categories[]->{\n            title\n          }\n        }`\n      : `*[_type == \"post\"] | order(publishedAt desc) {\n          _id,\n          title,\n          \"slug\": slug.current,\n          publishedAt,\n          mainImage {\n            asset->{\n              url\n            }\n          },\n          categories[]->{\n            title\n          }\n        }`\n\n    const posts = await client.fetch(query, { categoryId })\n    \n    return NextResponse.json(posts)\n  } catch (error) {\n    console.error('獲取文章時出錯:', error)\n    return NextResponse.json({ error: '獲取文章時出錯' }, { status: 500 })\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/preview/[id]/route.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":23,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":23,"endColumn":18,"suggestions":[{"fix":{"range":[526,560],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":47,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":47,"endColumn":18,"suggestions":[{"fix":{"range":[1010,1046],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\nimport { grapesJSPageService } from '@/lib/services/grapesjs-page-service'\n\nexport async function GET(\n  request: NextRequest,\n  { params }: { params: { id: string } }\n) {\n  try {\n    const { id } = params\n    \n    // 獲取頁面數據（包含草稿）\n    const page = await grapesJSPageService.getPageById(id)\n    \n    if (!page) {\n      return NextResponse.json(\n        { error: '頁面不存在' },\n        { status: 404 }\n      )\n    }\n\n    return NextResponse.json(page)\n  } catch (error) {\n    console.error('預覽 API 錯誤:', error)\n    return NextResponse.json(\n      { error: '伺服器錯誤' },\n      { status: 500 }\n    )\n  }\n}\n\nexport async function POST(\n  request: NextRequest,\n  { params }: { params: { id: string } }\n) {\n  try {\n    const { id } = params\n    const body = await request.json()\n    \n    // 更新頁面內容\n    const updatedPage = await grapesJSPageService.updatePage({\n      _id: id,\n      ...body\n    })\n    \n    return NextResponse.json(updatedPage)\n  } catch (error) {\n    console.error('更新預覽 API 錯誤:', error)\n    return NextResponse.json(\n      { error: '更新失敗' },\n      { status: 500 }\n    )\n  }\n}","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/products/promotions/route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":27,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[694,697],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[694,697],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":30,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[789,792],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[789,792],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":34,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[940,943],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[940,943],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"sonarjs/prefer-single-boolean-return","severity":2,"message":"Replace this if-then-else flow by a single return statement.","line":36,"column":9,"nodeType":"IfStatement","messageId":"replaceIfThenElseByReturn","endLine":38,"endColumn":10,"suggestions":[{"messageId":"suggestCast","fix":{"range":[978,1129],"text":"return !!(rule.attribute === 'product.id' && rule.values?.includes(productId));"},"desc":"Replace with single return statement using \"!!\" cast"},{"messageId":"suggestBoolean","fix":{"range":[978,1129],"text":"return rule.attribute === 'product.id' && rule.values?.includes(productId);"},"desc":"Replace with single return statement without cast (condition should be boolean!)"}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":45,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1234,1237],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1234,1237],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":62,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":62,"endColumn":18,"suggestions":[{"fix":{"range":[1754,1812],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":132,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":132,"endColumn":18,"suggestions":[{"fix":{"range":[3597,3656],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { sdk } from \"@lib/config\"\nimport { NextRequest, NextResponse } from \"next/server\"\n\n/**\n * 獲取商品的促銷資訊\n * GET /api/products/promotions?productId=xxx\n */\nexport async function GET(request: NextRequest) {\n  try {\n    const { searchParams } = new URL(request.url)\n    const productId = searchParams.get('productId')\n    \n    if (!productId) {\n      return NextResponse.json(\n        { error: \"Product ID is required\" },\n        { status: 400 }\n      )\n    }\n\n    // 獲取所有可用的促銷活動\n    // const promotionsResponse = await sdk.store.promotion.list({\n    //   is_automatic: true,\n    //   // 可以添加其他篩選條件\n    // })\n\n    // const promotions = promotionsResponse.promotions || []\n    const promotions: any[] = []\n    \n    // 篩選適用於該商品的促銷\n    const productPromotions = promotions.filter((promotion: any) => {\n      // 檢查促銷規則是否適用於該商品\n      if (!promotion.rules?.length) return true // 如果沒有特定規則，則適用於所有商品\n      \n      return promotion.rules.some((rule: any) => {\n        // 檢查規則類型和值\n        if (rule.attribute === 'product.id' && rule.values?.includes(productId)) {\n          return true\n        }\n        // 可以添加更多規則檢查邏輯\n        return false\n      })\n    })\n\n    // 格式化促銷資訊以供前端使用\n    const formattedPromotions = productPromotions.map((promotion: any) => ({\n      id: promotion.id,\n      code: promotion.code,\n      type: promotion.application_method?.type, // 'percentage' | 'fixed'\n      value: promotion.application_method?.value,\n      currency_code: promotion.application_method?.currency_code,\n      is_automatic: promotion.is_automatic,\n      starts_at: promotion.starts_at,\n      ends_at: promotion.ends_at,\n    }))\n\n    return NextResponse.json({\n      promotions: formattedPromotions,\n      count: formattedPromotions.length\n    })\n\n  } catch (error) {\n    console.error(\"Error fetching product promotions:\", error)\n    return NextResponse.json(\n      { error: \"Failed to fetch promotions\" },\n      { status: 500 }\n    )\n  }\n}\n\n/**\n * 獲取商品在購物車中的實際折扣資訊\n * POST /api/products/promotions\n */\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json()\n    const { productId, variantId, quantity = 1, regionId } = body\n\n    if (!productId || !variantId) {\n      return NextResponse.json(\n        { error: \"Product ID and Variant ID are required\" },\n        { status: 400 }\n      )\n    }\n\n    // 創建臨時購物車來計算促銷\n    const tempCart = await sdk.store.cart.create({\n      region_id: regionId,\n      items: [{\n        variant_id: variantId,\n        quantity: quantity\n      }]\n    })\n\n    const cart = tempCart.cart\n    const lineItem = cart.items?.[0]\n    \n    if (!lineItem) {\n      return NextResponse.json(\n        { error: \"Failed to add item to cart\" },\n        { status: 400 }\n      )\n    }\n\n    // 計算折扣\n    const originalPrice = lineItem.unit_price\n    const discountedPrice = lineItem.total\n    const totalDiscountAmount = (originalPrice * quantity) - discountedPrice\n    \n    let discountPercentage = 0\n    if (originalPrice > 0 && totalDiscountAmount > 0) {\n      discountPercentage = Math.round((totalDiscountAmount / (originalPrice * quantity)) * 100)\n    }\n\n    // 清理臨時購物車\n    // try {\n    //   await sdk.store.cart.delete(cart.id)\n    // } catch (deleteError) {\n    //   console.warn(\"Failed to delete temporary cart:\", deleteError)\n    // }\n\n    return NextResponse.json({\n      original_price: originalPrice,\n      discounted_price: discountedPrice,\n      discount_amount: totalDiscountAmount,\n      discount_percentage: discountPercentage,\n      has_discount: totalDiscountAmount > 0,\n      promotions: cart.promotions || []\n    })\n\n  } catch (error) {\n    console.error(\"Error calculating product discount:\", error)\n    return NextResponse.json(\n      { error: \"Failed to calculate discount\" },\n      { status: 500 }\n    )\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/products/search/route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":24,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[420,423],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[420,423],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":50,"column":34,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":50,"endColumn":152},{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":54,"column":9,"nodeType":null,"messageId":"preferOptionalChain","endLine":54,"endColumn":86,"fix":{"range":[1197,1274],"text":"defaultRegionResponse?.regions?.length === 0"}},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":72,"column":34,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":72,"endColumn":152},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":80,"column":74,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":80,"endColumn":76,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2481,2483],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":91,"column":43,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":91,"endColumn":45,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2823,2825],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":96,"column":60,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":96,"endColumn":62,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3048,3050],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":100,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":100,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3262,3265],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3262,3265],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":102,"column":73,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":102,"endColumn":75,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3347,3349],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":103,"column":80,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":103,"endColumn":82,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3431,3433],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":125,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":125,"endColumn":18,"suggestions":[{"fix":{"range":[4052,4084],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\nimport { sdk } from \"@lib/config\"\n\ninterface RegionResponse {\n  regions: Array<{\n    id: string\n  }>\n}\n\ninterface Product {\n  id: string\n  title: string\n  handle: string\n  description?: string\n  thumbnail?: string\n  variants?: Array<{\n    id: string\n    title: string\n    prices: Array<{\n      amount: number\n      original_amount?: number\n    }>\n  }>\n  options?: any[]\n}\n\ninterface ProductsResponse {\n  products: Product[]\n}\n\nexport const maxDuration = 10 // 設置函數的最大執行時間為10秒\n\nexport async function GET(request: NextRequest) {\n  const { searchParams } = new URL(request.url)\n  const query = searchParams.get('q')\n  const format = searchParams.get('format') // 'simple' 或默認為完整格式\n  \n  if (!query) {\n    return NextResponse.json(\n      { message: '請輸入搜尋詞', products: [] },\n      { status: 400 }\n    )\n  }\n\n  try {\n    // 獲取預設區域\n    const defaultRegionResponse = await sdk.client.fetch<RegionResponse>(`/store/regions?limit=1`, {\n      method: \"GET\",\n      headers: {\n        \"x-publishable-api-key\": (await import('@lib/medusa-publishable-key')).getPublishableKeyForBackend(process.env.NEXT_PUBLIC_MEDUSA_BACKEND_URL)!,\n      }\n    })\n\n    if (!defaultRegionResponse?.regions || defaultRegionResponse.regions.length === 0) {\n      return NextResponse.json(\n        { message: '無法獲取區域資訊', products: [] },\n        { status: 500 }\n      )\n    }\n\n    const defaultRegion = defaultRegionResponse.regions[0]\n\n    // 獲取所有產品後在前端過濾\n    const productsResponse = await sdk.client.fetch<ProductsResponse>(`/store/products`, {\n      method: \"GET\",\n      query: {\n        limit: 100,  // 獲取更多產品以確保搜索準確性\n        region_id: defaultRegion.id,\n        fields: \"handle,id,title,thumbnail,variants,options,metadata,variants.title,variants.prices.amount,variants.prices.original_amount,variants.manage_inventory,variants.allow_backorder,variants.inventory_quantity,description,images,collection_id,created_at,updated_at,type_id,status,weight,length,height,width,material,hs_code,origin_country,mid_code\",\n      },\n      headers: {\n        \"x-publishable-api-key\": (await import('@lib/medusa-publishable-key')).getPublishableKeyForBackend(process.env.NEXT_PUBLIC_MEDUSA_BACKEND_URL)!,\n      }\n    })\n\n    // 在前端進行搜索過濾\n    const filteredProducts = productsResponse.products.filter(product => {\n      return (\n        product.title.toLowerCase().includes(query.toLowerCase()) ||\n        product.description?.toLowerCase().includes(query.toLowerCase()) ||\n        product.variants?.some(variant => \n          variant.title.toLowerCase().includes(query.toLowerCase())\n        )\n      )\n    })\n\n    // 根據 format 參數決定返回格式\n    if (format === 'simple') {\n      // 為搜尋模態框返回簡化格式\n      const formattedProducts = filteredProducts.slice(0, 10).map((product) => {\n        const variants = product.variants || []\n        const lowestPriceVariant = variants.length > 0 ? \n          variants.reduce((lowest, current) => {\n            if (!lowest) return current\n            \n            const lowestPrice = lowest.prices?.[0]?.amount || Number.MAX_SAFE_INTEGER\n            const currentPrice = current.prices?.[0]?.amount || Number.MAX_SAFE_INTEGER\n            \n            return currentPrice < lowestPrice ? current : lowest\n          }, null as any) : null\n\n        const calculatedPrice = lowestPriceVariant?.prices?.[0]?.amount || 0\n        const originalPrice = lowestPriceVariant?.prices?.[0]?.original_amount || 0\n\n        return {\n          id: product.id,\n          title: product.title,\n          handle: product.handle,\n          thumbnail: product.thumbnail,\n          price: {\n            calculated_price: `NT$${calculatedPrice}`,\n            original_price: originalPrice > 0 && originalPrice !== calculatedPrice ? \n              `NT$${originalPrice}` : undefined\n          }\n        }\n      })\n      \n      return NextResponse.json({ products: formattedProducts })\n    } else {\n      // 為搜尋結果頁面返回完整格式（Medusa 標準格式）\n      return NextResponse.json({ products: filteredProducts.slice(0, 24) })\n    }\n\n  } catch (error) {\n    console.error('搜尋商品時出錯:', error)\n    return NextResponse.json(\n      { message: '搜尋商品時出錯', error: (error as Error).message },\n      { status: 500 }\n    )\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/referral/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/regions/route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'request' is defined but never used.","line":4,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":34},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'request' is defined but never used. Allowed unused args must match /^_/u.","line":4,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":34},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":8,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":17},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":8,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":17}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\"\nimport { listRegions } from \"@lib/data/regions\"\n\nexport async function GET(request: NextRequest) {\n  try {\n    const regions = await listRegions()\n    return NextResponse.json({ regions })\n  } catch (error) {\n    return NextResponse.json({ regions: [] }, { status: 500 })\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/render-fragment/mainBanner/route.ts","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":30,"column":36,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":30,"endColumn":38,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[616,618],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":90,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":90,"endColumn":13},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":90,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":90,"endColumn":13}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server'\n\ntype Slide = {\n  heading: string\n  subheading?: string\n  desktopImage?: string\n  desktopImageAlt?: string\n  mobileImage?: string\n  mobileImageAlt?: string\n  buttonText?: string\n  buttonLink?: string\n}\n\ntype Settings = {\n  autoplay?: boolean\n  autoplaySpeed?: number\n  showArrows?: boolean\n  showDots?: boolean\n}\n\ntype Payload = {\n  slides?: Slide[]\n  settings?: Settings\n}\n\nexport async function POST(req: Request) {\n  try {\n    const body = (await req.json()) as Payload\n    const slides = Array.isArray(body.slides) ? body.slides : []\n    const settings = body.settings || {}\n\n    const current = slides[0] || ({ heading: '', subheading: '', desktopImage: '', mobileImage: '' } as Slide)\n\n    const escapeHtml = (str: string = '') =>\n      String(str)\n        .replace(/&/g, '&amp;')\n        .replace(/</g, '&lt;')\n        .replace(/>/g, '&gt;')\n        .replace(/\"/g, '&quot;')\n        .replace(/'/g, '&#039;')\n\n    // 優先使用桌面版圖片，如果沒有則使用預設背景\n    const bgStyle = current.desktopImage\n      ? `background-image:url(${escapeHtml(current.desktopImage)});`\n      : 'background:linear-gradient(135deg,#3b5bdb 0%,#4263eb 50%,#7048e8 100%);'\n\n    const styles = `\n      .gjs-home-hero {position:relative;width:100%;min-height:420px;display:flex;align-items:stretch;justify-content:center;overflow:hidden;border-radius:18px;color:#fff;box-shadow:inset 0 0 0 1px rgba(255,255,255,0.12);} \n      .gjs-home-hero .module-status {position:absolute;top:16px;left:16px;z-index:3;background:rgba(0,0,0,0.35);padding:6px 12px;border-radius:999px;font-size:11px;letter-spacing:.08em;text-transform:uppercase} \n      .gjs-hero-background {position:absolute;inset:0;background-size:cover;background-position:center;filter:brightness(.85) saturate(1.05);transform:scale(1.01);} \n      .gjs-hero-overlay {position:absolute;inset:0;background:linear-gradient(135deg, rgba(15,23,42,.20), rgba(15,23,42,.45));z-index:1} \n      .gjs-hero-content {position:relative;z-index:2;width:100%;max-width:920px;padding:64px 48px;display:flex;flex-direction:column;gap:16px;align-items:center;justify-content:center;text-align:center} \n      .gjs-hero-eyebrow {display:inline-block;text-transform:uppercase;font-size:12px;letter-spacing:.28em;opacity:.72} \n      .gjs-hero-title {font-size:clamp(36px,6vw,72px);font-weight:600;letter-spacing:-.015em;text-shadow:0 18px 42px rgba(15,23,42,.35);margin:0} \n      .gjs-hero-subtitle {font-size:clamp(16px,2vw,22px);font-weight:300;letter-spacing:.02em;max-width:640px;opacity:.92;margin:0} \n      .gjs-hero-button {display:inline-flex;align-items:center;justify-content:center;padding:14px 32px;border-radius:999px;background:linear-gradient(135deg,#ffd43b,#f76707);color:#1f2a44;font-weight:600;letter-spacing:.08em;text-transform:uppercase;text-decoration:none;box-shadow:0 12px 22px rgba(247,103,7,.35)} \n      .gjs-hero-dots {display:flex;gap:8px;position:absolute;bottom:24px;left:50%;transform:translateX(-50%);z-index:2} \n      .gjs-hero-dot {width:10px;height:10px;border-radius:999px;background:rgba(255,255,255,.35)} \n      .gjs-hero-dot:nth-child(1){background:rgba(255,255,255,.85)} .gjs-hero-dot:nth-child(2){background:rgba(255,255,255,.55)} .gjs-hero-dot:nth-child(3){background:rgba(255,255,255,.25)}\n    `\n\n    const html = `\n      <style>${styles}</style>\n      <div class=\"gjs-home-hero\">\n        <div class=\"module-status\">預覽</div>\n        <div class=\"gjs-hero-background\" style=\"${bgStyle}\"></div>\n        <div class=\"gjs-hero-overlay\"></div>\n        <div class=\"gjs-hero-content\">\n          <span class=\"gjs-hero-eyebrow\">主橫幅</span>\n          <h2 class=\"gjs-hero-title\">${escapeHtml(current.heading || '')}</h2>\n          ${current.subheading ? `<p class=\"gjs-hero-subtitle\">${escapeHtml(current.subheading)}</p>` : ''}\n          ${current.buttonText && current.buttonLink ? `<a class=\"gjs-hero-button\" href=\"${escapeHtml(current.buttonLink)}\" target=\"_blank\">${escapeHtml(current.buttonText)}</a>` : ''}\n        </div>\n        ${settings.showDots !== false ? `\n        <div class=\"gjs-hero-dots\">\n          <span class=\"gjs-hero-dot\"></span>\n          <span class=\"gjs-hero-dot\"></span>\n          <span class=\"gjs-hero-dot\"></span>\n        </div>` : ''}\n      </div>\n    `\n\n    return new NextResponse(html, {\n      status: 200,\n      headers: {\n        'Content-Type': 'text/html; charset=utf-8',\n        'Cache-Control': 'no-store',\n      },\n    })\n  } catch (e) {\n    return new NextResponse('Invalid payload', { status: 400 })\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/sanity-webhook/route.ts","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":34,"column":45,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":34,"endColumn":47,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1004,1006],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":74,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":74,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1945,1948],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1945,1948],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":75,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":75,"endColumn":18,"suggestions":[{"fix":{"range":[1956,1993],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server'\nimport fs from 'fs'\nimport path from 'path'\nimport { createClient } from '@sanity/client'\n\nconst client = createClient({\n  projectId: \"m7o2mv1n\",\n  dataset: \"production\",\n  apiVersion: \"2024-01-01\",\n  useCdn: false,\n})\n\nconst PAGES_PATH = path.join(process.cwd(), 'src/app/[countryCode]/(main)')\n\nasync function generatePages() {\n  const query = `*[_type == \"pages\" && isActive == true]`\n  const pages = await client.fetch(query)\n\n  for (const page of pages) {\n    const slug = page.slug.current\n    const pagePath = path.join(PAGES_PATH, slug)\n    \n    if (!fs.existsSync(pagePath)) {\n      fs.mkdirSync(pagePath, { recursive: true })\n    }\n\n    const pageContent = `import { Metadata } from \"next\"\nimport { getPageBySlug } from \"@lib/sanity\"\nimport PageRenderer from \"@modules/pages/components/page-renderer\"\nimport { notFound } from \"next/navigation\"\n\nexport const metadata: Metadata = {\n  title: \"${page.title}\",\n  description: \"${page.seo?.metaDescription || ''}\"\n}\n\nexport default async function Page(props: {\n  params: Promise<{ countryCode: string }>\n}) {\n  const params = await props.params\n  const pageData = await getPageBySlug(\"${slug}\")\n\n  if (!pageData || !pageData.isActive) {\n    return notFound()\n  }\n\n  return <PageRenderer pageData={pageData} />\n}\n`\n    fs.writeFileSync(path.join(pagePath, 'page.tsx'), pageContent)\n  }\n}\n\nexport async function POST(request: Request) {\n  try {\n    const body = await request.json()\n    \n    // 檢查請求是否來自 Sanity\n    const signature = request.headers.get('sanity-webhook-signature')\n    if (!signature) {\n      return NextResponse.json({ error: '未授權的請求' }, { status: 401 })\n    }\n\n    // 如果是頁面發布事件\n    if (body._type === 'pages') {\n      await generatePages()\n      return NextResponse.json({ \n        message: '頁面已生成',\n        timestamp: new Date().toISOString()\n      })\n    }\n\n    return NextResponse.json({ message: '非頁面發布事件' })\n  } catch (error: any) {\n    console.error('Webhook 處理錯誤:', error)\n    return NextResponse.json({ \n      error: error.message \n    }, { \n      status: 500 \n    })\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/sanity/assets/route.ts","messages":[{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":7,"column":14,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":7,"endColumn":56},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":8,"column":51,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":8,"endColumn":53,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[273,275],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":9,"column":58,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":9,"endColumn":60,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[347,349],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":33,"column":38,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":33,"endColumn":40,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[935,937],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":34,"column":61,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":34,"endColumn":63,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1009,1011],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":35,"column":78,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":35,"endColumn":80,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1107,1109],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":56,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1715,1718],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1715,1718],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":69,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":69,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2053,2056],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2053,2056],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":70,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":70,"endColumn":18,"suggestions":[{"fix":{"range":[2064,2113],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":71,"column":70,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":71,"endColumn":72,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2183,2185],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\nimport { createClient } from '@sanity/client'\n\nexport const runtime = 'nodejs'\n\nconst client = createClient({\n  projectId: process.env.NEXT_PUBLIC_SANITY_PROJECT_ID!,\n  dataset: process.env.NEXT_PUBLIC_SANITY_DATASET || 'production',\n  apiVersion: process.env.NEXT_PUBLIC_SANITY_API_VERSION || '2023-05-30',\n  useCdn: true,\n  perspective: 'published',\n})\n\ntype SortKey = 'newest' | 'oldest' | 'largest' | 'smallest'\n\nfunction getOrder(sort: SortKey): string {\n  switch (sort) {\n    case 'oldest':\n      return '_createdAt asc'\n    case 'largest':\n      return 'coalesce(size, 0) desc, _createdAt desc'\n    case 'smallest':\n      return 'coalesce(size, 0) asc, _createdAt desc'\n    case 'newest':\n    default:\n      return '_createdAt desc'\n  }\n}\n\nexport async function GET(req: NextRequest) {\n  try {\n    const { searchParams } = req.nextUrl\n    const q = (searchParams.get('q') || '').trim()\n    const page = Math.max(parseInt(searchParams.get('page') || '1', 10) || 1, 1)\n    const pageSize = Math.min(Math.max(parseInt(searchParams.get('pageSize') || '24', 10) || 24, 1), 100)\n    const sort = (searchParams.get('sort') as SortKey) || 'newest'\n\n    const offset = (page - 1) * pageSize\n    const end = offset + pageSize + 1 // 多取一筆判斷是否有下一頁\n\n    const order = getOrder(sort)\n\n    const query = `*[_type == \"sanity.imageAsset\" && (${q ? 'originalFilename match $q' : 'true'})]\n      | order(${order})\n      [${offset}...${end}] {\n        _id,\n        _type,\n        url,\n        originalFilename,\n        size,\n        metadata { dimensions { width, height }, format },\n        _createdAt,\n        _updatedAt\n      }`\n\n    const results = await client.fetch<any[]>(query, q ? { q: `${q}*` } : {})\n    const hasMore = results.length > pageSize\n    const items = hasMore ? results.slice(0, pageSize) : results\n\n    return NextResponse.json({\n      success: true,\n      items,\n      page,\n      pageSize,\n      nextPage: hasMore ? page + 1 : undefined,\n      sort,\n      q,\n    })\n  } catch (error: any) {\n    console.error('Sanity assets list error:', error)\n    return NextResponse.json({ success: false, error: error?.message || 'Failed to fetch assets' }, { status: 500 })\n  }\n}\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/sanity/banner/desktop/route.ts","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":9,"column":48,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":9,"endColumn":50,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[260,262],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":11,"column":60,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":11,"endColumn":62,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[417,419],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":42,"column":9,"nodeType":null,"messageId":"preferOptionalChain","endLine":42,"endColumn":44,"fix":{"range":[1252,1287],"text":"!mime?.startsWith('image/')"}},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":82,"column":48,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":82,"endColumn":50,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2357,2359],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":85,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":85,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2451,2454],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2451,2454],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":88,"column":47,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":88,"endColumn":49,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2607,2609],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":88,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":88,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2626,2629],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2626,2629],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":136,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":136,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3673,3676],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3673,3676],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":137,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":137,"endColumn":18,"suggestions":[{"fix":{"range":[3684,3728],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":139,"column":47,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":139,"endColumn":49,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3805,3807],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\nimport { createClient } from '@sanity/client'\n\nexport const runtime = 'nodejs'\n\n// 上傳並更新桌面版 banner 圖片\nexport async function POST(req: NextRequest) {\n  try {\n    const token = process.env.SANITY_API_TOKEN || process.env.SANITY_WRITE_TOKEN\n    const projectId = process.env.NEXT_PUBLIC_SANITY_PROJECT_ID\n    const dataset = process.env.NEXT_PUBLIC_SANITY_DATASET || 'production'\n\n    if (!token || !projectId) {\n      return NextResponse.json({ \n        success: false, \n        error: '缺少必要的配置' \n      }, { status: 500 })\n    }\n\n    const formData = await req.formData()\n    const file = formData.get('file') as File | null\n    const bannerId = formData.get('bannerId') as string\n    const slideIndex = formData.get('slideIndex') as string\n\n    if (!file || !bannerId || slideIndex === null) {\n      return NextResponse.json({ \n        success: false, \n        error: '缺少必要的參數：file, bannerId, slideIndex' \n      }, { status: 400 })\n    }\n\n    // 文件驗證\n    const MAX_SIZE_BYTES = 6 * 1024 * 1024 // 6MB\n    if (file.size > MAX_SIZE_BYTES) {\n      return NextResponse.json({ \n        success: false, \n        error: '文件過大（最大 6MB）' \n      }, { status: 413 })\n    }\n\n    const mime = file.type\n    if (!mime || !mime.startsWith('image/')) {\n      return NextResponse.json({ \n        success: false, \n        error: '只允許上傳圖片文件' \n      }, { status: 415 })\n    }\n\n    const writeClient = createClient({\n      projectId,\n      dataset,\n      apiVersion: '2023-05-30',\n      token,\n      useCdn: false,\n      perspective: 'published',\n    })\n\n    // 1. 上傳圖片到 Sanity\n    const arrayBuffer = await file.arrayBuffer()\n    const buffer = Buffer.from(arrayBuffer)\n    const sanitizedName = file.name.replace(/[^a-zA-Z0-9._-]+/g, '_')\n    \n    const asset = await writeClient.assets.upload('image', buffer, {\n      filename: `desktop-banner-${sanitizedName}`,\n      contentType: mime,\n    })\n\n    // 2. 更新 mainBanner 的指定 slide 的 desktopImage\n    const slideIndexNum = parseInt(slideIndex)\n    \n    // 首先獲取當前的 homePage 文檔\n    const homePage = await writeClient.fetch(`*[_type == \"homePage\"][0]`)\n    \n    if (!homePage) {\n      return NextResponse.json({ \n        success: false, \n        error: '找不到首頁文檔' \n      }, { status: 404 })\n    }\n\n    // 找到對應的 mainBanner 和 slide\n    const mainSections = homePage.mainSections || []\n    let bannerFound = false\n    \n    const updatedSections = mainSections.map((section: any) => {\n      if (section._type === 'mainBanner' && section._key === bannerId) {\n        bannerFound = true\n        const updatedSlides = (section.slides || []).map((slide: any, index: number) => {\n          if (index === slideIndexNum) {\n            return {\n              ...slide,\n              desktopImage: {\n                _type: 'image',\n                asset: {\n                  _type: 'reference',\n                  _ref: asset._id\n                }\n              }\n            }\n          }\n          return slide\n        })\n        \n        return {\n          ...section,\n          slides: updatedSlides\n        }\n      }\n      return section\n    })\n\n    if (!bannerFound) {\n      return NextResponse.json({ \n        success: false, \n        error: '找不到指定的 banner' \n      }, { status: 404 })\n    }\n\n    // 更新文檔\n    const result = await writeClient\n      .patch(homePage._id)\n      .set({ mainSections: updatedSections })\n      .commit()\n\n    return NextResponse.json({\n      success: true,\n      message: '桌面版 banner 圖片上傳並更新成功',\n      asset: {\n        _id: asset._id,\n        url: asset.url,\n        originalFilename: asset.originalFilename,\n      },\n      updatedDocument: result\n    })\n\n  } catch (error: any) {\n    console.error('桌面版 banner 圖片上傳更新錯誤:', error)\n    return NextResponse.json(\n      { success: false, error: error?.message || '操作失敗' },\n      { status: 500 }\n    )\n  }\n}","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/sanity/banner/mobile/route.ts","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":9,"column":48,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":9,"endColumn":50,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[258,260],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":11,"column":60,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":11,"endColumn":62,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[415,417],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":14,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":14,"endColumn":20,"suggestions":[{"fix":{"range":[456,530],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'patchQuery' is assigned a value but never used.","line":44,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":44,"endColumn":21},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'patchQuery' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":44,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":44,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":81,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":81,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2368,2371],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2368,2371],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":82,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":82,"endColumn":18,"suggestions":[{"fix":{"range":[2379,2421],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":84,"column":47,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":84,"endColumn":49,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2498,2500],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":93,"column":48,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":93,"endColumn":50,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2676,2678],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":95,"column":60,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":95,"endColumn":62,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2833,2835],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":126,"column":9,"nodeType":null,"messageId":"preferOptionalChain","endLine":126,"endColumn":44,"fix":{"range":[3668,3703],"text":"!mime?.startsWith('image/')"}},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":166,"column":48,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":166,"endColumn":50,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[4771,4773],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":169,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":169,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4865,4868],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4865,4868],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":172,"column":47,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":172,"endColumn":49,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[5021,5023],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":172,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":172,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5040,5043],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5040,5043],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":220,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":220,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6086,6089],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6086,6089],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":221,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":221,"endColumn":18,"suggestions":[{"fix":{"range":[6097,6141],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":223,"column":47,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":223,"endColumn":49,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[6218,6220],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":11,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\nimport { createClient } from '@sanity/client'\n\nexport const runtime = 'nodejs'\n\n// 更新手機版 banner 圖片\nexport async function PATCH(req: NextRequest) {\n  try {\n    const token = process.env.SANITY_API_TOKEN || process.env.SANITY_WRITE_TOKEN\n    const projectId = process.env.NEXT_PUBLIC_SANITY_PROJECT_ID\n    const dataset = process.env.NEXT_PUBLIC_SANITY_DATASET || 'production'\n\n    if (!token) {\n      console.error('[Sanity Banner Mobile Update] 缺少 server-side Sanity token')\n      return NextResponse.json({ \n        success: false, \n        error: '更新功能需要設定 Sanity API Token' \n      }, { status: 503 })\n    }\n    if (!projectId) {\n      return NextResponse.json({ success: false, error: 'Missing project ID' }, { status: 500 })\n    }\n\n    const body = await req.json()\n    const { bannerId, slideIndex, mobileImageAssetId } = body\n\n    if (!bannerId || slideIndex === undefined || !mobileImageAssetId) {\n      return NextResponse.json({ \n        success: false, \n        error: 'Missing required fields: bannerId, slideIndex, mobileImageAssetId' \n      }, { status: 400 })\n    }\n\n    const writeClient = createClient({\n      projectId,\n      dataset,\n      apiVersion: '2023-05-30',\n      token,\n      useCdn: false,\n      perspective: 'published',\n    })\n\n    // 更新指定 banner 的指定 slide 的手機版圖片\n    const patchQuery = `\n      *[_type == \"homePage\"][0] {\n        ...,\n        \"mainSections\": mainSections[] {\n          _type == \"mainBanner\" && _id == \"${bannerId}\" => {\n            ...,\n            \"slides\": slides[] {\n              _key == @->slides[${slideIndex}]._key => {\n                ...,\n                \"mobileImage\": {\n                  \"_type\": \"image\",\n                  \"asset\": {\n                    \"_type\": \"reference\",\n                    \"_ref\": \"${mobileImageAssetId}\"\n                  }\n                }\n              },\n              _key != @->slides[${slideIndex}]._key => @\n            }\n          },\n          _type != \"mainBanner\" || _id != \"${bannerId}\" => @\n        }\n      }\n    `\n\n    // 使用 patch 操作更新文檔\n    const result = await writeClient\n      .patch('homePage') // 假設首頁文檔的 _id 是 'homePage'\n      .setIfMissing({ mainSections: [] })\n      .commit()\n\n    return NextResponse.json({\n      success: true,\n      message: '手機版 banner 圖片更新成功',\n      result\n    })\n\n  } catch (error: any) {\n    console.error('手機版 banner 圖片更新錯誤:', error)\n    return NextResponse.json(\n      { success: false, error: error?.message || '更新失敗' },\n      { status: 500 }\n    )\n  }\n}\n\n// 上傳並更新手機版 banner 圖片（一步完成）\nexport async function POST(req: NextRequest) {\n  try {\n    const token = process.env.SANITY_API_TOKEN || process.env.SANITY_WRITE_TOKEN\n    const projectId = process.env.NEXT_PUBLIC_SANITY_PROJECT_ID\n    const dataset = process.env.NEXT_PUBLIC_SANITY_DATASET || 'production'\n\n    if (!token || !projectId) {\n      return NextResponse.json({ \n        success: false, \n        error: '缺少必要的配置' \n      }, { status: 500 })\n    }\n\n    const formData = await req.formData()\n    const file = formData.get('file') as File | null\n    const bannerId = formData.get('bannerId') as string\n    const slideIndex = formData.get('slideIndex') as string\n\n    if (!file || !bannerId || slideIndex === null) {\n      return NextResponse.json({ \n        success: false, \n        error: '缺少必要的參數：file, bannerId, slideIndex' \n      }, { status: 400 })\n    }\n\n    // 文件驗證\n    const MAX_SIZE_BYTES = 6 * 1024 * 1024 // 6MB\n    if (file.size > MAX_SIZE_BYTES) {\n      return NextResponse.json({ \n        success: false, \n        error: '文件過大（最大 6MB）' \n      }, { status: 413 })\n    }\n\n    const mime = file.type\n    if (!mime || !mime.startsWith('image/')) {\n      return NextResponse.json({ \n        success: false, \n        error: '只允許上傳圖片文件' \n      }, { status: 415 })\n    }\n\n    const writeClient = createClient({\n      projectId,\n      dataset,\n      apiVersion: '2023-05-30',\n      token,\n      useCdn: false,\n      perspective: 'published',\n    })\n\n    // 1. 上傳圖片到 Sanity\n    const arrayBuffer = await file.arrayBuffer()\n    const buffer = Buffer.from(arrayBuffer)\n    const sanitizedName = file.name.replace(/[^a-zA-Z0-9._-]+/g, '_')\n    \n    const asset = await writeClient.assets.upload('image', buffer, {\n      filename: `mobile-banner-${sanitizedName}`,\n      contentType: mime,\n    })\n\n    // 2. 更新 mainBanner 的指定 slide 的 mobileImage\n    const slideIndexNum = parseInt(slideIndex)\n    \n    // 首先獲取當前的 homePage 文檔\n    const homePage = await writeClient.fetch(`*[_type == \"homePage\"][0]`)\n    \n    if (!homePage) {\n      return NextResponse.json({ \n        success: false, \n        error: '找不到首頁文檔' \n      }, { status: 404 })\n    }\n\n    // 找到對應的 mainBanner 和 slide\n    const mainSections = homePage.mainSections || []\n    let bannerFound = false\n    \n    const updatedSections = mainSections.map((section: any) => {\n      if (section._type === 'mainBanner' && section._key === bannerId) {\n        bannerFound = true\n        const updatedSlides = (section.slides || []).map((slide: any, index: number) => {\n          if (index === slideIndexNum) {\n            return {\n              ...slide,\n              mobileImage: {\n                _type: 'image',\n                asset: {\n                  _type: 'reference',\n                  _ref: asset._id\n                }\n              }\n            }\n          }\n          return slide\n        })\n        \n        return {\n          ...section,\n          slides: updatedSlides\n        }\n      }\n      return section\n    })\n\n    if (!bannerFound) {\n      return NextResponse.json({ \n        success: false, \n        error: '找不到指定的 banner' \n      }, { status: 404 })\n    }\n\n    // 更新文檔\n    const result = await writeClient\n      .patch(homePage._id)\n      .set({ mainSections: updatedSections })\n      .commit()\n\n    return NextResponse.json({\n      success: true,\n      message: '手機版 banner 圖片上傳並更新成功',\n      asset: {\n        _id: asset._id,\n        url: asset.url,\n        originalFilename: asset.originalFilename,\n      },\n      updatedDocument: result\n    })\n\n  } catch (error: any) {\n    console.error('手機版 banner 圖片上傳更新錯誤:', error)\n    return NextResponse.json(\n      { success: false, error: error?.message || '操作失敗' },\n      { status: 500 }\n    )\n  }\n}","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/sanity/banner/test/route.ts","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":10,"column":60,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":10,"endColumn":62,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[322,324],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":56,"column":50,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":56,"endColumn":52,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1496,1498],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":57,"column":74,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":77,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1575,1578],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1575,1578],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":58,"column":40,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":58,"endColumn":42,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1623,1625],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":58,"column":50,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":58,"endColumn":52,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1633,1635],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":61,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":61,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1664,1667],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1664,1667],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":62,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":62,"endColumn":18,"suggestions":[{"fix":{"range":[1675,1714],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":64,"column":47,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":64,"endColumn":49,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1791,1793],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":97,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":97,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2722,2725],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2722,2725],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":98,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":98,"endColumn":18,"suggestions":[{"fix":{"range":[2733,2764],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":100,"column":47,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":100,"endColumn":49,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2841,2843],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\nimport { createClient } from '@sanity/client'\n\nexport const runtime = 'nodejs'\n\n// 獲取首頁的所有 mainBanner 數據\nexport async function GET() {\n  try {\n    const projectId = process.env.NEXT_PUBLIC_SANITY_PROJECT_ID\n    const dataset = process.env.NEXT_PUBLIC_SANITY_DATASET || 'production'\n\n    if (!projectId) {\n      return NextResponse.json({ success: false, error: 'Missing project ID' }, { status: 500 })\n    }\n\n    const readClient = createClient({\n      projectId,\n      dataset,\n      apiVersion: '2023-05-30',\n      useCdn: false,\n      perspective: 'published',\n    })\n\n    // 獲取首頁的所有 mainBanner 數據\n    const homePage = await readClient.fetch(`\n      *[_type == \"homePage\"][0] {\n        _id,\n        title,\n        \"mainBanners\": mainSections[_type == \"mainBanner\"] {\n          _key,\n          _type,\n          isActive,\n          \"slides\": slides[] {\n            _key,\n            heading,\n            subheading,\n            \"desktopImage\": desktopImage.asset->url,\n            \"desktopImageAlt\": desktopImage.alt,\n            \"mobileImage\": mobileImage.asset->url,\n            \"mobileImageAlt\": mobileImage.alt,\n            imageLink\n          },\n          \"settings\": settings {\n            autoplay,\n            autoplaySpeed,\n            showArrows,\n            showDots\n          }\n        }\n      }\n    `)\n\n    return NextResponse.json({\n      success: true,\n      data: homePage,\n      bannerCount: homePage?.mainBanners?.length || 0,\n      totalSlides: homePage?.mainBanners?.reduce((total: number, banner: any) => \n        total + (banner.slides?.length || 0), 0) || 0\n    })\n\n  } catch (error: any) {\n    console.error('獲取 banner 數據錯誤:', error)\n    return NextResponse.json(\n      { success: false, error: error?.message || '獲取失敗' },\n      { status: 500 }\n    )\n  }\n}\n\n// 測試更新特定 banner 的特定 slide\nexport async function POST(req: NextRequest) {\n  try {\n    const body = await req.json()\n    const { action, bannerIndex, slideIndex, imageType } = body\n\n    if (action === 'test-update') {\n      // 這裡只是返回測試信息，不實際更新\n      return NextResponse.json({\n        success: true,\n        message: '測試更新請求',\n        params: {\n          bannerIndex,\n          slideIndex,\n          imageType,\n          mobileUploadUrl: '/api/sanity/banner/mobile',\n          desktopUploadUrl: '/api/sanity/banner/desktop'\n        },\n        instructions: {\n          mobile: 'POST /api/sanity/banner/mobile with FormData: file, bannerId, slideIndex',\n          desktop: 'POST /api/sanity/banner/desktop with FormData: file, bannerId, slideIndex'\n        }\n      })\n    }\n\n    return NextResponse.json({ success: false, error: 'Unknown action' }, { status: 400 })\n\n  } catch (error: any) {\n    console.error('測試更新錯誤:', error)\n    return NextResponse.json(\n      { success: false, error: error?.message || '測試失敗' },\n      { status: 500 }\n    )\n  }\n}","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/sanity/pages/route.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":8,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":8,"endColumn":16,"suggestions":[{"fix":{"range":[229,279],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":74,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":74,"endColumn":16,"suggestions":[{"fix":{"range":[1769,1804],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":79,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":79,"endColumn":18,"suggestions":[{"fix":{"range":[1869,1900],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\nimport { client } from '@/sanity-client'\n\nexport async function POST(request: NextRequest) {\n  try {\n    const { title, slug, status = 'draft' } = await request.json()\n\n    console.log('收到新頁面建立請求:', { title, slug, status })\n\n    if (!title) {\n      return NextResponse.json(\n        { success: false, error: '缺少頁面標題' },\n        { status: 400 }\n      )\n    }\n\n    if (!slug) {\n      return NextResponse.json(\n        { success: false, error: '缺少頁面路徑' },\n        { status: 400 }\n      )\n    }\n\n    // 驗證slug格式\n    const slugPattern = /^[a-z0-9-]+$/\n    if (!slugPattern.test(slug)) {\n      return NextResponse.json(\n        { success: false, error: '頁面路徑只能包含小寫字母、數字和連字符' },\n        { status: 400 }\n      )\n    }\n\n    // 檢查是否已存在相同 slug 的頁面\n    const existingPage = await client.fetch(\n      `*[_type == \"grapesJSPageV2\" && slug.current == $slug][0]`,\n      { slug }\n    )\n\n    if (existingPage) {\n      return NextResponse.json(\n        { success: false, error: '該頁面路徑已存在，請選擇其他路徑' },\n        { status: 400 }\n      )\n    }\n\n    // 創建新頁面\n    const newPage = await client.create({\n      _type: 'grapesJSPageV2',\n      title,\n      slug: {\n        _type: 'slug',\n        current: slug\n      },\n      status,\n      grapesHtml: '<div>歡迎使用 GrapesJS 編輯器！</div>',\n      grapesCss: 'body { font-family: Arial, sans-serif; margin: 0; padding: 20px; }',\n      grapesComponents: '[]',\n      grapesStyles: '[]',\n      createdAt: new Date().toISOString(),\n      updatedAt: new Date().toISOString(),\n      seo: {\n        _type: 'seoMeta',\n        title: title,\n        description: '',\n        keywords: [],\n        openGraph: {\n          title: title,\n          description: '',\n          image: null\n        }\n      }\n    })\n\n    console.log('新頁面已創建:', newPage._id)\n\n    return NextResponse.json(newPage)\n\n  } catch (error) {\n    console.error('建立頁面失敗:', error)\n    return NextResponse.json(\n      { \n        success: false, \n        error: error instanceof Error ? error.message : '建立頁面失敗' \n      },\n      { status: 500 }\n    )\n  }\n}","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/sanity/upload/route.ts","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":8,"column":48,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":8,"endColumn":50,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[238,240],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":10,"column":60,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":10,"endColumn":62,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[395,397],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":13,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":13,"endColumn":20,"suggestions":[{"fix":{"range":[436,552],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":32,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1180,1183],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1180,1183],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":32,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1215,1218],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1215,1218],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":35,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1380,1383],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1380,1383],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":36,"column":9,"nodeType":null,"messageId":"preferOptionalChain","endLine":36,"endColumn":44,"fix":{"range":[1420,1455],"text":"!mime?.startsWith('image/')"}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":71,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":71,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2454,2457],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2454,2457],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":72,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":72,"endColumn":18,"suggestions":[{"fix":{"range":[2465,2515],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":74,"column":47,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":74,"endColumn":49,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2592,2594],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\nimport { createClient } from '@sanity/client'\n\nexport const runtime = 'nodejs'\n\nexport async function POST(req: NextRequest) {\n  try {\n    const token = process.env.SANITY_API_TOKEN || process.env.SANITY_WRITE_TOKEN\n    const projectId = process.env.NEXT_PUBLIC_SANITY_PROJECT_ID\n    const dataset = process.env.NEXT_PUBLIC_SANITY_DATASET || 'production'\n\n    if (!token) {\n      console.error('[Sanity Upload] 缺少 server-side Sanity token。請在 .env.local 中加入 SANITY_API_TOKEN 或 SANITY_WRITE_TOKEN')\n      return NextResponse.json({ \n        success: false, \n        error: '媒體上傳功能需要設定 Sanity API Token。請聯繫開發者設定 SANITY_API_TOKEN 環境變數。' \n      }, { status: 503 })\n    }\n    if (!projectId) {\n      return NextResponse.json({ success: false, error: 'Missing NEXT_PUBLIC_SANITY_PROJECT_ID' }, { status: 500 })\n    }\n\n    const formData = await req.formData()\n    const file = formData.get('file') as File | null\n\n    if (!file) {\n      return NextResponse.json({ success: false, error: 'No file provided' }, { status: 400 })\n    }\n\n    // 基本安全檢查：限制檔案大小與類型\n    const MAX_SIZE_BYTES = 6 * 1024 * 1024 // 6MB\n    if (typeof (file as any).size === 'number' && (file as any).size > MAX_SIZE_BYTES) {\n      return NextResponse.json({ success: false, error: 'File too large (max 6MB)' }, { status: 413 })\n    }\n    const mime = (file as any).type as string | undefined\n    if (!mime || !mime.startsWith('image/')) {\n      return NextResponse.json({ success: false, error: 'Only image uploads are allowed' }, { status: 415 })\n    }\n\n    const arrayBuffer = await file.arrayBuffer()\n    const buffer = Buffer.from(arrayBuffer)\n\n    const writeClient = createClient({\n      projectId,\n      dataset,\n      apiVersion: '2023-05-30',\n      token,\n      useCdn: false,\n      perspective: 'published',\n    })\n\n    const sanitizedName = (file.name || 'upload.jpg').replace(/[^a-zA-Z0-9._-]+/g, '_')\n    const asset = await writeClient.assets.upload('image', buffer, {\n      filename: sanitizedName,\n      contentType: mime || 'image/jpeg',\n    })\n\n    return NextResponse.json({\n      success: true,\n      image: {\n        _id: asset._id,\n        _type: 'sanity.imageAsset',\n        url: asset.url,\n        originalFilename: asset.originalFilename,\n        size: asset.size,\n        metadata: asset.metadata,\n        _createdAt: asset._createdAt,\n        _updatedAt: asset._updatedAt,\n      },\n    })\n  } catch (error: any) {\n    console.error('Sanity image upload error:', error)\n    return NextResponse.json(\n      { success: false, error: error?.message || 'Upload failed' },\n      { status: 500 }\n    )\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/shipping-cost/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/store-name/route.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":10,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":10,"endColumn":18,"suggestions":[{"fix":{"range":[244,283],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server'\nimport { getStoreName } from '@lib/store-name'\n\n// API 路由處理函數\nexport async function GET() {\n  try {\n    const name = await getStoreName()\n    return NextResponse.json({ name })\n  } catch (error) {\n    console.error('API 路由中獲取店名時出錯:', error)\n    return NextResponse.json(\n      { error: 'Failed to fetch store name' },\n      { status: 500 }\n    )\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/store-policies/route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'req' is defined but never used.","line":4,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":30},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'req' is defined but never used. Allowed unused args must match /^_/u.","line":4,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":30},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":7,"column":55,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":7,"endColumn":57,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[235,311],"text":"(process.env.MEDUSA_BACKEND_URL ?? process.env.NEXT_PUBLIC_MEDUSA_BACKEND_URL)"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":7,"column":101,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":7,"endColumn":103,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[312,314],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":55,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":55,"endColumn":18,"suggestions":[{"fix":{"range":[1727,1795],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\n\n// GET /api/store-policies - 前端獲取商店政策\nexport async function GET(req: NextRequest): Promise<NextResponse> {\n  try {\n    // 從 Medusa 後端 store API 獲取政策（無需認證）\n    const backendUrl = process.env.MEDUSA_BACKEND_URL || process.env.NEXT_PUBLIC_MEDUSA_BACKEND_URL || 'http://localhost:9000'\n    const { getPublishableKeyForBackend } = await import('@lib/medusa-publishable-key')\n    const publishableKey = getPublishableKeyForBackend(process.env.NEXT_PUBLIC_MEDUSA_BACKEND_URL)\n    \n    const headers: Record<string, string> = {\n      'Content-Type': 'application/json',\n    }\n    \n    if (publishableKey) {\n      headers['x-publishable-api-key'] = publishableKey\n    }\n    \n    const response = await fetch(`${backendUrl}/store/store-policies`, {\n      cache: 'no-store', // 確保獲取最新資料\n      headers\n    })\n\n    if (response.ok) {\n      const data = await response.json()\n      return NextResponse.json({ policies: data.policies })\n    }\n\n    // 如果後端 API 失敗，返回預設值\n    const defaultPolicies = {\n      shipping: {\n        title: \"快速配送\",\n        description: \"週一至週五 14:00 前下單，隔日送達 (假日順延)。全台灣本島地區免運費，離島地區需額外運費。\"\n      },\n      inventory: {\n        title: \"庫存政策\", \n        description: \"我們的庫存數量實時更新。商品頁面上標示的庫存數量為目前可購買的確切數量。\"\n      },\n      exchange: {\n        title: \"簡單換貨\",\n        description: \"尺寸不合適？收到商品後7天內可申請換貨，商品需保持全新狀態且包裝完整。\"\n      },\n      return: {\n        title: \"輕鬆退貨\",\n        description: \"收到商品後7天內可申請退貨。只需退回您的產品，我們將退還您的款項。客製化商品、特價商品不適用退換貨政策。\"\n      },\n      notice: {\n        title: \"特殊注意事項\",\n        description: \"因拍攝光線和顯示器設定不同，實際商品顏色可能與圖片略有差異。尺寸資訊供參考，實際尺寸可能有±1-2cm誤差。\"\n      }\n    }\n\n    return NextResponse.json({ policies: defaultPolicies })\n  } catch (error) {\n    console.error('Failed to fetch store policies from backend:', error)\n    \n    // 發生錯誤時返回預設值\n    const defaultPolicies = {\n      shipping: {\n        title: \"快速配送\",\n        description: \"週一至週五 14:00 前下單，隔日送達 (假日順延)。全台灣本島地區免運費，離島地區需額外運費。\"\n      },\n      inventory: {\n        title: \"庫存政策\", \n        description: \"我們的庫存數量實時更新。商品頁面上標示的庫存數量為目前可購買的確切數量。\"\n      },\n      exchange: {\n        title: \"簡單換貨\",\n        description: \"尺寸不合適？收到商品後7天內可申請換貨，商品需保持全新狀態且包裝完整。\"\n      },\n      return: {\n        title: \"輕鬆退貨\",\n        description: \"收到商品後7天內可申請退貨。只需退回您的產品，我們將退還您的款項。客製化商品、特價商品不適用退換貨政策。\"\n      },\n      notice: {\n        title: \"特殊注意事項\",\n        description: \"因拍攝光線和顯示器設定不同，實際商品顏色可能與圖片略有差異。尺寸資訊供參考，實際尺寸可能有±1-2cm誤差。\"\n      }\n    }\n\n    return NextResponse.json({ policies: defaultPolicies })\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/upload/route.ts","messages":[{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":16,"column":9,"nodeType":null,"messageId":"preferOptionalChain","endLine":16,"endColumn":37,"fix":{"range":[480,508],"text":"files?.length === 0"}},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":28,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":28,"endColumn":20,"suggestions":[{"fix":{"range":[742,822],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":53,"column":50,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":53,"endColumn":52,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1724,1726],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":55,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":55,"endColumn":22,"suggestions":[{"fix":{"range":[1760,1808],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":58,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":58,"endColumn":22,"suggestions":[{"fix":{"range":[1851,1901],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":68,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":68,"endColumn":18,"suggestions":[{"fix":{"range":[2060,2094],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":1,"fixableWarningCount":0,"source":"/**\n * GrapesJS AssetManager 上傳端點\n * 雖然我們主要使用自定義的 uploadFile 函數，\n * 但提供這個端點以防 GrapesJS 需要標準上傳支持\n */\n\nimport { NextRequest, NextResponse } from 'next/server'\nimport { uploadImageToSanity, buildSanityImageUrl } from '@/lib/services/sanity-media-service'\nimport { compressImage } from '@/lib/image-compression'\n\nexport async function POST(request: NextRequest) {\n  try {\n    const formData = await request.formData()\n    const files = formData.getAll('files') as File[]\n    \n    if (!files || files.length === 0) {\n      return NextResponse.json({ error: '沒有找到文件' }, { status: 400 })\n    }\n\n    const uploadedAssets = []\n\n    for (const file of files) {\n      if (!file.type.startsWith('image/')) {\n        continue\n      }\n\n      try {\n        console.log(`🖼️ API 處理上傳圖片: ${file.name} (${(file.size / 1024).toFixed(1)}KB)`)\n        \n        // 壓縮圖片\n        const compressedDataUrl = await compressImage(file, {\n          maxWidth: 1200,\n          maxHeight: 800,\n          quality: 0.8,\n          maxSizeKB: 500\n        })\n        \n        // 將壓縮後的 base64 轉換回 File 對象\n        const response = await fetch(compressedDataUrl)\n        const blob = await response.blob()\n        const compressedFile = new File([blob], file.name, { type: 'image/jpeg' })\n        \n        // 上傳到 Sanity\n        const uploadedImage = await uploadImageToSanity(compressedFile)\n        \n        if (uploadedImage) {\n          const imageUrl = buildSanityImageUrl(uploadedImage, 1200, 800, 90)\n          uploadedAssets.push({\n            type: 'image',\n            src: imageUrl,\n            height: uploadedImage.metadata.dimensions.height,\n            width: uploadedImage.metadata.dimensions.width,\n            name: uploadedImage.originalFilename || file.name\n          })\n          console.log(`✅ API 圖片已上傳到 Sanity: ${file.name}`)\n        }\n      } catch (error) {\n        console.error(`❌ API 處理圖片失敗: ${file.name}`, error)\n      }\n    }\n\n    return NextResponse.json({ \n      data: uploadedAssets,\n      message: `成功上傳 ${uploadedAssets.length} 張圖片`\n    })\n\n  } catch (error) {\n    console.error('上傳 API 錯誤:', error)\n    return NextResponse.json(\n      { error: '上傳失敗，請重試' }, \n      { status: 500 }\n    )\n  }\n}\n\nexport async function GET() {\n  // 返回 AssetManager 可用的方法說明\n  return NextResponse.json({\n    message: 'GrapesJS AssetManager API',\n    methods: {\n      'POST': 'Upload images to Sanity via AssetManager'\n    },\n    usage: 'POST multipart/form-data with files[] field'\n  })\n}","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/api/variants/[variantId]/route.ts","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":45,"column":86,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":45,"endColumn":88,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[979,981],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":59,"column":53,"nodeType":"MemberExpression","messageId":"unexpected","endLine":59,"endColumn":66},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":78,"column":49,"nodeType":"MemberExpression","messageId":"unexpected","endLine":78,"endColumn":62}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\"\nimport { MEDUSA_BACKEND_URL } from \"@lib/config\"\n\n/**\n * 重試機制封裝函數\n * @param fn 需要重試的異步函數\n * @param retries 重試次數\n * @param delay 重試延遲(ms)\n */\nasync function withRetry<T>(\n  fn: () => Promise<T>,\n  retries = 3,\n  delay = 300\n): Promise<T> {\n  try {\n    return await fn()\n  } catch (error) {\n    if (retries <= 0) throw error\n    await new Promise(resolve => setTimeout(resolve, delay))\n    return withRetry(fn, retries - 1, delay * 1.5)\n  }\n}\n\n/**\n * API 路由處理程序 - 獲取變體庫存\n * \n * 此路由代理請求到 Medusa 後端以避免 CORS 和環境變數問題\n * 包含重試機制，提高穩定性\n */\nexport async function GET(\n  req: NextRequest,\n  { params }: { params: { variantId: string } }\n) {\n  try {\n    const { variantId } = params\n    \n    if (!variantId) {\n      return NextResponse.json(\n        { error: \"Missing variant ID\" },\n        { status: 400 }\n      )\n    }\n    \n    // 獲取 Medusa 後端 URL\n    const baseUrl = MEDUSA_BACKEND_URL || process.env.NEXT_PUBLIC_MEDUSA_BACKEND_URL || \"http://localhost:9000\"\n    \n    // 從 Medusa 獲取變體數據 (使用重試機制)\n    const fetchVariant = async () => {\n      const response = await fetch(`${baseUrl}/store/variants/${variantId}`, {\n        method: \"GET\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        cache: \"no-store\",\n      })\n      \n      if (!response.ok) {\n        const errorText = await response.text()\n        if (process.env.NODE_ENV === 'development') console.error(`Error fetching variant: ${response.status} ${errorText}`)\n        throw new Error(`Failed to fetch variant: ${response.statusText}`)\n      }\n      \n      return response.json()\n    }\n    \n    // 使用重試機制獲取變體數據\n    const data = await withRetry(fetchVariant)\n    \n    // 擴展響應數據，增加更多有用信息\n    return NextResponse.json({\n      ...data,\n      _meta: {\n        timestamp: new Date().toISOString(),\n        source: baseUrl\n      }\n    })\n  } catch (error) {\n    if (process.env.NODE_ENV === 'development') console.error(\"Error in variant API route:\", error)\n    \n    return NextResponse.json(\n      { \n        error: \"Internal server error\", \n        message: error instanceof Error ? error.message : \"Unknown error\",\n        timestamp: new Date().toISOString()\n      },\n      { status: 500 }\n    )\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/cms/[[...index]]/layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/cms/[[...index]]/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[693,696],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[693,696],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":26,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":26,"endColumn":16,"suggestions":[{"fix":{"range":[729,766],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":32,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":32,"endColumn":20,"suggestions":[{"fix":{"range":[909,962],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { ErrorBoundary } from \"react-error-boundary\"\nimport { useEffect, useState } from \"react\"\nimport { NextStudio } from 'next-sanity/studio'\n\nfunction ErrorFallback({error, resetErrorBoundary}: {error: Error, resetErrorBoundary: () => void}) {\n  return (\n    <div role=\"alert\" style={{ padding: '20px', textAlign: 'center' }}>\n      <h2>Sanity CMS 發生錯誤</h2>\n      <p>錯誤訊息：{error.message}</p>\n      <button onClick={resetErrorBoundary} style={{ marginRight: '10px' }}>\n        重試\n      </button>\n      <button onClick={() => window.location.reload()}>\n        重新載入頁面\n      </button>\n    </div>\n  )\n}\n\nexport default function CMSPage() {\n  const [config, setConfig] = useState<any>(null)\n\n  useEffect(() => {\n    console.log('Sanity CMS page loaded')\n    \n    // 動態導入配置\n    import('../../../../sanity.config').then((module) => {\n      setConfig(module.default)\n    }).catch((error) => {\n      console.error('Failed to load Sanity config:', error)\n    })\n  }, [])\n\n  if (!config) {\n    return (\n      <div style={{ padding: '40px', textAlign: 'center' }}>\n        <h1>載入 Sanity CMS...</h1>\n        <p>正在初始化 CMS 配置</p>\n      </div>\n    )\n  }\n\n  return (\n    <ErrorBoundary FallbackComponent={ErrorFallback}>\n      <NextStudio config={config} />\n    </ErrorBoundary>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/cms/editor/page.tsx","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":32,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":32,"endColumn":16,"suggestions":[{"fix":{"range":[925,968],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { Suspense } from 'react'\nimport { useSearchParams } from 'next/navigation'\nimport dynamic from 'next/dynamic'\nimport type { GrapesJSPageData } from '@/lib/services/grapesjs-page-service'\n\n// 動態載入 GrapesJS 編輯器，避免 SSR 問題\nconst GrapesEditor = dynamic(() => import('@/components/grapesjs/grapes_editor'), {\n  ssr: false,\n  loading: () => (\n    <div style={{\n      height: '100vh',\n      display: 'flex',\n      alignItems: 'center',\n      justifyContent: 'center',\n      backgroundColor: '#f8f9fa'\n    }}>\n      <div style={{ textAlign: 'center' }}>\n        <div style={{ fontSize: '24px', marginBottom: '16px' }}>🔄</div>\n        <div style={{ fontSize: '16px', color: '#666' }}>載入 GrapesJS 編輯器中...</div>\n      </div>\n    </div>\n  )\n})\n\nfunction EditorContent() {\n  const searchParams = useSearchParams()\n  const docId = searchParams.get('docId')\n\n  const handleSave = (pageData: GrapesJSPageData) => {\n    console.log('✅ 頁面已成功儲存到 Sanity!', pageData)\n    \n    // 顯示成功通知\n    if (typeof window !== 'undefined') {\n      const notification = document.createElement('div')\n      notification.style.cssText = `\n        position: fixed;\n        top: 20px;\n        right: 20px;\n        background: #4CAF50;\n        color: white;\n        padding: 12px 20px;\n        border-radius: 6px;\n        box-shadow: 0 4px 12px rgba(0,0,0,0.15);\n        z-index: 10000;\n        font-size: 14px;\n        font-weight: 500;\n      `\n      notification.textContent = '✅ 頁面已成功儲存到 Sanity'\n      \n      document.body.appendChild(notification)\n      \n      setTimeout(() => {\n        if (notification.parentNode) {\n          notification.parentNode.removeChild(notification)\n        }\n      }, 3000)\n    }\n  }\n\n  if (!docId) {\n    return (\n      <div style={{\n        height: '100vh',\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'center',\n        backgroundColor: '#f8f9fa'\n      }}>\n        <div style={{ textAlign: 'center', color: '#666' }}>\n          <div style={{ fontSize: '48px', marginBottom: '20px' }}>⚠️</div>\n          <h2 style={{ margin: '0 0 12px 0', fontSize: '20px' }}>缺少頁面 ID</h2>\n          <p style={{ margin: '0', fontSize: '14px' }}>請從 Sanity 文件中點擊按鈕來開啟編輯器</p>\n        </div>\n      </div>\n    )\n  }\n\n  return (\n    <div style={{ height: '100vh', width: '100%' }}>\n      <GrapesEditor\n        pageId={docId}\n        onSave={handleSave}\n      />\n    </div>\n  )\n}\n\nexport default function EditorPage() {\n  return (\n    <Suspense fallback={\n      <div style={{\n        height: '100vh',\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'center'\n      }}>\n        <div style={{ fontSize: '24px' }}>🔄</div>\n      </div>\n    }>\n      <EditorContent />\n    </Suspense>\n  )\n}","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/cms/layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/layout.tsx","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":5,"column":58,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":5,"endColumn":60,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[156,158],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Metadata } from \"next\"\nimport \"@/styles/globals.css\"\n\nexport const metadata: Metadata = {\n  metadataBase: new URL(process.env.NEXT_PUBLIC_BASE_URL || 'http://localhost:3000'),\n  // 預設的fallback metadata\n  title: {\n    template: '%s | Tim\\'s Fantasy World',\n    default: 'Tim\\'s Fantasy World - 專業美髮沙龍與造型產品'\n  },\n  description: '專業美髮沙龍服務，提供剪髮、染髮、燙髮等服務。銷售優質美髮產品，包含洗髮精、護髮乳、造型產品等。',\n  keywords: '美髮沙龍, 剪髮, 染髮, 燙髮, 造型, 洗髮精, 護髮乳, 造型產品, 美髮用品',\n  authors: [{ name: 'Tim\\'s Fantasy World' }],\n  creator: 'Tim\\'s Fantasy World',\n  publisher: 'Tim\\'s Fantasy World',\n  formatDetection: {\n    email: false,\n    address: false,\n    telephone: false,\n  },\n  verification: {\n    google: process.env.GOOGLE_SITE_VERIFICATION,\n  }\n}\n\nexport default function RootLayout({\n  children,\n}: {\n  children: React.ReactNode\n}) {\n  return (\n    <html lang=\"zh-TW\" data-mode=\"light\" suppressHydrationWarning>\n      <body className=\"theme-lv\">\n        <main className=\"relative\">{children}</main>\n      </body>\n    </html>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/not-found.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/app/sanity-setup/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/components/account/ClientAccountLayout.tsx","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":32,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":32,"endColumn":22,"suggestions":[{"fix":{"range":[946,979],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useEffect, useState } from 'react'\nimport { Toaster } from \"@medusajs/ui\"\nimport AccountLayout from \"@modules/account/templates/account-layout\"\nimport { HttpTypes } from \"@medusajs/types\"\n\ninterface ClientAccountLayoutProps {\n  dashboard?: React.ReactNode\n  login?: React.ReactNode\n  initialCustomer?: HttpTypes.StoreCustomer | null\n}\n\nexport default function ClientAccountLayout({\n  dashboard,\n  login,\n  initialCustomer = null\n}: ClientAccountLayoutProps) {\n  const [customer, setCustomer] = useState<HttpTypes.StoreCustomer | null>(initialCustomer)\n  const [isLoading, setIsLoading] = useState(!initialCustomer)\n\n  useEffect(() => {\n    // 在客戶端檢索用戶資料\n    const fetchCustomer = async () => {\n      try {\n        const response = await fetch('/api/auth/customer')\n        if (response.ok) {\n          const customerData = await response.json()\n          setCustomer(customerData)\n        }\n      } catch (error) {\n        console.error('獲取用戶資料失敗:', error)\n      } finally {\n        setIsLoading(false)\n      }\n    }\n\n    if (!initialCustomer) {\n      fetchCustomer()\n    }\n  }, [initialCustomer])\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center min-h-screen\">\n        <div className=\"animate-spin rounded-full h-32 w-32 border-b-2 border-gray-900\"></div>\n      </div>\n    )\n  }\n\n  return (\n    <AccountLayout customer={customer}>\n      {customer ? dashboard : login}\n      <Toaster />\n    </AccountLayout>\n  )\n}","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/components/account/ClientOverview.tsx","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":29,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":29,"endColumn":22,"suggestions":[{"fix":{"range":[951,982],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useEffect, useState } from 'react'\nimport Overview from \"@modules/account/components/overview\"\nimport { HttpTypes } from \"@medusajs/types\"\n\nexport default function ClientOverview() {\n  const [customer, setCustomer] = useState<HttpTypes.StoreCustomer | null>(null)\n  const [orders, setOrders] = useState<HttpTypes.StoreOrder[] | null>(null)\n  const [isLoading, setIsLoading] = useState(true)\n\n  useEffect(() => {\n    const fetchData = async () => {\n      try {\n        // 獲取客戶資料\n        const customerResponse = await fetch('/api/auth/customer')\n        if (customerResponse.ok) {\n          const customerData = await customerResponse.json()\n          setCustomer(customerData)\n        }\n\n        // 獲取訂單資料\n        const ordersResponse = await fetch('/api/orders')\n        if (ordersResponse.ok) {\n          const ordersData = await ordersResponse.json()\n          setOrders(ordersData)\n        }\n      } catch (error) {\n        console.error('獲取資料失敗:', error)\n      } finally {\n        setIsLoading(false)\n      }\n    }\n\n    fetchData()\n  }, [])\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center min-h-[400px]\">\n        <div className=\"animate-spin rounded-full h-16 w-16 border-b-2 border-gray-900\"></div>\n      </div>\n    )\n  }\n\n  return <Overview customer={customer} orders={orders} />\n}","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/components/checkout/ecpay-checkout.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":4,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[67,70],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[67,70],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":6,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[116,119],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[116,119],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'onSuccess' is defined but never used.","line":11,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":12},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'onSuccess' is defined but never used. Allowed unused args must match /^_/u.","line":11,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'onError' is defined but never used.","line":12,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":10},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'onError' is defined but never used. Allowed unused args must match /^_/u.","line":12,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":10},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":16,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":16,"endColumn":16,"suggestions":[{"fix":{"range":[284,343],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from \"react\"\n\ninterface EcpayCheckoutProps {\n  cart?: any\n  onSuccess?: () => void\n  onError?: (error: any) => void\n}\n\nconst EcpayCheckout: React.FC<EcpayCheckoutProps> = ({ \n  cart, \n  onSuccess, \n  onError \n}) => {\n  const handlePayment = () => {\n    // ECPay 支付邏輯\n    console.log(\"Processing ECPay payment for cart:\", cart?.id)\n  }\n\n  return (\n    <div className=\"ecpay-checkout\">\n      <button \n        onClick={handlePayment}\n        className=\"w-full bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700\"\n      >\n        使用 ECPay 結帳\n      </button>\n    </div>\n  )\n}\n\nexport default EcpayCheckout\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/components/common/signout-button.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/components/favicon-meta.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'altText' is defined but never used.","line":10,"column":51,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":58},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'altText' is defined but never used. Allowed unused args must match /^_/u.","line":10,"column":51,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":58}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useEffect } from 'react'\n\ninterface FaviconMetaProps {\n  faviconUrl?: string\n  altText?: string\n}\n\nexport default function FaviconMeta({ faviconUrl, altText }: FaviconMetaProps) {\n  useEffect(() => {\n    if (faviconUrl && typeof window !== 'undefined') {\n      // 移除現有的 favicon 連結\n      const existingFavicons = document.querySelectorAll('link[rel*=\"icon\"]')\n      existingFavicons.forEach(link => link.remove())\n\n      // 創建新的 favicon 連結\n      const link = document.createElement('link')\n      link.rel = 'icon'\n      link.type = 'image/x-icon'\n      link.href = faviconUrl\n      \n      // 添加到 head\n      document.head.appendChild(link)\n\n      // 同時設置 shortcut icon（向後兼容）\n      const shortcutLink = document.createElement('link')\n      shortcutLink.rel = 'shortcut icon'\n      shortcutLink.type = 'image/x-icon'\n      shortcutLink.href = faviconUrl\n      document.head.appendChild(shortcutLink)\n    }\n  }, [faviconUrl])\n\n  return null // 這個組件不渲染任何內容\n}","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/components/grapesjs/SimplePageRenderer.tsx","messages":[{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":30,"column":11,"nodeType":null,"messageId":"preferOptionalChain","endLine":30,"endColumn":48,"suggestions":[{"fix":{"range":[748,785],"text":"scriptContent?.trim()"},"messageId":"optionalChainSuggest","desc":"Change to an optional chain."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":39,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":39,"endColumn":22,"suggestions":[{"fix":{"range":[983,1020],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":41,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":41,"endColumn":22,"suggestions":[{"fix":{"range":[1061,1100],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":43,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":43,"endColumn":24,"suggestions":[{"fix":{"range":[1137,1186],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useEffect, useState, useRef } from 'react'\n\ninterface Props {\n  htmlContent: string\n  cssContent?: string\n}\n\nexport default function SimplePageRenderer({ htmlContent, cssContent }: Props) {\n  const [isClient, setIsClient] = useState(false)\n  const containerRef = useRef<HTMLDivElement>(null)\n  \n  // 確保只在客戶端渲染，避免 hydration 問題\n  useEffect(() => {\n    setIsClient(true)\n  }, [])\n\n  // 執行內聯腳本\n  useEffect(() => {\n    if (!isClient || !containerRef.current || !htmlContent) return\n\n    // 提取並執行 script 標籤\n    const scriptRegex = /<script[^>]*>([\\s\\S]*?)<\\/script>/gi\n    let match\n    const scripts: string[] = []\n    \n    while ((match = scriptRegex.exec(htmlContent)) !== null) {\n      const scriptContent = match[1]\n      if (scriptContent && scriptContent.trim()) {\n        scripts.push(scriptContent.trim())\n      }\n    }\n\n    // 延遲執行腳本，確保 DOM 已渲染\n    const timer = setTimeout(() => {\n      scripts.forEach((scriptContent, index) => {\n        try {\n          console.log(`🔧 執行頁面腳本 ${index + 1}`)\n          eval(scriptContent)\n          console.log(`✅ 頁面腳本 ${index + 1} 執行成功`)\n        } catch (error) {\n          console.error(`❌ 頁面腳本 ${index + 1} 執行失敗:`, error)\n        }\n      })\n    }, 100)\n\n    return () => clearTimeout(timer)\n  }, [isClient, htmlContent])\n\n  // 清理 HTML 內容，移除可能導致 hydration 問題的標籤\n  const cleanHtmlContent = htmlContent\n    // 移除 body 標籤和其他可能的根級標籤\n    .replace(/<\\/?body[^>]*>/gi, '')\n    .replace(/<\\/?html[^>]*>/gi, '')\n    .replace(/<\\/?head[^>]*>/gi, '')\n    // 移除可能的 doctype\n    .replace(/<!DOCTYPE[^>]*>/gi, '')\n    .trim()\n\n  // 服務器端渲染時顯示占位符\n  if (!isClient) {\n    return (\n      <div className=\"grapes-page-content\">\n        <div className=\"animate-pulse bg-gray-200 h-64 rounded\"></div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"grapes-page-content\" ref={containerRef}>\n      {cssContent && (\n        <style dangerouslySetInnerHTML={{ __html: cssContent }} />\n      )}\n      <div dangerouslySetInnerHTML={{ __html: cleanHtmlContent }} />\n    </div>\n  )\n}","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/components/grapesjs/config/plugins-config.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":7,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[105,108],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[105,108],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":22,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[585,588],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[585,588],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":279,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":279,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7402,7405],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7402,7405],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":281,"column":30,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":281,"endColumn":32,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[7479,7481],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":287,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":287,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7574,7577],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7574,7577],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":329,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":329,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8279,8282],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8279,8282],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":330,"column":4,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":330,"endColumn":7,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8286,8289],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8286,8289],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * GrapesJS 第三方插件配置\n * 統一管理所有第三方插件的配置選項\n */\n\nexport interface PluginConfig {\n  [pluginName: string]: any;\n}\n\n/**\n * 獲取第三方插件配置選項\n * 已針對效能和相容性進行最佳化\n */\nexport const getPluginsOptions = (): PluginConfig => {\n  return {\n    // ============================================\n    // 1. grapesjs-preset-webpage - 網頁預設模板\n    // ============================================\n    'grapesjs-preset-webpage': {\n      modalImportTitle: '匯入模板',\n      modalImportLabel: '<div style=\"margin-bottom: 10px; font-size: 13px;\">在此貼上您的 HTML/CSS 代碼，然後點擊匯入</div>',\n      modalImportContent: function(editor: any) {\n        return editor.getHtml() + '<style>' + editor.getCss() + '</style>'\n      },\n      importViewerOptions: {\n        enableImport: true\n      },\n      // 性能優化選項\n      formsOpts: {\n        category: '表單元件'\n      },\n      countdownOpts: {\n        category: '互動元件'\n      },\n      exportOpts: {\n        addExportBtn: true,\n        filename: 'grapesjs_page',\n        root: {\n          css: {\n            'font-family': '\"Helvetica Neue\", Helvetica, Arial, sans-serif'\n          }\n        }\n      }\n    },\n\n    // ============================================\n    // 2. grapesjs-blocks-basic - 基本佈局區塊\n    // ============================================\n    'grapesjs-blocks-basic': {\n      flexGrid: 1, // 啟用 flexbox 網格\n      stylePrefix: 'gjs-', // CSS 前綴\n      addBasicStyle: true, // 添加基本樣式\n      category: '基本佈局', // 分類名稱\n      labelColumn1: '單列',\n      labelColumn2: '雙列', \n      labelColumn3: '三列',\n      labelText: '文字區塊',\n      labelImage: '圖片',\n      labelVideo: '影片',\n      labelMap: '地圖',\n      // 優化設定\n      rowHeight: 75,\n      justifyContent: true,\n      alignItems: true,\n      flexDirection: true,\n      flexWrap: true,\n      // 預設樣式改進\n      defaultStyle: {\n        'min-height': '50px',\n        'padding': '10px'\n      }\n    },\n\n    // ============================================\n    // 3. grapesjs-plugin-forms - 表單元件\n    // ============================================\n    'grapesjs-plugin-forms': {\n      category: '表單元件', // 自訂分類\n      stylePrefix: 'form-', // CSS 前綴\n      block: {\n        category: '表單元件'\n      },\n      // 表單驗證和樣式增強\n      formOpts: {\n        method: 'POST',\n        action: '/api/form-submit'\n      },\n      inputOpts: {\n        placeholder: '請輸入...'\n      },\n      textareaOpts: {\n        placeholder: '請輸入詳細內容...',\n        rows: 4\n      },\n      selectOpts: {\n        placeholder: '請選擇...'\n      }\n    },\n\n    // ============================================\n    // 4. grapesjs-component-countdown - 倒計時器\n    // ============================================\n    'grapesjs-component-countdown': {\n      category: '互動元件',\n      block: {\n        label: '倒計時器',\n        content: '<div data-gjs-type=\"countdown\" data-gjs-countdown=\"2024-12-31T23:59:59\" style=\"text-align:center;padding:20px;font-size:2em;background:#f8f9fa;border:2px solid #dee2e6;border-radius:8px;color:#495057;\">剩餘時間: <span class=\"countdown-timer\">計算中...</span></div>',\n        media: '<i class=\"fa fa-clock\"></i>'\n      },\n      startTime: new Date().toISOString(),\n      endText: '🎉 時間結束！',\n      dateInputType: 'datetime-local',\n      // 增強功能\n      updateInterval: 1000, // 1秒更新一次\n      format: 'DD天 HH:MM:SS',\n      timezone: 'Asia/Taipei',\n      autostart: true\n    },\n\n    // ============================================\n    // 5. grapesjs-tabs - 標籤頁組件\n    // ============================================\n    'grapesjs-tabs': {\n      category: '版面配置',\n      block: {\n        label: '分頁標籤',\n        media: '<i class=\"fa fa-folder-o\"></i>',\n        content: {\n          type: 'tabs',\n          style: {\n            'min-height': '200px'\n          }\n        }\n      },\n      stylePrefix: 'tab-',\n      // 標籤頁增強設定\n      tabsOpts: {\n        animation: 'fade',\n        duration: 300\n      },\n      defaultTabs: [\n        { title: '標籤 1', content: '<p>這是第一個標籤的內容</p>' },\n        { title: '標籤 2', content: '<p>這是第二個標籤的內容</p>' }\n      ]\n    },\n\n    // ============================================\n    // 6. grapesjs-custom-code - 自訂代碼編輯器\n    // ============================================\n    'grapesjs-custom-code': {\n      category: '進階功能',\n      block: {\n        label: '自訂代碼',\n        media: '<i class=\"fa fa-code\"></i>'\n      },\n      stylePrefix: 'cc-',\n      modalTitle: '自訂代碼編輯器',\n      codeViewOptions: {\n        theme: 'material-darker', // 更現代的主題\n        autoBeautify: true,\n        autoCloseTags: true,\n        autoCloseBrackets: true,\n        lineNumbers: true,\n        foldGutter: true,\n        matchBrackets: true,\n        autoRefresh: true,\n        lineWrapping: true\n      },\n      buttonLabel: '📝 編輯代碼',\n      commandCustomCode: 'custom-code:open-modal',\n      // 代碼驗證和錯誤檢查\n      validateCode: true,\n      showErrors: true\n    },\n\n    // ============================================\n    // 7. grapesjs-tooltip - 提示框組件\n    // ============================================\n    'grapesjs-tooltip': {\n      category: '互動元件',\n      block: {\n        label: '提示框',\n        media: '<i class=\"fa fa-comment\"></i>'\n      },\n      stylePrefix: 'tooltip-',\n      // 提示框增強設定\n      placement: 'top',\n      trigger: 'hover',\n      delay: { show: 500, hide: 100 },\n      animation: true,\n      html: true,\n      template: '<div class=\"tooltip custom-tooltip\" role=\"tooltip\"><div class=\"arrow\"></div><div class=\"tooltip-inner\"></div></div>'\n    },\n\n    // ============================================\n    // 8. grapesjs-typed - 打字效果組件\n    // ============================================\n    'grapesjs-typed': {\n      category: '互動元件', \n      block: {\n        label: '打字效果',\n        media: '<i class=\"fa fa-keyboard-o\"></i>'\n      },\n      stylePrefix: 'typed-',\n      // 打字效果增強設定\n      typeSpeed: 70,\n      startDelay: 1000,\n      backSpeed: 30,\n      backDelay: 2000,\n      loop: true,\n      loopCount: Infinity,\n      showCursor: true,\n      cursorChar: '|',\n      smartBackspace: true,\n      shuffle: false\n    },\n\n    // ============================================\n    // 9. grapesjs-carousel-component - 輪播組件\n    // ============================================\n    'grapesjs-carousel-component': {\n      category: '版面配置',\n      block: {\n        label: '全寬輪播圖',\n        media: '<i class=\"fa fa-images\"></i>',\n        content: {\n          type: 'carousel',\n          classes: ['full-width-carousel'],\n          style: {\n            'width': '100vw',\n            'margin-left': '-50vw',\n            'margin-right': '-50vw',\n            'left': '50%',\n            'right': '50%',\n            'position': 'relative',\n            'border-radius': '8px',\n            'overflow': 'hidden'\n          }\n        }\n      },\n      stylePrefix: 'carousel-',\n      // 輪播組件增強設定\n      carouselOpts: {\n        type: 'slide',\n        autoplay: true,\n        interval: 4000,\n        pauseOnHover: true,\n        arrows: true,\n        pagination: true,\n        keyboard: true,\n        drag: true,\n        breakpoints: {\n          768: {\n            arrows: false,\n            pagination: true\n          }\n        }\n      },\n      // 預設幻燈片\n      defaultSlides: [\n        {\n          image: '/api/placeholder/800/400/1',\n          title: '幻燈片 1',\n          description: '這是第一張幻燈片的描述'\n        },\n        {\n          image: '/api/placeholder/800/400/2', \n          title: '幻燈片 2',\n          description: '這是第二張幻燈片的描述'\n        }\n      ]\n    }\n  };\n};\n\n/**\n * 獲取特定插件的配置\n */\nexport const getPluginConfig = (pluginName: string): any => {\n  const options = getPluginsOptions();\n  return options[pluginName] || {};\n};\n\n/**\n * 更新特定插件的配置\n */\nexport const updatePluginConfig = (pluginName: string, config: any): PluginConfig => {\n  const options = getPluginsOptions();\n  return {\n    ...options,\n    [pluginName]: {\n      ...options[pluginName],\n      ...config\n    }\n  };\n};\n\n/**\n * 獲取所有插件的名稱列表\n */\nexport const getPluginNames = (): string[] => {\n  return Object.keys(getPluginsOptions());\n};\n\n/**\n * 檢查插件是否已配置\n */\nexport const hasPluginConfig = (pluginName: string): boolean => {\n  return pluginName in getPluginsOptions();\n};\n\n/**\n * 插件配置預設值\n */\nexport const defaultPluginConfig = {\n  stylePrefix: 'gjs-',\n  category: '其他',\n  block: {\n    label: '插件組件',\n    media: '<i class=\"fa fa-cube\"></i>'\n  }\n};\n\n/**\n * 合併插件配置（用於擴展現有配置）\n */\nexport const mergePluginConfig = (\n  pluginName: string, \n  additionalConfig: any\n): any => {\n  const baseConfig = getPluginConfig(pluginName);\n  return {\n    ...defaultPluginConfig,\n    ...baseConfig,\n    ...additionalConfig\n  };\n};","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/components/grapesjs/custom-components/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/components/grapesjs/grapes_editor.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":16,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[607,610],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[607,610],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"sonarjs/cognitive-complexity","severity":2,"message":"Refactor this function to reduce its Cognitive Complexity from 34 to the 15 allowed.","line":20,"column":43,"nodeType":null,"messageId":"refactorFunction","endLine":20,"endColumn":45},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":22,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":22,"endColumn":19,"suggestions":[{"fix":{"range":[823,959],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":31,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":31,"endColumn":18,"suggestions":[{"fix":{"range":[996,1040],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":46,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":46,"endColumn":21,"suggestions":[{"fix":{"range":[1518,1547],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"prefer-const","severity":2,"message":"'finalHtml' is never reassigned. Use 'const' instead.","line":50,"column":11,"nodeType":"Identifier","messageId":"useConst","endLine":50,"endColumn":20,"fix":{"range":[1612,1813],"text":"const finalHtml = html\n        .replace(/<\\/?body[^>]*>/gi, '')\n        .replace(/<\\/?html[^>]*>/gi, '')\n        .replace(/<\\/?head[^>]*>/gi, '')\n        .replace(/<!DOCTYPE[^>]*>/gi, '')\n        .trim()"}},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":59,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":59,"endColumn":18,"suggestions":[{"fix":{"range":[1861,2106],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":69,"column":54,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":69,"endColumn":56,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2258,2260],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":78,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":78,"endColumn":22,"suggestions":[{"fix":{"range":[2549,2585],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":81,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":81,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2679,2682],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2679,2682],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":95,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":95,"endColumn":22,"suggestions":[{"fix":{"range":[3079,3115],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":98,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":98,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3202,3205],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3202,3205],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":99,"column":59,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":99,"endColumn":61,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3271,3273],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":100,"column":39,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":100,"endColumn":41,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3316,3318],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":105,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":105,"endColumn":18,"suggestions":[{"fix":{"range":[3361,3654],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":119,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":119,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3846,3849],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3846,3849],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":121,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":121,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3900,3903],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3900,3903],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":122,"column":18,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":122,"endColumn":34},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":138,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":138,"endColumn":24,"suggestions":[{"fix":{"range":[4419,4461],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":152,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":152,"endColumn":22,"suggestions":[{"fix":{"range":[4828,5188],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":173,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":173,"endColumn":18,"suggestions":[{"fix":{"range":[5841,5882],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":183,"column":70,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":183,"endColumn":72,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[6114,6116],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":193,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":193,"endColumn":20,"suggestions":[{"fix":{"range":[6487,6520],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":198,"column":70,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":198,"endColumn":72,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[6718,6720],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-alert","severity":2,"message":"Unexpected alert.","line":212,"column":9,"nodeType":"CallExpression","messageId":"unexpected","endLine":212,"endColumn":39},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":224,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":224,"endColumn":20,"suggestions":[{"fix":{"range":[7640,7675],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":230,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":230,"endColumn":22,"suggestions":[{"fix":{"range":[7835,7866],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":232,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":232,"endColumn":26,"suggestions":[{"fix":{"range":[7919,7953],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":235,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":235,"endColumn":22,"suggestions":[{"fix":{"range":[7994,8161],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":272,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":272,"endColumn":20,"suggestions":[{"fix":{"range":[9026,9068],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":274,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":274,"endColumn":24,"suggestions":[{"fix":{"range":[9117,9149],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":313,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":313,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10175,10178],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10175,10178],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":318,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":318,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10314,10317],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10314,10317],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":319,"column":80,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":319,"endColumn":82,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[10403,10405],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":323,"column":45,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":323,"endColumn":47,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[10507,10545],"text":"(comp.get('style') ?? comp.getStyle?.())"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":323,"column":66,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":323,"endColumn":68,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[10546,10548],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":324,"column":47,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":324,"endColumn":49,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[10579,10619],"text":"(comp.get('script') ?? comp.getScript?.())"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":324,"column":69,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":324,"endColumn":71,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[10620,10622],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":330,"column":53,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":330,"endColumn":55,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[10897,10946],"text":"(comp.get('components') ?? comp.components?.models)"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":330,"column":80,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":330,"endColumn":82,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[10947,10949],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":346,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":346,"endColumn":20,"suggestions":[{"fix":{"range":[11459,11489],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":347,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":347,"endColumn":20,"suggestions":[{"fix":{"range":[11498,11515],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":348,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":348,"endColumn":20,"suggestions":[{"fix":{"range":[11524,11560],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":349,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":349,"endColumn":20,"suggestions":[{"fix":{"range":[11569,11598],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":350,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":350,"endColumn":20,"suggestions":[{"fix":{"range":[11607,11636],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":351,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":351,"endColumn":20,"suggestions":[{"fix":{"range":[11645,11661],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":352,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":352,"endColumn":20,"suggestions":[{"fix":{"range":[11670,11705],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":353,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":353,"endColumn":20,"suggestions":[{"fix":{"range":[11714,11733],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":354,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":354,"endColumn":20,"suggestions":[{"fix":{"range":[11742,11775],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":355,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":355,"endColumn":20,"suggestions":[{"fix":{"range":[11784,11802],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":378,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":378,"endColumn":22,"suggestions":[{"fix":{"range":[12223,12249],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":379,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":379,"endColumn":22,"suggestions":[{"fix":{"range":[12260,12281],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-alert","severity":2,"message":"Unexpected alert.","line":380,"column":11,"nodeType":"CallExpression","messageId":"unexpected","endLine":380,"endColumn":41},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":385,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":385,"endColumn":16,"suggestions":[{"fix":{"range":[12353,12386],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"sonarjs/cognitive-complexity","severity":2,"message":"Refactor this function to reduce its Cognitive Complexity from 18 to the 15 allowed.","line":395,"column":33,"nodeType":null,"messageId":"refactorFunction","endLine":395,"endColumn":35},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":398,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":398,"endColumn":20,"suggestions":[{"fix":{"range":[12669,12699],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":404,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":404,"endColumn":20,"suggestions":[{"fix":{"range":[12797,12831],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":410,"column":13,"nodeType":null,"messageId":"preferOptionalChain","endLine":410,"endColumn":45,"fix":{"range":[12925,12957],"text":"!editorRef?.current"}},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":411,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":411,"endColumn":22,"suggestions":[{"fix":{"range":[12971,13007],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":418,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":418,"endColumn":24,"suggestions":[{"fix":{"range":[13147,13177],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":422,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":422,"endColumn":22,"suggestions":[{"fix":{"range":[13251,13290],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":428,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":428,"endColumn":22,"suggestions":[{"fix":{"range":[13449,13480],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":436,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":436,"endColumn":24,"suggestions":[{"fix":{"range":[13688,13769],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":440,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":440,"endColumn":22,"suggestions":[{"fix":{"range":[13843,13884],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":448,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":448,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14007,14010],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14007,14010],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":448,"column":57,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":448,"endColumn":59,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[14023,14025],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":450,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":450,"endColumn":20,"suggestions":[{"fix":{"range":[14067,14127],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":453,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":453,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14210,14213],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14210,14213],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":457,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":457,"endColumn":24,"suggestions":[{"fix":{"range":[14342,14386],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":460,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":460,"endColumn":26,"suggestions":[{"fix":{"range":[14468,14503],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":464,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":464,"endColumn":23,"suggestions":[{"fix":{"range":[14578,14610],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":469,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":469,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14669,14672],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14669,14672],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":472,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":472,"endColumn":20,"suggestions":[{"fix":{"range":[14710,14749],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":476,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":476,"endColumn":23,"suggestions":[{"fix":{"range":[14853,14892],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":479,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":479,"endColumn":20,"suggestions":[{"fix":{"range":[14920,15151],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":505,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":505,"endColumn":20,"suggestions":[{"fix":{"range":[16120,16169],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":509,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":509,"endColumn":20,"suggestions":[{"fix":{"range":[16256,16298],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":515,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":515,"endColumn":24,"suggestions":[{"fix":{"range":[16433,16469],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":516,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":516,"endColumn":24,"suggestions":[{"fix":{"range":[16480,16724],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":526,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":526,"endColumn":25,"suggestions":[{"fix":{"range":[16904,16937],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":529,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":529,"endColumn":26,"suggestions":[{"fix":{"range":[17036,17069],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":536,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":536,"endColumn":20,"suggestions":[{"fix":{"range":[17187,17228],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":621,"column":26,"nodeType":"MemberExpression","messageId":"unexpected","endLine":621,"endColumn":37},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":622,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":622,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19831,19834],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19831,19834],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":622,"column":36,"nodeType":"MemberExpression","messageId":"unexpected","endLine":622,"endColumn":49},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":663,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":663,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21171,21174],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21171,21174],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":664,"column":48,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":664,"endColumn":50,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[21236,21238],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":701,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":701,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22190,22193],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22190,22193],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":721,"column":44,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":721,"endColumn":46,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[22892,22894],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":730,"column":15,"nodeType":"MemberExpression","messageId":"unexpected","endLine":730,"endColumn":28,"suggestions":[{"fix":{"range":[23152,23195],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":740,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":740,"endColumn":20,"suggestions":[{"fix":{"range":[23360,23385],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":759,"column":21,"nodeType":null,"messageId":"preferOptionalChain","endLine":759,"endColumn":53,"fix":{"range":[24025,24057],"text":"selected?.is('image')"}},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":763,"column":17,"nodeType":"MemberExpression","messageId":"unexpected","endLine":763,"endColumn":28,"suggestions":[{"fix":{"range":[24160,24201],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":766,"column":17,"nodeType":"MemberExpression","messageId":"unexpected","endLine":766,"endColumn":28,"suggestions":[{"fix":{"range":[24266,24299],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":785,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":785,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[24868,24871],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[24868,24871],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":789,"column":17,"nodeType":null,"messageId":"preferOptionalChain","endLine":789,"endColumn":32,"fix":{"range":[25006,25021],"text":"view?.el"}},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":802,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":802,"endColumn":26,"suggestions":[{"fix":{"range":[25368,25402],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":808,"column":15,"nodeType":"MemberExpression","messageId":"unexpected","endLine":808,"endColumn":26,"suggestions":[{"fix":{"range":[25554,25578],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":810,"column":15,"nodeType":"MemberExpression","messageId":"unexpected","endLine":810,"endColumn":27,"suggestions":[{"fix":{"range":[25614,25639],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":820,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":820,"endColumn":20,"suggestions":[{"fix":{"range":[25920,25948],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":830,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":830,"endColumn":24,"suggestions":[{"fix":{"range":[26214,26239],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":836,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":836,"endColumn":24,"suggestions":[{"fix":{"range":[26381,26405],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":842,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":842,"endColumn":24,"suggestions":[{"fix":{"range":[26563,26625],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":848,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":848,"endColumn":24,"suggestions":[{"fix":{"range":[26774,26799],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":862,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":862,"endColumn":24,"suggestions":[{"fix":{"range":[27245,27272],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":873,"column":17,"nodeType":"MemberExpression","messageId":"unexpected","endLine":873,"endColumn":28,"suggestions":[{"fix":{"range":[27615,27643],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":880,"column":17,"nodeType":"MemberExpression","messageId":"unexpected","endLine":880,"endColumn":28,"suggestions":[{"fix":{"range":[27814,27843],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":884,"column":17,"nodeType":"MemberExpression","messageId":"unexpected","endLine":884,"endColumn":28,"suggestions":[{"fix":{"range":[27974,28447],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":905,"column":17,"nodeType":"MemberExpression","messageId":"unexpected","endLine":905,"endColumn":28,"suggestions":[{"fix":{"range":[28804,28843],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":906,"column":17,"nodeType":"MemberExpression","messageId":"unexpected","endLine":906,"endColumn":28,"suggestions":[{"fix":{"range":[28860,28897],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":908,"column":17,"nodeType":"MemberExpression","messageId":"unexpected","endLine":908,"endColumn":30,"suggestions":[{"fix":{"range":[28946,28981],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":923,"column":17,"nodeType":"MemberExpression","messageId":"unexpected","endLine":923,"endColumn":28,"suggestions":[{"fix":{"range":[29509,29546],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":928,"column":80,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":928,"endColumn":82,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[29762,29764],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":946,"column":66,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":946,"endColumn":68,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[30534,30536],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":947,"column":59,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":947,"endColumn":61,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[30602,30604],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":960,"column":82,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":960,"endColumn":84,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[31220,31222],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":966,"column":23,"nodeType":"MemberExpression","messageId":"unexpected","endLine":966,"endColumn":34,"suggestions":[{"fix":{"range":[31672,31966],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":977,"column":19,"nodeType":"MemberExpression","messageId":"unexpected","endLine":977,"endColumn":30,"suggestions":[{"fix":{"range":[32095,32182],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":978,"column":19,"nodeType":"MemberExpression","messageId":"unexpected","endLine":978,"endColumn":30,"suggestions":[{"fix":{"range":[32201,32242],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":980,"column":19,"nodeType":"MemberExpression","messageId":"unexpected","endLine":980,"endColumn":30,"suggestions":[{"fix":{"range":[32282,32332],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-alert","severity":2,"message":"Unexpected alert.","line":1069,"column":33,"nodeType":"CallExpression","messageId":"unexpected","endLine":1069,"endColumn":49},{"ruleId":"no-alert","severity":2,"message":"Unexpected alert.","line":1074,"column":33,"nodeType":"CallExpression","messageId":"unexpected","endLine":1074,"endColumn":49},{"ruleId":"no-alert","severity":2,"message":"Unexpected alert.","line":1081,"column":33,"nodeType":"CallExpression","messageId":"unexpected","endLine":1081,"endColumn":61},{"ruleId":"no-alert","severity":2,"message":"Unexpected confirm.","line":1112,"column":37,"nodeType":"CallExpression","messageId":"unexpected","endLine":1112,"endColumn":65},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":1117,"column":33,"nodeType":"MemberExpression","messageId":"unexpected","endLine":1117,"endColumn":46,"suggestions":[{"fix":{"range":[41401,41443],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-alert","severity":2,"message":"Unexpected alert.","line":1119,"column":33,"nodeType":"CallExpression","messageId":"unexpected","endLine":1119,"endColumn":65},{"ruleId":"no-alert","severity":2,"message":"Unexpected alert.","line":1135,"column":27,"nodeType":"CallExpression","messageId":"unexpected","endLine":1135,"endColumn":42},{"ruleId":"no-alert","severity":2,"message":"Unexpected alert.","line":1140,"column":27,"nodeType":"CallExpression","messageId":"unexpected","endLine":1140,"endColumn":47},{"ruleId":"no-alert","severity":2,"message":"Unexpected confirm.","line":1145,"column":29,"nodeType":"CallExpression","messageId":"unexpected","endLine":1145,"endColumn":67},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":1155,"column":15,"nodeType":"MemberExpression","messageId":"unexpected","endLine":1155,"endColumn":26,"suggestions":[{"fix":{"range":[42968,43035],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":1166,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":1166,"endColumn":20,"suggestions":[{"fix":{"range":[43264,43288],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":1176,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":1176,"endColumn":22,"suggestions":[{"fix":{"range":[43493,43528],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1204,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1204,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[44108,44111],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[44108,44111],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":1206,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":1206,"endColumn":18,"suggestions":[{"fix":{"range":[44156,44193],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":1210,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":1210,"endColumn":21,"suggestions":[{"fix":{"range":[44307,44333],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":1214,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":1214,"endColumn":18,"suggestions":[{"fix":{"range":[44364,44405],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":1220,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":1220,"endColumn":18,"suggestions":[{"fix":{"range":[44521,44544],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":1222,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":1222,"endColumn":20,"suggestions":[{"fix":{"range":[44573,44606],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1227,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1227,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[44678,44681],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[44678,44681],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1227,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1227,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[44693,44696],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[44693,44696],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":1229,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":1229,"endColumn":18,"suggestions":[{"fix":{"range":[44740,44765],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":1234,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":1234,"endColumn":18,"suggestions":[{"fix":{"range":[44869,44893],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1243,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1243,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[45096,45099],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[45096,45099],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1243,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1243,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[45111,45114],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[45111,45114],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":1248,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":1248,"endColumn":18,"suggestions":[{"fix":{"range":[45248,45296],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":1251,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":1251,"endColumn":19,"suggestions":[{"fix":{"range":[45374,45402],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1256,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1256,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[45462,45465],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[45462,45465],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":1261,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":1261,"endColumn":18,"suggestions":[{"fix":{"range":[45587,45631],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":1265,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":1265,"endColumn":19,"suggestions":[{"fix":{"range":[45721,45749],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]}],"suppressedMessages":[],"errorCount":35,"fatalErrorCount":0,"warningCount":114,"fixableErrorCount":4,"fixableWarningCount":0,"source":"'use client'\n\nimport { useEffect, useRef, useState, useCallback } from 'react'\nimport { grapesJSPageService, type GrapesJSPageData } from '@/lib/services/grapesjs-page-service'\nimport { showSanityImagePicker } from './sanity-image-picker'\nimport loadCustomPlugins from './plugins'\nimport 'grapesjs/dist/css/grapes.min.css'\n\ninterface GrapesEditorProps {\n  readonly pageId?: string\n  readonly onSave?: (pageData: GrapesJSPageData) => void\n}\n\nexport default function GrapesEditor({ pageId, onSave }: GrapesEditorProps) {\n  const editorRef = useRef<HTMLDivElement>(null)\n  const [editor, setEditor] = useState<any>(null)\n  const [currentPage, setCurrentPage] = useState<GrapesJSPageData | null>(null)\n\n  // 保存頁面函數 - 使用 useCallback 確保引用穩定\n  const handleSave = useCallback(async () => {\n    if (!editor || !currentPage) {\n      console.warn('編輯器或當前頁面未準備好', { \n        hasEditor: !!editor, \n        hasPage: !!currentPage,\n        pageId: currentPage?._id \n      })\n      return\n    }\n\n    try {\n      console.log('🔄 開始保存頁面:', currentPage.title)\n      \n      // 顯示保存中狀態\n      const saveButton = editor.Panels?.getButton?.('options', 'save-page')\n      if (saveButton) {\n        saveButton.set('attributes', { ...saveButton.get('attributes'), className: 'fa fa-spinner fa-spin', title: '保存中...' })\n      }\n      \n      // 獲取基本編輯器內容\n      const html = editor.getHtml()\n      const css = editor.getCss()\n      const components = editor.getComponents()\n      \n      // 檢查內容是否為空\n      if (!html || html.trim() === '') {\n        console.warn('警告: HTML 內容為空')\n      }\n      \n      // 清理 HTML 內容，移除可能導致 hydration 問題的標籤\n      let finalHtml = html\n        .replace(/<\\/?body[^>]*>/gi, '')\n        .replace(/<\\/?html[^>]*>/gi, '')\n        .replace(/<\\/?head[^>]*>/gi, '')\n        .replace(/<!DOCTYPE[^>]*>/gi, '')\n        .trim()\n      \n      const finalCss = css\n      \n      console.log('📊 最終內容統計:', {\n        originalHtmlLength: html.length,\n        finalHtmlLength: finalHtml.length,\n        originalCssLength: css.length,\n        finalCssLength: finalCss.length,\n        hasComponents: components.length > 0\n      })\n      \n      // 獲取樣式 - 使用正確的 API 並處理可能的 undefined\n      const stylesManager = editor.StyleManager\n      const styles = stylesManager?.getAll()?.models || []\n      \n      // 安全地將組件轉換為 JSON 字符串 (處理可能的循環引用)\n      let componentsJson, stylesJson\n      try {\n        // 克隆組件，避免循環引用問題\n        const componentsClone = JSON.parse(JSON.stringify(components))\n        componentsJson = JSON.stringify(componentsClone)\n      } catch (jsonError) {\n        console.error('組件序列化失敗:', jsonError)\n        // 嘗試使用替代方法\n        componentsJson = JSON.stringify(\n          components.map((comp: any) => ({\n            tagName: comp.get('tagName'),\n            content: comp.get('content'),\n            type: comp.get('type'),\n            attributes: comp.getAttributes()\n          }))\n        )\n      }\n      \n      try {\n        // 克隆樣式，避免循環引用問題\n        const stylesClone = JSON.parse(JSON.stringify(styles))\n        stylesJson = JSON.stringify(stylesClone)\n      } catch (jsonError) {\n        console.error('樣式序列化失敗:', jsonError)\n        // 使用基本樣式資訊\n        stylesJson = JSON.stringify(\n          styles.map((style: any) => ({\n            selectors: style.get('selectors')?.toString() || '',\n            style: style.get('style') || {}\n          }))\n        )\n      }\n\n      console.log('📄 頁面內容準備保存:', {\n        htmlLength: finalHtml.length,\n        cssLength: finalCss.length,\n        componentsJsonLength: componentsJson.length,\n        stylesJsonLength: stylesJson.length,\n        hasComponents: components.length > 0,\n        hasStyles: styles.length > 0\n      })\n\n      // 更新頁面數據 - 使用增強的內容並添加網路錯誤處理\n      let updatedPage\n      const maxRetries = 3\n      let retryCount = 0\n      \n      const attemptSave = async (shouldPublish: boolean = false): Promise<any> => {\n        try {\n          const updateParams: any = {\n            _id: currentPage._id!,\n            grapesHtml: finalHtml,\n            grapesCss: finalCss,\n            grapesComponents: componentsJson,\n            grapesStyles: stylesJson\n          }\n          \n          // 如果要求發布，則設置狀態為已發布\n          if (shouldPublish) {\n            updateParams.status = 'published'\n          }\n          \n          return await grapesJSPageService.updatePage(updateParams)\n        } catch (error) {\n          if (retryCount < maxRetries) {\n            retryCount++\n            console.log(`保存失敗，第 ${retryCount} 次重試...`)\n            // 增加延遲時間，使用指數退避策略\n            await new Promise(resolve => setTimeout(resolve, 1000 * retryCount))\n            return attemptSave(shouldPublish)\n          }\n          throw error\n        }\n      }\n      \n      try {\n        // 預設儲存時自動發布，讓用戶可以在前端看到變更\n        updatedPage = await attemptSave(true)\n      } catch (networkError) {\n        // 處理網路錯誤\n        console.error('🌐 網路請求錯誤詳情:', {\n          error: networkError,\n          message: networkError instanceof Error ? networkError.message : 'Unknown error',\n          name: networkError instanceof Error ? networkError.name : 'Unknown',\n          type: typeof networkError,\n          stack: networkError instanceof Error ? networkError.stack : undefined\n        })\n        \n        if (networkError instanceof TypeError && networkError.message.includes('network')) {\n          throw new Error('網路連接失敗，請檢查網路連接後重試')\n        } else if (networkError instanceof Error && networkError.message.includes('fetch')) {\n          throw new Error('保存請求失敗，請重試')\n        } else if (networkError instanceof Error && networkError.message.toLowerCase().includes('timeout')) {\n          throw new Error('請求超時，請重試')\n        } else if (networkError instanceof Error && networkError.message.toLowerCase().includes('cors')) {\n          throw new Error('跨域請求錯誤，請聯繫開發者')\n        } else {\n          throw networkError\n        }\n      }\n\n      console.log('✅ 頁面保存成功:', updatedPage._id)\n      \n      // 更新當前頁面狀態\n      setCurrentPage(updatedPage)\n      \n      // 調用外部回調\n      onSave?.(updatedPage)\n      \n      // 在編輯器中顯示成功提示\n      if (saveButton) {\n        const originalIcon = saveButton.get('attributes')?.className || 'fa fa-save'\n        saveButton.set('attributes', { ...saveButton.get('attributes'), className: 'fa fa-check', title: '已保存 ✅' })\n        \n        // 3秒後恢復原圖標\n        setTimeout(() => {\n          saveButton.set('attributes', { ...saveButton.get('attributes'), className: originalIcon, title: '保存頁面 (Ctrl+S)' })\n        }, 3000)\n      }\n      \n    } catch (error) {\n      console.error('❌ 保存頁面失敗:', error)\n      \n      // 在編輯器中顯示錯誤提示\n      const saveButton = editor.Panels?.getButton?.('options', 'save-page')\n      if (saveButton) {\n        const originalIcon = saveButton.get('attributes')?.className || 'fa fa-save'\n        const errorMessage = error instanceof Error ? error.message : '保存失敗'\n        saveButton.set('attributes', { ...saveButton.get('attributes'), className: 'fa fa-times', title: `❌ ${errorMessage}` })\n        \n        // 5秒後恢復原圖標\n        setTimeout(() => {\n          saveButton.set('attributes', { ...saveButton.get('attributes'), className: originalIcon, title: '保存頁面 (Ctrl+S)' })\n        }, 5000)\n      }\n      \n      // 顯示用戶友好的錯誤提示\n      if (typeof window !== 'undefined') {\n        const errorMessage = error instanceof Error ? error.message : '保存失敗，請重試'\n        // 使用原生提示或自定義通知\n        alert(`保存失敗: ${errorMessage}`)\n      }\n      \n      // 拋出錯誤以便外部處理\n      throw error\n    }\n  }, [editor, currentPage, onSave])\n\n  // 全域 Ctrl+S 防護機制 - 在組件載入時就設置，確保完全阻止瀏覽器儲存行為\n  useEffect(() => {\n    const preventBrowserSave = (e: KeyboardEvent) => {\n      if ((e.ctrlKey || e.metaKey) && e.key === 's') {\n        console.log('🚫 全域攔截器：阻止瀏覽器儲存網頁行為')\n        e.preventDefault()\n        e.stopPropagation()\n        \n        // 如果編輯器和當前頁面都已準備好，直接觸發保存\n        if (editor && currentPage && handleSave) {\n          console.log('💾 全域攔截器：觸發編輯器保存')\n          handleSave().catch(error => {\n            console.error('全域攔截器保存失敗:', error)\n          })\n        } else {\n          console.log('⏳ 全域攔截器：編輯器或頁面尚未準備好', { \n            hasEditor: !!editor, \n            hasCurrentPage: !!currentPage,\n            hasHandleSave: !!handleSave\n          })\n        }\n        return false\n      }\n    }\n\n    // 在捕獲階段攔截，確保早於其他事件處理器\n    document.addEventListener('keydown', preventBrowserSave, { capture: true, passive: false })\n    \n    return () => {\n      document.removeEventListener('keydown', preventBrowserSave, { capture: true })\n    }\n  }, [editor, currentPage, handleSave])\n\n  // 當編輯器和保存函數都準備好後，註冊命令和快捷鍵\n  useEffect(() => {\n    if (!editor) return\n\n    // 添加自定義命令\n    editor.Commands.add('save-page', {\n      run: handleSave\n    })\n\n    // 添加快捷鍵 Ctrl+S 或 Cmd+S (修復快捷鍵)\n    editor.Keymaps.add('save-page', 'ctrl+s, cmd+s', 'save-page')\n    \n    // 添加額外的全域鍵盤事件處理，確保快捷鍵在所有情況下都能工作\n    const handleGlobalKeyDown = (e: KeyboardEvent) => {\n      if ((e.ctrlKey || e.metaKey) && e.key === 's') {\n        // 強制阻止瀏覽器的預設儲存行為\n        e.preventDefault()\n        e.stopPropagation()\n        e.stopImmediatePropagation()\n        console.log('🔑 偵測到快捷鍵 Ctrl+S/Cmd+S，觸發保存')\n        handleSave().catch(error => {\n          console.error('快捷鍵保存失敗:', error)\n        })\n        return false\n      }\n    }\n\n    // 綁定到 document 以確保全域捕獲，使用捕獲模式和非被動模式\n    document.addEventListener('keydown', handleGlobalKeyDown, { capture: true, passive: false })\n    \n    // 添加工具欄按鈕（如果還沒有的話）\n    const existingButton = editor.Panels.getButton('options', 'save-page')\n    if (!existingButton) {\n      editor.Panels.addButton('options', [\n        {\n          id: 'save-page',\n          className: 'fa fa-save',\n          command: 'save-page',\n          attributes: { title: '保存頁面 (Ctrl+S)' }\n        }\n      ])\n    }\n\n    // 添加測試按鈕來查看完整輸出\n    editor.Panels.addButton('options', [\n      {\n        id: 'test-output',\n        className: 'fa fa-eye',\n        command: 'test-output',\n        attributes: { title: '查看完整 HTML 輸出' }\n      }\n    ])\n\n    editor.Commands.add('test-output', {\n      run: () => {\n        const html = editor.getHtml()\n        const css = editor.getCss()\n        const components = editor.getComponents()\n        \n        // 獲取完整的組件樹內容，包括內聯樣式和腳本\n        const getFullContent = (comps: any[]) => {\n          let fullHtml = ''\n          let inlineCss = ''\n          let inlineJs = ''\n          \n          comps.forEach((comp: any) => {\n            const compHtml = comp.toHTML ? comp.toHTML() : comp.get('content') || ''\n            fullHtml += compHtml\n            \n            // 檢查組件的樣式和腳本\n            const style = comp.get('style') || comp.getStyle?.() || ''\n            const script = comp.get('script') || comp.getScript?.() || ''\n            \n            if (style) inlineCss += `\\n/* Component ${comp.get('tagName')} styles */\\n${style}`\n            if (script) inlineJs += `\\n/* Component ${comp.get('tagName')} script */\\n${script}`\n            \n            // 遞歸處理子組件\n            const children = comp.get('components') || comp.components?.models || []\n            if (children.length > 0) {\n              const childContent = getFullContent(children)\n              fullHtml += childContent.html\n              inlineCss += childContent.css\n              inlineJs += childContent.js\n            }\n          })\n          \n          return { html: fullHtml, css: inlineCss, js: inlineJs }\n        }\n        \n        const fullContent = getFullContent(components)\n        const allCss = css + fullContent.css\n        const allJs = fullContent.js\n        \n        console.log('=== 基本 HTML ===')\n        console.log(html)\n        console.log('=== 完整 HTML（含組件內容）===')\n        console.log(fullContent.html)\n        console.log('=== 基本 CSS ===')\n        console.log(css)\n        console.log('=== 完整 CSS（含內聯樣式）===')\n        console.log(allCss)\n        console.log('=== JavaScript ===')\n        console.log(allJs)\n        \n        const fullHtml = `\n<!DOCTYPE html>\n<html>\n<head>\n  <style>\n${allCss}\n  </style>\n</head>\n<body>\n${html}\n${allJs ? `<script>${allJs}</script>` : ''}\n</body>\n</html>`\n        \n        // 在新視窗中打開完整 HTML\n        const newWindow = window.open()\n        if (newWindow) {\n          newWindow.document.write(fullHtml)\n          newWindow.document.close()\n        } else {\n          // 如果彈出視窗被阻擋，顯示在控制台\n          console.log('完整 HTML 輸出:')\n          console.log(fullHtml)\n          alert('完整 HTML 已輸出到控制台 (F12)')\n        }\n      }\n    })\n\n    console.log('✅ 保存命令、快捷鍵和測試功能已註冊')\n    \n    // 清理函數\n    return () => {\n      document.removeEventListener('keydown', handleGlobalKeyDown, { capture: true })\n    }\n  }, [editor, handleSave])\n\n  useEffect(() => {\n    // 確保 DOM 已準備好\n    const initEditor = async () => {\n      // 首先檢查是否已經初始化過\n      if (editor) {\n        console.log('📋 編輯器已存在，跳過初始化')\n        return\n      }\n\n      // 等待 DOM 完全準備好\n      if (typeof window === 'undefined') {\n        console.log('⏳ 服務器端渲染環境，等待客戶端...')\n        return\n      }\n\n      // 使用更強健的容器檢查\n      const checkContainer = () => {\n        if (!editorRef || !editorRef.current) {\n          console.log('⏳ 編輯器 ref 尚未設置或為 null')\n          return false\n        }\n\n        // 檢查容器是否真的在頁面上\n        try {\n          if (!document.contains(editorRef.current)) {\n            console.log('⏳ 編輯器容器不在 DOM 中')\n            return false\n          }\n        } catch (error) {\n          console.log('⏳ 檢查容器 DOM 狀態時出錯:', error)\n          return false\n        }\n\n        // 檢查容器是否已連接（如果支援此屬性）\n        if ('isConnected' in editorRef.current && !editorRef.current.isConnected) {\n          console.log('⏳ 編輯器容器尚未連接到 DOM')\n          return false\n        }\n\n        // 檢查容器尺寸（但允許一些彈性）\n        try {\n          const rect = editorRef.current.getBoundingClientRect()\n          if (rect.width === 0 && rect.height === 0) {\n            console.log('⏳ 編輯器容器尺寸為 0，等待布局完成...', { width: rect.width, height: rect.height })\n            return false\n          }\n        } catch (error) {\n          console.log('⏳ 獲取容器尺寸時出錯，但繼續初始化:', error)\n          // 繼續，不阻止初始化\n        }\n\n        return true\n      }\n\n      // 容器檢查和重試邏輯\n      const retryCount = (initEditor as any).retryCount || 0\n      if (!checkContainer()) {\n        console.log(`⏳ 編輯器容器尚未準備好，等待中... (嘗試 ${retryCount + 1}/30)`)\n        \n        if (retryCount < 30) { // 增加重試次數到 30 次\n          ;(initEditor as any).retryCount = retryCount + 1\n          setTimeout(initEditor, 200) // 增加等待時間到 200ms\n          return\n        } else {\n          console.error('❌ 編輯器初始化失敗：容器在 30 次嘗試後仍未準備好')\n          // 如果容器完全沒有，則直接返回，不再嘗試\n          if (!editorRef.current) {\n            console.error('❌ 編輯器容器為 null，無法繼續')\n            return\n          }\n          // 如果容器存在但檢查失敗，嘗試強制初始化\n          console.warn('⚠️ 嘗試強制初始化編輯器...')\n        }\n      }\n\n      // 重置重試計數器\n      ;(initEditor as any).retryCount = 0\n\n      try {\n        console.log('🚀 開始初始化 GrapesJS 編輯器...')\n        \n        // 網路連接測試\n        if (typeof window !== 'undefined' && !navigator.onLine) {\n          console.warn('⚠️ 檢測到離線狀態，某些功能可能無法正常工作')\n        }\n        \n        console.log('✅ 編輯器容器已準備好:', {\n          container: editorRef.current,\n          isConnected: editorRef.current?.isConnected,\n          rect: editorRef.current?.getBoundingClientRect(),\n          id: editorRef.current?.id\n        })\n\n        const grapesjs = (await import('grapesjs')).default\n        const pluginWebpage = (await import('grapesjs-preset-webpage')).default\n        \n        // 動態導入額外的插件\n        const pluginBasicBlocks = (await import('grapesjs-blocks-basic')).default\n        const pluginForms = (await import('grapesjs-plugin-forms')).default\n        const pluginTabs = (await import('grapesjs-tabs')).default\n        const pluginTyped = (await import('grapesjs-typed')).default\n        const pluginCountdown = (await import('grapesjs-component-countdown')).default\n        const pluginTooltip = (await import('grapesjs-tooltip')).default\n        const pluginScriptEditor = (await import('grapesjs-script-editor')).default\n        \n        // 導入代碼編輯器插件\n        const pluginCodeEditor = (await import('grapesjs-component-code-editor')).default\n        \n        // 導入 Carousel 插件\n        const pluginCarousel = (await import('grapesjs-carousel-component')).default\n        \n \n        console.log('📦 所有插件模組載入完成，包含代碼編輯器和 Carousel 插件')\n        \n        // 獲取自定義插件\n        const customPlugins = loadCustomPlugins()\n        console.log('🎯 已載入自定義插件:', customPlugins)\n\n        // 最終的容器安全檢查，但提供更好的錯誤恢復\n        let containerElement = editorRef.current\n        \n        if (!containerElement) {\n          console.error('❌ 編輯器容器在最終檢查時為 null')\n          console.error('📊 調試信息:', {\n            hasRef: !!editorRef,\n            currentValue: editorRef.current,\n            typeOfRef: typeof editorRef.current,\n            domElement: document.getElementById('grapesjs-editor-container')\n          })\n          \n          // 嘗試通過 ID 找到容器作為備用方案\n          const fallbackContainer = document.getElementById('grapesjs-editor-container')\n          if (fallbackContainer) {\n            console.warn('⚠️ 使用備用容器方法初始化編輯器')\n            containerElement = fallbackContainer as HTMLDivElement\n          } else {\n            console.error('❌ 無法找到編輯器容器，延遲重試')\n            // 延遲重試而不是拋出錯誤\n            setTimeout(initEditor, 500)\n            return\n          }\n        }\n\n        console.log('✅ 確認容器可用，開始初始化 GrapesJS...')\n\n        const editorInstance = grapesjs.init({\n          container: containerElement,\n          height: '100vh',\n          width: 'auto',\n          // 加載插件 - 移除內聯的自定義組件定義\n          plugins: [\n            pluginWebpage,\n            pluginBasicBlocks,\n            pluginForms, \n            pluginTabs,\n            pluginTyped,\n            pluginCountdown,\n            pluginTooltip,\n            pluginScriptEditor,\n            pluginCodeEditor,\n            pluginCarousel,\n \n            (await import('./plugins/safe-tailwind-components')).default, // 安全 Tailwind 組件\n            // 添加自定義插件\n            ...customPlugins.map(p => p.plugin)\n          ],\n        pluginsOpts: {\n          [pluginWebpage]: {\n            // 基本配置，確保面板顯示\n            blocksBasicOpts: {\n              flexGrid: true,\n            }\n          },\n          [pluginBasicBlocks]: {\n            // 自定義基本塊配置\n            flexGrid: true,\n            blocks: ['column1', 'column2', 'column3', 'column3-7', 'text', 'link', 'image', 'video', 'map'],\n          },\n          [pluginForms]: {\n            // 表單插件配置\n            blocks: ['form', 'input', 'textarea', 'select', 'button', 'label', 'checkbox', 'radio'],\n          },\n          [pluginTabs]: {\n            // 標籤頁插件配置\n            tabsBlock: {\n              category: 'Extra'\n            }\n          },\n          [pluginTyped]: {\n            // 打字動畫插件配置\n            block: {\n              category: 'Extra',\n              content: {\n                type: 'typed',\n                strings: ['輸入您的文字...', '編輯此動畫文字'],\n                typeSpeed: 40,\n                backSpeed: 40,\n                loop: true\n              }\n            }\n          },\n          [pluginCountdown]: {\n            // 倒數計時器插件配置\n            block: {\n              category: 'Extra',\n              label: '倒數計時器',\n              content: {\n                type: 'countdown',\n                endTime: '2025-12-31 23:59:59'\n              }\n            }\n          },\n          [pluginTooltip]: {\n            // 工具提示插件配置\n            labelTooltip: '工具提示',\n            blockTooltip: {\n              label: '工具提示',\n              category: 'Extra'\n            },\n            attrTooltip: 'data-tooltip',\n            classTooltip: 'tooltip-component'\n          },\n          'grapesjs-script-editor': {\n            // 腳本編輯器插件配置 - 為組件添加 JavaScript 腳本\n            starter: 'let el = this; // 選中的元素\\n// 在此編寫您的 JavaScript 代碼',\n            toolbarIcon: '<i class=\"fa fa-code\"></i>',\n            modalTitle: '編輯組件腳本',\n            buttonLabel: '保存腳本',\n            onRun: () => console.log('✅ 腳本語法正確'),\n            onError: (err: any) => console.error('❌ 腳本錯誤:', err),\n            codeViewOptions: {\n              theme: 'hopscotch',\n              lineNumbers: true,\n              styleActiveLine: true,\n              autoCloseBrackets: true\n            }\n          },\n          'gjs-component-code-editor': {\n            // 代碼編輯器插件配置\n            modalTitle: '程式碼編輯器',\n            codeViewOptions: {\n              theme: 'hopscotch',\n              lineNumbers: true,\n              styleActiveLine: true,\n              autoCloseBrackets: true,\n              matchBrackets: true,\n              mode: 'htmlmixed'  // 支持 HTML、CSS、JS 混合模式\n            },\n            // 編輯器面板配置\n            panelTitle: '程式碼',\n            commandName: 'open-code-editor',\n            // 組件選擇器，決定哪些組件可以使用代碼編輯器\n            editJs: true,    // 允許編輯 JavaScript\n            editCss: true,   // 允許編輯 CSS  \n            editHtml: true   // 允許編輯 HTML\n          },\n          'grapesjs-carousel-component': {\n            // Carousel 插件配置\n            blockName: 'carousel',\n            blockCategory: 'Media',\n            blockLabel: '輪播組件',\n            // Splide.js 預設配置\n            splideOptions: {\n              type: 'loop',\n              perPage: 1,\n              autoplay: true,\n              interval: 3000\n            }\n          },\n          // 為自定義插件添加配置\n          ...customPlugins.reduce((opts: any, plugin) => {\n            opts[plugin.name] = plugin.options || {}\n            return opts\n          }, {})\n        },\n        // 設備管理器配置\n        deviceManager: {\n          devices: [\n            {\n              name: '桌面',\n              width: '',\n            },\n            {\n              name: '平板',\n              width: '768px',\n              widthMedia: '992px',\n            },\n            {\n              name: '手機直向',\n              width: '320px',\n              widthMedia: '768px',\n            },\n          ],\n        },\n        // Canvas 配置 - 載入 Carousel 相關資源到編輯器畫布\n        canvas: {\n          styles: [\n            'https://cdn.jsdelivr.net/npm/@splidejs/splide@4.1.4/dist/css/splide.min.css'\n          ],\n          scripts: [\n            'https://cdn.jsdelivr.net/npm/@redoc_a2k/splide@4.1.4/dist/js/splide.min.js'\n          ]\n        },\n        // 存儲管理器配置\n        storageManager: false, // 我們使用自己的保存邏輯\n        \n        // 資產管理器配置 - 整合 Sanity 媒體庫\n        assetManager: {\n          uploadFile: async (e: any) => {\n            const files = e.dataTransfer ? e.dataTransfer.files : e.target.files\n            const file = files[0]\n            if (!file) return\n\n            try {\n              const formData = new FormData()\n              formData.append('file', file)\n              \n              const response = await fetch('/api/sanity/upload', {\n                method: 'POST',\n                body: formData\n              })\n              \n              if (!response.ok) {\n                throw new Error(`Upload failed: ${response.status}`)\n              }\n              \n              const data = await response.json()\n              if (!data.success) {\n                throw new Error(data.error || 'Upload failed')\n              }\n              \n              return {\n                src: data.image.url,\n                name: data.image.originalFilename,\n                size: data.image.size\n              }\n            } catch (error) {\n              console.error('Asset upload error:', error)\n              throw error\n            }\n          },\n          \n          // 自定義上傳按鈕點擊處理\n          upload: false, // 禁用默認上傳，使用我們的自定義處理\n        },\n      })\n\n        console.log('✅ 編輯器初始化完成')\n        \n        // 設置自定義資產管理器行為\n        const assetManager = editorInstance.AssetManager\n        \n        // 添加自定義命令來打開 Sanity 圖片選擇器\n        editorInstance.Commands.add('open-sanity-assets', {\n          run: () => {\n            showSanityImagePicker({\n              onSelect: (imageUrl: string) => {\n                // 將選擇的圖片添加到資產管理器\n                assetManager.add({\n                  type: 'image',\n                  src: imageUrl,\n                  name: 'Sanity Image',\n                })\n                \n                // 如果有選中的組件，並且是圖片組件，直接設置 src\n                const selected = editorInstance.getSelected()\n                if (selected && selected.is('image')) {\n                  selected.set('src', imageUrl)\n                }\n                \n                console.log('✅ 已選擇 Sanity 圖片:', imageUrl)\n              },\n              onClose: () => {\n                console.log('📂 Sanity 圖片選擇器已關閉')\n              },\n              allowUpload: true\n            })\n          }\n        })\n        \n        // 重寫資產管理器的打開行為\n        const originalShowAssets = editorInstance.Commands.get('open-assets')\n        if (originalShowAssets) {\n          editorInstance.Commands.add('open-assets', {\n            run: () => {\n              // 打開我們的 Sanity 圖片選擇器而不是默認的資產管理器\n              editorInstance.Commands.run('open-sanity-assets')\n            }\n          })\n        }\n        \n        // 監聽圖片組件的雙擊事件，打開 Sanity 圖片選擇器\n        editorInstance.on('component:selected', (component: any) => {\n          if (component.is('image')) {\n            // 為圖片組件添加雙擊監聽器\n            const view = component.getView()\n            if (view && view.el) {\n              view.el.ondblclick = () => {\n                editorInstance.Commands.run('open-sanity-assets')\n              }\n            }\n          }\n        })\n        \n        setEditor(editorInstance)\n\n        // 添加全域網路錯誤監聽器\n        if (typeof window !== 'undefined') {\n          const handleNetworkError = (event: Event) => {\n            console.error('🌐 網路錯誤事件:', event)\n            // 可以在這裡添加用戶提示\n          }\n          \n          const handleOnlineStatusChange = () => {\n            if (navigator.onLine) {\n              console.log('✅ 網路連接已恢復')\n            } else {\n              console.warn('❌ 網路連接已斷開')\n            }\n          }\n          \n          window.addEventListener('error', handleNetworkError)\n          window.addEventListener('online', handleOnlineStatusChange)\n          window.addEventListener('offline', handleOnlineStatusChange)\n        }\n\n        // 確保面板正確顯示\n        console.log('📋 設置面板可見性...')\n        \n        // 等一下讓編輯器完全加載後再配置面板\n        setTimeout(() => {\n          // 手動打開面板\n          const commands = editorInstance.Commands\n          \n          // 打開組件庫面板\n          if (commands.has('show-blocks')) {\n            commands.run('show-blocks')\n            console.log('✅ 組件庫面板已打開')\n          }\n          \n          // 打開圖層面板\n          if (commands.has('show-layers')) {\n            commands.run('show-layers') \n            console.log('✅ 圖層面板已打開')\n          }\n          \n                    // 確保組件庫面板可見\n          const blockManager = editorInstance.BlockManager\n          if (blockManager) {\n            console.log('✅ 組件庫已載入，共', blockManager.getAll().length, '個組件')\n          }\n          \n          // 確保圖層面板可見  \n          const layerManager = editorInstance.LayerManager\n          if (layerManager) {\n            console.log('✅ 圖層管理器已載入')\n          }\n          \n          // 添加 script-editor 工具欄按鈕\n          if (editorInstance.Commands.has('edit-script')) {\n            const panelManager = editorInstance.Panels\n            panelManager.addButton('options', [\n              {\n                id: 'edit-script',\n                className: 'fa fa-code',\n                command: 'edit-script',\n                attributes: { title: '編輯組件腳本' }\n              }\n            ])\n            console.log('✅ 腳本編輯器按鈕已添加')\n          }\n\n          // 使用 GrapesJS API 添加頁面切換器到 options 面板\n          const addPageSwitcher = async () => {\n            if (pageId) {\n              \n              // 檢查是否已經添加過\n              const existingButton = editorInstance.Panels.getButton('options', 'page-switcher')\n              \n              if (existingButton) {\n                console.log('頁面切換器已存在，跳過添加')\n                return\n              }\n              \n              // 獲取所有可用頁面列表\n              let allPages: GrapesJSPageData[] = []\n              try {\n                console.log('🔍 開始獲取頁面清單...')\n                allPages = await grapesJSPageService.getAllPages()\n                \n                // 詳細記錄每個頁面狀態\n                console.log('✅ 成功獲取頁面清單:', {\n                  總數: allPages.length,\n                  頁面列表: allPages.map(p => ({ \n                    id: p._id, \n                    title: p.title,\n                    slug: p.slug,\n                    status: p.status,\n                    hasHtml: !!p.grapesHtml,\n                    hasCss: !!p.grapesCss,\n                    _createdAt: p._createdAt,\n                    _updatedAt: p._updatedAt\n                  }))\n                })\n                \n                // 統計各種狀態的頁面數量\n                const statusCounts = allPages.reduce((counts, page) => {\n                  const status = page.status || 'undefined'\n                  counts[status] = (counts[status] || 0) + 1\n                  return counts\n                }, {} as Record<string, number>)\n                \n                console.log('📊 頁面狀態統計:', statusCounts)\n                console.log('🔍 原始查詢返回數據:', allPages)\n              } catch (error) {\n                console.error('❌ 載入頁面列表失敗:', error)\n                // 如果獲取失敗，至少包含當前頁面\n                allPages = [{\n                  _id: pageId,\n                  _type: 'grapesJSPageV2',\n                  title: '當前頁面',\n                  slug: { current: 'current-page' },\n                  status: 'draft' as const,\n                  version: 1,\n                  viewport: 'responsive' as const,\n                  grapesHtml: '',\n                  grapesCss: '',\n                  grapesComponents: '',\n                  grapesStyles: ''\n                }]\n                console.log('⚠️ 使用備用頁面列表:', allPages)\n              }\n\n              // 找到當前頁面資料以用於按鈕標題\n              const currentPageForButton = allPages.find(page => page._id === pageId)\n              const currentSlugForButton = currentPageForButton?.slug?.current || pageId.slice(-8)\n              \n              // 使用 GrapesJS Panels API 添加頁面切換器按鈕到 options 面板\n              editorInstance.Panels.addButton('options', {\n                id: 'page-switcher',\n                className: 'fa fa-list',\n                command: 'page-switcher',\n                attributes: { title: `切換頁面 (當前: ${currentSlugForButton})` },\n                active: false\n              })\n\n              // 添加自定義命令處理頁面切換\n              editorInstance.Commands.add('page-switcher', {\n                run: () => {\n                  const currentPageId = pageId\n                  \n                  // 找到當前頁面的資料\n                  const currentPage = allPages.find(page => page._id === currentPageId)\n                  const currentSlug = currentPage?.slug?.current || '未知頁面'\n                  const currentTitle = currentPage?.title || '未命名頁面'\n                  \n                  // 生成所有頁面選項，包括當前頁面\n                  const pageOptions = allPages\n                    .filter(page => page._id) // 只過濾掉沒有 _id 的頁面\n                    .map(page => {\n                      const isCurrentPage = page._id === currentPageId\n                      const statusEmoji = {\n                        'draft': '📝',\n                        'preview': '👁️',\n                        'published': '✅',\n                        'archived': '🗄️'\n                      }[page.status] || '❓'\n                      const pageSlug = page.slug?.current || page._id?.slice(-8) || '未知'\n                      const displayName = `${page.title || '未命名頁面'} (${pageSlug})`\n                      const statusText = `${statusEmoji} ${displayName}`\n                      const selectedAttr = isCurrentPage ? ' selected' : ''\n                      const currentMark = isCurrentPage ? ' (當前)' : ''\n                      const option = `<option value=\"${page._id}\"${selectedAttr}>${statusText}${currentMark}</option>`\n                      console.log('📄 生成頁面選項:', { \n                        pageId: page._id?.slice(-8), \n                        title: page.title, \n                        status: page.status,\n                        isCurrentPage, \n                        option: option.substring(0, 120) \n                      })\n                      return option\n                    })\n                    .join('')\n                    \n                  console.log(`📋 頁面選項生成完成: 當前頁面ID=${currentPageId?.slice(-8)}, 總選項數=${allPages.length}`)\n                  console.log('🔧 生成的HTML選項:', pageOptions)\n                    \n                  console.log(`📋 顯示頁面清單: 共 ${allPages.length} 個頁面`)\n                  \n                  const modal = editorInstance.Modal\n                  modal.setTitle('<span style=\"color: white;\">🔄 切換編輯頁面</span>')\n                  modal.setContent(`\n                    <div style=\"padding: 25px; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; color: #2c3e50;\">\n                      <div style=\"margin-bottom: 20px; padding: 15px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 8px;\">\n                        <h4 style=\"margin: 0 0 8px 0; font-size: 16px; color: white;\">當前頁面</h4>\n                        <p style=\"margin: 0; font-family: Monaco, 'Courier New', monospace; background: rgba(255,255,255,0.2); padding: 5px 10px; border-radius: 4px; font-size: 14px; color: white;\">\n                          <strong>代稱:</strong> ${currentSlug}<br>\n                          <strong>標題:</strong> ${currentTitle}\n                        </p>\n                      </div>\n                      \n                      <div style=\"margin-bottom: 20px;\">\n                        <label for=\"page-select\" style=\"display: block; margin-bottom: 8px; font-weight: 600; color: white;\">選擇要切換的頁面:</label>\n                        <select id=\"page-select\" style=\"width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 6px; font-size: 14px; background: white; color: #2c3e50;\">\n                          ${pageOptions}\n                        </select>\n                      </div>\n                      \n                      <div style=\"display: flex; gap: 10px; justify-content: space-between; align-items: center;\">\n                        <button id=\"create-new-page-btn\" style=\"padding: 10px 20px; background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 14px; font-weight: 500;\">\n                          <i class=\"fas fa-plus\" style=\"margin-right: 5px;\"></i>新增頁面\n                        </button>\n                        <div style=\"display: flex; gap: 10px;\">\n                          <button id=\"cancel-switch-btn\" style=\"padding: 10px 20px; background: #6c757d; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 14px; font-weight: 500;\">取消</button>\n                          <button id=\"switch-page-btn\" style=\"padding: 10px 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 14px; font-weight: 500;\">切換頁面</button>\n                        </div>\n                      </div>\n                    </div>\n                  `)\n                  modal.open()\n                  \n                  // 綁定事件\n                  setTimeout(() => {\n                    const switchBtn = document.getElementById('switch-page-btn')\n                    const cancelBtn = document.getElementById('cancel-switch-btn')\n                    const createBtn = document.getElementById('create-new-page-btn')\n                    const selectEl = document.getElementById('page-select') as HTMLSelectElement\n                    \n                    if (cancelBtn) {\n                      cancelBtn.onclick = () => modal.close()\n                    }\n                    \n                    // 新增頁面按鈕事件\n                    if (createBtn) {\n                      createBtn.onclick = async () => {\n                        modal.close()\n                        \n                        // 重新使用同一個 modal 來顯示新增頁面表單\n                        modal.setTitle('新增頁面')\n                        modal.setContent(`\n                          <div style=\"padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 10px; font-family: Arial, sans-serif;\">\n                            <div style=\"margin-bottom: 20px;\">\n                              <label for=\"new-page-title\" style=\"display: block; margin-bottom: 8px; font-weight: 600; color: white;\">頁面標題:</label>\n                              <input type=\"text\" id=\"new-page-title\" placeholder=\"請輸入頁面標題\" style=\"width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 6px; font-size: 14px; background: white; color: #2c3e50; box-sizing: border-box;\">\n                            </div>\n                            \n                            <div style=\"margin-bottom: 20px;\">\n                              <label for=\"new-page-slug\" style=\"display: block; margin-bottom: 8px; font-weight: 600; color: white;\">頁面路徑 (slug):</label>\n                              <input type=\"text\" id=\"new-page-slug\" placeholder=\"例如: about-us\" style=\"width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 6px; font-size: 14px; background: white; color: #2c3e50; box-sizing: border-box;\">\n                            </div>\n                            \n                            <div style=\"display: flex; gap: 10px; justify-content: flex-end;\">\n                              <button id=\"cancel-create-btn\" style=\"padding: 10px 20px; background: #6c757d; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 14px; font-weight: 500;\">取消</button>\n                              <button id=\"confirm-create-btn\" style=\"padding: 10px 20px; background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 14px; font-weight: 500;\">建立頁面</button>\n                            </div>\n                          </div>\n                        `)\n                        modal.open()\n                        \n                        // 綁定新增頁面的事件\n                        setTimeout(() => {\n                          const confirmBtn = document.getElementById('confirm-create-btn')\n                          const cancelCreateBtn = document.getElementById('cancel-create-btn')\n                          const titleInput = document.getElementById('new-page-title') as HTMLInputElement\n                          const slugInput = document.getElementById('new-page-slug') as HTMLInputElement\n                          \n                          if (cancelCreateBtn) {\n                            cancelCreateBtn.onclick = () => modal.close()\n                          }\n                          \n                          if (confirmBtn && titleInput && slugInput) {\n                            confirmBtn.onclick = async () => {\n                              const title = titleInput.value.trim()\n                              const slug = slugInput.value.trim()\n                              \n                              if (!title) {\n                                alert('請輸入頁面標題')\n                                return\n                              }\n                              \n                              if (!slug) {\n                                alert('請輸入頁面路徑')\n                                return\n                              }\n                              \n                              // 驗證slug格式 (只允許字母、數字、連字符)\n                              const slugPattern = /^[a-z0-9-]+$/\n                              if (!slugPattern.test(slug)) {\n                                alert('頁面路徑只能包含小寫字母、數字和連字符')\n                                return\n                              }\n                              \n                              try {\n                                // 設置loading狀態\n                                confirmBtn.innerHTML = '<i class=\"fas fa-spinner fa-spin\" style=\"margin-right: 5px;\"></i>建立中...'\n                                ;(confirmBtn as HTMLButtonElement).disabled = true\n                                \n                                // 呼叫API建立新頁面\n                                const response = await fetch('/api/sanity/pages', {\n                                  method: 'POST',\n                                  headers: {\n                                    'Content-Type': 'application/json',\n                                  },\n                                  body: JSON.stringify({\n                                    title: title,\n                                    slug: slug,\n                                    status: 'draft'\n                                  }),\n                                })\n                                \n                                if (!response.ok) {\n                                  const error = await response.text()\n                                  throw new Error(error || '建立頁面失敗')\n                                }\n                                \n                                const newPage = await response.json()\n                                modal.close()\n                                \n                                // 跳轉到新頁面編輯器\n                                if (confirm('頁面建立成功！是否立即編輯新頁面？')) {\n                                  window.location.href = `/cms/editor?docId=${encodeURIComponent(newPage._id)}&type=grapesJSPageV2`\n                                }\n                                \n                              } catch (err) {\n                                console.error('Error creating page:', err)\n                                const errorMessage = err instanceof Error ? err.message : '未知錯誤'\n                                alert(`建立頁面失敗: ${errorMessage}`)\n                                \n                                // 恢復按鈕狀態\n                                confirmBtn.innerHTML = '建立頁面'\n                                ;(confirmBtn as HTMLButtonElement).disabled = false\n                              }\n                            }\n                          }\n                        }, 100)\n                      }\n                    }\n                    \n                    if (switchBtn && selectEl) {\n                      switchBtn.onclick = () => {\n                        const selectedPageId = selectEl.value\n                        if (!selectedPageId) {\n                          alert('請先選擇頁面')\n                          return\n                        }\n                        \n                        if (selectedPageId === currentPageId) {\n                          alert('您已經在編輯這個頁面了')\n                          modal.close()\n                          return\n                        }\n                        \n                        if (confirm('⚠️ 確定要切換頁面嗎？\\n\\n未保存的更改將會丟失。')) {\n                          window.location.href = `/cms/editor?docId=${encodeURIComponent(selectedPageId)}&type=grapesJSPageV2`\n                        }\n                        modal.close()\n                      }\n                    }\n                  }, 100)\n                }\n              })\n\n              console.log('✅ 頁面切換器已添加到 options 面板，共', allPages.length + 1, '個頁面')\n            }\n          }\n          \n          // 稍微延遲添加頁面切換器，確保面板完全載入\n          setTimeout(addPageSwitcher, 500)\n          \n          // 強制重新渲染面板\n          editorInstance.trigger('change:canvasOffset')\n        }, 200)\n\n        console.log('📋 面板配置完成')\n\n        // 等待編輯器完全初始化後再載入頁面\n        setTimeout(() => {\n          if (pageId) {\n            loadPageWithEditor(editorInstance, pageId)\n          }\n        }, 100)\n        \n      } catch (error) {\n        console.error('❌ 編輯器初始化失敗:', error)\n      }\n    }\n\n    // 使用更穩健的方式確保 DOM 元素準備就緒\n    const waitForContainer = () => {\n      if (editorRef.current) {\n        initEditor()\n      } else {\n        // 如果容器還沒準備好，使用 requestAnimationFrame 等待下一個渲染週期\n        requestAnimationFrame(() => {\n          setTimeout(waitForContainer, 10) // 給額外的時間確保 DOM 完全準備好\n        })\n      }\n    }\n\n    // 立即開始檢查容器可用性\n    waitForContainer()\n    \n    return () => {\n      // 清理編輯器實例\n      if (editor) {\n        editor.destroy?.()\n      }\n    }\n  }, []) // 移除 pageId 依賴項，避免重複初始化\n\n  // 載入頁面的輔助函數\n  const loadPageWithEditor = async (editorInstance: any, pageIdToLoad: string) => {\n    try {\n      console.log('🔄 載入頁面:', pageIdToLoad)\n      const pageData = await grapesJSPageService.getPageById(pageIdToLoad)\n      \n      if (!pageData) {\n        console.warn('⚠️ 找不到頁面數據')\n        return\n      }\n\n      console.log('📄 找到頁面數據:', pageData.title)\n      \n      // 載入頁面內容\n      loadPageContent(editorInstance, pageData)\n      \n      setCurrentPage(pageData)\n      console.log('✅ 頁面載入完成')\n    } catch (error) {\n      console.error('❌ 載入頁面失敗:', error)\n    }\n  }\n\n  // 載入頁面內容的輔助函數\n  const loadPageContent = (editorInstance: any, pageData: any) => {\n    if (pageData.grapesHtml) {\n      console.log('載入 HTML 內容')\n      editorInstance.setComponents(pageData.grapesHtml)\n    }\n    \n    if (pageData.grapesCss) {\n      console.log('載入 CSS 樣式')\n      editorInstance.setStyle(pageData.grapesCss)\n    }\n    \n    loadComponentsData(editorInstance, pageData)\n    loadStylesData(pageData)\n  }\n\n  // 載入組件數據\n  const loadComponentsData = (editorInstance: any, pageData: any) => {\n    if (!pageData.grapesComponents) return\n    \n    try {\n      const components = JSON.parse(pageData.grapesComponents)\n      console.log('載入組件數據:', components.length, '個組件')\n      editorInstance.loadProjectData({ components })\n    } catch (e) {\n      console.warn('無法解析組件數據:', e)\n    }\n  }\n\n  // 載入樣式數據\n  const loadStylesData = (pageData: any) => {\n    if (!pageData.grapesStyles) return\n    \n    try {\n      const styles = JSON.parse(pageData.grapesStyles)\n      console.log('載入樣式數據:', styles.length, '個樣式')\n      // 注意：GrapesJS 的樣式載入可能需要特殊處理\n      // 這裡先跳過，主要依靠 CSS 和組件數據\n    } catch (e) {\n      console.warn('無法解析樣式數據:', e)\n    }\n  }\n\n  // 當 pageId 改變時載入對應頁面\n  useEffect(() => {\n    if (pageId && editor) {\n      loadPageWithEditor(editor, pageId)\n    }\n  }, [pageId, editor])\n\n  return (\n    <div \n      ref={editorRef} \n      id=\"grapesjs-editor-container\"\n      style={{ \n        height: '100vh', \n        width: '100%',\n        minHeight: '500px',\n        position: 'relative'\n      }} \n    />\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/components/grapesjs/i18n/zh-TW.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":111,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":111,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2445,2448],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2445,2448],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":114,"column":32,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":114,"endColumn":34,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2589,2591],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":141,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":141,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3912,3915],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3912,3915],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":163,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":163,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4850,4853],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4850,4853],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":165,"column":43,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":165,"endColumn":45,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[4940,4942],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":167,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":167,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5044,5047],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5044,5047],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":167,"column":77,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":167,"endColumn":79,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[5076,5078],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":180,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":180,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5519,5522],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5519,5522],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":185,"column":31,"nodeType":null,"messageId":"preferOptionalChain","endLine":185,"endColumn":65,"fix":{"range":[5685,5719],"text":"prop.get?.('properties')"}},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":185,"column":67,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":185,"endColumn":69,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[5721,5723],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":185,"column":79,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":185,"endColumn":82,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5733,5736],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5733,5736],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":186,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":186,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5781,5784],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5781,5784],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":189,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":189,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5906,5909],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5906,5909],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":190,"column":48,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":190,"endColumn":50,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[5945,5977],"text":"(p.get('property') ?? p.get('id'))"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":190,"column":63,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":190,"endColumn":65,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[5978,5980],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":194,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":194,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6152,6155],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6152,6155],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":195,"column":59,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":195,"endColumn":61,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[6220,6222],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":195,"column":76,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":195,"endColumn":78,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[6202,6250],"text":"(p.get('property') || p.get('id'))) ?? p.property)"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":195,"column":90,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":195,"endColumn":92,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[6251,6253],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":225,"column":11,"nodeType":"BlockStatement","messageId":"unexpected","endLine":225,"endColumn":13,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[7187,7187],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]}],"suppressedMessages":[],"errorCount":11,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import type grapesjs from 'grapesjs'\n\n// 以繁體中文覆蓋 GrapesJS 介面字串\nexport function applyZhTW(editor: grapesjs.Editor) {\n  const i18n = editor.I18n\n\n  i18n.addMessages({\n    'zh-TW': {\n      styleManager: {\n        empty: '請選取一個元件以編輯樣式',\n        layer: '圖層',\n        fileButton: '選擇圖片',\n      },\n      traitManager: {\n        empty: '請選取一個元件以編輯屬性',\n        label: '元件屬性',\n        traits: {\n          // 常見 trait 類型\n          id: 'ID',\n          title: '標題',\n          href: '連結',\n          alt: '替代文字',\n          target: '開啟方式',\n          src: '來源',\n        },\n      },\n      deviceManager: {\n        device: '裝置',\n        devices: {\n          desktop: '桌機',\n          tablet: '平板',\n          mobilePortrait: '手機',\n        },\n      },\n      selectorManager: {\n        label: '樣式選擇器',\n        selected: '已選取',\n        emptyState: '- 未選取任何元件 -',\n      },\n      layers: {\n        title: '圖層',\n      },\n      blockManager: {\n        labels: {\n          // 常見分類翻譯（實際分類由外部插件決定）\n          Basic: '基礎',\n          Forms: '表單',\n          Typography: '排版',\n          Media: '媒體',\n          Extra: '進階',\n          Layout: '佈局',\n        },\n        categories: {\n          // 可依專案客製\n        },\n      },\n      assetManager: {\n        addButton: '新增資產',\n        inputPlh: '在此貼上圖片 URL',\n        modalTitle: '資產管理',\n        uploadTitle: '拖曳檔案至此或點擊上傳',\n        uploadBtn: '選擇檔案',\n        dropFiles: '將檔案拖曳到這裡',\n        choose: '選擇',\n        remove: '刪除',\n      },\n      panels: {\n        buttons: {\n          // 內建按鈕多為 icon，仍補上標題\n          openBlocks: '開啟區塊',\n          openSm: '開啟樣式',\n          openTm: '開啟屬性',\n          openLayers: '開啟圖層',\n          preview: '預覽',\n          fullscreen: '全螢幕',\n          exportTemplate: '匯出',\n          undo: '復原',\n          redo: '重做',\n          import: '匯入',\n        },\n      },\n      notifications: {\n        info: '訊息',\n        warning: '警告',\n        success: '成功',\n        error: '錯誤',\n      },\n    },\n  })\n\n  i18n.setLocale('zh-TW')\n\n  // 進一步覆蓋樣式面板常見分組與屬性名稱與選項\n  try {\n    const sm = editor.StyleManager\n    const translateAll = () => {\n      // 區塊分組標題\n      const sectorMap: Record<string, string> = {\n        general: '一般',\n        dimension: '尺寸與間距',\n        typography: '文字排版',\n        decorations: '外觀裝飾',\n        extra: '其他',\n        // 一些主題/插件可能使用的替代名稱\n        General: '一般',\n        Dimension: '尺寸與間距',\n        Typography: '文字排版',\n        Decorations: '外觀裝飾',\n        Extra: '其他',\n      }\n      sm.getSectors().each((s: any) => {\n        const name = s.get('name')\n        if (name && sectorMap[name]) s.set('name', sectorMap[name])\n        const id = s.getId?.() || s.id\n        if (id && sectorMap[id]) s.set('name', sectorMap[id])\n      })\n\n      // 常見屬性翻譯\n      const propMap: Record<string, string> = {\n        display: '顯示',\n        position: '定位',\n        top: '上', right: '右', bottom: '下', left: '左',\n        width: '寬度', height: '高度',\n        'min-width': '最小寬度', 'min-height': '最小高度',\n        'max-width': '最大寬度', 'max-height': '最大高度',\n        margin: '外距', padding: '內距',\n        float: '浮動', 'z-index': '層級',\n        color: '文字顏色',\n        'background-color': '背景顏色', 'background-image': '背景圖片',\n        'background-repeat': '背景重複', 'background-position': '背景位置', 'background-size': '背景尺寸',\n        opacity: '不透明度', 'box-shadow': '陰影', 'border-radius': '圓角', border: '邊框',\n        'border-top': '上邊框', 'border-right': '右邊框', 'border-bottom': '下邊框', 'border-left': '左邊框',\n        'font-family': '字體', 'font-size': '字號', 'font-weight': '字重', 'letter-spacing': '字距', 'line-height': '行高',\n        'text-align': '對齊', 'text-decoration': '文字裝飾', 'text-shadow': '文字陰影',\n      }\n\n      const sectorIds = ['general', 'dimension', 'typography', 'decorations', 'extra', 'General', 'Dimension', 'Typography', 'Decorations', 'Extra']\n      sectorIds.forEach((sectorId) => {\n        Object.keys(propMap).forEach((prop) => {\n          try {\n            const p = sm.getProperty(sectorId as any, prop)\n            if (p) p.set('label', propMap[prop])\n          } catch { /* 不同主題可能無此屬性，忽略 */ }\n        })\n      })\n\n      // 選項翻譯（Display / Float / Position / Text-align / Background-repeat）\n      const optionMap: Record<string, Record<string, string>> = {\n        display: {\n          block: '區塊', inline: '行內', 'inline-block': '行內區塊', flex: '彈性盒', none: '隱藏',\n        },\n        float: { none: '無', left: '左', right: '右' },\n        position: { static: '靜態', relative: '相對', absolute: '絕對', fixed: '固定', sticky: '黏附' },\n        'text-align': { left: '靠左', center: '置中', right: '靠右', justify: '對齊' },\n        'background-repeat': { repeat: '重複', 'repeat-x': '水平重複', 'repeat-y': '垂直重複', 'no-repeat': '不重複' },\n      }\n\n      const translateOptions = (propName: string) => {\n        const map = optionMap[propName]\n        if (!map) return\n        sectorIds.some((sid) => {\n          try {\n            const p = sm.getProperty(sid as any, propName)\n            if (!p) return false\n            const opts = p.get('options') || []\n            if (Array.isArray(opts) && opts.length) {\n              p.set('options', opts.map((o: any) => ({ ...o, name: map[o.id || o.value] || o.name })))\n            }\n            return true\n          } catch { return false }\n        })\n      }\n\n      Object.keys(optionMap).forEach(translateOptions)\n\n      // 複合屬性：Margin / Padding 子欄位 Top/Right/Bottom/Left\n      const translateComposite = (propId: string, label: string, subMap: Record<string, string>) => {\n        const trySector = (sid: string) => {\n          try {\n            const prop = sm.getProperty(sid as any, propId)\n            if (!prop) return false\n            // 父屬性標籤\n            prop.set('label', label)\n            // 子屬性集合可能為集合或陣列\n            const children = (prop.get && prop.get('properties')) || (prop as any).properties\n            const each = (list: any) => {\n              if (!list) return\n              if (typeof list.each === 'function') {\n                list.each((p: any) => {\n                  const id = p.get('property') || p.get('id') || p.id\n                  if (id && subMap[id]) p.set('name', subMap[id])\n                })\n              } else if (Array.isArray(list)) {\n                list.forEach((p: any) => {\n                  const id = (p.get && (p.get('property') || p.get('id'))) || p.property || p.id\n                  const set = (key: string, val: string) => (p.set ? p.set(key, val) : (p[key] = val))\n                  if (id && subMap[id]) set('name', subMap[id])\n                })\n              }\n            }\n            each(children)\n            return true\n          } catch {\n            return false\n          }\n        }\n        // 嘗試於多個 sector Id 中尋找屬性\n        const sids = ['dimension', 'Dimension']\n        sids.some(trySector)\n      }\n\n      translateComposite('margin', '外距', {\n        'margin-top': '上', 'margin-right': '右', 'margin-bottom': '下', 'margin-left': '左',\n      })\n      translateComposite('padding', '內距', {\n        'padding-top': '上', 'padding-right': '右', 'padding-bottom': '下', 'padding-left': '左',\n      })\n    }\n\n    // 立即翻譯一次\n    translateAll()\n    // 當分組/屬性被動態新增時再翻譯\n    editor.on('styleManager:sector:add', translateAll)\n    editor.on('styleManager:property:add', translateAll)\n  } catch {}\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/components/grapesjs/plugins/block-preview-enhancer.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":41,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[751,754],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[751,754],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":42,"column":54,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":42,"endColumn":56,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[819,821],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":46,"column":16,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":46,"endColumn":18,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[951,953],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":101,"column":50,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":101,"endColumn":52,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2333,2335],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":406,"column":78,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":406,"endColumn":81,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19991,19994],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19991,19994],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'category' is defined but never used.","line":425,"column":47,"nodeType":null,"messageId":"unusedVar","endLine":425,"endColumn":55},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'category' is defined but never used. Allowed unused args must match /^_/u.","line":425,"column":47,"nodeType":null,"messageId":"unusedVar","endLine":425,"endColumn":55},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'category' is defined but never used.","line":455,"column":53,"nodeType":null,"messageId":"unusedVar","endLine":455,"endColumn":61},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'category' is defined but never used. Allowed unused args must match /^_/u.","line":455,"column":53,"nodeType":null,"messageId":"unusedVar","endLine":455,"endColumn":61},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":481,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":481,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22766,22769],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22766,22769],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":487,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":487,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22973,22976],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22973,22976],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":492,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":492,"endColumn":16,"suggestions":[{"fix":{"range":[23181,23262],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":504,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":504,"endColumn":16,"suggestions":[{"fix":{"range":[23394,23443],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":505,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":505,"endColumn":16,"suggestions":[{"fix":{"range":[23448,23483],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":512,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":512,"endColumn":18,"suggestions":[{"fix":{"range":[23589,23625],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":515,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":515,"endColumn":20,"suggestions":[{"fix":{"range":[23695,23725],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":517,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":517,"endColumn":20,"suggestions":[{"fix":{"range":[23781,23811],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":523,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":523,"endColumn":18,"suggestions":[{"fix":{"range":[23920,23952],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":525,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":525,"endColumn":20,"suggestions":[{"fix":{"range":[23986,24016],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":633,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":633,"endColumn":20,"suggestions":[{"fix":{"range":[26892,26997],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":639,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":639,"endColumn":22,"suggestions":[{"fix":{"range":[27186,27232],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":644,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":644,"endColumn":16,"suggestions":[{"fix":{"range":[27268,27311],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":653,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":653,"endColumn":19,"suggestions":[{"fix":{"range":[27462,27506],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":672,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":672,"endColumn":20,"suggestions":[{"fix":{"range":[27951,27988],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":675,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":675,"endColumn":20,"suggestions":[{"fix":{"range":[28027,28065],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":680,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":680,"endColumn":19,"suggestions":[{"fix":{"range":[28118,28159],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":687,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":687,"endColumn":16,"suggestions":[{"fix":{"range":[28327,28369],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":690,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":690,"endColumn":19,"suggestions":[{"fix":{"range":[28412,28459],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":710,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":710,"endColumn":16,"suggestions":[{"fix":{"range":[29044,29071],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":716,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":716,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[29171,29174],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[29171,29174],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":724,"column":58,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":724,"endColumn":60,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[29390,29392],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":725,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":725,"endColumn":18,"suggestions":[{"fix":{"range":[29433,29470],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":728,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":728,"endColumn":21,"suggestions":[{"fix":{"range":[29508,29536],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":734,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":734,"endColumn":21,"suggestions":[{"fix":{"range":[29625,29661],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":739,"column":47,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":739,"endColumn":49,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[29764,29766],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":741,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":741,"endColumn":20,"suggestions":[{"fix":{"range":[29841,29876],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":744,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":744,"endColumn":20,"suggestions":[{"fix":{"range":[29958,30173],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":745,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":745,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[30039,30042],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[30039,30042],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":746,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":746,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[30123,30126],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[30123,30126],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":751,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":751,"endColumn":18,"suggestions":[{"fix":{"range":[30205,30246],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":759,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":759,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[30391,30394],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[30391,30394],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":759,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":759,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[30412,30415],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[30412,30415],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":765,"column":54,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":765,"endColumn":56,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[30536,30538],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":770,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":770,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[30687,30690],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[30687,30690],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":771,"column":44,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":771,"endColumn":46,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[30740,30742],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":775,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":775,"endColumn":19,"suggestions":[{"fix":{"range":[30856,30893],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'blockElement' is defined but never used.","line":783,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":783,"endColumn":40},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'blockElement' is defined but never used. Allowed unused args must match /^_/u.","line":783,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":783,"endColumn":40},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":805,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":805,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[31553,31556],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[31553,31556],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":901,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":901,"endColumn":16,"suggestions":[{"fix":{"range":[33978,34008],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":13,"fatalErrorCount":0,"warningCount":37,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * GrapesJS 元件庫懸停放大鏡預覽功能\n * 為左側元件面板添加互動式預覽體驗\n */\n\nexport interface BlockPreviewConfig {\n  enabled: boolean;\n  scale: number;\n  delay: number;\n  duration: number;\n  offsetX: number;\n  offsetY: number;\n  maxWidth: number;\n  maxHeight: number;\n}\n\nexport const defaultPreviewConfig: BlockPreviewConfig = {\n  enabled: true,\n  scale: 1.5, // 放大倍數\n  delay: 300, // 懸停延遲 (毫秒)\n  duration: 200, // 動畫持續時間\n  offsetX: 20, // X軸偏移\n  offsetY: 10, // Y軸偏移\n  maxWidth: 400, // 最大寬度\n  maxHeight: 300 // 最大高度\n};\n\n/**\n * 元件預覽內容生成器\n */\nclass BlockPreviewGenerator {\n  private config: BlockPreviewConfig;\n\n  constructor(config: BlockPreviewConfig = defaultPreviewConfig) {\n    this.config = config;\n  }\n\n  /**\n   * 根據元件類型生成預覽HTML\n   */\n  generatePreviewContent(block: any): string {\n    const { id, label, category } = block.attributes || block;\n    const blockContent = block.get ? block.get('content') : block.content;\n    \n    // 根據不同元件類型生成真實的HTML預覽\n    switch (id || label) {\n      case 'text':\n      case '文字區塊':\n        return this.generateRealTextPreview();\n      \n      case 'image':\n      case '圖片':\n        return this.generateRealImagePreview();\n      \n      case 'link':\n        return this.generateRealLinkPreview();\n      \n      case 'carousel':\n      case '全寬輪播圖':\n      case '輪播組件':\n        return this.generateRealCarouselPreview();\n      \n      case 'countdown':\n      case '倒計時器':\n        return this.generateRealCountdownPreview();\n      \n      case 'tabs':\n      case '分頁標籤':\n        return this.generateRealTabsPreview();\n      \n      case 'form':\n      case 'input':\n      case 'textarea':\n        return this.generateRealFormPreview();\n      \n      case 'video':\n      case '影片':\n        return this.generateRealVideoPreview();\n      \n      case 'map':\n      case '地圖':\n        return this.generateRealMapPreview();\n\n      case 'column1':\n      case '單列':\n        return this.generateRealColumnPreview(1);\n\n      case 'column2':\n      case '雙列':\n        return this.generateRealColumnPreview(2);\n\n      case 'column3':\n      case '三列':\n        return this.generateRealColumnPreview(3);\n      \n      default:\n        // 如果有真實的 HTML 內容，直接渲染\n        if (blockContent && typeof blockContent === 'string') {\n          return this.generateRealContentPreview(blockContent);\n        }\n        return this.generateGenericPreview(label || id, category, blockContent);\n    }\n  }\n\n  private generateRealTextPreview(): string {\n    return `\n      <div class=\"block-preview-content\" style=\"padding: 16px; max-width: 350px;\">\n        <div style=\"margin-bottom: 12px;\">\n          <h1 style=\"font-size: 24px; font-weight: bold; margin: 0 0 8px 0; color: #2c3e50;\">這是主標題</h1>\n          <h2 style=\"font-size: 20px; font-weight: 600; margin: 0 0 8px 0; color: #34495e;\">這是副標題</h2>\n          <h3 style=\"font-size: 16px; font-weight: 500; margin: 0 0 12px 0; color: #7f8c8d;\">這是小標題</h3>\n        </div>\n        <p style=\"font-size: 14px; line-height: 1.6; color: #2c3e50; margin: 0 0 12px 0;\">\n          這是一個段落範例。您可以在這裡添加任何文字內容，包含 <strong>粗體</strong>、<em>斜體</em> 和 \n          <u>底線</u> 等格式。文字會自動換行並適應容器寬度。\n        </p>\n        <blockquote style=\"border-left: 4px solid #3498db; padding-left: 16px; margin: 12px 0; font-style: italic; color: #7f8c8d;\">\n          這是一個引用文字的範例，常用於重點強調或引述他人的話。\n        </blockquote>\n        <ul style=\"padding-left: 20px; margin: 8px 0;\">\n          <li style=\"margin: 4px 0; color: #2c3e50;\">無序清單項目一</li>\n          <li style=\"margin: 4px 0; color: #2c3e50;\">無序清單項目二</li>\n        </ul>\n      </div>\n    `;\n  }\n\n  private generateRealImagePreview(): string {\n    return `\n      <div class=\"block-preview-content\" style=\"padding: 16px; max-width: 350px;\">\n        <div style=\"margin-bottom: 12px;\">\n          <img src=\"https://images.unsplash.com/photo-1506905925346-21bda4d32df4?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1000&q=80\" \n               alt=\"美麗的山景\" \n               style=\"width: 100%; height: 180px; object-fit: cover; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15);\" />\n        </div>\n        <div style=\"text-align: center;\">\n          <p style=\"margin: 8px 0 4px 0; font-size: 14px; color: #2c3e50; font-weight: 500;\">響應式圖片元件</p>\n          <p style=\"margin: 0; font-size: 12px; color: #7f8c8d;\">自動適應容器大小，支援 lazy loading</p>\n        </div>\n      </div>\n    `;\n  }\n\n  private generateRealLinkPreview(): string {\n    return `\n      <div class=\"block-preview-content\" style=\"padding: 16px; max-width: 350px;\">\n        <div style=\"margin-bottom: 16px;\">\n          <a href=\"#\" style=\"color: #007bff; text-decoration: none; font-size: 16px; font-weight: 500; border-bottom: 2px solid transparent; transition: border-color 0.2s;\">\n            這是一個連結範例\n          </a>\n          <p style=\"margin: 8px 0; font-size: 14px; color: #6c757d;\">連結可以導向其他頁面或錨點</p>\n        </div>\n        <div style=\"display: flex; flex-direction: column; gap: 8px;\">\n          <a href=\"#\" style=\"color: #28a745; text-decoration: underline; font-size: 14px;\">綠色連結樣式</a>\n          <a href=\"#\" style=\"color: #dc3545; text-decoration: none; font-size: 14px; border: 1px solid #dc3545; padding: 4px 8px; border-radius: 4px;\">按鈕式連結</a>\n        </div>\n      </div>\n    `;\n  }\n\n  private generateRealCarouselPreview(): string {\n    return `\n      <div class=\"block-preview-content\" style=\"padding: 16px; max-width: 350px;\">\n        <div style=\"position: relative; height: 200px; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.15);\">\n          <div style=\"position: absolute; width: 100%; height: 100%; background: linear-gradient(45deg, #ff6b6b, #ee5a24); display: flex; align-items: center; justify-content: center; color: white;\">\n            <div style=\"text-align: center;\">\n              <img src=\"https://images.unsplash.com/photo-1506905925346-21bda4d32df4?ixlib=rb-4.0.3&auto=format&fit=crop&w=1000&q=80\" \n                   style=\"width: 120px; height: 80px; object-fit: cover; border-radius: 4px; margin-bottom: 8px;\" />\n              <div style=\"font-size: 14px; font-weight: 500;\">幻燈片 1</div>\n            </div>\n          </div>\n          \n          <button style=\"position: absolute; left: 8px; top: 50%; transform: translateY(-50%); background: rgba(0,0,0,0.5); color: white; border: none; width: 32px; height: 32px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center;\">‹</button>\n          <button style=\"position: absolute; right: 8px; top: 50%; transform: translateY(-50%); background: rgba(0,0,0,0.5); color: white; border: none; width: 32px; height: 32px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center;\">›</button>\n          \n          <div style=\"position: absolute; bottom: 12px; left: 50%; transform: translateX(-50%); display: flex; gap: 6px;\">\n            <div style=\"width: 8px; height: 8px; border-radius: 50%; background: white; opacity: 1;\"></div>\n            <div style=\"width: 8px; height: 8px; border-radius: 50%; background: white; opacity: 0.5;\"></div>\n            <div style=\"width: 8px; height: 8px; border-radius: 50%; background: white; opacity: 0.5;\"></div>\n          </div>\n        </div>\n        <div style=\"margin-top: 8px; text-align: center;\">\n          <p style=\"margin: 0; font-size: 12px; color: #7f8c8d;\">自動播放、導航控制、指示點</p>\n        </div>\n      </div>\n    `;\n  }\n\n  private generateRealCountdownPreview(): string {\n    const days = 7;\n    const hours = 12;\n    const minutes = 34;\n    const seconds = 56;\n    \n    return `\n      <div class=\"block-preview-content\" style=\"padding: 16px; max-width: 350px;\">\n        <div style=\"background: #2c3e50; color: white; padding: 20px; border-radius: 8px; text-align: center;\">\n          <h3 style=\"margin: 0 0 16px 0; font-size: 18px;\">🎉 限時優惠倒計時</h3>\n          \n          <div style=\"display: flex; justify-content: center; gap: 12px; margin-bottom: 16px;\">\n            <div style=\"background: rgba(255,255,255,0.1); padding: 8px 12px; border-radius: 4px; min-width: 50px;\">\n              <div style=\"font-size: 24px; font-weight: bold; font-family: monospace;\">${days.toString().padStart(2, '0')}</div>\n              <div style=\"font-size: 10px; opacity: 0.8;\">天</div>\n            </div>\n            <div style=\"background: rgba(255,255,255,0.1); padding: 8px 12px; border-radius: 4px; min-width: 50px;\">\n              <div style=\"font-size: 24px; font-weight: bold; font-family: monospace;\">${hours.toString().padStart(2, '0')}</div>\n              <div style=\"font-size: 10px; opacity: 0.8;\">時</div>\n            </div>\n            <div style=\"background: rgba(255,255,255,0.1); padding: 8px 12px; border-radius: 4px; min-width: 50px;\">\n              <div style=\"font-size: 24px; font-weight: bold; font-family: monospace;\">${minutes.toString().padStart(2, '0')}</div>\n              <div style=\"font-size: 10px; opacity: 0.8;\">分</div>\n            </div>\n            <div style=\"background: rgba(255,255,255,0.1); padding: 8px 12px; border-radius: 4px; min-width: 50px;\">\n              <div style=\"font-size: 24px; font-weight: bold; font-family: monospace;\">${seconds.toString().padStart(2, '0')}</div>\n              <div style=\"font-size: 10px; opacity: 0.8;\">秒</div>\n            </div>\n          </div>\n          \n          <p style=\"margin: 0; font-size: 14px; opacity: 0.9;\">優惠即將結束，把握機會！</p>\n        </div>\n      </div>\n    `;\n  }\n\n  private generateRealTabsPreview(): string {\n    return `\n      <div class=\"block-preview-content\" style=\"padding: 16px; max-width: 350px;\">\n        <div style=\"border: 1px solid #e1e5e9; border-radius: 8px; overflow: hidden; background: white;\">\n          <div style=\"display: flex; background: #f8f9fa; border-bottom: 1px solid #e1e5e9;\">\n            <div style=\"padding: 12px 20px; background: white; border-bottom: 2px solid #007bff; color: #007bff; font-size: 14px; font-weight: 500; cursor: pointer; border-right: 1px solid #e1e5e9;\">產品介紹</div>\n            <div style=\"padding: 12px 20px; color: #6c757d; font-size: 14px; cursor: pointer; border-right: 1px solid #e1e5e9;\">規格參數</div>\n            <div style=\"padding: 12px 20px; color: #6c757d; font-size: 14px; cursor: pointer;\">用戶評價</div>\n          </div>\n          \n          <div style=\"padding: 20px; min-height: 120px;\">\n            <h4 style=\"margin: 0 0 12px 0; font-size: 16px; color: #2c3e50;\">產品特色</h4>\n            <ul style=\"padding-left: 16px; margin: 0; color: #495057;\">\n              <li style=\"margin: 8px 0;\">高品質材料製造</li>\n              <li style=\"margin: 8px 0;\">人體工學設計</li>\n              <li style=\"margin: 8px 0;\">一年保固服務</li>\n            </ul>\n            <p style=\"margin: 16px 0 0 0; font-size: 14px; color: #6c757d;\">\n              點擊不同標籤可切換內容，支援鍵盤導航和動畫效果。\n            </p>\n          </div>\n        </div>\n      </div>\n    `;\n  }\n\n  private generateRealFormPreview(): string {\n    return `\n      <div class=\"block-preview-content\" style=\"padding: 16px; max-width: 350px;\">\n        <form style=\"background: #f8f9fa; padding: 20px; border-radius: 8px; border: 1px solid #e9ecef;\">\n          <h3 style=\"margin: 0 0 16px 0; font-size: 18px; color: #2c3e50;\">聯絡我們</h3>\n          \n          <div style=\"margin-bottom: 16px;\">\n            <label style=\"display: block; font-size: 14px; color: #495057; margin-bottom: 6px; font-weight: 500;\">姓名 *</label>\n            <input type=\"text\" \n                   placeholder=\"請輸入您的姓名\" \n                   style=\"width: 100%; padding: 10px 12px; border: 1px solid #ced4da; border-radius: 4px; font-size: 14px; box-sizing: border-box;\" />\n          </div>\n          \n          <div style=\"margin-bottom: 16px;\">\n            <label style=\"display: block; font-size: 14px; color: #495057; margin-bottom: 6px; font-weight: 500;\">電子郵件 *</label>\n            <input type=\"email\" \n                   placeholder=\"example@email.com\" \n                   style=\"width: 100%; padding: 10px 12px; border: 1px solid #ced4da; border-radius: 4px; font-size: 14px; box-sizing: border-box;\" />\n          </div>\n          \n          <div style=\"margin-bottom: 16px;\">\n            <label style=\"display: block; font-size: 14px; color: #495057; margin-bottom: 6px; font-weight: 500;\">訊息</label>\n            <textarea placeholder=\"請輸入您的訊息...\" \n                      rows=\"3\"\n                      style=\"width: 100%; padding: 10px 12px; border: 1px solid #ced4da; border-radius: 4px; font-size: 14px; resize: vertical; box-sizing: border-box;\"></textarea>\n          </div>\n          \n          <button type=\"submit\" \n                  style=\"background: #007bff; color: white; border: none; padding: 10px 24px; border-radius: 4px; font-size: 14px; cursor: pointer; font-weight: 500; transition: background 0.2s;\">\n            送出訊息\n          </button>\n        </form>\n      </div>\n    `;\n  }\n\n  private generateRealVideoPreview(): string {\n    return `\n      <div class=\"block-preview-content\" style=\"padding: 16px; max-width: 350px;\">\n        <div style=\"position: relative; width: 100%; height: 180px; background: #000; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.15);\">\n          <video style=\"width: 100%; height: 100%; object-fit: cover;\" poster=\"https://images.unsplash.com/photo-1486312338219-ce68d2c6f44d?ixlib=rb-4.0.3&auto=format&fit=crop&w=1000&q=80\">\n            <source src=\"#\" type=\"video/mp4\">\n            您的瀏覽器不支援影片播放\n          </video>\n          \n          <div style=\"position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center; cursor: pointer;\">\n            <div style=\"width: 60px; height: 60px; background: rgba(255,255,255,0.9); border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: transform 0.2s;\">\n              <div style=\"width: 0; height: 0; border-left: 20px solid #007bff; border-top: 12px solid transparent; border-bottom: 12px solid transparent; margin-left: 4px;\"></div>\n            </div>\n          </div>\n          \n          <div style=\"position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(transparent, rgba(0,0,0,0.7)); padding: 12px; display: flex; align-items: center; gap: 8px;\">\n            <div style=\"width: 8px; height: 8px; background: white; border-radius: 50%;\"></div>\n            <div style=\"flex: 1; height: 4px; background: rgba(255,255,255,0.3); border-radius: 2px;\">\n              <div style=\"width: 30%; height: 100%; background: #007bff; border-radius: 2px;\"></div>\n            </div>\n            <span style=\"color: white; font-size: 12px;\">1:23 / 4:56</span>\n          </div>\n        </div>\n        \n        <div style=\"margin-top: 8px; text-align: center;\">\n          <p style=\"margin: 0; font-size: 12px; color: #7f8c8d;\">支援多種格式、自訂控制項、響應式設計</p>\n        </div>\n      </div>\n    `;\n  }\n\n  private generateRealMapPreview(): string {\n    return `\n      <div class=\"block-preview-content\" style=\"padding: 16px; max-width: 350px;\">\n        <div style=\"position: relative; width: 100%; height: 180px; background: #e8f4fd; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.15);\">\n          <svg width=\"100%\" height=\"100%\" viewBox=\"0 0 400 200\" style=\"position: absolute;\">\n            <defs>\n              <pattern id=\"grid\" width=\"20\" height=\"20\" patternUnits=\"userSpaceOnUse\">\n                <path d=\"M 20 0 L 0 0 0 20\" fill=\"none\" stroke=\"#ddd\" stroke-width=\"1\"/>\n              </pattern>\n            </defs>\n            <rect width=\"100%\" height=\"100%\" fill=\"url(#grid)\" />\n            \n            <path d=\"M0,80 Q100,60 200,80 T400,100\" stroke=\"#ffc107\" stroke-width=\"4\" fill=\"none\"/>\n            <path d=\"M80,0 L80,200\" stroke=\"#ffc107\" stroke-width=\"3\" fill=\"none\"/>\n            <path d=\"M200,0 L200,200\" stroke=\"#ffc107\" stroke-width=\"3\" fill=\"none\"/>\n            \n            <rect x=\"60\" y=\"50\" width=\"40\" height=\"30\" fill=\"#6c757d\" rx=\"2\"/>\n            <rect x=\"180\" y=\"40\" width=\"50\" height=\"40\" fill=\"#495057\" rx=\"2\"/>\n            <rect x=\"260\" y=\"60\" width=\"35\" height=\"25\" fill=\"#6c757d\" rx=\"2\"/>\n            \n            <circle cx=\"150\" cy=\"140\" r=\"25\" fill=\"#28a745\" opacity=\"0.6\"/>\n            <circle cx=\"320\" cy=\"50\" r=\"20\" fill=\"#28a745\" opacity=\"0.6\"/>\n          </svg>\n          \n          <div style=\"position: absolute; top: 70px; left: 180px; transform: translate(-50%, -100%);\">\n            <div style=\"width: 30px; height: 30px; background: #dc3545; border-radius: 50% 50% 50% 0; transform: rotate(-45deg); border: 3px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.3);\"></div>\n            <div style=\"position: absolute; top: 3px; left: 3px; width: 18px; height: 18px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; transform: rotate(45deg);\">\n              <span style=\"font-size: 10px; color: #dc3545;\">📍</span>\n            </div>\n          </div>\n          \n          <div style=\"position: absolute; top: 12px; right: 12px; display: flex; flex-direction: column; gap: 4px;\">\n            <button style=\"width: 30px; height: 30px; background: white; border: 1px solid #ccc; border-radius: 4px; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.1);\">+</button>\n            <button style=\"width: 30px; height: 30px; background: white; border: 1px solid #ccc; border-radius: 4px; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.1);\">−</button>\n          </div>\n          \n          <div style=\"position: absolute; bottom: 12px; left: 12px; background: white; padding: 6px 10px; border-radius: 4px; box-shadow: 0 2px 6px rgba(0,0,0,0.15); font-size: 12px; color: #2c3e50;\">\n            📍 台北市信義區市府路1號\n          </div>\n        </div>\n        \n        <div style=\"margin-top: 8px; text-align: center;\">\n          <p style=\"margin: 0; font-size: 12px; color: #7f8c8d;\">互動式地圖、自訂標記、街景整合</p>\n        </div>\n      </div>\n    `;\n  }\n\n  private generateRealColumnPreview(columns: number): string {\n    const columnsHtml = Array.from({ length: columns }, (_, i) => `\n      <div style=\"flex: 1; min-height: 80px; background: ${i % 2 === 0 ? '#f8f9fa' : '#e9ecef'}; border: 2px dashed #adb5bd; border-radius: 4px; display: flex; align-items: center; justify-content: center; color: #6c757d; font-size: 14px;\">\n        第 ${i + 1} 欄\n      </div>\n    `).join('');\n\n    return `\n      <div class=\"block-preview-content\" style=\"padding: 16px; max-width: 350px;\">\n        <div style=\"border: 1px solid #e9ecef; border-radius: 8px; padding: 16px; background: white;\">\n          <h4 style=\"margin: 0 0 12px 0; font-size: 16px; color: #2c3e50; text-align: center;\">${columns} 欄佈局</h4>\n          <div style=\"display: flex; gap: 12px; margin-bottom: 12px;\">\n            ${columnsHtml}\n          </div>\n          <p style=\"margin: 0; font-size: 12px; color: #6c757d; text-align: center;\">\n            響應式網格系統，支援拖拽調整欄寬\n          </p>\n        </div>\n      </div>\n    `;\n  }\n\n  private generateRealContentPreview(content: string): string {\n    // 清理並限制HTML內容長度\n    const cleanContent = content.replace(/<script\\b[^<]*(?:(?!<\\/script>)<[^<]*)*<\\/script>/gi, '')\n                                 .replace(/<style\\b[^<]*(?:(?!<\\/style>)<[^<]*)*<\\/style>/gi, '')\n                                 .substring(0, 1000);\n    \n    return `\n      <div class=\"block-preview-content\" style=\"padding: 16px; max-width: 350px; max-height: 250px; overflow: hidden;\">\n        <div style=\"border: 1px solid #e9ecef; border-radius: 8px; padding: 12px; background: #f8f9fa;\">\n          <h4 style=\"margin: 0 0 8px 0; font-size: 14px; color: #495057;\">HTML 預覽</h4>\n          <div style=\"font-size: 12px; background: white; padding: 12px; border-radius: 4px; border: 1px solid #dee2e6; max-height: 180px; overflow: auto;\">\n            ${cleanContent}\n          </div>\n        </div>\n      </div>\n    `;\n  }\n\n  private generateGenericPreview(label: string, category?: string, content?: any): string {\n    const emoji = this.getEmojiForComponent(label, category);\n    const description = this.getDescriptionForComponent(label, category);\n    \n    return `\n      <div class=\"block-preview-content generic-preview\" style=\"padding: 16px; max-width: 300px;\">\n        <div style=\"text-align: center; margin-bottom: 12px;\">\n          <div style=\"font-size: 48px; margin-bottom: 8px;\">${emoji}</div>\n          <h3 style=\"color: #333; margin: 0 0 8px 0; font-size: 16px;\">${label}</h3>\n          ${category ? `<span style=\"color: #666; font-size: 12px; background: #f0f0f0; padding: 2px 6px; border-radius: 3px;\">${category}</span>` : ''}\n        </div>\n        <p style=\"color: #666; margin: 0; font-size: 14px; line-height: 1.4; text-align: center;\">\n          ${description}\n        </p>\n        ${content ? `<div style=\"margin-top: 12px; padding: 8px; background: #f8f9fa; border-radius: 4px; font-size: 12px; color: #6c757d; max-height: 100px; overflow: hidden;\">${content}</div>` : ''}\n      </div>\n    `;\n  }\n\n  private getEmojiForComponent(label: string, category?: string): string {\n    const componentEmojis: Record<string, string> = {\n      'text': '📝', 'image': '🖼️', 'button': '🔘', 'form': '📋',\n      'video': '📹', 'map': '🗺️', 'carousel': '🎠', 'accordion': '📂',\n      'tab': '📁', 'modal': '💬', 'alert': '⚠️', 'badge': '🏷️',\n      'card': '🃏', 'list': '📄', 'table': '📊', 'chart': '📈',\n      'icon': '✨', 'divider': '➖', 'column': '🏗️', 'container': '📦'\n    };\n\n    const lowerLabel = label.toLowerCase();\n    \n    // 直接匹配\n    for (const [key, emoji] of Object.entries(componentEmojis)) {\n      if (lowerLabel.includes(key)) return emoji;\n    }\n\n    // 中文匹配\n    const chineseMatches: Record<string, string> = {\n      '文字': '📝', '圖片': '🖼️', '按鈕': '🔘', '表單': '📋',\n      '影片': '📹', '地圖': '🗺️', '輪播': '🎠', '摺疊': '📂',\n      '標籤': '📁', '彈窗': '💬', '警告': '⚠️', '徽章': '🏷️'\n    };\n\n    for (const [key, emoji] of Object.entries(chineseMatches)) {\n      if (lowerLabel.includes(key)) return emoji;\n    }\n\n    return '🧩'; // 默認圖標\n  }\n\n  private getDescriptionForComponent(label: string, category?: string): string {\n    const lowerLabel = label.toLowerCase();\n\n    const descriptions: Record<string, string> = {\n      'text': '添加和編輯文字內容，支援豐富的格式選項',\n      'image': '插入圖片，支援響應式設計和延遲載入',\n      'button': '創建可點擊的按鈕，支援多種樣式和互動效果',\n      'form': '構建互動表單，收集用戶輸入資料',\n      'video': '嵌入影片播放器，支援多種影片格式',\n      'map': '整合互動式地圖功能，顯示位置資訊',\n      'carousel': '創建圖片或內容輪播展示',\n      'column': '靈活的多欄佈局系統，適應各種螢幕尺寸'\n    };\n\n    for (const [key, desc] of Object.entries(descriptions)) {\n      if (lowerLabel.includes(key)) return desc;\n    }\n\n    return `${label} 元件 - 點擊添加到頁面中進行編輯`;\n  }\n}\n\n/**\n * 元件庫懸停預覽增強器主類\n */\nclass BlockPreviewEnhancer {\n  private editor: any;\n  private config: BlockPreviewConfig;\n  private generator: BlockPreviewGenerator;\n  private previewElement: HTMLElement | null = null;\n  private hoverTimer: number | null = null;\n\n  constructor(editor: any, config: BlockPreviewConfig = defaultPreviewConfig) {\n    this.editor = editor;\n    this.config = { ...defaultPreviewConfig, ...config };\n    this.generator = new BlockPreviewGenerator(this.config);\n\n    console.log('🚀 BlockPreviewEnhancer 構造函數被調用', { enabled: this.config.enabled });\n    \n    // 如果配置啟用，則初始化\n    if (this.config.enabled) {\n      this.init();\n    }\n  }\n\n  /**\n   * 初始化預覽功能\n   */\n  init(): void {\n    console.log('� BlockPreviewEnhancer init() 被調用');\n    console.log('�🔍 正在初始化元件庫預覽功能...');\n    \n    // 注入樣式\n    this.injectStyles();\n    \n    // 等待編輯器完全載入\n    this.editor.on('load', () => {\n      console.log('✅ GrapesJS 編輯器載入事件觸發');\n      // 增加延遲，確保 BlockManager 完全初始化\n      setTimeout(() => {\n        console.log('⏰ 開始設置預覽監聽器...');\n        this.setupPreviewListenersWithRetry();\n        console.log('✅ 元件庫預覽功能初始化完成');\n      }, 2000); // 增加延遲到 2 秒\n    });\n\n    // 如果編輯器已經載入完成，立即設置監聽器\n    if (this.editor?.getModel?.()) {\n      console.log('⚡ 編輯器已載入，立即設置監聽器');\n      setTimeout(() => {\n        console.log('⏰ 立即設置預覽監聽器...');\n        this.setupPreviewListeners();\n      }, 2000);\n    }\n  }\n\n  /**\n   * 注入必要的CSS樣式\n   */\n  private injectStyles(): void {\n    if (document.getElementById('grapesjs-block-preview-styles')) {\n      return;\n    }\n\n    const styles = `\n      .gjs-block-preview-tooltip {\n        position: fixed;\n        background: white;\n        border: 1px solid #e1e5e9;\n        border-radius: 12px;\n        box-shadow: 0 8px 32px rgba(0,0,0,0.12);\n        z-index: 9999;\n        max-width: ${this.config.maxWidth}px;\n        max-height: ${this.config.maxHeight}px;\n        overflow: hidden;\n        opacity: 0;\n        transform: scale(0.8) translateY(10px);\n        transition: all ${this.config.duration}ms cubic-bezier(0.16, 1, 0.3, 1);\n        pointer-events: none;\n        backdrop-filter: blur(10px);\n        background: rgba(255, 255, 255, 0.95);\n        border: 1px solid rgba(255, 255, 255, 0.2);\n      }\n      \n      .gjs-block-preview-tooltip.show {\n        opacity: 1;\n        transform: scale(1) translateY(0);\n      }\n      \n      .gjs-block-preview-tooltip::before {\n        content: '';\n        position: absolute;\n        top: -6px;\n        left: 20px;\n        width: 12px;\n        height: 12px;\n        background: white;\n        border: 1px solid #e1e5e9;\n        border-bottom: none;\n        border-right: none;\n        transform: rotate(45deg);\n        z-index: -1;\n      }\n      \n      .gjs-block-preview-tooltip.tooltip-bottom::before {\n        top: auto;\n        bottom: -6px;\n        border-top: none;\n        border-left: none;\n        border-bottom: 1px solid #e1e5e9;\n        border-right: 1px solid #e1e5e9;\n        transform: rotate(45deg);\n      }\n      \n      .gjs-block-preview-tooltip .block-preview-content {\n        position: relative;\n        z-index: 1;\n      }\n      \n      .gjs-block-preview-tooltip .block-preview-content h3 {\n        color: #2c3e50;\n        margin: 0 0 8px 0;\n        font-size: 16px;\n        font-weight: 600;\n      }\n      \n      .gjs-block-preview-tooltip .block-preview-content p {\n        color: #6c757d;\n        margin: 0;\n        font-size: 14px;\n        line-height: 1.5;\n      }\n      \n      .gjs-blocks-c .gjs-block:hover {\n        background-color: rgba(0, 123, 255, 0.08);\n        transform: translateY(-1px);\n        box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n        transition: all 0.2s ease;\n      }\n      \n      .gjs-blocks-c .gjs-block {\n        transition: all 0.2s ease;\n        border-radius: 6px;\n      }\n    `;\n\n    const styleElement = document.createElement('style');\n    styleElement.id = 'grapesjs-block-preview-styles';\n    styleElement.textContent = styles;\n    document.head.appendChild(styleElement);\n  }\n\n  /**\n   * 帶重試機制的預覽監聽器設置\n   */\n  private setupPreviewListenersWithRetry(retryCount = 0, maxRetries = 5): void {\n    if (!this.editor?.BlockManager) {\n      if (retryCount < maxRetries) {\n        console.log(`⏱️ BlockManager 尚未準備就緒，${1000 * (retryCount + 1)}ms 後重試 (${retryCount + 1}/${maxRetries})`);\n        setTimeout(() => {\n          this.setupPreviewListenersWithRetry(retryCount + 1, maxRetries);\n        }, 1000 * (retryCount + 1)); // 逐漸增加延遲\n        return;\n      } else {\n        console.error('⚠️ BlockManager 在多次重試後仍未準備就緒');\n        return;\n      }\n    }\n\n    console.log('✅ BlockManager 準備就緒，設置預覽監聽器');\n    this.setupPreviewListeners();\n  }\n\n  /**\n   * 設置預覽監聽器\n   */\n  private setupPreviewListeners(): void {\n    if (!this.editor?.BlockManager) {\n      console.warn('⚠️ 編輯器或 BlockManager 尚未準備就緒');\n      return;\n    }\n    \n    const blockManager = this.editor.BlockManager;\n    \n    // 嘗試多個可能的元件容器選擇器\n    const possibleSelectors = [\n      '.gjs-blocks-c',\n      '.gjs-block-categories',\n      '.gjs-blocks',\n      '[data-type=\"blocks\"]'\n    ];\n    \n    let blockContainer: Element | null = null;\n    \n    for (const selector of possibleSelectors) {\n      blockContainer = document.querySelector(selector);\n      if (blockContainer) {\n        console.log(`✅ 找到元件容器: ${selector}`);\n        break;\n      } else {\n        console.log(`❌ 未找到元件容器: ${selector}`);\n      }\n    }\n    \n    if (!blockContainer) {\n      console.warn('⚠️ 找不到元件容器，嘗試在 2 秒後重試...');\n      setTimeout(() => this.setupPreviewListeners(), 2000);\n      return;\n    }\n\n    // 檢查容器中的元件\n    const blocks = blockContainer.querySelectorAll('.gjs-block');\n    console.log(`📦 找到 ${blocks.length} 個元件`);\n    \n    if (blocks.length === 0) {\n      console.warn('⚠️ 元件容器中沒有找到任何元件，嘗試在 2 秒後重試...');\n      setTimeout(() => this.setupPreviewListeners(), 2000);\n      return;\n    }\n\n    // 使用事件委託處理懸停事件\n    blockContainer.addEventListener('mouseover', (e) => {\n      const blockElement = (e.target as Element).closest('.gjs-block');\n      if (blockElement) {\n        this.handleBlockHover(blockElement as HTMLElement, blockManager);\n      }\n    });\n\n    blockContainer.addEventListener('mouseout', (e) => {\n      const blockElement = (e.target as Element).closest('.gjs-block');\n      if (blockElement) {\n        this.handleBlockLeave(blockElement as HTMLElement);\n      }\n    });\n\n    console.log('✅ 預覽監聽器設置完成');\n  }\n\n  /**\n   * 處理元件懸停事件\n   */\n  private handleBlockHover(blockElement: HTMLElement, blockManager: any): void {\n    // 清除之前的計時器\n    if (this.hoverTimer) {\n      clearTimeout(this.hoverTimer);\n    }\n\n    // 延遲顯示預覽\n    this.hoverTimer = window.setTimeout(() => {\n      const blockId = blockElement.getAttribute('title') || blockElement.textContent?.trim();\n      console.log(`🔍 懸停在元件上: ${blockId}`);\n      \n      if (!blockId) {\n        console.warn('⚠️ 無法獲取元件ID');\n        return;\n      }\n\n      // 確保 blockManager 存在\n      if (!blockManager) {\n        console.warn('⚠️ BlockManager 不存在');\n        return;\n      }\n\n      // 從 BlockManager 獲取元件資料\n      const block = blockManager.get(blockId) || this.findBlockByLabel(blockManager, blockId);\n      if (!block) {\n        console.log(`❌ 找不到元件: ${blockId}`);\n        // 列出所有可用的元件來調試\n        const allBlocks = blockManager.getAll();\n        console.log('📋 可用元件列表:', allBlocks.models ? \n          allBlocks.models.map((b: any) => ({ id: b.get('id'), label: b.get('label') })) :\n          allBlocks.map((b: any) => ({ id: b.id, label: b.label }))\n        );\n        return;\n      }\n\n      console.log(`✅ 找到元件，準備顯示預覽: ${blockId}`);\n      this.showPreview(blockElement, block);\n    }, this.config.delay);\n  }\n\n  /**\n   * 根據標籤查找元件\n   */\n  private findBlockByLabel(blockManager: any, label: string): any {\n    if (!blockManager) {\n      return null;\n    }\n    \n    try {\n      const allBlocks = blockManager.getAll().models || blockManager.getAll();\n      if (!allBlocks || !Array.isArray(allBlocks)) {\n        return null;\n      }\n      \n      return allBlocks.find((block: any) => {\n        const blockData = block.attributes || block;\n        return blockData.label === label || blockData.id === label;\n      });\n    } catch (error) {\n      console.warn('⚠️ 查找元件時發生錯誤:', error);\n      return null;\n    }\n  }\n\n  /**\n   * 處理元件離開事件\n   */\n  private handleBlockLeave(blockElement: HTMLElement): void {\n    // 清除延遲顯示的計時器\n    if (this.hoverTimer) {\n      clearTimeout(this.hoverTimer);\n      this.hoverTimer = null;\n    }\n\n    // 隱藏預覽\n    if (this.previewElement) {\n      this.previewElement.classList.remove('show');\n      setTimeout(() => {\n        if (this.previewElement && !this.previewElement.classList.contains('show')) {\n          this.previewElement.remove();\n          this.previewElement = null;\n        }\n      }, this.config.duration);\n    }\n  }\n\n  /**\n   * 顯示預覽tooltip\n   */\n  private showPreview(blockElement: HTMLElement, block: any): void {\n    // 生成預覽內容\n    const previewContent = this.generator.generatePreviewContent(block);\n    \n    // 創建tooltip元素\n    if (this.previewElement) {\n      this.previewElement.remove();\n    }\n\n    this.previewElement = document.createElement('div');\n    this.previewElement.className = 'gjs-block-preview-tooltip';\n    this.previewElement.innerHTML = previewContent;\n\n    document.body.appendChild(this.previewElement);\n\n    // 計算最佳位置\n    const position = this.calculateOptimalPosition(blockElement);\n    \n    // 設置位置\n    this.previewElement.style.left = `${position.x}px`;\n    this.previewElement.style.top = `${position.y}px`;\n\n    // 動畫顯示\n    requestAnimationFrame(() => {\n      if (this.previewElement) {\n        this.previewElement.classList.add('show');\n      }\n    });\n  }\n\n  /**\n   * 計算最佳顯示位置\n   */\n  private calculateOptimalPosition(element: HTMLElement): { x: number; y: number } {\n    const rect = element.getBoundingClientRect();\n    const viewportWidth = window.innerWidth;\n    const viewportHeight = window.innerHeight;\n    const scrollX = window.scrollX;\n    const scrollY = window.scrollY;\n\n    // 預設位置：元素右側\n    let x = rect.right + scrollX + this.config.offsetX;\n    let y = rect.top + scrollY + this.config.offsetY;\n\n    // 假設預覽框的大小（用於邊界檢查）\n    const previewWidth = this.config.maxWidth;\n    const previewHeight = this.config.maxHeight;\n\n    // 水平位置調整\n    if (x + previewWidth > viewportWidth + scrollX) {\n      // 如果右側放不下，嘗試放在左側\n      x = rect.left + scrollX - previewWidth - this.config.offsetX;\n      \n      // 如果左側也放不下，就放在視窗內\n      if (x < scrollX) {\n        x = viewportWidth + scrollX - previewWidth - 20;\n      }\n    }\n\n    // 垂直位置調整\n    if (y + previewHeight > viewportHeight + scrollY) {\n      // 如果下方放不下，向上調整\n      y = rect.bottom + scrollY - previewHeight - this.config.offsetY;\n      \n      if (this.previewElement) {\n        this.previewElement.classList.add('tooltip-bottom');\n      }\n    }\n\n    // 確保不超出視窗邊界\n    if (x < scrollX) {\n      x = scrollX + this.config.offsetX;\n    }\n\n    return { x, y };\n  }\n\n  /**\n   * 銷毀預覽功能\n   */\n  destroy(): void {\n    if (this.hoverTimer) {\n      clearTimeout(this.hoverTimer);\n    }\n\n    if (this.previewElement) {\n      this.previewElement.remove();\n      this.previewElement = null;\n    }\n\n    // 移除樣式\n    const styleElement = document.getElementById('grapesjs-block-preview-styles');\n    if (styleElement) {\n      styleElement.remove();\n    }\n\n    console.log('🗑️ 元件庫預覽功能已清理');\n  }\n\n  /**\n   * 更新配置\n   */\n  updateConfig(newConfig: Partial<BlockPreviewConfig>): void {\n    this.config = { ...this.config, ...newConfig };\n    this.generator = new BlockPreviewGenerator(this.config);\n    \n    // 如果禁用了預覽功能，則銷毀\n    if (!this.config.enabled) {\n      this.destroy();\n    }\n  }\n}\n\nexport default BlockPreviewEnhancer;","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/components/grapesjs/plugins/index.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":11,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[264,267],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[264,267],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":12,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[290,293],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[290,293],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * 自定義組件插件管理器\n * 統一管理所有自定義 GrapesJS 組件\n */\n\nimport type { Editor } from 'grapesjs';\nimport safeStyleBlocks, { pluginName as safeStyleBlocksName } from './safe-style-blocks';\n\nexport interface CustomPlugin {\n  name: string;\n  plugin: (editor: Editor, options?: any) => void;\n  options?: any;\n}\n\nexport const loadCustomPlugins = (): CustomPlugin[] => {\n  const plugins: CustomPlugin[] = [\n    {\n      name: safeStyleBlocksName,\n      plugin: safeStyleBlocks,\n      options: {}\n    }\n  ];\n  \n  return plugins;\n};\n\nexport default loadCustomPlugins","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/components/grapesjs/plugins/safe-style-blocks.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":4,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[83,86],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[83,86],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":95,"column":3,"nodeType":"MemberExpression","messageId":"unexpected","endLine":95,"endColumn":14,"suggestions":[{"fix":{"range":[5341,5370],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// 安全的樣式組件塊插件\n// 使用內聯樣式避免與編輯器樣式衝突\n\nexport default function safeStyleBlocks(editor: any) {\n  const blockManager = editor.BlockManager\n\n  // 添加安全的樣式組件塊\n  blockManager.add('safe-button-primary', {\n    label: '主要按鈕',\n    category: '樣式組件',\n    attributes: { class: 'gjs-block-section' },\n    content: `\n      <button style=\"background-color: #3B82F6; color: white; font-weight: bold; padding: 8px 16px; border-radius: 4px; border: none; cursor: pointer; transition: background-color 0.3s;\" onmouseover=\"this.style.backgroundColor='#1D4ED8'\" onmouseout=\"this.style.backgroundColor='#3B82F6'\">\n        點擊按鈕\n      </button>\n    `\n  })\n\n  blockManager.add('safe-card', {\n    label: '卡片',\n    category: '樣式組件',\n    attributes: { class: 'gjs-block-section' },\n    content: `\n      <div style=\"max-width: 384px; border-radius: 8px; overflow: hidden; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); background-color: white; margin: 16px;\">\n        <img style=\"width: 100%; height: 200px; object-fit: cover;\" src=\"https://via.placeholder.com/400x200\" alt=\"卡片圖片\">\n        <div style=\"padding: 24px 24px 16px 24px;\">\n          <div style=\"font-weight: bold; font-size: 20px; margin-bottom: 8px; color: #1F2937;\">卡片標題</div>\n          <p style=\"color: #4B5563; font-size: 16px; line-height: 1.5;\">\n            這是卡片的描述內容。您可以在這裡添加任何文字。\n          </p>\n        </div>\n        <div style=\"padding: 0 24px 16px 24px;\">\n          <span style=\"display: inline-block; background-color: #E5E7EB; border-radius: 9999px; padding: 4px 12px; font-size: 14px; font-weight: 600; color: #374151; margin-right: 8px; margin-bottom: 8px;\">#標籤</span>\n          <span style=\"display: inline-block; background-color: #E5E7EB; border-radius: 9999px; padding: 4px 12px; font-size: 14px; font-weight: 600; color: #374151; margin-right: 8px; margin-bottom: 8px;\">#卡片</span>\n        </div>\n      </div>\n    `\n  })\n\n  blockManager.add('safe-hero', {\n    label: 'Hero 區塊',\n    category: '樣式組件',\n    attributes: { class: 'gjs-block-section' },\n    content: `\n      <div style=\"background: linear-gradient(to right, #3B82F6, #8B5CF6); color: white; padding: 80px 0; text-align: center;\">\n        <div style=\"max-width: 1200px; margin: 0 auto; padding: 0 24px;\">\n          <h1 style=\"font-size: 48px; font-weight: bold; margin-bottom: 24px; margin: 0 0 24px 0;\">歡迎來到我們的網站</h1>\n          <p style=\"font-size: 20px; margin-bottom: 32px; margin: 0 0 32px 0;\">這是一個使用內聯樣式設計的 Hero 區塊</p>\n          <button style=\"background-color: white; color: #3B82F6; font-weight: bold; padding: 12px 24px; border-radius: 8px; border: none; cursor: pointer; transition: background-color 0.3s;\" onmouseover=\"this.style.backgroundColor='#F3F4F6'\" onmouseout=\"this.style.backgroundColor='white'\">\n            立即開始\n          </button>\n        </div>\n      </div>\n    `\n  })\n\n  blockManager.add('safe-contact-form', {\n    label: '聯絡表單',\n    category: '樣式組件',\n    attributes: { class: 'gjs-block-section' },\n    content: `\n      <div style=\"background-color: white; padding: 48px 0;\">\n        <div style=\"max-width: 448px; margin: 0 auto; background-color: white; border-radius: 8px; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); padding: 24px;\">\n          <h2 style=\"font-size: 24px; font-weight: bold; color: #1F2937; margin-bottom: 24px; text-align: center; margin: 0 0 24px 0;\">聯絡我們</h2>\n          <form>\n            <div style=\"margin-bottom: 16px;\">\n              <label style=\"display: block; color: #374151; font-size: 14px; font-weight: bold; margin-bottom: 8px;\" for=\"name\">\n                姓名\n              </label>\n              <input style=\"box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1); border: 1px solid #D1D5DB; border-radius: 4px; width: 100%; padding: 8px 12px; color: #374151; box-sizing: border-box;\" id=\"name\" type=\"text\" placeholder=\"請輸入您的姓名\">\n            </div>\n            <div style=\"margin-bottom: 16px;\">\n              <label style=\"display: block; color: #374151; font-size: 14px; font-weight: bold; margin-bottom: 8px;\" for=\"email\">\n                電子郵件\n              </label>\n              <input style=\"box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1); border: 1px solid #D1D5DB; border-radius: 4px; width: 100%; padding: 8px 12px; color: #374151; box-sizing: border-box;\" id=\"email\" type=\"email\" placeholder=\"請輸入您的電子郵件\">\n            </div>\n            <div style=\"margin-bottom: 24px;\">\n              <label style=\"display: block; color: #374151; font-size: 14px; font-weight: bold; margin-bottom: 8px;\" for=\"message\">\n                訊息\n              </label>\n              <textarea style=\"box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1); border: 1px solid #D1D5DB; border-radius: 4px; width: 100%; padding: 8px 12px; color: #374151; height: 128px; box-sizing: border-box; resize: vertical;\" id=\"message\" placeholder=\"請輸入您的訊息\"></textarea>\n            </div>\n            <div style=\"display: flex; align-items: center; justify-content: center;\">\n              <button style=\"background-color: #3B82F6; color: white; font-weight: bold; padding: 8px 16px; border-radius: 4px; border: none; cursor: pointer; width: 100%; transition: background-color 0.3s;\" type=\"button\" onmouseover=\"this.style.backgroundColor='#1D4ED8'\" onmouseout=\"this.style.backgroundColor='#3B82F6'\">\n                發送訊息\n              </button>\n            </div>\n          </form>\n        </div>\n      </div>\n    `\n  })\n\n  console.log('✅ 安全樣式組件塊插件已載入')\n}\n\n// 導出插件名稱用於配置\nexport const pluginName = 'safe-style-blocks'","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/components/grapesjs/plugins/safe-tailwind-components.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":9,"column":3,"nodeType":"MemberExpression","messageId":"unexpected","endLine":9,"endColumn":14,"suggestions":[{"fix":{"range":[174,213],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"sonarjs/no-duplicate-string","severity":2,"message":"Define a constant instead of duplicating this literal 6 times.","line":33,"column":19,"nodeType":"Literal","endLine":33,"endColumn":40},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":311,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":311,"endColumn":16,"suggestions":[{"fix":{"range":[10455,10521],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":314,"column":3,"nodeType":"MemberExpression","messageId":"unexpected","endLine":314,"endColumn":14,"suggestions":[{"fix":{"range":[10530,10567],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * 安全的 Tailwind CSS 組件集合\n * 提供預製的 Tailwind 組件，使用 scoped 樣式避免衝突\n */\n\nimport { Editor } from 'grapesjs'\n\nexport default function safeTailwindComponents(editor: Editor) {\n  console.log('🎨 正在載入安全 Tailwind 組件...')\n\n  editor.on('load', () => {\n    const blockManager = editor.Blocks\n\n    // 定義 Tailwind 組件類別，使用 scoped 類名\n    const tailwindComponents = [\n      {\n        id: 'tw-button-primary',\n        label: 'Primary Button',\n        content: `\n          <button class=\"tw-btn-primary\" style=\"\n            background-color: #3b82f6;\n            color: white;\n            padding: 0.5rem 1rem;\n            border-radius: 0.375rem;\n            border: none;\n            font-weight: 500;\n            cursor: pointer;\n            transition: background-color 0.2s;\n          \" onmouseover=\"this.style.backgroundColor='#2563eb'\" onmouseout=\"this.style.backgroundColor='#3b82f6'\">\n            Primary Button\n          </button>\n        `,\n        category: 'Tailwind Components',\n        attributes: { class: 'fa fa-square' }\n      },\n      {\n        id: 'tw-button-secondary',\n        label: 'Secondary Button',\n        content: `\n          <button class=\"tw-btn-secondary\" style=\"\n            background-color: #6b7280;\n            color: white;\n            padding: 0.5rem 1rem;\n            border-radius: 0.375rem;\n            border: none;\n            font-weight: 500;\n            cursor: pointer;\n            transition: background-color 0.2s;\n          \" onmouseover=\"this.style.backgroundColor='#4b5563'\" onmouseout=\"this.style.backgroundColor='#6b7280'\">\n            Secondary Button\n          </button>\n        `,\n        category: 'Tailwind Components',\n        attributes: { class: 'fa fa-square' }\n      },\n      {\n        id: 'tw-card',\n        label: 'Card',\n        content: `\n          <div class=\"tw-card\" style=\"\n            background-color: white;\n            border-radius: 0.5rem;\n            padding: 1.5rem;\n            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);\n            border: 1px solid #e5e7eb;\n            max-width: 24rem;\n          \">\n            <h3 style=\"\n              font-size: 1.25rem;\n              font-weight: 600;\n              margin-bottom: 0.5rem;\n              color: #111827;\n            \">Card Title</h3>\n            <p style=\"\n              color: #6b7280;\n              margin-bottom: 1rem;\n            \">This is a card component with Tailwind-inspired styling.</p>\n            <button style=\"\n              background-color: #3b82f6;\n              color: white;\n              padding: 0.5rem 1rem;\n              border-radius: 0.375rem;\n              border: none;\n              font-weight: 500;\n              cursor: pointer;\n            \">Learn More</button>\n          </div>\n        `,\n        category: 'Tailwind Components',\n        attributes: { class: 'fa fa-credit-card' }\n      },\n      {\n        id: 'tw-hero-section',\n        label: 'Hero Section',\n        content: `\n          <section class=\"tw-hero\" style=\"\n            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n            padding: 4rem 1rem;\n            text-align: center;\n            color: white;\n          \">\n            <div style=\"max-width: 48rem; margin: 0 auto;\">\n              <h1 style=\"\n                font-size: 3rem;\n                font-weight: 700;\n                margin-bottom: 1rem;\n                line-height: 1.2;\n              \">Welcome to Your Website</h1>\n              <p style=\"\n                font-size: 1.25rem;\n                margin-bottom: 2rem;\n                opacity: 0.9;\n              \">Build amazing experiences with our modern components.</p>\n              <button style=\"\n                background-color: white;\n                color: #667eea;\n                padding: 0.75rem 2rem;\n                border-radius: 0.5rem;\n                border: none;\n                font-weight: 600;\n                font-size: 1.1rem;\n                cursor: pointer;\n                transition: transform 0.2s;\n              \" onmouseover=\"this.style.transform='scale(1.05)'\" onmouseout=\"this.style.transform='scale(1)'\">\n                Get Started\n              </button>\n            </div>\n          </section>\n        `,\n        category: 'Tailwind Components',\n        attributes: { class: 'fa fa-home' }\n      },\n      {\n        id: 'tw-feature-grid',\n        label: 'Feature Grid',\n        content: `\n          <div class=\"tw-feature-grid\" style=\"\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));\n            gap: 2rem;\n            padding: 2rem;\n            max-width: 72rem;\n            margin: 0 auto;\n          \">\n            <div style=\"\n              text-align: center;\n              padding: 2rem;\n              border-radius: 0.5rem;\n              background-color: #f9fafb;\n              border: 1px solid #e5e7eb;\n            \">\n              <div style=\"\n                width: 4rem;\n                height: 4rem;\n                background-color: #3b82f6;\n                border-radius: 50%;\n                margin: 0 auto 1rem;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                color: white;\n                font-size: 1.5rem;\n                font-weight: bold;\n              \">1</div>\n              <h3 style=\"font-size: 1.25rem; font-weight: 600; margin-bottom: 0.5rem;\">Feature One</h3>\n              <p style=\"color: #6b7280;\">Description of your first amazing feature.</p>\n            </div>\n            <div style=\"\n              text-align: center;\n              padding: 2rem;\n              border-radius: 0.5rem;\n              background-color: #f9fafb;\n              border: 1px solid #e5e7eb;\n            \">\n              <div style=\"\n                width: 4rem;\n                height: 4rem;\n                background-color: #10b981;\n                border-radius: 50%;\n                margin: 0 auto 1rem;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                color: white;\n                font-size: 1.5rem;\n                font-weight: bold;\n              \">2</div>\n              <h3 style=\"font-size: 1.25rem; font-weight: 600; margin-bottom: 0.5rem;\">Feature Two</h3>\n              <p style=\"color: #6b7280;\">Description of your second amazing feature.</p>\n            </div>\n            <div style=\"\n              text-align: center;\n              padding: 2rem;\n              border-radius: 0.5rem;\n              background-color: #f9fafb;\n              border: 1px solid #e5e7eb;\n            \">\n              <div style=\"\n                width: 4rem;\n                height: 4rem;\n                background-color: #f59e0b;\n                border-radius: 50%;\n                margin: 0 auto 1rem;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                color: white;\n                font-size: 1.5rem;\n                font-weight: bold;\n              \">3</div>\n              <h3 style=\"font-size: 1.25rem; font-weight: 600; margin-bottom: 0.5rem;\">Feature Three</h3>\n              <p style=\"color: #6b7280;\">Description of your third amazing feature.</p>\n            </div>\n          </div>\n        `,\n        category: 'Tailwind Components',\n        attributes: { class: 'fa fa-th' }\n      },\n      {\n        id: 'tw-contact-form',\n        label: 'Contact Form',\n        content: `\n          <form class=\"tw-contact-form\" style=\"\n            max-width: 32rem;\n            margin: 0 auto;\n            padding: 2rem;\n            background-color: white;\n            border-radius: 0.5rem;\n            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);\n          \">\n            <h2 style=\"\n              font-size: 1.5rem;\n              font-weight: 600;\n              margin-bottom: 1.5rem;\n              text-align: center;\n              color: #111827;\n            \">Contact Us</h2>\n            <div style=\"margin-bottom: 1rem;\">\n              <label style=\"\n                display: block;\n                font-weight: 500;\n                margin-bottom: 0.5rem;\n                color: #374151;\n              \">Name</label>\n              <input type=\"text\" style=\"\n                width: 100%;\n                padding: 0.75rem;\n                border: 1px solid #d1d5db;\n                border-radius: 0.375rem;\n                font-size: 1rem;\n              \" placeholder=\"Your name\">\n            </div>\n            <div style=\"margin-bottom: 1rem;\">\n              <label style=\"\n                display: block;\n                font-weight: 500;\n                margin-bottom: 0.5rem;\n                color: #374151;\n              \">Email</label>\n              <input type=\"email\" style=\"\n                width: 100%;\n                padding: 0.75rem;\n                border: 1px solid #d1d5db;\n                border-radius: 0.375rem;\n                font-size: 1rem;\n              \" placeholder=\"your@email.com\">\n            </div>\n            <div style=\"margin-bottom: 1.5rem;\">\n              <label style=\"\n                display: block;\n                font-weight: 500;\n                margin-bottom: 0.5rem;\n                color: #374151;\n              \">Message</label>\n              <textarea style=\"\n                width: 100%;\n                padding: 0.75rem;\n                border: 1px solid #d1d5db;\n                border-radius: 0.375rem;\n                font-size: 1rem;\n                min-height: 120px;\n                resize: vertical;\n              \" placeholder=\"Your message...\"></textarea>\n            </div>\n            <button type=\"submit\" style=\"\n              width: 100%;\n              background-color: #3b82f6;\n              color: white;\n              padding: 0.75rem;\n              border-radius: 0.375rem;\n              border: none;\n              font-weight: 500;\n              font-size: 1rem;\n              cursor: pointer;\n              transition: background-color 0.2s;\n            \" onmouseover=\"this.style.backgroundColor='#2563eb'\" onmouseout=\"this.style.backgroundColor='#3b82f6'\">\n              Send Message\n            </button>\n          </form>\n        `,\n        category: 'Tailwind Components',\n        attributes: { class: 'fa fa-envelope' }\n      }\n    ]\n\n    // 註冊所有組件到區塊管理器\n    tailwindComponents.forEach(component => {\n      blockManager.add(component.id, component)\n    })\n\n    console.log('✅ Tailwind 組件已載入:', tailwindComponents.length, '個組件')\n  })\n\n  console.log('✅ 安全 Tailwind 組件插件載入完成')\n}","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/components/grapesjs/plugins/third-party-customization.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":7,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[115,118],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[115,118],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":8,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[141,144],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[141,144],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[157,160],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[157,160],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'editor' is assigned a value but never used.","line":16,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":31},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'editor' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":16,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":31},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'componentManager' is assigned a value but never used.","line":62,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":62,"endColumn":41},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'componentManager' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":62,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":62,"endColumn":41},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":118,"column":56,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":118,"endColumn":58,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3522,3524],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":194,"column":54,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":194,"endColumn":56,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[8216,8218],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":229,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":229,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11579,11582],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11579,11582],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":275,"column":3,"nodeType":"MemberExpression","messageId":"unexpected","endLine":275,"endColumn":14,"suggestions":[{"fix":{"range":[12674,12714],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":281,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":281,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12783,12786],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12783,12786],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":281,"column":80,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":281,"endColumn":83,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12820,12823],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12820,12823],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":284,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":284,"endColumn":17,"suggestions":[{"fix":{"range":[12900,12947],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":293,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":293,"endColumn":16,"suggestions":[{"fix":{"range":[13112,13149],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":296,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":296,"endColumn":17,"suggestions":[{"fix":{"range":[13182,13222],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":304,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":304,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13318,13321],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13318,13321],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":307,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":307,"endColumn":17,"suggestions":[{"fix":{"range":[13398,13445],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":314,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":314,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13610,13613],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13610,13613],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":320,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":320,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13786,13789],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13786,13789],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":14,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * 第三方插件微調工具\n * 提供對 GrapesJS 第三方插件的深度客製化功能\n */\n\nexport interface PluginCustomizationOptions {\n  blockManager?: any;\n  componentManager?: any;\n  editor?: any;\n}\n\n/**\n * 客製化 grapesjs-blocks-basic 插件\n */\nexport const customizeBasicBlocks = (options: PluginCustomizationOptions) => {\n  const { blockManager, editor } = options;\n\n\n  // 客製化圖片區塊\n  const imageBlock = blockManager.get('image');\n  if (imageBlock) {\n    imageBlock.set({\n      label: 'image',\n      category: 'Basic',\n      content: {\n        type: 'image',\n        style: {\n          'max-width': '100%',\n          'height': 'auto',\n          'border-radius': '8px',\n          'box-shadow': '0 4px 8px rgba(0,0,0,0.1)'\n        },\n        attributes: {\n          src: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDMwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIzMDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik0xNTAgMTAwTDEyNSA3NUgxNzVMMTUwIDEwMFoiIGZpbGw9IiM5Q0EzQUYiLz4KPGNpcmNsZSBjeD0iMTIwIiBjeT0iNjAiIHI9IjEwIiBmaWxsPSIjOUNBM0FGIi8+Cjx0ZXh0IHg9IjE1MCIgeT0iMTMwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTQiIGZpbGw9IiM2Qjc3ODUiPuWclueCueS9jeaUtOiZlTwvdGV4dD4KPC9zdmc+',\n          alt: '圖片描述'\n        }\n      }\n    });\n  }\n\n  // 優化列佈局\n  const rowBlock = blockManager.get('row');\n  if (rowBlock) {\n    rowBlock.set({\n      label: '📐 彈性列佈局',\n      category: '佈局結構',\n      content: `\n        <div class=\"gjs-row\" style=\"display: flex; flex-wrap: wrap; min-height: 50px; margin: 0 -15px; background: linear-gradient(90deg, transparent 0%, rgba(0,150,255,0.05) 50%, transparent 100%); border-radius: 8px;\">\n          <div class=\"gjs-column\" style=\"flex: 1 1 100%; padding: 0 15px; min-height: 50px; border: 2px dashed rgba(0,150,255,0.3); border-radius: 4px; margin: 5px 0;\">\n            <div style=\"padding: 20px; text-align: center; color: #666; font-size: 14px;\">拖拽內容到此處</div>\n          </div>\n        </div>\n      `\n    });\n  }\n};\n\n/**\n * 客製化表單插件\n */\nexport const customizeFormBlocks = (options: PluginCustomizationOptions) => {\n  const { blockManager, componentManager } = options;\n\n  // 增強表單輸入框\n  const inputBlock = blockManager.get('input');\n  if (inputBlock) {\n    inputBlock.set({\n      label: '📝 智能輸入框',\n      content: {\n        type: 'input',\n        classes: ['form-input', 'enhanced-input'],\n        attributes: {\n          placeholder: '請輸入內容...',\n          'data-validation': 'required'\n        },\n        style: {\n          'border-radius': '8px',\n          'border': '2px solid #e1e5e9',\n          'padding': '12px 16px',\n          'transition': 'all 0.3s ease',\n          'width': '100%'\n        }\n      }\n    });\n  }\n\n  // 客製化提交按鈕\n  const buttonBlock = blockManager.get('button');\n  if (buttonBlock) {\n    buttonBlock.set({\n      label: '動效按鈕',\n      content: {\n        type: 'button',\n        content: '提交表單',\n        classes: ['form-button', 'enhanced-button'],\n        style: {\n          'background': 'linear-gradient(45deg, #007bff, #0056b3)',\n          'color': 'white',\n          'border': 'none',\n          'padding': '12px 24px',\n          'border-radius': '8px',\n          'cursor': 'pointer',\n          'transition': 'all 0.3s ease',\n          'font-weight': '600'\n        }\n      }\n    });\n  }\n};\n\n/**\n * 客製化倒計時插件\n */\nexport const customizeCountdownBlocks = (options: PluginCustomizationOptions) => {\n  const { blockManager } = options;\n\n  // 尋找倒計時區塊\n  const countdownBlock = blockManager.get('countdown') || blockManager.get('component-countdown');\n  if (countdownBlock) {\n    countdownBlock.set({\n      label: '⏰ 精美倒計時',\n      content: `\n        <div class=\"countdown-container\" style=\"text-align: center; padding: 30px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 16px; color: white; box-shadow: 0 10px 30px rgba(0,0,0,0.3);\">\n          <h3 style=\"margin: 0 0 20px 0; font-size: 24px; font-weight: 300;\">限時優惠</h3>\n          <div class=\"countdown-timer\" data-countdown=\"2024-12-31T23:59:59\" style=\"display: flex; justify-content: center; gap: 20px; flex-wrap: wrap;\">\n            <div class=\"time-unit\" style=\"text-align: center; min-width: 70px;\">\n              <div class=\"time-value\" style=\"font-size: 36px; font-weight: bold; line-height: 1; margin-bottom: 5px;\">00</div>\n              <div class=\"time-label\" style=\"font-size: 12px; opacity: 0.8; text-transform: uppercase;\">天</div>\n            </div>\n            <div class=\"time-unit\" style=\"text-align: center; min-width: 70px;\">\n              <div class=\"time-value\" style=\"font-size: 36px; font-weight: bold; line-height: 1; margin-bottom: 5px;\">00</div>\n              <div class=\"time-label\" style=\"font-size: 12px; opacity: 0.8; text-transform: uppercase;\">時</div>\n            </div>\n            <div class=\"time-unit\" style=\"text-align: center; min-width: 70px;\">\n              <div class=\"time-value\" style=\"font-size: 36px; font-weight: bold; line-height: 1; margin-bottom: 5px;\">00</div>\n              <div class=\"time-label\" style=\"font-size: 12px; opacity: 0.8; text-transform: uppercase;\">分</div>\n            </div>\n            <div class=\"time-unit\" style=\"text-align: center; min-width: 70px;\">\n              <div class=\"time-value\" style=\"font-size: 36px; font-weight: bold; line-height: 1; margin-bottom: 5px;\">00</div>\n              <div class=\"time-label\" style=\"font-size: 12px; opacity: 0.8; text-transform: uppercase;\">秒</div>\n            </div>\n          </div>\n          <p style=\"margin: 20px 0 0 0; opacity: 0.9; font-size: 16px;\">機會難得，立即行動！</p>\n        </div>\n      `\n    });\n  }\n};\n\n/**\n * 客製化標籤頁插件\n */\nexport const customizeTabsBlocks = (options: PluginCustomizationOptions) => {\n  const { blockManager } = options;\n\n  const tabsBlock = blockManager.get('tabs');\n  if (tabsBlock) {\n    tabsBlock.set({\n      label: '📑 現代標籤頁',\n      content: `\n        <div class=\"tabs-container\" style=\"margin: 20px 0;\">\n          <div class=\"tab-nav\" style=\"display: flex; background: #f8f9fa; border-radius: 12px 12px 0 0; overflow: hidden; border-bottom: 3px solid #dee2e6;\">\n            <button class=\"tab-nav-item active\" data-tab=\"1\" style=\"flex: 1; padding: 16px 20px; background: white; border: none; cursor: pointer; font-weight: 600; color: #007bff; position: relative;\">\n              標籤一\n              <span style=\"position: absolute; bottom: -3px; left: 0; right: 0; height: 3px; background: #007bff;\"></span>\n            </button>\n            <button class=\"tab-nav-item\" data-tab=\"2\" style=\"flex: 1; padding: 16px 20px; background: #f8f9fa; border: none; cursor: pointer; font-weight: 500; color: #6c757d;\">標籤二</button>\n            <button class=\"tab-nav-item\" data-tab=\"3\" style=\"flex: 1; padding: 16px 20px; background: #f8f9fa; border: none; cursor: pointer; font-weight: 500; color: #6c757d;\">標籤三</button>\n          </div>\n          <div class=\"tab-content active\" data-content=\"1\" style=\"background: white; padding: 30px; border-radius: 0 0 12px 12px; border: 1px solid #dee2e6; border-top: none; min-height: 200px;\">\n            <h4 style=\"margin-top: 0; color: #007bff;\">標籤內容一</h4>\n            <p style=\"color: #6c757d; line-height: 1.6;\">這裡是第一個標籤的內容。您可以添加任何HTML內容，包括文字、圖片、按鈕等。</p>\n          </div>\n          <div class=\"tab-content\" data-content=\"2\" style=\"background: white; padding: 30px; border-radius: 0 0 12px 12px; border: 1px solid #dee2e6; border-top: none; min-height: 200px; display: none;\">\n            <h4 style=\"margin-top: 0; color: #28a745;\">標籤內容二</h4>\n            <p style=\"color: #6c757d; line-height: 1.6;\">這裡是第二個標籤的內容。可以包含不同的資訊和佈局。</p>\n          </div>\n          <div class=\"tab-content\" data-content=\"3\" style=\"background: white; padding: 30px; border-radius: 0 0 12px 12px; border: 1px solid #dee2e6; border-top: none; min-height: 200px; display: none;\">\n            <h4 style=\"margin-top: 0; color: #ffc107;\">標籤內容三</h4>\n            <p style=\"color: #6c757d; line-height: 1.6;\">這裡是第三個標籤的內容。展示更多功能特色。</p>\n          </div>\n        </div>\n      `\n    });\n  }\n};\n\n/**\n * 客製化輪播組件\n */\nexport const customizeCarouselBlocks = (options: PluginCustomizationOptions) => {\n  const { blockManager } = options;\n\n  const carouselBlock = blockManager.get('carousel') || blockManager.get('grapesjs-carousel-component');\n  if (carouselBlock) {\n    carouselBlock.set({\n      label: '全寬響應式輪播',\n      content: `\n        <div class=\"carousel-container full-width\" style=\"position: relative; width: 100vw; left: 50%; right: 50%; margin-left: -50vw; margin-right: -50vw; overflow: hidden; box-shadow: 0 8px 32px rgba(0,0,0,0.1);\">\n          <div class=\"carousel-slides\" style=\"position: relative; height: 60vh; min-height: 400px;\">\n            <div class=\"carousel-slide active\" style=\"position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(45deg, #667eea, #764ba2); display: flex; align-items: center; justify-content: center; color: white; font-size: 3rem; font-weight: 300; text-shadow: 2px 2px 4px rgba(0,0,0,0.5);\">\n              全寬輪播 1\n            </div>\n            <div class=\"carousel-slide\" style=\"position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(45deg, #f093fb, #f5576c); display: flex; align-items: center; justify-content: center; color: white; font-size: 3rem; font-weight: 300; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); opacity: 0;\">\n              全寬輪播 2\n            </div>\n            <div class=\"carousel-slide\" style=\"position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(45deg, #4facfe, #00f2fe); display: flex; align-items: center; justify-content: center; color: white; font-size: 3rem; font-weight: 300; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); opacity: 0;\">\n              全寬輪播 3\n            </div>\n          </div>\n          \n          <button class=\"carousel-arrow prev\" style=\"position: absolute; left: 30px; top: 50%; transform: translateY(-50%); background: rgba(255,255,255,0.9); border: none; width: 60px; height: 60px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 24px; color: #333; box-shadow: 0 4px 16px rgba(0,0,0,0.3); z-index: 10;\">❮</button>\n          <button class=\"carousel-arrow next\" style=\"position: absolute; right: 30px; top: 50%; transform: translateY(-50%); background: rgba(255,255,255,0.9); border: none; width: 60px; height: 60px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 24px; color: #333; box-shadow: 0 4px 16px rgba(0,0,0,0.3); z-index: 10;\">❯</button>\n          \n          <div class=\"carousel-indicators\" style=\"position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%); display: flex; gap: 15px; z-index: 10;\">\n            <button class=\"carousel-dot active\" data-slide=\"0\" style=\"width: 16px; height: 16px; border-radius: 50%; border: none; background: white; cursor: pointer; box-shadow: 0 2px 8px rgba(0,0,0,0.4); transition: all 0.3s ease;\"></button>\n            <button class=\"carousel-dot\" data-slide=\"1\" style=\"width: 16px; height: 16px; border-radius: 50%; border: none; background: rgba(255,255,255,0.6); cursor: pointer; transition: all 0.3s ease;\"></button>\n            <button class=\"carousel-dot\" data-slide=\"2\" style=\"width: 16px; height: 16px; border-radius: 50%; border: none; background: rgba(255,255,255,0.6); cursor: pointer; transition: all 0.3s ease;\"></button>\n          </div>\n        </div>\n      `\n    });\n  }\n};\n\n/**\n * 統一執行所有第三方插件客製化\n */\nexport const applyAllPluginCustomizations = (editor: any) => {\n  const blockManager = editor.BlockManager;\n  const componentManager = editor.ComponentManager;\n  \n  const options = {\n    blockManager,\n    componentManager,\n    editor\n  };\n\n  // 應用所有客製化\n  customizeBasicBlocks(options);\n  customizeFormBlocks(options);\n  customizeCountdownBlocks(options);\n  customizeTabsBlocks(options);\n  customizeCarouselBlocks(options);\n\n  // 添加全寬輪播的專用樣式到頁面\n  const style = editor.getModel().get('style');\n  const fullWidthCarouselCSS = `\n    .carousel-container.full-width {\n      width: 100vw !important;\n      left: 50% !important;\n      right: 50% !important;\n      margin-left: -50vw !important;\n      margin-right: -50vw !important;\n      position: relative !important;\n      border-radius: 0 !important;\n    }\n    \n    .carousel-container.full-width .carousel-slides {\n      height: 60vh;\n      min-height: 400px;\n    }\n    \n    @media (max-width: 768px) {\n      .carousel-container.full-width .carousel-slides {\n        height: 50vh;\n        min-height: 300px;\n      }\n    }\n  `;\n  \n  // 將CSS添加到編輯器的樣式中\n  editor.setStyle(style + fullWidthCarouselCSS);\n\n  console.log('✅ 所有第三方插件客製化已套用，包含全寬輪播功能');\n};\n\n/**\n * 動態修改插件區塊屬性\n */\nexport const modifyPluginBlock = (editor: any, blockId: string, modifications: any) => {\n  // 檢查 editor 和 BlockManager 是否存在\n  if (!editor?.BlockManager) {\n    console.warn(`⚠️  Editor 或 BlockManager 未初始化`);\n    return false;\n  }\n  \n  const blockManager = editor.BlockManager;\n  const block = blockManager.get(blockId);\n  \n  if (block) {\n    block.set(modifications);\n    console.log(`✅ 已修改插件區塊: ${blockId}`);\n    return true;\n  } else {\n    console.warn(`⚠️  找不到插件區塊: ${blockId}`);\n    return false;\n  }\n};\n\n/**\n * 獲取所有第三方插件區塊列表\n */\nexport const getThirdPartyBlocks = (editor: any) => {\n  // 檢查 editor 和 BlockManager 是否存在\n  if (!editor?.BlockManager) {\n    console.warn(`⚠️  Editor 或 BlockManager 未初始化`);\n    return [];\n  }\n  \n  const blockManager = editor.BlockManager;\n  const allBlocks = blockManager.getAll();\n  \n  const thirdPartyBlocks = allBlocks.filter((block: any) => {\n    const id = block.get('id');\n    // 根據區塊ID判斷是否為第三方插件區塊\n    return !id.startsWith('home-') && !id.includes('custom-');\n  });\n\n  return thirdPartyBlocks.map((block: any) => ({\n    id: block.get('id'),\n    label: block.get('label'),\n    category: block.get('category'),\n    attributes: block.attributes\n  }));\n};","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/components/grapesjs/sanity-image-picker.ts","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":45,"column":53,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":45,"endColumn":55,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1268,1270],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":46,"column":30,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":46,"endColumn":32,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1322,1324],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":132,"column":68,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":132,"endColumn":70,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[4712,4714],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":135,"column":69,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":135,"endColumn":71,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[4898,4900],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":189,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":189,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6614,6617],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6614,6617],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":201,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":201,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6992,6995],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6992,6995],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":201,"column":47,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":201,"endColumn":49,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[6997,6999],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":235,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":235,"endColumn":18,"suggestions":[{"fix":{"range":[7967,8052],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":253,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":253,"endColumn":22,"suggestions":[{"fix":{"range":[8617,8750],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":255,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":255,"endColumn":23,"suggestions":[{"fix":{"range":[8798,8849],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":274,"column":62,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":274,"endColumn":64,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[9528,9530],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-alert","severity":2,"message":"Unexpected alert.","line":289,"column":9,"nodeType":"CallExpression","messageId":"unexpected","endLine":289,"endColumn":26},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":293,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":293,"endColumn":20,"suggestions":[{"fix":{"range":[10111,10140],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-alert","severity":2,"message":"Unexpected alert.","line":294,"column":7,"nodeType":"CallExpression","messageId":"unexpected","endLine":294,"endColumn":24},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":331,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":331,"endColumn":20,"suggestions":[{"fix":{"range":[11519,11572],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * 自定義 GrapesJS 圖片選擇器\n * 整合 Sanity 媒體庫功能\n */\n\nimport { buildSanityImageUrl, type SanityImage } from '@/lib/services/sanity-media-service'\nimport { compressImage } from '@/lib/image-compression'\n\nexport interface ImagePickerOptions {\n  onSelect: (imageUrl: string) => void\n  onClose: () => void\n  allowUpload?: boolean\n}\n\nexport class SanityImagePicker {\n  private modal: HTMLElement | null = null\n  private images: SanityImage[] = []\n  private readonly options: ImagePickerOptions\n  private page = 1\n  private readonly pageSize = 24\n  private q = ''\n  private sort: 'newest' | 'oldest' | 'largest' | 'smallest' = 'newest'\n  private nextPage?: number\n\n  constructor(options: ImagePickerOptions) {\n    this.options = options\n  }\n\n  async show() {\n    await this.loadImages()\n    this.createModal()\n    this.attachEvents()\n  }\n\n  private async loadImages() {\n    const params = new URLSearchParams({\n      page: String(this.page),\n      pageSize: String(this.pageSize),\n      sort: this.sort,\n    })\n    if (this.q) params.set('q', this.q)\n    const res = await fetch(`/api/sanity/assets?${params.toString()}`)\n    if (!res.ok) throw new Error(`List assets failed: ${res.status}`)\n    const json = await res.json()\n    if (!json?.success) throw new Error(json?.error || 'List assets failed')\n    this.images = json.items || []\n    this.nextPage = json.nextPage\n  }\n\n  private createModal() {\n    // 移除現有的模態框\n    const existingModal = document.querySelector('.sanity-image-picker-modal')\n    if (existingModal) {\n      existingModal.remove()\n    }\n\n    this.modal = document.createElement('div')\n    this.modal.className = 'sanity-image-picker-modal'\n    this.modal.innerHTML = `\n      <div class=\"sanity-image-picker-overlay\">\n        <div class=\"sanity-image-picker-content\">\n          <div class=\"sanity-image-picker-header\">\n            <h3>選擇圖片</h3>\n            <div class=\"sanity-image-picker-tools\">\n              <input type=\"search\" class=\"sanity-image-search\" placeholder=\"搜尋檔名...\" value=\"${this.q}\">\n              <select class=\"sanity-image-sort\">\n                <option value=\"newest\" ${this.sort==='newest'?'selected':''}>最新</option>\n                <option value=\"oldest\" ${this.sort==='oldest'?'selected':''}>最舊</option>\n                <option value=\"largest\" ${this.sort==='largest'?'selected':''}>最大</option>\n                <option value=\"smallest\" ${this.sort==='smallest'?'selected':''}>最小</option>\n              </select>\n              <button class=\"sanity-image-picker-close\" aria-label=\"關閉\">&times;</button>\n            </div>\n          </div>\n          \n          ${this.options.allowUpload !== false ? `\n            <div class=\"sanity-image-picker-upload\">\n              <input type=\"file\" id=\"sanity-image-upload\" accept=\"image/*\" style=\"display: none;\">\n              <button class=\"sanity-upload-btn\" onclick=\"document.getElementById('sanity-image-upload').click()\">\n                <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n                  <path d=\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\"/>\n                  <polyline points=\"7,10 12,15 17,10\"/>\n                  <line x1=\"12\" y1=\"15\" x2=\"12\" y2=\"3\"/>\n                </svg>\n                上傳新圖片\n              </button>\n              <div class=\"upload-progress\" style=\"display: none;\">\n                <div class=\"upload-progress-bar\"></div>\n              </div>\n            </div>\n          ` : ''}\n          \n          <div class=\"sanity-image-picker-grid\">\n            ${this.renderImageGrid()}\n          </div>\n          <div class=\"sanity-image-pagination\">\n            <button class=\"btn-prev\" ${this.page<=1?'disabled':''}>上一頁</button>\n            <span class=\"page-indicator\">第 ${this.page} 頁</span>\n            <button class=\"btn-next\" ${this.nextPage? '': 'disabled'}>下一頁</button>\n          </div>\n          \n          ${this.images.length === 0 ? `\n            <div class=\"sanity-image-picker-empty\">\n              <p>沒有找到圖片</p>\n              <p class=\"text-small\">請先在 Sanity Studio 中上傳一些圖片</p>\n            </div>\n          ` : ''}\n        </div>\n      </div>\n    `\n\n    // 添加樣式\n    this.addStyles()\n    \n    document.body.appendChild(this.modal)\n    \n    // 淡入動畫\n    setTimeout(() => {\n      this.modal?.classList.add('show')\n    }, 10)\n  }\n\n  private renderImageGrid(): string {\n    if (this.images.length === 0) return ''\n    \n    return this.images.map(image => {\n      const thumbnailUrl = buildSanityImageUrl(image, 300, 200, 80)\n      const fullUrl = buildSanityImageUrl(image, 1200, 800, 90)\n      \n      return `\n        <div class=\"sanity-image-item\" data-url=\"${fullUrl}\">\n          <img src=\"${thumbnailUrl}\" alt=\"${image.originalFilename || 'Image'}\" loading=\"lazy\">\n          <div class=\"sanity-image-overlay\">\n            <div class=\"sanity-image-info\">\n              <p class=\"sanity-image-name\">${image.originalFilename || 'Untitled'}</p>\n              <p class=\"sanity-image-size\">${image.metadata.dimensions.width}×${image.metadata.dimensions.height}</p>\n            </div>\n            <button class=\"sanity-select-btn\">選擇</button>\n          </div>\n        </div>\n      `\n    }).join('')\n  }\n\n  private attachEvents() {\n    if (!this.modal) return\n\n    // 關閉按鈕\n    const closeBtn = this.modal.querySelector('.sanity-image-picker-close')\n    closeBtn?.addEventListener('click', () => this.close())\n\n    // 點擊覆蓋層關閉\n    const overlay = this.modal.querySelector('.sanity-image-picker-overlay')\n    overlay?.addEventListener('click', (e) => {\n      if (e.target === overlay) this.close()\n    })\n\n    // ESC 鍵關閉\n    const handleKeydown = (e: KeyboardEvent) => {\n      if (e.key === 'Escape') {\n        this.close()\n        document.removeEventListener('keydown', handleKeydown)\n      }\n    }\n    document.addEventListener('keydown', handleKeydown)\n\n    // 圖片選擇\n    const imageItems = this.modal.querySelectorAll('.sanity-image-item')\n    imageItems.forEach(item => {\n      item.addEventListener('click', () => {\n        const url = item.getAttribute('data-url')\n        if (url) {\n          this.options.onSelect(url)\n          this.close()\n        }\n      })\n    })\n\n    // 上傳功能\n    if (this.options.allowUpload !== false) {\n      const uploadInput = this.modal.querySelector('#sanity-image-upload') as HTMLInputElement\n      uploadInput?.addEventListener('change', (e) => this.handleFileUpload(e))\n    }\n\n    // 搜尋與排序\n    const searchInput = this.modal.querySelector('.sanity-image-search') as HTMLInputElement\n    const sortSelect = this.modal.querySelector('.sanity-image-sort') as HTMLSelectElement\n    if (searchInput) {\n      let t: any\n      searchInput.addEventListener('input', async () => {\n        clearTimeout(t)\n        t = setTimeout(async () => {\n          this.q = searchInput.value.trim()\n          this.page = 1\n          await this.refreshList()\n        }, 300)\n      })\n    }\n    if (sortSelect) {\n      sortSelect.addEventListener('change', async () => {\n        this.sort = (sortSelect.value as any) || 'newest'\n        this.page = 1\n        await this.refreshList()\n      })\n    }\n\n    // 分頁\n    const prevBtn = this.modal.querySelector('.btn-prev') as HTMLButtonElement\n    const nextBtn = this.modal.querySelector('.btn-next') as HTMLButtonElement\n    prevBtn?.addEventListener('click', async () => {\n      if (this.page > 1) {\n        this.page -= 1\n        await this.refreshList()\n      }\n    })\n    nextBtn?.addEventListener('click', async () => {\n      if (this.nextPage) {\n        this.page = this.nextPage\n        await this.refreshList()\n      }\n    })\n  }\n\n  private async handleFileUpload(e: Event) {\n    const input = e.target as HTMLInputElement\n    const file = input.files?.[0]\n    if (!file) return\n\n    const progressEl = this.modal?.querySelector('.upload-progress') as HTMLElement\n    const progressBarEl = this.modal?.querySelector('.upload-progress-bar') as HTMLElement\n    \n    if (progressEl) progressEl.style.display = 'block'\n\n    try {\n      console.log(`🖼️ 開始處理上傳圖片: ${file.name} (${(file.size / 1024 / 1024).toFixed(2)}MB)`)\n      \n      // 壓縮圖片\n      let fileToUpload: File = file\n      if (file.type.startsWith('image/')) {\n        try {\n          const compressedDataUrl = await compressImage(file, {\n            maxWidth: 1200,\n            maxHeight: 800,\n            quality: 0.8,\n            maxSizeKB: 500 // 限制為 500KB\n          })\n          \n          // 將壓縮後的 base64 轉換回 File 對象\n          const response = await fetch(compressedDataUrl)\n          const blob = await response.blob()\n          fileToUpload = new File([blob], file.name, { type: 'image/jpeg' })\n          \n          console.log(`✅ 圖片壓縮完成: ${file.name} (${(file.size / 1024 / 1024).toFixed(2)}MB → ${(fileToUpload.size / 1024 / 1024).toFixed(2)}MB)`)\n        } catch (compressionError) {\n          console.warn('⚠️ 圖片壓縮失敗，使用原始檔案:', compressionError)\n          // 繼續使用原始文件\n        }\n      }\n\n      // 模擬進度（實際上 Sanity 上傳沒有進度回調）\n      let progress = 0\n      const progressInterval = setInterval(() => {\n        progress += Math.random() * 30\n        if (progress > 90) progress = 90\n        if (progressBarEl) progressBarEl.style.width = progress + '%'\n      }, 200)\n\n      // 透過伺服器端 API 上傳，避免在前端暴露憑證\n      const formData = new FormData()\n      formData.append('file', fileToUpload)\n      const res = await fetch('/api/sanity/upload', { method: 'POST', body: formData })\n      if (!res.ok) throw new Error(`Upload failed ${res.status}`)\n      const j = await res.json()\n      if (!j?.success || !j?.image) throw new Error(j?.error || 'Upload failed')\n      const uploadedImage = j.image as SanityImage\n      \n      clearInterval(progressInterval)\n      if (progressBarEl) progressBarEl.style.width = '100%'\n\n      if (uploadedImage) {\n        // 選擇剛上傳的圖片\n        const imageUrl = buildSanityImageUrl(uploadedImage, 1200, 800, 90)\n        setTimeout(async () => {\n          this.options.onSelect(imageUrl)\n          await this.refreshList()\n          this.close()\n        }, 300)\n      } else {\n        alert('上傳失敗，請重試')\n        if (progressEl) progressEl.style.display = 'none'\n      }\n    } catch (error) {\n      console.error('上傳錯誤:', error)\n      alert('上傳失敗，請重試')\n      if (progressEl) progressEl.style.display = 'none'\n    }\n\n    // 清除選擇\n    input.value = ''\n  }\n\n  private async refreshList() {\n    try {\n      // 顯示 loading 骨架\n      const grid = this.modal?.querySelector('.sanity-image-picker-grid') as HTMLElement | null\n      const pag = this.modal?.querySelector('.sanity-image-pagination') as HTMLElement | null\n      if (grid) grid.innerHTML = '<div style=\"padding:16px;color:#6b7280;\">載入中...</div>'\n      await this.loadImages()\n      if (grid) grid.innerHTML = this.renderImageGrid()\n      // 重新綁定圖片點擊事件\n      const imageItems = this.modal?.querySelectorAll('.sanity-image-item')\n      imageItems?.forEach(item => {\n        item.addEventListener('click', () => {\n          const url = item.getAttribute('data-url')\n          if (url) {\n            this.options.onSelect(url)\n            this.close()\n          }\n        })\n      })\n      // 更新分頁狀態\n      if (pag) {\n        const prevBtn = pag.querySelector('.btn-prev') as HTMLButtonElement\n        const nextBtn = pag.querySelector('.btn-next') as HTMLButtonElement\n        const indicator = pag.querySelector('.page-indicator') as HTMLElement\n        if (indicator) indicator.textContent = `第 ${this.page} 頁`\n        if (prevBtn) prevBtn.disabled = this.page <= 1\n        if (nextBtn) nextBtn.disabled = !this.nextPage\n      }\n    } catch (error) {\n      console.error('Failed to refresh image list:', error)\n      const grid = this.modal?.querySelector('.sanity-image-picker-grid') as HTMLElement\n      if (grid) grid.innerHTML = '<div style=\"padding:16px;color:#b91c1c;\">載入失敗，請重試</div>'\n    }\n  }\n\n  private addStyles() {\n    if (document.querySelector('#sanity-image-picker-styles')) return\n\n    const style = document.createElement('style')\n    style.id = 'sanity-image-picker-styles'\n    style.textContent = `\n      .sanity-image-picker-modal {\n        position: fixed;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        z-index: 10000;\n        opacity: 0;\n        visibility: hidden;\n        transition: opacity 0.3s ease, visibility 0.3s ease;\n      }\n      \n      .sanity-image-picker-modal.show {\n        opacity: 1;\n        visibility: visible;\n      }\n      \n      .sanity-image-picker-overlay {\n        position: absolute;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        background: rgba(0, 0, 0, 0.75);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        padding: 20px;\n      }\n      \n      .sanity-image-picker-content {\n        background: white;\n        border-radius: 12px;\n        max-width: 90vw;\n        max-height: 90vh;\n        width: 800px;\n        display: flex;\n        flex-direction: column;\n        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);\n        transform: scale(0.95);\n        transition: transform 0.3s ease;\n      }\n      \n      .sanity-image-picker-modal.show .sanity-image-picker-content {\n        transform: scale(1);\n      }\n      \n      .sanity-image-picker-header {\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        padding: 20px 24px;\n        border-bottom: 1px solid #e5e7eb;\n      }\n      \n      .sanity-image-picker-header h3 {\n        margin: 0;\n        font-size: 18px;\n        font-weight: 600;\n        color: #1f2937;\n      }\n      \n      .sanity-image-picker-close {\n        background: none;\n        border: none;\n        font-size: 24px;\n        cursor: pointer;\n        color: #6b7280;\n        padding: 4px;\n        line-height: 1;\n        transition: color 0.2s ease;\n      }\n      \n      .sanity-image-picker-close:hover {\n        color: #374151;\n      }\n      \n      .sanity-image-picker-upload {\n        padding: 16px 24px;\n        border-bottom: 1px solid #f3f4f6;\n      }\n      \n      .sanity-upload-btn {\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        background: #3b82f6;\n        color: white;\n        border: none;\n        padding: 10px 16px;\n        border-radius: 8px;\n        cursor: pointer;\n        font-size: 14px;\n        font-weight: 500;\n        transition: background-color 0.2s ease;\n      }\n      \n      .sanity-upload-btn:hover {\n        background: #2563eb;\n      }\n      \n      .upload-progress {\n        margin-top: 12px;\n        background: #f3f4f6;\n        border-radius: 6px;\n        height: 6px;\n        overflow: hidden;\n      }\n      \n      .upload-progress-bar {\n        height: 100%;\n        background: #3b82f6;\n        width: 0%;\n        transition: width 0.3s ease;\n      }\n      \n      .sanity-image-picker-grid {\n        padding: 20px 24px;\n        max-height: 500px;\n        overflow-y: auto;\n        display: grid;\n        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));\n        gap: 16px;\n      }\n      \n      .sanity-image-item {\n        position: relative;\n        border-radius: 8px;\n        overflow: hidden;\n        cursor: pointer;\n        transition: transform 0.2s ease, box-shadow 0.2s ease;\n        background: #f9fafb;\n      }\n      \n      .sanity-image-item:hover {\n        transform: translateY(-2px);\n        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);\n      }\n      \n      .sanity-image-item img {\n        width: 100%;\n        height: 120px;\n        object-fit: cover;\n        display: block;\n      }\n      \n      .sanity-image-overlay {\n        position: absolute;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        background: linear-gradient(to bottom, transparent 0%, rgba(0,0,0,0.8) 100%);\n        display: flex;\n        flex-direction: column;\n        justify-content: flex-end;\n        padding: 12px;\n        opacity: 0;\n        transition: opacity 0.2s ease;\n      }\n      \n      .sanity-image-item:hover .sanity-image-overlay {\n        opacity: 1;\n      }\n      \n      .sanity-image-info {\n        color: white;\n        margin-bottom: 8px;\n      }\n      \n      .sanity-image-name {\n        font-size: 12px;\n        font-weight: 500;\n        margin: 0 0 2px 0;\n        white-space: nowrap;\n        overflow: hidden;\n        text-overflow: ellipsis;\n      }\n      \n      .sanity-image-size {\n        font-size: 11px;\n        color: rgba(255, 255, 255, 0.8);\n        margin: 0;\n      }\n      \n      .sanity-select-btn {\n        background: #10b981;\n        color: white;\n        border: none;\n        padding: 6px 12px;\n        border-radius: 6px;\n        font-size: 12px;\n        font-weight: 500;\n        cursor: pointer;\n        transition: background-color 0.2s ease;\n      }\n      \n      .sanity-select-btn:hover {\n        background: #059669;\n      }\n      \n      .sanity-image-picker-empty {\n        display: flex;\n        flex-direction: column;\n        align-items: center;\n        justify-content: center;\n        padding: 60px 20px;\n        color: #6b7280;\n        text-align: center;\n      }\n      \n      .sanity-image-picker-empty p {\n        margin: 0 0 8px 0;\n      }\n      \n      .sanity-image-picker-empty .text-small {\n        font-size: 14px;\n        color: #9ca3af;\n      }\n      \n      /* 響應式設計 */\n      @media (max-width: 640px) {\n        .sanity-image-picker-content {\n          width: 95vw;\n          max-height: 85vh;\n        }\n        \n        .sanity-image-picker-grid {\n          grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));\n          gap: 12px;\n          padding: 16px;\n        }\n        \n        .sanity-image-picker-header {\n          padding: 16px 20px;\n        }\n        \n        .sanity-image-picker-upload {\n          padding: 12px 20px;\n        }\n      }\n    `\n    \n    document.head.appendChild(style)\n  }\n\n  private close() {\n    if (this.modal) {\n      this.modal.classList.remove('show')\n      setTimeout(() => {\n        this.modal?.remove()\n        this.options.onClose()\n      }, 300)\n    }\n  }\n}\n\n/**\n * 顯示 Sanity 圖片選擇器\n */\nexport function showSanityImagePicker(options: ImagePickerOptions): SanityImagePicker {\n  const picker = new SanityImagePicker(options)\n  picker.show()\n  return picker\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/components/sanity/GrapesJSInput.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'unset' is defined but never used.","line":2,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":20},{"ruleId":"unused-imports/no-unused-imports","severity":2,"message":"'unset' is defined but never used.","line":2,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":20,"fix":{"range":[74,81],"text":""}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":5,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[158,161],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[158,161],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":5,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[163,166],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[163,166],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ref' is defined but never used.","line":5,"column":58,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":61},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'ref' is defined but never used. Allowed unused args must match /^_/u.","line":5,"column":58,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":61},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'elementProps' is assigned a value but never used.","line":6,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":23},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'elementProps' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":6,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":23},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":8,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[322,325],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[322,325],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":22,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":22,"endColumn":20,"suggestions":[{"fix":{"range":[620,663],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":29,"column":28,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":29,"endColumn":30,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[866,868],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":35,"column":22,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":35,"endColumn":24,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1049,1051],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":79,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":79,"endColumn":20,"suggestions":[{"fix":{"range":[2254,2293],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":82,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":82,"endColumn":22,"suggestions":[{"fix":{"range":[2327,2376],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":95,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":95,"endColumn":23,"suggestions":[{"fix":{"range":[2631,2661],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":116,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":116,"endColumn":20,"suggestions":[{"fix":{"range":[3083,3124],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import React, { useCallback, useEffect, useRef } from 'react'\nimport { set, unset } from 'sanity'\n\n// GrapesJS 編輯器輸入組件\nconst GrapesJSInput = React.forwardRef<any, any>((props, ref) => {\n  const { elementProps, onChange, value = {} } = props\n  const editorRef = useRef<HTMLDivElement>(null)\n  const editorInstance = useRef<any>(null)\n\n  const { html = '', css = '', components = '[]' } = value\n\n  // 初始化編輯器\n  useEffect(() => {\n    let mounted = true\n\n    const initEditor = async () => {\n      try {\n        if (!mounted || !editorRef.current) return\n\n        const grapesjs = (await import('grapesjs')).default\n\n        console.log('正在初始化 Sanity GrapesJS 編輯器...')\n\n        editorInstance.current = grapesjs.init({\n          container: editorRef.current,\n          height: '600px',\n          width: '100%',\n          storageManager: false,\n          components: html || `\n            <div style=\"padding: 20px; text-align: center;\">\n              <h1>開始設計您的頁面</h1>\n              <p>從左側拖拽元件到這裡</p>\n            </div>\n          `,\n          style: css || '',\n          blockManager: {\n            appendTo: '.blocks-container',\n          },\n          styleManager: {\n            appendTo: '.styles-container',\n          },\n          layerManager: {\n            appendTo: '.layers-container',\n          },\n        })\n\n        // 添加基本元件\n        const blockManager = editorInstance.current.BlockManager\n\n        blockManager.add('text', {\n          label: '文字',\n          content: '<div class=\"text-block\">輸入您的文字</div>',\n          category: '基本元素',\n        })\n\n        blockManager.add('image', {\n          label: '圖片',\n          content: '<img src=\"https://via.placeholder.com/300x200\" alt=\"圖片\" style=\"max-width: 100%;\">',\n          category: '基本元素',\n        })\n\n        blockManager.add('button', {\n          label: '按鈕',\n          content: '<button class=\"btn\">點擊按鈕</button>',\n          category: '基本元素',\n        })\n\n        blockManager.add('section', {\n          label: '區塊',\n          content: '<section class=\"section\"><div class=\"container\"><h2>標題</h2><p>內容</p></div></section>',\n          category: '佈局',\n        })\n\n        // 監聽變更並儲存到 Sanity\n        editorInstance.current.on('component:update', () => {\n          saveToSanity()\n        })\n\n        console.log('Sanity GrapesJS 編輯器初始化成功')\n\n      } catch (error) {\n        console.error('Sanity GrapesJS 編輯器初始化失敗:', error)\n      }\n    }\n\n    const timer = setTimeout(initEditor, 100)\n\n    return () => {\n      mounted = false\n      clearTimeout(timer)\n      if (editorInstance.current) {\n        try {\n          editorInstance.current.destroy()\n        } catch (e) {\n          console.warn('編輯器銷毀時發生錯誤:', e)\n        }\n      }\n    }\n  }, [])\n\n  // 儲存到 Sanity\n  const saveToSanity = useCallback(() => {\n    if (!editorInstance.current) return\n\n    try {\n      const editor = editorInstance.current\n      const html = editor.getHtml()\n      const css = editor.getCss()\n      const components = JSON.stringify(editor.getComponents())\n\n      onChange([\n        set({ html, css, components }, [])\n      ])\n\n    } catch (error) {\n      console.error('儲存到 Sanity 時發生錯誤:', error)\n    }\n  }, [onChange])\n\n  // 手動儲存按鈕\n  const handleSave = useCallback(() => {\n    saveToSanity()\n  }, [saveToSanity])\n\n  return (\n    <div className=\"grapesjs-sanity-editor\">\n      <div className=\"mb-4 p-4 bg-gray-50 rounded-lg\">\n        <div className=\"flex justify-between items-center mb-2\">\n          <h3 className=\"text-lg font-semibold\">GrapesJS 視覺編輯器</h3>\n          <button\n            type=\"button\"\n            onClick={handleSave}\n            className=\"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700\"\n          >\n            儲存變更\n          </button>\n        </div>\n        <p className=\"text-sm text-gray-600\">使用拖拽方式設計您的頁面，變更會自動儲存到 Sanity</p>\n      </div>\n\n      <div className=\"grapesjs-editor-wrapper border border-gray-300 rounded-lg overflow-hidden\">\n        <div className=\"flex h-96\">\n          {/* 左側元件面板 */}\n          <div className=\"w-64 bg-white border-r border-gray-200\">\n            <div className=\"p-4\">\n              <h4 className=\"font-medium text-gray-900 mb-3\">元件庫</h4>\n              <div className=\"blocks-container\"></div>\n            </div>\n          </div>\n\n          {/* 中間編輯區域 */}\n          <div className=\"flex-1 bg-gray-100\">\n            <div ref={editorRef} className=\"w-full h-full\"></div>\n          </div>\n\n          {/* 右側樣式面板 */}\n          <div className=\"w-64 bg-white border-l border-gray-200\">\n            <div className=\"p-4\">\n              <h4 className=\"font-medium text-gray-900 mb-3\">樣式設定</h4>\n              <div className=\"styles-container mb-4\"></div>\n              <h4 className=\"font-medium text-gray-900 mb-3\">圖層</h4>\n              <div className=\"layers-container\"></div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* 顯示當前儲存的資料（除錯用） */}\n      {process.env.NODE_ENV === 'development' && (\n        <details className=\"mt-4\">\n          <summary className=\"cursor-pointer text-sm text-gray-600\">顯示儲存的資料（開發模式）</summary>\n          <div className=\"mt-2 p-2 bg-gray-100 rounded text-xs\">\n            <div><strong>HTML:</strong> {html.substring(0, 100)}...</div>\n            <div><strong>CSS:</strong> {css.substring(0, 100)}...</div>\n            <div><strong>Components:</strong> {components.substring(0, 100)}...</div>\n          </div>\n        </details>\n      )}\n    </div>\n  )\n})\n\nGrapesJSInput.displayName = 'GrapesJSInput'\n\nexport default GrapesJSInput\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/config/webhook.ts","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":1,"column":52,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":1,"endColumn":54,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[51,53],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":2,"column":58,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":2,"endColumn":60,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[114,116],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"export const WEBHOOK_URL = process.env.WEBHOOK_URL || \"\"\nexport const WEBHOOK_SECRET = process.env.WEBHOOK_SECRET || \"\"\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/constants.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/internal/ecpayments/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/internal/ecpayments/paymentdata.ts","messages":[{"ruleId":"prefer-const","severity":2,"message":"'dstData' is never reassigned. Use 'const' instead.","line":14,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":14,"endColumn":16,"fix":{"range":[232,256],"text":"const dstData = this.data;"}},{"ruleId":"jsdoc/require-param-description","severity":1,"message":"Missing JSDoc @param \"hashKey\" description.","line":25,"column":1,"nodeType":"Block","endLine":25,"endColumn":1},{"ruleId":"prefer-const","severity":2,"message":"'originParam' is never reassigned. Use 'const' instead.","line":127,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":127,"endColumn":20,"fix":{"range":[2427,2455],"text":"const originParam = this.data;"}}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":2,"fixableWarningCount":0,"source":"import { createHash } from 'crypto';\n\nexport class PaymentData {\n\n  private HashKey: string = \"\"\n\n  private HashIV: string = \"\"\n\n  private data: URLSearchParams = new URLSearchParams();\n\n  \n  getDataParams(): URLSearchParams {\n\n    let dstData = this.data;\n    \n    dstData.set('CheckMacValue', this.getCheckMacValue());\n\n    return dstData;\n\n  }\n\n  /**\n   * 設定hashkey\n   * 用途：驗證資料正確性\n   * @param hashKey \n   */\n  setHashKey(hashKey:string):void{\n    this.HashKey = hashKey;\n  }\n\n  setHashIV(hashIV:string):void{\n    this.HashIV = hashIV;\n  }\n  \n  /**\n   * 設定特店編號\n   * 用途：ECPay 特店編號，用來識別商店\n   * 參數說明：由 ECPay 提供的特店編號，長度為 10 碼\n   */\n  setMerchantID(id: string): void {\n    this.data.set('MerchantID', id);\n  }\n\n  /**\n   * 設定特店交易編號\n   * 用途：特店產生的唯一交易編號，用來識別此筆交易\n   * 參數說明：英數字大小寫混合，長度限制為 1~20 碼\n   */\n  setMerchantTradeNo(tradeNo: string): void {\n    this.data.set('MerchantTradeNo', tradeNo);\n  }\n\n  /**\n   * 設定特店交易時間\n   * 用途：特店產生此筆交易的時間\n   * 參數說明：格式為 yyyy/MM/dd HH:mm:ss\n   */\n  setMerchantTradeDate(tradeDate: string): void {\n    this.data.set('MerchantTradeDate', tradeDate);\n  }\n\n  /**\n   * 設定交易類型\n   * 用途：設定此次交易的付款方式\n   * 參數說明：固定填入 aio\n   */\n  setPaymentType(paymentType: string = 'aio'): void {\n    this.data.set('PaymentType', paymentType);\n  }\n\n  /**\n   * 設定交易金額\n   * 用途：此筆訂單的金額\n   * 參數說明：純數字，不可有符號，如：1000\n   */\n  setTotalAmount(amount: number): void {\n    this.data.set('TotalAmount', amount.toString());\n  }\n\n  /**\n   * 設定交易描述\n   * 用途：交易描述\n   * 參數說明：中英數字，長度限制為 1~200 碼\n   */\n  setTradeDesc(desc: string): void {\n    this.data.set('TradeDesc', desc);\n  }\n\n  /**\n   * 設定商品名稱\n   * 用途：商品名稱\n   * 參數說明：中英數字，長度限制為 1~400 碼，多項商品請以 # 分隔\n   */\n  setItemName(itemName: string): void {\n    this.data.set('ItemName', itemName);\n  }\n\n  /**\n   * 設定付款完成通知回傳網址\n   * 用途：付款完成後，ECPay 會將付款結果參數以背景連線的方式回傳到該網址\n   * 參數說明：僅接受 http 或 https 開頭之網址，長度限制為 1~200 碼\n   */\n  setReturnURL(returnURL: string): void {\n    this.data.set('ReturnURL', returnURL);\n  }\n\n  /**\n   * 設定選擇預設付款方式\n   * 用途：選擇預設付款方式\n   * 參數說明：Credit(信用卡)、WebATM(網路ATM)、ATM(自動櫃員機)、CVS(超商代碼)、BARCODE(超商條碼)、AndroidPay、ALL(不指定付款方式，由ECPay付款頁面提供選擇)\n   */\n  setChoosePayment(choosePayment: string = \"ALL\"): void {\n    this.data.set('ChoosePayment', choosePayment);\n  }\n\n  /**\n   * 設定檢查碼\n   * 用途：檢查碼，用來驗證來源與資料正確性\n   * 參數說明：由參數產生之檢查碼，請參考附錄檢查碼機制\n   */\n  setCheckMacValue(checkMacValue: string): void {\n    this.data.set('CheckMacValue', checkMacValue);\n  }\n\n  getCheckMacValue():string{\n    \n    let originParam = this.data;\n\n    // step1. 將傳遞參數依照第一個英文字母，由A到Z的順序來排序(遇到第一個英文字母相同時，以第二個英文字母來比較，以此類推)，並且以&方式將所有參數串連。\n    // step2. 參數最前面加上HashKey、最後面加上HashIV\n    // step3. 將整串字串進行URL encode\n    // step4. 轉為小寫\n    // step5. 以SHA256加密方式來產生雜凑值\n    // step6. 再轉大寫產生CheckMacValue\n    \n    const params: Record<string, string> = {};\n    for (const [key, value] of originParam.entries()) {\n        params[key] = value;\n    }\n\n    // 排序參數\n    const sortedKeys = Object.keys(params).sort();\n    const sortedParams = sortedKeys.map(key => `${key}=${params[key]}`).join('&');\n\n    // 加上 HashKey 和 HashIV\n    const rawString = `HashKey=${this.HashKey}&${sortedParams}&HashIV=${this.HashIV}`;\n\n    // URL encode\n    const urlEncoded = encodeURIComponent(rawString)\n        .replace(/%20/g, '+')\n        .replace(/%21/g, '!')\n        .replace(/%28/g, '(')\n        .replace(/%29/g, ')')\n        .replace(/%2A/g, '*')\n        .replace(/%2D/g, '-')\n        .replace(/%2E/g, '.')\n        .replace(/%5F/g, '_');\n\n    // 轉小寫\n    const lowerCase = urlEncoded.toLowerCase();\n\n    // SHA256 加密\n    const hash = createHash('sha256').update(lowerCase).digest('hex');\n\n    // 轉大寫\n    return hash.toUpperCase();\n\n  }\n\n  /**\n   * 設定加密類型\n   * 用途：CheckMacValue加密類型\n   * 參數說明：請固定填入1，使用SHA256加密\n   */\n  setEncryptType(encryptType: string = '1'): void {\n    this.data.set('EncryptType', encryptType);\n  }\n\n  /**\n   * 設定分店代號\n   * 用途：提供特店填入分店代號使用，僅可用英數字大小寫混合。\n   * @param storeID 分店代號\n   */\n  setStoreID(storeID: string):void{\n    this.data.set('StoreID', storeID);\n  }\n\n  /**\n   * 設定Client端返回特店的按鈕連結\n   * 用途：消費者點選此按鈕後，會將頁面導回到此設定的網址\n   * 參數說明：僅接受 http 或 https 開頭之網址，長度限制為 1~200 碼\n   * 注意：\n   *   - 導回時不會帶付款結果到此網址，只是將頁面導回而已。\n   *   - 設定此參數，綠界會在付款完成或取號完成頁面上顯示[返回商店]的按鈕。\n   *   - 設定此參數，發生簡訊OTP驗證失敗時，頁面上會顯示[返回商店]的按鈕。\n   *   - 若未設定此參數，則綠界付款完成頁或取號完成頁面，不會顯示[返回商店]的按鈕。\n   *   - 若導回網址未使用https時，部份瀏覽器可能會出現警告訊息。\n   *   - 參數內容若有包含%26(&)及%3C(<) 這二個值時，請先進行urldecode() 避免呼叫API失敗。\n   */\n  setClientBackURL(clientBackURL: string): void {\n    this.data.set('ClientBackURL', clientBackURL);\n  }\n\n  /**\n   * 設定商品銷售網址\n   * 用途：商品銷售網址\n   * 參數說明：僅接受 http 或 https 開頭之網址，長度限制為 1~200 碼\n   */\n  setItemURL(itemURL: string): void {\n    this.data.set('ItemURL', itemURL);\n  }\n\n  /**\n   * 設定備註欄位\n   * 用途：備註欄位\n   * 參數說明：中英數字，長度限制為 1~100 碼\n   */\n  setRemark(remark: string): void {\n    this.data.set('Remark', remark);\n  }\n\n  /**\n   * 設定選擇預設付款子項目\n   * 用途：選擇預設付款子項目\n   * 參數說明：請參考付款方式參數說明，當ChoosePayment設定為Credit時，可設定的值：CreditCard\n   */\n  setChooseSubPayment(chooseSubPayment: string): void {\n    this.data.set('ChooseSubPayment', chooseSubPayment);\n  }\n\n  /**\n   * 有別於ReturnURL (server端的網址)，OrderResultURL為特店的client端(前端)網址。消費者付款完成後，綠界會將付款結果參數以POST方式回傳到到該網址。詳細說明請參考付款結果通知。\n   * 用途：Client端回傳付款結果網址\n   * 參數說明：僅接受 http 或 https 開頭之網址，長度限制為 1~200 碼\n   * 注意：\n   *   - 若與[ClientBackURL]同時設定，將會以此參數為主。\n   *   - 銀聯卡及非即時交易( ATM、CVS、BARCODE )不支援此參數。\n   *   - 付款結果通知請依ReturnURL (server端的網址)為主,避免因前端操作或網路問題未收到OrderResultURL 特店的client端(前端)的通知。\n   *   - 參數內容若有包含%26(&)及%3C(<) 這二個值時，請先進行urldecode() 避免呼叫API失敗。\n   */\n  setOrderResultURL(orderResultURL: string): void {\n    this.data.set('OrderResultURL', orderResultURL);\n  }\n\n  /**\n   * 設定是否需要額外的付款資訊\n   * 用途：是否需要額外的付款資訊\n   * 參數說明：Y(需要額外付款資訊)、N(不需要額外付款資訊)，預設為N\n   * 注意：\n   *   - 付款完成後綠界後端會以POST方式回傳額外付款資訊到特店的ReturnURL 與OrderResultURL。\n   */\n  setNeedExtraPaidInfo(needExtraPaidInfo: string = \"N\"): void {\n    this.data.set('NeedExtraPaidInfo', needExtraPaidInfo);\n  }\n\n  /**\n   * 設定隱藏付款方式\n   * 用途：當付款方式[ChoosePayment]為ALL時，可隱藏不需要的付款方式，多筆請以井號分隔 (#)。\n   * 參數說明：Credit(隱藏信用卡)、WebATM(隱藏網路ATM)、ATM(隱藏自動櫃員機)、CVS(隱藏超商代碼)、BARCODE(隱藏超商條碼)\n   */\n  setIgnorePayment(ignorePayment: string): void {\n    this.data.set('IgnorePayment', ignorePayment);\n  }\n\n  /**\n   * 設定特約合作平台商代號\n   * 用途：特約合作平台商代號(由ECPay提供)\n   * 參數說明：10碼純數字\n   */\n  setPlatformID(platformID: string): void {\n    this.data.set('PlatformID', platformID);\n  }\n\n  /**\n   * 設定自訂名稱欄位1\n   * 用途：自訂名稱欄位1\n   * 參數說明：提供合作廠商使用記錄用客製化使用欄位，回傳時將會回傳此欄位的值\n   */\n  setCustomField1(customField1: string): void {\n    this.data.set('CustomField1', customField1);\n  }\n\n  /**\n   * 設定自訂名稱欄位2\n   * 用途：自訂名稱欄位2\n   * 參數說明：提供合作廠商使用記錄用客製化使用欄位，回傳時將會回傳此欄位的值\n   */\n  setCustomField2(customField2: string): void {\n    this.data.set('CustomField2', customField2);\n  }\n\n  /**\n   * 設定自訂名稱欄位3\n   * 用途：自訂名稱欄位3\n   * 參數說明：提供合作廠商使用記錄用客製化使用欄位，回傳時將會回傳此欄位的值\n   */\n  setCustomField3(customField3: string): void {\n    this.data.set('CustomField3', customField3);\n  }\n\n  /**\n   * 設定自訂名稱欄位4\n   * 用途：自訂名稱欄位4\n   * 參數說明：提供合作廠商使用記錄用客製化使用欄位，回傳時將會回傳此欄位的值\n   */\n  setCustomField4(customField4: string): void {\n    this.data.set('CustomField4', customField4);\n  }\n\n  \n  \n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/affiliate-config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/cache.ts","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":49,"column":58,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":49,"endColumn":60,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1019,1021],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":76,"column":65,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":76,"endColumn":67,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1601,1603],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// 前端快取工具\nclass APICache {\n  private cache = new Map()\n  private readonly TTL = 60 * 1000 // 1分鐘\n\n  get<T>(key: string): T | null {\n    const entry = this.cache.get(key)\n    if (!entry) return null\n    \n    if (Date.now() - entry.timestamp > this.TTL) {\n      this.cache.delete(key)\n      return null\n    }\n    \n    return entry.data\n  }\n\n  set<T>(key: string, data: T): void {\n    this.cache.set(key, {\n      data,\n      timestamp: Date.now()\n    })\n  }\n\n  clear(): void {\n    this.cache.clear()\n  }\n\n  // 自動清理過期項目\n  cleanup(): void {\n    const now = Date.now()\n    this.cache.forEach((entry, key) => {\n      if (now - entry.timestamp > this.TTL * 2) {\n        this.cache.delete(key)\n      }\n    })\n  }\n}\n\nconst apiCache = new APICache()\n\n// 定期清理快取\nif (typeof window !== 'undefined') {\n  setInterval(() => apiCache.cleanup(), 2 * 60 * 1000) // 每2分鐘清理一次\n}\n\n// 快取包裝的 fetch 函數\nexport async function cachedFetch<T>(url: string, options?: RequestInit): Promise<T> {\n  const cacheKey = `${url}${JSON.stringify(options?.body || '')}`\n  \n  // 檢查快取\n  const cached = apiCache.get<T>(cacheKey)\n  if (cached) {\n    return cached\n  }\n\n  // 發起請求\n  const response = await fetch(url, options)\n  \n  if (!response.ok) {\n    throw new Error(`HTTP error! status: ${response.status}`)\n  }\n\n  const data = await response.json()\n  \n  // 只快取 GET 請求\n  if (!options?.method || options.method === 'GET') {\n    apiCache.set(cacheKey, data)\n  }\n\n  return data\n}\n\n// Medusa API 呼叫助手 - 服務端版本\nexport async function medusaFetchServer<T>(endpoint: string): Promise<T> {\n  const backendUrl = process.env.NEXT_PUBLIC_MEDUSA_BACKEND_URL || 'http://localhost:9000'\n  const fullUrl = new URL(endpoint, backendUrl)\n  \n  const response = await fetch(fullUrl.toString(), {\n    headers: {\n      'Content-Type': 'application/json',\n    },\n    next: { revalidate: 60 } // Next.js 快取\n  })\n\n  if (!response.ok) {\n    throw new Error(`HTTP error! status: ${response.status}`)\n  }\n\n  return response.json()\n}\n\n// Medusa API 呼叫助手 - 客戶端版本\nexport async function medusaFetch<T>(endpoint: string, options?: RequestInit): Promise<T> {\n  const url = `/api/medusa-proxy?endpoint=${encodeURIComponent(endpoint)}`\n  return cachedFetch<T>(url, options)\n}\n\nexport { apiCache }\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/config.ts","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":7,"column":34,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":7,"endColumn":36,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[259,261],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":25,"column":34,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":25,"endColumn":36,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[839,841],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import Medusa from \"@medusajs/js-sdk\"\nimport { getPublishableKeyForBackend } from \"./medusa-publishable-key\"\n\n// -------------------- Helper --------------------\n\nfunction requiredEnv(key: string, fallback?: string): string {\n  const value = process.env[key] || fallback\n  if (!value) {\n    throw new Error(`Environment variable ${key} is required but was not provided.`)\n  }\n  return value\n}\n\n// -------------------- 基本設定 --------------------\n\nexport const SITE_NAME = \"Your Site Name\"\nexport const DEFAULT_DESCRIPTION = \"Default site description\"\nexport const DEFAULT_OG_IMAGE = \"/default-og-image.jpg\"\nexport const DEFAULT_TWITTER_IMAGE = \"/default-twitter-image.jpg\"\n\n// -------------------- 環境變數 --------------------\n\nexport const MEDUSA_BACKEND_URL = requiredEnv(\n  \"NEXT_PUBLIC_MEDUSA_BACKEND_URL\",\n  process.env.MEDUSA_BACKEND_URL || \"http://localhost:9000\"\n)\n\nexport const SITE_URL = requiredEnv(\n  \"NEXT_PUBLIC_SITE_URL\",\n  \"http://localhost:8000\"\n)\n\n// -------------------- SDK 初始化 --------------------\n\nexport const sdk = new Medusa({\n  baseUrl: MEDUSA_BACKEND_URL,\n  debug: process.env.NODE_ENV === \"development\",\n  publishableKey: getPublishableKeyForBackend(MEDUSA_BACKEND_URL),\n})\n\n// -------------------- API Config --------------------\n\nexport const getApiConfig = () => {\n  return {\n    baseUrl: MEDUSA_BACKEND_URL,\n    publishableKey: getPublishableKeyForBackend(MEDUSA_BACKEND_URL),\n  }\n}\n\n// -------------------- SEO Config --------------------\n\nexport type SeoConfig = {\n  siteName: string\n  description: string\n  ogImage: string\n  twitterImage: string\n  siteUrl: string\n}\n\nexport const SEO_CONFIG: SeoConfig = {\n  siteName: SITE_NAME,\n  description: DEFAULT_DESCRIPTION,\n  ogImage: DEFAULT_OG_IMAGE,\n  twitterImage: DEFAULT_TWITTER_IMAGE,\n  siteUrl: SITE_URL\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/constants.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/context/account-context.tsx","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":32,"column":45,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":32,"endColumn":47,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[994,996],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":38,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":38,"endColumn":20,"suggestions":[{"fix":{"range":[1111,1158],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport React, { createContext, useContext, useEffect, useState, ReactNode, useMemo } from 'react'\nimport { HttpTypes } from '@medusajs/types'\n\ninterface AccountContextType {\n  customer: HttpTypes.StoreCustomer | null\n  loading: boolean\n  refreshCustomer: () => Promise<void>\n  isAuthenticated: boolean\n}\n\nconst AccountContext = createContext<AccountContextType | undefined>(undefined)\n\nexport function AccountProvider({ children }: { children: ReactNode }) {\n  const [customer, setCustomer] = useState<HttpTypes.StoreCustomer | null>(null)\n  const [loading, setLoading] = useState(true)\n\n  const fetchCustomer = async () => {\n    try {\n      const response = await fetch('/api/auth/customer', {\n        method: 'GET',\n        credentials: 'include',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        cache: 'no-cache'\n      })\n      \n      if (response.ok) {\n        const data = await response.json()\n        const customerData = data?.customer || null\n        setCustomer(customerData)\n      } else {\n        setCustomer(null)\n      }\n    } catch (err) {\n      console.error('Failed to fetch customer:', err)\n      setCustomer(null)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const refreshCustomer = async () => {\n    setLoading(true)\n    await fetchCustomer()\n  }\n\n  useEffect(() => {\n    fetchCustomer()\n  }, [])\n\n  const value = useMemo<AccountContextType>(() => ({\n    customer,\n    loading,\n    refreshCustomer,\n    isAuthenticated: !!customer\n  }), [customer, loading, refreshCustomer])\n\n  return (\n    <AccountContext.Provider value={value}>\n      {children}\n    </AccountContext.Provider>\n  )\n}\n\nexport function useAccount() {\n  const context = useContext(AccountContext)\n  if (context === undefined) {\n    throw new Error('useAccount must be used within an AccountProvider')\n  }\n  return context\n}","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/context/cart-context.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'useEffect' is defined but never used.","line":3,"column":54,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":63},{"ruleId":"unused-imports/no-unused-imports","severity":2,"message":"'useEffect' is defined but never used.","line":3,"column":54,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":63,"fix":{"range":[65,76],"text":""}},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'HttpTypes' is defined but never used.","line":4,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":19},{"ruleId":"unused-imports/no-unused-imports","severity":2,"message":"'HttpTypes' is defined but never used.","line":4,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":19,"fix":{"range":[92,136],"text":""}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":36,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1104,1107],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1104,1107],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":45,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1371,1374],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1371,1374],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":2,"fixableWarningCount":0,"source":"\"use client\"\n\nimport React, { createContext, useContext, useState, useEffect } from 'react'\nimport { HttpTypes } from '@medusajs/types'\nimport { Cart } from \"../../types/global\"\n\ninterface CartItem {\n  variantId: string\n  quantity: number\n}\n\ninterface CartActionContext {\n  cart: Cart | null\n  addToCart: (item: { variantId: string; quantity: number }) => Promise<void>\n  isLoading: boolean\n  error: string | null\n}\n\nconst CartContext = createContext<CartActionContext | undefined>(undefined)\n\nexport function CartProvider({ children }: { children: React.ReactNode }) {\n  const [cart, setCart] = useState<Cart | null>(null)\n  const [isLoading, setIsLoading] = useState(false)\n  const [error, setError] = useState<string | null>(null)\n\n  const addToCart = async (item: CartItem) => {\n    setIsLoading(true)\n    setError(null)\n    try {\n      // TODO: Implement cart functionality with server actions\n      await new Promise(resolve => setTimeout(resolve, 500))\n      setCart((prevCart: Cart | null) => {\n        if (!prevCart) {\n          return {\n            id: 'temp-cart',\n            items: [item as any],\n            total: 0,\n            subtotal: 0,\n            created_at: new Date().toISOString(),\n            updated_at: new Date().toISOString()\n          } as Cart\n        }\n        return {\n          ...prevCart,\n          items: [...prevCart.items, item as any],\n        } as Cart\n      })\n    } catch (err) {\n      setError(err instanceof Error ? err.message : \"加入購物車失敗\")\n    } finally {\n      setIsLoading(false)\n    }\n  }\n\n  return (\n    <CartContext.Provider value={{ cart, addToCart, isLoading, error }}>\n      {children}\n    </CartContext.Provider>\n  )\n}\n\nexport function useCart() {\n  const context = useContext(CartContext)\n  if (!context) {\n    throw new Error(\"useCart must be used within a CartProvider\")\n  }\n  return context\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/context/modal-context.tsx","messages":[{"ruleId":"no-redeclare","severity":2,"message":"'ModalContext' is already defined.","line":9,"column":7,"nodeType":"Identifier","messageId":"redeclared","endLine":9,"endColumn":19}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport React, { createContext, useContext } from \"react\"\n\ninterface ModalContext {\n  close: () => void\n}\n\nconst ModalContext = createContext<ModalContext | null>(null)\n\ninterface ModalProviderProps {\n  children?: React.ReactNode\n  close: () => void\n}\n\nexport const ModalProvider = ({ children, close }: ModalProviderProps) => {\n  return (\n    <ModalContext.Provider\n      value={{\n        close,\n      }}\n    >\n      {children}\n    </ModalContext.Provider>\n  )\n}\n\nexport const useModal = () => {\n  const context = useContext(ModalContext)\n  if (context === null) {\n    throw new Error(\"useModal must be used within a ModalProvider\")\n  }\n  return context\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/context/product-context.tsx","messages":[{"ruleId":"no-redeclare","severity":2,"message":"'ProductActionContext' is already defined.","line":16,"column":7,"nodeType":"Identifier","messageId":"redeclared","endLine":16,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'setInStock' is assigned a value but never used.","line":22,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":29},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'setInStock' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":22,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":29},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":27,"column":51,"nodeType":"MemberExpression","messageId":"unexpected","endLine":27,"endColumn":62},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":42,"column":51,"nodeType":"MemberExpression","messageId":"unexpected","endLine":42,"endColumn":62},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":47,"column":51,"nodeType":"MemberExpression","messageId":"unexpected","endLine":47,"endColumn":64}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { HttpTypes } from \"@medusajs/types\"\nimport { createContext, useContext, useState, useCallback } from \"react\"\n\ninterface ProductActionContext {\n  addToCart: (input: { variantId: string; quantity: number; countryCode: string }) => Promise<void>\n  inStock: boolean\n  isAdding: boolean\n  options: Record<string, string>\n  setOptions: React.Dispatch<React.SetStateAction<Record<string, string>>>\n  selectedVariant: HttpTypes.StoreProductVariant | undefined\n  setSelectedVariant: React.Dispatch<React.SetStateAction<HttpTypes.StoreProductVariant | undefined>>\n}\n\nconst ProductActionContext = createContext<ProductActionContext | undefined>(undefined)\n\nexport function ProductActionProvider({ children }: { children: React.ReactNode }) {\n  const [options, setOptions] = useState<Record<string, string>>({})\n  const [selectedVariant, setSelectedVariant] = useState<HttpTypes.StoreProductVariant>()\n  const [isAdding, setIsAdding] = useState(false)\n  const [inStock, setInStock] = useState(true) // 預設為可購買狀態\n\n  const addToCart = useCallback(async (input: { variantId: string; quantity: number; countryCode: string }) => {\n    setIsAdding(true)\n    try {\n      if (process.env.NODE_ENV === 'development') console.log(\"🛒 ProductActionContext 開始加入購物車:\", input)\n      \n      const response = await fetch('/api/cart', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(input),\n      })\n\n      if (!response.ok) {\n        throw new Error(`HTTP error! status: ${response.status}`)\n      }\n\n      const result = await response.json()\n      if (process.env.NODE_ENV === 'development') console.log(\"✅ ProductActionContext 加入購物車成功:\", result)\n      \n      // 觸發全局購物車更新事件\n      window.dispatchEvent(new Event('cartUpdate'))\n    } catch (error) {\n      if (process.env.NODE_ENV === 'development') console.error(\"❌ ProductActionContext 加入購物車失敗:\", error)\n      throw error\n    } finally {\n      setIsAdding(false)\n    }\n  }, [])\n\n  return (\n    <ProductActionContext.Provider\n      value={{\n        addToCart,\n        inStock,\n        isAdding,\n        options,\n        setOptions,\n        selectedVariant,\n        setSelectedVariant,\n      }}\n    >\n      {children}\n    </ProductActionContext.Provider>\n  )\n}\n\nexport function useProductActions() {\n  const context = useContext(ProductActionContext)\n  if (!context) {\n    throw new Error(\"useProductActions must be used within a ProductActionProvider\")\n  }\n  return context\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/context/region-context.tsx","messages":[{"ruleId":"no-redeclare","severity":2,"message":"'RegionContext' is already defined.","line":21,"column":14,"nodeType":"Identifier","messageId":"redeclared","endLine":21,"endColumn":27},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":29,"column":63,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":29,"endColumn":65,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[768,770],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { Dispatch, ReactNode, SetStateAction, createContext, useContext, useEffect, useState } from \"react\"\n\nexport type Region = {\n  countryCode: string\n  name: string\n}\n\ntype RegionContext = {\n  region: Region | null\n  setRegion: Dispatch<SetStateAction<Region | null>>\n}\n\n// 提供一個預設值\nconst defaultContextValue: RegionContext = {\n  region: null,\n  setRegion: () => null,\n}\n\nexport const RegionContext = createContext<RegionContext>(defaultContextValue)\n\nexport const RegionProvider = ({ children }: { children: ReactNode }) => {\n  const [region, setRegion] = useState<Region | null>(null)\n\n  useEffect(() => {\n    // 從 localStorage 讀取區域設定，如果沒有則設為預設值\n    if (typeof window !== 'undefined') {\n      const savedCountryCode = localStorage.getItem(\"region\") || \"TW\"\n      setRegion({\n        countryCode: savedCountryCode,\n        name: savedCountryCode === \"TW\" ? \"台灣\" : \"其他\"\n      })\n    }\n  }, [])\n\n  const handleSetRegion: Dispatch<SetStateAction<Region | null>> = (newRegion) => {\n    setRegion(newRegion)\n    if (typeof window !== 'undefined' && newRegion) {\n      // 當 newRegion 是函數時，我們需要先計算新值\n      const actualRegion = typeof newRegion === 'function' \n        ? newRegion(region) \n        : newRegion\n      \n      if (actualRegion) {\n        localStorage.setItem(\"region\", actualRegion.countryCode)\n      }\n    }\n  }\n\n  return (\n    <RegionContext.Provider value={{ region, setRegion: handleSetRegion }}>\n      {children}\n    </RegionContext.Provider>\n  )\n}\n\nexport const useRegion = () => {\n  const context = useContext(RegionContext)\n  if (context === undefined) {\n    throw new Error(\"useRegion must be used within a RegionProvider\")\n  }\n  return context\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/data/affiliate-admin-auth.ts","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":47,"column":42,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":47,"endColumn":44,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1156,1158],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":48,"column":48,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":48,"endColumn":50,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1210,1212],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":49,"column":54,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":49,"endColumn":56,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1270,1272],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":63,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1672,1675],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1672,1675],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"sonarjs/prefer-immediate-return","severity":2,"message":"Immediately return this expression instead of assigning it to the temporary variable \"msg\".","line":64,"column":17,"nodeType":"LogicalExpression","messageId":"doImmediateAction","endLine":64,"endColumn":45,"fix":{"range":[1683,1738],"text":"return e?.message || '登入失敗，請檢查帳號密碼'"}},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":64,"column":28,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":64,"endColumn":30,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1706,1708],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":1,"fixableWarningCount":0,"source":"\"use server\"\n\nimport { cookies } from 'next/headers'\nimport { redirect } from 'next/navigation'\n\ntype AdminSession = {\n  id: string\n  email: string\n  role: 'admin'\n  created_at: string\n  token: string\n}\n\nconst COOKIE = '_affiliate_admin_jwt'\n\nexport async function setAffiliateAdminToken(payload: AdminSession) {\n  const c = await cookies()\n  const token = Buffer.from(JSON.stringify(payload)).toString('base64')\n  c.set(COOKIE, token, {\n    httpOnly: true,\n    sameSite: 'lax',\n    secure: process.env.NODE_ENV === 'production',\n    maxAge: 60 * 60 * 24 * 7,\n  })\n}\n\nexport async function removeAffiliateAdminToken() {\n  const c = await cookies()\n  c.set(COOKIE, '', { maxAge: -1 })\n}\n\nexport async function retrieveAffiliateAdmin(): Promise<AdminSession | null> {\n  try {\n    const c = await cookies()\n    const token = c.get(COOKIE)?.value\n    if (!token) return null\n    const json = Buffer.from(token, 'base64').toString()\n    return JSON.parse(json) as AdminSession\n  } catch {\n    return null\n  }\n}\n\nimport { sdk } from '@lib/config'\n\nexport async function affiliateAdminLogin(_s: unknown, form: FormData) {\n  const email = String(form.get('email') || '')\n  const password = String(form.get('password') || '')\n  const countryCode = String(form.get('countryCode') || 'tw')\n  if (!email || !password) return '請輸入帳密'\n\n  try {\n    // 使用 Medusa Admin 憑證登入\n    const adminToken = await sdk.auth.login('admin', 'emailpass', { email, password })\n\n    await setAffiliateAdminToken({\n      id: 'adm_' + Math.random().toString(36).slice(2, 8),\n      email,\n      role: 'admin',\n      created_at: new Date().toISOString(),\n      token: String(adminToken),\n    })\n  } catch (e: any) {\n    const msg = e?.message || '登入失敗，請檢查帳號密碼'\n    return msg\n  }\n  redirect(`/${countryCode}/affiliate-admin`)\n}\n\nexport async function affiliateAdminSignout(countryCode: string) {\n  await removeAffiliateAdminToken()\n  redirect(`/${countryCode}/affiliate-admin/login`)\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/data/affiliate-auth.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'getAffiliateStoreApiUrl' is defined but never used.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":33},{"ruleId":"unused-imports/no-unused-imports","severity":2,"message":"'getAffiliateStoreApiUrl' is defined but never used.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":33,"fix":{"range":[117,179],"text":""}},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'getPublishableKeyForBackend' is defined but never used.","line":7,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":37},{"ruleId":"unused-imports/no-unused-imports","severity":2,"message":"'getPublishableKeyForBackend' is defined but never used.","line":7,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":37,"fix":{"range":[179,252],"text":"\n"}},{"ruleId":"sonarjs/prefer-immediate-return","severity":2,"message":"Immediately return this expression instead of assigning it to the temporary variable \"session\".","line":42,"column":21,"nodeType":"TSAsExpression","messageId":"doImmediateAction","endLine":42,"endColumn":57,"fix":{"range":[1210,1281],"text":"return JSON.parse(json) as AffiliateSession"}},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":53,"column":46,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":53,"endColumn":48,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1444,1446],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":54,"column":52,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":54,"endColumn":54,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1502,1504],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":55,"column":58,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":55,"endColumn":60,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1566,1568],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":97,"column":3,"nodeType":"MemberExpression","messageId":"unexpected","endLine":97,"endColumn":14,"suggestions":[{"fix":{"range":[2499,2558],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":117,"column":46,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":117,"endColumn":48,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3044,3046],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":118,"column":52,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":118,"endColumn":54,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3102,3104],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":119,"column":58,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":119,"endColumn":60,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3166,3168],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":120,"column":50,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":120,"endColumn":52,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3222,3224],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":121,"column":58,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":121,"endColumn":60,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3286,3288],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":132,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":132,"endColumn":16,"suggestions":[{"fix":{"range":[3567,3630],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":133,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":133,"endColumn":16,"suggestions":[{"fix":{"range":[3635,3713],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":134,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":134,"endColumn":16,"suggestions":[{"fix":{"range":[3718,3820],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":153,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":153,"endColumn":18,"suggestions":[{"fix":{"range":[4266,4317],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":154,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":154,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4343,4346],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4343,4346],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":155,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":155,"endColumn":20,"suggestions":[{"fix":{"range":[4356,4568],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":167,"column":47,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":167,"endColumn":49,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[4709,4753],"text":"(errorResponse.message ?? errorResponse.error)"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":167,"column":70,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":167,"endColumn":72,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[4754,4756],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":168,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":168,"endColumn":20,"suggestions":[{"fix":{"range":[4796,4861],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":172,"column":26,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":172,"endColumn":28,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[4948,4950],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":176,"column":26,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":176,"endColumn":28,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[5081,5083],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":181,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":181,"endColumn":16,"suggestions":[{"fix":{"range":[5178,5242],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":185,"column":33,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":185,"endColumn":35,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[5307,5347],"text":"(responseData.data?.id ?? responseData.id)"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":185,"column":52,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":185,"endColumn":54,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[5348,5350],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":190,"column":49,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":190,"endColumn":51,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[5491,5547],"text":"(responseData.data?.created_at ?? responseData.created_at)"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":190,"column":76,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":190,"endColumn":78,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[5548,5550],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-useless-catch","severity":2,"message":"Unnecessary try/catch wrapper.","line":194,"column":5,"nodeType":"TryStatement","messageId":"unnecessaryCatch","endLine":199,"endColumn":6},{"ruleId":"sonarjs/no-useless-catch","severity":2,"message":"Add logic to this catch clause or eliminate it and rethrow the exception automatically.","line":196,"column":7,"nodeType":null,"messageId":"uselessCatch","endLine":196,"endColumn":12},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":201,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":201,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5793,5796],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5793,5796],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":208,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":208,"endColumn":18,"suggestions":[{"fix":{"range":[5937,5989],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":23,"fatalErrorCount":0,"warningCount":11,"fixableErrorCount":3,"fixableWarningCount":0,"source":"\"use server\"\n\nimport \"server-only\"\nimport { cookies } from 'next/headers'\nimport { redirect } from 'next/navigation'\nimport { getAffiliateStoreApiUrl } from '../affiliate-config'\nimport { getPublishableKeyForBackend } from '../medusa-publishable-key'\n\ntype AffiliateSession = {\n  id: string\n  email: string\n  displayName?: string\n  website?: string\n  status: 'approved' | 'pending'\n  created_at: string\n}\n\nconst COOKIE_NAME = '_affiliate_jwt'\n\nexport async function setAffiliateAuthToken(payload: AffiliateSession) {\n  const cookieStore = await cookies()\n  const token = Buffer.from(JSON.stringify(payload)).toString('base64')\n  cookieStore.set(COOKIE_NAME, token, {\n    maxAge: 60 * 60 * 24 * 30,\n    httpOnly: true,\n    sameSite: 'lax',\n    secure: process.env.NODE_ENV === 'production',\n  })\n}\n\nexport async function removeAffiliateAuthToken() {\n  const cookieStore = await cookies()\n  cookieStore.set(COOKIE_NAME, '', { maxAge: -1 })\n}\n\nexport async function retrieveAffiliate(): Promise<AffiliateSession | null> {\n  try {\n    const cookieStore = await cookies()\n    const token = cookieStore.get(COOKIE_NAME)?.value\n    if (!token) return null\n    const json = Buffer.from(token, 'base64').toString()\n    const session = JSON.parse(json) as AffiliateSession\n    return session\n  } catch {\n    return null\n  }\n}\n\nexport async function affiliateLogin(\n  _state: unknown,\n  formData: FormData\n) {\n  const email = String(formData.get('email') || '')\n  const password = String(formData.get('password') || '')\n  const countryCode = String(formData.get('countryCode') || 'tw')\n\n  if (!email || !password) return '請輸入電子郵件與密碼'\n  \n  // 測試模式：如果使用特定測試帳號，直接設置認證 token\n  if (email === 'test@affiliate.com' && password === 'test123') {\n    // 使用固定的測試 ID，確保每次登入都相同\n    await setAffiliateAuthToken({\n      id: 'aff_test',\n      email: 'test@affiliate.com',\n      displayName: '測試聯盟夥伴',\n      website: 'https://test-affiliate.com',\n      status: 'approved',\n      created_at: new Date().toISOString(),\n    })\n    \n    redirect(`/${countryCode}/affiliate`)\n  }\n  \n  // 聯盟會員登入邏輯 - 使用本地驗證，不需要調用外部 API\n  // 使用 email 前綴作為固定的聯盟會員 ID\n  const emailPrefix = email.split('@')[0]\n  const affiliateId = `aff_${emailPrefix}`\n  \n  // 簡單的本地驗證邏輯（可以根據需要擴展）\n  let isValidLogin = false\n  \n  // 未來可以在這裡添加其他驗證邏輯，例如：\n  // - 檢查 JSON 檔案中的聯盟會員資料\n  // - 驗證密碼雜湊\n  // - 檢查帳號狀態等\n  \n  // 目前除了測試帳號外，其他帳號都使用預設驗證\n  // 可以根據需要修改這個邏輯\n  if (email && password) {\n    isValidLogin = true\n  }\n  \n  if (!isValidLogin) {\n    return '電子郵件或密碼不正確'\n  }\n  \n  console.log('Login successful for affiliate:', affiliateId)\n  \n  // 設定聯盟會員認證 token\n  await setAffiliateAuthToken({\n    id: affiliateId,\n    email,\n    displayName: email.split('@')[0],\n    website: email === 'test@affiliate.com' ? 'https://test-affiliate.com' : undefined,\n    status: 'approved', // 預設為已審核通過\n    created_at: new Date().toISOString(),\n  })\n\n  // 重定向到聯盟夥伴儀表板\n  redirect(`/${countryCode}/affiliate`)\n}\n\nexport async function affiliateSignup(\n  _state: unknown,\n  formData: FormData\n) {\n  const email = String(formData.get('email') || '')\n  const password = String(formData.get('password') || '')\n  const displayName = String(formData.get('displayName') || '')\n  const website = String(formData.get('website') || '')\n  const countryCode = String(formData.get('countryCode') || 'tw')\n  \n  if (!email || !password || !displayName) {\n    return '請完整填寫必填欄位'\n  }\n\n  try {\n    // 使用不需要 publishable key 的專用端點\n    // 在 Server Actions 中，環境變數可能不可用，使用VM地址\n    const backendUrl = 'http://35.236.182.29:9000'\n    const requestUrl = `${backendUrl}/affiliate-apply`\n    console.log('Submitting affiliate application to:', requestUrl)\n    console.log('Environment MEDUSA_BACKEND_URL:', process.env.MEDUSA_BACKEND_URL)\n    console.log('Request payload:', { name: displayName, email, password, website: website || undefined })\n    \n    // 先測試後端連接\n    let res: Response\n    try {\n      res = await fetch(requestUrl, {\n        method: 'POST',\n        headers: { \n          'Content-Type': 'application/json',\n          'Accept': 'application/json',\n        },\n        body: JSON.stringify({ \n          name: displayName,  // 後端期望的是 name 字段\n          email, \n          password, \n          website: website || undefined \n        }),\n        cache: 'no-store',\n      })\n      console.log('Fetch completed, status:', res.status)\n    } catch (fetchError: any) {\n      console.error('Fetch error details:', {\n        message: fetchError.message,\n        cause: fetchError.cause,\n        stack: fetchError.stack,\n        name: fetchError.name,\n        code: fetchError.code\n      })\n      throw fetchError\n    }\n    \n    if (!res.ok) {\n      const errorResponse = await res.json().catch(() => ({}))\n      const errorText = errorResponse.message || errorResponse.error || await res.text().catch(() => '')\n      console.error('Backend signup error:', res.status, errorResponse)\n      \n      // 根據不同錯誤返回不同訊息\n      if (res.status === 400) {\n        return errorText || '申請資料有誤，請檢查後重新提交'\n      } else if (res.status === 409) {\n        return '此電子郵件已經申請過或已是會員'\n      } else {\n        return errorText || '申請提交失敗，請稍後再試'\n      }\n    }\n\n    const responseData = await res.json().catch(() => ({}))\n    console.log('Application submitted successfully:', responseData)\n\n    // 申請成功後設置前端會話\n    await setAffiliateAuthToken({\n      id: responseData.data?.id || responseData.id || 'temp_' + Math.random().toString(36).slice(2, 8),\n      email,\n      displayName,\n      website,\n      status: 'pending',\n      created_at: responseData.data?.created_at || responseData.created_at || new Date().toISOString(),\n    })\n\n    // 重定向到待審核頁面\n    try {\n      redirect(`/${countryCode}/affiliate/pending`)\n    } catch (redirectError) {\n      // redirect() 拋出錯誤是正常的，這是 Next.js 的機制\n      throw redirectError\n    }\n    \n  } catch (error: any) {\n    // 檢查是否是 redirect 錯誤\n    if (error?.digest?.startsWith?.('NEXT_REDIRECT')) {\n      // 這是正常的重定向，重新拋出\n      throw error\n    }\n    \n    console.error('Network error during signup:', error)\n    return '網路連線錯誤，請檢查網路連線後重試'\n  }\n}\n\nexport async function affiliateSignout(countryCode: string) {\n  await removeAffiliateAuthToken()\n  redirect(`/${countryCode}/login-affiliate`)\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/data/affiliate-stats.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":30,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":30,"endColumn":17},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":30,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":30,"endColumn":17},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":75,"column":3,"nodeType":"MemberExpression","messageId":"unexpected","endLine":75,"endColumn":14,"suggestions":[{"fix":{"range":[1780,1831],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":83,"column":70,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":83,"endColumn":72,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2065,2067],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":92,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":92,"endColumn":19,"suggestions":[{"fix":{"range":[2309,2345],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":95,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":95,"endColumn":17,"suggestions":[{"fix":{"range":[2376,2412],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":108,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":108,"endColumn":18,"suggestions":[{"fix":{"range":[2675,2709],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":118,"column":3,"nodeType":"MemberExpression","messageId":"unexpected","endLine":118,"endColumn":14,"suggestions":[{"fix":{"range":[2911,2984],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":220,"column":3,"nodeType":"MemberExpression","messageId":"unexpected","endLine":220,"endColumn":14,"suggestions":[{"fix":{"range":[5961,5988],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { promises as fs } from 'fs'\nimport path from 'path'\nimport type { AffiliateStatPoint, AffiliateStatsSummary } from '../../types/affiliate'\n\nconst STATS_FILE = path.join(process.cwd(), 'affiliate-stats.json')\n\nexport interface ClickRecord {\n  id: string\n  affiliateId: string\n  linkId: string\n  timestamp: string\n  ip?: string\n  userAgent?: string\n  referrer?: string\n  converted?: boolean\n  conversionValue?: number\n  conversionTimestamp?: string\n}\n\nexport interface AffiliateStatsData {\n  clicks: ClickRecord[]\n  lastUpdated: string\n}\n\n// 確保統計檔案存在\nasync function ensureStatsFile(): Promise<AffiliateStatsData> {\n  try {\n    const data = await fs.readFile(STATS_FILE, 'utf-8')\n    return JSON.parse(data)\n  } catch (error) {\n    // 檔案不存在，創建初始資料\n    const initialData: AffiliateStatsData = {\n      clicks: [],\n      lastUpdated: new Date().toISOString(),\n    }\n    await fs.writeFile(STATS_FILE, JSON.stringify(initialData, null, 2))\n    return initialData\n  }\n}\n\n// 儲存統計資料\nasync function saveStatsData(data: AffiliateStatsData): Promise<void> {\n  data.lastUpdated = new Date().toISOString()\n  await fs.writeFile(STATS_FILE, JSON.stringify(data, null, 2))\n}\n\n// 記錄點擊\nexport async function recordClick(\n  affiliateId: string,\n  linkId: string,\n  ip?: string,\n  userAgent?: string,\n  referrer?: string\n): Promise<string> {\n  const stats = await ensureStatsFile()\n  \n  const clickId = `clk_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`\n  const clickRecord: ClickRecord = {\n    id: clickId,\n    affiliateId,\n    linkId,\n    timestamp: new Date().toISOString(),\n    ip,\n    userAgent,\n    referrer,\n    converted: false,\n  }\n  \n  stats.clicks.push(clickRecord)\n  await saveStatsData(stats)\n  \n  // 同時更新連結系統中的點擊數\n  await updateLinkClickCount(linkId, affiliateId)\n  \n  console.log(`📊 記錄點擊: ${affiliateId} -> ${linkId}`)\n  return clickId\n}\n\n// 更新連結點擊數（與連結系統整合）\nasync function updateLinkClickCount(linkId: string, affiliateId: string): Promise<void> {\n  try {\n    // 這裡可以調用連結 API 更新點擊數\n    const response = await fetch(`${process.env.NEXT_PUBLIC_BASE_URL || 'http://localhost:3000'}/api/affiliate/links/click`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify({ linkId, affiliateId })\n    })\n    \n    if (!response.ok) {\n      console.warn(`更新連結 ${linkId} 點擊數失敗`)\n    }\n  } catch (error) {\n    console.warn('更新連結點擊數時發生錯誤:', error)\n  }\n}\n\n// 記錄轉換\nexport async function recordConversion(\n  clickId: string,\n  conversionValue: number\n): Promise<boolean> {\n  const stats = await ensureStatsFile()\n  \n  const clickRecord = stats.clicks.find(click => click.id === clickId)\n  if (!clickRecord) {\n    console.error('找不到點擊記錄:', clickId)\n    return false\n  }\n  \n  clickRecord.converted = true\n  clickRecord.conversionValue = conversionValue\n  clickRecord.conversionTimestamp = new Date().toISOString()\n  \n  await saveStatsData(stats)\n  \n  console.log(`💰 記錄轉換: ${clickRecord.affiliateId} -> $${conversionValue}`)\n  return true\n}\n\n// 獲取聯盟夥伴統計資料\nexport async function getAffiliateStats(\n  affiliateId: string,\n  days: number = 7\n): Promise<AffiliateStatsSummary & { linkStats: { [linkId: string]: { clicks: number, conversions: number, revenue: number, commission: number } } }> {\n  const stats = await ensureStatsFile()\n  \n  // 篩選指定聯盟夥伴的資料\n  const affiliateClicks = stats.clicks.filter(click => click.affiliateId === affiliateId)\n  \n  // 計算日期範圍\n  const endDate = new Date()\n  const startDate = new Date(endDate.getTime() - (days - 1) * 24 * 60 * 60 * 1000)\n  \n  // 篩選日期範圍內的資料\n  const periodClicks = affiliateClicks.filter(click => {\n    const clickDate = new Date(click.timestamp)\n    return clickDate >= startDate && clickDate <= endDate\n  })\n  \n  // 按日期分組統計\n  const dailyStats = new Map<string, AffiliateStatPoint>()\n  \n  // 按連結分組統計\n  const linkStats: { [linkId: string]: { clicks: number, conversions: number, revenue: number, commission: number } } = {}\n  \n  // 初始化每一天的資料\n  for (let i = 0; i < days; i++) {\n    const date = new Date(startDate.getTime() + i * 24 * 60 * 60 * 1000)\n    const dateKey = date.toISOString().slice(0, 10)\n    dailyStats.set(dateKey, {\n      date: dateKey,\n      clicks: 0,\n      conversions: 0,\n      revenue: 0,\n      commission: 0,\n    })\n  }\n  \n  // 統計實際資料\n  periodClicks.forEach(click => {\n    const dateKey = click.timestamp.slice(0, 10)\n    const dayStats = dailyStats.get(dateKey)\n    \n    // 初始化連結統計\n    if (!linkStats[click.linkId]) {\n      linkStats[click.linkId] = {\n        clicks: 0,\n        conversions: 0,\n        revenue: 0,\n        commission: 0\n      }\n    }\n    \n    if (dayStats) {\n      dayStats.clicks += 1\n      linkStats[click.linkId].clicks += 1\n      \n      if (click.converted && click.conversionValue) {\n        const revenue = click.conversionValue\n        const commission = revenue * 0.1 // 假設 10% 佣金率\n        \n        dayStats.conversions += 1\n        dayStats.revenue += revenue\n        dayStats.commission += commission\n        \n        linkStats[click.linkId].conversions += 1\n        linkStats[click.linkId].revenue += revenue\n        linkStats[click.linkId].commission += commission\n      }\n    }\n  })\n  \n  const trend = Array.from(dailyStats.values()).sort((a, b) => a.date.localeCompare(b.date))\n  \n  return {\n    period: `最近 ${days} 天`,\n    totalClicks: trend.reduce((sum, day) => sum + day.clicks, 0),\n    totalConversions: trend.reduce((sum, day) => sum + day.conversions, 0),\n    totalRevenue: Number(trend.reduce((sum, day) => sum + day.revenue, 0).toFixed(2)),\n    totalCommission: Number(trend.reduce((sum, day) => sum + day.commission, 0).toFixed(2)),\n    trend,\n    linkStats,\n  }\n}\n\n// 獲取所有統計資料（管理員用）\nexport async function getAllStats(): Promise<AffiliateStatsData> {\n  return await ensureStatsFile()\n}\n\n// 清除統計資料\nexport async function clearStats(): Promise<void> {\n  const initialData: AffiliateStatsData = {\n    clicks: [],\n    lastUpdated: new Date().toISOString(),\n  }\n  await saveStatsData(initialData)\n  console.log('🗑️  統計資料已清除')\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/data/cart-storage.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":6,"column":51,"nodeType":"MemberExpression","messageId":"unexpected","endLine":6,"endColumn":62},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":10,"column":51,"nodeType":"MemberExpression","messageId":"unexpected","endLine":10,"endColumn":62},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":12,"column":51,"nodeType":"MemberExpression","messageId":"unexpected","endLine":12,"endColumn":64},{"ruleId":"sonarjs/cognitive-complexity","severity":2,"message":"Refactor this function to reduce its Cognitive Complexity from 22 to the 15 allowed.","line":17,"column":50,"nodeType":null,"messageId":"refactorFunction","endLine":17,"endColumn":52},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":23,"column":53,"nodeType":"MemberExpression","messageId":"unexpected","endLine":23,"endColumn":64},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":32,"column":55,"nodeType":"MemberExpression","messageId":"unexpected","endLine":32,"endColumn":66},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":37,"column":51,"nodeType":"MemberExpression","messageId":"unexpected","endLine":37,"endColumn":62},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":40,"column":51,"nodeType":"MemberExpression","messageId":"unexpected","endLine":40,"endColumn":64},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":52,"column":51,"nodeType":"MemberExpression","messageId":"unexpected","endLine":52,"endColumn":62},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":54,"column":51,"nodeType":"MemberExpression","messageId":"unexpected","endLine":54,"endColumn":64}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// 混合儲存策略：同時使用 cookies 和 localStorage\nexport const setCartIdClient = (cartId: string) => {\n  if (typeof window !== 'undefined') {\n    try {\n      localStorage.setItem('_medusa_cart_id', cartId)\n      if (process.env.NODE_ENV === 'development') console.log(\"📱 Cart ID 已儲存到 localStorage:\", cartId)\n      \n      // 也嘗試設定 cookie (前端可讀取的)\n      document.cookie = `_medusa_cart_id=${cartId}; max-age=${60 * 60 * 24 * 7}; path=/; samesite=lax`\n      if (process.env.NODE_ENV === 'development') console.log(\"🍪 Cart ID 已儲存到前端 cookie:\", cartId)\n    } catch (error) {\n      if (process.env.NODE_ENV === 'development') console.error(\"❌ 儲存 Cart ID 失敗:\", error)\n    }\n  }\n}\n\nexport const getCartIdClient = (): string | null => {\n  if (typeof window !== 'undefined') {\n    try {\n      // 優先從 localStorage 取得\n      const localStorageId = localStorage.getItem('_medusa_cart_id')\n      if (localStorageId) {\n        if (process.env.NODE_ENV === 'development') console.log(\"📱 從 localStorage 取得 Cart ID:\", localStorageId)\n        return localStorageId\n      }\n      \n      // 備用方案：從 cookie 取得\n      const cookies = document.cookie.split(';')\n      for (const cookie of cookies) {\n        const [name, value] = cookie.trim().split('=')\n        if (name === '_medusa_cart_id') {\n          if (process.env.NODE_ENV === 'development') console.log(\"🍪 從前端 cookie 取得 Cart ID:\", value)\n          return value\n        }\n      }\n      \n      if (process.env.NODE_ENV === 'development') console.log(\"❌ 前端找不到 Cart ID\")\n      return null\n    } catch (error) {\n      if (process.env.NODE_ENV === 'development') console.error(\"❌ 取得 Cart ID 失敗:\", error)\n      return null\n    }\n  }\n  return null\n}\n\nexport const removeCartIdClient = () => {\n  if (typeof window !== 'undefined') {\n    try {\n      localStorage.removeItem('_medusa_cart_id')\n      document.cookie = '_medusa_cart_id=; max-age=-1; path=/'\n      if (process.env.NODE_ENV === 'development') console.log(\"🗑️ 已清除前端 Cart ID\")\n    } catch (error) {\n      if (process.env.NODE_ENV === 'development') console.error(\"❌ 清除 Cart ID 失敗:\", error)\n    }\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/data/cart.ts","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":25,"column":21,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":25,"endColumn":23,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[742,744],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":56,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":56,"endColumn":24,"suggestions":[{"fix":{"range":[1530,1572],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"sonarjs/cognitive-complexity","severity":2,"message":"Refactor this function to reduce its Cognitive Complexity from 26 to the 15 allowed.","line":63,"column":23,"nodeType":null,"messageId":"refactorFunction","endLine":63,"endColumn":35},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":71,"column":14,"nodeType":"MemberExpression","messageId":"unexpected","endLine":71,"endColumn":25},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":80,"column":16,"nodeType":"MemberExpression","messageId":"unexpected","endLine":80,"endColumn":27},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":89,"column":18,"nodeType":"MemberExpression","messageId":"unexpected","endLine":89,"endColumn":29},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":92,"column":18,"nodeType":"MemberExpression","messageId":"unexpected","endLine":92,"endColumn":29},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":97,"column":18,"nodeType":"MemberExpression","messageId":"unexpected","endLine":97,"endColumn":31},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":101,"column":16,"nodeType":"MemberExpression","messageId":"unexpected","endLine":101,"endColumn":27},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":105,"column":16,"nodeType":"MemberExpression","messageId":"unexpected","endLine":105,"endColumn":27},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":111,"column":18,"nodeType":"MemberExpression","messageId":"unexpected","endLine":111,"endColumn":31},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":159,"column":14,"nodeType":"MemberExpression","messageId":"unexpected","endLine":159,"endColumn":25},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":168,"column":16,"nodeType":"MemberExpression","messageId":"unexpected","endLine":168,"endColumn":27},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":185,"column":20,"nodeType":"MemberExpression","messageId":"unexpected","endLine":185,"endColumn":31},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":194,"column":20,"nodeType":"MemberExpression","messageId":"unexpected","endLine":194,"endColumn":33},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":198,"column":16,"nodeType":"MemberExpression","messageId":"unexpected","endLine":198,"endColumn":29},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":272,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":272,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6637,6640],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6637,6640],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":273,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":273,"endColumn":18,"suggestions":[{"fix":{"range":[6648,6680],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'code' is defined but never used.","line":326,"column":37,"nodeType":null,"messageId":"unusedVar","endLine":326,"endColumn":41},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'code' is defined but never used. Allowed unused args must match /^_/u.","line":326,"column":37,"nodeType":null,"messageId":"unusedVar","endLine":326,"endColumn":41},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'code' is defined but never used.","line":338,"column":38,"nodeType":null,"messageId":"unusedVar","endLine":338,"endColumn":42},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'code' is defined but never used. Allowed unused args must match /^_/u.","line":338,"column":38,"nodeType":null,"messageId":"unusedVar","endLine":338,"endColumn":42},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'codeToRemove' is defined but never used.","line":350,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":350,"endColumn":15},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'codeToRemove' is defined but never used. Allowed unused args must match /^_/u.","line":350,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":350,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'giftCards' is defined but never used.","line":351,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":351,"endColumn":12},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'giftCards' is defined but never used. Allowed unused args must match /^_/u.","line":351,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":351,"endColumn":12},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":351,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":351,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8545,8548],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8545,8548],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":376,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":376,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9186,9189],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9186,9189],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":406,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":406,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10259,10262],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10259,10262],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":425,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":425,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11081,11084],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11081,11084],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":440,"column":21,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":440,"endColumn":23,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[11537,11539],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"jsdoc/require-param-description","severity":1,"message":"Missing JSDoc @param \"regionId\" description.","line":475,"column":1,"nodeType":"Block","endLine":475,"endColumn":1},{"ruleId":"jsdoc/require-param-description","severity":1,"message":"Missing JSDoc @param \"countryCode\" description.","line":476,"column":1,"nodeType":"Block","endLine":476,"endColumn":1},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":532,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":532,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13680,13683],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13680,13683],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":535,"column":3,"nodeType":"MemberExpression","messageId":"unexpected","endLine":535,"endColumn":14,"suggestions":[{"fix":{"range":[13723,13803],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":551,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":551,"endColumn":16,"suggestions":[{"fix":{"range":[14021,14055],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":565,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":565,"endColumn":16,"suggestions":[{"fix":{"range":[14312,14353],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":571,"column":59,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":571,"endColumn":61,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[14496,14498],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":572,"column":25,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":572,"endColumn":27,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[14548,14550],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":575,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":575,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14582,14585],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14582,14585],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":576,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":576,"endColumn":18,"suggestions":[{"fix":{"range":[14593,14629],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":582,"column":50,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":582,"endColumn":52,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[14777,14779],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":14,"fatalErrorCount":0,"warningCount":28,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use server\"\n\nimport { sdk } from \"@lib/config\"\nimport medusaError from \"@lib/util/medusa-error\"\nimport { HttpTypes } from \"@medusajs/types\"\nimport { revalidateTag } from \"next/cache\"\nimport { redirect } from \"next/navigation\"\nimport {\n  getAuthHeaders,\n  getCacheOptions,\n  getCacheTag,\n  getCartId,\n  removeCartId,\n  setCartId,\n} from \"./cookies\"\nimport { getRegion } from \"./regions\"\n\n/**\n * Retrieves a cart by its ID. If no ID is provided, it will use the cart ID from the cookies.\n * @param cartId - optional - The ID of the cart to retrieve.\n * @returns The cart object if found, or null if not found.\n */\nexport async function retrieveCart(cartId?: string) {\n  const isDev = process.env.NODE_ENV === 'development'\n  const id = cartId || (await getCartId())\n\n  if (!id) {\n    // 這是正常情況 - 新用戶還沒有購物車\n    return null\n  }\n\n  const headers = {\n    ...(await getAuthHeaders()),\n  }\n\n  const next = {\n    ...(await getCacheOptions(\"carts\")),\n  }\n\n  return await sdk.client\n    .fetch<HttpTypes.StoreCartResponse>(`/store/carts/${id}`, {\n      method: \"GET\",\n      query: {\n        fields:\n          \"*items, *region, *items.product, *items.variant, *items.variant.options, *items.variant.options.option, *items.thumbnail, *items.metadata, +items.total, *promotions, +shipping_methods.name\",\n      },\n      headers,\n      next,\n      cache: \"no-store\", // 不緩存購物車資料，確保每次都是最新的\n    })\n    .then(({ cart }) => cart)\n    .catch((error) => {\n      // 只在真正的錯誤時記錄，而不是沒有購物車時\n      if (error.status !== 404) {\n        if (isDev) {\n          console.error(\"❌ retrieveCart 失敗:\", error)\n        }\n      }\n      return null\n    })\n}\n\nexport async function getOrSetCart(countryCode: string) {\n  const isDev = process.env.NODE_ENV === 'development'\n  const region = await getRegion(countryCode)\n\n  if (!region) {\n    throw new Error(`Region not found for country code: ${countryCode}`)\n  }\n\n  if (isDev) console.log(\"🌍 區域資訊:\", { regionId: region.id, countryCode })\n\n  let cart = await retrieveCart()\n\n  const headers = {\n    ...(await getAuthHeaders()),\n  }\n\n  if (!cart) {\n    if (isDev) console.log(\"🆕 建立新購物車...\")\n    try {\n      const cartResp = await sdk.store.cart.create(\n        { region_id: region.id },\n        {},\n        headers\n      )\n      cart = cartResp.cart\n\n      if (isDev) console.log(\"✅ 購物車建立成功:\", { cartId: cart.id })\n\n      await setCartId(cart.id)\n      if (isDev) console.log(\"🍪 Cart ID 已設定到 cookies:\", cart.id)\n\n      const cartCacheTag = await getCacheTag(\"carts\")\n      revalidateTag(cartCacheTag)\n    } catch (error) {\n      if (isDev) console.error(\"❌ 建立購物車失敗:\", error)\n      throw error\n    }\n  } else {\n    if (isDev) console.log(\"♻️ 使用現有購物車:\", { cartId: cart.id })\n  }\n\n  if (cart && cart?.region_id !== region.id) {\n    if (isDev) console.log(\"🔄 更新購物車區域...\")\n    try {\n      await sdk.store.cart.update(cart.id, { region_id: region.id }, {}, headers)\n      const cartCacheTag = await getCacheTag(\"carts\")\n      revalidateTag(cartCacheTag)\n    } catch (error) {\n      if (isDev) console.error(\"❌ 更新購物車區域失敗:\", error)\n      throw error\n    }\n  }\n\n  return cart\n}\n\nexport async function updateCart(data: HttpTypes.StoreUpdateCart) {\n  const cartId = await getCartId()\n\n  if (!cartId) {\n    throw new Error(\"No existing cart found, please create one before updating\")\n  }\n\n  const headers = {\n    ...(await getAuthHeaders()),\n  }\n\n  return sdk.store.cart\n    .update(cartId, data, {}, headers)\n    .then(async ({ cart }) => {\n      const cartCacheTag = await getCacheTag(\"carts\")\n      revalidateTag(cartCacheTag)\n\n      const fulfillmentCacheTag = await getCacheTag(\"fulfillment\")\n      revalidateTag(fulfillmentCacheTag)\n\n      return cart\n    })\n    .catch(medusaError)\n}\n\nexport async function addToCart({\n  variantId,\n  quantity,\n  countryCode,\n}: {\n  variantId: string\n  quantity: number\n  countryCode: string\n}) {\n  const isDev = process.env.NODE_ENV === 'development'\n  \n  if (!variantId) {\n    throw new Error(\"Missing variant ID when adding to cart\")\n  }\n\n  if (isDev) console.log(\"🚀 addToCart 開始:\", { variantId, quantity, countryCode })\n\n  try {\n    const cart = await getOrSetCart(countryCode)\n\n    if (!cart) {\n      throw new Error(\"Error retrieving or creating cart\")\n    }\n\n    if (isDev) console.log(\"📦 購物車資訊:\", { cartId: cart.id, regionId: cart.region_id })\n\n    const headers = {\n      ...(await getAuthHeaders()),\n    }\n\n    await sdk.store.cart\n      .createLineItem(\n        cart.id,\n        {\n          variant_id: variantId,\n          quantity,\n        },\n        {},\n        headers\n      )\n      .then(async (response) => {\n        if (isDev) console.log(\"✅ 成功創建購物車項目:\", response)\n        \n        const cartCacheTag = await getCacheTag(\"carts\")\n        revalidateTag(cartCacheTag)\n\n        const fulfillmentCacheTag = await getCacheTag(\"fulfillment\")\n        revalidateTag(fulfillmentCacheTag)\n      })\n      .catch((error) => {\n        if (isDev) console.error(\"❌ 創建購物車項目失敗:\", error)\n        throw error\n      })\n  } catch (error) {\n    if (isDev) console.error(\"❌ addToCart 失敗:\", error)\n    throw error\n  }\n}\n\nexport async function updateLineItem({\n  lineId,\n  quantity,\n}: {\n  lineId: string\n  quantity: number\n}) {\n  if (!lineId) {\n    throw new Error(\"Missing lineItem ID when updating line item\")\n  }\n\n  const cartId = await getCartId()\n\n  if (!cartId) {\n    throw new Error(\"Missing cart ID when updating line item\")\n  }\n\n  const headers = {\n    ...(await getAuthHeaders()),\n  }\n\n  await sdk.store.cart\n    .updateLineItem(cartId, lineId, { quantity }, {}, headers)\n    .then(async () => {\n      const cartCacheTag = await getCacheTag(\"carts\")\n      revalidateTag(cartCacheTag)\n\n      const fulfillmentCacheTag = await getCacheTag(\"fulfillment\")\n      revalidateTag(fulfillmentCacheTag)\n    })\n    .catch(medusaError)\n}\n\nexport async function deleteLineItem(lineId: string) {\n  if (!lineId) {\n    throw new Error(\"Missing lineItem ID when deleting line item\")\n  }\n\n  const cartId = await getCartId()\n\n  if (!cartId) {\n    throw new Error(\"Missing cart ID when deleting line item\")\n  }\n\n  const headers = {\n    ...(await getAuthHeaders()),\n  }\n\n  await sdk.store.cart\n    .deleteLineItem(cartId, lineId, headers)\n    .then(async () => {\n      const cartCacheTag = await getCacheTag(\"carts\")\n      revalidateTag(cartCacheTag)\n\n      const fulfillmentCacheTag = await getCacheTag(\"fulfillment\")\n      revalidateTag(fulfillmentCacheTag)\n    })\n    .catch(medusaError)\n}\n\n/**\n * 清空整個購物車 - 當遇到支付會話衝突時的最後手段\n */\nexport async function clearCart() {\n  try {\n    removeCartId()\n    const cartCacheTag = await getCacheTag(\"carts\")\n    revalidateTag(cartCacheTag)\n    return true\n  } catch (error: any) {\n    console.error(\"清空購物車失敗:\", error)\n    throw new Error(\"清空購物車失敗\")\n  }\n}\n\nexport async function setShippingMethod({\n  cartId,\n  shippingMethodId,\n}: {\n  cartId: string\n  shippingMethodId: string\n}) {\n  const headers = {\n    ...(await getAuthHeaders()),\n  }\n\n  return sdk.store.cart\n    .addShippingMethod(cartId, { option_id: shippingMethodId }, {}, headers)\n    .then(async () => {\n      const cartCacheTag = await getCacheTag(\"carts\")\n      revalidateTag(cartCacheTag)\n    })\n    .catch(medusaError)\n}\n\nexport async function applyPromotions(codes: string[]) {\n  const cartId = await getCartId()\n\n  if (!cartId) {\n    throw new Error(\"無法獲取購物車 ID，請先添加商品到購物車\")\n  }\n\n  // 確保 codes 是有效的字符串數組\n  const validCodes = codes.filter(code => typeof code === 'string' && code.trim() !== '')\n\n  const headers = {\n    ...(await getAuthHeaders()),\n  }\n\n  return sdk.store.cart\n    .update(cartId, { promo_codes: validCodes }, {}, headers)\n    .then(async () => {\n      const cartCacheTag = await getCacheTag(\"carts\")\n      revalidateTag(cartCacheTag)\n\n      const fulfillmentCacheTag = await getCacheTag(\"fulfillment\")\n      revalidateTag(fulfillmentCacheTag)\n    })\n    .catch((error) => {\n      throw medusaError(error)\n    })\n}\n\nexport async function applyGiftCard(code: string) {\n  //   const cartId = getCartId()\n  //   if (!cartId) return \"No cartId cookie found\"\n  //   try {\n  //     await updateCart(cartId, { gift_cards: [{ code }] }).then(() => {\n  //       revalidateTag(\"cart\")\n  //     })\n  //   } catch (error: any) {\n  //     throw error\n  //   }\n}\n\nexport async function removeDiscount(code: string) {\n  // const cartId = getCartId()\n  // if (!cartId) return \"No cartId cookie found\"\n  // try {\n  //   await deleteDiscount(cartId, code)\n  //   revalidateTag(\"cart\")\n  // } catch (error: any) {\n  //   throw error\n  // }\n}\n\nexport async function removeGiftCard(\n  codeToRemove: string,\n  giftCards: any[]\n  // giftCards: GiftCard[]\n) {\n  //   const cartId = getCartId()\n  //   if (!cartId) return \"No cartId cookie found\"\n  //   try {\n  //     await updateCart(cartId, {\n  //       gift_cards: [...giftCards]\n  //         .filter((gc) => gc.code !== codeToRemove)\n  //         .map((gc) => ({ code: gc.code })),\n  //     }).then(() => {\n  //       revalidateTag(\"cart\")\n  //     })\n  //   } catch (error: any) {\n  //     throw error\n  //   }\n}\n\nexport async function submitPromotionForm(\n  currentState: unknown,\n  formData: FormData\n) {\n  const code = formData.get(\"code\") as string\n  try {\n    await applyPromotions([code])\n  } catch (e: any) {\n    return e.message\n  }\n}\n\n// TODO: Pass a POJO instead of a form entity here\nexport async function setAddresses(currentState: unknown, formData: FormData) {\n  try {\n    if (!formData) {\n      throw new Error(\"No form data found when setting addresses\")\n    }\n    const cartId = getCartId()\n    if (!cartId) {\n      throw new Error(\"No existing cart found when setting addresses\")\n    }\n\n    const data = {\n      shipping_address: {\n        first_name: formData.get(\"shipping_address.first_name\"),\n        last_name: formData.get(\"shipping_address.last_name\"),\n        address_1: formData.get(\"shipping_address.address_1\"),\n        address_2: \"\",\n        company: formData.get(\"shipping_address.company\"),\n        postal_code: formData.get(\"shipping_address.postal_code\"),\n        city: formData.get(\"shipping_address.city\"),\n        country_code: formData.get(\"shipping_address.country_code\"),\n        province: formData.get(\"shipping_address.province\"),\n        phone: formData.get(\"shipping_address.phone\"),\n      },\n      email: formData.get(\"email\"),\n    } as any\n\n    const sameAsBilling = formData.get(\"same_as_billing\")\n    if (sameAsBilling === \"on\") data.billing_address = data.shipping_address\n\n    if (sameAsBilling !== \"on\")\n      data.billing_address = {\n        first_name: formData.get(\"billing_address.first_name\"),\n        last_name: formData.get(\"billing_address.last_name\"),\n        address_1: formData.get(\"billing_address.address_1\"),\n        address_2: \"\",\n        company: formData.get(\"billing_address.company\"),\n        postal_code: formData.get(\"billing_address.postal_code\"),\n        city: formData.get(\"billing_address.city\"),\n        country_code: formData.get(\"billing_address.country_code\"),\n        province: formData.get(\"billing_address.province\"),\n        phone: formData.get(\"billing_address.phone\"),\n      }\n    await updateCart(data)\n  } catch (e: any) {\n    return e.message\n  }\n\n  redirect(\n    `/${formData.get(\"shipping_address.country_code\")}/checkout?step=delivery`\n  )\n}\n\n/**\n * Places an order for a cart. If no cart ID is provided, it will use the cart ID from the cookies.\n * @param cartId - optional - The ID of the cart to place an order for.\n * @returns The cart object if the order was successful, or null if not.\n */\nexport async function placeOrder(cartId?: string) {\n  const id = cartId || (await getCartId())\n\n  if (!id) {\n    throw new Error(\"No existing cart found when placing an order\")\n  }\n\n  const headers = {\n    ...(await getAuthHeaders()),\n  }\n\n  const cartRes = await sdk.store.cart\n    .complete(id, {}, headers)\n    .then(async (cartRes) => {\n      const cartCacheTag = await getCacheTag(\"carts\")\n      revalidateTag(cartCacheTag)\n      return cartRes\n    })\n    .catch(medusaError)\n\n  if (cartRes?.type === \"order\") {\n    const countryCode =\n      cartRes.order.shipping_address?.country_code?.toLowerCase()\n\n    const orderCacheTag = await getCacheTag(\"orders\")\n    revalidateTag(orderCacheTag)\n\n    removeCartId()\n    redirect(`/${countryCode}/order/${cartRes?.order.id}/confirmed`)\n  }\n\n  return cartRes.cart\n}\n\n/**\n * Updates the countrycode param and revalidates the regions cache\n * @param regionId\n * @param countryCode\n */\nexport async function updateRegion(countryCode: string, currentPath: string) {\n  const cartId = await getCartId()\n  const region = await getRegion(countryCode)\n\n  if (!region) {\n    throw new Error(`Region not found for country code: ${countryCode}`)\n  }\n\n  if (cartId) {\n    await updateCart({ region_id: region.id })\n    const cartCacheTag = await getCacheTag(\"carts\")\n    revalidateTag(cartCacheTag)\n  }\n\n  const regionCacheTag = await getCacheTag(\"regions\")\n  revalidateTag(regionCacheTag)\n\n  const productsCacheTag = await getCacheTag(\"products\")\n  revalidateTag(productsCacheTag)\n\n  redirect(`/${countryCode}${currentPath}`)\n}\n\nexport async function listCartOptions() {\n  const cartId = await getCartId()\n  \n  // 如果沒有購物車 ID，返回空的運送選項\n  if (!cartId) {\n    return { shipping_options: [] }\n  }\n  \n  const headers = {\n    ...(await getAuthHeaders()),\n  }\n  const next = {\n    ...(await getCacheOptions(\"shippingOptions\")),\n  }\n\n  return await sdk.client.fetch<{\n    shipping_options: HttpTypes.StoreCartShippingOption[]\n  }>(\"/store/shipping-options\", {\n    query: { cart_id: cartId },\n    next,\n    headers,\n    cache: \"force-cache\",\n  }).catch(() => {\n    return { shipping_options: [] }\n  })\n}\n\n/**\n * 初始化支付會話 - 為購物車設置支付方式\n */\nexport async function initiatePaymentSession(\n  cart: any,\n  data: { provider_id: string }\n) {\n  console.log(\"🔄 開始初始化支付會話:\", { cartId: cart?.id, providerId: data.provider_id })\n\n  if (!cart?.id) {\n    throw new Error(\"購物車不存在\")\n  }\n\n  if (!data.provider_id) {\n    throw new Error(\"支付方式不能為空\")\n  }\n\n  const headers = {\n    ...(await getAuthHeaders()),\n  }\n\n  try {\n    // 方法1：嘗試使用購物車更新來設置支付方式\n    console.log(\"🔄 嘗試方法1: 更新購物車支付方式\")\n    \n    const updateResponse = await sdk.store.cart.update(\n      cart.id,\n      {\n        // 在 Medusa v2 中，可能需要透過其他方式來設置支付方式\n        metadata: {\n          preferred_payment_provider: data.provider_id\n        }\n      },\n      {},\n      headers\n    )\n\n    console.log(\"✅ 購物車更新成功:\", updateResponse)\n\n    // 重新獲取購物車數據\n    const updatedCart = await retrieveCart(cart.id)\n\n    return {\n      payment_collection: updatedCart?.payment_collection || cart.payment_collection,\n      cart: updatedCart || cart,\n    }\n\n  } catch (error: any) {\n    console.error(\"❌ 初始化支付會話失敗:\", error)\n    \n    // 提供更詳細的錯誤信息\n    let errorMessage = \"設置支付方式時發生錯誤\"\n    \n    if (error?.response?.data) {\n      errorMessage = error.response.data.message || JSON.stringify(error.response.data)\n    } else if (error?.message) {\n      errorMessage = error.message\n    }\n\n    throw new Error(errorMessage)\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/data/categories.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'CacheOptions' is defined but never used.","line":5,"column":6,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":18},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'CacheOptions' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":6,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":18},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":12,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[296,299],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[296,299],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":20,"column":31,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":20,"endColumn":33,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[602,604],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":52,"column":49,"nodeType":"MemberExpression","messageId":"unexpected","endLine":52,"endColumn":62}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { sdk, MEDUSA_BACKEND_URL } from \"../config\"\nimport { getPublishableKeyForBackend } from \"../medusa-publishable-key\"\nimport { HttpTypes } from \"@medusajs/types\"\n\ntype CacheOptions = {\n  revalidate?: number\n  tags?: string[]\n}\n\n\n\nexport const listCategories = async (query?: Record<string, any>) => {\n  return sdk.client\n    .fetch<{ product_categories: HttpTypes.StoreProductCategory[] }>(\n      \"/store/product-categories\",\n      {\n        query: {\n          fields:\n            \"*category_children, *products, *parent_category, *parent_category.parent_category\",\n          limit: query?.limit || 100,\n          ...query,\n        },\n        headers: {\n          \"x-publishable-api-key\": getPublishableKeyForBackend(MEDUSA_BACKEND_URL),\n        },\n        next: { revalidate: 300 }\n      }\n    )\n    .then(({ product_categories }) => product_categories)\n}\n\nexport const getCategoryByHandle = async (categoryHandle: string[]) => {\n  const handle = `${categoryHandle.join(\"/\")}`\n\n  try {\n    return sdk.client\n      .fetch<HttpTypes.StoreProductCategoryListResponse>(\n        `/store/product-categories`,\n        {\n          query: {\n            fields: \"*category_children, *products\",\n            handle,\n          },\n          headers: {\n            \"x-publishable-api-key\": getPublishableKeyForBackend(MEDUSA_BACKEND_URL),\n          },\n          next: { revalidate: 300 }\n        }\n      )\n      .then(({ product_categories }) => product_categories[0] || null)\n  } catch (error) {\n    if (process.env.NODE_ENV === 'development') console.error(`Failed to fetch category by handle \"${handle}\":`, error)\n    return null\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/data/client-auth.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":8,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":8,"endColumn":16,"suggestions":[{"fix":{"range":[131,161],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":12,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":12,"endColumn":16,"suggestions":[{"fix":{"range":[223,248],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":14,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":14,"endColumn":18,"suggestions":[{"fix":{"range":[273,308],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":22,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":22,"endColumn":17,"suggestions":[{"fix":{"range":[419,454],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":26,"column":3,"nodeType":"MemberExpression","messageId":"unexpected","endLine":26,"endColumn":14,"suggestions":[{"fix":{"range":[481,508],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { sdk } from \"@lib/config\"\n\n// 客戶端登出函數\nexport async function clientSignout(countryCode: string) {\n  try {\n    console.log('🚪 開始客戶端登出流程...')\n    \n    // 使用 Medusa SDK 登出\n    await sdk.auth.logout()\n    console.log('✅ SDK 登出成功')\n  } catch (error) {\n    console.error('❌ SDK 登出失敗:', error)\n  }\n\n  // 清除本地存儲（可選的額外清理）\n  try {\n    localStorage.clear()\n    sessionStorage.clear()\n  } catch (error) {\n    console.warn('⚠️ 清除本地存儲失敗:', error)\n  }\n\n  // 重定向到主頁並重新載入頁面\n  console.log('🔄 重定向到主頁...')\n  window.location.href = `/${countryCode}`\n}","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/data/collections.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/data/cookies.ts","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":6,"column":61,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":6,"endColumn":63,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[310,312],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":15,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":15,"endColumn":16,"suggestions":[{"fix":{"range":[590,871],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":17,"column":34,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":17,"endColumn":36,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[695,697],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":32,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":32,"endColumn":18,"suggestions":[{"fix":{"range":[1204,1279],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":37,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":37,"endColumn":16,"suggestions":[{"fix":{"range":[1358,1415],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":40,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":40,"endColumn":18,"suggestions":[{"fix":{"range":[1459,1503],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":59,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":59,"endColumn":17},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":59,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":59,"endColumn":17},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":81,"column":3,"nodeType":"MemberExpression","messageId":"unexpected","endLine":81,"endColumn":14,"suggestions":[{"fix":{"range":[2329,2534],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":101,"column":3,"nodeType":"MemberExpression","messageId":"unexpected","endLine":101,"endColumn":14,"suggestions":[{"fix":{"range":[2977,3034],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":125,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":125,"endColumn":16,"suggestions":[{"fix":{"range":[3700,3790],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":165,"column":47,"nodeType":"MemberExpression","messageId":"unexpected","endLine":165,"endColumn":58},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":165,"column":85,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":165,"endColumn":87,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[4734,4736],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":178,"column":47,"nodeType":"MemberExpression","messageId":"unexpected","endLine":178,"endColumn":58}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import \"server-only\"\nimport { cookies as nextCookies } from \"next/headers\"\n\n// Optional cookie domain (set this to \".timsfantasyworld.com\" in production if you\n// need the cookie to be shared across subdomains). If not set, cookies remain host-only.\nconst COOKIE_DOMAIN = process.env.NEXT_PUBLIC_COOKIE_DOMAIN || undefined\n\nexport const getAuthHeaders = async (): Promise<\n  { authorization: string; 'x-publishable-api-key'?: string } | { 'x-publishable-api-key'?: string }\n> => {\n  try {\n    const cookies = await nextCookies()\n    const token = cookies.get(\"_medusa_jwt\")?.value\n    \n    console.log('🔍 getAuthHeaders - 檢查 token:', {\n      hasToken: !!token,\n      tokenLength: token?.length || 0,\n      tokenPreview: token ? `${token.substring(0, 30)}...` : null,\n      cookieName: '_medusa_jwt',\n      allCookies: Array.from(cookies.getAll()).map(c => c.name)\n    })\n    \n    // 總是包含 publishable key\n    const headers: { authorization?: string; 'x-publishable-api-key'?: string } = {}\n    \n    // 添加 publishable key (如果有)\n    if (process.env.NEXT_PUBLIC_MEDUSA_PUBLISHABLE_KEY) {\n      headers['x-publishable-api-key'] = process.env.NEXT_PUBLIC_MEDUSA_PUBLISHABLE_KEY\n    }\n\n    if (!token) {\n      console.log('❌ getAuthHeaders - 沒有找到 token，返回僅含 publishable key 的 headers')\n      return headers\n    }\n\n    headers.authorization = `Bearer ${token}`\n    console.log('✅ getAuthHeaders - 設置 authorization header')\n    return headers\n  } catch (error) {\n    console.error('❌ getAuthHeaders 錯誤:', error)\n    // 即使出錯也返回 publishable key\n    if (process.env.NEXT_PUBLIC_MEDUSA_PUBLISHABLE_KEY) {\n      return { 'x-publishable-api-key': process.env.NEXT_PUBLIC_MEDUSA_PUBLISHABLE_KEY }\n    }\n    return {}\n  }\n}\n\nexport const getCacheTag = async (tag: string): Promise<string> => {\n  try {\n    const cookies = await nextCookies()\n    const cacheId = cookies.get(\"_medusa_cache_id\")?.value\n\n    if (!cacheId) {\n      return \"\"\n    }\n\n    return `${tag}-${cacheId}`\n  } catch (error) {\n    return \"\"\n  }\n}\n\nexport const getCacheOptions = async (\n  tag: string\n): Promise<{ tags: string[] } | {}> => {\n  if (typeof window !== \"undefined\") {\n    return {}\n  }\n\n  const cacheTag = await getCacheTag(tag)\n\n  if (!cacheTag) {\n    return {}\n  }\n\n  return { tags: [`${cacheTag}`] }\n}\n\nexport const setAuthToken = async (token: string) => {\n  console.log(\"📝 setAuthToken 開始\", {\n    tokenLength: token?.length || 0,\n    tokenPreview: token ? token.substring(0, 50) + \"...\" : null,\n    env: process.env.NODE_ENV,\n    cookieDomain: COOKIE_DOMAIN\n  })\n  \n  const cookies = await nextCookies()\n  \n  cookies.set(\"_medusa_jwt\", token, {\n    maxAge: 60 * 60 * 24 * 7,\n    httpOnly: true,\n    // Allow sending/setting cookie on top-level navigations coming from external OAuth\n    // providers (Google). Lax is a safe default for auth cookies in this flow.\n    sameSite: \"lax\",\n    secure: process.env.NODE_ENV === \"production\",\n    domain: COOKIE_DOMAIN,\n    path: \"/\", // 確保 cookie 路徑一致\n  })\n  \n  console.log(\"✅ setAuthToken 完成 - _medusa_jwt cookie 已設置\")\n  \n  // 🔍 調試用：額外設置一個可在瀏覽器中查看的 JWT cookie\n  // 只在開發環境中設置，並截取 token 的前 100 字符以便查看\n  if (process.env.NODE_ENV === \"development\") {\n    cookies.set(\"_debug_jwt_preview\", token.substring(0, 200) + \"...\", {\n      maxAge: 60 * 60 * 24 * 7,\n      httpOnly: false, // 允許在瀏覽器中查看\n      sameSite: \"lax\",\n      secure: false, // 開發環境中不需要 HTTPS\n      domain: COOKIE_DOMAIN,\n      path: \"/\", // 確保路徑一致\n    })\n    \n    // 🔍 完整的 JWT token 用於調試（僅開發環境）\n    cookies.set(\"_debug_jwt_full\", token, {\n      maxAge: 60 * 60 * 24 * 7,\n      httpOnly: false, // 允許在瀏覽器中查看\n      sameSite: \"lax\", \n      secure: false,\n      domain: COOKIE_DOMAIN,\n      path: \"/\", // 確保路徑一致\n    })\n    \n    console.log(\"✅ setAuthToken 完成 - Debug cookies 已設置 (_debug_jwt_preview, _debug_jwt_full)\")\n  }\n}\n\nexport const removeAuthToken = async () => {\n  const cookies = await nextCookies()\n  cookies.set(\"_medusa_jwt\", \"\", {\n    maxAge: -1,\n    httpOnly: true,\n    sameSite: \"lax\",\n    secure: process.env.NODE_ENV === \"production\",\n    domain: COOKIE_DOMAIN,\n    path: \"/\",\n  })\n  \n  // 🔍 同時移除調試 cookies\n  if (process.env.NODE_ENV === \"development\") {\n    cookies.set(\"_debug_jwt_preview\", \"\", {\n      maxAge: -1,\n      httpOnly: false,\n      sameSite: \"lax\",\n      secure: false,\n      domain: COOKIE_DOMAIN,\n      path: \"/\",\n    })\n    \n    cookies.set(\"_debug_jwt_full\", \"\", {\n      maxAge: -1,\n      httpOnly: false,\n      sameSite: \"lax\",\n      secure: false,\n      domain: COOKIE_DOMAIN,\n      path: \"/\",\n    })\n  }\n}\n\nexport const getCartId = async () => {\n  const cookies = await nextCookies()\n  const cartId = cookies.get(\"_medusa_cart_id\")?.value\n  if (process.env.NODE_ENV === 'development') console.log(\"🛒 Get Cart ID:\", cartId || \"❌ No cart ID found in cookies\")\n  return cartId\n}\n\nexport const setCartId = async (cartId: string) => {\n  const cookies = await nextCookies()\n  cookies.set(\"_medusa_cart_id\", cartId, {\n    maxAge: 60 * 60 * 24 * 7,\n    httpOnly: false, // 前端需要讀取\n    sameSite: \"lax\", // 支援跨請求\n    secure: process.env.NODE_ENV === \"production\",\n    domain: COOKIE_DOMAIN,\n  })\n  if (process.env.NODE_ENV === 'development') console.log(\"🍪 設定 Cart ID 到 cookies:\", cartId)\n}\n\nexport const removeCartId = async () => {\n  const cookies = await nextCookies()\n  cookies.set(\"_medusa_cart_id\", \"\", {\n    maxAge: -1,\n    httpOnly: false,\n    sameSite: \"lax\",\n    secure: process.env.NODE_ENV === \"production\",\n    domain: COOKIE_DOMAIN,\n    path: \"/\",\n  })\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/data/customer.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":22,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":22,"endColumn":16,"suggestions":[{"fix":{"range":[513,715],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":24,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[626,629],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[626,629],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":28,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[758,761],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[758,761],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":29,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":29,"endColumn":18,"suggestions":[{"fix":{"range":[787,845],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":42,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":42,"endColumn":18,"suggestions":[{"fix":{"range":[1011,1063],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"sonarjs/prefer-immediate-return","severity":2,"message":"Immediately return this expression instead of assigning it to the temporary variable \"result\".","line":43,"column":22,"nodeType":"AwaitExpression","messageId":"doImmediateAction","endLine":60,"endColumn":11,"fix":{"range":[1070,1638],"text":"return await sdk.client\n        .fetch<{ customer: HttpTypes.StoreCustomer }>(`/store/customers/me`, {\n          method: \"GET\",\n          query: {\n            fields: \"*orders\",\n          },\n          headers,\n          next,\n          cache: \"no-cache\", // 改為 no-cache 確保獲取最新狀態\n        })\n        .then(({ customer }) => {\n          console.log('✅ retrieveCustomer - 成功獲取客戶資料:', {\n            hasCustomer: !!customer,\n            email: customer?.email,\n            id: customer?.id\n          })\n          return customer\n        })"}},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":54,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":54,"endColumn":22,"suggestions":[{"fix":{"range":[1412,1574],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":71,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":71,"endColumn":20,"suggestions":[{"fix":{"range":[1936,2001],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":73,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":73,"endColumn":22,"suggestions":[{"fix":{"range":[2025,2224],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":124,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":124,"endColumn":16,"suggestions":[{"fix":{"range":[3354,3412],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":132,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":132,"endColumn":16,"suggestions":[{"fix":{"range":[3594,3656],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":147,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":147,"endColumn":16,"suggestions":[{"fix":{"range":[3918,4031],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":158,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":158,"endColumn":16,"suggestions":[{"fix":{"range":[4190,4224],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":167,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":167,"endColumn":16,"suggestions":[{"fix":{"range":[4416,4447],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":169,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":169,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4493,4496],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4493,4496],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":170,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":170,"endColumn":18,"suggestions":[{"fix":{"range":[4504,4533],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":174,"column":42,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":174,"endColumn":44,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[4652,4654],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":220,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":220,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5950,5953],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5950,5953],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":221,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":221,"endColumn":18,"suggestions":[{"fix":{"range":[5961,5990],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":225,"column":42,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":225,"endColumn":44,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[6109,6111],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":245,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":245,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6664,6667],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6664,6667],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":246,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":246,"endColumn":18,"suggestions":[{"fix":{"range":[6675,6707],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":256,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":256,"endColumn":16,"suggestions":[{"fix":{"range":[6857,6886],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":260,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":260,"endColumn":16,"suggestions":[{"fix":{"range":[6953,6985],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":264,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":264,"endColumn":16,"suggestions":[{"fix":{"range":[7037,7062],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":268,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":268,"endColumn":16,"suggestions":[{"fix":{"range":[7109,7136],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":277,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":277,"endColumn":16,"suggestions":[{"fix":{"range":[7348,7373],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":280,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":280,"endColumn":18,"suggestions":[{"fix":{"range":[7403,7443],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":302,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":302,"endColumn":21,"suggestions":[{"fix":{"range":[7838,7887],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":313,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":313,"endColumn":18,"suggestions":[{"fix":{"range":[8121,8159],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":317,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":317,"endColumn":20,"suggestions":[{"fix":{"range":[8242,8284],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":326,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":326,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8437,8440],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8437,8440],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'customer' is defined but never used.","line":351,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":351,"endColumn":28},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'customer' is defined but never used. Allowed unused args must match /^_/u.","line":351,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":351,"endColumn":28},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":383,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":383,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10219,10222],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10219,10222],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ensureCartAssociation' is defined but never used.","line":429,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":429,"endColumn":37},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'ensureCartAssociation' is defined but never used. Allowed unused vars must match /^_/u.","line":429,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":429,"endColumn":37},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":455,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":455,"endColumn":16,"suggestions":[{"fix":{"range":[12080,12104],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":457,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":457,"endColumn":18,"suggestions":[{"fix":{"range":[12129,12163],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":464,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":464,"endColumn":16,"suggestions":[{"fix":{"range":[12320,12354],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":470,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":470,"endColumn":16,"suggestions":[{"fix":{"range":[12434,12466],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":479,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":479,"endColumn":16,"suggestions":[{"fix":{"range":[12642,12670],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":481,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":481,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12718,12721],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12718,12721],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":482,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":482,"endColumn":18,"suggestions":[{"fix":{"range":[12729,12771],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":483,"column":51,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":483,"endColumn":53,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[12822,12824],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":37,"fixableErrorCount":1,"fixableWarningCount":0,"source":"\"use server\"\n\nimport { sdk } from \"@lib/config\"\nimport medusaError from \"@lib/util/medusa-error\"\nimport { HttpTypes } from \"@medusajs/types\"\nimport { revalidateTag } from \"next/cache\"\nimport { redirect } from \"next/navigation\"\nimport {\n  getAuthHeaders,\n  getCacheOptions,\n  getCacheTag,\n  getCartId,\n  removeAuthToken,\n  removeCartId,\n  setAuthToken,\n} from \"./cookies\"\n\nexport const retrieveCustomer =\n  async (): Promise<HttpTypes.StoreCustomer | null> => {\n    const authHeaders = await getAuthHeaders()\n\n    console.log('🔍 retrieveCustomer - 檢查認證標頭:', {\n      hasHeaders: !!authHeaders,\n      hasAuth: !!(authHeaders as any)?.authorization,\n      headerKeys: authHeaders ? Object.keys(authHeaders) : []\n    })\n\n    if (!authHeaders || !(authHeaders as any)?.authorization) {\n      console.log('ℹ️ retrieveCustomer - 使用者未登入，返回 null (正常情況)')\n      return null\n    }\n\n    const headers = {\n      ...authHeaders,\n    }\n\n    const next = {\n      ...(await getCacheOptions(\"customers\")),\n    }\n\n    try {\n      console.log('📡 retrieveCustomer - 發送請求到 Medusa 後端')\n      const result = await sdk.client\n        .fetch<{ customer: HttpTypes.StoreCustomer }>(`/store/customers/me`, {\n          method: \"GET\",\n          query: {\n            fields: \"*orders\",\n          },\n          headers,\n          next,\n          cache: \"no-cache\", // 改為 no-cache 確保獲取最新狀態\n        })\n        .then(({ customer }) => {\n          console.log('✅ retrieveCustomer - 成功獲取客戶資料:', {\n            hasCustomer: !!customer,\n            email: customer?.email,\n            id: customer?.id\n          })\n          return customer\n        })\n      \n      return result\n    } catch (error) {\n      // 檢查是否為認證錯誤（401 Unauthorized）\n      const isAuthError = error instanceof Error && \n        (error.message.includes('401') || \n         error.message.includes('Unauthorized') || \n         error.message.includes('Invalid token'))\n      \n      if (isAuthError) {\n        console.log('ℹ️ retrieveCustomer - 認證失敗，可能是未登入或 token 過期 (正常情況)')\n      } else {\n        console.error('❌ retrieveCustomer - 獲取客戶資訊失敗:', {\n          error: error instanceof Error ? error.message : String(error),\n          stack: error instanceof Error ? error.stack : undefined\n        })\n      }\n      return null\n    }\n  }\n\nexport const updateCustomer = async (body: HttpTypes.StoreUpdateCustomer) => {\n  const headers = {\n    ...(await getAuthHeaders()),\n  }\n\n  const updateRes = await sdk.store.customer\n    .update(body, {}, headers)\n    .then(({ customer }) => customer)\n    .catch(medusaError)\n\n  const cacheTag = await getCacheTag(\"customers\")\n  revalidateTag(cacheTag)\n\n  return updateRes\n}\n\nexport async function signup(_currentState: unknown, formData: FormData) {\n  const password = formData.get(\"password\") as string\n  const customerForm = {\n    email: formData.get(\"email\") as string,\n    first_name: formData.get(\"first_name\") as string,\n    last_name: formData.get(\"last_name\") as string,\n    phone: formData.get(\"phone\") as string,\n  }\n\n  // 驗證必填欄位\n  if (!customerForm.email || !password || !customerForm.first_name || !customerForm.last_name) {\n    return \"請填寫所有必填欄位\"\n  }\n\n  // 驗證電子郵件格式\n  const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/\n  if (!emailRegex.test(customerForm.email)) {\n    return \"請輸入有效的電子郵件地址\"\n  }\n\n  // 驗證密碼強度\n  if (password.length < 6) {\n    return \"密碼長度至少需要 6 個字元\"\n  }\n\n  try {\n    console.log(\"🔐 開始傳統註冊流程:\", { email: customerForm.email })\n    \n    // 使用標準 Medusa SDK 進行註冊\n    const registerToken = await sdk.auth.register(\"customer\", \"emailpass\", {\n      email: customerForm.email,\n      password: password,\n    })\n\n    console.log(\"✅ 註冊成功，獲得 token:\", { hasToken: !!registerToken })\n\n    // 先設置註冊 token 來創建客戶資料\n    await setAuthToken(registerToken)\n\n    const headers = {\n      ...(await getAuthHeaders()),\n    }\n\n    const { customer: createdCustomer } = await sdk.store.customer.create(\n      customerForm,\n      {},\n      headers\n    )\n\n    console.log(\"✅ 客戶資料創建成功:\", { \n      customerId: createdCustomer?.id, \n      email: createdCustomer?.email \n    })\n\n    // 註冊後自動登入以獲得完整的認證狀態\n    const loginToken = await sdk.auth.login(\"customer\", \"emailpass\", {\n      email: customerForm.email,\n      password,\n    })\n\n    console.log(\"✅ 自動登入成功，設置最終 token\")\n    await setAuthToken(loginToken as string)\n\n    // 清除快取並轉移購物車\n    const customerCacheTag = await getCacheTag(\"customers\")\n    revalidateTag(customerCacheTag)\n\n    await transferCart()\n\n    console.log(\"🎉 註冊流程完成，客戶應已登入\")\n    return createdCustomer\n  } catch (error: any) {\n    console.error(\"註冊錯誤:\", error)\n    \n    // 處理註冊錯誤\n    if (error.message || error.response?.data?.message) {\n      const errorMessage = error.message || error.response.data.message\n      \n      if (errorMessage.includes('already exists') || errorMessage.includes('duplicate') || \n          errorMessage.includes('已存在') || errorMessage.includes('conflict')) {\n        return \"該電子郵件地址已被註冊，請使用其他郵件地址或嘗試登入\"\n      }\n      \n      if (errorMessage.includes('invalid email') || errorMessage.includes('email')) {\n        return \"電子郵件地址格式不正確\"\n      }\n      \n      if (errorMessage.includes('password') || errorMessage.includes('密碼')) {\n        return \"密碼不符合要求，請確保長度至少 6 個字元\"\n      }\n      \n      return errorMessage\n    }\n    \n    return \"註冊失敗，請稍後再試\"\n  }\n}\n\nexport async function login(_currentState: unknown, formData: FormData) {\n  const email = formData.get(\"email\") as string\n  const password = formData.get(\"password\") as string\n\n  // 驗證必填欄位\n  if (!email || !password) {\n    return \"請輸入電子郵件和密碼\"\n  }\n\n  // 驗證電子郵件格式\n  const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/\n  if (!emailRegex.test(email)) {\n    return \"請輸入有效的電子郵件地址\"\n  }\n\n  try {\n    // 使用標準 Medusa SDK 進行登入\n    const token = await sdk.auth.login(\"customer\", \"emailpass\", { email, password })\n    \n    await setAuthToken(typeof token === 'string' ? token : token.location)\n    \n    const customerCacheTag = await getCacheTag(\"customers\")\n    revalidateTag(customerCacheTag)\n    \n  } catch (error: any) {\n    console.error(\"登入錯誤:\", error)\n    \n    // 處理登入錯誤\n    if (error.message || error.response?.data?.message) {\n      const errorMessage = error.message || error.response.data.message\n      \n      if (errorMessage.includes('unauthorized') || errorMessage.includes('invalid credentials') ||\n          errorMessage.includes('401') || errorMessage.includes('authentication failed')) {\n        return \"電子郵件或密碼錯誤，請檢查後重試\"\n      }\n      \n      // 處理帳戶不存在的情況\n      if (errorMessage.includes('not found') || errorMessage.includes('does not exist')) {\n        return \"找不到此電子郵件的帳戶，請先註冊\"\n      }\n      \n      return errorMessage\n    }\n    \n    return \"登入失敗，請稍後再試\"\n  }\n\n  try {\n    await transferCart()\n  } catch (error: any) {\n    console.error(\"購物車轉移錯誤:\", error)\n    // 購物車轉移失敗不應該阻止登入成功\n  }\n\n  // 登入成功後重定向到 account 頁面\n  redirect(\"/tw/account\")\n}\n\nexport async function signout(countryCode: string) {\n  try {\n    console.log('🔓 開始簡單 SDK 登出')\n    \n    // 使用 Medusa SDK 的官方登出方法\n    await sdk.auth.logout()\n    console.log('✅ Medusa SDK 登出成功')\n    \n    // 清除認證令牌\n    await removeAuthToken()\n    console.log('🧹 已清除認證令牌')\n\n    // 清除購物車 ID\n    await removeCartId()\n    console.log('🛒 已清除購物車 ID')\n\n    // 重新驗證相關緩存\n    const customerCacheTag = await getCacheTag(\"customers\")\n    revalidateTag(customerCacheTag)\n    \n    const cartCacheTag = await getCacheTag(\"carts\")\n    revalidateTag(cartCacheTag)\n    \n    console.log('🔄 已重新驗證緩存')\n    \n  } catch (error) {\n    console.error('❌ SDK 登出過程中發生錯誤:', error)\n    // 即使 SDK 登出失敗，仍清除本地狀態\n    await removeAuthToken()\n    await removeCartId()\n  }\n\n  // 重定向到帳戶登入頁面\n  redirect(`/${countryCode}/account`)\n}\n\nexport async function transferCart() {\n  try {\n    const cartId = await getCartId()\n\n    if (!cartId) {\n      return\n    }\n\n    const headers = await getAuthHeaders()\n    \n    if (!headers) {\n      if (process.env.NODE_ENV === 'development') {\n        console.warn('🔐 transferCart: 無驗證 headers，跳過轉移')\n      }\n      return\n    }\n\n    await sdk.store.cart.transferCart(cartId, {}, headers)\n\n    const cartCacheTag = await getCacheTag(\"carts\")\n    revalidateTag(cartCacheTag)\n    \n    if (process.env.NODE_ENV === 'development') {\n      console.log('✅ transferCart: 購物車轉移成功')\n    }\n  } catch (error) {\n    if (process.env.NODE_ENV === 'development') {\n      console.error('❌ transferCart 失敗:', error)\n    }\n    // 不重新拋出錯誤，避免影響用戶體驗\n  }\n}\n\nexport const addCustomerAddress = async (\n  currentState: Record<string, unknown>,\n  formData: FormData\n): Promise<any> => {\n  const isDefaultBilling = (currentState.isDefaultBilling as boolean) || false\n  const isDefaultShipping = (currentState.isDefaultShipping as boolean) || false\n\n  const address = {\n    first_name: formData.get(\"first_name\") as string,\n    last_name: formData.get(\"last_name\") as string,\n    company: formData.get(\"company\") as string,\n    address_1: formData.get(\"address_1\") as string,\n    address_2: formData.get(\"address_2\") as string,\n    city: formData.get(\"city\") as string,\n    postal_code: formData.get(\"postal_code\") as string,\n    province: formData.get(\"province\") as string,\n    country_code: formData.get(\"country_code\") as string,\n    phone: formData.get(\"phone\") as string,\n    is_default_billing: isDefaultBilling,\n    is_default_shipping: isDefaultShipping,\n  }\n\n  const headers = {\n    ...(await getAuthHeaders()),\n  }\n\n  return sdk.store.customer\n    .createAddress(address, {}, headers)\n    .then(async ({ customer }) => {\n      const customerCacheTag = await getCacheTag(\"customers\")\n      revalidateTag(customerCacheTag)\n      return { success: true, error: null }\n    })\n    .catch((err) => {\n      return { success: false, error: err.toString() }\n    })\n}\n\nexport const deleteCustomerAddress = async (\n  addressId: string\n): Promise<void> => {\n  const headers = {\n    ...(await getAuthHeaders()),\n  }\n\n  await sdk.store.customer\n    .deleteAddress(addressId, headers)\n    .then(async () => {\n      const customerCacheTag = await getCacheTag(\"customers\")\n      revalidateTag(customerCacheTag)\n      return { success: true, error: null }\n    })\n    .catch((err) => {\n      return { success: false, error: err.toString() }\n    })\n}\n\nexport const updateCustomerAddress = async (\n  currentState: Record<string, unknown>,\n  formData: FormData\n): Promise<any> => {\n  const addressId =\n    (currentState.addressId as string) || (formData.get(\"addressId\") as string)\n\n  if (!addressId) {\n    return { success: false, error: \"Address ID is required\" }\n  }\n\n  const address = {\n    first_name: formData.get(\"first_name\") as string,\n    last_name: formData.get(\"last_name\") as string,\n    company: formData.get(\"company\") as string,\n    address_1: formData.get(\"address_1\") as string,\n    address_2: formData.get(\"address_2\") as string,\n    city: formData.get(\"city\") as string,\n    postal_code: formData.get(\"postal_code\") as string,\n    province: formData.get(\"province\") as string,\n    country_code: formData.get(\"country_code\") as string,\n  } as HttpTypes.StoreUpdateCustomerAddress\n\n  const phone = formData.get(\"phone\") as string\n\n  if (phone) {\n    address.phone = phone\n  }\n\n  const headers = {\n    ...(await getAuthHeaders()),\n  }\n\n  return sdk.store.customer\n    .updateAddress(addressId, address, {}, headers)\n    .then(async () => {\n      const customerCacheTag = await getCacheTag(\"customers\")\n      revalidateTag(customerCacheTag)\n      return { success: true, error: null }\n    })\n    .catch((err) => {\n      return { success: false, error: err.toString() }\n    })\n}\n\n/**\n * 確保購物車與用戶正確關聯\n * 如果轉移失敗，嘗試重新創建關聯\n */\nasync function ensureCartAssociation() {\n  const cartId = await getCartId()\n  const headers = await getAuthHeaders()\n  \n  if (!cartId || !headers) {\n    return\n  }\n\n  try {\n    // 嘗試獲取當前購物車\n    const cart = await sdk.client.fetch<{ cart: HttpTypes.StoreCart }>(`/store/carts/${cartId}`, {\n      method: \"GET\",\n      headers,\n    })\n\n    // 如果購物車已經有 customer_id，就不需要處理\n    if (cart.cart.customer_id) {\n      return\n    }\n\n    // 嘗試再次轉移購物車\n    await sdk.store.cart.transferCart(cartId, {}, headers)\n    \n    const cartCacheTag = await getCacheTag(\"carts\")\n    revalidateTag(cartCacheTag)\n    \n    console.log(\"購物車重新轉移成功\")\n  } catch (error) {\n    console.error(\"購物車重新轉移失敗:\", error)\n    // 如果還是失敗，清除本地購物車 ID，讓系統創建新的\n    await removeCartId()\n    \n    const cartCacheTag = await getCacheTag(\"carts\")\n    revalidateTag(cartCacheTag)\n    \n    console.log(\"已清除本地購物車，系統將創建新的購物車\")\n  }\n}\n\nexport async function handleGoogleCallback(token: string) {\n  try {\n    console.log(\"🔐 處理 Google 登入回調\")\n    \n    await setAuthToken(token)\n    \n    const customerCacheTag = await getCacheTag(\"customers\")\n    revalidateTag(customerCacheTag)\n    \n    await transferCart()\n    \n    console.log(\"✅ Google 登入成功\")\n    return { success: true }\n  } catch (error: any) {\n    console.error(\"❌ Google 登入回調處理失敗:\", error)\n    return { success: false, error: error.message || \"處理失敗\" }\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/data/fulfillment.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":8,"column":3,"nodeType":"MemberExpression","messageId":"unexpected","endLine":8,"endColumn":14,"suggestions":[{"fix":{"range":[222,287],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":17,"column":71,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":17,"endColumn":73,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[500,502],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":20,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":20,"endColumn":16,"suggestions":[{"fix":{"range":[610,654],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":21,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":21,"endColumn":16,"suggestions":[{"fix":{"range":[659,700],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":29,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":29,"endColumn":16,"suggestions":[{"fix":{"range":[845,910],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":33,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":33,"endColumn":20,"suggestions":[{"fix":{"range":[992,1033],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":39,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":39,"endColumn":16,"suggestions":[{"fix":{"range":[1166,1201],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":41,"column":9,"nodeType":null,"messageId":"preferOptionalChain","endLine":41,"endColumn":38,"fix":{"range":[1215,1244],"text":"data?.shipping_options"}},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":42,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":42,"endColumn":18,"suggestions":[{"fix":{"range":[1254,1360],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":45,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":45,"endColumn":18,"suggestions":[{"fix":{"range":[1415,1461],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":48,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1502,1505],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1502,1505],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":49,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":49,"endColumn":18,"suggestions":[{"fix":{"range":[1513,1568],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":85,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":85,"endColumn":14},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'e' is defined but never used. Allowed unused args must match /^_/u.","line":85,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":85,"endColumn":14}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":1,"fixableWarningCount":0,"source":"\"use server\"\n\nimport { sdk } from \"@lib/config\"\nimport { HttpTypes } from \"@medusajs/types\"\nimport { getAuthHeaders, getCacheOptions } from \"./cookies\"\n\nexport const listCartShippingMethods = async (cartId: string) => {\n  console.log(\"📞📞📞 listCartShippingMethods 被呼叫，cartId:\", cartId)\n  \n  try {\n    const headers = {\n      ...(await getAuthHeaders()),\n      'Content-Type': 'application/json',\n    }\n\n    // 使用標準 fetch 替代 SDK\n    const url = new URL(`${process.env.NEXT_PUBLIC_MEDUSA_BACKEND_URL || 'http://35.236.182.29:9000'}/store/shipping-options`)\n    url.searchParams.set('cart_id', cartId)\n    \n    console.log(\"🔗🔗🔗 請求URL:\", url.toString())\n    console.log(\"🔑🔑🔑 請求Headers:\", headers)\n    \n    const response = await fetch(url.toString(), {\n      method: \"GET\",\n      headers,\n      cache: 'no-store', // 確保不使用緩存\n    })\n    \n    console.log(\"📡📡📡 回應狀態:\", response.status, response.statusText)\n    \n    if (!response.ok) {\n      const errorText = await response.text()\n      console.error(\"❌❌❌ HTTP錯誤回應:\", errorText)\n      throw new Error(`HTTP ${response.status}: ${response.statusText}`)\n    }\n    \n    const data = await response.json()\n    \n    console.log(\"✅✅✅ 原生 API 回應:\", data)\n    \n    if (data && data.shipping_options) {\n      console.log(\"🚚🚚🚚 listCartShippingMethods 成功，收到 shipping_options:\", data.shipping_options.length, \"個選項\")\n      return data.shipping_options\n    } else {\n      console.log(\"⚠️⚠️⚠️ 沒有 shipping_options 在回應中\")\n      return []\n    }\n  } catch (error: any) {\n    console.error(\"❌❌❌ listCartShippingMethods 失敗:\", error)\n    // 不要拋出錯誤，而是返回空陣列\n    return []\n  }\n}\n\nexport const calculatePriceForShippingOption = async (\n  optionId: string,\n  cartId: string,\n  data?: Record<string, unknown>\n) => {\n  const headers = {\n    ...(await getAuthHeaders()),\n  }\n\n  const next = {\n    ...(await getCacheOptions(\"fulfillment\")),\n  }\n\n  const body = { cart_id: cartId, data }\n\n  if (data) {\n    body.data = data\n  }\n\n  return sdk.client\n    .fetch<{ shipping_option: HttpTypes.StoreCartShippingOption }>(\n      `/store/shipping-options/${optionId}/calculate`,\n      {\n        method: \"POST\",\n        body,\n        headers,\n        next,\n      }\n    )\n    .then(({ shipping_option }) => shipping_option)\n    .catch((e) => {\n      return null\n    })\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/data/google-identity.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":16,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[309,312],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[309,312],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'GoogleUserData' is defined but never used.","line":24,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":25},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'GoogleUserData' is defined but never used. Allowed unused vars must match /^_/u.","line":24,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":25},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":30,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[610,613],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[610,613],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":68,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":68,"endColumn":16,"suggestions":[{"fix":{"range":[1464,1514],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":72,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":72,"endColumn":18,"suggestions":[{"fix":{"range":[1621,1672],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":81,"column":45,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":81,"endColumn":47,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1905,1907],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":82,"column":53,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":82,"endColumn":55,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1964,1966],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":86,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":86,"endColumn":18,"suggestions":[{"fix":{"range":[2051,2124],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":87,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":87,"endColumn":18,"suggestions":[{"fix":{"range":[2131,2212],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":92,"column":33,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":92,"endColumn":35,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2332,2334],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":116,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":116,"endColumn":16,"suggestions":[{"fix":{"range":[3127,3323],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":129,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":129,"endColumn":18,"suggestions":[{"fix":{"range":[3425,3469],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":174,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":174,"endColumn":16,"suggestions":[{"fix":{"range":[4373,4407],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":179,"column":46,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":179,"endColumn":48,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[4600,4602],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":180,"column":54,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":180,"endColumn":56,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[4660,4662],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":184,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":184,"endColumn":20,"suggestions":[{"fix":{"range":[4777,4835],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":185,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":185,"endColumn":20,"suggestions":[{"fix":{"range":[4844,4916],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":186,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":186,"endColumn":20,"suggestions":[{"fix":{"range":[4925,5005],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":191,"column":35,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":191,"endColumn":37,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[5103,5105],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":216,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":216,"endColumn":16,"suggestions":[{"fix":{"range":[5967,6023],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":224,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":224,"endColumn":18,"suggestions":[{"fix":{"range":[6121,6167],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":14,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use server\"\n\nimport { pool } from '@/lib/db'\n\ninterface GoogleIdentity {\n  email: string;\n  name?: string;\n  given_name?: string;\n  family_name?: string;\n  picture?: string;\n  locale?: string;\n  verified_email?: boolean;\n  sub?: string;\n  provider_user_id?: string;\n  customer_id?: string;\n  raw_user_info?: any;  // 存儲原始的 Google 用戶資訊，以備將來使用\n  access_token?: string;\n  refresh_token?: string;\n  token_type?: string;\n  id_token?: string;\n  expires_at?: number;\n}\n\ninterface GoogleUserData {\n  email?: string;\n  name?: string;\n  given_name?: string;\n  family_name?: string;\n  picture?: string;\n  [key: string]: any;\n}\n\ninterface GoogleIdentityResult {\n  success: boolean;\n  data?: GoogleIdentity;\n  error?: string;\n}\n\n/**\n * 從數據庫中獲取 Google OAuth 用戶資料\n * \n * @param customerId Medusa 客戶 ID\n * @returns Google 用戶資料結果\n */\nexport async function getGoogleIdentityByCustomerId(\n  customerId: string\n): Promise<GoogleIdentityResult> {\n  let client;\n  try {\n    // 連接到資料庫\n    client = await pool.connect()\n    \n          // 查詢客戶關聯的 Google 身份資料\n      const query = `\n        SELECT \n          pi.id,\n          pi.entity_id as provider_user_id,\n          pi.user_metadata,\n          pi.provider_metadata,\n          ai.app_metadata\n        FROM auth_identity ai \n        JOIN provider_identity pi ON ai.id = pi.auth_identity_id\n        WHERE ai.app_metadata->>'customer_id' = $1 AND pi.provider = 'google'\n        ORDER BY pi.created_at DESC \n        LIMIT 1\n      `\n    \n    console.log(`🔍 查詢客戶 ${customerId} 的 Google 身份資料`)\n    const result = await client.query(query, [customerId])\n    \n    if (result.rows.length === 0) {\n      console.log(`⚠️ 未找到客戶 ${customerId} 的 Google 身份資料`)\n      return {\n        success: false,\n        error: `未找到客戶 ${customerId} 的 Google 身份資料`\n      }\n    }\n    \n    const data = result.rows[0]\n    // 在 Medusa v2 中，user_metadata 已經是 JSON 對象\n    const userMetadata = data.user_metadata || {};\n    const providerMetadata = data.provider_metadata || {};\n    \n    // 只在開發環境中記錄數據\n    if (process.env.NODE_ENV === 'development') {\n      console.log(\"完整的 user_metadata:\", JSON.stringify(userMetadata, null, 2));\n      console.log(\"完整的 provider_metadata:\", JSON.stringify(providerMetadata, null, 2));\n    }\n    \n    const googleIdentity: GoogleIdentity = {\n      // 從 user_metadata 中提取資訊\n      email: userMetadata.email || '',\n      name: userMetadata.name,\n      given_name: userMetadata.given_name,\n      family_name: userMetadata.family_name,\n      picture: userMetadata.picture,\n      locale: userMetadata.locale,\n      verified_email: userMetadata.verified_email,\n      sub: userMetadata.sub,\n      \n      // Medusa 資料庫相關欄位\n      provider_user_id: data.entity_id, // entity_id 是 Medusa v2 的欄位\n      customer_id: data.app_metadata?.customer_id,\n      \n      // 來自 provider_metadata 的可能資料\n      access_token: providerMetadata.access_token,\n      refresh_token: providerMetadata.refresh_token,\n      token_type: providerMetadata.token_type,\n      id_token: providerMetadata.id_token,\n      expires_at: providerMetadata.expires_at,\n      \n      // 儲存完整的原始資料，以備將來使用\n      raw_user_info: userMetadata\n    }\n    \n    console.log(`✅ 成功獲取 Google 身份資料:`, {\n      hasEmail: !!googleIdentity.email,\n      hasName: !!googleIdentity.name,\n      email: googleIdentity.email,\n      providerId: data.provider_user_id\n    })\n    \n    return {\n      success: true,\n      data: googleIdentity\n    }\n    \n  } catch (error) {\n    console.error('❌ 獲取 Google 身份資料時出錯:', error)\n    return {\n      success: false,\n      error: `數據庫查詢失敗: ${error instanceof Error ? error.message : String(error)}`\n    }\n  } finally {\n    // 釋放客戶端連接\n    if (client) client.release()\n  }\n}\n\n/**\n * 獲取所有 Google OAuth 身份資料\n * \n * @returns 所有 Google 身份資料結果\n */\nexport async function getAllGoogleIdentities(): Promise<{\n  success: boolean;\n  data?: GoogleIdentity[];\n  error?: string;\n}> {\n  let client;\n  try {\n    // 連接到資料庫\n    client = await pool.connect()\n    \n    // 查詢所有 Google 身份資料\n    const query = `\n      SELECT \n        pi.id,\n        pi.provider,\n        pi.entity_id as provider_user_id,\n        pi.user_metadata,\n        pi.provider_metadata,\n        ai.app_metadata\n      FROM \n        public.auth_identity ai\n      JOIN \n        public.provider_identity pi ON ai.id = pi.auth_identity_id\n      WHERE \n        pi.provider = 'google'\n      ORDER BY \n        pi.created_at DESC\n    `\n    \n    console.log('🔍 查詢所有 Google 身份資料')\n    const result = await client.query(query)\n    \n    const identities = result.rows.map(row => {\n      // 在 Medusa v2 中，user_metadata 已經是 JSON 對象\n      const userMetadata = row.user_metadata || {};\n      const providerMetadata = row.provider_metadata || {};\n      \n      // 只在開發環境中記錄數據\n      if (process.env.NODE_ENV === 'development' && userMetadata.email) {\n        console.log(`✅ 找到 Google 帳戶 ${userMetadata.email} 的詳細資料`);\n        console.log(\"user_metadata 範例:\", JSON.stringify(userMetadata, null, 2));\n        console.log(\"provider_metadata 範例:\", JSON.stringify(providerMetadata, null, 2));\n      }\n      \n      return {\n        // 從 user_metadata 中提取資訊\n        email: userMetadata.email || '',\n        name: userMetadata.name,\n        given_name: userMetadata.given_name,\n        family_name: userMetadata.family_name,\n        picture: userMetadata.picture,\n        locale: userMetadata.locale,\n        verified_email: userMetadata.verified_email,\n        sub: userMetadata.sub,\n        \n        // Medusa 資料庫相關欄位\n        provider_user_id: row.entity_id, // entity_id 是 Medusa v2 的欄位\n        customer_id: row.app_metadata?.customer_id,\n        \n        // 來自 provider_metadata 的可能資料\n        access_token: providerMetadata.access_token,\n        refresh_token: providerMetadata.refresh_token,\n        token_type: providerMetadata.token_type,\n        id_token: providerMetadata.id_token,\n        expires_at: providerMetadata.expires_at,\n        \n        // 儲存完整的原始資料，以備將來使用\n        raw_user_info: userMetadata\n      } as GoogleIdentity;\n    });\n    \n    console.log(`✅ 成功獲取 ${identities.length} 筆 Google 身份資料`)\n    \n    return {\n      success: true,\n      data: identities\n    }\n    \n  } catch (error) {\n    console.error('❌ 獲取所有 Google 身份資料時出錯:', error)\n    return {\n      success: false,\n      error: `數據庫查詢失敗: ${error instanceof Error ? error.message : String(error)}`\n    }\n  } finally {\n    // 釋放客戶端連接\n    if (client) client.release()\n  }\n}","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/data/onboarding.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/data/orders-client.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":6,"column":3,"nodeType":"MemberExpression","messageId":"unexpected","endLine":6,"endColumn":14,"suggestions":[{"fix":{"range":[151,200],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":18,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":18,"endColumn":20,"suggestions":[{"fix":{"range":[443,499],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":23,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":23,"endColumn":16,"suggestions":[{"fix":{"range":[630,680],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":25,"column":23,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":25,"endColumn":25,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[708,710],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":27,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":27,"endColumn":18,"suggestions":[{"fix":{"range":[740,789],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { HttpTypes } from \"@medusajs/types\"\n\nexport const retrieveOrderClient = async (id: string): Promise<HttpTypes.StoreOrder> => {\n  console.log(\"🔍 retrieveOrderClient 開始獲取訂單:\", id)\n  \n  try {\n    const response = await fetch(`/api/orders/${id}`, {\n      method: \"GET\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n    })\n\n    if (!response.ok) {\n      const errorText = await response.text()\n      console.error(\"❌ API 響應錯誤:\", response.status, errorText)\n      throw new Error(`Failed to fetch order: ${response.status} ${errorText}`)\n    }\n\n    const data = await response.json()\n    console.log(\"✅ retrieveOrderClient 成功獲取訂單:\", data)\n    \n    return data.order || data\n  } catch (error) {\n    console.error(\"❌ retrieveOrderClient 錯誤:\", error)\n    throw error\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/data/orders.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":35,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[860,863],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[860,863],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use server\"\n\nimport { sdk } from \"@lib/config\"\nimport medusaError from \"@lib/util/medusa-error\"\nimport { HttpTypes } from \"@medusajs/types\"\nimport { getAuthHeaders, getCacheOptions } from \"./cookies\"\n\nexport const retrieveOrder = async (id: string) => {\n  const headers = {\n    ...(await getAuthHeaders()),\n  }\n\n  const next = {\n    ...(await getCacheOptions(\"orders\")),\n  }\n\n  return sdk.client\n    .fetch<HttpTypes.StoreOrderResponse>(`/store/orders/${id}`, {\n      method: \"GET\",\n      query: {\n        fields:\n          \"*payment_collections.payments,*items,*items.metadata,*items.variant,*items.product\",\n      },\n      headers,\n      next,\n      cache: \"force-cache\",\n    })\n    .then(({ order }) => order)\n    .catch((err) => medusaError(err))\n}\n\nexport const listOrders = async (\n  limit: number = 10,\n  offset: number = 0,\n  filters?: Record<string, any>\n) => {\n\n\n  const headers = {\n    ...(await getAuthHeaders()),\n  }\n\n  const next = {\n    ...(await getCacheOptions(\"orders\")),\n  }\n\n  return sdk.client\n    .fetch<HttpTypes.StoreOrderListResponse>(`/store/orders`, {\n      method: \"GET\",\n      query: {\n        limit,\n        offset,\n        order: \"-created_at\",\n        fields: \"*items,+items.metadata,*items.variant,*items.product\",\n        ...filters,\n      },\n      headers,\n      next,\n      cache: \"force-cache\",\n    })\n    .then(({ orders }) => orders)\n    .catch((err) => medusaError(err))\n}\n\nexport const createTransferRequest = async (\n  state: {\n    success: boolean\n    error: string | null\n    order: HttpTypes.StoreOrder | null\n  },\n  formData: FormData\n): Promise<{\n  success: boolean\n  error: string | null\n  order: HttpTypes.StoreOrder | null\n}> => {\n  const id = formData.get(\"order_id\") as string\n\n  if (!id) {\n    return { success: false, error: \"Order ID is required\", order: null }\n  }\n\n  const headers = await getAuthHeaders()\n\n  return await sdk.store.order\n    .requestTransfer(\n      id,\n      {},\n      {\n        fields: \"id, email\",\n      },\n      headers\n    )\n    .then(({ order }) => ({ success: true, error: null, order }))\n    .catch((err) => ({ success: false, error: err.message, order: null }))\n}\n\nexport const acceptTransferRequest = async (id: string, token: string) => {\n  const headers = await getAuthHeaders()\n\n  return await sdk.store.order\n    .acceptTransfer(id, { token }, {}, headers)\n    .then(({ order }) => ({ success: true, error: null, order }))\n    .catch((err) => ({ success: false, error: err.message, order: null }))\n}\n\nexport const declineTransferRequest = async (id: string, token: string) => {\n  const headers = await getAuthHeaders()\n\n  return await sdk.store.order\n    .declineTransfer(id, { token }, {}, headers)\n    .then(({ order }) => ({ success: true, error: null, order }))\n    .catch((err) => ({ success: false, error: err.message, order: null }))\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/data/payment.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/data/products.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'getAuthHeaders' is defined but never used.","line":9,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":24},{"ruleId":"unused-imports/no-unused-imports","severity":2,"message":"'getAuthHeaders' is defined but never used.","line":9,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":24,"fix":{"range":[386,402],"text":""}},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'getCacheOptions' is defined but never used.","line":9,"column":26,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":41},{"ruleId":"unused-imports/no-unused-imports","severity":2,"message":"'getCacheOptions' is defined but never used.","line":9,"column":26,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":41,"fix":{"range":[401,418],"text":""}},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":49,"column":36,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":49,"endColumn":38,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1573,1575],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":101,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":101,"endColumn":20,"suggestions":[{"fix":{"range":[2950,2983],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":126,"column":36,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":126,"endColumn":38,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3713,3715],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":261,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":261,"endColumn":20,"suggestions":[{"fix":{"range":[6669,6702],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":2,"fixableWarningCount":0,"source":"\"use server\"\n\nimport { sdk, MEDUSA_BACKEND_URL } from \"../config\"\nimport medusaError from \"../util/medusa-error\"\nimport { getPublishableKeyForBackend } from \"../medusa-publishable-key\"\nimport { sortProducts } from \"../util/sort-products\"\nimport { HttpTypes } from \"@medusajs/types\"\nimport type { SortOptions } from \"../../modules/store/components/refinement-list/sort-products\"\nimport { getAuthHeaders, getCacheOptions } from \"./cookies\"\nimport { getRegion, retrieveRegion } from \"./regions\"\n\n// 產品查詢快取配置\nconst PRODUCTS_CACHE_CONFIG = {\n  revalidate: 300, // 5分鐘 server-side 快取\n  tags: ['products', 'store-products']\n}\n\n// 優化的欄位選擇 - 只獲取必要欄位以提升效能\nconst ESSENTIAL_PRODUCT_FIELDS = [\n  \"id\", \"title\", \"handle\", \"description\", \"status\", \"thumbnail\",\n  \"images\", \"options\", \"variants\", \"type\", \"collection\", \"tags\",\n  \"metadata\", \"created_at\", \"updated_at\"\n].join(\",\")\n\nconst VARIANT_FIELDS = [\n  \"id\", \"title\", \"sku\", \"barcode\", \"inventory_quantity\", \n  \"allow_backorder\", \"manage_inventory\", \"prices\", \"options\"\n].join(\",\")\n\nexport const listProducts = async ({\n  pageParam = 1,\n  queryParams,\n  countryCode,\n  regionId,\n}: {\n  pageParam?: number\n  queryParams?: HttpTypes.FindParams & HttpTypes.StoreProductParams\n  countryCode?: string\n  regionId?: string\n}): Promise<{\n  response: { products: HttpTypes.StoreProduct[]; count: number }\n  nextPage: number | null\n  queryParams?: HttpTypes.FindParams & HttpTypes.StoreProductParams\n}> => {\n  if (!countryCode && !regionId) {\n    throw new Error(\"Country code or region ID is required\")\n  }\n\n  const limit = queryParams?.limit || 12\n  const _pageParam = Math.max(pageParam, 1)\n  const offset = (_pageParam - 1) * limit\n\n  const region = regionId\n    ? await retrieveRegion(regionId)\n    : countryCode\n    ? await getRegion(countryCode)\n    : null\n\n  if (!region) {\n    throw new Error(\"Could not find region\")\n  }\n\n  // 優化查詢參數 - 只請求必要欄位\n  const optimizedQuery = {\n    ...queryParams,\n    limit,\n    offset,\n    region_id: region.id,\n    fields: `${ESSENTIAL_PRODUCT_FIELDS},*variants.${VARIANT_FIELDS}`,\n    // 啟用後端快取\n    // expand: \"variants,variants.prices,options,options.values,collection,type\", // 暫時移除 expand 參數以修復錯誤\n  }\n\n  return sdk.client\n    .fetch<{ products: HttpTypes.StoreProduct[]; count: number }>(`/store/products`, {\n      method: \"GET\",\n      query: optimizedQuery,\n      headers: {\n        \"x-publishable-api-key\": getPublishableKeyForBackend(MEDUSA_BACKEND_URL),\n        \"Cache-Control\": \"public, max-age=300\", // 5分鐘瀏覽器快取\n      },\n      next: { \n        revalidate: PRODUCTS_CACHE_CONFIG.revalidate,\n        tags: PRODUCTS_CACHE_CONFIG.tags \n      },\n      cache: \"force-cache\", // 改用快取優先策略\n    })\n    .then(({ products, count }) => {\n      const nextPage = count > offset + limit ? pageParam + 1 : null\n\n      return {\n        response: {\n          products,\n          count,\n        },\n        nextPage: nextPage,\n        queryParams,\n      }\n    })\n    .catch((error) => {\n      console.error(\"產品列表獲取失敗:\", error)\n      throw medusaError(error)\n    })\n}\n\n/**\n * This will fetch 100 products and sort them based on the sortBy parameter.\n * It will then return the paginated products based on the page and limit parameters.\n * No caching is used to ensure data is always fresh.\n */\nexport const listProductsWithSort = async ({\n  page = 0,\n  queryParams,\n  sortBy = \"created_at\",\n  countryCode,\n}: {\n  page?: number\n  queryParams?: HttpTypes.FindParams & HttpTypes.StoreProductParams\n  sortBy?: SortOptions\n  countryCode: string\n}): Promise<{\n  response: { products: HttpTypes.StoreProduct[]; count: number }\n  nextPage: number | null\n  queryParams?: HttpTypes.FindParams & HttpTypes.StoreProductParams\n}> => {\n  const limit = queryParams?.limit || 12\n\n  const {\n    response: { products, count },\n  } = await listProducts({\n    pageParam: 0,\n    queryParams: {\n      ...queryParams,\n      limit: 100,\n    },\n    countryCode,\n  })\n\n  const sortedProducts = sortProducts(products, sortBy)\n\n  const pageParam = (page - 1) * limit\n\n  const nextPage = count > pageParam + limit ? pageParam + limit : null\n\n  const paginatedProducts = sortedProducts.slice(pageParam, pageParam + limit)\n\n  return {\n    response: {\n      products: paginatedProducts,\n      count,\n    },\n    nextPage,\n    queryParams,\n  }\n}\n\n/**\n * 獲取單一產品的詳細資訊，並確保包含庫存資訊\n */\nexport const getProduct = async ({\n  handle,\n  countryCode,\n  regionId,\n}: {\n  handle: string\n  countryCode?: string\n  regionId?: string\n}): Promise<HttpTypes.StoreProduct> => {\n  if (!countryCode && !regionId) {\n    throw new Error(\"Country code or region ID is required\")\n  }\n\n  const region = regionId\n    ? await retrieveRegion(regionId)\n    : countryCode\n    ? await getRegion(countryCode)\n    : null\n\n  if (!region) {\n    throw new Error(\"Could not find region\")\n  }\n\n  return sdk.client\n    .fetch<{ products: HttpTypes.StoreProduct[] }>(`/store/products`, {\n      method: \"GET\",\n      query: {\n        handle,\n        region_id: region.id,\n        fields: \"*options.values,*variants.options.option,+variants.inventory_quantity,+metadata\",\n      },\n      headers: {\n        \"x-publishable-api-key\": getPublishableKeyForBackend(MEDUSA_BACKEND_URL),\n      },\n      next: { revalidate: 0 },\n      cache: \"no-store\",\n    })\n    .then(({ products }) => {\n      if (products.length === 0) {\n        throw new Error(`Product with handle: ${handle} was not found`);\n      }\n      return products[0];\n    })\n}\n\n/**\n * 批量產品獲取 - 用於相關產品等場景\n */\nexport const getProductsByIds = async ({\n  productIds,\n  regionId,\n  countryCode,\n  limit = 50,\n}: {\n  productIds: string[]\n  regionId?: string\n  countryCode?: string\n  limit?: number\n}): Promise<HttpTypes.StoreProduct[]> => {\n  if (!countryCode && !regionId) {\n    throw new Error(\"Country code or region ID is required\")\n  }\n\n  if (productIds.length === 0) {\n    return []\n  }\n\n  const region = regionId\n    ? await retrieveRegion(regionId)\n    : countryCode\n    ? await getRegion(countryCode)\n    : null\n\n  if (!region) {\n    throw new Error(\"Could not find region\")\n  }\n\n  // 批量查詢優化\n  const batchQuery = {\n    id: productIds.slice(0, limit), // 限制批量大小\n    region_id: region.id,\n    fields: ESSENTIAL_PRODUCT_FIELDS,\n    limit,\n  }\n\n  return sdk.client\n    .fetch<{ products: HttpTypes.StoreProduct[] }>(`/store/products`, {\n      method: \"GET\",\n      query: batchQuery,\n      headers: {\n        \"x-publishable-api-key\": getPublishableKeyForBackend(MEDUSA_BACKEND_URL),\n        \"Cache-Control\": \"public, max-age=300\",\n      },\n      next: { \n        revalidate: 300,\n        tags: ['products', 'batch-products'] \n      },\n      cache: \"force-cache\",\n    })\n    .then(({ products }) => products)\n    .catch((error) => {\n      console.error(\"批量產品獲取失敗:\", error)\n      throw medusaError(error)\n    })\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/data/promotions.ts","messages":[{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":45,"column":9,"nodeType":null,"messageId":"preferOptionalChain","endLine":45,"endColumn":59,"fix":{"range":[1034,1084],"text":"!product.product?.variants?.[0]"}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":52,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":52,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1236,1239],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1236,1239],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":73,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1920,1923],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1920,1923],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":85,"column":44,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":85,"endColumn":46,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2623,2625],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":86,"column":47,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":86,"endColumn":49,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2678,2680],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":88,"column":38,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":88,"endColumn":40,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2795,2836],"text":"(metadata.buy_x_get_y ?? metadata.buyXGetY)"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":88,"column":59,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":88,"endColumn":61,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2837,2839],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":93,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":93,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3003,3006],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3003,3006],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":93,"column":89,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":93,"endColumn":91,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3036,3038],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":97,"column":36,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":97,"endColumn":38,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3115,3163],"text":"(promotionData.isNew ?? tagValues.includes(\"new\"))"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":97,"column":65,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":97,"endColumn":67,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3164,3166],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":98,"column":36,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":98,"endColumn":38,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3208,3256],"text":"(promotionData.isHot ?? tagValues.includes(\"hot\"))"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":98,"column":65,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":98,"endColumn":67,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3257,3259],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":99,"column":44,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":99,"endColumn":46,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3305,3361],"text":"(promotionData.isLimited ?? tagValues.includes(\"limited\"))"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":99,"column":77,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":99,"endColumn":79,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3362,3364],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":100,"column":50,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":100,"endColumn":52,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3413,3475],"text":"(promotionData.isBestseller ?? tagValues.includes(\"bestseller\"))"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":100,"column":86,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":100,"endColumn":88,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3476,3478],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":101,"column":46,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":101,"endColumn":48,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3525,3583],"text":"(promotionData.isFeatured ?? tagValues.includes(\"featured\"))"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":101,"column":80,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":101,"endColumn":82,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3584,3586],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":102,"column":50,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":102,"endColumn":52,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3635,3697],"text":"(promotionData.hasFlashSale ?? tagValues.includes(\"flash-sale\"))"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":102,"column":86,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":102,"endColumn":88,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3698,3700],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":103,"column":48,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":103,"endColumn":50,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3750,3810],"text":"(promotionData.isExclusive ?? tagValues.includes(\"exclusive\"))"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":103,"column":83,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":103,"endColumn":85,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3811,3813],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":118,"column":49,"nodeType":"MemberExpression","messageId":"unexpected","endLine":118,"endColumn":62},{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":148,"column":9,"nodeType":null,"messageId":"preferOptionalChain","endLine":148,"endColumn":59,"fix":{"range":[4876,4926],"text":"!product.product?.variants?.[0]"}},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":156,"column":45,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":156,"endColumn":47,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[5155,5157],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":161,"column":49,"nodeType":"MemberExpression","messageId":"unexpected","endLine":161,"endColumn":62}],"suppressedMessages":[],"errorCount":22,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":2,"fixableWarningCount":0,"source":"\"use server\"\n\nimport { sdk } from \"@lib/config\"\nimport { HttpTypes } from \"@medusajs/types\"\nimport { getAuthHeaders, getCacheOptions } from \"./cookies\"\n\n/**\n * 從 Medusa API 獲取產品的促銷信息\n */\nexport const getProductPromotions = async (\n  productId: string,\n  regionId: string\n): Promise<{\n  discountPercentage?: number\n  originalPrice?: number\n  discountedPrice?: number\n  hasFlashSale?: boolean\n  isNew?: boolean\n  isHot?: boolean\n  isLimited?: boolean\n  isBestseller?: boolean\n  isFeatured?: boolean\n  isOnSale?: boolean\n  specialEvent?: string\n  bundleDiscount?: number\n  isExclusive?: boolean\n  hasDiscountCode?: string\n  buyXGetY?: string | boolean\n}> => {\n  try {\n    // 獲取產品詳細信息包含價格\n    const authHeaders = await getAuthHeaders()\n    const product = await sdk.client.fetch<{ product: HttpTypes.StoreProduct }>(\n      `/store/products/${productId}`,\n      {\n        method: \"GET\",\n        query: {\n          region_id: regionId,\n        },\n        headers: authHeaders,\n        ...getCacheOptions(\"products\"),\n      }\n    )\n\n    if (!product.product || !product.product.variants?.[0]) {\n      return {}\n    }\n\n    const variant = product.product.variants[0]\n    const calculatedPrice = variant.calculated_price\n\n    let promotionData: any = {}\n\n    // 檢查價格差異來判斷是否有折扣\n    if (calculatedPrice) {\n      const originalAmount = calculatedPrice.original_amount\n      const calculatedAmount = calculatedPrice.calculated_amount\n\n      if (originalAmount && calculatedAmount && originalAmount > calculatedAmount) {\n        const discountPercentage = Math.round(\n          ((originalAmount - calculatedAmount) / originalAmount) * 100\n        )\n        promotionData = {\n          discountPercentage,\n          originalPrice: originalAmount,\n          discountedPrice: calculatedAmount,\n          isOnSale: true,\n        }\n      }\n    }\n\n    // 檢查產品 metadata 中的促銷標籤\n    const metadata = product.product.metadata as Record<string, any> || {}\n    \n    // 從 metadata 中提取促銷標籤\n    promotionData = {\n      ...promotionData,\n      isNew: metadata.is_new === true || metadata.is_new === \"true\",\n      isHot: metadata.is_hot === true || metadata.is_hot === \"true\",\n      isLimited: metadata.is_limited === true || metadata.is_limited === \"true\",\n      isBestseller: metadata.is_bestseller === true || metadata.is_bestseller === \"true\",\n      isFeatured: metadata.is_featured === true || metadata.is_featured === \"true\",\n      hasFlashSale: metadata.has_flash_sale === true || metadata.has_flash_sale === \"true\",\n      isExclusive: metadata.is_exclusive === true || metadata.is_exclusive === \"true\",\n      specialEvent: metadata.special_event || null,\n      hasDiscountCode: metadata.discount_code || null,\n      bundleDiscount: metadata.bundle_discount ? parseInt(metadata.bundle_discount) : null,\n      buyXGetY: metadata.buy_x_get_y || metadata.buyXGetY || null,\n    }\n\n    // 檢查產品標籤 (tags) 中的促銷信息\n    if (product.product.tags && product.product.tags.length > 0) {\n      const tagValues = product.product.tags.map((tag: any) => tag.value?.toLowerCase() || \"\")\n      \n      promotionData = {\n        ...promotionData,\n        isNew: promotionData.isNew || tagValues.includes(\"new\") || tagValues.includes(\"新品\"),\n        isHot: promotionData.isHot || tagValues.includes(\"hot\") || tagValues.includes(\"熱銷\"),\n        isLimited: promotionData.isLimited || tagValues.includes(\"limited\") || tagValues.includes(\"限量\"),\n        isBestseller: promotionData.isBestseller || tagValues.includes(\"bestseller\") || tagValues.includes(\"暢銷\"),\n        isFeatured: promotionData.isFeatured || tagValues.includes(\"featured\") || tagValues.includes(\"精選\"),\n        hasFlashSale: promotionData.hasFlashSale || tagValues.includes(\"flash-sale\") || tagValues.includes(\"限時搶購\"),\n        isExclusive: promotionData.isExclusive || tagValues.includes(\"exclusive\") || tagValues.includes(\"獨家\"),\n      }\n    }\n\n    // 檢查收藏 (collection) 來判斷是否為精選商品\n    if (product.product.collection) {\n      const collectionHandle = product.product.collection.handle?.toLowerCase()\n      if (collectionHandle === \"featured\" || collectionHandle === \"精選\") {\n        promotionData.isFeatured = true\n      }\n    }\n\n    return promotionData\n\n  } catch (error) {\n    if (process.env.NODE_ENV === 'development') console.error(\"Error fetching product promotions:\", error)\n    return {}\n  }\n}\n\n/**\n * 檢查產品庫存狀態\n */\nexport const getProductInventoryStatus = async (\n  productId: string,\n  regionId: string\n): Promise<{\n  isOutOfStock: boolean\n  canBackorder: boolean\n  inventoryQuantity?: number\n}> => {\n  try {\n    const authHeaders = await getAuthHeaders()\n    const product = await sdk.client.fetch<{ product: HttpTypes.StoreProduct }>(\n      `/store/products/${productId}`,\n      {\n        method: \"GET\",\n        query: {\n          region_id: regionId,\n        },\n        headers: authHeaders,\n        ...getCacheOptions(\"products\"),\n      }\n    )\n\n    if (!product.product || !product.product.variants?.[0]) {\n      return { isOutOfStock: false, canBackorder: false }\n    }\n\n    const variant = product.product.variants[0]\n    \n    return {\n      isOutOfStock: false, // TODO: 根據實際庫存 API 實現\n      canBackorder: variant.allow_backorder || false,\n      inventoryQuantity: undefined, // TODO: 如果有庫存 API 可以添加\n    }\n\n  } catch (error) {\n    if (process.env.NODE_ENV === 'development') console.error(\"Error fetching inventory status:\", error)\n    return { isOutOfStock: false, canBackorder: false }\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/data/recommendations.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'countryCode' is assigned a value but never used.","line":7,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":14},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'countryCode' is assigned a value but never used. Allowed unused args must match /^_/u.","line":7,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":14},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":25,"column":49,"nodeType":"MemberExpression","messageId":"unexpected","endLine":25,"endColumn":62},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'countryCode' is assigned a value but never used.","line":33,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":33,"endColumn":14},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'countryCode' is assigned a value but never used. Allowed unused args must match /^_/u.","line":33,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":33,"endColumn":14},{"ruleId":"sonarjs/prefer-immediate-return","severity":2,"message":"Immediately return this expression instead of assigning it to the temporary variable \"filteredProducts\".","line":50,"column":30,"nodeType":"CallExpression","messageId":"doImmediateAction","endLine":52,"endColumn":23,"fix":{"range":[1287,1474],"text":"return (response.products || [])\n      .filter((product: HttpTypes.StoreProduct) => !productIds.includes(product.id))\n      .slice(0, limit)"}},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":56,"column":49,"nodeType":"MemberExpression","messageId":"unexpected","endLine":56,"endColumn":62}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import { HttpTypes } from \"@medusajs/types\"\nimport { sdk } from \"@lib/config\"\nimport { getCacheOptions } from \"./cookies\"\n\nexport const getFeaturedProducts = async (\n  limit: number = 4,\n  countryCode: string = \"tw\"\n): Promise<HttpTypes.StoreProduct[]> => {\n  try {\n    const next = {\n      ...(await getCacheOptions(\"featured-products\")),\n    }\n\n    const response = await sdk.client.fetch<{ products: HttpTypes.StoreProduct[] }>(\n      `/store/products?limit=${limit}&fields=*variants.prices`,\n      {\n        method: \"GET\",\n        next,\n        cache: \"force-cache\",\n      }\n    )\n\n    return response.products || []\n  } catch (error) {\n    if (process.env.NODE_ENV === 'development') console.error(\"Error fetching featured products:\", error)\n    return []\n  }\n}\n\nexport const getRelatedProducts = async (\n  productIds: string[],\n  limit: number = 4,\n  countryCode: string = \"tw\"\n): Promise<HttpTypes.StoreProduct[]> => {\n  try {\n    const next = {\n      ...(await getCacheOptions(\"related-products\")),\n    }\n\n    // 獲取購物車中不包含的商品\n    const response = await sdk.client.fetch<{ products: HttpTypes.StoreProduct[] }>(\n      `/store/products?limit=${limit + productIds.length}&fields=*variants.prices`,\n      {\n        method: \"GET\",\n        next,\n      }\n    )\n\n    // 過濾掉購物車中已有的商品\n    const filteredProducts = (response.products || [])\n      .filter((product: HttpTypes.StoreProduct) => !productIds.includes(product.id))\n      .slice(0, limit)\n\n    return filteredProducts\n  } catch (error) {\n    if (process.env.NODE_ENV === 'development') console.error(\"Error fetching related products:\", error)\n    return []\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/data/regions.ts","messages":[{"ruleId":"sonarjs/cognitive-complexity","severity":2,"message":"Refactor this function to reduce its Cognitive Complexity from 20 to the 15 allowed.","line":47,"column":54,"nodeType":null,"messageId":"refactorFunction","endLine":47,"endColumn":56},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":60,"column":66,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":60,"endColumn":68,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1564,1566],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":71,"column":51,"nodeType":"MemberExpression","messageId":"unexpected","endLine":71,"endColumn":62},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":83,"column":53,"nodeType":"MemberExpression","messageId":"unexpected","endLine":83,"endColumn":64},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":90,"column":51,"nodeType":"MemberExpression","messageId":"unexpected","endLine":90,"endColumn":62},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":96,"column":51,"nodeType":"MemberExpression","messageId":"unexpected","endLine":96,"endColumn":62},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":102,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":102,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2911,2914],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2911,2914],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":103,"column":49,"nodeType":"MemberExpression","messageId":"unexpected","endLine":103,"endColumn":62}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use server\"\n\nimport { sdk, MEDUSA_BACKEND_URL } from \"../config\"\nimport { getPublishableKeyForBackend } from \"../medusa-publishable-key\"\nimport medusaError from \"../util/medusa-error\"\nimport { HttpTypes } from \"@medusajs/types\"\nimport { getCacheOptions } from \"./cookies\"\n\nexport const listRegions = async () => {\n  const next = {\n    ...(await getCacheOptions(\"regions\")),\n  }\n\n  return sdk.client\n    .fetch<{ regions: HttpTypes.StoreRegion[] }>(`/store/regions`, {\n      method: \"GET\",\n      next,\n      cache: \"force-cache\",\n      headers: {\n        \"x-publishable-api-key\": getPublishableKeyForBackend(MEDUSA_BACKEND_URL),\n      },\n    })\n    .then(({ regions }) => regions)\n    .catch(medusaError)\n}\n\nexport const retrieveRegion = async (id: string) => {\n  const next = {\n    ...(await getCacheOptions([\"regions\", id].join(\"-\"))),\n  }\n\n  return sdk.client\n    .fetch<{ region: HttpTypes.StoreRegion }>(`/store/regions/${id}`, {\n      method: \"GET\",\n      next,\n      cache: \"force-cache\",\n      headers: {\n        \"x-publishable-api-key\": getPublishableKeyForBackend(MEDUSA_BACKEND_URL),\n      },\n    })\n    .then(({ region }) => region)\n    .catch(medusaError)\n}\n\nconst regionMap = new Map<string, HttpTypes.StoreRegion>()\n\nexport const getRegion = async (countryCode: string) => {\n  try {\n    if (regionMap.has(countryCode)) {\n      return regionMap.get(countryCode)\n    }\n\n    const regions = await listRegions()\n\n    if (!regions) {\n      return null\n    }\n\n    // 從環境變數取得預設地區，如果沒有則使用 tw\n    const defaultRegion = process.env.NEXT_PUBLIC_DEFAULT_REGION || \"tw\"\n\n    // 先嘗試使用 countries 資料建立映射\n    regions.forEach((region) => {\n      region.countries?.forEach((c) => {\n        regionMap.set(c?.iso_2 ?? \"\", region)\n      })\n    })\n\n    // 如果找到了基於 ISO 代碼的對應，直接返回\n    if (regionMap.has(countryCode)) {\n      if (process.env.NODE_ENV === 'development') console.log(`✅ 找到地區映射: ${countryCode} -> ${regionMap.get(countryCode)?.name}`)\n      return regionMap.get(countryCode)\n    }\n\n    // 如果沒有找到，嘗試從環境變數獲取特定地區 ID\n    const regionIdKey = `NEXT_PUBLIC_REGION_${countryCode.toUpperCase()}`\n    const regionId = process.env[regionIdKey]\n    \n    if (regionId) {\n      const region = regions.find(r => r.id === regionId)\n      if (region) {\n        regionMap.set(countryCode, region)\n        if (process.env.NODE_ENV === 'development') console.log(`✅ 透過環境變數找到地區: ${countryCode} -> ${region.name} (${regionId})`)\n        return region\n      }\n    }\n\n    // 如果沒有找到，嘗試使用預設地區\n    if (regionMap.has(defaultRegion)) {\n      if (process.env.NODE_ENV === 'development') console.log(`⚠️  使用預設地區: ${defaultRegion} -> ${regionMap.get(defaultRegion)?.name}`)\n      return regionMap.get(defaultRegion)\n    }\n\n    // 最後的備用方案：返回第一個可用的地區\n    if (regions.length > 0) {\n      if (process.env.NODE_ENV === 'development') console.log(`⚠️  使用第一個可用地區: ${regions[0].name}`)\n      return regions[0]\n    }\n\n    return null\n\n  } catch (e: any) {\n    if (process.env.NODE_ENV === 'development') console.error(\"獲取地區時發生錯誤:\", e)\n    return null\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/data/return-policy.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/db.ts","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":6,"column":46,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":6,"endColumn":48,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[136,138],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":15,"column":3,"nodeType":"MemberExpression","messageId":"unexpected","endLine":15,"endColumn":14,"suggestions":[{"fix":{"range":[316,359],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":19,"column":3,"nodeType":"MemberExpression","messageId":"unexpected","endLine":19,"endColumn":16,"suggestions":[{"fix":{"range":[394,447],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// 注意：這個文件不能使用 \"use server\" 指令，因為它導出了非異步函數的值\n\nimport { Pool } from 'pg'\n\n// 從環境變數獲取資料庫連接字串\nconst databaseUrl = process.env.DATABASE_URL || 'postgres://postgres:simple123@localhost/medusa-medusa_decoupled'\n\n// 創建資料庫連接池\nconst pool = new Pool({\n  connectionString: databaseUrl,\n})\n\n// 測試連接\npool.on('connect', () => {\n  console.log('Connected to Medusa database')\n})\n\npool.on('error', (err) => {\n  console.error('Unexpected error on idle client', err)\n  process.exit(-1)\n})\n\n// 導出 pool 給其他模塊使用\nexport { pool }","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/env-mode.ts","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":1,"column":51,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":1,"endColumn":53,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[17,73],"text":"(process.env.NEXT_PUBLIC_ENV_MODE ?? process.env.ENV_MODE)"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":1,"column":75,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":1,"endColumn":77,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[74,76],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const rawMode = (process.env.NEXT_PUBLIC_ENV_MODE || process.env.ENV_MODE || (process.env.NODE_ENV === 'development' ? 'local' : 'vm')).toLowerCase()\n\nexport type EnvironmentMode = 'local' | 'vm'\n\nexport const ENV_MODE: EnvironmentMode = rawMode === 'vm' ? 'vm' : 'local'\n\nexport const isVmMode = ENV_MODE === 'vm'\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/error-handler.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":4,"column":32,"nodeType":"MemberExpression","messageId":"unexpected","endLine":4,"endColumn":45},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":7,"column":3,"nodeType":"MemberExpression","messageId":"unexpected","endLine":7,"endColumn":16},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":8,"column":46,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":8,"endColumn":48,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[315,317],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":9,"column":39,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":9,"endColumn":41,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[359,361],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":17,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":17,"endColumn":19,"suggestions":[{"fix":{"range":[677,747],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":29,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":29,"endColumn":19,"suggestions":[{"fix":{"range":[1066,1145],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":38,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":38,"endColumn":19,"suggestions":[{"fix":{"range":[1378,1456],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":52,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":52,"endColumn":23,"suggestions":[{"fix":{"range":[1873,1936],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":58,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":58,"endColumn":25,"suggestions":[{"fix":{"range":[2075,2140],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":68,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":68,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2351,2354],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2351,2354],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":68,"column":62,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":68,"endColumn":64,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2377,2379],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":70,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":70,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2430,2433],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2430,2433],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":86,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":86,"endColumn":23,"suggestions":[{"fix":{"range":[2817,2876],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":94,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":94,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2986,2989],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2986,2989],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":94,"column":58,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":94,"endColumn":60,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3012,3014],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"sonarjs/prefer-single-boolean-return","severity":2,"message":"Replace this if-then-else flow by a single return statement.","line":96,"column":7,"nodeType":"IfStatement","messageId":"replaceIfThenElseByReturn","endLine":98,"endColumn":8,"suggestions":[{"messageId":"suggest","fix":{"range":[3092,3181],"text":"return !(source.readyState === source.CLOSED);"},"desc":"Replace with single return statement"}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":101,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":101,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3205,3208],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3205,3208],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":12,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// 全域錯誤處理，特別針對 Sanity 的 AbortError\nif (typeof window !== 'undefined' && process.env.NODE_ENV === 'development') {\n  // 保存原始的 console.error 方法\n  const originalConsoleError = console.error\n\n  // 覆蓋 console.error 來過濾 Sanity AbortError\n  console.error = function(...args) {\n    const errorMessage = args[0]?.toString() || ''\n    const errorStack = args[0]?.stack || ''\n    \n    // 檢查是否為 Sanity 相關的 AbortError\n    if (errorMessage.includes('AbortError: signal is aborted without reason') ||\n        errorStack.includes('EventSourcePolyfill.close') ||\n        errorStack.includes('@sanity/client') ||\n        errorStack.includes('useTasksStore.useEffect')) {\n      // 將錯誤降級為警告\n      console.warn('Sanity EventSource AbortError (handled):', errorMessage)\n      return\n    }\n    \n    // 對於其他錯誤，使用原始的 console.error\n    originalConsoleError.apply(console, args)\n  }\n\n  // 捕獲未處理的 Promise rejection\n  window.addEventListener('unhandledrejection', (event) => {\n    if (event.reason?.name === 'AbortError' && \n        event.reason?.message?.includes('signal is aborted')) {\n      console.warn('Sanity EventSource AbortError caught and ignored:', event.reason)\n      event.preventDefault() // 防止錯誤在控制台中顯示\n    }\n  })\n\n  // 捕獲一般錯誤\n  window.addEventListener('error', (event) => {\n    if (event.error?.name === 'AbortError' && \n        event.error?.message?.includes('signal is aborted')) {\n      console.warn('Sanity EventSource AbortError caught and ignored:', event.error)\n      event.preventDefault()\n    }\n  })\n\n  // 監聽 EventSource 錯誤並添加更好的清理邏輯\n  const originalEventSource = window.EventSource\n  if (originalEventSource) {\n    window.EventSource = class extends originalEventSource {\n      constructor(url: string | URL, eventSourceInitDict?: EventSourceInit) {\n        super(url, eventSourceInitDict)\n        \n        // 添加錯誤處理\n        this.addEventListener('error', (e) => {\n          console.warn('EventSource error (possibly Sanity related):', e)\n        })\n\n        // 設置超時自動關閉連接\n        const timeout = setTimeout(() => {\n          if (this.readyState !== this.CLOSED) {\n            console.warn('Auto-closing EventSource connection after timeout')\n            this.close()\n          }\n        }, 30000) // 30秒超時\n\n        this.addEventListener('open', () => {\n          clearTimeout(timeout)\n        })\n\n        // 保存引用以供清理\n        const sources = (window as any).__sanityEventSources || []\n        sources.push(this)\n        ;(window as any).__sanityEventSources = sources\n        \n        // 限制最大連接數\n        if (sources.length > 5) {\n          const oldSource = sources.shift()\n          if (oldSource && oldSource.readyState !== oldSource.CLOSED) {\n            oldSource.close()\n          }\n        }\n      }\n\n      close() {\n        try {\n          super.close()\n        } catch (error) {\n          // 忽略關閉時的錯誤\n          console.warn('Error closing EventSource (ignored):', error)\n        }\n      }\n    }\n  }\n\n  // 定期清理舊的 EventSource 連接\n  setInterval(() => {\n    const sources = (window as any).__sanityEventSources || []\n    const activeSources = sources.filter((source: EventSource) => {\n      if (source.readyState === source.CLOSED) {\n        return false\n      }\n      return true\n    })\n    ;(window as any).__sanityEventSources = activeSources\n  }, 60000) // 每分鐘清理一次\n}\n\nexport {}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/grapesjs-utils.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":14,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":17},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":14,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":17},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":24,"column":26,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":24,"endColumn":28,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[669,671],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":25,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":25,"endColumn":17},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":25,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":25,"endColumn":17}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { promises as fs } from 'fs'\nimport path from 'path'\n\n// 儲存設定\nconst STORAGE_DIR = path.join(process.cwd(), 'data', 'grapesjs-pages')\nconst PAGES_FILE = path.join(STORAGE_DIR, 'pages.json')\n\n// 檢查 GrapesJS 頁面是否存在\nexport async function checkGrapesJSPageExists(pageId: string): Promise<boolean> {\n  try {\n    const data = await fs.readFile(PAGES_FILE, 'utf-8')\n    const pages = JSON.parse(data)\n    return !!pages[pageId]\n  } catch (error) {\n    return false\n  }\n}\n\n// 獲取 GrapesJS 頁面\nexport async function getGrapesJSPage(pageId: string) {\n  try {\n    const data = await fs.readFile(PAGES_FILE, 'utf-8')\n    const pages = JSON.parse(data)\n    return pages[pageId] || null\n  } catch (error) {\n    return null\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/hooks/use-in-view.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/hooks/use-in-view.tsx","messages":[{"ruleId":null,"nodeType":null,"fatal":true,"severity":2,"message":"Parsing error: \"parserOptions.project\" has been provided for @typescript-eslint/parser.\nThe file was not found in any of the provided project(s): src/lib/hooks/use-in-view.tsx"}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":1,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { RefObject, useEffect, useState } from \"react\"\n\nexport const useIntersection = (\n  element: RefObject<HTMLDivElement | null>,\n  rootMargin: string\n) => {\n  const [isVisible, setState] = useState(false)\n\n  useEffect(() => {\n    if (!element.current) {\n      return\n    }\n\n    const el = element.current\n\n    const observer = new IntersectionObserver(\n      ([entry]) => {\n        setState(entry.isIntersecting)\n      },\n      { rootMargin }\n    )\n\n    observer.observe(el)\n\n    return () => observer.unobserve(el)\n  }, [element, rootMargin])\n\n  return isVisible\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/hooks/use-logout.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":44,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":44,"endColumn":16,"suggestions":[{"fix":{"range":[1337,1482],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"sonarjs/cognitive-complexity","severity":2,"message":"Refactor this function to reduce its Cognitive Complexity from 40 to the 15 allowed.","line":64,"column":39,"nodeType":null,"messageId":"refactorFunction","endLine":64,"endColumn":41},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":74,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":74,"endColumn":18,"suggestions":[{"fix":{"range":[1963,2014],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":79,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":79,"endColumn":22,"suggestions":[{"fix":{"range":[2128,2169],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":82,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2251,2254],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2251,2254],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":83,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":83,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2314,2317],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2314,2317],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":88,"column":15,"nodeType":"MemberExpression","messageId":"unexpected","endLine":88,"endColumn":26,"suggestions":[{"fix":{"range":[2485,2517],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":95,"column":19,"nodeType":"MemberExpression","messageId":"unexpected","endLine":95,"endColumn":30,"suggestions":[{"fix":{"range":[2731,2778],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":98,"column":17,"nodeType":"MemberExpression","messageId":"unexpected","endLine":98,"endColumn":28,"suggestions":[{"fix":{"range":[2842,2874],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":106,"column":19,"nodeType":"MemberExpression","messageId":"unexpected","endLine":106,"endColumn":30,"suggestions":[{"fix":{"range":[3092,3128],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":109,"column":17,"nodeType":"MemberExpression","messageId":"unexpected","endLine":109,"endColumn":28,"suggestions":[{"fix":{"range":[3192,3229],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":115,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":115,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3331,3334],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3331,3334],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":117,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":117,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3415,3418],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3415,3418],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":120,"column":17,"nodeType":"MemberExpression","messageId":"unexpected","endLine":120,"endColumn":28,"suggestions":[{"fix":{"range":[3553,3585],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":123,"column":15,"nodeType":"MemberExpression","messageId":"unexpected","endLine":123,"endColumn":26,"suggestions":[{"fix":{"range":[3642,3676],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":140,"column":15,"nodeType":"MemberExpression","messageId":"unexpected","endLine":140,"endColumn":27,"suggestions":[{"fix":{"range":[4326,4372],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":196,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":196,"endColumn":22,"suggestions":[{"fix":{"range":[6089,6140],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":198,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":198,"endColumn":23,"suggestions":[{"fix":{"range":[6184,6225],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":203,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":203,"endColumn":18,"suggestions":[{"fix":{"range":[6283,6325],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":211,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":211,"endColumn":24,"suggestions":[{"fix":{"range":[6510,6560],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":218,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":218,"endColumn":20,"suggestions":[{"fix":{"range":[6773,6829],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":223,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":223,"endColumn":20,"suggestions":[{"fix":{"range":[6940,6981],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":233,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":233,"endColumn":23,"suggestions":[{"fix":{"range":[7233,7280],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":235,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":235,"endColumn":22,"suggestions":[{"fix":{"range":[7308,7336],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":238,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":238,"endColumn":20,"suggestions":[{"fix":{"range":[7356,7395],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":241,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":241,"endColumn":20,"suggestions":[{"fix":{"range":[7463,7496],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":245,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":245,"endColumn":20,"suggestions":[{"fix":{"range":[7576,7608],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":248,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":248,"endColumn":18,"suggestions":[{"fix":{"range":[7721,7769],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":27,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { useCallback, useState } from \"react\"\nimport { useRouter } from \"next/navigation\"\n\ntype UseLogoutOptions = {\n  countryCode?: string\n  redirectPath?: string\n  onLoggedOut?: () => void\n  /**\n   * Redirect strategy:\n   * - client-fetch: (舊行為) 先用 fetch 呼叫 /api/auth/logout 再用 router.replace 導向\n   * - server-redirect: 直接導向 /api/auth/logout?redirect=... 交給伺服器回傳 302 (較穩定)\n   * 預設使用 server-redirect，避免某些情況下 router.replace 未立即生效或使用者看到停留狀態。\n   */\n  strategy?: \"client-fetch\" | \"server-redirect\"\n}\n\ntype UseLogoutResult = {\n  logout: () => Promise<void>\n  isLoggingOut: boolean\n}\n\nconst buildDestination = (countryCode?: string, redirectPath?: string) => {\n  if (redirectPath) {\n    return redirectPath\n  }\n\n  // 確保 countryCode 有效，如果沒有或無效則使用默認值\n  const normalizedCode = countryCode?.trim()\n  \n  // 檢查 countryCode 是否有效（不是空、不是 'api'、不是其他無效值）\n  const isValidCountryCode = normalizedCode && \n                           typeof normalizedCode === 'string' &&\n                           normalizedCode !== 'api' && \n                           normalizedCode.length === 2 && \n                           /^[a-z]{2}$/.test(normalizedCode)\n  \n  // 重定向到帳戶登入頁面（/tw/account 會自動顯示登入表單）\n  const destination = isValidCountryCode ? `/${normalizedCode}/account` : \"/tw/account\"\n  \n  // 調試日誌\n  if (process.env.NODE_ENV === 'development') {\n    console.log('buildDestination (登出後重定向到登入頁面):', { \n      countryCode, \n      normalizedCode, \n      isValidCountryCode, \n      destination \n    })\n  }\n  \n  return destination\n}\n\nexport const useLogout = ({\n  countryCode,\n  redirectPath,\n  onLoggedOut,\n  strategy = \"server-redirect\",\n}: UseLogoutOptions = {}): UseLogoutResult => {\n  const router = useRouter()\n  const [isLoggingOut, setIsLoggingOut] = useState(false)\n\n  const logout = useCallback(async () => {\n    if (isLoggingOut) {\n      return\n    }\n\n    setIsLoggingOut(true)\n\n    try {\n      const destination = buildDestination(countryCode, redirectPath)\n      \n      console.log('🔓 開始登出流程', { strategy, destination })\n\n      // 🔧 首先清除 Google OAuth 狀態（在 SDK 登出之前）\n      if (typeof window !== \"undefined\") {\n        try {\n          console.log('🔐 開始清除 Google OAuth 狀態...')\n          \n          // 1. 嘗試撤銷 Google OAuth 授權（最重要的步驟）\n          if ((window as any).google?.accounts) {\n            const google = (window as any).google\n            \n            // 禁用自動選擇\n            if (google.accounts.id?.disableAutoSelect) {\n              google.accounts.id.disableAutoSelect()\n              console.log('✅ 已停用 Google 自動選擇')\n            }\n            \n            // 撤銷所有 Google Identity Services 授權\n            if (google.accounts.id?.revoke) {\n              try {\n                google.accounts.id.revoke('', () => {\n                  console.log('✅ Google Identity Services 授權已撤銷')\n                })\n              } catch (e) {\n                console.log('Google 授權撤銷失敗:', e)\n              }\n            }\n            \n            // 撤銷 OAuth2 授權\n            if (google.accounts.oauth2?.revoke) {\n              try {\n                google.accounts.oauth2.revoke('', () => {\n                  console.log('✅ Google OAuth2 授權已撤銷')\n                })\n              } catch (e) {\n                console.log('Google OAuth2 撤銷失敗:', e)\n              }\n            }\n          }\n\n          // 2. 清除 Google API 狀態\n          if ((window as any).gapi?.auth2) {\n            try {\n              const authInstance = (window as any).gapi.auth2.getAuthInstance()\n              if (authInstance?.signOut) {\n                await authInstance.signOut()\n                console.log('✅ Google API 登出成功')\n              }\n            } catch (e) {\n              console.log('Google API 清除失敗:', e)\n            }\n          }\n\n          // 3. 清除 Google OAuth 相關存儲項目\n          const googleOAuthKeys = [\n            'g_state', 'google_oauth_state', 'oauth_state', 'gsi_callback_data',\n            'google_user_data', 'google_auto_select', 'google_accounts_check',\n            'google_session_state', 'gsi_state', 'gapi_state',\n            'google_user_preferences', 'google_account_selection', 'google_logged_in_account'\n          ]\n          \n          googleOAuthKeys.forEach(key => {\n            try {\n              window.localStorage.removeItem(key)\n              window.sessionStorage.removeItem(key)\n            } catch (error) {\n              console.warn(`Failed to clear ${key}:`, error)\n            }\n          })\n          \n          // 完全清除所有存儲（這會重置整個應用狀態）\n          window.localStorage.clear()\n          window.sessionStorage.clear()\n          \n          // 清除客戶端可見的 cookies（非 httpOnly）\n          const cookiesToClear = [\n            \"_medusa_cart_id\",\n            \"next-auth.session-token\", \n            \"next-auth.callback-url\",\n            \"next-auth.csrf-token\",\n            \"auth-token\",\n            \"_debug_jwt_preview\",\n            \"_debug_jwt_full\",\n            // Google OAuth 相關 cookies\n            \"g_state\",\n            \"g_csrf_token\",\n            \"google_oauth_state\",\n            \"oauth_state\",\n            \"gsi_callback_data\",\n            \"__gads\",\n            \"__gpi\",\n            \"_gcl_au\",\n            // Google Identity Services cookies\n            \"g_enabled_idps\",\n            \"g_session_check\",\n            \"g_accounts_check\",\n            \"google_auto_select\",\n            \"1P_JAR\",\n            \"APISID\",\n            \"SAPISID\",\n            \"HSID\",\n            \"SSID\",\n            \"SID\",\n            // Google 帳戶選擇相關\n            \"ACCOUNT_CHOOSER\",\n            \"LSOLH\",\n            \"LSID\"\n          ]\n          \n          // 清除各種域名下的 cookies\n          const domains = [window.location.hostname, `.${window.location.hostname}`, \"\"]\n          \n          cookiesToClear.forEach(cookieName => {\n            domains.forEach(domain => {\n              const domainPart = domain ? `; domain=${domain}` : \"\"\n              document.cookie = `${cookieName}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/${domainPart}`\n              document.cookie = `${cookieName}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/tw${domainPart}`\n            })\n          })\n          \n\n          \n          console.log('🧹 已清除客戶端儲存和 cookies，並嘗試撤銷 Google 授權')\n        } catch (storageError) {\n          console.warn(\"清除本地儲存時發生錯誤\", storageError)\n        }\n      }\n\n      // 等待 Google OAuth 撤銷操作完成\n      console.log('⏳ 等待 Google OAuth 撤銷操作完成...')\n      await new Promise(resolve => setTimeout(resolve, 1000))\n\n      // 執行回調\n      if (onLoggedOut) {\n        try {\n          onLoggedOut()\n        } catch (callbackError) {\n          console.error(\"onLoggedOut 回呼執行失敗\", callbackError)\n        }\n      }\n\n      if (strategy === \"server-redirect\") {\n        // 使用服務器重定向，讓 API 路由處理 Medusa SDK 登出\n        const logoutUrl = `/api/auth/logout?redirect=${encodeURIComponent(destination)}&fast=1`\n        console.log('🔀 重定向到登出 API (使用 Medusa SDK):', logoutUrl)\n        window.location.href = logoutUrl\n        return\n      } else {\n        // 客戶端策略：調用 API 後手動重定向\n        console.log('📡 調用登出 API (client-fetch)')\n        const response = await fetch(\"/api/auth/logout\", {\n          method: \"POST\",\n          credentials: \"include\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n          },\n        })\n\n        if (!response.ok) {\n          console.warn(\"登出 API 回傳非成功狀態\", response.status)\n        } else {\n          console.log('✅ 登出 API 調用成功')\n        }\n\n        console.log('🔀 客戶端重定向到:', destination)\n        \n        // 強制重新載入頁面以確保所有狀態被清除，特別是 Google OAuth 狀態\n        console.log('🔄 強制重新載入頁面以清除所有狀態')\n        window.location.href = destination\n      }\n    } catch (error) {\n      console.error(\"❌ 登出請求失敗\", error)\n      // 即使登出失敗，也嘗試重定向到登入頁面\n      const fallbackDestination = buildDestination(countryCode, redirectPath)\n      console.log('❌ 登出失敗，重定向到:', fallbackDestination)\n      window.location.href = fallbackDestination\n    } finally {\n      setIsLoggingOut(false)\n    }\n  }, [countryCode, isLoggingOut, onLoggedOut, redirectPath, router, strategy])\n\n  return { logout, isLoggingOut }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/hooks/use-toggle-state.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/image-compression.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":75,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":75,"endColumn":20,"suggestions":[{"fix":{"range":[1798,1925],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":146,"column":3,"nodeType":"MemberExpression","messageId":"unexpected","endLine":146,"endColumn":14,"suggestions":[{"fix":{"range":[3544,3587],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'fullMatch' is assigned a value but never used.","line":151,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":151,"endColumn":21},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'fullMatch' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":151,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":151,"endColumn":21},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":159,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":159,"endColumn":18,"suggestions":[{"fix":{"range":[3822,3869],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":170,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":170,"endColumn":19,"suggestions":[{"fix":{"range":[4159,4196],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * 圖片壓縮工具函數\n */\n\ninterface CompressOptions {\n  maxWidth?: number\n  maxHeight?: number\n  quality?: number\n  maxSizeKB?: number\n}\n\n/**\n * 壓縮圖片\n * @param file 圖片文件或 URL\n * @param options 壓縮選項\n * @returns Promise<string> 壓縮後的 base64 字符串\n */\nexport async function compressImage(\n  input: File | string,\n  options: CompressOptions = {}\n): Promise<string> {\n  const {\n    maxWidth = 1200,\n    maxHeight = 800,\n    quality = 0.8,\n    maxSizeKB = 500\n  } = options\n\n  return new Promise((resolve, reject) => {\n    const canvas = document.createElement('canvas')\n    const ctx = canvas.getContext('2d')\n    const img = new Image()\n\n    img.onload = () => {\n      try {\n        // 計算壓縮後的尺寸\n        let { width, height } = calculateDimensions(\n          img.width,\n          img.height,\n          maxWidth,\n          maxHeight\n        )\n\n        canvas.width = width\n        canvas.height = height\n\n        if (!ctx) {\n          throw new Error('無法獲取 canvas context')\n        }\n\n        // 繪製壓縮後的圖片\n        ctx.drawImage(img, 0, 0, width, height)\n\n        // 轉換為 base64\n        let compressedDataUrl = canvas.toDataURL('image/jpeg', quality)\n\n        // 檢查文件大小，如果還是太大就進一步壓縮\n        let currentQuality = quality\n        while (getBase64SizeKB(compressedDataUrl) > maxSizeKB && currentQuality > 0.1) {\n          currentQuality -= 0.1\n          compressedDataUrl = canvas.toDataURL('image/jpeg', currentQuality)\n        }\n\n        // 如果尺寸還是太大，進一步縮小圖片\n        if (getBase64SizeKB(compressedDataUrl) > maxSizeKB) {\n          width = Math.floor(width * 0.8)\n          height = Math.floor(height * 0.8)\n          \n          canvas.width = width\n          canvas.height = height\n          ctx.drawImage(img, 0, 0, width, height)\n          compressedDataUrl = canvas.toDataURL('image/jpeg', 0.6)\n        }\n\n        console.log(`圖片壓縮完成: ${img.width}x${img.height} -> ${width}x${height}, 大小: ${getBase64SizeKB(compressedDataUrl).toFixed(1)}KB`)\n        resolve(compressedDataUrl)\n      } catch (error) {\n        reject(error)\n      }\n    }\n\n    img.onerror = () => {\n      reject(new Error('無法載入圖片'))\n    }\n\n    if (typeof input === 'string') {\n      // 如果是 URL，直接設置\n      img.crossOrigin = 'anonymous' // 處理跨域問題\n      img.src = input\n    } else {\n      // 如果是 File，轉換為 URL\n      const reader = new FileReader()\n      reader.onload = (e) => {\n        img.src = e.target?.result as string\n      }\n      reader.onerror = () => reject(new Error('無法讀取文件'))\n      reader.readAsDataURL(input)\n    }\n  })\n}\n\n/**\n * 計算保持比例的壓縮尺寸\n */\nfunction calculateDimensions(\n  originalWidth: number,\n  originalHeight: number,\n  maxWidth: number,\n  maxHeight: number\n): { width: number; height: number } {\n  let width = originalWidth\n  let height = originalHeight\n\n  // 計算縮放比例\n  const widthRatio = maxWidth / originalWidth\n  const heightRatio = maxHeight / originalHeight\n  const ratio = Math.min(widthRatio, heightRatio, 1) // 不放大，只縮小\n\n  width = Math.floor(originalWidth * ratio)\n  height = Math.floor(originalHeight * ratio)\n\n  return { width, height }\n}\n\n/**\n * 計算 base64 字符串的大小（KB）\n */\nfunction getBase64SizeKB(base64String: string): number {\n  // base64 字符串大小約等於原始數據的 4/3\n  const base64Data = base64String.split(',')[1] || base64String\n  const sizeInBytes = (base64Data.length * 3) / 4\n  return sizeInBytes / 1024\n}\n\n/**\n * 批量壓縮 HTML 中的圖片\n */\nexport async function compressImagesInHtml(html: string): Promise<string> {\n  const imgRegex = /<img[^>]+src=\"([^\"]+)\"[^>]*>/g\n  const matches = Array.from(html.matchAll(imgRegex))\n  \n  if (matches.length === 0) {\n    return html\n  }\n\n  console.log(`發現 ${matches.length} 張圖片需要處理`)\n  \n  let compressedHtml = html\n\n  for (const match of matches) {\n    const [fullMatch, src] = match\n    \n    // 跳過已經是 base64 或相對路徑的圖片\n    if (src.startsWith('data:') || !src.startsWith('http')) {\n      continue\n    }\n\n    try {\n      console.log(`壓縮圖片: ${src.substring(0, 50)}...`)\n      const compressedSrc = await compressImage(src, {\n        maxWidth: 1200,\n        maxHeight: 800,\n        quality: 0.7,\n        maxSizeKB: 300 // 每張圖片限制為 300KB\n      })\n\n      // 替換原始圖片 URL\n      compressedHtml = compressedHtml.replace(src, compressedSrc)\n    } catch (error) {\n      console.warn(`壓縮圖片失敗: ${src}`, error)\n      // 壓縮失敗時保留原始圖片\n    }\n  }\n\n  return compressedHtml\n}","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/medusa-api.ts","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":14,"column":53,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":14,"endColumn":55,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[225,311],"text":"(process.env.NEXT_PUBLIC_MEDUSA_BACKEND_URL ?? \n         process.env.MEDUSA_BACKEND_URL)"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":15,"column":41,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":15,"endColumn":43,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[312,314],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":25,"column":98,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":25,"endColumn":100,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[731,807],"text":"(process.env.NEXT_PUBLIC_MEDUSA_BACKEND_URL ?? process.env.MEDUSA_BACKEND_URL)"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":25,"column":132,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":25,"endColumn":134,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[808,810],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":64,"column":18,"nodeType":"MemberExpression","messageId":"unexpected","endLine":64,"endColumn":31},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":80,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":80,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2239,2242],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2239,2242],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":87,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":87,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2437,2440],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2437,2440],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'response' is assigned a value but never used.","line":101,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":101,"endColumn":19},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'response' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":101,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":101,"endColumn":19},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":105,"column":18,"nodeType":"MemberExpression","messageId":"unexpected","endLine":105,"endColumn":29},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":108,"column":18,"nodeType":"MemberExpression","messageId":"unexpected","endLine":108,"endColumn":31}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * 優化的 Medusa API 客戶端\n * 處理 CORS 和網路請求的最佳實踐\n */\n\n// 獲取後端 URL\nconst getBackendUrl = () => {\n  if (typeof window !== 'undefined') {\n    // 瀏覽器環境 - 使用代理路由避免 CORS\n    return '/api/medusa'\n  }\n  \n  // 伺服器端渲染 - 直接訪問後端\n  return process.env.NEXT_PUBLIC_MEDUSA_BACKEND_URL || \n         process.env.MEDUSA_BACKEND_URL || \n         'http://localhost:9000'\n}\n\n// 創建優化的 fetch 函數\nconst __isDev = process.env.NODE_ENV === 'development'\nexport const medusaFetch = async (endpoint: string, options: RequestInit = {}) => {\n  const baseUrl = getBackendUrl()\n  const url = `${baseUrl}${endpoint.startsWith('/') ? endpoint : `/${endpoint}`}`\n  const isProxy = baseUrl.startsWith('/api/medusa')\n  const backendUrl = typeof window === 'undefined' ? (process.env.NEXT_PUBLIC_MEDUSA_BACKEND_URL || process.env.MEDUSA_BACKEND_URL || 'http://localhost:9000') : ''\n  const publishableKey = !isProxy\n    ? (await import('./lib/medusa-publishable-key')).getPublishableKeyForBackend(backendUrl)\n    : undefined\n  \n  // 預設 headers\n  const defaultHeaders: HeadersInit = {\n    'Content-Type': 'application/json',\n    ...(typeof window !== 'undefined' && {\n      'X-Requested-With': 'XMLHttpRequest',\n    }),\n  }\n  \n  // 合併 options\n  const fetchOptions: RequestInit = {\n    mode: 'cors',\n    credentials: 'include',\n    ...options,\n    headers: {\n      ...defaultHeaders,\n      ...options.headers,\n      ...(publishableKey ? { 'x-publishable-api-key': publishableKey } : {}),\n    },\n  }\n  \n  try {\n    const response = await fetch(url, fetchOptions)\n    \n    // 檢查 CORS 錯誤\n    if (!response.ok) {\n      if (response.status === 0) {\n        throw new Error('CORS error: Unable to connect to backend')\n      }\n      \n      throw new Error(`HTTP ${response.status}: ${response.statusText}`)\n    }\n    \n    return response\n  } catch (error) {\n    if (__isDev) console.error('Medusa API 請求失敗:', error)\n    \n    // 提供有用的錯誤信息\n    if (error instanceof TypeError && error.message.includes('Failed to fetch')) {\n      throw new Error('網路連接失敗，請檢查 CORS 設置和後端連接')\n    }\n    \n    throw error\n  }\n}\n\n// 便利方法\nexport const medusaAPI = {\n  get: (endpoint: string, options?: RequestInit) => \n    medusaFetch(endpoint, { ...options, method: 'GET' }),\n    \n  post: (endpoint: string, data?: any, options?: RequestInit) =>\n    medusaFetch(endpoint, {\n      ...options,\n      method: 'POST',\n      body: data ? JSON.stringify(data) : undefined,\n    }),\n    \n  put: (endpoint: string, data?: any, options?: RequestInit) =>\n    medusaFetch(endpoint, {\n      ...options,\n      method: 'PUT',\n      body: data ? JSON.stringify(data) : undefined,\n    }),\n    \n  delete: (endpoint: string, options?: RequestInit) =>\n    medusaFetch(endpoint, { ...options, method: 'DELETE' }),\n}\n\n// CORS 檢查工具\nexport const checkCORS = async () => {\n  try {\n    const response = await medusaAPI.get('/store/products', {\n      mode: 'cors',\n    })\n    \n    if (__isDev) console.log('✅ CORS 設置正確，API 連接正常')\n    return true\n  } catch (error) {\n    if (__isDev) console.error('❌ CORS 設置有問題:', error)\n    return false\n  }\n}\n\n// 開發環境下自動檢查 CORS\nif (process.env.NODE_ENV === 'development' && typeof window !== 'undefined') {\n  // 延遲檢查，等待頁面載入完成\n  setTimeout(() => {\n    checkCORS()\n  }, 2000)\n}\n\nexport default medusaAPI\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/medusa-publishable-key.ts","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":2,"column":66,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":2,"endColumn":68,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[140,142],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":3,"column":70,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":3,"endColumn":72,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[215,217],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":4,"column":72,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":4,"endColumn":74,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[292,294],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":5,"column":74,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":5,"endColumn":76,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[371,373],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"export function getPublishableKeyForBackend(backendUrl?: string): string {\n  const DEFAULT = process.env.NEXT_PUBLIC_MEDUSA_PUBLISHABLE_KEY || ''\n  const LOCAL = process.env.NEXT_PUBLIC_MEDUSA_PUBLISHABLE_KEY_LOCAL || ''\n  const REMOTE = process.env.NEXT_PUBLIC_MEDUSA_PUBLISHABLE_KEY_REMOTE || ''\n  const RAILWAY = process.env.NEXT_PUBLIC_MEDUSA_PUBLISHABLE_KEY_RAILWAY || ''\n\n  if (!backendUrl) return DEFAULT\n  try {\n    const { hostname } = new URL(backendUrl)\n    if (hostname === 'localhost' || hostname === '127.0.0.1') return LOCAL || DEFAULT\n    if (hostname.endsWith('.railway.app')) return RAILWAY || REMOTE || DEFAULT\n    // Fallback: treat anything else as remote/VM\n    return REMOTE || DEFAULT\n  } catch {\n    return DEFAULT\n  }\n}\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/queries/fragments.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/queries/service-card-section.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/queries/service-cards.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/request-deduplicator.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[104,107],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[104,107],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":8,"column":14,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":8,"endColumn":44},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":37,"column":84,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":87,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[837,840],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[837,840],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// API 去重器 - 防止相同請求重複執行\nclass RequestDeduplicator {\n  private pendingRequests = new Map<string, Promise<any>>()\n\n  async dedupe<T>(key: string, fn: () => Promise<T>): Promise<T> {\n    // 如果已有相同請求在進行中，返回該 Promise\n    if (this.pendingRequests.has(key)) {\n      return this.pendingRequests.get(key)!\n    }\n\n    // 執行新請求\n    const promise = fn().finally(() => {\n      // 請求完成後清除記錄\n      this.pendingRequests.delete(key)\n    })\n\n    this.pendingRequests.set(key, promise)\n    return promise\n  }\n\n  // 清除所有待處理請求\n  clear() {\n    this.pendingRequests.clear()\n  }\n\n  // 獲取當前待處理請求數量\n  get pendingCount() {\n    return this.pendingRequests.size\n  }\n}\n\n// 全域去重器實例\nexport const requestDeduplicator = new RequestDeduplicator()\n\n// 批次請求工具\nexport class BatchRequest<T> {\n  private batch: Array<{ key: string; resolve: (value: T) => void; reject: (error: any) => void }> = []\n  private timer: NodeJS.Timeout | null = null\n  private readonly delay: number\n\n  constructor(delay: number = 50) {\n    this.delay = delay\n  }\n\n  async add(key: string, fetcher: () => Promise<T>): Promise<T> {\n    return new Promise((resolve, reject) => {\n      this.batch.push({ key, resolve, reject })\n\n      if (this.timer) {\n        clearTimeout(this.timer)\n      }\n\n      this.timer = setTimeout(async () => {\n        await this.flush(fetcher)\n      }, this.delay)\n    })\n  }\n\n  private async flush(fetcher: () => Promise<T>) {\n    const currentBatch = [...this.batch]\n    this.batch = []\n    this.timer = null\n\n    try {\n      // 去重相同的 key\n      const uniqueKeys = Array.from(new Set(currentBatch.map(item => item.key)))\n      \n      // 這裡可以根據需要實現批次邏輯\n      // 目前簡單地執行第一個請求並將結果分發給所有相同 key 的請求\n      const results = new Map<string, T>()\n      \n      for (const key of uniqueKeys) {\n        try {\n          const result = await fetcher()\n          results.set(key, result)\n        } catch (error) {\n          // 處理單個請求錯誤\n          currentBatch\n            .filter(item => item.key === key)\n            .forEach(item => item.reject(error))\n        }\n      }\n\n      // 分發結果\n      currentBatch.forEach(item => {\n        const result = results.get(item.key)\n        if (result !== undefined) {\n          item.resolve(result)\n        }\n      })\n\n    } catch (error) {\n      // 處理整體錯誤\n      currentBatch.forEach(item => item.reject(error))\n    }\n  }\n}\n\nexport default requestDeduplicator\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/safe-fetch.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[160,163],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[160,163],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":7,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[377,380],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[377,380],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":8,"column":39,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":8,"endColumn":41,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[422,424],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":10,"column":51,"nodeType":"MemberExpression","messageId":"unexpected","endLine":10,"endColumn":63}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// safe-fetch.ts\n// Lightweight wrapper around global fetch to gracefully handle AbortError and known abort messages.\nexport async function safeFetchGlobal<T = any>(input: RequestInfo, init?: RequestInit, fallback: T | null = null): Promise<T | null> {\n  try {\n    const res = await fetch(input, init)\n    return (await res.json?.()) ?? (res as unknown as T)\n  } catch (error: any) {\n    const msg = String(error?.message || error)\n    if (error?.name === 'AbortError' || msg.includes('The user aborted a request') || msg.includes('signal is aborted')) {\n      if (process.env.NODE_ENV === 'development') console.warn('Global fetch aborted (handled):', msg)\n      return fallback\n    }\n    throw error\n  }\n}\n\nexport default safeFetchGlobal\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/sanity-client/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/sanity-client/types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/sanity-utils/client.ts","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":4,"column":56,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":4,"endColumn":58,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[153,155],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":5,"column":51,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":5,"endColumn":53,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[218,220],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { ClientConfig, createClient } from '@sanity/client'\n\nconst sanityConfig: ClientConfig = {\n  projectId: process.env.NEXT_PUBLIC_SANITY_PROJECT_ID || 'm7o2mv1n',\n  dataset: process.env.NEXT_PUBLIC_SANITY_DATASET || 'production',\n  apiVersion: '2023-05-30',\n  useCdn: true,\n  perspective: 'published' as const\n}\n\nif (!sanityConfig.projectId) {\n  throw new Error('未設定 Sanity Project ID')\n}\n\nexport const client = createClient(sanityConfig)","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/sanity-utils/image.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/sanity-utils/index.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":45,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":45,"endColumn":18,"suggestions":[{"fix":{"range":[1071,1131],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":60,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":60,"endColumn":18,"suggestions":[{"fix":{"range":[1422,1481],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"sonarjs/prefer-immediate-return","severity":2,"message":"Immediately return this expression instead of assigning it to the temporary variable \"footer\".","line":79,"column":20,"nodeType":"AwaitExpression","messageId":"doImmediateAction","endLine":79,"endColumn":45,"fix":{"range":[1737,1795],"text":"return await client.fetch(query)"}},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":82,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":82,"endColumn":18,"suggestions":[{"fix":{"range":[1820,1877],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"sonarjs/prefer-immediate-return","severity":2,"message":"Immediately return this expression instead of assigning it to the temporary variable \"header\".","line":102,"column":20,"nodeType":"AwaitExpression","messageId":"doImmediateAction","endLine":102,"endColumn":45,"fix":{"range":[2154,2212],"text":"return await client.fetch(query)"}},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":105,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":105,"endColumn":18,"suggestions":[{"fix":{"range":[2237,2294],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":2,"fixableWarningCount":0,"source":"import { createClient } from 'next-sanity'\nimport { BlogPostType, CategoryType } from './types'\n\nexport const client = createClient({\n  projectId: process.env.NEXT_PUBLIC_SANITY_PROJECT_ID,\n  dataset: process.env.NEXT_PUBLIC_SANITY_DATASET,\n  apiVersion: \"2024-01-01\",\n  useCdn: true,\n  perspective: 'published',\n  stega: {\n    enabled: false\n  }\n})\n\nexport async function getAllPosts(category?: string, limit: number = 50): Promise<BlogPostType[]> {\n  try {\n    // 建立基本查詢\n    const baseQuery = `*[_type == \"post\"`\n    const categoryFilter = category ? ` && \"${category}\" in categories[]->title` : \"\"\n    const query = `${baseQuery}${categoryFilter}] | order(publishedAt desc) [0...${limit}] {\n      title,\n      slug,\n      mainImage {\n        asset->{\n          url\n        }\n      },\n      publishedAt,\n      excerpt,\n      categories[]->{\n        _id,\n        title\n      },\n      author->{\n        name,\n        image\n      },\n      status,\n      _id\n    }`\n\n    const posts = await client.fetch<BlogPostType[]>(query)\n    return posts || []\n  } catch (error) {\n    console.error('[getAllPosts] 從 Sanity 獲取部落格文章時發生錯誤:', error)\n    return []\n  }\n}\n\nexport async function getCategories(): Promise<CategoryType[]> {\n  try {\n    const query = `*[_type == \"category\"] {\n      _id,\n      title\n    }`\n    \n    const categories = await client.fetch<CategoryType[]>(query)\n    return categories || []\n  } catch (error) {\n    console.error('[getCategories] 從 Sanity 獲取分類時發生錯誤:', error)\n    return []\n  }\n}\n\n// 添加 getFooter 導出\nexport async function getFooter() {\n  try {\n    const query = `*[_type == \"footer\"][0] {\n      _id,\n      sections[]{\n        title,\n        links[]{\n          label,\n          url\n        }\n      }\n    }`\n    \n    const footer = await client.fetch(query)\n    return footer\n  } catch (error) {\n    console.error('[getFooter] 從 Sanity 獲取頁腳資料時發生錯誤:', error)\n    return null\n  }\n}\n\n// 添加 getHeader 導出  \nexport async function getHeader() {\n  try {\n    const query = `*[_type == \"header\"][0] {\n      _id,\n      navigation[]{\n        name,\n        href,\n        submenu[]{\n          name,\n          href\n        }\n      }\n    }`\n    \n    const header = await client.fetch(query)\n    return header\n  } catch (error) {\n    console.error('[getHeader] 從 Sanity 獲取頭部資料時發生錯誤:', error)\n    return null\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/sanity-utils/types.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":28,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[433,436],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[433,436],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"export interface SanityImageAsset {\n  _id: string;\n  url: string;\n}\n\nexport interface SanityImage {\n  asset: SanityImageAsset;\n}\n\nexport interface BlogPostType {\n  _id: string;\n  title: string;\n  slug: {\n    current: string;\n  };\n  mainImage: {\n    asset: {\n      url: string;\n    };\n  };\n  publishedAt: string;\n  categories?: CategoryType[];\n  excerpt?: string;\n  author?: {\n    name: string;\n    image?: SanityImage;\n  };\n  body?: any; // PortableText content\n  status?: string;\n}\n\nexport interface CategoryType {\n  _id: string;\n  title: string;\n}\n\n// 添加 FooterData 類型\nexport interface FooterData {\n  _id: string;\n  sections?: {\n    title: string;\n    links?: {\n      label: string;\n      url: string;\n    }[];\n  }[];\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/sanity-utils/utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/sanity.ts","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":13,"column":58,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":13,"endColumn":60,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[621,623],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":25,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[984,987],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[984,987],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":25,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1012,1015],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1012,1015],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":25,"column":77,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":80,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1031,1034],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1031,1034],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":25,"column":123,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":126,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1077,1080],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1077,1080],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":28,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":28,"endColumn":20,"suggestions":[{"fix":{"range":[1152,1219],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":44,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1614,1617],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1614,1617],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":45,"column":39,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":45,"endColumn":41,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1659,1661],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":46,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":46,"endColumn":18,"suggestions":[{"fix":{"range":[1673,1733],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":49,"column":18,"nodeType":"MemberExpression","messageId":"unexpected","endLine":49,"endColumn":30},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":53,"column":16,"nodeType":"MemberExpression","messageId":"unexpected","endLine":53,"endColumn":29},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":59,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":59,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2132,2135],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2132,2135],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":65,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":65,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2346,2349],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2346,2349],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'withCache' is defined but never used.","line":73,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":73,"endColumn":19},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'withCache' is defined but never used. Allowed unused vars must match /^_/u.","line":73,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":73,"endColumn":19},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":88,"column":20,"nodeType":"MemberExpression","messageId":"unexpected","endLine":88,"endColumn":32},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":102,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":102,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3453,3456],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3453,3456],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":107,"column":7,"nodeType":null,"messageId":"preferOptionalChain","endLine":107,"endColumn":36,"fix":{"range":[3578,3607],"text":"result?.mainSections"}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":108,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":108,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3674,3677],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3674,3677],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":110,"column":20,"nodeType":"MemberExpression","messageId":"unexpected","endLine":110,"endColumn":32},{"ruleId":"sonarjs/prefer-immediate-return","severity":2,"message":"Immediately return this expression instead of assigning it to the temporary variable \"page\".","line":346,"column":16,"nodeType":"AwaitExpression","messageId":"doImmediateAction","endLine":346,"endColumn":58,"fix":{"range":[9281,9350],"text":"return await safeFetch(query, { slug }, {}, null)"}},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":349,"column":16,"nodeType":"MemberExpression","messageId":"unexpected","endLine":349,"endColumn":29},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":384,"column":16,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":384,"endColumn":18,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[10192,10194],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":386,"column":16,"nodeType":"MemberExpression","messageId":"unexpected","endLine":386,"endColumn":29},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":400,"column":21,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":400,"endColumn":23,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[10564,10566],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":402,"column":16,"nodeType":"MemberExpression","messageId":"unexpected","endLine":402,"endColumn":29},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":631,"column":16,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":631,"endColumn":18,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[16317,16319],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":633,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":633,"endColumn":18,"suggestions":[{"fix":{"range":[16347,16404],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":654,"column":14,"nodeType":"MemberExpression","messageId":"unexpected","endLine":654,"endColumn":25},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":841,"column":16,"nodeType":"MemberExpression","messageId":"unexpected","endLine":841,"endColumn":27},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":844,"column":51,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":844,"endColumn":53,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[21426,21428],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":845,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":845,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21478,21481],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21478,21481],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":845,"column":98,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":845,"endColumn":100,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[21529,21531],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":850,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":850,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21675,21678],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21675,21678],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":852,"column":22,"nodeType":"MemberExpression","messageId":"unexpected","endLine":852,"endColumn":34},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":861,"column":16,"nodeType":"MemberExpression","messageId":"unexpected","endLine":861,"endColumn":29},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":898,"column":16,"nodeType":"MemberExpression","messageId":"unexpected","endLine":898,"endColumn":27},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":899,"column":19,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":899,"endColumn":21,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[22979,22981],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":901,"column":16,"nodeType":"MemberExpression","messageId":"unexpected","endLine":901,"endColumn":29}],"suppressedMessages":[],"errorCount":12,"fatalErrorCount":0,"warningCount":27,"fixableErrorCount":2,"fixableWarningCount":0,"source":"import { createClient } from \"@sanity/client\"\nimport { requestDeduplicator } from \"./request-deduplicator\"\nimport type { Footer } from './types/footer'\nimport type { BlogPost, FeaturedProduct } from '../types/global'\nimport type { MainSection } from './types/page-sections'\nimport type { PageData } from './types/pages'\nimport type { Category } from '../types/sanity'\nimport type { ServiceCards } from './types/service-cards'\n\nconst client = createClient({\n  projectId: process.env.NEXT_PUBLIC_SANITY_PROJECT_ID,\n  dataset: process.env.NEXT_PUBLIC_SANITY_DATASET,\n  apiVersion: process.env.NEXT_PUBLIC_SANITY_API_VERSION || \"2022-03-25\",\n  useCdn: true,\n  // 啟用 HTTP 快取\n  requestTagPrefix: 'sanity',\n  // 設定重試機制\n  maxRetries: 3,\n  retryDelay: (attemptNumber) => Math.min(300 * attemptNumber, 2000),\n  // 移除無效的 token，只讀取公開數據\n})\n\n// Helper to handle AbortError / user-abort gracefully for sanity fetches\nconst isDev = process.env.NODE_ENV === 'development'\nasync function safeFetch<T = any>(query: string, params: any = {}, options: any = {}, fallback: T | null = null): Promise<any> {\n  try {\n    if (!process.env.NEXT_PUBLIC_SANITY_PROJECT_ID) {\n      console.error(\"Missing Sanity Project ID in environment variables\")\n      return fallback\n    }\n    \n    // 增加超時設定\n    const controller = new AbortController()\n    const timeoutId = setTimeout(() => controller.abort(), 10000) // 10秒超時\n    \n    const mergedOptions = {\n      ...options,\n      signal: controller.signal,\n    }\n    \n    const result = await client.fetch(query, params, mergedOptions)\n    clearTimeout(timeoutId)\n    return result\n  } catch (error: any) {\n    const msg = String(error?.message || error)\n    console.error(\"Sanity fetch error:\", msg, \"\\nQuery:\", query)\n    \n    if (error?.name === 'AbortError' || msg.includes('abort') || msg.includes('timeout')) {\n      if (isDev) console.warn('Sanity fetch aborted/timed out:', msg)\n      return fallback\n    }\n    \n    if (isDev) console.error('Sanity fetch error details:', error)\n    return fallback // 在生產環境中總是返回備用值，避免應用崩潰\n  }\n}\n\n// 建立快取實例（按需淘汰，不使用 setInterval 以相容無伺服器環境）\nconst cache = new Map<string, { data: any; timestamp: number }>()\nconst CACHE_TTL = 5 * 60 * 1000 // 5分鐘\nconst MAX_CACHE_SIZE = 50 // 最大快取項目數\n\nfunction pruneCacheIfNeeded() {\n  if (cache.size <= MAX_CACHE_SIZE) return\n  const entries: [string, { data: any; timestamp: number }][] = []\n  cache.forEach((entry, key) => entries.push([key, entry]))\n  entries.sort((a, b) => a[1].timestamp - b[1].timestamp)\n  const toRemove = entries.slice(0, cache.size - MAX_CACHE_SIZE)\n  toRemove.forEach(([key]) => cache.delete(key))\n}\n\n// 快取包裝函數 - 優化版，加入去重功能\nfunction withCache<T>(key: string, fn: () => Promise<T>, ttl: number = CACHE_TTL): Promise<T> {\n  return requestDeduplicator.dedupe(key, async () => {\n    const cached = cache.get(key)\n    if (cached && Date.now() - cached.timestamp < ttl) {\n      return cached.data\n    }\n\n    try {\n      const data = await fn()\n      cache.set(key, { data, timestamp: Date.now() })\n      pruneCacheIfNeeded()\n      return data\n    } catch (error) {\n      // 如果有快取資料但已過期，在錯誤時仍返回舊資料\n      if (cached) {\n        if (isDev) console.warn(`API 調用失敗，使用快取資料: ${key}`, error)\n        return cached.data\n      }\n      throw error\n    }\n  })\n}\n\nexport async function getHomepage_old(): Promise<{ title: string; mainSections: MainSection[] }> {\n  const query = `*[_type == \"homePage\"][0] {\n    title,\n    mainSections\n  }`\n  \n  const result: any = await safeFetch(query, {}, { \n    next: { revalidate: 300 } // 5 分鐘緩存\n  }, null)\n  \n  // 過濾掉未知類型的 sections 並記錄警告\n  if (result && result.mainSections) {\n    result.mainSections = result.mainSections.filter((section: any) => {\n      if (section?.isUnknownType) {\n        if (isDev) console.warn(\"Unknown section type detected and filtered:\", section._type)\n        return false\n      }\n      return section?._type // 只保留有 _type 的 sections\n    })\n  }\n  \n  return result as { title: string; mainSections: MainSection[] }\n}\n\nexport async function getFeaturedProducts(): Promise<FeaturedProduct[]> {\n  const query = `*[_type == \"featuredProducts\" && isActive == true]{\n    title,\n    handle,\n    collection_id,\n    description,\n    isActive\n  }`\n  return (await safeFetch(query, {}, { \n    next: { revalidate: 300 } // 5 分鐘緩存\n  }, [])) as FeaturedProduct[]\n}\n\nexport async function getHeader() {\n  const query = `*[_type == \"header\"][0]{\n    logo{\n      \"url\": asset->url,\n      alt\n    },\n    favicon{\n      \"url\": asset->url,\n      alt\n    },\n    storeName,\n    logoHeight,\n    logoSize{\n      desktop,\n      mobile\n    },\n    navigation[]{\n      name,\n      href\n    },\n    marquee {\n      enabled,\n      text1 {\n        enabled,\n        content\n      },\n    text2 {\n      enabled,\n      content\n    },\n    text3 {\n      enabled,\n      content\n    },\n    linkUrl,\n    pauseOnHover\n  }\n}`\n  return await safeFetch(query, {}, { \n    next: { revalidate: 300 } // 5 分鐘緩存\n  }, null)\n}\n\nexport async function getPageBySlug(slug: string): Promise<PageData | null> {\n  try {\n    const query = `*[_type == \"pages\" && slug.current == $slug][0]{\n      _type,\n      title,\n      \"slug\": slug.current,\n      isActive,\n      seo {\n        metaTitle,\n        metaDescription,\n        canonicalUrl\n      },\n      mainSections[] {\n        _type,\n        ...select(\n          _type == \"mainBanner\" => {\n            isActive,\n            \"slides\": slides[] {\n              heading,\n              subheading,\n              \"desktopImage\": desktopImage.asset->url,\n              \"desktopImageAlt\": desktopImage.alt,\n              \"mobileImage\": mobileImage.asset->url,\n              \"mobileImageAlt\": mobileImage.alt,\n              buttonText,\n              buttonLink\n            },\n            \"settings\": settings {\n              autoplay,\n              autoplaySpeed,\n              showArrows,\n              showDots\n            }\n          },\n          _type == \"imageTextBlock\" => {\n            isActive,\n            heading,\n            hideTitle,\n            content,\n            \"image\": image {\n              \"url\": asset->url,\n              \"alt\": alt,\n              \"linkUrl\": linkUrl\n            },\n            layout,\n            \"leftImage\": leftImage {\n              \"url\": asset->url,\n              \"alt\": alt,\n              \"linkUrl\": linkUrl\n            },\n            \"rightImage\": rightImage {\n              \"url\": asset->url,\n              \"alt\": alt\n            },\n            leftContent,\n            rightContent\n          },\n          _type == \"featuredProducts\" => {\n            isActive,\n            heading,\n            showHeading,\n            showSubheading,\n            collection_id\n          },\n          _type == \"blogSection\" => {\n            isActive,\n            title,\n            category,\n            limit\n          },\n          _type == \"youtubeSection\" => {\n            isActive,\n            videoUrl,\n            heading,\n            description,\n            fullWidth,\n            videoMode,\n            \"youtubeSettings\": youtubeSettings {\n              desktopVideoUrl,\n              mobileVideoUrl,\n              useSameVideo,\n              autoplay,\n              loop,\n              muted,\n              muted,\n              showControls\n            },\n            \"uploadSettings\": uploadSettings {\n              \"desktopVideo\": desktopVideo {\n                \"asset\": asset-> {\n                  _id,\n                  url,\n                  originalFilename,\n                  mimeType\n                }\n              },\n              \"mobileVideo\": mobileVideo {\n                \"asset\": asset-> {\n                  _id,\n                  url,\n                  originalFilename,\n                  mimeType\n                }\n              },\n              useSameVideo,\n              autoplay,\n              loop,\n              muted,\n              showControls\n            },\n            // 向後兼容\n            \"videoSettings\": videoSettings {\n              desktopVideoUrl,\n              mobileVideoUrl,\n              useSameVideo\n            }\n          },\n          _type == \"contentSection\" => {\n            isActive,\n            title,\n            content[] {\n              ...,\n              // 如果內容區塊包含參考類型，也展開它們\n              _type == \"image\" => {\n                \"url\": asset->url,\n                \"altText\": alt\n              }\n            }\n          },\n          _type == \"serviceCardSection\" => {\n            isActive,\n            heading,\n            cardsPerRow,\n            \"cards\": cards[] {\n              title,\n              englishTitle,\n              \"stylists\": stylists[] {\n                levelName,\n                price,\n                priceType,\n                stylistName,\n                isDefault,\n                \"cardImage\": cardImage {\n                  \"url\": asset->url,\n                  \"alt\": alt\n                }\n              },\n              link\n            }\n          },\n          _type == \"contactSection\" => {\n            isActive,\n            title,\n            address,\n            phone,\n            email,\n            businessHours[]{\n              days,\n              hours\n            },\n            socialLinks[]{\n              platform,\n              url\n            },\n            googleMapsUrl\n          }\n        )\n      }\n    }`\n\n  const page = await safeFetch(query, { slug }, {}, null)\n  return page\n  } catch (error) {\n    if (isDev) console.error('獲取頁面資料失敗:', error)\n    return null\n  }\n}\n\nexport async function getAllPosts(category?: string, limit: number = 50): Promise<BlogPost[]> {\n  try {\n    // 建立基本查詢\n    const baseQuery = `*[_type == \"post\"`\n    const categoryFilter = category ? ` && \"${category}\" in categories[]->title` : \"\"\n    const query = `${baseQuery}${categoryFilter}] | order(publishedAt desc) [0...${limit}] {\n      _id,\n      _type,\n      title,\n      slug,\n      mainImage {\n        asset->{\n          url\n        }\n      },\n      publishedAt,\n      excerpt,\n      categories[]->{\n        _id,\n        title\n      },\n      author->{\n        name,\n        image\n      },\n      status,\n      body // 添加內文欄位\n    }`\n\n  const posts = await safeFetch<BlogPost[]>(query, {}, { next: { revalidate: 300 } }, [])\n  return posts || []\n  } catch (error) {\n    if (isDev) console.error('[getAllPosts] 從 Sanity 獲取部落格文章時發生錯誤:', error)\n    return []\n  }\n}\n\nexport async function getCategories(): Promise<Category[]> {\n  try {\n    const query = `*[_type == \"category\"] {\n      _id,\n      _type,\n      title\n    }`\n    \n  const categories = await safeFetch<Category[]>(query, {}, {}, [])\n  return categories || []\n  } catch (error) {\n    if (isDev) console.error('[getCategories] 從 Sanity 獲取分類時發生錯誤:', error)\n    return []\n  }\n}\n\nexport async function getPostBySlug(slug: string): Promise<BlogPost | null> {    \n  // 先嘗試用slug.current查詢\n  let query = `*[_type == \"post\" && slug.current == $slug][0]{\n    _id,\n    title,\n    slug {\n      current\n    },\n    publishedAt,\n    body,\n    \"author\": author->{name, bio, \"image\": image.asset->url},\n    mainImage {\n      asset-> {\n        url\n      }\n    },\n    \"categories\": categories[]->{title}\n  }`\n  \n  let result = await safeFetch(query, { slug }, {}, null)\n  \n  // 如果用slug沒找到，嘗試根據標題匹配\n  if (!result) {\n    query = `*[_type == \"post\" && title match \"*\" + $title + \"*\" || _id match $slug + \"*\"][0]{\n      _id,\n      title,\n      slug {\n        current\n      },\n      publishedAt,\n      body,\n      \"author\": author->{name, bio, \"image\": image.asset->url},\n      mainImage {\n        asset-> {\n          url\n        }\n      },\n      \"categories\": categories[]->{title}\n    }`\n    \n    // 嘗試從slug反推標題或使用ID\n    const searchTerm = slug.includes('post-') ? slug.split('post-')[1] : slug.replace(/-/g, ' ')\n    result = await safeFetch(query, { slug, title: searchTerm }, {}, null)\n  }\n  \n  return result\n}\nexport async function getAllPages(): Promise<PageData[]> {\n  try {\n    const query = `*[_type == \"pages\" && isActive == true] {\n      _type,\n      title,\n      \"slug\": slug.current,\n      isActive,\n      seo {\n        metaTitle,\n        metaDescription,\n        canonicalUrl\n      },\n      mainSections[] {\n        _type,\n        ...select(\n          _type == \"mainBanner\" => {\n            isActive,\n            \"slides\": slides[] {\n              heading,\n              subheading,\n              \"desktopImage\": desktopImage.asset->url,\n              \"desktopImageAlt\": desktopImage.alt,\n              \"mobileImage\": mobileImage.asset->url,\n              \"mobileImageAlt\": mobileImage.alt,\n              imageLink\n            },\n            \"settings\": settings {\n              autoplay,\n              autoplaySpeed,\n              showArrows,\n              showDots\n            }\n          },\n          _type == \"imageTextBlock\" => {\n            isActive,\n            heading,\n            hideTitle,\n            content,\n            \"image\": image {\n              \"url\": asset->url,\n              \"alt\": alt,\n              \"linkUrl\": linkUrl\n            },\n            layout,\n            \"leftImage\": leftImage {\n              \"url\": asset->url,\n              \"alt\": alt,\n              \"linkUrl\": linkUrl\n            },\n            \"rightImage\": rightImage {\n              \"url\": asset->url,\n              \"alt\": alt,\n              \"linkUrl\": linkUrl\n            },\n            leftContent,\n            rightContent\n          },\n          _type == \"featuredProducts\" => {\n            isActive,\n            heading,\n            showHeading,\n            showSubheading,\n            collection_id\n          },\n          _type == \"blogSection\" => {\n            isActive,\n            title,\n            \"category\": category->title,\n            limit,\n            postsPerRow\n          },\n          _type == \"youtubeSection\" => {\n            isActive,\n            videoUrl,\n            heading,\n            description,\n            fullWidth,\n            videoMode,\n            \"youtubeSettings\": youtubeSettings {\n              desktopVideoUrl,\n              mobileVideoUrl,\n              useSameVideo,\n              autoplay,\n              loop,\n              muted,\n              muted,\n              showControls\n            },\n            \"uploadSettings\": uploadSettings {\n              \"desktopVideo\": desktopVideo {\n                \"asset\": asset-> {\n                  _id,\n                  url,\n                  originalFilename,\n                  mimeType\n                }\n              },\n              \"mobileVideo\": mobileVideo {\n                \"asset\": asset-> {\n                  _id,\n                  url,\n                  originalFilename,\n                  mimeType\n                }\n              },\n              useSameVideo,\n              autoplay,\n              loop,\n              muted,\n              showControls\n            },\n            // 向後兼容\n            \"videoSettings\": videoSettings {\n              desktopVideoUrl,\n              mobileVideoUrl,\n              useSameVideo\n            }\n          },\n          _type == \"contentSection\" => {\n            isActive,\n            title,\n            content[] {\n              ...,\n              _type == \"image\" => {\n                \"url\": asset->url,\n                \"altText\": alt\n              }\n            }\n          },\n          _type == \"serviceCardSection\" => {\n            isActive,\n            heading,\n            cardsPerRow,\n            \"cards\": cards[] {\n              title,\n              englishTitle,\n              \"stylists\": stylists[] {\n                levelName,\n                price,\n                priceType,\n                stylistName,\n                isDefault,\n                \"cardImage\": cardImage {\n                  \"url\": asset->url,\n                  \"alt\": alt\n                }\n              },\n              link\n            }\n          },\n              link {\n                text,\n                url\n              }\n            }\n          },\n          _type == \"contactSection\" => {\n            isActive,\n            title,\n            address,\n            phone,\n            email,\n            businessHours[]{\n              days,\n              hours\n            },\n            socialLinks[]{\n              platform,\n              url\n            },\n            googleMapsUrl\n          }\n        )\n      }\n    }`\n\n  const pages = await safeFetch<PageData[]>(query, {}, {}, [])\n  return pages || []\n  } catch (error) {\n    console.error('[getAllPages] 從 Sanity 獲取頁面時發生錯誤:', error)\n    return []\n  }\n}\n\n\nexport async function getHomepage(): Promise<{ \n  title: string; \n  mainSections: MainSection[];\n  seoTitle?: string;\n  seoDescription?: string;\n  focusKeyword?: string;\n  seoKeywords?: string[];\n  canonicalUrl?: string;\n  noIndex?: boolean;\n  noFollow?: boolean;\n  ogTitle?: string;\n  ogDescription?: string;\n  ogImage?: { asset: { url: string }; alt: string };\n  twitterCard?: string;\n}> {\n  if (isDev) console.log('🔍 Starting getHomepage request to Sanity...')\n  \n  const query = `*[_type == \"homePage\"][0] {\n    title,\n    seoTitle,\n    seoDescription,\n    focusKeyword,\n    seoKeywords,\n    canonicalUrl,\n    noIndex,\n    noFollow,\n    ogTitle,\n    ogDescription,\n    \"ogImage\": ogImage {\n      \"asset\": asset->{url},\n      alt\n    },\n    twitterCard,\n    \"mainSections\": mainSections[] {\n      ...select(\n        _type == \"mainBanner\" => {\n          _type,\n          isActive,\n          \"slides\": slides[] {\n            heading,\n            subheading,\n            \"desktopImage\": desktopImage.asset->url,\n            \"desktopImageAlt\": desktopImage.alt,\n            \"mobileImage\": mobileImage.asset->url,\n            \"mobileImageAlt\": mobileImage.alt,\n            imageLink\n          },\n          \"settings\": settings {\n            autoplay,\n            autoplaySpeed,\n            showArrows,\n            showDots\n          }\n        },\n        _type == \"imageTextBlock\" => {\n          _type,\n          isActive,\n          heading,\n          hideTitle,\n          content,\n          \"image\": image {\n            \"url\": asset->url,\n            \"alt\": alt,\n            \"linkUrl\": linkUrl\n          },\n          layout,\n          \"leftImage\": leftImage {\n            \"url\": asset->url,\n            \"alt\": alt,\n            \"linkUrl\": linkUrl\n          },\n          \"rightImage\": rightImage {\n            \"url\": asset->url,\n            \"alt\": alt,\n            \"linkUrl\": linkUrl\n          },\n          leftContent,\n          rightContent\n        },\n        _type == \"featuredProducts\" => {\n          _type,\n          heading,\n          showHeading,\n          showSubheading,\n          collection_id,\n          isActive\n        },\n        _type == \"blogSection\" => {\n          _type,\n          isActive,\n          title,\n          \"category\": category->title,\n          limit,\n          postsPerRow\n        },\n        _type == \"youtubeSection\" => {\n          _type,\n          isActive,\n          heading,\n          description,\n          videoUrl,\n          fullWidth,\n          videoMode,\n          \"youtubeSettings\": youtubeSettings {\n            desktopVideoUrl,\n            mobileVideoUrl,\n            useSameVideo,\n            autoplay,\n            loop,\n              muted,\n            muted,\n            showControls\n          },\n          \"uploadSettings\": uploadSettings {\n            \"desktopVideo\": desktopVideo {\n              \"asset\": asset-> {\n                _id,\n                url,\n                originalFilename,\n                mimeType\n              }\n            },\n            \"mobileVideo\": mobileVideo {\n              \"asset\": asset-> {\n                _id,\n                url,\n                originalFilename,\n                mimeType\n              }\n            },\n            useSameVideo,\n            autoplay,\n            loop,\n              muted,\n            muted,\n            showControls\n          },\n          // 向後兼容\n          \"videoSettings\": videoSettings {\n            desktopVideoUrl,\n            mobileVideoUrl,\n            useSameVideo\n          }\n        },\n        _type == \"serviceCardSection\" => {\n          _type,\n          isActive,\n          heading,\n          cardsPerRow,\n          \"cards\": cards[] {\n            title,\n            englishTitle,\n            \"stylists\": stylists[] {\n              levelName,\n              price,\n              priceType,\n              stylistName,\n              isDefault,\n              \"cardImage\": cardImage {\n                \"url\": asset->url,\n                \"alt\": alt\n              }\n            },\n            link\n          }\n        },\n        _type == \"contentSection\" => {\n          _type,\n          isActive,\n          heading,\n          \"content\": content[]{\n            ...,\n            markDefs[]{\n              ...,\n              _type == \"internalLink\" => {\n                \"slug\": @.reference->slug.current\n              }\n            }\n          }\n        },\n        _type == \"googleMapsSection\" => {\n          _type,\n          isActive,\n          heading,\n          description,\n          googleMapsUrl,\n          mapHeight\n        },\n        // Default case - 包含 _type 以便識別未處理的 section 類型\n        {\n          _type,\n          \"isUnknownType\": true\n        }\n      )\n    }\n  }`\n\n  try {\n    const result = await safeFetch(query, {}, { \n      next: { revalidate: 300 } // 5 分鐘緩存\n    }, { title: '', mainSections: [] })\n    \n    if (isDev) console.log('✅ Sanity response received:', {\n      hasResult: !!result,\n      title: result?.title,\n      sectionsCount: result?.mainSections?.length || 0,\n      sections: result?.mainSections?.map((s: any) => ({ type: s._type, isActive: s.isActive })) || []\n    })\n    \n    // 過濾掉未知類型的 sections 並記錄警告\n    if (result?.mainSections) {\n      result.mainSections = result.mainSections.filter((section: any) => {\n        if (section?.isUnknownType) {\n          if (isDev) console.warn(\"Unknown section type detected and filtered:\", section._type)\n          return false\n        }\n        return section?._type // 只保留有 _type 的 sections\n      })\n    }\n    \n    return result as { title: string; mainSections: MainSection[] }\n  } catch (error) {\n    if (isDev) console.error('❌ Error fetching homepage from Sanity:', error)\n    return { title: '', mainSections: [] }\n  }\n}\n\n\nexport async function getServiceSection(): Promise<ServiceCards | null> {\n  try {\n    const query = `*[_type == \"homePage\"][0].mainSections[_type == \"serviceCardSection\" && isActive == true][0] {\n      _type,\n      isActive,\n      heading,\n      cardsPerRow,\n      \"cards\": cards[] {\n        title,\n        englishTitle,\n        \"stylists\": stylists[] {\n          levelName,\n          price,\n          priceType,\n          stylistName,\n          isDefault,\n          \"cardImage\": cardImage {\n            \"url\": asset->url,\n            \"alt\": alt\n          }\n        }\n      }\n    }`\n\n  const result = await safeFetch(query, {}, {}, null)\n    \n    // 添加 _type 如果不存在\n    if (result && !result._type) {\n      result._type = \"serviceCardSection\"\n    }\n    \n    if (isDev) console.log('[getServiceSection] 查詢結果:', result)\n    return result || null\n  } catch (error) {\n    if (isDev) console.error('[getServiceSection] 從 Sanity 獲取服務區塊時發生錯誤:', error)\n    return null\n  }\n}\n\nexport async function getFooter(): Promise<Footer | null> {\n  // 只獲取已發布的最新頁尾版本\n  const query = `*[_type == \"footer\" && !(_id in path('drafts.**'))] | order(_updatedAt desc)[0] {\n    title,\n    logo {\n      \"url\": asset->url,\n      alt\n    },\n    logoWidth,\n    sections[] {\n      title,\n      links[] {\n        text,\n        linkType,\n        internalLink,\n        externalUrl,\n        // 處理各種可能的 URL 形式\n        // 1. 如果有指定 linkType，根據類型使用對應的 URL\n        // 2. 如果沒有指定類型，但有 url 字段，使用該字段\n        // 3. 為了向後兼容，最後檢查是否有 href 字段\n        // 4. 現在支援 tel: 和 mailto: 等協議\n        \"url\": coalesce(\n          select(\n            linkType == \"internal\" => internalLink,\n            linkType == \"external\" => externalUrl,\n            url\n          ),\n          url,\n          href\n        )\n      }\n    },\n    socialMedia {\n      facebook {\n        enabled,\n        url\n      },\n      instagram {\n        enabled,\n        url\n      },\n      line {\n        enabled,\n        url\n      },\n      youtube {\n        enabled,\n        url\n      },\n      twitter {\n        enabled,\n        url\n      }\n    },\n    copyright\n  }`\n  \n  return await safeFetch(query, {}, {}, null)\n}\n\nexport async function getAllFooters(): Promise<Footer[]> {\n  // 獲取所有已發布的頁尾版本\n  const query = `*[_type == \"footer\" && !(_id in path('drafts.**'))] | order(_updatedAt desc) {\n    title,\n    _id,\n    _updatedAt,\n    _createdAt\n  }`\n  \n  return await safeFetch(query, {}, {}, [])\n}\n\nexport { client }\nexport default client\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/sanity/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/sanity/types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/seo.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":45,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1202,1205],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1202,1205],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"sonarjs/cognitive-complexity","severity":2,"message":"Refactor this function to reduce its Cognitive Complexity from 24 to the 15 allowed.","line":72,"column":17,"nodeType":null,"messageId":"refactorFunction","endLine":72,"endColumn":39},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":73,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2040,2043],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2040,2043],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'pageType' is assigned a value but never used.","line":75,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":75,"endColumn":11},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'pageType' is assigned a value but never used. Allowed unused args must match /^_/u.","line":75,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":75,"endColumn":11},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":83,"column":53,"nodeType":"MemberExpression","messageId":"unexpected","endLine":83,"endColumn":66},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":90,"column":52,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":90,"endColumn":54,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2579,2581],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":91,"column":55,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":91,"endColumn":57,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2660,2662],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":93,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":93,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2693,2696],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2693,2696],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":103,"column":36,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":103,"endColumn":38,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3038,3040],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":105,"column":45,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":105,"endColumn":47,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3146,3148],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":106,"column":42,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":106,"endColumn":44,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3197,3239],"text":"(pageData.updatedAt ?? pageData.publishedAt)"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":106,"column":66,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":106,"endColumn":68,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3240,3242],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":109,"column":39,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":109,"endColumn":41,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3354,3356],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":134,"column":32,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":134,"endColumn":34,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3926,3928],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":171,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":171,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4859,4862],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4859,4862],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":192,"column":58,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":192,"endColumn":60,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[5294,5296],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":218,"column":62,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":218,"endColumn":64,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[5958,5960],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":221,"column":49,"nodeType":"MemberExpression","messageId":"unexpected","endLine":221,"endColumn":62},{"ruleId":"sonarjs/cognitive-complexity","severity":2,"message":"Refactor this function to reduce its Cognitive Complexity from 26 to the 15 allowed.","line":234,"column":13,"nodeType":null,"messageId":"refactorFunction","endLine":234,"endColumn":15},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":237,"column":5,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":237,"endColumn":7,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[6433,6509],"text":"(metadata.title ? String(metadata.title) : null) \n    ?? sanityMeta?.seoTitle)"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":238,"column":5,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":238,"endColumn":7,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[6489,6580],"text":"(sanityMeta?.seoTitle \n    ?? (defaultMetadata?.title ? String(defaultMetadata.title) : null)"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":239,"column":5,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":239,"endColumn":7,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[6586,6588],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":243,"column":5,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":243,"endColumn":7,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[6715,6770],"text":"(metadata.description \n    ?? sanityMeta?.seoDescription)"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":244,"column":5,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":244,"endColumn":7,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[6744,6807],"text":"(sanityMeta?.seoDescription \n    ?? defaultMetadata?.description)"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":245,"column":5,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":245,"endColumn":7,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[6813,6815],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":270,"column":39,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":270,"endColumn":41,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[7405,7464],"text":"(sanityMeta?.ogTitle ?? (metadata.openGraph?.title as string)"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":271,"column":51,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":271,"endColumn":53,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[7499,7559],"text":"(sanityMeta?.ogDescription ?? metadata.openGraph?.description)"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":271,"column":86,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":271,"endColumn":88,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[7560,7562],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":290,"column":47,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":290,"endColumn":49,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[8223,8225],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"prefer-const","severity":2,"message":"'robotsDirectives' is never reassigned. Use 'const' instead.","line":293,"column":7,"nodeType":"Identifier","messageId":"useConst","endLine":293,"endColumn":33,"fix":{"range":[8296,8331],"text":"const robotsDirectives: string[] = []"}},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":305,"column":24,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":305,"endColumn":26,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[8586,8588],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":333,"column":60,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":333,"endColumn":62,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[9435,9437],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":337,"column":43,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":337,"endColumn":45,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[9592,9594],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":346,"column":37,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":346,"endColumn":39,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[9878,9880],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":347,"column":52,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":347,"endColumn":54,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[9957,9959],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":395,"column":52,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":395,"endColumn":54,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[11113,11115],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":396,"column":43,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":396,"endColumn":45,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[11182,11184],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":397,"column":37,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":397,"endColumn":39,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[11270,11272],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":398,"column":36,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":398,"endColumn":38,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[11314,11316],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":34,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import { Metadata } from \"next\"\n\ninterface SanitySEOMeta {\n  seoTitle?: string\n  seoDescription?: string\n  focusKeyword?: string\n  seoKeywords?: string[]\n  canonicalUrl?: string\n  noIndex?: boolean\n  noFollow?: boolean\n  ogTitle?: string\n  ogDescription?: string\n  ogImage?: {\n    asset: {\n      url: string\n    }\n    alt: string\n  }\n  twitterCard?: 'summary' | 'summary_large_image' | 'app' | 'player'\n  priority?: number\n  changeFrequency?: 'daily' | 'weekly' | 'monthly' | 'yearly' | 'never'\n  structuredDataType?: string\n  articleType?: string\n  customJsonLd?: string\n}\n\ninterface ProductKeywordsConfig {\n  presetKeywords: Record<string, string[]>\n  extractFields: string[]\n}\n\n// Google Search Essentials 關鍵字配置\nconst defaultKeywordConfig: ProductKeywordsConfig = {\n  presetKeywords: {\n    'shampoo': ['洗髮精', '去屑', '頭皮護理', '深層清潔', '髮質改善'],\n    'conditioner': ['潤髮乳', '護髮素', '修護', '滋潤', '柔順'],\n    'hair_styling': ['造型', '髮蠟', '髮膠', '定型', '蓬鬆'],\n    'hair_treatment': ['護髮', '修護', '營養', '強韌', '防斷'],\n    'scalp_care': ['頭皮護理', '控油', '舒緩', '去角質', '保濕']\n  },\n  extractFields: ['title', 'subtitle', 'description', 'tags', 'collection', 'category']\n}\n\nexport function generateProductKeywords(\n  product: any,\n  config: ProductKeywordsConfig = defaultKeywordConfig\n): string[] {\n  const extracted = config.extractFields.flatMap(field => {\n    const value = product[field]\n    return typeof value === 'string' ? \n      value.split(/[,，、\\s]+/).filter(Boolean) : \n      Array.isArray(value) ? value.flat().filter(Boolean) : []\n  })\n\n  const preset = product.type ? \n    (config.presetKeywords[product.type] || []) : \n    []\n\n  // 合併並去重，保持順序\n  const keywordSet = new Set([...extracted, ...preset])\n  const allKeywords = Array.from(keywordSet)\n  \n  // 過濾掉太短或無意義的關鍵字\n  return allKeywords.filter(keyword => \n    keyword && \n    keyword.length > 1 && \n    !['的', '是', '在', '和', '與', 'and', 'or', 'the', 'a', 'an'].includes(keyword.toLowerCase())\n  ).slice(0, 15) // 限制最多15個關鍵字\n}\n\n// 生成結構化資料 JSON-LD\nexport function generateStructuredData(\n  pageData: any,\n  seoMeta?: SanitySEOMeta,\n  pageType: 'homepage' | 'product' | 'article' | 'page' = 'page'\n): string | null {\n  if (!seoMeta?.structuredDataType || seoMeta.structuredDataType === 'none') {\n    if (seoMeta?.customJsonLd) {\n      try {\n        JSON.parse(seoMeta.customJsonLd) // 驗證 JSON 格式\n        return seoMeta.customJsonLd\n      } catch {\n        if (process.env.NODE_ENV === 'development') console.error('無效的自訂 JSON-LD 格式')\n        return null\n      }\n    }\n    return null\n  }\n\n  const baseUrl = process.env.NEXT_PUBLIC_SITE_URL || 'http://localhost:8000'\n  const siteName = process.env.NEXT_PUBLIC_STORE_NAME || '我的商店'\n\n  let structuredData: any = {\n    '@context': 'https://schema.org'\n  }\n\n  switch (seoMeta.structuredDataType) {\n    case 'article':\n      structuredData = {\n        ...structuredData,\n        '@type': seoMeta.articleType === 'news' ? 'NewsArticle' : \n                 seoMeta.articleType === 'tech' ? 'TechArticle' : 'BlogPosting',\n        headline: seoMeta.seoTitle || pageData.title,\n        description: seoMeta.seoDescription,\n        datePublished: pageData.publishedAt || new Date().toISOString(),\n        dateModified: pageData.updatedAt || pageData.publishedAt || new Date().toISOString(),\n        author: {\n          '@type': 'Person',\n          name: pageData.author?.name || '網站管理員'\n        },\n        publisher: {\n          '@type': 'Organization',\n          name: siteName,\n          logo: {\n            '@type': 'ImageObject',\n            url: `${baseUrl}/favicon.ico`\n          }\n        }\n      }\n      \n      if (seoMeta.ogImage) {\n        structuredData.image = {\n          '@type': 'ImageObject',\n          url: seoMeta.ogImage.asset.url,\n          alt: seoMeta.ogImage.alt\n        }\n      }\n      break\n\n    case 'product':\n      structuredData = {\n        ...structuredData,\n        '@type': 'Product',\n        name: seoMeta.seoTitle || pageData.title,\n        description: seoMeta.seoDescription,\n        brand: {\n          '@type': 'Brand',\n          name: siteName\n        }\n      }\n      \n      if (seoMeta.ogImage) {\n        structuredData.image = seoMeta.ogImage.asset.url\n      }\n      \n      if (pageData.price) {\n        structuredData.offers = {\n          '@type': 'Offer',\n          price: pageData.price,\n          priceCurrency: 'TWD',\n          availability: 'https://schema.org/InStock'\n        }\n      }\n      break\n\n    case 'local_business':\n      structuredData = {\n        ...structuredData,\n        '@type': 'LocalBusiness',\n        name: siteName,\n        description: seoMeta.seoDescription,\n        url: baseUrl\n      }\n      break\n\n    case 'breadcrumb':\n      if (pageData.breadcrumbs) {\n        structuredData = {\n          ...structuredData,\n          '@type': 'BreadcrumbList',\n          itemListElement: pageData.breadcrumbs.map((crumb: any, index: number) => ({\n            '@type': 'ListItem',\n            position: index + 1,\n            name: crumb.name,\n            item: crumb.url\n          }))\n        }\n      }\n      break\n  }\n\n  return JSON.stringify(structuredData, null, 2)\n}\n\ntype OGImage = {\n  url: string\n  alt?: string\n}\n\nexport const getDefaultSEOSettings = async (): Promise<Metadata> => {\n  try {\n    const storeName = process.env.NEXT_PUBLIC_STORE_NAME || ''\n    \n    return {\n      title: {\n        absolute: storeName,\n        template: storeName ? `%s | ${storeName}` : '%s',\n      },\n      icons: {\n        icon: [{ url: '/favicon.ico' }],\n        shortcut: [{ url: '/favicon.ico' }],\n        apple: [{ url: '/favicon.ico' }],\n      },\n      openGraph: {\n        type: \"website\",\n        siteName: storeName,\n        images: [\n          {\n            url: '/default-og-image.jpg',\n            alt: storeName,\n          },\n        ],\n      },\n      twitter: {\n        card: \"summary_large_image\",\n        images: ['/default-twitter-image.jpg']\n      },\n      metadataBase: new URL(process.env.NEXT_PUBLIC_SITE_URL || 'https://tims-hair-salon.com'),\n    }\n  } catch (error) {\n    if (process.env.NODE_ENV === 'development') console.error('獲取 SEO 設定時發生錯誤:', error)\n    return {\n      title: '我的商店',\n      description: undefined,\n      icons: undefined,\n    }\n  }\n}\n\nexport const mergeSEOMetadata = (\n  metadata: Metadata, \n  defaultMetadata?: Metadata,\n  sanityMeta?: SanitySEOMeta\n): Metadata => {\n  // 標題優先順序：metadata.title -> sanityMeta.seoTitle -> defaultMetadata.title\n  const title = (metadata.title ? String(metadata.title) : null) \n    || sanityMeta?.seoTitle \n    || (defaultMetadata?.title ? String(defaultMetadata.title) : null)\n    || undefined\n\n  // 描述優先順序：metadata.description -> sanityMeta.seoDescription -> defaultMetadata.description\n  const description = metadata.description \n    || sanityMeta?.seoDescription \n    || defaultMetadata?.description \n    || undefined\n\n  // 合併關鍵字\n  let keywords: string[] = []\n  \n  if (Array.isArray(metadata.keywords)) {\n    keywords = [...keywords, ...metadata.keywords]\n  }\n  \n  if (sanityMeta?.focusKeyword) {\n    keywords.unshift(sanityMeta.focusKeyword) // 目標關鍵字放最前面\n  }\n  \n  if (Array.isArray(sanityMeta?.seoKeywords)) {\n    keywords = [...keywords, ...sanityMeta.seoKeywords]\n  }\n  \n  if (Array.isArray(defaultMetadata?.keywords)) {\n    keywords = [...keywords, ...defaultMetadata.keywords]\n  }\n\n  // 去除重複關鍵字\n  keywords = Array.from(new Set(keywords)).filter(Boolean)\n\n  // Open Graph 設定\n  const ogTitle = sanityMeta?.ogTitle || (metadata.openGraph?.title as string) || title\n  const ogDescription = sanityMeta?.ogDescription || metadata.openGraph?.description || description\n  \n  let ogImages: OGImage[] = []\n  if (sanityMeta?.ogImage) {\n    ogImages = [{\n      url: sanityMeta.ogImage.asset.url,\n      alt: sanityMeta.ogImage.alt\n    }]\n  } else if (metadata.openGraph?.images) {\n    ogImages = Array.isArray(metadata.openGraph.images) \n      ? metadata.openGraph.images as OGImage[]\n      : [metadata.openGraph.images as OGImage]\n  } else if (defaultMetadata?.openGraph?.images) {\n    ogImages = Array.isArray(defaultMetadata.openGraph.images)\n      ? defaultMetadata.openGraph.images as OGImage[]\n      : [defaultMetadata.openGraph.images as OGImage]\n  }\n\n  // Twitter 卡片設定\n  const twitterCard = sanityMeta?.twitterCard || 'summary_large_image'\n\n  // Robots 設定 - 符合 Google Search Essentials\n  let robotsDirectives: string[] = []\n  \n  if (sanityMeta?.noIndex) {\n    robotsDirectives.push('noindex')\n  }\n  \n  if (sanityMeta?.noFollow) {\n    robotsDirectives.push('nofollow')\n  }\n  \n  const robots = robotsDirectives.length > 0 \n    ? robotsDirectives.join(', ')\n    : (metadata.robots || undefined)\n\n  // 其他 meta 標籤\n  const otherMeta: Record<string, string> = {\n    ...(metadata.other as Record<string, string> || {}),\n    ...(ogTitle ? { 'og:title': ogTitle } : {}),\n    ...(ogDescription ? { 'og:description': ogDescription } : {}),\n    ...(sanityMeta?.focusKeyword ? { 'focus-keyword': sanityMeta.focusKeyword } : {})\n  }\n\n  if (ogImages.length > 0) {\n    otherMeta['og:image'] = ogImages[0].url\n    if (ogImages[0].alt) {\n      otherMeta['og:image:alt'] = ogImages[0].alt\n    }\n  }\n\n  // 網站驗證和結構化資料可通過 other meta 添加\n  if (sanityMeta?.canonicalUrl) {\n    otherMeta['canonical'] = sanityMeta.canonicalUrl\n  }\n\n  const finalMetadata: Metadata = {\n    ...defaultMetadata,\n    ...metadata,\n    title,\n    description,\n    keywords: keywords.length > 0 ? keywords : undefined,\n    metadataBase: new URL(process.env.NEXT_PUBLIC_SITE_URL || 'http://localhost:8000'),\n    alternates: {\n      ...defaultMetadata?.alternates,\n      ...metadata.alternates,\n      canonical: sanityMeta?.canonicalUrl || metadata.alternates?.canonical\n    },\n    robots,\n    openGraph: {\n      ...defaultMetadata?.openGraph,\n      ...metadata.openGraph,\n      title: ogTitle,\n      description: ogDescription,\n      images: ogImages.length > 0 ? ogImages : undefined,\n      url: sanityMeta?.canonicalUrl || metadata.openGraph?.url,\n      siteName: process.env.NEXT_PUBLIC_STORE_NAME || defaultMetadata?.openGraph?.siteName\n    },\n    twitter: {\n      ...defaultMetadata?.twitter,\n      ...metadata.twitter,\n      card: twitterCard,\n      title: ogTitle,\n      description: ogDescription,\n      images: ogImages.length > 0 ? ogImages.map(img => img.url) : undefined\n    },\n    other: otherMeta\n  }\n\n  return finalMetadata\n}\n\n// 驗證 Core Web Vitals 的輔助函數\nexport function validateCoreWebVitals(metrics: {\n  lcp?: number // Largest Contentful Paint (ms)\n  inp?: number // Interaction to Next Paint (ms) \n  cls?: number // Cumulative Layout Shift\n}) {\n  const issues: string[] = []\n  \n  if (metrics.lcp && metrics.lcp > 2500) {\n    issues.push(`LCP (${metrics.lcp}ms) 超過建議值 2.5 秒`)\n  }\n  \n  if (metrics.inp && metrics.inp > 200) {\n    issues.push(`INP (${metrics.inp}ms) 超過建議值 200ms`)\n  }\n  \n  if (metrics.cls && metrics.cls > 0.1) {\n    issues.push(`CLS (${metrics.cls}) 超過建議值 0.1`)\n  }\n  \n  return {\n    passed: issues.length === 0,\n    issues\n  }\n}\n\n// 生成 robots.txt 內容\nexport function generateRobotsTxt(options?: {\n  sitemap?: string\n  disallowPaths?: string[]\n  allowPaths?: string[]\n}) {\n  const baseUrl = process.env.NEXT_PUBLIC_SITE_URL || 'http://localhost:8000'\n  const disallow = options?.disallowPaths || ['/api/*', '/admin/*', '/_next/*', '/checkout/']\n  const allow = options?.allowPaths || ['/']\n  const sitemap = options?.sitemap || `${baseUrl}/sitemap.xml`\n\n  return `User-agent: *\n${allow.map(path => `Allow: ${path}`).join('\\n')}\n${disallow.map(path => `Disallow: ${path}`).join('\\n')}\n\n# 防止過度抓取\nCrawl-delay: 1\n\nSitemap: ${sitemap}\n`\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/services/get-service-cards.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":57,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1182,1185],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1182,1185],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":60,"column":30,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":60,"endColumn":32,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1264,1266],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import client from \"../sanity\"\n\nexport type ServiceCardType = {\n  title: string\n  englishTitle: string\n  stylists: {\n    levelName: string\n    price: number\n    stylistName?: string\n    cardImage?: {\n      url: string\n      alt?: string\n    }\n  }[]\n}\n\nexport type ServiceCardsType = {\n  isActive: boolean\n  heading?: string\n  subheading?: string\n  cardsPerRow: number\n  cards: ServiceCardType[]\n}\n\nexport async function getServiceCards(): Promise<ServiceCardsType | null> {\n  if (!client) throw new Error('Sanity client is not configured')\n\n  const query = `*[_type == \"homePage\"][0] {\n    mainSections[] {\n      _type == \"serviceCardSection\" => {\n        isActive,\n        heading,\n        subheading,\n        cardsPerRow,\n        cards[] {\n          title,\n          englishTitle,\n          stylists[] {\n            levelName,\n            price,\n            stylistName,\n            \"cardImage\": cardImage {\n              \"url\": asset->url,\n              \"alt\": alt\n            }\n          }\n        }\n      }\n    }\n  }`\n\n  const result = await client.fetch(query)\n  \n  if (!result?.mainSections) return null\n\n  const serviceCardsSection = result.mainSections.find(\n    (section: any) => section?._type === 'serviceCardSection'\n  )\n\n  return serviceCardsSection || null\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/services/grapesjs-page-service.ts","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":9,"column":54,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":9,"endColumn":56,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[224,226],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":13,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":13,"endColumn":18,"suggestions":[{"fix":{"range":[382,481],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":18,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[670,673],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[670,673],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":19,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[721,724],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[721,724],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":26,"column":60,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":26,"endColumn":62,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[960,962],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":53,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":53,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1568,1571],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1568,1571],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":57,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1657,1660],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1657,1660],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":62,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1801,1804],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1801,1804],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":72,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2017,2020],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2017,2020],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":73,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2067,2070],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2067,2070],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":74,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":74,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2113,2116],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2113,2116],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":124,"column":20,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":124,"endColumn":22,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3187,3189],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":126,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":126,"endColumn":20,"suggestions":[{"fix":{"range":[3221,3254],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":138,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":138,"endColumn":21,"suggestions":[{"fix":{"range":[3451,3487],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":171,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":171,"endColumn":20,"suggestions":[{"fix":{"range":[4160,4191],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":183,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":183,"endColumn":21,"suggestions":[{"fix":{"range":[4398,4438],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":216,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":216,"endColumn":20,"suggestions":[{"fix":{"range":[5124,5161],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":236,"column":31,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":236,"endColumn":33,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[5605,5607],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":240,"column":138,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":240,"endColumn":140,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[5850,5852],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":241,"column":122,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":241,"endColumn":124,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[5979,5981],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":242,"column":41,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":242,"endColumn":43,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[6027,6029],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":245,"column":41,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":245,"endColumn":43,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[6156,6158],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":248,"column":35,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":248,"endColumn":37,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[6269,6271],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":260,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":260,"endColumn":18,"suggestions":[{"fix":{"range":[6569,6603],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":263,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":263,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6682,6685],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6682,6685],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":264,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":264,"endColumn":20,"suggestions":[{"fix":{"range":[6695,6726],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":271,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":271,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7028,7031],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7028,7031],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"sonarjs/cognitive-complexity","severity":2,"message":"Refactor this function to reduce its Cognitive Complexity from 75 to the 15 allowed.","line":282,"column":9,"nodeType":null,"messageId":"refactorFunction","endLine":282,"endColumn":19},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":284,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":284,"endColumn":18,"suggestions":[{"fix":{"range":[7301,7999],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":290,"column":47,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":290,"endColumn":49,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[7546,7548],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":291,"column":45,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":291,"endColumn":47,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[7596,7598],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":329,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":329,"endColumn":24,"suggestions":[{"fix":{"range":[8905,8944],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":344,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":344,"endColumn":24,"suggestions":[{"fix":{"range":[9380,9419],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":358,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":358,"endColumn":18,"suggestions":[{"fix":{"range":[9729,9770],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":364,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":364,"endColumn":22,"suggestions":[{"fix":{"range":[9938,9974],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":369,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":369,"endColumn":22,"suggestions":[{"fix":{"range":[10122,10159],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":373,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":373,"endColumn":18,"suggestions":[{"fix":{"range":[10235,10282],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":376,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":376,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10324,10327],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10324,10327],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":384,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":384,"endColumn":23,"suggestions":[{"fix":{"range":[10557,10581],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":392,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":392,"endColumn":23,"suggestions":[{"fix":{"range":[10784,10812],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":403,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":403,"endColumn":23,"suggestions":[{"fix":{"range":[11186,11228],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":429,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":429,"endColumn":23,"suggestions":[{"fix":{"range":[12387,12431],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":447,"column":37,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":447,"endColumn":39,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[12874,12876],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":458,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":458,"endColumn":22,"suggestions":[{"fix":{"range":[13087,13153],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":477,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":477,"endColumn":22,"suggestions":[{"fix":{"range":[13657,13815],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":485,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":485,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13907,13910],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13907,13910],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":489,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":489,"endColumn":24,"suggestions":[{"fix":{"range":[13986,14055],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":490,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":490,"endColumn":24,"suggestions":[{"fix":{"range":[14066,14254],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":494,"column":36,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":494,"endColumn":38,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[14226,14228],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":505,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":505,"endColumn":24,"suggestions":[{"fix":{"range":[14641,14676],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":512,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":512,"endColumn":20,"suggestions":[{"fix":{"range":[14806,14836],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":513,"column":23,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":513,"endColumn":25,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[14859,14861],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":515,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":515,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14915,14918],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14915,14918],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":516,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":516,"endColumn":20,"suggestions":[{"fix":{"range":[14928,14959],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":526,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":526,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15565,15568],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15565,15568],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":556,"column":43,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":556,"endColumn":45,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[16352,16354],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":557,"column":41,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":557,"endColumn":43,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[16399,16401],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":560,"column":45,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":560,"endColumn":47,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[16646,16648],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":563,"column":45,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":563,"endColumn":47,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[16787,16789],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":662,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":662,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19230,19233],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19230,19233],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":19,"fatalErrorCount":0,"warningCount":41,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createClient } from '@sanity/client'\n\n// 檢查是否在客戶端環境中\nconst isClient = typeof window !== 'undefined'\n\n// 創建寫入客戶端的函數\nfunction getWriteClient() {\n  // 檢查 token 是否有效\n  const token = process.env.NEXT_PUBLIC_SANITY_TOKEN || process.env.SANITY_API_TOKEN\n  const hasValidToken = token && token !== 'your_sanity_write_token_here' && token.length > 10\n  \n  if (!hasValidToken) {\n    console.error('Sanity write token is missing or invalid. Please check your environment variables.')\n    throw new Error('Sanity write token is required for write operations')\n  }\n  \n  // 如果在 Sanity Studio 環境中，嘗試使用 Studio 的客戶端\n  if (isClient && typeof window !== 'undefined' && (window as any).__sanityStudioClient) {\n    return (window as any).__sanityStudioClient\n  }\n\n  // 創建標準的客戶端\n  return createClient({\n    projectId: process.env.NEXT_PUBLIC_SANITY_PROJECT_ID,\n    dataset: process.env.NEXT_PUBLIC_SANITY_DATASET,\n    apiVersion: process.env.NEXT_PUBLIC_SANITY_API_VERSION || \"2024-01-01\",\n    useCdn: false, // 寫入操作不使用 CDN\n    token: token,\n    withCredentials: false,\n  })\n}\n\n// 使用唯讀客戶端進行讀取操作\nimport { client as readClient } from '@/lib/sanity'\n\nexport interface GrapesJSPageData {\n  _id?: string\n  _type: 'grapesJSPageV2'\n  _createdAt?: string\n  _updatedAt?: string\n  title: string\n  slug: {\n    current: string\n  }\n  description?: string\n  status: 'draft' | 'preview' | 'published' | 'archived'\n  publishedAt?: string\n  version: number\n  grapesHtml?: string\n  grapesCss?: string\n  grapesComponents?: string // JSON string\n  grapesStyles?: string // JSON string\n  homeModules?: any[]\n  seoTitle?: string\n  seoDescription?: string\n  seoKeywords?: string[]\n  ogImage?: any\n  customCSS?: string\n  customJS?: string\n  viewport: 'responsive' | 'desktop' | 'tablet' | 'mobile'\n  lastModified?: string\n  editHistory?: any[]\n}\n\nexport interface SavePageParams {\n  title: string\n  slug: string\n  description?: string\n  status?: 'draft' | 'preview' | 'published' | 'archived'\n  grapesHtml: string\n  grapesCss: string\n  grapesComponents: any // GrapesJS components object\n  grapesStyles: any // GrapesJS styles object\n  homeModules?: any[]\n  seoTitle?: string\n  seoDescription?: string\n  seoKeywords?: string[]\n  customCSS?: string\n  customJS?: string\n  viewport?: 'responsive' | 'desktop' | 'tablet' | 'mobile'\n}\n\nexport interface UpdatePageParams extends Partial<SavePageParams> {\n  _id: string\n  version?: number\n}\n\nclass GrapesJSPageService {\n  \n  /**\n   * 獲取所有 GrapesJS 頁面列表\n   */\n  async getAllPages(): Promise<GrapesJSPageData[]> {\n    try {\n      const pages = await readClient.fetch(`\n        *[_type == \"grapesJSPageV2\"] | order(_createdAt desc) {\n          _id,\n          _type,\n          _createdAt,\n          _updatedAt,\n          title,\n          slug,\n          description,\n          status,\n          publishedAt,\n          version,\n          grapesHtml,\n          grapesCss,\n          grapesComponents,\n          grapesStyles,\n          homeModules,\n          seoTitle,\n          seoDescription,\n          seoKeywords,\n          ogImage,\n          customCSS,\n          customJS,\n          viewport,\n          lastModified,\n          editHistory\n        }\n      `)\n      \n      return pages || []\n    } catch (error) {\n      console.error('載入頁面列表失敗:', error)\n      throw error\n    }\n  }\n\n  /**\n   * 根據 ID 獲取特定頁面\n   */\n  async getPageById(id: string): Promise<GrapesJSPageData | null> {\n    try {\n      // 驗證參數\n      if (!id || id.trim() === '') {\n        console.warn('getPageById: ID 參數為空')\n        return null\n      }\n\n      const query = `\n        *[_type == \"grapesJSPageV2\" && _id == $id][0] {\n          _id,\n          _type,\n          title,\n          slug,\n          description,\n          status,\n          publishedAt,\n          version,\n          grapesHtml,\n          grapesCss,\n          grapesComponents,\n          grapesStyles,\n          homeModules,\n          seoTitle,\n          seoDescription,\n          seoKeywords,\n          ogImage,\n          customCSS,\n          customJS,\n          viewport,\n          lastModified,\n          editHistory\n        }\n      `\n      \n      return await readClient.fetch(query, { id })\n    } catch (error) {\n      console.error('獲取頁面失敗:', error)\n      throw error\n    }\n  }\n\n  /**\n   * 根據 slug 獲取特定頁面\n   */\n  async getPageBySlug(slug: string): Promise<GrapesJSPageData | null> {\n    try {\n      // 驗證參數\n      if (!slug || slug.trim() === '') {\n        console.warn('getPageBySlug: slug 參數為空')\n        return null\n      }\n\n      const query = `\n        *[_type == \"grapesJSPageV2\" && slug.current == $slug][0] {\n          _id,\n          _type,\n          title,\n          slug,\n          description,\n          status,\n          publishedAt,\n          version,\n          grapesHtml,\n          grapesCss,\n          grapesComponents,\n          grapesStyles,\n          homeModules,\n          seoTitle,\n          seoDescription,\n          seoKeywords,\n          ogImage,\n          customCSS,\n          customJS,\n          viewport,\n          lastModified,\n          editHistory\n        }\n      `\n      \n      return await readClient.fetch(query, { slug })\n    } catch (error) {\n      console.error('根據slug獲取頁面失敗:', error)\n      throw error\n    }\n  }\n\n  /**\n   * 創建新頁面\n   */\n  async createPage(params: SavePageParams): Promise<GrapesJSPageData> {\n    try {\n      const writeClient = getWriteClient()\n      const now = new Date().toISOString()\n      \n      const pageData = {\n        _type: 'grapesJSPageV2',\n        title: params.title,\n        slug: {\n          current: params.slug\n        },\n        description: params.description,\n        status: params.status || 'draft',\n        version: 1,\n        grapesHtml: params.grapesHtml,\n        grapesCss: params.grapesCss,\n        grapesComponents: typeof params.grapesComponents === 'string' ? params.grapesComponents : JSON.stringify(params.grapesComponents || []),\n        grapesStyles: typeof params.grapesStyles === 'string' ? params.grapesStyles : JSON.stringify(params.grapesStyles || []),\n        homeModules: params.homeModules || [],\n        seoTitle: params.seoTitle,\n        seoDescription: params.seoDescription,\n        seoKeywords: params.seoKeywords || [],\n        customCSS: params.customCSS,\n        customJS: params.customJS,\n        viewport: params.viewport || 'responsive',\n        createdAt: now,\n        lastModified: now,\n        editHistory: [{\n          timestamp: now,\n          action: 'created',\n          editor: 'GrapesJS Editor',\n          changes: 'Page created'\n        }]\n      }\n\n      const result = await writeClient.create(pageData)\n      console.log('頁面創建成功:', result._id)\n      return result as unknown as GrapesJSPageData\n      \n    } catch (error: any) {\n      console.error('創建頁面失敗:', error)\n      \n      if (error.message?.includes('Insufficient permissions') || error.message?.includes('Unauthorized')) {\n        throw new Error('❌ Sanity 寫入權限不足。請確認您的 token 設定或在 Sanity Studio 中操作。')\n      }\n      \n      if (error.details?.length > 0) {\n        const detailMessages = error.details.map((d: any) => d.message).join(', ')\n        throw new Error('創建頁面失敗: ' + detailMessages)\n      }\n      \n      throw new Error('創建頁面失敗: ' + error.message)\n    }\n  }\n\n  /**\n   * 更新現有頁面\n   */\n  async updatePage(params: UpdatePageParams): Promise<GrapesJSPageData> {\n    try {\n      console.log('🔄 updatePage 開始執行:', {\n        pageId: params._id,\n        title: params.title,\n        status: params.status,\n        hasHtml: !!params.grapesHtml,\n        hasCss: !!params.grapesCss,\n        htmlLength: params.grapesHtml?.length || 0,\n        cssLength: params.grapesCss?.length || 0,\n        componentsLength: typeof params.grapesComponents === 'string' \n          ? params.grapesComponents.length \n          : params.grapesComponents ? JSON.stringify(params.grapesComponents).length : 0,\n        stylesLength: typeof params.grapesStyles === 'string' \n          ? params.grapesStyles.length \n          : params.grapesStyles ? JSON.stringify(params.grapesStyles).length : 0\n      })\n      \n      // 輸入驗證 - 檢查必要參數\n      if (!params._id || params._id.trim() === '') {\n        throw new Error('必須提供有效的頁面 ID')\n      }\n\n      // 檢查 HTML 和 CSS 內容的有效性（如果有提供）\n      if (params.grapesHtml !== undefined) {\n        if (typeof params.grapesHtml !== 'string') {\n          throw new Error('HTML 內容必須是字符串')\n        }\n      }\n      \n      if (params.grapesCss !== undefined) {\n        if (typeof params.grapesCss !== 'string') {\n          throw new Error('CSS 內容必須是字符串')\n        }\n      }\n\n      // 驗證組件和樣式的 JSON 有效性\n      if (params.grapesComponents !== undefined) {\n        try {\n          if (typeof params.grapesComponents !== 'string') {\n            // 如果不是字符串，嘗試序列化\n            params.grapesComponents = JSON.stringify(params.grapesComponents)\n          } else {\n            // 如果是字符串，確保是有效的 JSON\n            JSON.parse(params.grapesComponents)\n          }\n        } catch (jsonError) {\n          console.error('組件 JSON 無效:', jsonError)\n          throw new Error('組件數據格式無效，無法序列化')\n        }\n      }\n      \n      if (params.grapesStyles !== undefined) {\n        try {\n          if (typeof params.grapesStyles !== 'string') {\n            // 如果不是字符串，嘗試序列化\n            params.grapesStyles = JSON.stringify(params.grapesStyles)\n          } else {\n            // 如果是字符串，確保是有效的 JSON\n            JSON.parse(params.grapesStyles)\n          }\n        } catch (jsonError) {\n          console.error('樣式 JSON 無效:', jsonError)\n          throw new Error('樣式數據格式無效，無法序列化')\n        }\n      }\n      \n      // 獲取並驗證客戶端\n      const writeClient = getWriteClient()\n      if (!writeClient) {\n        throw new Error('無法創建 Sanity 寫入客戶端，請檢查配置和權限')\n      }\n      \n      const now = new Date().toISOString()\n      \n      // 取得當前頁面以比較變更，包含錯誤處理\n      console.log('🔍 正在檢查頁面是否存在:', params._id)\n      let currentPage: GrapesJSPageData | null = null\n      \n      try {\n        currentPage = await this.getPageById(params._id)\n      } catch (queryError) {\n        console.error('查詢頁面失敗:', queryError)\n        throw new Error(`無法讀取頁面信息: ${queryError instanceof Error ? queryError.message : '未知錯誤'}`)\n      }\n      \n      if (!currentPage) {\n        console.error('❌ 頁面不存在:', params._id)\n        throw new Error(`找不到 ID 為 ${params._id} 的頁面`)\n      }\n      \n      console.log('✅ 頁面存在，當前狀態:', currentPage.status)\n\n      // 準備更新數據\n      const updateData: any = {\n        lastModified: now,\n        version: (currentPage.version || 1) + 1\n      }\n\n      // 只更新有提供的欄位，並進行額外驗證\n      if (params.title) {\n        if (typeof params.title !== 'string' || params.title.trim() === '') {\n          console.warn('忽略無效的標題值')\n        } else {\n          updateData.title = params.title.trim()\n        }\n      }\n      \n      if (params.slug) {\n        if (typeof params.slug !== 'string' || params.slug.trim() === '') {\n          console.warn('忽略無效的 slug 值')\n        } else {\n          updateData.slug = { current: params.slug.trim() }\n        }\n      }\n      \n      if (params.description !== undefined) updateData.description = params.description\n      if (params.status) {\n        if (['draft', 'preview', 'published', 'archived'].includes(params.status)) {\n          updateData.status = params.status\n        } else {\n          console.warn(`忽略無效的狀態值: ${params.status}`)\n        }\n      }\n      \n      if (params.grapesHtml !== undefined) updateData.grapesHtml = params.grapesHtml\n      if (params.grapesCss !== undefined) updateData.grapesCss = params.grapesCss\n      \n      // 組件和樣式已在之前驗證並標準化\n      if (params.grapesComponents !== undefined) {\n        updateData.grapesComponents = params.grapesComponents\n      }\n      \n      if (params.grapesStyles !== undefined) {\n        updateData.grapesStyles = params.grapesStyles\n      }\n      \n      if (params.homeModules !== undefined) updateData.homeModules = params.homeModules\n      if (params.seoTitle !== undefined) updateData.seoTitle = params.seoTitle\n      if (params.seoDescription !== undefined) updateData.seoDescription = params.seoDescription\n      if (params.seoKeywords) updateData.seoKeywords = params.seoKeywords\n      if (params.customCSS !== undefined) updateData.customCSS = params.customCSS\n      if (params.customJS !== undefined) updateData.customJS = params.customJS\n      if (params.viewport) {\n        if (['responsive', 'desktop', 'tablet', 'mobile'].includes(params.viewport)) {\n          updateData.viewport = params.viewport\n        } else {\n          console.warn(`忽略無效的視口值: ${params.viewport}`)\n        }\n      }\n\n      // 發布狀態變更處理\n      if (params.status === 'published' && currentPage.status !== 'published') {\n        updateData.publishedAt = now\n      }\n\n      // 添加編輯歷史\n      const newHistoryEntry = {\n        timestamp: now,\n        action: 'updated',\n        editor: 'GrapesJS Editor',\n        changes: this.generateChangesSummary(currentPage, params)\n      }\n\n      updateData.editHistory = [\n        ...(currentPage.editHistory || []),\n        newHistoryEntry\n      ]\n      \n      // 實現重試邏輯\n      const maxRetries = 3\n      let retryCount = 0\n      let lastError = null\n      \n      while (retryCount < maxRetries) {\n        try {\n          console.log(`嘗試提交更新到 Sanity (嘗試 ${retryCount + 1}/${maxRetries})`)\n          \n          // 設定超時\n          const timeoutPromise = new Promise((_, reject) => {\n            setTimeout(() => reject(new Error('操作超時')), 15000)\n          })\n          \n          // 執行 Sanity 更新請求\n          const updatePromise = writeClient\n            .patch(params._id)\n            .set(updateData)\n            .commit()\n          \n          // 使用 Promise.race 實現超時處理\n          const result = await Promise.race([\n            updatePromise,\n            timeoutPromise\n          ])\n\n          console.log('✅ Sanity 更新成功:', {\n            pageId: params._id,\n            newStatus: updateData.status,\n            version: updateData.version\n          })\n\n          return result as unknown as GrapesJSPageData\n          \n        } catch (error: any) {\n          lastError = error\n          retryCount++\n          \n          console.error(`Sanity 更新失敗 (嘗試 ${retryCount}/${maxRetries}):`, error)\n          console.error('錯誤詳細信息:', {\n            message: error.message,\n            name: error.name,\n            stack: error.stack,\n            details: error.details || 'No details'\n          })\n          \n          // 如果是權限錯誤，立即失敗不重試\n          if (error.message?.includes('permission') || error.message?.includes('Unauthoriz')) {\n            throw new Error('❌ Sanity 寫入權限不足。請確認您的 token 設定或在 Sanity Studio 中操作。')\n          }\n          \n          // 如果不是最後一次重試，等待後重試\n          if (retryCount < maxRetries) {\n            const delay = 1000 * Math.pow(2, retryCount - 1)\n            console.log(`等待 ${delay}ms 後重試...`)\n            await new Promise(resolve => setTimeout(resolve, delay))\n          }\n        }\n      }\n      \n      // 所有重試都失敗\n      console.error('達到最大重試次數，更新失敗')\n      throw lastError || new Error('更新頁面失敗，請稍後重試')\n      \n    } catch (error: any) {\n      console.error('更新頁面失敗:', error)\n      \n      // 提供更詳細的錯誤信息\n      if (error.message?.includes('Insufficient permissions') || error.message?.includes('Unauthorized')) {\n        throw new Error('❌ Sanity 寫入權限不足。請確認您的 token 設定或在 Sanity Studio 中操作。')\n      } else if (error.message?.includes('timeout') || error.message?.includes('Timeout')) {\n        throw new Error('❌ 更新頁面請求超時。請檢查您的網絡連接並稍後重試。')\n      } else if (error.message?.includes('network') || error.message?.includes('Network')) {\n        throw new Error('❌ 網絡連接問題。請檢查您的網絡連接並稍後重試。')\n      } else if (error.details?.length > 0) {\n        const detailMessages = error.details.map((d: any) => d.message).join(', ')\n        throw new Error('更新頁面失敗: ' + detailMessages)\n      } else {\n        throw new Error('更新頁面失敗: ' + error.message)\n      }\n    }\n  }\n\n  /**\n   * 刪除頁面\n   */\n  async deletePage(id: string): Promise<void> {\n    const writeClient = getWriteClient()\n    await writeClient.delete(id)\n  }\n\n  /**\n   * 複製頁面\n   */\n  async duplicatePage(id: string, newTitle: string, newSlug: string): Promise<GrapesJSPageData> {\n    const originalPage = await this.getPageById(id)\n    if (!originalPage) {\n      throw new Error('Original page not found')\n    }\n\n    const duplicateParams: SavePageParams = {\n      title: newTitle,\n      slug: newSlug,\n      description: originalPage.description,\n      status: 'draft', // 複製的頁面總是從草稿開始\n      grapesHtml: originalPage.grapesHtml || '',\n      grapesCss: originalPage.grapesCss || '',\n      grapesComponents: originalPage.grapesComponents ? JSON.parse(originalPage.grapesComponents) : {},\n      grapesStyles: originalPage.grapesStyles ? JSON.parse(originalPage.grapesStyles) : {},\n      homeModules: originalPage.homeModules || [],\n      seoTitle: originalPage.seoTitle,\n      seoDescription: originalPage.seoDescription,\n      seoKeywords: originalPage.seoKeywords || [],\n      customCSS: originalPage.customCSS,\n      customJS: originalPage.customJS,\n      viewport: originalPage.viewport\n    }\n\n    return await this.createPage(duplicateParams)\n  }\n\n  /**\n   * 獲取已發布的頁面（用於前端顯示）\n   */\n  async getPublishedPages(): Promise<GrapesJSPageData[]> {\n    const query = `\n      *[_type == \"grapesJSPageV2\" && status == \"published\"] | order(publishedAt desc) {\n        _id,\n        _type,\n        title,\n        slug,\n        description,\n        grapesHtml,\n        grapesCss,\n        seoTitle,\n        seoDescription,\n        seoKeywords,\n        ogImage,\n        customCSS,\n        customJS,\n        viewport,\n        publishedAt\n      }\n    `\n    \n    return await readClient.fetch(query)\n  }\n\n  /**\n   * 搜尋頁面\n   */\n  async searchPages(searchTerm: string): Promise<GrapesJSPageData[]> {\n    const query = `\n      *[_type == \"grapesJSPageV2\" && (\n        title match $searchTerm ||\n        description match $searchTerm ||\n        seoTitle match $searchTerm ||\n        seoDescription match $searchTerm\n      )] | order(lastModified desc) {\n        _id,\n        _type,\n        title,\n        slug,\n        description,\n        status,\n        publishedAt,\n        version,\n        lastModified,\n        seoTitle,\n        seoDescription\n      }\n    `\n    \n    return await readClient.fetch(query, { \n      searchTerm: `*${searchTerm}*` \n    })\n  }\n\n  /**\n   * 生成變更摘要\n   */\n  private generateChangesSummary(current: GrapesJSPageData, updates: UpdatePageParams): string {\n    const changes: string[] = []\n    \n    if (updates.title && updates.title !== current.title) {\n      changes.push(`標題: \"${current.title}\" → \"${updates.title}\"`)\n    }\n    if (updates.status && updates.status !== current.status) {\n      changes.push(`狀態: \"${current.status}\" → \"${updates.status}\"`)\n    }\n    if (updates.grapesHtml && updates.grapesHtml !== current.grapesHtml) {\n      changes.push('HTML 內容已更新')\n    }\n    if (updates.grapesCss && updates.grapesCss !== current.grapesCss) {\n      changes.push('CSS 樣式已更新')\n    }\n    if (updates.grapesComponents) {\n      changes.push('頁面組件已更新')\n    }\n    if (updates.homeModules) {\n      changes.push('首頁模組配置已更新')\n    }\n    \n    return changes.length > 0 ? changes.join(', ') : '一般更新'\n  }\n\n  /**\n   * 檢查 slug 是否可用\n   */\n  async isSlugAvailable(slug: string, excludeId?: string): Promise<boolean> {\n    let query = `count(*[_type == \"grapesJSPageV2\" && slug.current == $slug`\n    const params: any = { slug }\n    \n    if (excludeId) {\n      query += ` && _id != $excludeId`\n      params.excludeId = excludeId\n    }\n    \n    query += `])`\n    \n    const count = await readClient.fetch(query, params)\n    return count === 0\n  }\n}\n\n// 匯出單例實例\nexport const grapesJSPageService = new GrapesJSPageService()\nexport default grapesJSPageService\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/services/sanity-media-service.ts","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":12,"column":56,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":12,"endColumn":58,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[307,309],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":13,"column":51,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":13,"endColumn":53,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[372,374],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":16,"column":47,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":16,"endColumn":49,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[480,482],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"sonarjs/prefer-immediate-return","severity":2,"message":"Immediately return this expression instead of assigning it to the temporary variable \"images\".","line":58,"column":20,"nodeType":"AwaitExpression","messageId":"doImmediateAction","endLine":58,"endColumn":60,"fix":{"range":[1216,1289],"text":"return await client.fetch<SanityImage[]>(query)"}},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":61,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":61,"endColumn":18,"suggestions":[{"fix":{"range":[1314,1356],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":81,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":81,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1797,1800],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1797,1800],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":86,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":86,"endColumn":18,"suggestions":[{"fix":{"range":[1903,1946],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":94,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":94,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2044,2047],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2044,2047],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":1,"fixableWarningCount":0,"source":"/**\n * Sanity 媒體庫服務\n * 提供 GrapesJS 與 Sanity 媒體庫的整合功能\n */\n\nimport { client } from '@/sanity-client/client'\nimport { createClient } from '@sanity/client'\nimport imageUrlBuilder from '@sanity/image-url'\n\n// 創建具有寫入權限的客戶端\nconst writeClient = createClient({\n  projectId: process.env.NEXT_PUBLIC_SANITY_PROJECT_ID || 'm7o2mv1n',\n  dataset: process.env.NEXT_PUBLIC_SANITY_DATASET || 'production',\n  apiVersion: '2023-05-30',\n  useCdn: false,\n  token: process.env.NEXT_PUBLIC_SANITY_TOKEN || process.env.SANITY_API_TOKEN\n})\n\nexport interface SanityImage {\n  _id: string\n  _type: 'sanity.imageAsset'\n  url: string\n  originalFilename?: string\n  size?: number\n  metadata: {\n    dimensions: {\n      width: number\n      height: number\n    }\n    format: string\n  }\n  _createdAt: string\n  _updatedAt: string\n}\n\n/**\n * 獲取 Sanity 媒體庫中的所有圖片\n */\nexport async function getSanityImages(): Promise<SanityImage[]> {\n  try {\n    const query = `*[_type == \"sanity.imageAsset\"] | order(_createdAt desc) [0...50] {\n      _id,\n      _type,\n      url,\n      originalFilename,\n      size,\n      metadata {\n        dimensions {\n          width,\n          height\n        },\n        format\n      },\n      _createdAt,\n      _updatedAt\n    }`\n    \n    const images = await client.fetch<SanityImage[]>(query)\n    return images\n  } catch (error) {\n    console.error('獲取 Sanity 圖片時發生錯誤:', error)\n    return []\n  }\n}\n\n/**\n * 上傳圖片到 Sanity\n */\nexport async function uploadImageToSanity(file: File): Promise<SanityImage | null> {\n  try {\n    const asset = await writeClient.assets.upload('image', file, {\n      filename: file.name\n    })\n    \n    return {\n      _id: asset._id,\n      _type: 'sanity.imageAsset',\n      url: asset.url,\n      originalFilename: asset.originalFilename,\n      size: asset.size,\n      metadata: asset.metadata as any,\n      _createdAt: asset._createdAt,\n      _updatedAt: asset._updatedAt\n    }\n  } catch (error) {\n    console.error('上傳圖片到 Sanity 時發生錯誤:', error)\n    return null\n  }\n}\n\n/**\n * 生成 Sanity 圖片 URL 與參數\n */\nconst builder = imageUrlBuilder(client as any)\n\nexport function buildSanityImageUrl(image: SanityImage, width?: number, height?: number, quality?: number): string {\n  try {\n    let b = builder.image(image).auto('format')\n    if (width) b = b.width(width)\n    if (height) b = b.height(height)\n    if (quality) b = b.quality(quality)\n    // 預設以 cover/max 方式縮放，避免拉伸\n    b = b.fit('max')\n    return b.url()\n  } catch {\n    // 後備：回退至原始 URL（不含轉換參數）\n    return image.url\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/store-name.ts","messages":[{"ruleId":"sonarjs/prefer-immediate-return","severity":2,"message":"Immediately return this expression instead of assigning it to the temporary variable \"headerData\".","line":12,"column":24,"nodeType":"AwaitExpression","messageId":"doImmediateAction","endLine":12,"endColumn":41,"fix":{"range":[223,281],"text":"return await getHeader()"}},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":15,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":15,"endColumn":18,"suggestions":[{"fix":{"range":[306,346],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":27,"column":34,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":27,"endColumn":36,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[561,563],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":29,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":29,"endColumn":18,"suggestions":[{"fix":{"range":[607,641],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":40,"column":34,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":40,"endColumn":36,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[841,843],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":42,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":42,"endColumn":18,"suggestions":[{"fix":{"range":[887,925],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import { getHeader } from \"./sanity\"\n\n// 默認店名，當 Sanity 數據不可用時使用\nconst DEFAULT_STORE_NAME = \"TIMS FANTACY WORLD\"\nconst DEFAULT_LOGO_WIDTH = 150\n\n/**\n * 獲取完整的 header 數據\n */\nexport async function getHeaderData() {\n  try {\n    const headerData = await getHeader()\n    return headerData\n  } catch (error) {\n    console.error(\"獲取 header 數據時出錯:\", error)\n    return null\n  }\n}\n\n/**\n * 獲取商店名稱的通用函數\n * 首先嘗試從 Sanity 獲取，如果失敗則使用默認值\n */\nexport async function getStoreName(): Promise<string> {\n  try {\n    const headerData = await getHeader()\n    return headerData?.storeName || DEFAULT_STORE_NAME\n  } catch (error) {\n    console.error(\"獲取商店名稱時出錯:\", error)\n    return DEFAULT_STORE_NAME\n  }\n}\n\n/**\n * 獲取 Logo 寬度設定\n */\nexport async function getLogoWidth(): Promise<number> {\n  try {\n    const headerData = await getHeader()\n    return headerData?.logoWidth || DEFAULT_LOGO_WIDTH\n  } catch (error) {\n    console.error(\"獲取 Logo 寬度時出錯:\", error)\n    return DEFAULT_LOGO_WIDTH\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/types/footer.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/types/main-section.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/types/page-sections.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/types/pages.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/types/sanity.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":57,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[928,931],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[928,931],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"export interface SanityImageCrop {\n  _type: 'sanity.imageCrop'\n  top: number\n  bottom: number\n  left: number\n  right: number\n}\n\nexport interface SanityImageHotspot {\n  _type: 'sanity.imageHotspot'\n  x: number\n  y: number\n  height: number\n  width: number\n}\n\nexport interface SanityImage {\n  _type: 'image'\n  asset: {\n    _ref: string\n    _type: 'reference'\n  }\n  crop?: SanityImageCrop\n  hotspot?: SanityImageHotspot\n}\n\nexport interface FeaturedProduct {\n  heading: string\n  showHeading: boolean\n  showSubheading: boolean\n  collection_id: string\n  isActive: boolean\n}\n\nexport interface BlogPost {\n  _id: string\n  _type: 'post'\n  title: string\n  slug: {\n    current: string\n    _type: 'slug'\n  }\n  mainImage: {\n    asset: {\n      url: string\n      _ref: string\n      _type: 'reference'\n    }\n  }\n  publishedAt: string\n  excerpt?: string\n  categories?: Category[]\n  author?: {\n    name: string\n    image?: SanityImage\n  }\n  body?: any // Portable Text 內容\n  status?: string\n}\n\nexport interface Category {\n  _id: string\n  _type: 'category'\n  title: string\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/types/sections.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/types/service-cards.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/util/absolute-url.ts","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":5,"column":44,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":5,"endColumn":46,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[154,156],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":6,"column":30,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":6,"endColumn":32,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[193,195],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { headers } from 'next/headers'\n\nexport async function getRequestOrigin() {\n  const h = await headers()\n  const proto = h.get('x-forwarded-proto') || 'http'\n  const host = h.get('host') || 'localhost:8000'\n  return `${proto}://${host}`\n}\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/util/cn.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/util/compare-addresses.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[91,94],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[91,94],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[106,109],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[106,109],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { isEqual, pick } from \"lodash\"\n\nexport default function compareAddresses(address1: any, address2: any) {\n  return isEqual(\n    pick(address1, [\n      \"first_name\",\n      \"last_name\",\n      \"address_1\",\n      \"company\",\n      \"postal_code\",\n      \"city\",\n      \"country_code\",\n      \"province\",\n      \"phone\",\n    ]),\n    pick(address2, [\n      \"first_name\",\n      \"last_name\",\n      \"address_1\",\n      \"company\",\n      \"postal_code\",\n      \"city\",\n      \"country_code\",\n      \"province\",\n      \"phone\",\n    ])\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/util/env.ts","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":2,"column":43,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":2,"endColumn":45,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[76,78],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"export const getBaseURL = () => {\n  return process.env.NEXT_PUBLIC_BASE_URL || \"https://localhost:8000\"\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/util/get-precentage-diff.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/util/get-product-price.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":5,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[190,193],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[190,193],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":38,"column":7,"nodeType":null,"messageId":"preferOptionalChain","endLine":38,"endColumn":30,"fix":{"range":[1245,1268],"text":"!product?.id"}},{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":43,"column":9,"nodeType":null,"messageId":"preferOptionalChain","endLine":43,"endColumn":46,"fix":{"range":[1360,1397],"text":"!product?.variants?.length"}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":47,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1453,1456],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1453,1456],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":48,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1494,1497],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1494,1497],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":49,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1540,1543],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1540,1543],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":49,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1548,1551],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1548,1551],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":64,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1856,1859],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1856,1859],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":2,"fixableWarningCount":0,"source":"import { HttpTypes } from \"@medusajs/types\"\nimport { getPercentageDiff } from \"./get-precentage-diff\"\nimport { convertToLocale } from \"./money\"\n\nexport const getPricesForVariant = (variant: any) => {\n  if (!variant?.calculated_price?.calculated_amount) {\n    return null\n  }\n\n  return {\n    calculated_price_number: variant.calculated_price.calculated_amount,\n    calculated_price: convertToLocale({\n      amount: variant.calculated_price.calculated_amount,\n      currency_code: variant.calculated_price.currency_code,\n    }),\n    original_price_number: variant.calculated_price.original_amount,\n    original_price: convertToLocale({\n      amount: variant.calculated_price.original_amount,\n      currency_code: variant.calculated_price.currency_code,\n    }),\n    currency_code: variant.calculated_price.currency_code,\n    amount: variant.calculated_price.calculated_amount, // 新增 amount 屬性\n    price_type: variant.calculated_price.calculated_price.price_list_type,\n    percentage_diff: getPercentageDiff(\n      variant.calculated_price.original_amount,\n      variant.calculated_price.calculated_amount\n    ),\n  }\n}\n\nexport function getProductPrice({\n  product,\n  variantId,\n}: {\n  product: HttpTypes.StoreProduct\n  variantId?: string\n}) {\n  if (!product || !product.id) {\n    throw new Error(\"No product provided\")\n  }\n\n  const cheapestPrice = () => {\n    if (!product || !product.variants?.length) {\n      return null\n    }\n\n    const cheapestVariant: any = product.variants\n      .filter((v: any) => !!v.calculated_price)\n      .sort((a: any, b: any) => {\n        return (\n          a.calculated_price.calculated_amount -\n          b.calculated_price.calculated_amount\n        )\n      })[0]\n\n    return getPricesForVariant(cheapestVariant)\n  }\n\n  const variantPrice = () => {\n    if (!product || !variantId) {\n      return null\n    }\n\n    const variant: any = product.variants?.find(\n      (v) => v.id === variantId || v.sku === variantId\n    )\n\n    if (!variant) {\n      return null\n    }\n\n    return getPricesForVariant(variant)\n  }\n\n  return {\n    product,\n    cheapestPrice: cheapestPrice(),\n    variantPrice: variantPrice(),\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/util/isEmpty.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[32,35],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[32,35],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[95,98],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[95,98],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[155,158],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[155,158],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":8,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[318,321],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[318,321],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"export const isObject = (input: any) => input instanceof Object\nexport const isArray = (input: any) => Array.isArray(input)\nexport const isEmpty = (input: any) => {\n  return (\n    input === null ||\n    input === undefined ||\n    (isObject(input) && Object.keys(input).length === 0) ||\n    (isArray(input) && (input as any[]).length === 0) ||\n    (typeof input === \"string\" && input.trim().length === 0)\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/util/medusa-error.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[43,46],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[43,46],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":7,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":7,"endColumn":20,"suggestions":[{"fix":{"range":[313,353],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":8,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":8,"endColumn":20,"suggestions":[{"fix":{"range":[360,412],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":9,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":9,"endColumn":20,"suggestions":[{"fix":{"range":[419,471],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":10,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":10,"endColumn":20,"suggestions":[{"fix":{"range":[478,527],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":14,"column":49,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":14,"endColumn":51,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[642,644],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"export default function medusaError(error: any): never {\n  if (error.response) {\n    // The request was made and the server responded with a status code\n    // that falls out of the range of 2xx\n    const u = new URL(error.config.url, error.config.baseURL)\n    if (process.env.NODE_ENV === 'development') {\n      console.error(\"Resource:\", u.toString())\n      console.error(\"Response data:\", error.response.data)\n      console.error(\"Status code:\", error.response.status)\n      console.error(\"Headers:\", error.response.headers)\n    }\n\n    // Extracting the error message from the response data\n    const message = error.response.data.message || error.response.data\n\n    throw new Error(message.charAt(0).toUpperCase() + message.slice(1) + \".\")\n  } else if (error.request) {\n    // The request was made but no response was received\n    throw new Error(\"No response received: \" + error.request)\n  } else {\n    // Something happened in setting up the request that triggered an Error\n    throw new Error(\"Error setting up the request: \" + error.message)\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/util/money.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/util/product-type-converter.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/util/product.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/util/promotion-utils.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'GOLD_COIN_STYLE' is assigned a value but never used.","line":81,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":81,"endColumn":22},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'GOLD_COIN_STYLE' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":81,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":81,"endColumn":22},{"ruleId":"sonarjs/cognitive-complexity","severity":2,"message":"Refactor this function to reduce its Cognitive Complexity from 32 to the 15 allowed.","line":178,"column":10,"nodeType":null,"messageId":"refactorFunction","endLine":178,"endColumn":27},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":180,"column":37,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":180,"endColumn":39,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[5445,5447],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"sonarjs/no-duplicate-string","severity":2,"message":"Define a constant instead of duplicating this literal 5 times.","line":188,"column":15,"nodeType":"Literal","endLine":188,"endColumn":32},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":299,"column":41,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":299,"endColumn":43,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[9019,9021],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"sonarjs/no-duplicate-string","severity":2,"message":"Define a constant instead of duplicating this literal 6 times.","line":302,"column":13,"nodeType":"Literal","endLine":302,"endColumn":26},{"ruleId":"sonarjs/cognitive-complexity","severity":2,"message":"Refactor this function to reduce its Cognitive Complexity from 21 to the 15 allowed.","line":321,"column":17,"nodeType":null,"messageId":"refactorFunction","endLine":321,"endColumn":35},{"ruleId":"sonarjs/no-duplicate-string","severity":2,"message":"Define a constant instead of duplicating this literal 6 times.","line":360,"column":13,"nodeType":"Literal","endLine":360,"endColumn":28},{"ruleId":"sonarjs/no-duplicate-string","severity":2,"message":"Define a constant instead of duplicating this literal 9 times.","line":363,"column":18,"nodeType":"Literal","endLine":363,"endColumn":119},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":380,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":380,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11412,11415],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11412,11415],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":380,"column":79,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":380,"endColumn":81,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[11445,11447],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"sonarjs/cognitive-complexity","severity":2,"message":"Refactor this function to reduce its Cognitive Complexity from 22 to the 15 allowed.","line":480,"column":23,"nodeType":null,"messageId":"refactorFunction","endLine":480,"endColumn":45},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":648,"column":49,"nodeType":"MemberExpression","messageId":"unexpected","endLine":648,"endColumn":62},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":675,"column":49,"nodeType":"MemberExpression","messageId":"unexpected","endLine":675,"endColumn":62},{"ruleId":"sonarjs/cognitive-complexity","severity":2,"message":"Refactor this function to reduce its Cognitive Complexity from 64 to the 15 allowed.","line":693,"column":23,"nodeType":null,"messageId":"refactorFunction","endLine":693,"endColumn":47},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":716,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":716,"endColumn":19},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":716,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":716,"endColumn":19},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":717,"column":49,"nodeType":"MemberExpression","messageId":"unexpected","endLine":717,"endColumn":61},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":735,"column":49,"nodeType":"MemberExpression","messageId":"unexpected","endLine":735,"endColumn":62},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":762,"column":51,"nodeType":"MemberExpression","messageId":"unexpected","endLine":762,"endColumn":64},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":768,"column":60,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":768,"endColumn":62,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[22156,22158],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'finalPrice' is assigned a value but never used.","line":769,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":769,"endColumn":21},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'finalPrice' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":769,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":769,"endColumn":21},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":769,"column":48,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":769,"endColumn":50,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[22208,22210],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":770,"column":60,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":770,"endColumn":62,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[22272,22274],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":773,"column":53,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":773,"endColumn":55,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[22349,22351],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":782,"column":39,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":782,"endColumn":41,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[22734,22736],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"sonarjs/no-duplicated-branches","severity":2,"message":"This branch's code block is the same as the block for the branch on line 825.","line":828,"column":20,"nodeType":"BlockStatement","messageId":"sameConditionalBlock","endLine":832,"endColumn":14},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":896,"column":49,"nodeType":"MemberExpression","messageId":"unexpected","endLine":896,"endColumn":61},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":903,"column":49,"nodeType":"MemberExpression","messageId":"unexpected","endLine":903,"endColumn":62}],"suppressedMessages":[],"errorCount":23,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { HttpTypes } from \"@medusajs/types\"\nimport { getProductPromotions, getProductInventoryStatus } from \"../data/promotions\"\n\n// 促銷標籤類型定義\nexport type PromotionLabelType = \n  | 'auto-discount'      // 自動計算折扣\n  | 'manual-discount'    // 手動設置折扣\n  | 'promotion'          // 自定義促銷文字\n  | 'campaign'           // 促銷活動\n  | 'discount-code'      // 折扣碼提示\n  | 'new'                // 新品\n  | 'hot'                // 熱銷\n  | 'limited'            // 限量\n  | 'bestseller'         // 暢銷\n  | 'featured'           // 精選\n  | 'sale'               // 特價\n  | 'special-event'      // 特殊活動\n  | 'preorder'           // 預訂\n  | 'sold-out'           // 售完\n  | 'bundle'             // 組合優惠\n  | 'buy-x-get-y'        // 買X送Y\n  | 'flash-sale'         // 限時搶購\n  | 'clearance'          // 清倉\n  | 'exclusive'          // 獨家\n\nexport interface PromotionLabel {\n  type: PromotionLabelType\n  text: string\n  priority: number\n  className: string\n  isDiscount?: boolean\n}\n\n// 標籤優先級配置（數字越小優先級越高）\nconst LABEL_PRIORITIES: Record<PromotionLabelType, number> = {\n  'sold-out': 1,\n  'flash-sale': 2,\n  'auto-discount': 3,\n  'manual-discount': 4,\n  'clearance': 5,\n  'campaign': 6,\n  'bundle': 7,\n  'buy-x-get-y': 8,\n  'exclusive': 9,\n  'limited': 10,\n  'promotion': 11,\n  'special-event': 12,\n  'discount-code': 13,\n  'preorder': 14,\n  'new': 15,\n  'hot': 16,\n  'bestseller': 17,\n  'featured': 18,\n  'sale': 19,\n}\n\n// 標籤文字對照表\nconst LABEL_TEXTS: Record<PromotionLabelType, string> = {\n  'auto-discount': '{discount}% OFF',\n  'manual-discount': '{text}',\n  'promotion': '{text}',\n  'campaign': '{text}',\n  'discount-code': '輸入折扣碼享優惠',\n  'new': 'NEW',\n  'hot': 'HOT',\n  'limited': 'LIMITED',\n  'bestseller': 'BEST',\n  'featured': 'FEATURED',\n  'sale': 'SALE',\n  'special-event': '{text}',\n  'preorder': '預訂',\n  'sold-out': '售完',\n  'bundle': '組合優惠',\n  'buy-x-get-y': '送禮',\n  'flash-sale': '限時搶購',\n  'clearance': '清倉特價',\n  'exclusive': '獨家',\n}\n\n// 統一的金幣樣式類別\nconst GOLD_COIN_STYLE = 'px-4 py-2 text-xs font-bold rounded-full shadow-2xl border-2 bg-gradient-to-br from-yellow-300 via-yellow-400 to-amber-500 text-amber-900 border-yellow-200 backdrop-blur-sm gold-shimmer gold-rivet-label transform hover:scale-105 transition-all duration-200'\n\n// 計算商品折扣資訊\nexport function calculateProductDiscount(product: HttpTypes.StoreProduct) {\n  if (!product.variants || product.variants.length === 0) {\n    return { hasDiscount: false, discountPercentage: 0, maxDiscount: 0, averageDiscount: 0 }\n  }\n\n  let maxDiscountPercentage = 0\n  let totalDiscount = 0\n  let discountedVariants = 0\n  let hasAnyDiscount = false\n\n  product.variants.forEach(variant => {\n    if (variant.calculated_price) {\n      const calculatedAmount = variant.calculated_price.calculated_amount\n      const originalAmount = variant.calculated_price.original_amount\n      \n      if (originalAmount && calculatedAmount && originalAmount > calculatedAmount) {\n        const discountPercentage = Math.round(((originalAmount - calculatedAmount) / originalAmount) * 100)\n        if (discountPercentage > maxDiscountPercentage) {\n          maxDiscountPercentage = discountPercentage\n        }\n        totalDiscount += discountPercentage\n        discountedVariants++\n        hasAnyDiscount = true\n      }\n    }\n  })\n\n  const averageDiscount = discountedVariants > 0 ? Math.round(totalDiscount / discountedVariants) : 0\n\n  return {\n    hasDiscount: hasAnyDiscount,\n    discountPercentage: maxDiscountPercentage,\n    maxDiscount: maxDiscountPercentage,\n    averageDiscount\n  }\n}\n\n// 檢查商品庫存狀態\nexport function getProductStockStatus(product: HttpTypes.StoreProduct) {\n  if (!product.variants || product.variants.length === 0) {\n    return { isOutOfStock: false, canPreorder: false, isSoldOut: false, hasStock: true }\n  }\n  \n  const allVariantsStatus = product.variants.map(variant => {\n    // 如果不管理庫存，則永遠有庫存\n    if (!variant.manage_inventory) {\n      return { hasStock: true, canPreorder: false, isSoldOut: false }\n    }\n    \n    // 檢查庫存數量\n    const hasStock = variant.inventory_quantity !== undefined && variant.inventory_quantity > 0\n    \n    if (hasStock) {\n      return { hasStock: true, canPreorder: false, isSoldOut: false }\n    } else {\n      if (variant.allow_backorder) {\n        return { hasStock: false, canPreorder: true, isSoldOut: false }\n      } else {\n        return { hasStock: false, canPreorder: false, isSoldOut: true }\n      }\n    }\n  })\n  \n  const hasAnyStock = allVariantsStatus.some(status => status.hasStock)\n  const canAnyPreorder = allVariantsStatus.some(status => status.canPreorder)\n  const allSoldOut = allVariantsStatus.every(status => status.isSoldOut)\n  \n  return {\n    isOutOfStock: !hasAnyStock,\n    canPreorder: !hasAnyStock && canAnyPreorder,\n    isSoldOut: allSoldOut,\n    hasStock: hasAnyStock\n  }\n}\n\n// 格式化折扣文字\nfunction formatDiscountText(text: string): string {\n  if (!text || typeof text !== 'string') return ''\n  \n  let displayText = text.trim()\n  \n  // 智能格式化折扣文字\n  if (!displayText.includes('%') && !displayText.toLowerCase().includes('off') && !displayText.toLowerCase().includes('折')) {\n    if (/^\\d+$/.test(displayText)) {\n      displayText = `${displayText}% OFF`\n    }\n  } else if (displayText.includes('%') && !displayText.toLowerCase().includes('off')) {\n    displayText = `${displayText} OFF`\n  }\n  \n  return displayText\n}\n\n// 從 metadata 獲取促銷標籤\nfunction getMetadataLabels(product: HttpTypes.StoreProduct): PromotionLabel[] {\n  const labels: PromotionLabel[] = []\n  const metadata = product.metadata || {}\n\n  // 手動設置的折扣標籤\n  const discount = metadata.discount\n  if (discount && typeof discount === 'string' && discount.trim()) {\n    const displayText = formatDiscountText(discount)\n    if (displayText) {\n      labels.push({\n        type: 'manual-discount',\n        text: displayText,\n        priority: LABEL_PRIORITIES['manual-discount'],\n        className: 'product-label discount',\n        isDiscount: true\n      })\n    }\n  }\n\n  // 促銷活動標籤\n  const promotion = metadata.promotion\n  const promotionType = metadata.promotion_type\n  \n  if (promotion && typeof promotion === 'string' && promotion.trim()) {\n    const safePromotionType = (promotionType && typeof promotionType === 'string') ? promotionType : 'promotion'\n    labels.push({\n      type: 'promotion',\n      text: promotion.trim(),\n      priority: LABEL_PRIORITIES['promotion'],\n      className: `product-label ${safePromotionType.toLowerCase()}`\n    })\n  } else if (promotionType && typeof promotionType === 'string' && promotionType !== 'none') {\n    const labelText = LABEL_TEXTS[promotionType as PromotionLabelType]\n    if (labelText && labelText !== '{text}') {\n      labels.push({\n        type: promotionType as PromotionLabelType,\n        text: labelText,\n        priority: LABEL_PRIORITIES[promotionType as PromotionLabelType] || 99,\n        className: `product-label ${promotionType.toLowerCase()}`\n      })\n    }\n  }\n\n  // 特殊活動標籤\n  const specialEvent = metadata.special_event\n  if (specialEvent && typeof specialEvent === 'string' && specialEvent.trim()) {\n    labels.push({\n      type: 'special-event',\n      text: specialEvent.trim(),\n      priority: LABEL_PRIORITIES['special-event'],\n      className: 'product-label special-event'\n    })\n  }\n\n  // 活動類型標籤\n  const campaign = metadata.campaign\n  if (campaign && typeof campaign === 'string' && campaign.trim()) {\n    labels.push({\n      type: 'campaign',\n      text: campaign.trim(),\n      priority: LABEL_PRIORITIES['campaign'],\n      className: 'product-label campaign'\n    })\n  }\n\n  // 組合優惠標籤\n  const bundle = metadata.bundle\n  if (bundle && typeof bundle === 'string' && bundle.trim()) {\n    labels.push({\n      type: 'bundle',\n      text: bundle.trim(),\n      priority: LABEL_PRIORITIES['bundle'],\n      className: 'product-label bundle'\n    })\n  }\n\n  // 限時搶購標籤\n  const flashSale = metadata.flash_sale\n  if (flashSale && (flashSale === 'true' || flashSale === true)) {\n    labels.push({\n      type: 'flash-sale',\n      text: LABEL_TEXTS['flash-sale'],\n      priority: LABEL_PRIORITIES['flash-sale'],\n      className: 'product-label flash-sale'\n    })\n  }\n\n  // 清倉標籤\n  const clearance = metadata.clearance\n  if (clearance && (clearance === 'true' || clearance === true)) {\n    labels.push({\n      type: 'clearance',\n      text: LABEL_TEXTS['clearance'],\n      priority: LABEL_PRIORITIES['clearance'],\n      className: 'product-label clearance'\n    })\n  }\n\n  // 獨家標籤\n  const exclusive = metadata.exclusive\n  if (exclusive && (exclusive === 'true' || exclusive === true)) {\n    labels.push({\n      type: 'exclusive',\n      text: LABEL_TEXTS['exclusive'],\n      priority: LABEL_PRIORITIES['exclusive'],\n      className: 'product-label exclusive'\n    })\n  }\n\n  // 折扣碼提示標籤\n  const discountCode = metadata.discount_code_available\n  if (discountCode && (discountCode === 'true' || discountCode === true)) {\n    labels.push({\n      type: 'discount-code',\n      text: LABEL_TEXTS['discount-code'],\n      priority: LABEL_PRIORITIES['discount-code'],\n      className: 'product-label discount-code'\n    })\n  }\n\n  // 買X送Y標籤\n  const buyXGetY = metadata.buy_x_get_y || metadata.buyXGetY\n  if (buyXGetY && typeof buyXGetY === 'string' && buyXGetY.trim()) {\n    labels.push({\n      type: 'buy-x-get-y',\n      text: buyXGetY.trim(),\n      priority: LABEL_PRIORITIES['buy-x-get-y'],\n      className: 'product-label buy-x-get-y'\n    })\n  } else if (buyXGetY && (buyXGetY === 'true' || buyXGetY === true)) {\n    // 如果只是標記為 true，使用預設文字\n    labels.push({\n      type: 'buy-x-get-y',\n      text: LABEL_TEXTS['buy-x-get-y'],\n      priority: LABEL_PRIORITIES['buy-x-get-y'],\n      className: 'product-label buy-x-get-y'\n    })\n  }\n\n  return labels\n}\n\n// 獲取所有促銷標籤\nexport function getPromotionLabels(product: HttpTypes.StoreProduct): PromotionLabel[] {\n  const labels: PromotionLabel[] = []\n  \n  // 計算折扣資訊\n  const discountInfo = calculateProductDiscount(product)\n  \n  // 獲取庫存狀態\n  const stockStatus = getProductStockStatus(product)\n  \n  // 1. 庫存狀態標籤（最高優先級，始終顯示）\n  if (stockStatus.isSoldOut) {\n    labels.push({\n      type: 'sold-out',\n      text: LABEL_TEXTS['sold-out'],\n      priority: LABEL_PRIORITIES['sold-out'],\n      className: 'product-label sold-out'\n    })\n  } else if (stockStatus.canPreorder) {\n    labels.push({\n      type: 'preorder',\n      text: LABEL_TEXTS['preorder'],\n      priority: LABEL_PRIORITIES['preorder'],\n      className: 'product-label preorder'\n    })\n  }\n  \n  // 如果商品已售完，不顯示其他促銷標籤\n  if (stockStatus.isSoldOut) {\n    return labels\n  }\n\n  // 2. 自動計算的折扣標籤（基於 Medusa 真實價格計算）\n  if (discountInfo.hasDiscount && discountInfo.discountPercentage > 0) {\n    const taiwanDiscount = (100 - discountInfo.discountPercentage) / 10 // 轉換成台灣折扣表示法\n    const discountText = taiwanDiscount === Math.floor(taiwanDiscount) \n      ? `${taiwanDiscount}折` \n      : `${taiwanDiscount.toFixed(1)}折`\n    \n    labels.push({\n      type: 'auto-discount',\n      text: discountText,\n      priority: LABEL_PRIORITIES['auto-discount'],\n      className: 'px-2 py-1 text-xs font-semibold rounded-md shadow-lg border bg-stone-800/90 text-white border-white',\n      isDiscount: true\n    })\n  }\n\n  // 3. 從 metadata 獲取促銷標籤\n  const metadataLabels = getMetadataLabels(product)\n  metadataLabels.forEach(label => {\n    // 如果已經有自動折扣，跳過手動折扣標籤以避免重複\n    if (label.type === 'manual-discount' && discountInfo.hasDiscount) {\n      return\n    }\n    labels.push(label)\n  })\n\n  // 4. 從產品標籤 (tags) 中提取促銷資訊\n  if (product.tags && product.tags.length > 0) {\n    const tagValues = product.tags.map((tag: any) => tag.value?.toLowerCase() || \"\")\n    \n    // 新品標籤\n    if (tagValues.includes(\"new\") || tagValues.includes(\"新品\")) {\n      labels.push({\n        type: 'new',\n        text: LABEL_TEXTS['new'],\n        priority: LABEL_PRIORITIES['new'],\n        className: 'product-label new'\n      })\n    }\n    \n    // 熱銷標籤\n    if (tagValues.includes(\"hot\") || tagValues.includes(\"熱銷\")) {\n      labels.push({\n        type: 'hot',\n        text: LABEL_TEXTS['hot'],\n        priority: LABEL_PRIORITIES['hot'],\n        className: 'product-label hot'\n      })\n    }\n    \n    // 限量標籤\n    if (tagValues.includes(\"limited\") || tagValues.includes(\"限量\")) {\n      labels.push({\n        type: 'limited',\n        text: LABEL_TEXTS['limited'],\n        priority: LABEL_PRIORITIES['limited'],\n        className: 'product-label limited'\n      })\n    }\n    \n    // 暢銷標籤\n    if (tagValues.includes(\"bestseller\") || tagValues.includes(\"暢銷\")) {\n      labels.push({\n        type: 'bestseller',\n        text: LABEL_TEXTS['bestseller'],\n        priority: LABEL_PRIORITIES['bestseller'],\n        className: 'product-label bestseller'\n      })\n    }\n    \n    // 精選標籤\n    if (tagValues.includes(\"featured\") || tagValues.includes(\"精選\")) {\n      labels.push({\n        type: 'featured',\n        text: LABEL_TEXTS['featured'],\n        priority: LABEL_PRIORITIES['featured'],\n        className: 'product-label featured'\n      })\n    }\n    \n    // 買X送Y標籤\n    if (tagValues.includes(\"buy-x-get-y\") || tagValues.includes(\"buyxgety\") || \n        tagValues.includes(\"買送\") || tagValues.includes(\"贈品\") ||\n        tagValues.includes(\"買1送1\") || tagValues.includes(\"買2送1\") || tagValues.includes(\"買3送1\")) {\n      labels.push({\n        type: 'buy-x-get-y',\n        text: LABEL_TEXTS['buy-x-get-y'],\n        priority: LABEL_PRIORITIES['buy-x-get-y'],\n        className: 'product-label buy-x-get-y'\n      })\n    }\n  }\n\n  // 按優先級排序（無數量限制）\n  return labels\n    .sort((a, b) => a.priority - b.priority)\n}\n\n// 為了除錯，提供詳細的標籤分析\nexport function debugPromotionLabels(product: HttpTypes.StoreProduct) {\n  const discountInfo = calculateProductDiscount(product)\n  const stockStatus = getProductStockStatus(product)\n  const labels = getPromotionLabels(product)\n  \n  return {\n    productTitle: product.title,\n    discountInfo,\n    stockStatus,\n    metadata: product.metadata,\n    generatedLabels: labels,\n    variantPrices: product.variants?.map(v => ({\n      id: v.id,\n      title: v.title,\n      original: v.calculated_price?.original_amount,\n      calculated: v.calculated_price?.calculated_amount,\n      currency: v.calculated_price?.currency_code\n    }))\n  }\n}\n\n\n\n/**\n * 從真實 Medusa API 獲取促銷標籤\n * @param product 產品資料\n * @param regionId 地區 ID，預設為台灣地區\n * @returns Promise<PromotionLabel[]>\n */\nexport async function getRealPromotionLabels(\n  product: HttpTypes.StoreProduct,\n  regionId: string = 'reg_01JW1S1F7GB4ZP322G2DMETETH'\n): Promise<PromotionLabel[]> {\n  try {\n    const [promotionData, inventoryData] = await Promise.all([\n      getProductPromotions(product.id, regionId),\n      getProductInventoryStatus(product.id, regionId)\n    ])\n\n    const labels: PromotionLabel[] = []\n\n    // 折扣標籤\n    if (promotionData.discountPercentage && promotionData.discountPercentage > 0) {\n      labels.push({\n        type: 'auto-discount',\n        text: `-${promotionData.discountPercentage}%`,\n        priority: LABEL_PRIORITIES['auto-discount'],\n        className: 'px-2 py-1 text-xs font-semibold rounded-md shadow-lg border bg-stone-800/90 text-white border-white',\n        isDiscount: true\n      })\n    }\n\n    // 限時搶購\n    if (promotionData.hasFlashSale) {\n      labels.push({\n        type: 'flash-sale',\n        text: '限時搶購',\n        priority: LABEL_PRIORITIES['flash-sale'],\n        className: 'px-2 py-1 text-xs font-semibold rounded-md shadow-lg border bg-stone-800/90 text-white border-white'\n      })\n    }\n\n    // 新品標籤\n    if (promotionData.isNew) {\n      labels.push({\n        type: 'new',\n        text: '新品',\n        priority: LABEL_PRIORITIES['new'],\n        className: 'px-2 py-1 text-xs font-semibold rounded-md shadow-lg border bg-stone-800/90 text-white border-white'\n      })\n    }\n\n    // 熱銷標籤\n    if (promotionData.isHot) {\n      labels.push({\n        type: 'hot',\n        text: '熱銷',\n        priority: LABEL_PRIORITIES['hot'],\n        className: 'px-2 py-1 text-xs font-semibold rounded-md shadow-lg border bg-stone-800/90 text-white border-white'\n      })\n    }\n\n    // 限量標籤\n    if (promotionData.isLimited) {\n      labels.push({\n        type: 'limited',\n        text: '限量',\n        priority: LABEL_PRIORITIES['limited'],\n        className: 'product-label limited'\n      })\n    }\n\n    // 暢銷標籤\n    if (promotionData.isBestseller) {\n      labels.push({\n        type: 'bestseller',\n        text: '暢銷',\n        priority: LABEL_PRIORITIES['bestseller'],\n        className: 'product-label bestseller'\n      })\n    }\n\n    // 精選標籤\n    if (promotionData.isFeatured) {\n      labels.push({\n        type: 'featured',\n        text: '精選',\n        priority: LABEL_PRIORITIES['featured'],\n        className: 'product-label featured'\n      })\n    }\n\n    // 特價標籤\n    if (promotionData.isOnSale) {\n      labels.push({\n        type: 'sale',\n        text: '特價',\n        priority: LABEL_PRIORITIES['sale'],\n        className: 'product-label sale'\n      })\n    }\n\n    // 獨家標籤\n    if (promotionData.isExclusive) {\n      labels.push({\n        type: 'exclusive',\n        text: '獨家',\n        priority: LABEL_PRIORITIES['exclusive'],\n        className: 'product-label exclusive'\n      })\n    }\n\n    // 特殊活動標籤\n    if (promotionData.specialEvent) {\n      labels.push({\n        type: 'special-event',\n        text: promotionData.specialEvent,\n        priority: LABEL_PRIORITIES['special-event'],\n        className: 'product-label special-event'\n      })\n    }\n\n    // 折扣碼提示\n    if (promotionData.hasDiscountCode) {\n      labels.push({\n        type: 'discount-code',\n        text: `優惠碼: ${promotionData.hasDiscountCode}`,\n        priority: LABEL_PRIORITIES['discount-code'],\n        className: 'product-label discount-code'\n      })\n    }\n\n    // 組合優惠\n    if (promotionData.bundleDiscount && promotionData.bundleDiscount > 0) {\n      labels.push({\n        type: 'bundle',\n        text: `組合省${promotionData.bundleDiscount}%`,\n        priority: LABEL_PRIORITIES['bundle'],\n        className: 'product-label bundle'\n      })\n    }\n\n    // 買X送Y標籤（從 metadata 或後端資料檢查）\n    if (promotionData.buyXGetY) {\n      const buyXGetYText = typeof promotionData.buyXGetY === 'string' \n        ? promotionData.buyXGetY \n        : LABEL_TEXTS['buy-x-get-y']\n      \n      labels.push({\n        type: 'buy-x-get-y',\n        text: buyXGetYText,\n        priority: LABEL_PRIORITIES['buy-x-get-y'],\n        className: 'product-label buy-x-get-y'\n      })\n    }\n\n    // 庫存狀態標籤\n    if (inventoryData.isOutOfStock) {\n      labels.push({\n        type: 'sold-out',\n        text: '售完',\n        priority: LABEL_PRIORITIES['sold-out'],\n        className: 'product-label sold-out'\n      })\n    } else if (inventoryData.canBackorder) {\n      labels.push({\n        type: 'preorder',\n        text: '可預訂',\n        priority: LABEL_PRIORITIES['preorder'],\n        className: 'product-label preorder'\n      })\n    }\n\n    // 按優先級排序\n    return labels.sort((a, b) => a.priority - b.priority)\n\n  } catch (error) {\n    if (process.env.NODE_ENV === 'development') console.error('Error fetching real promotion labels:', error)\n    // 如果 API 出錯，返回空陣列\n    return []\n  }\n}\n\n/**\n * 統一的促銷標籤獲取函數\n * 根據環境變數決定使用真實 API 或本地計算\n */\nexport async function getPromotionLabelsAsync(\n  product: HttpTypes.StoreProduct,\n  regionId?: string\n): Promise<PromotionLabel[]> {\n  // 檢查是否使用真實 API\n  const useRealAPI = process.env.NEXT_PUBLIC_USE_REAL_PROMOTION_API === 'true'\n  \n  if (useRealAPI) {\n    try {\n      // 使用新的主動促銷標籤獲取方法\n      const activeLabels = await getActivePromotionLabels(product, regionId)\n      if (activeLabels.length > 0) {\n        return activeLabels\n      }\n      // 如果沒有主動促銷，回退到原方法\n      return await getRealPromotionLabels(product, regionId)\n  } catch (error) {\n    if (process.env.NODE_ENV === 'development') console.error('Real API failed, falling back to local data:', error)\n      // API 失敗時回退到本地邏輯\n      return getPromotionLabels(product)\n    }\n  } else {\n    // 使用本地計算方法\n    return getPromotionLabels(product)\n  }\n}\n\n\n\n/**\n * 直接從 Medusa API 獲取商品的促銷資訊\n * @param product 產品資料\n * @param regionId 地區 ID\n * @returns Promise<PromotionLabel[]>\n */\nexport async function getActivePromotionLabels(\n  product: HttpTypes.StoreProduct,\n  regionId: string = 'reg_01JW1S1F7GB4ZP322G2DMETETH'\n): Promise<PromotionLabel[]> {\n  try {\n    const labels: PromotionLabel[] = []\n    \n    // 使用 Next.js API 路由代理來避免 CORS 問題\n    const baseUrl = '/api/medusa'\n    \n    // 檢查後端是否可用 - 使用不需要身份驗證的端點\n    try {\n      const healthCheck = await fetch(`${baseUrl}/store/regions`, {\n        method: 'GET',\n        headers: {\n          'Content-Type': 'application/json',\n          'x-publishable-api-key': (await import('../medusa-publishable-key')).getPublishableKeyForBackend((await import('../config')).MEDUSA_BACKEND_URL),\n        },\n      })\n      \n      if (!healthCheck.ok) {\n        throw new Error('Backend unavailable')\n      }\n    } catch (error) {\n    if (process.env.NODE_ENV === 'development') console.warn('Backend health check failed')\n      // 後端不可用時，不顯示任何標籤\n      return labels\n    }\n    \n    // 創建一個測試購物車來檢查促銷活動\n    const cartResponse = await fetch(`${baseUrl}/store/carts`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify({\n        region_id: regionId\n      })\n    })\n\n    if (!cartResponse.ok) {\n      const errorText = await cartResponse.text()\n    if (process.env.NODE_ENV === 'development') console.error('Failed to create cart:', errorText)\n      throw new Error(`Failed to create cart: ${cartResponse.status}`)\n    }\n\n    const cartData = await cartResponse.json()\n    const cartId = cartData.cart.id\n\n    // 如果商品有變體，選擇第一個變體\n    const firstVariant = product.variants?.[0]\n    if (!firstVariant) {\n      return labels\n    }\n\n    // 添加商品到購物車\n    const addItemResponse = await fetch(`${baseUrl}/store/carts/${cartId}/line-items`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify({\n        variant_id: firstVariant.id,\n        quantity: 1\n      })\n    })\n\n    if (!addItemResponse.ok) {\n      const errorText = await addItemResponse.text()\n      if (process.env.NODE_ENV === 'development') console.error(`❌ [${product.title}] 添加商品失敗: ${addItemResponse.status}`, errorText)\n      // 添加商品失敗時，返回空標籤而不是拋出錯誤\n      return labels\n    }\n\n    const cartWithItem = await addItemResponse.json()\n    const originalPrice = cartWithItem.cart.original_total || 0\n    const finalPrice = cartWithItem.cart.total || 0\n    const discountTotal = cartWithItem.cart.discount_total || 0\n\n    // 檢查是否有促銷活動應用\n    const promotions = cartWithItem.cart.promotions || []\n    const processedCodes = new Set<string>() // 用來追蹤已處理的促銷代碼，避免重複\n    \n    if (promotions.length > 0) {\n      for (const promotion of promotions) {\n        if (promotion.application_method && !processedCodes.has(promotion.code)) {\n          processedCodes.add(promotion.code)\n          \n          const method = promotion.application_method\n          const code = promotion.code || ''\n          \n          // 檢查是否為「買X送Y」類型促銷\n          if (code.toLowerCase().includes('buy') && code.toLowerCase().includes('get') ||\n              code.toLowerCase().includes('買') && code.toLowerCase().includes('送') ||\n              method.type === 'buy_x_get_y' ||\n              promotion.type === 'buy_x_get_y') {\n            \n            // 根據促銷代碼生成合適的顯示文字，只顯示「送Y」部分\n            let buyXGetYText = '送禮'\n            if (code.toLowerCase().includes('buy2get1') || code.toLowerCase().includes('買2送1')) {\n              buyXGetYText = '送1件'\n            } else if (code.toLowerCase().includes('buy3get1') || code.toLowerCase().includes('買3送1')) {\n              buyXGetYText = '送1件'\n            } else if (code.toLowerCase().includes('buy1get1') || code.toLowerCase().includes('買1送1')) {\n              buyXGetYText = '送1件'\n            } else if (code.toLowerCase().includes('gift') || code.toLowerCase().includes('贈')) {\n              buyXGetYText = '送禮品'\n            } else if (code.toLowerCase().includes('free') || code.toLowerCase().includes('免費')) {\n              buyXGetYText = '送好禮'\n            }\n            \n            labels.push({\n              type: 'buy-x-get-y',\n              text: buyXGetYText,\n              priority: LABEL_PRIORITIES['buy-x-get-y'],\n              className: 'px-2 py-1 text-xs font-semibold rounded-md shadow-lg border bg-stone-800/90 text-white border-white'\n            })\n          } else if (method.type === 'percentage') {\n            // 百分比折扣\n            const discountPercent = method.value\n            const taiwanDiscount = (100 - discountPercent) / 10\n            const discountText = taiwanDiscount === Math.floor(taiwanDiscount) \n              ? `${taiwanDiscount}折` \n              : `${taiwanDiscount.toFixed(1)}折`\n            \n            // 根據促銷代碼判斷是訂單折扣還是商品折扣\n            let labelText = discountText\n            let labelType: PromotionLabelType = 'auto-discount'\n            \n            if (code.toLowerCase().includes('order')) {\n              labelText = `滿額訂單${discountText}`\n              labelType = 'campaign'\n            } else if (code.toLowerCase().includes('product')) {\n              labelText = `指定商品${discountText}`\n              labelType = 'auto-discount'\n            } else {\n              // 默認顯示為商品折扣\n              labelText = `指定商品${discountText}`\n              labelType = 'auto-discount'\n            }\n            \n            labels.push({\n              type: labelType,\n              text: labelText,\n              priority: LABEL_PRIORITIES[labelType],\n              className: 'px-2 py-1 text-xs font-semibold rounded-md shadow-lg border bg-stone-800/90 text-white border-white',\n              isDiscount: true\n            })\n          } else if (method.type === 'fixed') {\n            // 固定金額折扣\n            const discountAmount = method.value\n            \n            // 根據促銷代碼判斷是訂單折扣還是商品折扣\n            let labelText = `-NT$${discountAmount}`\n            let labelType: PromotionLabelType = 'manual-discount'\n            \n            if (code.toLowerCase().includes('order')) {\n              labelText = `滿額折NT$${discountAmount}`\n              labelType = 'special-event'\n            } else if (code.toLowerCase().includes('product')) {\n              labelText = `商品折NT$${discountAmount}`\n              labelType = 'manual-discount'\n            } else {\n              // 默認顯示為商品折扣\n              labelText = `折NT$${discountAmount}`\n              labelType = 'manual-discount'\n            }\n            \n            labels.push({\n              type: labelType,\n              text: labelText,\n              priority: LABEL_PRIORITIES[labelType],\n              className: 'px-2 py-1 text-xs font-semibold rounded-md shadow-lg border bg-stone-800/90 text-white border-white',\n              isDiscount: true\n            })\n          }\n        }\n      }\n    }\n\n    // 如果總折扣大於 0，但沒有具體的促銷標籤，則顯示總折扣\n    if (discountTotal > 0 && labels.length === 0) {\n      const discountPercent = Math.round((discountTotal / originalPrice) * 100)\n      const taiwanDiscount = (100 - discountPercent) / 10\n      const discountText = taiwanDiscount === Math.floor(taiwanDiscount) \n        ? `${taiwanDiscount}折` \n        : `${taiwanDiscount.toFixed(1)}折`\n      \n      labels.push({\n        type: 'auto-discount',\n        text: discountText,\n        priority: LABEL_PRIORITIES['auto-discount'],\n        className: 'px-2 py-1 text-xs font-semibold rounded-md shadow-lg border bg-stone-800/90 text-white border-white',\n        isDiscount: true\n      })\n    }\n\n    // 清理測試購物車\n    try {\n      await fetch(`${baseUrl}/store/carts/${cartId}`, {\n        method: 'DELETE',\n      })\n    } catch (error) {\n    if (process.env.NODE_ENV === 'development') console.warn('Failed to cleanup test cart:', error)\n    }\n\n    // 如果沒有找到任何促銷，返回空陣列\n    return labels.sort((a, b) => a.priority - b.priority)\n\n  } catch (error) {\n    if (process.env.NODE_ENV === 'development') console.error('Error fetching Medusa API promotion labels:', error)\n    // 出錯時不顯示任何標籤\n    return []\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/util/repeat.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/util/simple-promotion-utils.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'HttpTypes' is defined but never used.","line":1,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":19},{"ruleId":"unused-imports/no-unused-imports","severity":2,"message":"'HttpTypes' is defined but never used.","line":1,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":19,"fix":{"range":[0,45],"text":"\n"}},{"ruleId":"sonarjs/cognitive-complexity","severity":2,"message":"Refactor this function to reduce its Cognitive Complexity from 223 to the 15 allowed.","line":59,"column":23,"nodeType":null,"messageId":"refactorFunction","endLine":59,"endColumn":37},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'cartId' is defined but never used.","line":59,"column":38,"nodeType":null,"messageId":"unusedVar","endLine":59,"endColumn":44},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'cartId' is defined but never used. Allowed unused args must match /^_/u.","line":59,"column":38,"nodeType":null,"messageId":"unusedVar","endLine":59,"endColumn":44},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'code' is defined but never used.","line":59,"column":54,"nodeType":null,"messageId":"unusedVar","endLine":59,"endColumn":58},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'code' is defined but never used. Allowed unused args must match /^_/u.","line":59,"column":54,"nodeType":null,"messageId":"unusedVar","endLine":59,"endColumn":58},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":60,"column":62,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":60,"endColumn":64,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1462,1464],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":67,"column":51,"nodeType":"MemberExpression","messageId":"unexpected","endLine":67,"endColumn":62},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":74,"column":53,"nodeType":"MemberExpression","messageId":"unexpected","endLine":74,"endColumn":64},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":80,"column":51,"nodeType":"MemberExpression","messageId":"unexpected","endLine":80,"endColumn":62},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":80,"column":113,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":80,"endColumn":115,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2405,2407],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":98,"column":53,"nodeType":"MemberExpression","messageId":"unexpected","endLine":98,"endColumn":65},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":105,"column":53,"nodeType":"MemberExpression","messageId":"unexpected","endLine":105,"endColumn":65},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":113,"column":51,"nodeType":"MemberExpression","messageId":"unexpected","endLine":113,"endColumn":62},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":132,"column":53,"nodeType":"MemberExpression","messageId":"unexpected","endLine":132,"endColumn":65},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":139,"column":53,"nodeType":"MemberExpression","messageId":"unexpected","endLine":139,"endColumn":65},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":148,"column":47,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":148,"endColumn":49,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[4467,4469],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":149,"column":35,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":149,"endColumn":37,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[4506,4508],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":150,"column":47,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":150,"endColumn":49,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[4557,4559],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":151,"column":40,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":151,"endColumn":42,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[4601,4603],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":153,"column":49,"nodeType":"MemberExpression","messageId":"unexpected","endLine":153,"endColumn":60},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":154,"column":49,"nodeType":"MemberExpression","messageId":"unexpected","endLine":154,"endColumn":60},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":164,"column":39,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":164,"endColumn":41,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[5215,5217],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":167,"column":69,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":167,"endColumn":71,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[5296,5407],"text":"(code.toLowerCase().includes('order') ?? \n                              code.toLowerCase().includes('off order'))"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":168,"column":72,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":168,"endColumn":74,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[5367,5482],"text":"(code.toLowerCase().includes('off order') ??\n                              code.toLowerCase().includes('amount off'))"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":169,"column":73,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":169,"endColumn":75,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[5296,5549],"text":"(code.toLowerCase().includes('order') || \n                              code.toLowerCase().includes('off order') ||\n                              code.toLowerCase().includes('amount off') ??\n                              code.toLowerCase().includes('滿額'))"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":170,"column":65,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":170,"endColumn":67,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[5296,5615],"text":"(code.toLowerCase().includes('order') || \n                              code.toLowerCase().includes('off order') ||\n                              code.toLowerCase().includes('amount off') ||\n                              code.toLowerCase().includes('滿額') ??\n                              code.toLowerCase().includes('滿'))"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":171,"column":64,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":171,"endColumn":66,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[5616,5618],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":173,"column":32,"nodeType":null,"messageId":"preferOptionalChain","endLine":175,"endColumn":32,"fix":{"range":[5709,5888],"text":"promotion.rules?.some((rule: any) => \n                                rule.attribute === 'total' || rule.attribute === 'subtotal'\n                              )"}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":173,"column":79,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":173,"endColumn":82,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5756,5759],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5756,5759],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"sonarjs/no-duplicate-string","severity":2,"message":"Define a constant instead of duplicating this literal 6 times.","line":196,"column":28,"nodeType":"Literal","endLine":196,"endColumn":160},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":201,"column":59,"nodeType":"MemberExpression","messageId":"unexpected","endLine":201,"endColumn":70},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":222,"column":59,"nodeType":"MemberExpression","messageId":"unexpected","endLine":222,"endColumn":70},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":245,"column":53,"nodeType":"MemberExpression","messageId":"unexpected","endLine":245,"endColumn":64},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":259,"column":49,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":259,"endColumn":51,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[9611,9650],"text":"(buyXGetY.free_item ?? buyXGetY.get_item)"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":259,"column":70,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":259,"endColumn":72,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[9651,9653],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":271,"column":59,"nodeType":"MemberExpression","messageId":"unexpected","endLine":271,"endColumn":70},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":275,"column":55,"nodeType":"MemberExpression","messageId":"unexpected","endLine":275,"endColumn":67},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":303,"column":57,"nodeType":"MemberExpression","messageId":"unexpected","endLine":303,"endColumn":68},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":335,"column":55,"nodeType":"MemberExpression","messageId":"unexpected","endLine":335,"endColumn":66},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":351,"column":55,"nodeType":"MemberExpression","messageId":"unexpected","endLine":351,"endColumn":66},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":355,"column":55,"nodeType":"MemberExpression","messageId":"unexpected","endLine":355,"endColumn":67},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":360,"column":53,"nodeType":"MemberExpression","messageId":"unexpected","endLine":360,"endColumn":65},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":365,"column":51,"nodeType":"MemberExpression","messageId":"unexpected","endLine":365,"endColumn":62},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":367,"column":53,"nodeType":"MemberExpression","messageId":"unexpected","endLine":367,"endColumn":64},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":375,"column":51,"nodeType":"MemberExpression","messageId":"unexpected","endLine":375,"endColumn":63}],"suppressedMessages":[],"errorCount":23,"fatalErrorCount":0,"warningCount":24,"fixableErrorCount":2,"fixableWarningCount":0,"source":"import { HttpTypes } from \"@medusajs/types\"\n\n// 簡化的促銷標籤類型\nexport type PromotionLabelType = \n  | 'auto-discount'      // 自動計算折扣\n  | 'manual-discount'    // 手動設置折扣\n  | 'promotion'          // 自定義促銷文字\n  | 'campaign'           // 促銷活動\n  | 'discount-code'      // 折扣碼提示\n  | 'new'                // 新品\n  | 'hot'                // 熱銷\n  | 'limited'            // 限量\n  | 'bestseller'         // 暢銷\n  | 'featured'           // 精選\n  | 'sale'               // 特價\n  | 'special-event'      // 特殊活動\n  | 'preorder'           // 預訂\n  | 'sold-out'           // 售完\n  | 'bundle'             // 組合優惠\n  | 'buy-x-get-y'        // 買X送Y\n  | 'flash-sale'         // 限時搶購\n  | 'clearance'          // 清倉\n  | 'exclusive'          // 獨家\n\nexport interface PromotionLabel {\n  type: PromotionLabelType\n  text: string\n  priority: number\n  className: string\n  isDiscount?: boolean\n}\n\n// 標籤優先級配置\nconst LABEL_PRIORITIES: Record<PromotionLabelType, number> = {\n  'auto-discount': 1,\n  'manual-discount': 2,\n  'promotion': 3,\n  'campaign': 4,\n  'discount-code': 5,\n  'new': 10,\n  'hot': 11,\n  'limited': 12,\n  'bestseller': 13,\n  'featured': 14,\n  'sale': 15,\n  'special-event': 16,\n  'preorder': 17,\n  'sold-out': 18,\n  'bundle': 19,\n  'buy-x-get-y': 6,    // 買X送Y 標籤優先級較高\n  'flash-sale': 20,\n  'clearance': 21,\n  'exclusive': 22\n}\n\n/**\n * 只從 Medusa API 獲取真實的促銷折扣標籤\n */\nexport async function applyPromotion(cartId: string, code: string) {\n  const baseUrl = process.env.NEXT_PUBLIC_MEDUSA_BACKEND_URL || (process.env.NEXT_PUBLIC_ENV_MODE === 'local' ? 'http://localhost:9000' : 'https://timsfantasyworld.com')\n  const { MEDUSA_BACKEND_URL } = await import('./config')\n  const { getPublishableKeyForBackend } = await import('./lib/medusa-publishable-key')\n  const publishableKey = getPublishableKeyForBackend(MEDUSA_BACKEND_URL)\n\n  try {\n    if (process.env.NODE_ENV === 'development') {\n      if (process.env.NODE_ENV === 'development') console.log(`🧪 [${product.title}] 開始測試 Medusa API 促銷標籤`)\n    }\n    \n    // 檢查商品變體\n    const firstVariant = product.variants?.[0]\n    if (!firstVariant) {\n      if (process.env.NODE_ENV === 'development') {\n        if (process.env.NODE_ENV === 'development') console.log(`⚠️ [${product.title}] 商品沒有變體，跳過促銷測試`)\n      }\n      return labels\n    }\n\n    if (process.env.NODE_ENV === 'development') {\n      if (process.env.NODE_ENV === 'development') console.log(`📦 [${product.title}] 使用變體: ${firstVariant.title || firstVariant.id}`)\n    }\n\n    // 1. 創建測試購物車\n    let cartResponse\n    try {\n      cartResponse = await fetch(`${baseUrl}/carts`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'x-publishable-api-key': publishableKey,\n        },\n        body: JSON.stringify({\n          region_id: regionId\n        })\n      })\n    } catch (error) {\n      if (process.env.NODE_ENV === 'development') {\n        if (process.env.NODE_ENV === 'development') console.warn(`⚠️ [${product.title}] 創建購物車網路錯誤:`, error)\n      }\n      return []\n    }\n\n    if (!cartResponse.ok) {\n      if (process.env.NODE_ENV === 'development') {\n        if (process.env.NODE_ENV === 'development') console.warn(`⚠️ [${product.title}] 創建購物車失敗:`, cartResponse.status)\n      }\n      return labels\n    }\n\n    const cartData = await cartResponse.json()\n    const cartId = cartData.cart.id\n    if (process.env.NODE_ENV === 'development') {\n      if (process.env.NODE_ENV === 'development') console.log(`🛒 [${product.title}] 購物車 ID: ${cartId}`)\n    }\n\n    // 2. 添加商品到購物車\n    let addItemResponse\n    try {\n      addItemResponse = await fetch(`${baseUrl}/carts/${cartId}/line-items`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'x-publishable-api-key': publishableKey,\n        },\n        body: JSON.stringify({\n          variant_id: firstVariant.id,\n          quantity: 1\n        })\n      })\n    } catch (error) {\n      if (process.env.NODE_ENV === 'development') {\n        if (process.env.NODE_ENV === 'development') console.warn(`⚠️ [${product.title}] 添加商品網路錯誤:`, error)\n      }\n      return []\n    }\n\n    if (!addItemResponse.ok) {\n      if (process.env.NODE_ENV === 'development') {\n        if (process.env.NODE_ENV === 'development') console.warn(`⚠️ [${product.title}] 添加商品失敗:`, addItemResponse.status)\n      }\n      return labels\n    }\n\n    const cartWithItem = await addItemResponse.json()\n    const cart = cartWithItem.cart\n    \n    // 3. 分析促銷資訊\n    const originalPrice = cart.original_total || 0\n    const finalPrice = cart.total || 0\n    const discountTotal = cart.discount_total || 0\n    const promotions = cart.promotions || []\n\n    if (process.env.NODE_ENV === 'development') console.log(`💰 [${product.title}] 原價: NT$${originalPrice}, 實際: NT$${finalPrice}, 折扣: NT$${discountTotal}`)\n    if (process.env.NODE_ENV === 'development') console.log(`🎯 [${product.title}] 促銷活動數量: ${promotions.length}`)\n\n    // 4. 生成促銷標籤 - 避免重複標籤\n    const addedLabels = new Set<string>() // 用於追蹤已添加的標籤文字\n    \n    if (promotions.length > 0) {\n      // 分析促銷類型：根據 code 判斷是否為滿額折扣\n      for (const promotion of promotions) {\n        if (promotion.application_method) {\n          const method = promotion.application_method\n          const code = promotion.code || ''\n          \n          // 根據促銷 code 判斷是否為滿額折扣\n          const isOrderLevel = code.toLowerCase().includes('order') || \n                              code.toLowerCase().includes('off order') ||\n                              code.toLowerCase().includes('amount off') ||\n                              code.toLowerCase().includes('滿額') ||\n                              code.toLowerCase().includes('滿') ||\n                              // 根據測試結果，包含 order 關鍵字的是滿額折扣\n                              (promotion.rules && promotion.rules.some((rule: any) => \n                                rule.attribute === 'total' || rule.attribute === 'subtotal'\n                              ))\n          \n          if (method.type === 'percentage') {\n            const discountPercent = method.value\n            const taiwanDiscount = (100 - discountPercent) / 10\n            \n            // 根據是否為訂單級別（滿額）折扣決定標籤文字\n            const discountText = isOrderLevel\n              ? (taiwanDiscount === Math.floor(taiwanDiscount) \n                  ? `滿額${taiwanDiscount}折` \n                  : `滿額${taiwanDiscount.toFixed(1)}折`)\n              : (taiwanDiscount === Math.floor(taiwanDiscount) \n                  ? `商品${taiwanDiscount}折` \n                  : `商品${taiwanDiscount.toFixed(1)}折`)\n            \n            // 避免重複標籤\n            if (!addedLabels.has(discountText)) {\n              labels.push({\n                type: isOrderLevel ? 'campaign' : 'auto-discount',\n                text: discountText,\n                priority: LABEL_PRIORITIES[isOrderLevel ? 'campaign' : 'auto-discount'],\n                className: 'inline-block bg-stone-800/90 text-white px-2 py-1 shadow-sm text-xs font-medium tracking-widest uppercase whitespace-nowrap w-auto',\n                isDiscount: true\n              })\n              addedLabels.add(discountText)\n              \n              if (process.env.NODE_ENV === 'development') console.log(`✅ [${product.title}] 添加${isOrderLevel ? '滿額' : '商品'}百分比折扣標籤: ${discountText} (code: ${code})`)\n            }\n          } else if (method.type === 'fixed') {\n            const discountAmount = method.value\n            \n            // 根據是否為訂單級別（滿額）折扣決定標籤文字\n            const discountText = isOrderLevel\n              ? `滿額-NT$${discountAmount}`\n              : `商品-NT$${discountAmount}`\n            \n            // 避免重複標籤\n            if (!addedLabels.has(discountText)) {\n              labels.push({\n                type: isOrderLevel ? 'campaign' : 'manual-discount',\n                text: discountText,\n                priority: LABEL_PRIORITIES[isOrderLevel ? 'campaign' : 'manual-discount'],\n                className: 'inline-block bg-stone-800/90 text-white px-2 py-1 shadow-sm text-xs font-medium tracking-widest uppercase whitespace-nowrap w-auto',\n                isDiscount: true\n              })\n              addedLabels.add(discountText)\n              \n              if (process.env.NODE_ENV === 'development') console.log(`✅ [${product.title}] 添加${isOrderLevel ? '滿額' : '商品'}固定折扣標籤: ${discountText} (code: ${code})`)\n            }\n          }\n        }\n      }\n    } else if (discountTotal > 0) {\n      // 如果有總折扣但沒有具體促銷活動\n      const discountPercent = Math.round((discountTotal / originalPrice) * 100)\n      const taiwanDiscount = (100 - discountPercent) / 10\n      const discountText = taiwanDiscount === Math.floor(taiwanDiscount) \n        ? `省${taiwanDiscount * 10}%` \n        : `省${(taiwanDiscount * 10).toFixed(1)}%`\n      \n      if (!addedLabels.has(discountText)) {\n        labels.push({\n          type: 'auto-discount',\n          text: discountText,\n          priority: LABEL_PRIORITIES['auto-discount'],\n          className: 'inline-block bg-stone-800/90 text-white px-2 py-1 shadow-sm text-xs font-medium tracking-widest uppercase whitespace-nowrap w-auto',\n          isDiscount: true\n        })\n        addedLabels.add(discountText)\n        \n        if (process.env.NODE_ENV === 'development') console.log(`✅ [${product.title}] 添加通用折扣標籤: ${discountText}`)\n      }\n    }\n\n    // 從 metadata 處理各種促銷標籤\n    if (product.metadata) {\n      // 處理 buy_x_get_y 標籤\n      if (product.metadata.buyXGetY) {\n        try {\n          const buyXGetY = typeof product.metadata.buyXGetY === 'string' \n            ? JSON.parse(product.metadata.buyXGetY)\n            : product.metadata.buyXGetY\n\n          if (buyXGetY && typeof buyXGetY === 'object') {\n            const freeItem = buyXGetY.free_item || buyXGetY.get_item || '贈品'\n            const labelText = `送${freeItem}`\n            \n            if (!addedLabels.has(labelText)) {\n              labels.push({\n                type: 'buy-x-get-y',\n                text: labelText,\n                priority: LABEL_PRIORITIES['buy-x-get-y'],\n                className: 'inline-block bg-stone-800/90 text-white px-2 py-1 shadow-sm text-xs font-medium tracking-widest uppercase whitespace-nowrap w-auto',\n                isDiscount: false\n              })\n              addedLabels.add(labelText)\n              if (process.env.NODE_ENV === 'development') console.log(`✅ [${product.title}] 添加買X送Y標籤: ${labelText}`)\n            }\n          }\n        } catch (error) {\n          if (process.env.NODE_ENV === 'development') console.warn(`⚠️ [${product.title}] buyXGetY metadata 解析失敗:`, error)\n        }\n      }\n\n      // 處理其他 metadata 促銷標籤\n      const metadataLabels = [\n        { key: 'promotion_text', type: 'promotion' as PromotionLabelType },\n        { key: 'campaign_text', type: 'campaign' as PromotionLabelType },\n        { key: 'special_event', type: 'special-event' as PromotionLabelType },\n        { key: 'bundle_text', type: 'bundle' as PromotionLabelType },\n        { key: 'flash_sale', type: 'flash-sale' as PromotionLabelType },\n        { key: 'clearance', type: 'clearance' as PromotionLabelType },\n        { key: 'exclusive', type: 'exclusive' as PromotionLabelType }\n      ]\n\n      for (const { key, type } of metadataLabels) {\n        if (product.metadata[key]) {\n          const labelText = String(product.metadata[key])\n          \n          if (!addedLabels.has(labelText)) {\n            labels.push({\n              type,\n              text: labelText,\n              priority: LABEL_PRIORITIES[type],\n              className: 'inline-block bg-stone-800/90 text-white px-2 py-1 shadow-sm text-xs font-medium tracking-widest uppercase whitespace-nowrap w-auto',\n              isDiscount: false\n            })\n            addedLabels.add(labelText)\n            if (process.env.NODE_ENV === 'development') console.log(`✅ [${product.title}] 添加 metadata 標籤 (${type}): ${labelText}`)\n          }\n        }\n      }\n    }\n\n    // 從 tags 處理促銷標籤\n    if (product.tags && product.tags.length > 0) {\n      const tagLabels = [\n        { value: 'new', type: 'new' as PromotionLabelType, text: '新品' },\n        { value: 'hot', type: 'hot' as PromotionLabelType, text: '熱銷' },\n        { value: 'limited', type: 'limited' as PromotionLabelType, text: '限量' },\n        { value: 'bestseller', type: 'bestseller' as PromotionLabelType, text: '暢銷' },\n        { value: 'featured', type: 'featured' as PromotionLabelType, text: '精選' },\n        { value: 'sale', type: 'sale' as PromotionLabelType, text: '特價' },\n        { value: 'preorder', type: 'preorder' as PromotionLabelType, text: '預訂' },\n        { value: 'sold-out', type: 'sold-out' as PromotionLabelType, text: '售完' }\n      ]\n\n      for (const tag of product.tags) {\n        const tagValue = tag.value?.toLowerCase()\n        const matchedLabel = tagLabels.find(label => label.value === tagValue)\n        \n        if (matchedLabel && !addedLabels.has(matchedLabel.text)) {\n          labels.push({\n            type: matchedLabel.type,\n            text: matchedLabel.text,\n            priority: LABEL_PRIORITIES[matchedLabel.type],\n            className: 'inline-block bg-stone-800/90 text-white px-2 py-1 shadow-sm text-xs font-medium tracking-widest uppercase whitespace-nowrap w-auto',\n            isDiscount: false\n          })\n          addedLabels.add(matchedLabel.text)\n          if (process.env.NODE_ENV === 'development') console.log(`✅ [${product.title}] 添加 tag 標籤 (${matchedLabel.type}): ${matchedLabel.text}`)\n        }\n      }\n    }\n\n    // 5. 清理測試購物車\n    try {\n      const deleteResponse = await fetch(`${baseUrl}/carts/${cartId}`, {\n        method: 'DELETE',\n        headers: {\n          'x-publishable-api-key': publishableKey,\n        },\n      })\n      \n      if (deleteResponse.ok) {\n        if (process.env.NODE_ENV === 'development') {\n          if (process.env.NODE_ENV === 'development') console.log(`🗑️ [${product.title}] 清理購物車完成`)\n        }\n      } else {\n        if (process.env.NODE_ENV === 'development') {\n          if (process.env.NODE_ENV === 'development') console.warn(`⚠️ [${product.title}] 清理購物車失敗 (status: ${deleteResponse.status})`)\n        }\n      }\n    } catch (error) {\n      if (process.env.NODE_ENV === 'development') {\n        if (process.env.NODE_ENV === 'development') console.warn(`⚠️ [${product.title}] 清理購物車失敗:`, error)\n      }\n    }\n\n    if (process.env.NODE_ENV === 'development') {\n      if (process.env.NODE_ENV === 'development') console.log(`📋 [${product.title}] 最終標籤數量: ${labels.length}`)\n      labels.forEach((label, index) => {\n        if (process.env.NODE_ENV === 'development') console.log(`   ${index + 1}. ${label.text} (${label.type})`)\n      })\n    }\n\n    return labels.sort((a, b) => a.priority - b.priority)\n\n  } catch (error) {\n    if (process.env.NODE_ENV === 'development') {\n      if (process.env.NODE_ENV === 'development') console.warn(`⚠️ [${product.title}] Medusa API 調用失敗:`, error)\n    }\n    return labels\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/util/sort-products.ts","messages":[{"ruleId":"jsdoc/require-param-description","severity":1,"message":"Missing JSDoc @param \"products\" description.","line":10,"column":1,"nodeType":"Block","endLine":10,"endColumn":1},{"ruleId":"jsdoc/require-param-description","severity":1,"message":"Missing JSDoc @param \"sortBy\" description.","line":11,"column":1,"nodeType":"Block","endLine":11,"endColumn":1},{"ruleId":"prefer-const","severity":2,"message":"'sortedProducts' is never reassigned. Use 'const' instead.","line":18,"column":7,"nodeType":"Identifier","messageId":"useConst","endLine":18,"endColumn":21,"fix":{"range":[519,570],"text":"const sortedProducts = products as MinPricedProduct[]"}},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":26,"column":71,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":26,"endColumn":73,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[925,927],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":36,"column":20,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":36,"endColumn":32},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":36,"column":35,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":36,"endColumn":47},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":44,"column":18,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":44,"endColumn":31},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":44,"column":54,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":44,"endColumn":67}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import { HttpTypes } from \"@medusajs/types\"\nimport type { SortOptions } from \"../../modules/store/components/refinement-list/sort-products\"\n\ninterface MinPricedProduct extends HttpTypes.StoreProduct {\n  _minPrice?: number\n}\n\n/**\n * Helper function to sort products by price until the store API supports sorting by price\n * @param products\n * @param sortBy\n * @returns products sorted by price\n */\nexport function sortProducts(\n  products: HttpTypes.StoreProduct[],\n  sortBy: SortOptions\n): HttpTypes.StoreProduct[] {\n  let sortedProducts = products as MinPricedProduct[]\n\n  if ([\"price_asc\", \"price_desc\"].includes(sortBy)) {\n    // Precompute the minimum price for each product\n    sortedProducts.forEach((product) => {\n      if (product.variants && product.variants.length > 0) {\n        product._minPrice = Math.min(\n          ...product.variants.map(\n            (variant) => variant?.calculated_price?.calculated_amount || 0\n          )\n        )\n      } else {\n        product._minPrice = Infinity\n      }\n    })\n\n    // Sort products based on the precomputed minimum prices\n    sortedProducts.sort((a, b) => {\n      const diff = a._minPrice! - b._minPrice!\n      return sortBy === \"price_asc\" ? diff : -diff\n    })\n  }\n\n  if (sortBy === \"created_at\") {\n    sortedProducts.sort((a, b) => {\n      return (\n        new Date(b.created_at!).getTime() - new Date(a.created_at!).getTime()\n      )\n    })\n  }\n\n  return sortedProducts\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/utils/image-optimization.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/lib/utils/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/middleware.ts","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":13,"column":80,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":13,"endColumn":82,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[629,631],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":14,"column":63,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":14,"endColumn":65,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[694,719],"text":"(KEY_RAILWAY ?? KEY_REMOTE)"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":14,"column":77,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":14,"endColumn":79,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[720,722],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":15,"column":23,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":15,"endColumn":25,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[757,759],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":21,"column":63,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":21,"endColumn":65,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[926,928],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"sonarjs/cognitive-complexity","severity":2,"message":"Refactor this function to reduce its Cognitive Complexity from 18 to the 15 allowed.","line":28,"column":16,"nodeType":null,"messageId":"refactorFunction","endLine":28,"endColumn":28},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'cacheId' is defined but never used.","line":28,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":28,"endColumn":36},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'cacheId' is defined but never used. Allowed unused args must match /^_/u.","line":28,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":28,"endColumn":36},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":48,"column":36,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":48,"endColumn":56},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":90,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":90,"endColumn":21,"suggestions":[{"fix":{"range":[3345,3427],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"jsdoc/require-param-description","severity":1,"message":"Missing JSDoc @param \"request\" description.","line":100,"column":1,"nodeType":"Block","endLine":100,"endColumn":1},{"ruleId":"jsdoc/require-param-description","severity":1,"message":"Missing JSDoc @param \"response\" description.","line":101,"column":1,"nodeType":"Block","endLine":101,"endColumn":1},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":127,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":127,"endColumn":17},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":127,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":127,"endColumn":17},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":129,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":129,"endColumn":20,"suggestions":[{"fix":{"range":[4409,4660],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"sonarjs/cognitive-complexity","severity":2,"message":"Refactor this function to reduce its Cognitive Complexity from 41 to the 15 allowed.","line":139,"column":23,"nodeType":null,"messageId":"refactorFunction","endLine":139,"endColumn":33},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'response' is assigned a value but never used.","line":162,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":162,"endColumn":15},{"ruleId":"prefer-const","severity":2,"message":"'response' is never reassigned. Use 'const' instead.","line":162,"column":7,"nodeType":"Identifier","messageId":"useConst","endLine":162,"endColumn":15,"fix":{"range":[5561,5595],"text":"const response = NextResponse.next()"}},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'response' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":162,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":162,"endColumn":15},{"ruleId":"prefer-const","severity":2,"message":"'cacheIdCookie' is never reassigned. Use 'const' instead.","line":164,"column":7,"nodeType":"Identifier","messageId":"useConst","endLine":164,"endColumn":20,"fix":{"range":[5599,5658],"text":"const cacheIdCookie = request.cookies.get(\"_medusa_cache_id\")"}},{"ruleId":"prefer-const","severity":2,"message":"'cacheId' is never reassigned. Use 'const' instead.","line":166,"column":7,"nodeType":"Identifier","messageId":"useConst","endLine":166,"endColumn":14,"fix":{"range":[5662,5719],"text":"const cacheId = cacheIdCookie?.value || crypto.randomUUID()"}},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":166,"column":38,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":166,"endColumn":40,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[5697,5699],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":260,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":260,"endColumn":16,"suggestions":[{"fix":{"range":[8714,9103],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":261,"column":33,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":261,"endColumn":35,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[8788,8790],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":265,"column":50,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":265,"endColumn":52,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[8982,8984],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":19,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":3,"fixableWarningCount":0,"source":"import { HttpTypes } from \"@medusajs/types\"\nimport { NextRequest, NextResponse } from \"next/server\"\n\nconst BACKEND_URL = process.env.MEDUSA_BACKEND_URL\nconst KEY_DEFAULT = process.env.NEXT_PUBLIC_MEDUSA_PUBLISHABLE_KEY\nconst KEY_LOCAL = process.env.NEXT_PUBLIC_MEDUSA_PUBLISHABLE_KEY_LOCAL\nconst KEY_REMOTE = process.env.NEXT_PUBLIC_MEDUSA_PUBLISHABLE_KEY_REMOTE\nconst KEY_RAILWAY = process.env.NEXT_PUBLIC_MEDUSA_PUBLISHABLE_KEY_RAILWAY\nfunction chooseKey(url?: string) {\n  if (!url) return KEY_DEFAULT\n  try {\n    const { hostname } = new URL(url)\n    if (hostname === 'localhost' || hostname === '127.0.0.1') return KEY_LOCAL || KEY_DEFAULT\n    if (hostname.endsWith('.railway.app')) return KEY_RAILWAY || KEY_REMOTE || KEY_DEFAULT\n    return KEY_REMOTE || KEY_DEFAULT\n  } catch {\n    return KEY_DEFAULT\n  }\n}\nconst PUBLISHABLE_API_KEY = chooseKey(BACKEND_URL)\nconst DEFAULT_REGION = process.env.NEXT_PUBLIC_DEFAULT_REGION || \"tw\"\n\nconst regionMapCache = {\n  regionMap: new Map<string, HttpTypes.StoreRegion>(),\n  regionMapUpdated: Date.now(),\n}\n\nasync function getRegionMap(cacheId: string) {\n  const { regionMap, regionMapUpdated } = regionMapCache\n\n  if (!BACKEND_URL) {\n    throw new Error(\n      \"Middleware.ts: Error fetching regions. Did you set up regions in your Medusa Admin and define a MEDUSA_BACKEND_URL environment variable? Note that the variable is no longer named NEXT_PUBLIC_MEDUSA_BACKEND_URL.\"\n    )\n  }\n\n  if (\n    !regionMap.keys().next().value ||\n    regionMapUpdated < Date.now() - 3600 * 1000\n  ) {\n    try {\n      // Fetch regions from Medusa. Middleware runs on Edge; we can't use JS SDK.\n      const controller = new AbortController();\n      const timeoutId = setTimeout(() => controller.abort(), 5000); // 5 秒超時\n      \n      const response = await fetch(`${BACKEND_URL}/store/regions`, {\n        headers: {\n          \"x-publishable-api-key\": PUBLISHABLE_API_KEY!,\n        },\n        signal: controller.signal\n      }).finally(() => clearTimeout(timeoutId));\n      \n      if (!response.ok) {\n        throw new Error(`Failed to fetch regions: ${response.status}`)\n      }\n\n      const { regions } = await response.json()\n\n      if (!regions?.length) {\n        throw new Error(\n          \"No regions found. Please set up regions in your Medusa Admin.\"\n        )\n      }\n\n      // Create a map of country codes to regions.\n      regions.forEach((region: HttpTypes.StoreRegion) => {\n        region.countries?.forEach((c) => {\n          regionMapCache.regionMap.set(c.iso_2 ?? \"\", region)\n        })\n      })\n\n      regionMapCache.regionMapUpdated = Date.now()\n    } catch (err) {\n      // Fallback for local dev: seed default region into map to avoid hard crash\n      if (!regionMapCache.regionMap.size) {\n        regionMapCache.regionMap.set(DEFAULT_REGION, {\n          id: \"local\",\n          name: DEFAULT_REGION.toUpperCase(),\n          countries: [{ iso_2: DEFAULT_REGION }],\n        } as unknown as HttpTypes.StoreRegion)\n        regionMapCache.regionMapUpdated = Date.now()\n      }\n      \n      // 更有效地處理網絡錯誤\n      const errMsg = String((err as Error)?.message || '未知錯誤');\n      const isNetworkError = errMsg.includes('fetch') || errMsg.includes('network') || \n                            errMsg.includes('abort') || errMsg.includes('timeout');\n      \n      if (process.env.NODE_ENV === \"development\") {\n        console.warn(`Middleware.ts: ${isNetworkError ? '網絡錯誤' : '失敗'} - 使用預設區域:`, errMsg)\n      }\n    }\n  }\n\n  return regionMapCache.regionMap\n}\n\n/**\n * Fetches regions from Medusa and sets the region cookie.\n * @param request\n * @param response\n */\nasync function getCountryCode(\n  request: NextRequest,\n  regionMap: Map<string, HttpTypes.StoreRegion | number>\n) {\n  try {\n    let countryCode\n\n    const vercelCountryCode = request.headers\n      .get(\"x-vercel-ip-country\")\n      ?.toLowerCase()\n\n    const urlCountryCode = request.nextUrl.pathname.split(\"/\")[1]?.toLowerCase()\n\n    if (urlCountryCode && regionMap.has(urlCountryCode)) {\n      countryCode = urlCountryCode\n    } else if (vercelCountryCode && regionMap.has(vercelCountryCode)) {\n      countryCode = vercelCountryCode\n    } else if (regionMap.has(DEFAULT_REGION)) {\n      countryCode = DEFAULT_REGION\n    } else if (regionMap.keys().next().value) {\n      countryCode = regionMap.keys().next().value\n    }\n\n    return countryCode\n  } catch (error) {\n    if (process.env.NODE_ENV === \"development\") {\n      console.error(\n        \"Middleware.ts: Error getting the country code. Did you set up regions in your Medusa Admin and define a MEDUSA_BACKEND_URL environment variable? Note that the variable is no longer named NEXT_PUBLIC_MEDUSA_BACKEND_URL.\"\n      )\n    }\n  }\n}\n\n/**\n * Middleware to handle region selection and onboarding status.\n */\nexport async function middleware(request: NextRequest) {\n  // Skip middleware for studio, cms routes\n  if (request.nextUrl.pathname.startsWith(\"/studio\") || \n      request.nextUrl.pathname.startsWith(\"/cms\")) {\n    return NextResponse.next()\n  }\n\n  // Skip middleware for affiliate-admin routes (they handle their own region routing)\n  if (request.nextUrl.pathname.includes(\"/affiliate-admin\")) {\n    return NextResponse.next()\n  }\n  \n  // Skip middleware for auth routes (needed for OAuth callbacks)\n  if (request.nextUrl.pathname.startsWith(\"/auth\")) {\n    return NextResponse.next()\n  }\n  \n  // Skip middleware for reset-password routes (allow direct access without region routing)\n  if (request.nextUrl.pathname.includes(\"/reset-password\")) {\n    return NextResponse.next()\n  }\n\n  // 預設不重導，必要時才建立 redirect 回應\n  let response = NextResponse.next()\n\n  let cacheIdCookie = request.cookies.get(\"_medusa_cache_id\")\n\n  let cacheId = cacheIdCookie?.value || crypto.randomUUID()\n\n  const regionMap = await getRegionMap(cacheId)\n\n  const countryCode = regionMap && (await getCountryCode(request, regionMap))\n\n  const urlHasCountryCode =\n    countryCode && request.nextUrl.pathname.split(\"/\")[1].includes(countryCode)\n\n  // if one of the country codes is in the url and the cache id is set, return next\n  if (urlHasCountryCode && cacheIdCookie) {\n    return NextResponse.next()\n  }\n\n  // if one of the country codes is in the url and the cache id is not set, set the cache id and continue\n  if (urlHasCountryCode && !cacheIdCookie) {\n    const res = NextResponse.next()\n    res.cookies.set(\"_medusa_cache_id\", cacheId, { maxAge: 60 * 60 * 24 })\n    return res\n  }\n\n  // check if the url is a static asset\n  if (request.nextUrl.pathname.includes(\".\")) {\n    return NextResponse.next()\n  }\n\n  const redirectPath = request.nextUrl.pathname === \"/\" ? \"\" : request.nextUrl.pathname\n  const queryString = request.nextUrl.search ? request.nextUrl.search : \"\"\n\n  // Affiliate tracking middleware\n  const affiliateResponse = NextResponse.next()\n  const url = request.nextUrl.clone()\n  \n  // Check for affiliate parameters\n  const affiliateRef = url.searchParams.get('ref')\n  const affiliateId = url.searchParams.get('affiliate_id')\n  const utmSource = url.searchParams.get('utm_source')\n  const utmMedium = url.searchParams.get('utm_medium')\n  const utmCampaign = url.searchParams.get('utm_campaign')\n  \n  // Set affiliate tracking cookies if parameters are present\n  if (affiliateRef || affiliateId) {\n    if (affiliateRef) {\n      affiliateResponse.cookies.set('affiliate_ref', affiliateRef, {\n        maxAge: 30 * 24 * 60 * 60, // 30 days\n        httpOnly: false,\n        secure: process.env.NODE_ENV === 'production',\n        sameSite: 'lax',\n        path: '/'\n      })\n    }\n    \n    if (affiliateId && affiliateId !== affiliateRef) {\n      affiliateResponse.cookies.set('affiliate_id', affiliateId, {\n        maxAge: 30 * 24 * 60 * 60,\n        httpOnly: false,\n        secure: process.env.NODE_ENV === 'production',\n        sameSite: 'lax',\n        path: '/'\n      })\n    }\n    \n    // Set UTM parameter cookies\n    if (utmSource) {\n      affiliateResponse.cookies.set('utm_source', utmSource, {\n        maxAge: 30 * 24 * 60 * 60,\n        httpOnly: false,\n        secure: process.env.NODE_ENV === 'production',\n        sameSite: 'lax',\n        path: '/'\n      })\n    }\n    \n    if (utmMedium) {\n      affiliateResponse.cookies.set('utm_medium', utmMedium, {\n        maxAge: 30 * 24 * 60 * 60,\n        httpOnly: false,\n        secure: process.env.NODE_ENV === 'production',\n        sameSite: 'lax',\n        path: '/'\n      })\n    }\n    \n    if (utmCampaign) {\n      affiliateResponse.cookies.set('utm_campaign', utmCampaign, {\n        maxAge: 30 * 24 * 60 * 60,\n        httpOnly: false,\n        secure: process.env.NODE_ENV === 'production',\n        sameSite: 'lax',\n        path: '/'\n      })\n    }\n    \n    // Log affiliate click tracking (in production, save to database)\n    console.log('Affiliate click tracked:', {\n      affiliateId: affiliateRef || affiliateId,\n      timestamp: Date.now(),\n      referrer: request.headers.get('referer'),\n      userAgent: request.headers.get('user-agent'),\n      ip: request.headers.get('x-forwarded-for') || request.headers.get('x-real-ip'),\n      utmSource,\n      utmMedium,\n      utmCampaign,\n      path: url.pathname\n    })\n    \n    // Remove affiliate parameters from URL to keep it clean\n    url.searchParams.delete('ref')\n    url.searchParams.delete('affiliate_id')\n    url.searchParams.delete('utm_source')\n    url.searchParams.delete('utm_medium')\n    url.searchParams.delete('utm_campaign')\n    url.searchParams.delete('utm_content')\n    url.searchParams.delete('utm_term')\n    url.searchParams.delete('t') // timestamp\n    \n    // If URL has changed, redirect to clean URL\n    if (url.href !== request.url) {\n      // But first handle country code redirect if needed\n      if (!urlHasCountryCode && countryCode) {\n        const cleanPath = url.pathname === \"/\" ? \"\" : url.pathname\n        const cleanQuery = url.search ? url.search : \"\"\n        url.pathname = `/${countryCode}${cleanPath}`\n        url.search = cleanQuery\n      }\n      return NextResponse.redirect(url.href)\n    }\n  }\n\n  // If no country code is set, we redirect to the relevant region.\n  if (!urlHasCountryCode && countryCode) {\n    const redirectUrl = `${request.nextUrl.origin}/${countryCode}${redirectPath}${queryString}`\n    return NextResponse.redirect(redirectUrl, 307)\n  }\n\n  return affiliateResponse\n}\n\nexport const config = {\n  matcher: [\n    \"/((?!api|_next/static|_next/image|favicon.ico|images|assets|studio|cms|auth|png|svg|jpg|jpeg|gif|webp).*)\",\n  ],\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/account/components/account-info/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/account/components/account-nav/index.tsx","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":39,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":39,"endColumn":16,"suggestions":[{"fix":{"range":[1278,1391],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":54,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":54,"endColumn":18,"suggestions":[{"fix":{"range":[1547,1607],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":60,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":60,"endColumn":20,"suggestions":[{"fix":{"range":[1713,1756],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":63,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":63,"endColumn":18,"suggestions":[{"fix":{"range":[1793,1824],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":162,"column":26,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":162,"endColumn":32},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":171,"column":26,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":171,"endColumn":32},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":180,"column":26,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":180,"endColumn":32},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":189,"column":26,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":189,"endColumn":32}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { clx } from \"@medusajs/ui\"\nimport { ArrowRightOnRectangle } from \"@medusajs/icons\"\nimport { useParams, usePathname } from \"next/navigation\"\n\nimport ChevronDown from \"@modules/common/icons/chevron-down\"\nimport User from \"@modules/common/icons/user\"\nimport MapPin from \"@modules/common/icons/map-pin\"\nimport Package from \"@modules/common/icons/package\"\nimport LocalizedClientLink from \"@modules/common/components/localized-client-link\"\nimport { HttpTypes } from \"@medusajs/types\"\nimport { useLogout } from \"@lib/hooks/use-logout\"\n\ntype AccountNavProps = {\n  customer: HttpTypes.StoreCustomer | null\n  onLogout?: () => void\n}\n\nconst AccountNav = ({\n  customer,\n  onLogout,\n}: AccountNavProps) => {\n  const route = usePathname()\n  const params = useParams()\n  const { countryCode: rawCountryCode } = params as { countryCode: string }\n\n  // 確保 countryCode 有效，從路徑中提取或使用默認值\n  const countryCode = rawCountryCode && \n                     typeof rawCountryCode === 'string' &&\n                     rawCountryCode !== 'api' && \n                     rawCountryCode.length === 2 && \n                     /^[a-z]{2}$/.test(rawCountryCode) \n                     ? rawCountryCode \n                     : 'tw'\n\n  // 調試日誌\n  if (process.env.NODE_ENV === 'development') {\n    console.log('AccountNav debug:', { \n      route, \n      params, \n      rawCountryCode, \n      countryCode \n    })\n  }\n\n  const { logout, isLoggingOut } = useLogout({\n    countryCode,\n    onLoggedOut: onLogout,\n  })\n\n  const handleLogout = async () => {\n    try {\n      console.log('🔓 Account Nav: 開始簡化登出流程 - 委託給 useLogout hook')\n      \n      // 🔧 直接使用 useLogout hook，避免重複的清除邏輯\n      await logout()\n      \n    } catch (error) {\n      console.error('❌ Account Nav 登出失敗:', error)\n      \n      // 最後手段：強制重新加載頁面\n      console.log('🔄 使用最後手段：強制重新加載')\n      window.location.href = `/${countryCode}/account?force_logout=1`\n    }\n  }\n\n  return (\n    <div>\n      <div className=\"small:hidden\" data-testid=\"mobile-account-nav\">\n        {route !== `/${countryCode}/account` ? (\n          <LocalizedClientLink\n            href=\"/account\"\n            className=\"flex items-center gap-x-2 text-small-regular py-2\"\n            data-testid=\"account-main-link\"\n          >\n            <>\n              <ChevronDown className=\"transform rotate-90\" />\n              <span>帳戶</span>\n            </>\n          </LocalizedClientLink>\n        ) : (\n          <>\n            <div className=\"text-xl-semi mb-4 px-8\">\n              您好 {customer?.first_name}\n            </div>\n            <div className=\"text-base-regular\">\n              <ul>\n                <li>\n                  <LocalizedClientLink\n                    href=\"/account/profile\"\n                    className=\"flex items-center justify-between py-4 border-b border-gray-200 px-8\"\n                    data-testid=\"profile-link\"\n                  >\n                    <>\n                      <div className=\"flex items-center gap-x-2\">\n                        <User size={20} />\n                        <span>個人檔案</span>\n                      </div>\n                      <ChevronDown className=\"transform -rotate-90\" />\n                    </>\n                  </LocalizedClientLink>\n                </li>\n                <li>\n                  <LocalizedClientLink\n                    href=\"/account/addresses\"\n                    className=\"flex items-center justify-between py-4 border-b border-gray-200 px-8\"\n                    data-testid=\"addresses-link\"\n                  >\n                    <>\n                      <div className=\"flex items-center gap-x-2\">\n                        <MapPin size={20} />\n                        <span>地址簿</span>\n                      </div>\n                      <ChevronDown className=\"transform -rotate-90\" />\n                    </>\n                  </LocalizedClientLink>\n                </li>\n                <li>\n                  <LocalizedClientLink\n                    href=\"/account/orders\"\n                    className=\"flex items-center justify-between py-4 border-b border-gray-200 px-8\"\n                    data-testid=\"orders-link\"\n                  >\n                    <div className=\"flex items-center gap-x-2\">\n                      <Package size={20} />\n                      <span>訂單</span>\n                    </div>\n                    <ChevronDown className=\"transform -rotate-90\" />\n                  </LocalizedClientLink>\n                </li>\n                <li>\n                  <button\n                    type=\"button\"\n                    className=\"flex items-center justify-between py-4 border-b border-gray-200 px-8 w-full\"\n                    onClick={handleLogout}\n                    data-testid=\"logout-button\"\n                    disabled={isLoggingOut}\n                  >\n                    <div className=\"flex items-center gap-x-2\">\n                      <ArrowRightOnRectangle />\n                      <span>登出</span>\n                    </div>\n                    <ChevronDown className=\"transform -rotate-90\" />\n                  </button>\n                </li>\n              </ul>\n            </div>\n          </>\n        )}\n      </div>\n      <div className=\"hidden small:block\" data-testid=\"account-nav\">\n        <div>\n          <div className=\"pb-4\">\n            <h3 className=\"text-base-semi\">帳戶</h3>\n          </div>\n          <div className=\"text-base-regular\">\n            <ul className=\"flex mb-0 justify-start items-start flex-col gap-y-4\">\n              <li>\n                <AccountNavLink\n                  href=\"/account\"\n                  route={route!}\n                  data-testid=\"overview-link\"\n                >\n                  總覽\n                </AccountNavLink>\n              </li>\n              <li>\n                <AccountNavLink\n                  href=\"/account/profile\"\n                  route={route!}\n                  data-testid=\"profile-link\"\n                >\n                  個人檔案\n                </AccountNavLink>\n              </li>\n              <li>\n                <AccountNavLink\n                  href=\"/account/addresses\"\n                  route={route!}\n                  data-testid=\"addresses-link\"\n                >\n                  地址簿\n                </AccountNavLink>\n              </li>\n              <li>\n                <AccountNavLink\n                  href=\"/account/orders\"\n                  route={route!}\n                  data-testid=\"orders-link\"\n                >\n                  訂單\n                </AccountNavLink>\n              </li>\n              <li className=\"text-grey-700\">\n                <button\n                  type=\"button\"\n                  onClick={handleLogout}\n                  data-testid=\"logout-button\"\n                  disabled={isLoggingOut}\n                >\n                  登出\n                </button>\n              </li>\n            </ul>\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}\n\ntype AccountNavLinkProps = {\n  href: string\n  route: string\n  children: React.ReactNode\n  \"data-testid\"?: string\n}\n\nconst AccountNavLink = ({\n  href,\n  route,\n  children,\n  \"data-testid\": dataTestId,\n}: AccountNavLinkProps) => {\n  const { countryCode: rawCountryCode }: { countryCode: string } = useParams()\n  \n  // 確保 countryCode 有效\n  const countryCode = rawCountryCode && \n                     typeof rawCountryCode === 'string' &&\n                     rawCountryCode !== 'api' && \n                     rawCountryCode.length === 2 && \n                     /^[a-z]{2}$/.test(rawCountryCode) \n                     ? rawCountryCode \n                     : 'tw'\n\n  const active = route.split(countryCode)[1] === href\n  return (\n    <LocalizedClientLink\n      href={href}\n      className={clx(\"text-ui-fg-subtle hover:text-ui-fg-base\", {\n        \"text-ui-fg-base font-semibold\": active,\n      })}\n      data-testid={dataTestId}\n    >\n      {children}\n    </LocalizedClientLink>\n  )\n}\n\nexport default AccountNav\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/account/components/address-book/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/account/components/address-card/add-address.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","message":"Definition for rule 'react-hooks/exhaustive-deps' was not found.","line":40,"column":5,"endLine":40,"endColumn":60,"severity":2,"nodeType":null}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { Plus } from \"@medusajs/icons\"\nimport { Button, Heading } from \"@medusajs/ui\"\nimport { useEffect, useState, useActionState } from \"react\"\n\nimport useToggleState from \"@lib/hooks/use-toggle-state\"\nimport CountrySelect from \"@modules/checkout/components/country-select\"\nimport Input from \"@modules/common/components/input\"\nimport Modal from \"@modules/common/components/modal\"\nimport { SubmitButton } from \"@modules/checkout/components/submit-button\"\nimport { HttpTypes } from \"@medusajs/types\"\nimport { addCustomerAddress } from \"@lib/data/customer\"\n\nconst AddAddress = ({\n  region,\n  addresses,\n}: {\n  region: HttpTypes.StoreRegion\n  addresses: HttpTypes.StoreCustomerAddress[]\n}) => {\n  const [successState, setSuccessState] = useState(false)\n  const { state, open, close: closeModal } = useToggleState(false)\n\n  const [formState, formAction] = useActionState(addCustomerAddress, {\n    isDefaultShipping: addresses.length === 0,\n    success: false,\n    error: null,\n  })\n\n  const close = () => {\n    setSuccessState(false)\n    closeModal()\n  }\n\n  useEffect(() => {\n    if (successState) {\n      close()\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [successState])\n\n  useEffect(() => {\n    if (formState.success) {\n      setSuccessState(true)\n    }\n  }, [formState])\n\n  return (\n    <>\n      <button\n        className=\"border border-ui-border-base rounded-rounded p-5 min-h-[220px] h-full w-full flex flex-col justify-between\"\n        onClick={open}\n        data-testid=\"add-address-button\"\n      >\n        <span className=\"text-base-semi\">New address</span>\n        <Plus />\n      </button>\n\n      <Modal isOpen={state} close={close} data-testid=\"add-address-modal\">\n        <Modal.Title>\n          <Heading className=\"mb-2\">Add address</Heading>\n        </Modal.Title>\n        <form action={formAction}>\n          <Modal.Body>\n            <div className=\"flex flex-col gap-y-2\">\n              <div className=\"grid grid-cols-2 gap-x-2\">\n                <Input\n                  label=\"First name\"\n                  name=\"first_name\"\n                  required\n                  autoComplete=\"given-name\"\n                  data-testid=\"first-name-input\"\n                />\n                <Input\n                  label=\"Last name\"\n                  name=\"last_name\"\n                  required\n                  autoComplete=\"family-name\"\n                  data-testid=\"last-name-input\"\n                />\n              </div>\n              <Input\n                label=\"Company\"\n                name=\"company\"\n                autoComplete=\"organization\"\n                data-testid=\"company-input\"\n              />\n              <Input\n                label=\"Address\"\n                name=\"address_1\"\n                required\n                autoComplete=\"address-line1\"\n                data-testid=\"address-1-input\"\n              />\n              <Input\n                label=\"Apartment, suite, etc.\"\n                name=\"address_2\"\n                autoComplete=\"address-line2\"\n                data-testid=\"address-2-input\"\n              />\n              <div className=\"grid grid-cols-[144px_1fr] gap-x-2\">\n                <Input\n                  label=\"Postal code\"\n                  name=\"postal_code\"\n                  required\n                  autoComplete=\"postal-code\"\n                  data-testid=\"postal-code-input\"\n                />\n                <Input\n                  label=\"City\"\n                  name=\"city\"\n                  required\n                  autoComplete=\"locality\"\n                  data-testid=\"city-input\"\n                />\n              </div>\n              <Input\n                label=\"Province / State\"\n                name=\"province\"\n                autoComplete=\"address-level1\"\n                data-testid=\"state-input\"\n              />\n              <CountrySelect\n                region={region}\n                name=\"country_code\"\n                required\n                autoComplete=\"country\"\n                data-testid=\"country-select\"\n              />\n              <Input\n                label=\"Phone\"\n                name=\"phone\"\n                autoComplete=\"phone\"\n                data-testid=\"phone-input\"\n              />\n            </div>\n            {formState.error && (\n              <div\n                className=\"text-rose-500 text-small-regular py-2\"\n                data-testid=\"address-error\"\n              >\n                {formState.error}\n              </div>\n            )}\n          </Modal.Body>\n          <Modal.Footer>\n            <div className=\"flex gap-3 mt-6\">\n              <Button\n                type=\"reset\"\n                variant=\"secondary\"\n                onClick={close}\n                className=\"h-10\"\n                data-testid=\"cancel-button\"\n              >\n                Cancel\n              </Button>\n              <SubmitButton data-testid=\"save-button\">Save</SubmitButton>\n            </div>\n          </Modal.Footer>\n        </form>\n      </Modal>\n    </>\n  )\n}\n\nexport default AddAddress\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/account/components/address-card/edit-address-modal.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","message":"Definition for rule 'react-hooks/exhaustive-deps' was not found.","line":49,"column":5,"endLine":49,"endColumn":60,"severity":2,"nodeType":null},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":138,"column":52,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":138,"endColumn":54,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[4302,4304],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":146,"column":51,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":146,"endColumn":53,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[4600,4602],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":154,"column":47,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":154,"endColumn":49,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[4876,4878],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":162,"column":49,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":162,"endColumn":51,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[5155,5157],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":169,"column":49,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":169,"endColumn":51,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[5426,5428],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":178,"column":53,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":178,"endColumn":55,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[5792,5794],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":186,"column":46,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":186,"endColumn":48,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[6073,6075],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":194,"column":48,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":194,"endColumn":50,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[6357,6359],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":202,"column":52,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":202,"endColumn":54,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[6642,6644],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":209,"column":45,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":209,"endColumn":47,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[6879,6881],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":11,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport React, { useEffect, useState, useActionState } from \"react\"\nimport { PencilSquare as Edit, Trash } from \"@medusajs/icons\"\nimport { Button, Heading, Text, clx } from \"@medusajs/ui\"\n\nimport useToggleState from \"@lib/hooks/use-toggle-state\"\nimport CountrySelect from \"@modules/checkout/components/country-select\"\nimport Input from \"@modules/common/components/input\"\nimport Modal from \"@modules/common/components/modal\"\nimport Spinner from \"@modules/common/icons/spinner\"\nimport { SubmitButton } from \"@modules/checkout/components/submit-button\"\nimport { HttpTypes } from \"@medusajs/types\"\nimport {\n  deleteCustomerAddress,\n  updateCustomerAddress,\n} from \"@lib/data/customer\"\n\ntype EditAddressProps = {\n  region: HttpTypes.StoreRegion\n  address: HttpTypes.StoreCustomerAddress\n  isActive?: boolean\n}\n\nconst EditAddress: React.FC<EditAddressProps> = ({\n  region,\n  address,\n  isActive = false,\n}) => {\n  const [removing, setRemoving] = useState(false)\n  const [successState, setSuccessState] = useState(false)\n  const { state, open, close: closeModal } = useToggleState(false)\n\n  const [formState, formAction] = useActionState(updateCustomerAddress, {\n    success: false,\n    error: null,\n    addressId: address.id,\n  })\n\n  const close = () => {\n    setSuccessState(false)\n    closeModal()\n  }\n\n  useEffect(() => {\n    if (successState) {\n      close()\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [successState])\n\n  useEffect(() => {\n    if (formState.success) {\n      setSuccessState(true)\n    }\n  }, [formState])\n\n  const removeAddress = async () => {\n    setRemoving(true)\n    await deleteCustomerAddress(address.id)\n    setRemoving(false)\n  }\n\n  return (\n    <>\n      <div\n        className={clx(\n          \"border rounded-rounded p-5 min-h-[220px] h-full w-full flex flex-col justify-between transition-colors\",\n          {\n            \"border-gray-900\": isActive,\n          }\n        )}\n        data-testid=\"address-container\"\n      >\n        <div className=\"flex flex-col\">\n          <Heading\n            className=\"text-left text-base-semi\"\n            data-testid=\"address-name\"\n          >\n            {address.first_name} {address.last_name}\n          </Heading>\n          {address.company && (\n            <Text\n              className=\"txt-compact-small text-ui-fg-base\"\n              data-testid=\"address-company\"\n            >\n              {address.company}\n            </Text>\n          )}\n          <Text className=\"flex flex-col text-left text-base-regular mt-2\">\n            <span data-testid=\"address-address\">\n              {address.address_1}\n              {address.address_2 && <span>, {address.address_2}</span>}\n            </span>\n            <span data-testid=\"address-postal-city\">\n              {address.postal_code}, {address.city}\n            </span>\n            <span data-testid=\"address-province-country\">\n              {address.province && `${address.province}, `}\n              {address.country_code?.toUpperCase()}\n            </span>\n          </Text>\n        </div>\n        <div className=\"flex items-center gap-x-4\">\n          <button\n            className=\"text-small-regular text-ui-fg-base flex items-center gap-x-2\"\n            onClick={open}\n            data-testid=\"address-edit-button\"\n          >\n            <Edit />\n            Edit\n          </button>\n          <button\n            className=\"text-small-regular text-ui-fg-base flex items-center gap-x-2\"\n            onClick={removeAddress}\n            data-testid=\"address-delete-button\"\n          >\n            {removing ? <Spinner /> : <Trash />}\n            Remove\n          </button>\n        </div>\n      </div>\n\n      <Modal isOpen={state} close={close} data-testid=\"edit-address-modal\">\n        <Modal.Title>\n          <Heading className=\"mb-2\">Edit address</Heading>\n        </Modal.Title>\n        <form action={formAction}>\n          <input type=\"hidden\" name=\"addressId\" value={address.id} />\n          <Modal.Body>\n            <div className=\"grid grid-cols-1 gap-y-2\">\n              <div className=\"grid grid-cols-2 gap-x-2\">\n                <Input\n                  label=\"First name\"\n                  name=\"first_name\"\n                  required\n                  autoComplete=\"given-name\"\n                  defaultValue={address.first_name || undefined}\n                  data-testid=\"first-name-input\"\n                />\n                <Input\n                  label=\"Last name\"\n                  name=\"last_name\"\n                  required\n                  autoComplete=\"family-name\"\n                  defaultValue={address.last_name || undefined}\n                  data-testid=\"last-name-input\"\n                />\n              </div>\n              <Input\n                label=\"Company\"\n                name=\"company\"\n                autoComplete=\"organization\"\n                defaultValue={address.company || undefined}\n                data-testid=\"company-input\"\n              />\n              <Input\n                label=\"Address\"\n                name=\"address_1\"\n                required\n                autoComplete=\"address-line1\"\n                defaultValue={address.address_1 || undefined}\n                data-testid=\"address-1-input\"\n              />\n              <Input\n                label=\"Apartment, suite, etc.\"\n                name=\"address_2\"\n                autoComplete=\"address-line2\"\n                defaultValue={address.address_2 || undefined}\n                data-testid=\"address-2-input\"\n              />\n              <div className=\"grid grid-cols-[144px_1fr] gap-x-2\">\n                <Input\n                  label=\"Postal code\"\n                  name=\"postal_code\"\n                  required\n                  autoComplete=\"postal-code\"\n                  defaultValue={address.postal_code || undefined}\n                  data-testid=\"postal-code-input\"\n                />\n                <Input\n                  label=\"City\"\n                  name=\"city\"\n                  required\n                  autoComplete=\"locality\"\n                  defaultValue={address.city || undefined}\n                  data-testid=\"city-input\"\n                />\n              </div>\n              <Input\n                label=\"Province / State\"\n                name=\"province\"\n                autoComplete=\"address-level1\"\n                defaultValue={address.province || undefined}\n                data-testid=\"state-input\"\n              />\n              <CountrySelect\n                name=\"country_code\"\n                region={region}\n                required\n                autoComplete=\"country\"\n                defaultValue={address.country_code || undefined}\n                data-testid=\"country-select\"\n              />\n              <Input\n                label=\"Phone\"\n                name=\"phone\"\n                autoComplete=\"phone\"\n                defaultValue={address.phone || undefined}\n                data-testid=\"phone-input\"\n              />\n            </div>\n            {formState.error && (\n              <div className=\"text-rose-500 text-small-regular py-2\">\n                {formState.error}\n              </div>\n            )}\n          </Modal.Body>\n          <Modal.Footer>\n            <div className=\"flex gap-3 mt-6\">\n              <Button\n                type=\"reset\"\n                variant=\"secondary\"\n                onClick={close}\n                className=\"h-10\"\n                data-testid=\"cancel-button\"\n              >\n                Cancel\n              </Button>\n              <SubmitButton data-testid=\"save-button\">Save</SubmitButton>\n            </div>\n          </Modal.Footer>\n        </form>\n      </Modal>\n    </>\n  )\n}\n\nexport default EditAddress\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/account/components/google-login-button.tsx","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":12,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":12,"endColumn":18,"suggestions":[{"fix":{"range":[291,338],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":15,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[419,422],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[419,422],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":16,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[486,489],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[486,489],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":17,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":17,"endColumn":20,"suggestions":[{"fix":{"range":[538,570],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":21,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":21,"endColumn":18,"suggestions":[{"fix":{"range":[633,689],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":29,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":29,"endColumn":18,"suggestions":[{"fix":{"range":[910,1133],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":38,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":38,"endColumn":20,"suggestions":[{"fix":{"range":[1292,1591],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":47,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":47,"endColumn":22,"suggestions":[{"fix":{"range":[1736,1786],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":49,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":49,"endColumn":22,"suggestions":[{"fix":{"range":[1864,1892],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-alert","severity":2,"message":"Unexpected alert.","line":63,"column":9,"nodeType":"CallExpression","messageId":"unexpected","endLine":63,"endColumn":28},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":71,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":71,"endColumn":16,"suggestions":[{"fix":{"range":[2525,2546],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":73,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":73,"endColumn":20,"suggestions":[{"fix":{"range":[2575,2611],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-alert","severity":2,"message":"Unexpected alert.","line":74,"column":7,"nodeType":"CallExpression","messageId":"unexpected","endLine":74,"endColumn":29}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":11,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\" // include with Next.js 13+\n\nimport { useState } from \"react\"\nimport { sdk } from \"@/lib/config\"\n\nexport default function GoogleLoginButton() {\n  const [isLoading, setIsLoading] = useState(false)\n  \n  const loginWithGoogle = async () => {\n    setIsLoading(true)\n    try {\n      console.log('🔑 開始 Google 登入流程 - 檢查 OAuth URL')\n      \n      // 🔧 禁用自動選擇\n      if (typeof window !== 'undefined' && (window as any).google?.accounts?.id?.disableAutoSelect) {\n        (window as any).google.accounts.id.disableAutoSelect()\n        console.log('✅ 已禁用 Google 自動選擇')\n      }\n      \n      // 🔧 發起 Google OAuth 請求並檢查生成的 URL\n      console.log('📡 發起 Google OAuth 請求，檢查 URL 是否包含正確的參數...')\n      const result = await sdk.auth.login(\"customer\", \"google\", {\n        prompt: \"consent select_account\",\n        approval_prompt: \"force\",\n        access_type: \"offline\"\n      })\n      \n      // 🔍 檢查返回的結果和 URL\n      console.log('🔍 Google OAuth 結果:', {\n        resultType: typeof result,\n        hasLocation: typeof result === \"object\" && result?.location,\n        locationUrl: typeof result === \"object\" ? result?.location : null\n      })\n      \n      // 如果有 location URL，檢查是否包含必要的參數\n      if (typeof result === \"object\" && result?.location) {\n        const url = new URL(result.location)\n        console.log('🔍 Google OAuth URL 參數檢查:', {\n          prompt: url.searchParams.get('prompt'),\n          access_type: url.searchParams.get('access_type'),\n          approval_prompt: url.searchParams.get('approval_prompt'),\n          allParams: Object.fromEntries(url.searchParams.entries())\n        })\n        \n        // 如果 URL 沒有包含 prompt=select_account，手動添加\n        if (!url.searchParams.get('prompt')?.includes('select_account')) {\n          console.log('⚠️ URL 缺少 select_account 參數，手動添加...')\n          url.searchParams.set('prompt', 'consent select_account')\n          console.log('✅ 已添加強制帳號選擇參數')\n          window.location.href = url.toString()\n          return\n        }\n      }\n\n      if (typeof result === \"object\" && result.location) {\n        // redirect to Google for authentication\n        window.location.href = result.location\n        return\n      }\n      \n      if (typeof result !== \"string\") {\n        // result failed, show an error\n        alert(\"認證失敗，請稍後重試\")\n        setIsLoading(false)\n        return\n      }\n\n    // Customer was previously authenticated, and its token is now stored in the JS SDK.\n    // all subsequent requests are authenticated\n    const { customer } = await sdk.store.customer.retrieve()\n    console.log(customer)\n    } catch (error) {\n      console.error(\"Google 登入錯誤:\", error)\n      alert(\"登入時發生錯誤，請稍後重試\")\n      setIsLoading(false)\n    }\n  }\n\n  return (\n    <div className=\"w-full\">\n      <button \n        onClick={loginWithGoogle}\n        disabled={isLoading}\n        className={`flex items-center justify-center w-full px-5 py-2.5 border border-gray-300 rounded-md transition-colors ${\n          isLoading ? 'bg-gray-100 cursor-not-allowed' : 'hover:bg-gray-50 cursor-pointer'\n        }`}\n      >\n        {isLoading ? (\n          <>\n            <svg className=\"animate-spin -ml-1 mr-2 h-4 w-4 text-gray-700\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\">\n              <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\"></circle>\n              <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\n            </svg>\n            處理中...\n          </>\n        ) : (\n          <>\n            <svg className=\"w-5 h-5 mr-2\" viewBox=\"0 0 24 24\">\n              <path\n                fill=\"#4285F4\"\n                d=\"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z\"\n              />\n              <path\n                fill=\"#34A853\"\n                d=\"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z\"\n              />\n              <path\n                fill=\"#FBBC05\"\n                d=\"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z\"\n              />\n              <path\n                fill=\"#EA4335\"\n                d=\"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z\"\n              />\n            </svg>\n            使用 Google 登入\n          </>\n        )}\n      </button>\n    </div>\n  )\n}","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/account/components/login/index.tsx","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":26,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":26,"endColumn":18,"suggestions":[{"fix":{"range":[821,854],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":36,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":36,"endColumn":24,"suggestions":[{"fix":{"range":[1113,1146],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":74,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":74,"endColumn":20,"suggestions":[{"fix":{"range":[2141,2177],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { login } from \"@lib/data/customer\"\nimport { LOGIN_VIEW } from \"@modules/account/templates/login-template\"\nimport ErrorMessage from \"@modules/checkout/components/error-message\"\nimport { SubmitButton } from \"@modules/checkout/components/submit-button\"\nimport Input from \"@modules/common/components/input\"\nimport { useActionState, useState, useEffect } from \"react\"\nimport { useAccount } from \"@lib/context/account-context\"\n\ntype Props = {\n  setCurrentView: (view: LOGIN_VIEW) => void\n}\n\ninterface EmailCheckResult {\n  exists: boolean\n  authProvider: 'password' | null\n  message: string\n}\n\nconst Login = ({ setCurrentView }: Props) => {\n  const [result, formAction] = useActionState(login, null)\n  const { refreshCustomer } = useAccount()\n\n  // 處理登入成功\n  useEffect(() => {\n    if (result === \"login_success\") {\n      console.log(\"🎉 登入成功，刷新客戶狀態並重定向\")\n      \n      const handleSuccess = async () => {\n        try {\n          await refreshCustomer()\n          // 給 cookie 一點時間生效\n          setTimeout(() => {\n            window.location.href = '/tw/account'\n          }, 500)\n        } catch (error) {\n          console.error(\"刷新客戶狀態失敗:\", error)\n          // 即使刷新失敗，也嘗試重定向\n          setTimeout(() => {\n            window.location.href = '/tw/account'\n          }, 500)\n        }\n      }\n      \n      handleSuccess()\n    }\n  }, [result, refreshCustomer])\n\n  // 錯誤訊息：如果不是成功狀態，就當作錯誤訊息\n  const errorMessage = result && result !== \"login_success\" ? result : null\n  const [emailCheckResult, setEmailCheckResult] = useState<EmailCheckResult | null>(null)\n  const [isCheckingEmail, setIsCheckingEmail] = useState(false)\n\n  const checkEmail = async (email: string) => {\n    if (!email?.includes('@')) {\n      setEmailCheckResult(null)\n      return\n    }\n\n    setIsCheckingEmail(true)\n    try {\n      const response = await fetch('/api/auth/check-email', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({ email }),\n      })\n\n      if (response.ok) {\n        const result = await response.json()\n        setEmailCheckResult(result)\n      }\n    } catch (error) {\n      console.error('檢查 email 失敗:', error)\n    } finally {\n      setIsCheckingEmail(false)\n    }\n  }\n\n  return (\n    <div\n      className=\"max-w-sm w-full flex flex-col items-center\"\n      data-testid=\"login-page\"\n    >\n      {/* 移除重複的標題，因為在 LoginTemplate 中已經有了 */}\n      <form className=\"w-full\" action={formAction}>\n        <div className=\"flex flex-col w-full gap-y-2\">\n          <Input\n            label=\"電子郵件\"\n            name=\"email\"\n            type=\"email\"\n            title=\"請輸入有效的電子郵件地址。\"\n            autoComplete=\"email\"\n            required\n            data-testid=\"email-input\"\n            onBlur={(e) => checkEmail(e.target.value)}\n          />\n          \n          {/* 顯示 email 檢查結果 */}\n          {isCheckingEmail && (\n            <div className=\"text-sm text-gray-500\">\n              檢查帳戶狀態中...\n            </div>\n          )}\n          \n          {emailCheckResult?.exists && emailCheckResult.authProvider === 'password' && (\n            <div className=\"bg-green-50 border border-green-200 rounded-md p-3\">\n              <p className=\"text-sm text-green-700\">\n                ✅ 此電子郵件可使用密碼登入\n              </p>\n            </div>\n          )}\n          \n          {emailCheckResult && !emailCheckResult.exists && (\n            <div className=\"bg-orange-50 border border-orange-200 rounded-md p-3\">\n              <p className=\"text-sm text-orange-700\">\n                ℹ️ 此電子郵件尚未註冊，請先註冊帳戶\n              </p>\n            </div>\n          )}\n          \n          <Input\n            label=\"密碼\"\n            name=\"password\"\n            type=\"password\"\n            autoComplete=\"current-password\"\n            required\n            data-testid=\"password-input\"\n            disabled={false}\n          />\n        </div>\n        \n        {/* 忘記密碼連結 */}\n        <div className=\"flex justify-end mb-4\">\n          <button\n            type=\"button\"\n            onClick={() => window.location.href = '/tw/forgot-password'}\n            className=\"text-sm text-blue-600 hover:text-blue-800 underline\"\n          >\n            忘記密碼？\n          </button>\n        </div>\n        \n        <ErrorMessage error={errorMessage} data-testid=\"login-error-message\" />\n        \n        <SubmitButton \n          data-testid=\"sign-in-button\" \n          className=\"w-full mt-6\"\n        >\n          登入\n        </SubmitButton>\n      </form>\n      <span className=\"text-center text-ui-fg-base text-small-regular mt-6\">\n        還不是會員？{\" \"}\n        <button\n          onClick={() => setCurrentView(LOGIN_VIEW.REGISTER)}\n          className=\"underline\"\n          data-testid=\"register-button\"\n        >\n          立即加入\n        </button>\n        。\n      </span>\n\n    </div>\n  )\n}\n\nexport default Login\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/account/components/order-card/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/account/components/order-details/index.tsx","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":40,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":40,"endColumn":22,"suggestions":[{"fix":{"range":[1151,1184],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { useEffect, useState } from \"react\"\nimport { Button } from \"@medusajs/ui\"\nimport LocalizedClientLink from \"@modules/common/components/localized-client-link\"\nimport Thumbnail from \"@modules/products/components/thumbnail\"\nimport { convertToLocale } from \"@lib/util/money\"\nimport { HttpTypes } from \"@medusajs/types\"\n\ntype OrderDetailsProps = {\n  orderId: string\n  countryCode: string\n}\n\nconst OrderDetails = ({ orderId, countryCode }: OrderDetailsProps) => {\n  const [order, setOrder] = useState<HttpTypes.StoreOrder | null>(null)\n  const [loading, setLoading] = useState(true)\n  const [error, setError] = useState<string | null>(null)\n\n  useEffect(() => {\n    const fetchOrder = async () => {\n      try {\n        setLoading(true)\n        setError(null)\n\n        const response = await fetch(`/api/customer/orders/${orderId}`)\n        \n        if (!response.ok) {\n          if (response.status === 404) {\n            setError('訂單不存在')\n          } else {\n            setError('無法載入訂單詳情')\n          }\n          return\n        }\n\n        const data = await response.json()\n        setOrder(data.order)\n      } catch (error) {\n        console.error('載入訂單詳情失敗:', error)\n        setError('載入訂單詳情時發生錯誤')\n      } finally {\n        setLoading(false)\n      }\n    }\n\n    if (orderId) {\n      fetchOrder()\n    }\n  }, [orderId])\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center min-h-[200px]\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 mx-auto mb-4\"></div>\n          <p>載入中...</p>\n        </div>\n      </div>\n    )\n  }\n\n  if (error) {\n    return (\n      <div className=\"text-center py-8\">\n        <p className=\"text-red-500 mb-4\">{error}</p>\n        <LocalizedClientLink href={`/${countryCode}/account/orders`}>\n          <Button variant=\"secondary\">\n            ← 返回訂單列表\n          </Button>\n        </LocalizedClientLink>\n      </div>\n    )\n  }\n\n  if (!order) {\n    return (\n      <div className=\"text-center py-8\">\n        <p className=\"text-gray-500 mb-4\">訂單不存在</p>\n        <LocalizedClientLink href={`/${countryCode}/account/orders`}>\n          <Button variant=\"secondary\">\n            ← 返回訂單列表\n          </Button>\n        </LocalizedClientLink>\n      </div>\n    )\n  }\n\n  const orderStatus = order.status || 'pending'\n  const paymentStatus = order.payment_status || 'pending'\n  const fulfillmentStatus = order.fulfillment_status || 'not_fulfilled'\n\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case 'completed':\n      case 'fulfilled':\n      case 'captured':\n        return 'text-green-600 bg-green-50'\n      case 'pending':\n      case 'not_fulfilled':\n        return 'text-yellow-600 bg-yellow-50'\n      case 'canceled':\n      case 'cancelled':\n      case 'requires_action':\n        return 'text-red-600 bg-red-50'\n      default:\n        return 'text-gray-600 bg-gray-50'\n    }\n  }\n\n  const getStatusText = (status: string) => {\n    switch (status) {\n      case 'completed': return '已完成'\n      case 'pending': return '處理中'\n      case 'canceled': return '已取消'\n      case 'cancelled': return '已取消'\n      case 'fulfilled': return '已出貨'\n      case 'not_fulfilled': return '未出貨'\n      case 'captured': return '已付款'\n      case 'requires_action': return '需要處理'\n      default: return status\n    }\n  }\n\n  return (\n    <div className=\"w-full max-w-4xl mx-auto\">\n      {/* 返回按鈕 */}\n      <div className=\"mb-6\">\n        <LocalizedClientLink href={`/${countryCode}/account/orders`}>\n          <Button variant=\"secondary\">\n            ← 返回訂單列表\n          </Button>\n        </LocalizedClientLink>\n      </div>\n\n      {/* 訂單資訊 */}\n      <div className=\"bg-white border rounded-lg p-6 mb-6\">\n        <div className=\"flex justify-between items-start mb-4\">\n          <div>\n            <h2 className=\"text-xl font-semibold\">\n              訂單 #{order.display_id}\n            </h2>\n            <p className=\"text-gray-600 text-sm\">\n              下單時間: {new Date(order.created_at).toLocaleString('zh-TW')}\n            </p>\n          </div>\n          <div className=\"text-right\">\n            <div className=\"text-lg font-semibold\">\n              {convertToLocale({\n                amount: order.total,\n                currency_code: order.currency_code,\n              })}\n            </div>\n          </div>\n        </div>\n\n        {/* 狀態標籤 */}\n        <div className=\"flex gap-2 mb-4\">\n          <span className={`px-3 py-1 rounded-full text-xs font-medium ${getStatusColor(orderStatus)}`}>\n            訂單狀態: {getStatusText(orderStatus)}\n          </span>\n          <span className={`px-3 py-1 rounded-full text-xs font-medium ${getStatusColor(paymentStatus)}`}>\n            付款狀態: {getStatusText(paymentStatus)}\n          </span>\n          <span className={`px-3 py-1 rounded-full text-xs font-medium ${getStatusColor(fulfillmentStatus)}`}>\n            出貨狀態: {getStatusText(fulfillmentStatus)}\n          </span>\n        </div>\n      </div>\n\n      {/* 訂單商品 */}\n      <div className=\"bg-white border rounded-lg p-6 mb-6\">\n        <h3 className=\"text-lg font-semibold mb-4\">訂單商品</h3>\n        <div className=\"space-y-4\">\n          {order.items?.map((item) => (\n            <div key={item.id} className=\"flex items-center gap-4 p-4 border rounded-lg\">\n              <div className=\"w-16 h-16 flex-shrink-0\">\n                <Thumbnail thumbnail={item.thumbnail} images={[]} size=\"full\" />\n              </div>\n              <div className=\"flex-grow\">\n                <h4 className=\"font-medium\">{item.title}</h4>\n                {item.variant?.title && (\n                  <p className=\"text-sm text-gray-600\">{item.variant.title}</p>\n                )}\n                <p className=\"text-sm text-gray-600\">數量: {item.quantity}</p>\n              </div>\n              <div className=\"text-right\">\n                <div className=\"font-medium\">\n                  {convertToLocale({\n                    amount: item.total || 0,\n                    currency_code: order.currency_code,\n                  })}\n                </div>\n                <div className=\"text-sm text-gray-600\">\n                  單價: {convertToLocale({\n                    amount: Math.round((item.total || 0) / item.quantity),\n                    currency_code: order.currency_code,\n                  })}\n                </div>\n              </div>\n            </div>\n          ))}\n        </div>\n      </div>\n\n      {/* 收貨地址 */}\n      {order.shipping_address && (\n        <div className=\"bg-white border rounded-lg p-6 mb-6\">\n          <h3 className=\"text-lg font-semibold mb-4\">收貨地址</h3>\n          <div className=\"text-sm space-y-1\">\n            <p className=\"font-medium\">\n              {order.shipping_address.first_name} {order.shipping_address.last_name}\n            </p>\n            {order.shipping_address.company && (\n              <p>{order.shipping_address.company}</p>\n            )}\n            <p>{order.shipping_address.address_1}</p>\n            {order.shipping_address.address_2 && (\n              <p>{order.shipping_address.address_2}</p>\n            )}\n            <p>\n              {order.shipping_address.city}, {order.shipping_address.province} {order.shipping_address.postal_code}\n            </p>\n            <p>{order.shipping_address.country_code?.toUpperCase()}</p>\n            {order.shipping_address.phone && (\n              <p>電話: {order.shipping_address.phone}</p>\n            )}\n          </div>\n        </div>\n      )}\n\n      {/* 訂單摘要 */}\n      <div className=\"bg-white border rounded-lg p-6\">\n        <h3 className=\"text-lg font-semibold mb-4\">訂單摘要</h3>\n        <div className=\"space-y-2 text-sm\">\n          <div className=\"flex justify-between\">\n            <span>小計</span>\n            <span>\n              {convertToLocale({\n                amount: order.subtotal || 0,\n                currency_code: order.currency_code,\n              })}\n            </span>\n          </div>\n          <div className=\"flex justify-between\">\n            <span>運費</span>\n            <span>\n              {convertToLocale({\n                amount: order.shipping_total || 0,\n                currency_code: order.currency_code,\n              })}\n            </span>\n          </div>\n          <div className=\"flex justify-between\">\n            <span>稅金</span>\n            <span>\n              {convertToLocale({\n                amount: order.tax_total || 0,\n                currency_code: order.currency_code,\n              })}\n            </span>\n          </div>\n          <div className=\"border-t pt-2 flex justify-between font-semibold\">\n            <span>總計</span>\n            <span>\n              {convertToLocale({\n                amount: order.total,\n                currency_code: order.currency_code,\n              })}\n            </span>\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}\n\nexport default OrderDetails","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/account/components/order-overview/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/account/components/overview/index.tsx","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":57,"column":61,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":57,"endColumn":63,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2328,2330],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":59,"column":50,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":59,"endColumn":52,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2403,2405],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Container } from \"@medusajs/ui\"\n\nimport ChevronDown from \"@modules/common/icons/chevron-down\"\nimport LocalizedClientLink from \"@modules/common/components/localized-client-link\"\nimport { convertToLocale } from \"@lib/util/money\"\nimport { HttpTypes } from \"@medusajs/types\"\n\ntype OverviewProps = {\n  customer: HttpTypes.StoreCustomer | null\n  orders: HttpTypes.StoreOrder[] | null\n}\n\nconst Overview = ({ customer, orders }: OverviewProps) => {\n  return (\n    <div data-testid=\"overview-page-wrapper\">\n      <div className=\"hidden small:block\">\n        <div className=\"text-xl-semi flex justify-between items-center mb-4\">\n          <span data-testid=\"welcome-message\" data-value={customer?.first_name}>\n            您好 {customer?.first_name}\n          </span>\n          <span className=\"text-small-regular text-ui-fg-base\">\n            登入身份：{\" \"}\n            <span\n              className=\"font-semibold\"\n              data-testid=\"customer-email\"\n              data-value={customer?.email}\n            >\n              {customer?.email}\n            </span>\n          </span>\n        </div>\n        <div className=\"flex flex-col py-8 border-t border-gray-200\">\n          <div className=\"flex flex-col gap-y-4 h-full col-span-1 row-span-2 flex-1\">\n            <div className=\"flex items-start gap-x-16 mb-6\">\n              <div className=\"flex flex-col gap-y-4\">\n                <h3 className=\"text-large-semi\">個人檔案</h3>\n                <div className=\"flex items-end gap-x-2\">\n                  <span\n                    className=\"text-3xl-semi leading-none\"\n                    data-testid=\"customer-profile-completion\"\n                    data-value={getProfileCompletion(customer)}\n                  >\n                    {getProfileCompletion(customer)}%\n                  </span>\n                  <span className=\"uppercase text-base-regular text-ui-fg-subtle\">\n                    已完成\n                  </span>\n                </div>\n              </div>\n\n              <div className=\"flex flex-col gap-y-4\">\n                <h3 className=\"text-large-semi\">地址</h3>\n                <div className=\"flex items-end gap-x-2\">\n                  <span\n                    className=\"text-3xl-semi leading-none\"\n                    data-testid=\"addresses-count\"\n                    data-value={customer?.addresses?.length || 0}\n                  >\n                    {customer?.addresses?.length || 0}\n                  </span>\n                  <span className=\"uppercase text-base-regular text-ui-fg-subtle\">\n                    已儲存\n                  </span>\n                </div>\n              </div>\n            </div>\n\n            <div className=\"flex flex-col gap-y-4\">\n              <div className=\"flex items-center gap-x-2\">\n                <h3 className=\"text-large-semi\">最近訂單</h3>\n              </div>\n              <ul\n                className=\"flex flex-col gap-y-4\"\n                data-testid=\"orders-wrapper\"\n              >\n                {orders && orders.length > 0 ? (\n                  orders.slice(0, 5).map((order) => {\n                    return (\n                      <li\n                        key={order.id}\n                        data-testid=\"order-wrapper\"\n                        data-value={order.id}\n                      >\n                        <LocalizedClientLink\n                          href={`/account/orders/details/${order.id}`}\n                        >\n                          <Container className=\"bg-gray-50 flex justify-between items-center p-4\">\n                            <div className=\"grid grid-cols-3 grid-rows-2 text-small-regular gap-x-4 flex-1\">\n                              <span className=\"font-semibold\">下單日期</span>\n                              <span className=\"font-semibold\">\n                                訂單編號\n                              </span>\n                              <span className=\"font-semibold\">\n                                總金額\n                              </span>\n                              <span data-testid=\"order-created-date\">\n                                {new Date(order.created_at).toDateString()}\n                              </span>\n                              <span\n                                data-testid=\"order-id\"\n                                data-value={order.display_id}\n                              >\n                                #{order.display_id}\n                              </span>\n                              <span data-testid=\"order-amount\">\n                                {convertToLocale({\n                                  amount: order.total,\n                                  currency_code: order.currency_code,\n                                })}\n                              </span>\n                            </div>\n                            <button\n                              className=\"flex items-center justify-between\"\n                              data-testid=\"open-order-button\"\n                            >\n                              <span className=\"sr-only\">\n                                前往訂單 #{order.display_id}\n                              </span>\n                              <ChevronDown className=\"-rotate-90\" />\n                            </button>\n                          </Container>\n                        </LocalizedClientLink>\n                      </li>\n                    )\n                  })\n                ) : (\n                  <span data-testid=\"no-orders-message\">沒有最近訂單</span>\n                )}\n              </ul>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}\n\nconst getProfileCompletion = (customer: HttpTypes.StoreCustomer | null) => {\n  let count = 0\n\n  if (!customer) {\n    return 0\n  }\n\n  if (customer.email) {\n    count++\n  }\n\n  if (customer.first_name && customer.last_name) {\n    count++\n  }\n\n  if (customer.phone) {\n    count++\n  }\n\n  const billingAddress = customer.addresses?.find(\n    (addr) => addr.is_default_billing\n  )\n\n  if (billingAddress) {\n    count++\n  }\n\n  return (count / 4) * 100\n}\n\nexport default Overview\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/account/components/profile-billing-address/index.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":40,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":40,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1056,1059],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1056,1059],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":72,"column":16,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":72,"endColumn":18,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1742,1744],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":108,"column":56,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":108,"endColumn":58,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2999,3001],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":115,"column":55,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":115,"endColumn":57,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3240,3242],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":123,"column":51,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":123,"endColumn":53,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3483,3485],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":129,"column":53,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":129,"endColumn":55,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3684,3686],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":136,"column":53,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":136,"endColumn":55,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3923,3925],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":143,"column":57,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":143,"endColumn":59,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[4205,4207],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":150,"column":50,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":150,"endColumn":52,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[4433,4435],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":158,"column":52,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":158,"endColumn":54,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[4674,4676],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":163,"column":56,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":163,"endColumn":58,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[4861,4863],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":10,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport React, { useEffect, useMemo, useActionState } from \"react\"\n\nimport Input from \"@modules/common/components/input\"\nimport NativeSelect from \"@modules/common/components/native-select\"\n\nimport AccountInfo from \"../account-info\"\nimport { HttpTypes } from \"@medusajs/types\"\nimport { addCustomerAddress, updateCustomerAddress } from \"@lib/data/customer\"\n\ntype MyInformationProps = {\n  customer: HttpTypes.StoreCustomer\n  regions: HttpTypes.StoreRegion[]\n}\n\nconst ProfileBillingAddress: React.FC<MyInformationProps> = ({\n  customer,\n  regions,\n}) => {\n  const regionOptions = useMemo(() => {\n    return (\n      regions\n        ?.map((region) => {\n          return region.countries?.map((country) => ({\n            value: country.iso_2,\n            label: country.display_name,\n          }))\n        })\n        .flat() || []\n    )\n  }, [regions])\n\n  const [successState, setSuccessState] = React.useState(false)\n\n  const billingAddress = customer.addresses?.find(\n    (addr) => addr.is_default_billing\n  )\n\n  const initialState: Record<string, any> = {\n    isDefaultBilling: true,\n    isDefaultShipping: false,\n    error: false,\n    success: false,\n  }\n\n  if (billingAddress) {\n    initialState.addressId = billingAddress.id\n  }\n\n  const [state, formAction] = useActionState(\n    billingAddress ? updateCustomerAddress : addCustomerAddress,\n    initialState\n  )\n\n  const clearState = () => {\n    setSuccessState(false)\n  }\n\n  useEffect(() => {\n    setSuccessState(state.success)\n  }, [state])\n\n  const currentInfo = useMemo(() => {\n    if (!billingAddress) {\n      return \"No billing address\"\n    }\n\n    const country =\n      regionOptions?.find(\n        (country) => country?.value === billingAddress.country_code\n      )?.label || billingAddress.country_code?.toUpperCase()\n\n    return (\n      <div className=\"flex flex-col font-semibold\" data-testid=\"current-info\">\n        <span>\n          {billingAddress.first_name} {billingAddress.last_name}\n        </span>\n        <span>{billingAddress.company}</span>\n        <span>\n          {billingAddress.address_1}\n          {billingAddress.address_2 ? `, ${billingAddress.address_2}` : \"\"}\n        </span>\n        <span>\n          {billingAddress.postal_code}, {billingAddress.city}\n        </span>\n        <span>{country}</span>\n      </div>\n    )\n  }, [billingAddress, regionOptions])\n\n  return (\n    <form action={formAction} onReset={() => clearState()} className=\"w-full\">\n      <input type=\"hidden\" name=\"addressId\" value={billingAddress?.id} />\n      <AccountInfo\n        label=\"Billing address\"\n        currentInfo={currentInfo}\n        isSuccess={successState}\n        isError={!!state.error}\n        clearState={clearState}\n        data-testid=\"account-billing-address-editor\"\n      >\n        <div className=\"grid grid-cols-1 gap-y-2\">\n          <div className=\"grid grid-cols-2 gap-x-2\">\n            <Input\n              label=\"First name\"\n              name=\"first_name\"\n              defaultValue={billingAddress?.first_name || undefined}\n              required\n              data-testid=\"billing-first-name-input\"\n            />\n            <Input\n              label=\"Last name\"\n              name=\"last_name\"\n              defaultValue={billingAddress?.last_name || undefined}\n              required\n              data-testid=\"billing-last-name-input\"\n            />\n          </div>\n          <Input\n            label=\"Company\"\n            name=\"company\"\n            defaultValue={billingAddress?.company || undefined}\n            data-testid=\"billing-company-input\"\n          />\n          <Input\n            label=\"Address\"\n            name=\"address_1\"\n            defaultValue={billingAddress?.address_1 || undefined}\n            required\n            data-testid=\"billing-address-1-input\"\n          />\n          <Input\n            label=\"Apartment, suite, etc.\"\n            name=\"address_2\"\n            defaultValue={billingAddress?.address_2 || undefined}\n            data-testid=\"billing-address-2-input\"\n          />\n          <div className=\"grid grid-cols-[144px_1fr] gap-x-2\">\n            <Input\n              label=\"Postal code\"\n              name=\"postal_code\"\n              defaultValue={billingAddress?.postal_code || undefined}\n              required\n              data-testid=\"billing-postcal-code-input\"\n            />\n            <Input\n              label=\"City\"\n              name=\"city\"\n              defaultValue={billingAddress?.city || undefined}\n              required\n              data-testid=\"billing-city-input\"\n            />\n          </div>\n          <Input\n            label=\"Province\"\n            name=\"province\"\n            defaultValue={billingAddress?.province || undefined}\n            data-testid=\"billing-province-input\"\n          />\n          <NativeSelect\n            name=\"country_code\"\n            defaultValue={billingAddress?.country_code || undefined}\n            required\n            data-testid=\"billing-country-code-select\"\n          >\n            <option value=\"\">-</option>\n            {regionOptions.map((option, i) => {\n              return (\n                <option key={i} value={option?.value}>\n                  {option?.label}\n                </option>\n              )\n            })}\n          </NativeSelect>\n        </div>\n      </AccountInfo>\n    </form>\n  )\n}\n\nexport default ProfileBillingAddress\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/account/components/profile-email/index.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_currentState' is defined but never used.","line":20,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_formData' is defined but never used.","line":21,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":21,"endColumn":14}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport React, { useEffect, useActionState } from \"react\";\n\nimport Input from \"@modules/common/components/input\"\n\nimport AccountInfo from \"../account-info\"\nimport { HttpTypes } from \"@medusajs/types\"\n// import { updateCustomer } from \"@lib/data/customer\"\n\ntype MyInformationProps = {\n  customer: HttpTypes.StoreCustomer\n}\n\nconst ProfileEmail: React.FC<MyInformationProps> = ({ customer }) => {\n  const [successState, setSuccessState] = React.useState(false)\n\n  // Email 更新功能暫時禁用（基於安全考量）\n  const updateCustomerEmail = (\n    _currentState: { success: boolean; error: string },\n    _formData: FormData\n  ) => {\n    // Email 更新功能暫時不可用\n    return { success: false, error: \"Email 更新功能暫時不可用\" }\n  }\n\n  const [state, formAction] = useActionState(updateCustomerEmail, {\n    error: \"\",\n    success: false,\n  })\n\n  const clearState = () => {\n    setSuccessState(false)\n  }\n\n  useEffect(() => {\n    setSuccessState(state.success)\n  }, [state])\n\n  return (\n    <form action={formAction} className=\"w-full\">\n      <AccountInfo\n        label=\"電子郵件\"\n        currentInfo={customer.email}\n        isSuccess={successState}\n        isError={!!state.error}\n        errorMessage={state.error}\n        clearState={clearState}\n        data-testid=\"account-email-editor\"\n      >\n        <div className=\"grid grid-cols-1 gap-y-2\">\n          <Input\n            label=\"電子郵件\"\n            name=\"email\"\n            type=\"email\"\n            autoComplete=\"email\"\n            required\n            defaultValue={customer.email}\n            data-testid=\"email-input\"\n          />\n        </div>\n      </AccountInfo>\n    </form>\n  )\n}\n\nexport default ProfileEmail\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/account/components/profile-name/index.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":30,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[832,835],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[832,835],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport React, { useEffect, useActionState } from \"react\";\n\nimport Input from \"@modules/common/components/input\"\n\nimport AccountInfo from \"../account-info\"\nimport { HttpTypes } from \"@medusajs/types\"\nimport { updateCustomer } from \"@lib/data/customer\"\n\ntype MyInformationProps = {\n  customer: HttpTypes.StoreCustomer\n}\n\nconst ProfileName: React.FC<MyInformationProps> = ({ customer }) => {\n  const [successState, setSuccessState] = React.useState(false)\n\n  const updateCustomerName = async (\n    _currentState: Record<string, unknown>,\n    formData: FormData\n  ) => {\n    const customer = {\n      first_name: formData.get(\"first_name\") as string,\n      last_name: formData.get(\"last_name\") as string,\n    }\n\n    try {\n      await updateCustomer(customer)\n      return { success: true, error: null }\n    } catch (error: any) {\n      return { success: false, error: error.toString() }\n    }\n  }\n\n  const [state, formAction] = useActionState(updateCustomerName, {\n    error: false,\n    success: false,\n  })\n\n  const clearState = () => {\n    setSuccessState(false)\n  }\n\n  useEffect(() => {\n    setSuccessState(state.success)\n  }, [state])\n\n  return (\n    <form action={formAction} className=\"w-full overflow-visible\">\n      <AccountInfo\n        label=\"姓名\"\n        currentInfo={`${customer.first_name} ${customer.last_name}`}\n        isSuccess={successState}\n        isError={!!state?.error}\n        clearState={clearState}\n        data-testid=\"account-name-editor\"\n      >\n        <div className=\"grid grid-cols-2 gap-x-4\">\n          <Input\n            label=\"名\"\n            name=\"first_name\"\n            required\n            defaultValue={customer.first_name ?? \"\"}\n            data-testid=\"first-name-input\"\n          />\n          <Input\n            label=\"姓\"\n            name=\"last_name\"\n            required\n            defaultValue={customer.last_name ?? \"\"}\n            data-testid=\"last-name-input\"\n          />\n        </div>\n      </AccountInfo>\n    </form>\n  )\n}\n\nexport default ProfileName\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/account/components/profile-password/index.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'useEffect' is defined but never used.","line":3,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":26},{"ruleId":"unused-imports/no-unused-imports","severity":2,"message":"'useEffect' is defined but never used.","line":3,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":26,"fix":{"range":[29,40],"text":""}},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'useActionState' is defined but never used.","line":3,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":42},{"ruleId":"unused-imports/no-unused-imports","severity":2,"message":"'useActionState' is defined but never used.","line":3,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":42,"fix":{"range":[39,55],"text":""}},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'customer' is defined but never used.","line":13,"column":58,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":66},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'customer' is defined but never used. Allowed unused args must match /^_/u.","line":13,"column":58,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":66}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":2,"fixableWarningCount":0,"source":"\"use client\"\n\nimport React, { useEffect, useActionState } from \"react\"\nimport Input from \"@modules/common/components/input\"\nimport AccountInfo from \"../account-info\"\nimport { HttpTypes } from \"@medusajs/types\"\nimport { toast } from \"@medusajs/ui\"\n\ntype MyInformationProps = {\n  customer: HttpTypes.StoreCustomer\n}\n\nconst ProfilePassword: React.FC<MyInformationProps> = ({ customer }) => {\n  const [successState, setSuccessState] = React.useState(false)\n\n  // TODO: Add support for password updates\n  const updatePassword = async () => {\n    toast.info(\"Password update is not implemented\")\n  }\n\n  const clearState = () => {\n    setSuccessState(false)\n  }\n\n  return (\n    <form\n      action={updatePassword}\n      onReset={() => clearState()}\n      className=\"w-full\"\n    >\n      <AccountInfo\n        label=\"Password\"\n        currentInfo={\n          <span>The password is not shown for security reasons</span>\n        }\n        isSuccess={successState}\n        isError={false}\n        errorMessage={undefined}\n        clearState={clearState}\n        data-testid=\"account-password-editor\"\n      >\n        <div className=\"grid grid-cols-2 gap-4\">\n          <Input\n            label=\"Old password\"\n            name=\"old_password\"\n            required\n            type=\"password\"\n            data-testid=\"old-password-input\"\n          />\n          <Input\n            label=\"New password\"\n            type=\"password\"\n            name=\"new_password\"\n            required\n            data-testid=\"new-password-input\"\n          />\n          <Input\n            label=\"Confirm password\"\n            type=\"password\"\n            name=\"confirm_password\"\n            required\n            data-testid=\"confirm-password-input\"\n          />\n        </div>\n      </AccountInfo>\n    </form>\n  )\n}\n\nexport default ProfilePassword\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/account/components/profile-phone/index.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":29,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[770,773],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[770,773],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport React, { useEffect, useActionState } from \"react\";\n\nimport Input from \"@modules/common/components/input\"\n\nimport AccountInfo from \"../account-info\"\nimport { HttpTypes } from \"@medusajs/types\"\nimport { updateCustomer } from \"@lib/data/customer\"\n\ntype MyInformationProps = {\n  customer: HttpTypes.StoreCustomer\n}\n\nconst ProfileEmail: React.FC<MyInformationProps> = ({ customer }) => {\n  const [successState, setSuccessState] = React.useState(false)\n\n  const updateCustomerPhone = async (\n    _currentState: Record<string, unknown>,\n    formData: FormData\n  ) => {\n    const customer = {\n      phone: formData.get(\"phone\") as string,\n    }\n\n    try {\n      await updateCustomer(customer)\n      return { success: true, error: null }\n    } catch (error: any) {\n      return { success: false, error: error.toString() }\n    }\n  }\n\n  const [state, formAction] = useActionState(updateCustomerPhone, {\n    error: false,\n    success: false,\n  })\n\n  const clearState = () => {\n    setSuccessState(false)\n  }\n\n  useEffect(() => {\n    setSuccessState(state.success)\n  }, [state])\n\n  return (\n    <form action={formAction} className=\"w-full\">\n      <AccountInfo\n        label=\"電話\"\n        currentInfo={`${customer.phone}`}\n        isSuccess={successState}\n        isError={!!state.error}\n        errorMessage={state.error}\n        clearState={clearState}\n        data-testid=\"account-phone-editor\"\n      >\n        <div className=\"grid grid-cols-1 gap-y-2\">\n          <Input\n            label=\"電話\"\n            name=\"phone\"\n            type=\"phone\"\n            autoComplete=\"phone\"\n            required\n            defaultValue={customer.phone ?? \"\"}\n            data-testid=\"phone-input\"\n          />\n        </div>\n      </AccountInfo>\n    </form>\n  )\n}\n\nexport default ProfileEmail\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/account/components/register/index.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'router' is assigned a value but never used.","line":19,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":15},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'router' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":19,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":15},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":26,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":26,"endColumn":18,"suggestions":[{"fix":{"range":[934,967],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":36,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":36,"endColumn":24,"suggestions":[{"fix":{"range":[1226,1259],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { useActionState, useEffect } from \"react\"\nimport { useRouter } from \"next/navigation\"\nimport Input from \"@modules/common/components/input\"\nimport { LOGIN_VIEW } from \"@modules/account/templates/login-template\"\nimport ErrorMessage from \"@modules/checkout/components/error-message\"\nimport { SubmitButton } from \"@modules/checkout/components/submit-button\"\nimport LocalizedClientLink from \"@modules/common/components/localized-client-link\"\nimport { signup } from \"@lib/data/customer\"\nimport { useAccount } from \"@lib/context/account-context\"\n\ntype Props = {\n  setCurrentView: (view: LOGIN_VIEW) => void\n}\n\nconst Register = ({ setCurrentView }: Props) => {\n  const [result, formAction] = useActionState(signup, null)\n  const router = useRouter()\n  const { refreshCustomer } = useAccount()\n\n  // 處理註冊成功\n  useEffect(() => {\n    if (result && typeof result === 'object' && result.id) {\n      // 註冊成功，result 是客戶對象\n      console.log(\"🎉 註冊成功，刷新客戶狀態並重定向\")\n      \n      const handleSuccess = async () => {\n        try {\n          await refreshCustomer()\n          // 給 cookie 一點時間生效\n          setTimeout(() => {\n            window.location.href = '/tw/account'\n          }, 500)\n        } catch (error) {\n          console.error(\"刷新客戶狀態失敗:\", error)\n          // 即使刷新失敗，也嘗試重定向\n          setTimeout(() => {\n            window.location.href = '/tw/account'\n          }, 500)\n        }\n      }\n      \n      handleSuccess()\n    }\n  }, [result, refreshCustomer])\n\n  // 錯誤訊息：如果 result 是字符串，那就是錯誤訊息\n  const errorMessage = typeof result === 'string' ? result : null\n\n  return (\n    <div\n      className=\"max-w-sm flex flex-col items-center\"\n      data-testid=\"register-page\"\n    >\n      <h1 className=\"text-large-semi uppercase mb-6\">\n        成為會員\n      </h1>\n      <p className=\"text-center text-base-regular text-ui-fg-base mb-4\">\n        建立您的會員檔案，享受更優質的購物體驗。\n      </p>\n      <form className=\"w-full flex flex-col\" action={formAction}>\n        <div className=\"flex flex-col w-full gap-y-2\">\n          <Input\n            label=\"名\"\n            name=\"first_name\"\n            required\n            autoComplete=\"given-name\"\n            data-testid=\"first-name-input\"\n          />\n          <Input\n            label=\"姓\"\n            name=\"last_name\"\n            required\n            autoComplete=\"family-name\"\n            data-testid=\"last-name-input\"\n          />\n          <Input\n            label=\"電子郵件\"\n            name=\"email\"\n            required\n            type=\"email\"\n            autoComplete=\"email\"\n            data-testid=\"email-input\"\n          />\n          <Input\n            label=\"電話\"\n            name=\"phone\"\n            type=\"tel\"\n            autoComplete=\"tel\"\n            data-testid=\"phone-input\"\n          />\n          <Input\n            label=\"密碼\"\n            name=\"password\"\n            required\n            type=\"password\"\n            autoComplete=\"new-password\"\n            data-testid=\"password-input\"\n          />\n        </div>\n        <ErrorMessage error={errorMessage} data-testid=\"register-error\" />\n        {result && typeof result === 'object' && result.id && (\n          <div className=\"text-center text-green-600 text-small-regular mt-4\">\n            註冊成功！正在重定向...\n          </div>\n        )}\n        <span className=\"text-center text-ui-fg-base text-small-regular mt-6\">\n          建立帳戶即表示您同意我們的{\" \"}\n          <LocalizedClientLink\n            href=\"/content/privacy-policy\"\n            className=\"underline\"\n          >\n            隱私政策\n          </LocalizedClientLink>{\" \"}\n          和{\" \"}\n          <LocalizedClientLink\n            href=\"/content/terms-of-use\"\n            className=\"underline\"\n          >\n            使用條款\n          </LocalizedClientLink>\n          。\n        </span>\n        <SubmitButton className=\"w-full mt-6\" data-testid=\"register-button\">\n          加入\n        </SubmitButton>\n      </form>\n      <span className=\"text-center text-ui-fg-base text-small-regular mt-6\">\n        已經是會員？{\" \"}\n        <button\n          onClick={() => setCurrentView(LOGIN_VIEW.SIGN_IN)}\n          className=\"underline\"\n        >\n          立即登入\n        </button>\n        。\n      </span>\n    </div>\n  )\n}\n\nexport default Register\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/account/components/transfer-request-form/index.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Button' is defined but never used.","line":5,"column":32,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":38},{"ruleId":"unused-imports/no-unused-imports","severity":2,"message":"'Button' is defined but never used.","line":5,"column":32,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":38,"fix":{"range":[140,148],"text":""}},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Toaster' is defined but never used.","line":5,"column":52,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":59},{"ruleId":"unused-imports/no-unused-imports","severity":2,"message":"'Toaster' is defined but never used.","line":5,"column":52,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":59,"fix":{"range":[159,168],"text":""}}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":2,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { useActionState } from \"react\"\nimport { createTransferRequest } from \"@lib/data/orders\"\nimport { Text, Heading, Input, Button, IconButton, Toaster } from \"@medusajs/ui\"\nimport { SubmitButton } from \"@modules/checkout/components/submit-button\"\nimport { CheckCircleMiniSolid, XCircleSolid } from \"@medusajs/icons\"\nimport { useEffect, useState } from \"react\"\n\nexport default function TransferRequestForm() {\n  const [showSuccess, setShowSuccess] = useState(false)\n\n  const [state, formAction] = useActionState(createTransferRequest, {\n    success: false,\n    error: null,\n    order: null,\n  })\n\n  useEffect(() => {\n    if (state.success && state.order) {\n      setShowSuccess(true)\n    }\n  }, [state.success, state.order])\n\n  return (\n    <div className=\"flex flex-col gap-y-4 w-full\">\n      <div className=\"grid sm:grid-cols-2 items-center gap-x-8 gap-y-4 w-full\">\n        <div className=\"flex flex-col gap-y-1\">\n          <Heading level=\"h3\" className=\"text-lg text-neutral-950\">\n            Order transfers\n          </Heading>\n          <Text className=\"text-base-regular text-neutral-500\">\n            Can&apos;t find the order you are looking for?\n            <br /> Connect an order to your account.\n          </Text>\n        </div>\n        <form\n          action={formAction}\n          className=\"flex flex-col gap-y-1 sm:items-end\"\n        >\n          <div className=\"flex flex-col gap-y-2 w-full\">\n            <Input className=\"w-full\" name=\"order_id\" placeholder=\"Order ID\" />\n            <SubmitButton\n              variant=\"secondary\"\n              className=\"w-fit whitespace-nowrap self-end\"\n            >\n              Request transfer\n            </SubmitButton>\n          </div>\n        </form>\n      </div>\n      {!state.success && state.error && (\n        <Text className=\"text-base-regular text-rose-500 text-right\">\n          {state.error}\n        </Text>\n      )}\n      {showSuccess && (\n        <div className=\"flex justify-between p-4 bg-neutral-50 shadow-borders-base w-full self-stretch items-center\">\n          <div className=\"flex gap-x-2 items-center\">\n            <CheckCircleMiniSolid className=\"w-4 h-4 text-emerald-500\" />\n            <div className=\"flex flex-col gap-y-1\">\n              <Text className=\"text-medim-pl text-neutral-950\">\n                Transfer for order {state.order?.id} requested\n              </Text>\n              <Text className=\"text-base-regular text-neutral-600\">\n                Transfer request email sent to {state.order?.email}\n              </Text>\n            </div>\n          </div>\n          <IconButton\n            variant=\"transparent\"\n            className=\"h-fit\"\n            onClick={() => setShowSuccess(false)}\n          >\n            <XCircleSolid className=\"w-4 h-4 text-neutral-500\" />\n          </IconButton>\n        </div>\n      )}\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/account/templates/account-layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/account/templates/login-template.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'countryCode' is assigned a value but never used.","line":17,"column":26,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":37},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'countryCode' is assigned a value but never used. Allowed unused args must match /^_/u.","line":17,"column":26,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":37}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { useState } from \"react\"\nimport Register from \"@modules/account/components/register\"\nimport Login from \"@modules/account/components/login\"\nimport GoogleLoginButton from \"@modules/account/components/google-login-button\"\n\nexport enum LOGIN_VIEW {\n  SIGN_IN = \"sign-in\",\n  REGISTER = \"register\",\n}\n\ninterface LoginTemplateProps {\n  countryCode?: string\n}\n\nconst LoginTemplate = ({ countryCode = 'tw' }: LoginTemplateProps) => {\n  const [currentView, setCurrentView] = useState(\"sign-in\")\n\n  return (\n    <div className=\"w-full flex justify-center px-8 py-8\">\n      <div className=\"w-full max-w-md mx-4\">\n        <div className=\"max-w-sm w-full flex flex-col items-center mx-4\">\n          {/* 標題區域 */}\n          <h1 className=\"text-large-semi uppercase mb-6\">\n            {currentView === \"sign-in\" ? \"歡迎回來\" : \"成為會員\"}\n          </h1>\n          <p className=\"text-center text-base-regular text-ui-fg-base mb-8\">\n            {currentView === \"sign-in\" \n              ? \"登入以享受更好的購物體驗。\" \n              : \"建立您的會員資料，享受更好的購物體驗。\"\n            }\n          </p>\n          \n          {/* 登入/註冊表單 */}\n          {currentView === \"sign-in\" ? (\n            <>\n              <div className=\"w-full flex flex-col items-center mb-6\">\n                <GoogleLoginButton />\n                <div className=\"text-gray-500 my-4\">- 或使用電子郵件登入 -</div>\n              </div>\n              <Login setCurrentView={setCurrentView} />\n            </>\n          ) : (\n            <Register setCurrentView={setCurrentView} />\n          )}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nexport default LoginTemplate\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/affiliate-admin/components/affiliate-admin-logout-button.tsx","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":14,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":14,"endColumn":20,"suggestions":[{"fix":{"range":[413,442],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { useParams } from 'next/navigation'\n\nexport default function AffiliateAdminLogoutButton() {\n  const params = useParams<{ countryCode: string }>()\n  const countryCode = params?.countryCode || 'tw'\n\n  const handleLogout = async () => {\n    try {\n      // 直接導向 API 路由，讓伺服器處理登出邏輯\n      window.location.href = `/api/affiliate-admin/signout?countryCode=${countryCode}`\n    } catch (error) {\n      console.error('登出失敗:', error)\n    }\n  }\n\n  return (\n    <button\n      onClick={handleLogout}\n      className=\"hover:underline text-sm text-gray-500 p-0 m-0 bg-transparent border-none\"\n    >\n      登出\n    </button>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/affiliate/components/affiliate-logout-button.tsx","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":14,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":14,"endColumn":20,"suggestions":[{"fix":{"range":[402,431],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { useParams } from 'next/navigation'\n\nexport default function AffiliateLogoutButton() {\n  const params = useParams<{ countryCode: string }>()\n  const countryCode = params?.countryCode || 'tw'\n\n  const handleLogout = async () => {\n    try {\n      // 直接導向 API 路由，讓伺服器處理登出邏輯\n      window.location.href = `/api/affiliate/signout?countryCode=${countryCode}`\n    } catch (error) {\n      console.error('登出失敗:', error)\n    }\n  }\n\n  return (\n    <button\n      onClick={handleLogout}\n      className=\"hover:underline text-sm text-gray-500 p-0 m-0 bg-transparent border-none\"\n    >\n      登出\n    </button>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/blog/components/blog-card.tsx","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":34,"column":36,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":34,"endColumn":38,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[883,885],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":37,"column":34,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":37,"endColumn":36,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1059,1061],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import Link from \"next/link\"\nimport Image from \"next/image\"\n\nexport type BlogPost = {\n  _id: string\n  title: string\n  slug?: { current?: string }\n  mainImage?: { asset?: { url?: string } }\n  publishedAt?: string\n  _createdAt?: string\n  excerpt?: string\n  categories?: { title?: string }[]\n  status?: string\n  body?: unknown\n}\n\nexport default function BlogCard({ post, countryCode = \"tw\" }: { post: BlogPost; countryCode?: string }) {\n  // 創建一個安全的slug\n  const createSlug = (title: string, id: string) => {\n    if (!title || !id) return 'no-slug'\n    \n    // 將中文標題轉換為拼音或使用ID\n    const safeTitle = title\n      .toLowerCase()\n      .replace(/[^\\w\\s]/gi, '')\n      .replace(/\\s+/g, '-')\n      .slice(0, 30)\n    \n    const shortId = id.replace(/-/g, '').slice(0, 8)\n    return safeTitle || `post-${shortId}`\n  }\n  \n  // 使用slug.current，如果沒有則根據標題和ID創建slug\n  const slug = post?.slug?.current || createSlug(post?.title || '', post?._id || '')\n  const href = `/${countryCode}/blog/${slug}`\n  const imageUrl = post?.mainImage?.asset?.url\n  const date = post?.publishedAt || post?._createdAt\n\n  return (\n    <li className=\"group bg-white overflow-hidden transition-all duration-700 hover:-translate-y-2 hover:shadow-xl\">\n      <Link href={href} className=\"block transition-colors\">\n        <div className=\"flex flex-col h-full\">\n          {imageUrl && (\n            <div className=\"relative w-full aspect-[16/9] overflow-hidden bg-gray-100\">\n              <Image\n                src={imageUrl}\n                alt={post.title || \"文章封面\"}\n                fill\n                className=\"object-cover group-hover:scale-105 transition-all duration-1000\"\n                sizes=\"(min-width: 1024px) 33vw, (min-width: 768px) 50vw, 100vw\"\n              />\n              {/* 簡約漸層覆蓋層 */}\n              <div className=\"absolute inset-0 bg-gradient-to-t from-stone-900/20 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-all duration-500\" />\n            </div>\n          )}\n\n          <div className=\"p-4 flex-1\">\n            <h3 className=\"text-base font-semibold text-gray-900 line-clamp-2 group-hover:text-stone-800 transition-colors duration-300\">{post.title}</h3>\n\n            {post?.categories?.length ? (\n              <div className=\"mt-1 text-xs text-gray-500\">\n                {post.categories.map((c) => c.title).filter(Boolean).join(\" · \")}\n              </div>\n            ) : null}\n\n            {date && (\n              <time className=\"mt-1 text-xs text-gray-400\" dateTime={date}>\n                {new Date(date).toLocaleDateString()}\n              </time>\n            )}\n          </div>\n        </div>\n      </Link>\n    </li>\n  )}\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/blog/components/blog-list.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'categories' is defined but never used.","line":20,"column":50,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":60},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'categories' is defined but never used. Allowed unused args must match /^_/u.","line":20,"column":50,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":60}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect } from \"react\"\nimport clsx from \"clsx\"\nimport BlogCard, { BlogPost } from \"./blog-card\"\n\ninterface Category {\n  _id: string\n  title: string\n}\n\ninterface BlogListProps {\n  initialPosts: BlogPost[]\n  categories: Category[]\n  countryCode?: string\n}\n\nconst POSTS_PER_PAGE = 9\n\nexport default function BlogList({ initialPosts, categories, countryCode = \"tw\" }: BlogListProps) {\n  const [posts, setPosts] = useState<BlogPost[]>([])\n  const [currentPage, setCurrentPage] = useState(1)\n  \n  useEffect(() => {\n    if (Array.isArray(initialPosts)) {\n      setPosts(initialPosts)\n      setCurrentPage(1)\n    }\n  }, [initialPosts])\n\n  const totalPages = Math.ceil(posts.length / POSTS_PER_PAGE)\n  const currentPosts = posts.slice(\n    (currentPage - 1) * POSTS_PER_PAGE,\n    currentPage * POSTS_PER_PAGE\n  )\n\n  if (!Array.isArray(posts) || posts.length === 0) {\n    return null\n  }\n\n  return (\n    <div className=\"bg-white\">\n      {/* 文章列表 */}\n      <ul className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-0\">\n        {currentPosts.map((post) => (\n          <BlogCard key={post._id} post={post} countryCode={countryCode} />\n        ))}\n      </ul>\n\n      {/* 分頁導航 */}\n      {totalPages > 1 && (\n        <div className=\"mt-8 flex justify-center\">\n          <nav className=\"flex items-center gap-2\" aria-label=\"文章分頁\">\n            <button\n              onClick={() => setCurrentPage(p => Math.max(1, p - 1))}\n              disabled={currentPage === 1}\n              className={clsx(\n                \"px-3 py-1 text-body-small font-medium\",\n                currentPage === 1\n                  ? \"text-gray-400 cursor-not-allowed\"\n                  : \"text-gray-700 hover:bg-gray-100\"\n              )}\n            >\n              上一頁\n            </button>\n\n            {Array.from({ length: totalPages }, (_, i) => i + 1).map((pageNum) => (\n              <button\n                key={pageNum}\n                onClick={() => setCurrentPage(pageNum)}\n                className={clsx(\n                  \"px-3 py-1 text-body-small font-medium\",\n                  pageNum === currentPage\n                    ? \"bg-primary-600 text-white\"\n                    : \"text-gray-700 hover:bg-gray-100\"\n                )}\n              >\n                {pageNum}\n              </button>\n            ))}\n\n            <button\n              onClick={() => setCurrentPage(p => Math.min(totalPages, p + 1))}\n              disabled={currentPage === totalPages}\n              className={clsx(\n                \"px-3 py-1 text-body-small font-medium\",\n                currentPage === totalPages\n                  ? \"text-gray-400 cursor-not-allowed\"\n                  : \"text-gray-700 hover:bg-gray-100\"\n              )}\n            >\n              下一頁\n            </button>\n          </nav>\n        </div>\n      )}\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/blog/components/blog-posts-client.tsx","messages":[{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":22,"column":7,"nodeType":null,"messageId":"preferOptionalChain","endLine":23,"endColumn":17,"suggestions":[{"fix":{"range":[448,473],"text":"post?.title"},"messageId":"optionalChainSuggest","desc":"Change to an optional chain."}]},{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":43,"column":9,"nodeType":null,"messageId":"preferOptionalChain","endLine":43,"endColumn":47,"fix":{"range":[970,1008],"text":"validPosts?.length === 0"}},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":96,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":96,"endColumn":18,"suggestions":[{"fix":{"range":[2694,2731],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import BlogCard from \"./blog-card\"\nimport type { BlogPost } from \"./blog-card\"\n\ninterface BlogPostsClientProps {\n  posts: BlogPost[]\n  title?: string \n  postsPerRow?: number\n  showTitle?: boolean\n  limit?: number\n}\n\nexport default function BlogPostsClient({ \n  posts,\n  title,\n  postsPerRow = 3,\n  showTitle = true,\n  limit = 2\n}: BlogPostsClientProps) {\n  try {\n    // 檢查並過濾無效的文章 - 移除對主圖片的強制要求\n    const validPosts = posts?.filter(post => (\n      post && \n      post.title && \n      post.slug?.current\n    ))\n\n    // 根據 postsPerRow 設置網格樣式\n    const getGridCols = (cols: number) => {\n      switch (cols) {\n        case 1:\n          return \"grid-cols-1\"\n        case 2:\n          return \"grid-cols-2 md:grid-cols-2\"\n        case 3:\n          return \"grid-cols-2 md:grid-cols-2 lg:grid-cols-3\"\n        case 4:\n          return \"grid-cols-2 md:grid-cols-2 lg:grid-cols-4\"\n        default:\n          return \"grid-cols-2 md:grid-cols-2 lg:grid-cols-3\"\n      }\n    }\n\n    if (!validPosts || validPosts.length === 0) {\n      return (\n        <div className={(showTitle && title) ? \"py-8 md:py-12 bg-gray-50\" : \"py-0 bg-gray-50\"}>\n          <div className=\"container mx-auto px-4\">\n            <div className=\"text-center text-gray-500\">\n              目前還沒有已發布的文章\n            </div>\n          </div>\n        </div>\n      )\n    }\n\n    return (\n      <div className={(showTitle && title) ? \"py-8 md:py-12 bg-gray-50\" : \"py-0 bg-gray-50\"}>\n        <div className=\"content-container\">\n          {/* 標題區塊 - 作為整體處理，只有在 showTitle 為 true 且有標題時才顯示 */}\n          {showTitle && title && (\n            <div className=\"section-header-container\">\n              <h2 className=\"h1\">{title}</h2>\n              {/* 調試信息作為標題的一部分 */}\n              <div className=\"text-sm text-gray-500 mt-2\">\n                {`找到 ${posts?.length || 0} 篇文章，其中 ${validPosts?.length || 0} 篇可顯示`}\n              </div>\n            </div>\n          )}\n          {validPosts && validPosts.length > 0 ? (\n            <ul className={`grid ${getGridCols(postsPerRow)} gap-0`}>\n              {validPosts.map((post) => (\n                <BlogCard \n                  key={post._id || post.title} \n                  post={post} \n                />\n              ))}\n            </ul>\n          ) : (\n            <div className=\"text-center text-gray-500\">\n              目前還沒有已發布的文章\n            </div>\n          )}\n          {validPosts?.length >= limit && (\n            <div className=\"flex justify-center mt-12\">\n              <a \n                href=\"/blog\" \n                className=\"btn-secondary\"\n              >\n                查看更多文章\n              </a>\n            </div>\n          )}\n        </div>\n      </div>\n    )\n  } catch (error) {\n    console.error('顯示部落格文章時發生錯誤:', error)\n    return (\n      <div className={(showTitle && title) ? \"py-8 md:py-12 bg-gray-50\" : \"py-0 bg-gray-50\"}>\n        <div className=\"container mx-auto px-4\">\n          <div className=\"text-center text-gray-500\">\n            載入文章時發生錯誤，請稍後再試\n          </div>\n        </div>\n      </div>\n    )\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/blog/components/blog-posts.tsx","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":37,"column":49,"nodeType":"MemberExpression","messageId":"unexpected","endLine":37,"endColumn":60},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":40,"column":49,"nodeType":"MemberExpression","messageId":"unexpected","endLine":40,"endColumn":62},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":60,"column":49,"nodeType":"MemberExpression","messageId":"unexpected","endLine":60,"endColumn":60},{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":64,"column":23,"nodeType":null,"messageId":"preferOptionalChain","endLine":64,"endColumn":41,"suggestions":[{"fix":{"range":[1659,1677],"text":"post?.title"},"messageId":"optionalChainSuggest","desc":"Change to an optional chain."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":65,"column":51,"nodeType":"MemberExpression","messageId":"unexpected","endLine":65,"endColumn":62},{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":90,"column":9,"nodeType":null,"messageId":"preferOptionalChain","endLine":90,"endColumn":47,"fix":{"range":[2392,2430],"text":"validPosts?.length === 0"}},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":143,"column":49,"nodeType":"MemberExpression","messageId":"unexpected","endLine":143,"endColumn":62}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import BlogCard from \"./blog-card\"\nimport type { BlogPost } from \"./blog-card\"\nimport client from \"../../../lib/sanity\"\n\nasync function getBlogPosts(category?: string, limit: number = 6) {\n  try {\n    // 1. 建立基本查詢條件\n    const baseQuery = `_type == \"post\"`\n    \n    // 2. 建立分類過濾條件\n    const categoryFilter = category ? `&& $category in categories[]->title` : ''\n    \n    // 3. 組合完整查詢 - 使用 _createdAt 而不是 publishedAt\n    const query = `*[${baseQuery} ${categoryFilter}] | order(_createdAt desc) [0...${limit}] {\n      title,\n      slug,\n      mainImage {\n        asset->{\n          url\n        }\n      },\n      publishedAt,\n      _createdAt,\n      categories[]->{\n        title\n      },\n      _id,\n      status,\n      body // 添加文章內文\n    }`\n\n    // 4. 設置查詢參數\n    const params = category ? { category } : {}\n\n    // 5. 執行查詢並傳入參數\n    const posts = await client.fetch<BlogPost[]>(query, params)\n    if (process.env.NODE_ENV === 'development') console.log('BlogPosts - 查詢到的文章數量:', posts?.length)\n    return posts\n  } catch (error) {\n    if (process.env.NODE_ENV === 'development') console.error('取得部落格文章時發生錯誤:', error)\n    return []\n  }\n}\n\nexport default async function BlogPosts({ \n  category,\n  limit = 2,\n  title,\n  postsPerRow = 3,\n  showTitle = true\n}: { \n  category?: string\n  limit?: number\n  title?: string \n  postsPerRow?: number\n  showTitle?: boolean\n}) {\n  try {\n    const posts = await getBlogPosts(category, limit)\n    if (process.env.NODE_ENV === 'development') console.log('BlogPosts - 原始文章數據:', JSON.stringify(posts, null, 2))\n\n    // 檢查並過濾無效的文章 - 移除對 slug 的強制要求，因為有些文章可能沒有設置 slug\n    const validPosts = posts?.filter(post => {\n      const isValid = post && post.title\n      if (process.env.NODE_ENV === 'development') console.log(`BlogPosts - 文章 \"${post?.title}\" 驗證:`, {\n        hasPost: !!post,\n        hasTitle: !!post?.title,\n        hasSlug: !!post?.slug?.current,\n        isValid\n      })\n      return isValid\n    })\n\n    // 根據 postsPerRow 設置網格樣式\n    const getGridCols = (cols: number) => {\n      switch (cols) {\n        case 1:\n          return \"grid-cols-1\"\n        case 2:\n          return \"grid-cols-2 md:grid-cols-2\"\n        case 3:\n          return \"grid-cols-2 md:grid-cols-2 lg:grid-cols-3\"\n        case 4:\n          return \"grid-cols-2 md:grid-cols-2 lg:grid-cols-4\"\n        default:\n          return \"grid-cols-2 md:grid-cols-2 lg:grid-cols-3\"\n      }\n    }\n\n    if (!validPosts || validPosts.length === 0) {\n      return (\n        <div className={(showTitle && title) ? \"py-8 md:py-12 bg-gray-50\" : \"py-0 bg-gray-50\"}>\n          <div className=\"container mx-auto px-4\">\n            <div className=\"text-center text-gray-500\">\n              目前還沒有已發布的文章\n            </div>\n          </div>\n        </div>\n      )\n    }\n\n    return (\n      <div className={(showTitle && title) ? \"py-8 md:py-12 bg-gray-50\" : \"py-0 bg-gray-50\"}>\n        <div className=\"content-container\">\n          {/* 標題區塊 - 作為整體處理，只有在 showTitle 為 true 且有標題時才顯示 */}\n          {showTitle && title && (\n            <div className=\"section-header-container\">\n              <h2 className=\"h1\">{title}</h2>\n              {/* 調試信息作為標題的一部分 */}\n              <div className=\"text-sm text-gray-500 mt-2\">\n                {`找到 ${posts?.length || 0} 篇文章，其中 ${validPosts?.length || 0} 篇可顯示`}\n              </div>\n            </div>\n          )}\n          {validPosts && validPosts.length > 0 ? (\n            <ul className={`grid ${getGridCols(postsPerRow)} gap-0`}>\n              {validPosts.map((post) => (\n                <BlogCard \n                  key={post._id || post.title} \n                  post={post} \n                />\n              ))}\n            </ul>\n          ) : (\n            <div className=\"text-center text-gray-500\">\n              目前還沒有已發布的文章\n            </div>\n          )}\n          {validPosts?.length >= limit && (\n            <div className=\"flex justify-center mt-12\">\n              <a \n                href=\"/blog\" \n                className=\"btn-secondary\"\n              >\n                查看更多文章\n              </a>\n            </div>\n          )}\n        </div>\n      </div>\n    )\n  } catch (error) {\n    if (process.env.NODE_ENV === 'development') console.error('顯示部落格文章時發生錯誤:', error)\n    return (\n      <div className={(showTitle && title) ? \"py-8 md:py-12 bg-gray-50\" : \"py-0 bg-gray-50\"}>\n        <div className=\"container mx-auto px-4\">\n          <div className=\"text-center text-gray-500\">\n            載入文章時發生錯誤，請稍後再試\n          </div>\n        </div>\n      </div>\n    )\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/blog/components/category-filter.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/blog/components/sanity-content.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":29,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[900,903],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[900,903],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":63,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1983,1986],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1983,1986],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { PortableText } from '@portabletext/react'\nimport type { PortableTextBlock } from '@portabletext/types'\n\ninterface SanityContentProps {\n  content: PortableTextBlock[]\n}\n\nconst components = {\n  block: {\n    h1: ({children}: {children: React.ReactNode}) => (\n      <h1 className=\"h1 mt-8 mb-4\">{children}</h1>\n    ),\n    h2: ({children}: {children: React.ReactNode}) => (\n      <h2 className=\"h2 mt-6 mb-3\">{children}</h2>\n    ),\n    h3: ({children}: {children: React.ReactNode}) => (\n      <h3 className=\"h3 mt-4 mb-2\">{children}</h3>\n    ),\n    normal: ({children}: {children: React.ReactNode}) => (\n      <p className=\"text-content mb-4\">{children}</p>\n    ),\n    blockquote: ({children}: {children: React.ReactNode}) => (\n      <blockquote className=\"text-content border-l-4 border-gray-300 pl-4 italic my-4\">\n        {children}\n      </blockquote>\n    ),\n  },\n  marks: {\n    link: (props: any) => {\n      const { children, value } = props\n      const rel = !value?.href?.startsWith('/') ? 'noreferrer noopener' : undefined\n      return (\n        <a \n          href={value?.href}\n          rel={rel}\n          className=\"text-content text-blue-600 hover:underline\"\n        >\n          {children}\n        </a>\n      )\n    },\n    strong: ({children}: {children: React.ReactNode}) => (\n      <strong className=\"text-content font-semibold\">{children}</strong>\n    ),\n    em: ({children}: {children: React.ReactNode}) => (\n      <em className=\"text-content italic\">{children}</em>\n    ),\n  },\n  list: {\n    bullet: ({children}: {children: React.ReactNode}) => (\n      <ul className=\"text-content list-disc list-inside mb-4 space-y-2\">{children}</ul>\n    ),\n    number: ({children}: {children: React.ReactNode}) => (\n      <ol className=\"text-content list-decimal list-inside mb-4 space-y-2\">{children}</ol>\n    ),\n  },\n}\n\nexport default function SanityContent({ content }: SanityContentProps) {\n  return (\n    <PortableText\n      value={content}\n      components={components as any}\n    />\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/cart/components/cart-item-select/index.tsx","messages":[{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":32,"column":11,"nodeType":null,"messageId":"preferOptionalChain","endLine":32,"endColumn":60,"fix":{"range":[843,892],"text":"innerRef.current?.value === \"\""}}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":1,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { IconBadge, clx } from \"@medusajs/ui\"\nimport {\n  SelectHTMLAttributes,\n  forwardRef,\n  useEffect,\n  useImperativeHandle,\n  useRef,\n  useState,\n} from \"react\"\n\nimport ChevronDown from \"@modules/common/icons/chevron-down\"\n\ntype NativeSelectProps = {\n  placeholder?: string\n  errors?: Record<string, unknown>\n  touched?: Record<string, unknown>\n} & Omit<SelectHTMLAttributes<HTMLSelectElement>, \"size\">\n\nconst CartItemSelect = forwardRef<HTMLSelectElement, NativeSelectProps>(\n  ({ placeholder = \"Select...\", className, children, ...props }, ref) => {\n    const innerRef = useRef<HTMLSelectElement>(null)\n    const [isPlaceholder, setIsPlaceholder] = useState(false)\n\n    useImperativeHandle<HTMLSelectElement | null, HTMLSelectElement | null>(\n      ref,\n      () => innerRef.current\n    )\n\n    useEffect(() => {\n      if (innerRef.current && innerRef.current.value === \"\") {\n        setIsPlaceholder(true)\n      } else {\n        setIsPlaceholder(false)\n      }\n    }, [innerRef.current?.value])\n\n    return (\n      <div>\n        <IconBadge\n          onFocus={() => innerRef.current?.focus()}\n          onBlur={() => innerRef.current?.blur()}\n          className={clx(\n            \"relative flex items-center txt-compact-small border text-ui-fg-base group\",\n            className,\n            {\n              \"text-ui-fg-subtle\": isPlaceholder,\n            }\n          )}\n        >\n          <select\n            ref={innerRef}\n            {...props}\n            className=\"appearance-none bg-transparent border-none px-4 transition-colors duration-150 focus:border-gray-700 outline-none w-16 h-16 items-center justify-center\"\n          >\n            <option disabled value=\"\">\n              {placeholder}\n            </option>\n            {children}\n          </select>\n          <span className=\"absolute flex pointer-events-none justify-end w-8 group-hover:animate-pulse\">\n            <ChevronDown />\n          </span>\n        </IconBadge>\n      </div>\n    )\n  }\n)\n\nCartItemSelect.displayName = \"CartItemSelect\"\n\nexport default CartItemSelect\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/cart/components/empty-cart-message/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/cart/components/item/index.tsx","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":58,"column":39,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":58,"endColumn":41,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1980,1982],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { Table, Text, clx } from \"@medusajs/ui\"\nimport { updateLineItem } from \"@lib/data/cart\"\nimport { HttpTypes } from \"@medusajs/types\"\nimport CartItemSelect from \"@modules/cart/components/cart-item-select\"\nimport ErrorMessage from \"@modules/checkout/components/error-message\"\nimport DeleteButton from \"@modules/common/components/delete-button\"\nimport LineItemOptions from \"@modules/common/components/line-item-options\"\nimport LineItemPrice from \"@modules/common/components/line-item-price\"\nimport LineItemUnitPrice from \"@modules/common/components/line-item-unit-price\"\nimport LocalizedClientLink from \"@modules/common/components/localized-client-link\"\nimport Spinner from \"@modules/common/icons/spinner\"\nimport Thumbnail from \"@modules/products/components/thumbnail\"\nimport { useState } from \"react\"\n\ntype ItemProps = {\n  item: HttpTypes.StoreCartLineItem\n  type?: \"full\" | \"preview\"\n  currencyCode: string\n}\n\nconst Item = ({ item, type = \"full\", currencyCode }: ItemProps) => {\n  const [updating, setUpdating] = useState(false)\n  const [error, setError] = useState<string | null>(null)\n\n  const changeQuantity = async (quantity: number) => {\n    setError(null)\n    setUpdating(true)\n\n    await updateLineItem({\n      lineId: item.id,\n      quantity,\n    })\n      .catch((err) => {\n        setError(err.message)\n      })\n      .finally(() => {\n        setUpdating(false)\n      })\n  }\n\n  // TODO: Update this to grab the actual max inventory\n  const maxQtyFromInventory = 10\n  const maxQuantity = item.variant?.manage_inventory ? 10 : maxQtyFromInventory\n\n  return (\n    <Table.Row className=\"w-full\" data-testid=\"product-row\">\n      <Table.Cell className=\"!pl-0 p-4 w-24\">\n        <LocalizedClientLink\n          href={`/products/${item.product_handle}`}\n          className={clx(\"flex\", {\n            \"w-16\": type === \"preview\",\n            \"small:w-24 w-12\": type === \"full\",\n          })}\n        >\n          <Thumbnail\n            thumbnail={item.thumbnail || item.variant?.product?.thumbnail}\n            images={item.variant?.product?.images}\n            size=\"square\"\n          />\n        </LocalizedClientLink>\n      </Table.Cell>\n\n      <Table.Cell className=\"text-left\">\n        <Text\n          className=\"txt-medium-plus text-ui-fg-base\"\n          data-testid=\"product-title\"\n        >\n          {item.product_title}\n        </Text>\n        <LineItemOptions variant={item.variant} data-testid=\"product-variant\" />\n      </Table.Cell>\n\n      {type === \"full\" && (\n        <Table.Cell>\n          <div className=\"flex gap-2 items-center w-28\">\n            <DeleteButton id={item.id} data-testid=\"product-delete-button\" />\n            <CartItemSelect\n              value={item.quantity}\n              onChange={(value) => changeQuantity(parseInt(value.target.value))}\n              className=\"w-14 h-10 p-4\"\n              data-testid=\"product-select-button\"\n            >\n              {/* TODO: Update this with the v2 way of managing inventory */}\n              {Array.from(\n                {\n                  length: Math.min(maxQuantity, 10),\n                },\n                (_, i) => (\n                  <option value={i + 1} key={i}>\n                    {i + 1}\n                  </option>\n                )\n              )}\n\n              <option value={1} key={1}>\n                1\n              </option>\n            </CartItemSelect>\n            {updating && <Spinner />}\n          </div>\n          <ErrorMessage error={error} data-testid=\"product-error-message\" />\n        </Table.Cell>\n      )}\n\n      {type === \"full\" && (\n        <Table.Cell className=\"hidden small:table-cell\">\n          <LineItemUnitPrice\n            item={item}\n            style=\"tight\"\n            currencyCode={currencyCode}\n          />\n        </Table.Cell>\n      )}\n\n      <Table.Cell className=\"!pr-0\">\n        <span\n          className={clx(\"!pr-0\", {\n            \"flex flex-col items-end h-full justify-center\": type === \"preview\",\n          })}\n        >\n          {type === \"preview\" && (\n            <span className=\"flex gap-x-1 \">\n              <Text className=\"text-ui-fg-muted\">{item.quantity}x </Text>\n              <LineItemUnitPrice\n                item={item}\n                style=\"tight\"\n                currencyCode={currencyCode}\n              />\n            </span>\n          )}\n          <LineItemPrice\n            item={item}\n            style=\"tight\"\n            currencyCode={currencyCode}\n          />\n        </span>\n      </Table.Cell>\n    </Table.Row>\n  )\n}\n\nexport default Item\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/cart/components/items-preview-template/index.tsx","messages":[{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":12,"column":7,"nodeType":null,"messageId":"preferOptionalChain","endLine":12,"endColumn":35,"fix":{"range":[296,324],"text":"items?.length === 0"}},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":28,"column":55,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":28,"endColumn":57,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[825,875],"text":"(item.variant?.product?.thumbnail ?? item.thumbnail)"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":28,"column":73,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":28,"endColumn":75,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[876,878],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":65,"column":80,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":65,"endColumn":82,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2608,2610],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":1,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { HttpTypes } from \"@medusajs/types\"\nimport { convertToLocale } from \"@lib/util/money\"\nimport Image from \"next/image\"\n\ntype ItemsPreviewTemplateProps = {\n  items: HttpTypes.StoreCartLineItem[]\n}\n\nconst ItemsPreviewTemplate = ({ items }: ItemsPreviewTemplateProps) => {\n  if (!items || items.length === 0) {\n    return (\n      <div className=\"text-center text-ui-fg-subtle py-4\">\n        購物車是空的\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"space-y-3\">\n      {items.map((item) => (\n        <div key={item.id} className=\"flex items-center space-x-3\">\n          {/* Product image */}\n          <div className=\"flex-shrink-0 w-12 h-12 bg-ui-bg-subtle rounded-lg overflow-hidden relative\">\n            {item.variant?.product?.thumbnail || item.thumbnail ? (\n              <Image\n                src={item.variant?.product?.thumbnail || item.thumbnail || \"\"}\n                alt={item.title || \"Product image\"}\n                width={48}\n                height={48}\n                className=\"w-full h-full object-cover\"\n                onError={(e) => {\n                  const target = e.target as HTMLImageElement;\n                  target.style.display = 'none';\n                  const fallback = target.parentElement?.querySelector('.fallback-placeholder') as HTMLElement;\n                  if (fallback) {\n                    fallback.style.display = 'flex';\n                  }\n                }}\n              />\n            ) : null}\n            <div className=\"fallback-placeholder w-full h-full bg-ui-bg-subtle absolute inset-0 items-center justify-center\" style={{ display: (item.variant?.product?.thumbnail || item.thumbnail) ? 'none' : 'flex' }}>\n              <span className=\"text-ui-fg-muted text-xs\">無圖片</span>\n            </div>\n          </div>\n\n          {/* Product details */}\n          <div className=\"flex-1 min-w-0\">\n            <h3 className=\"text-sm font-medium text-ui-fg-base truncate\">\n              {item.title}\n            </h3>\n            {item.variant?.title && item.variant.title !== \"Default Variant\" && (\n              <p className=\"text-xs text-ui-fg-subtle\">\n                {item.variant.title}\n              </p>\n            )}\n            <div className=\"flex items-center justify-between mt-1\">\n              <span className=\"text-xs text-ui-fg-subtle\">\n                數量: {item.quantity}\n              </span>\n              <span className=\"text-sm font-medium text-ui-fg-base\">\n                {convertToLocale({\n                  amount: item.total || 0,\n                  currency_code: item.variant?.calculated_price?.currency_code || \"TWD\",\n                })}\n              </span>\n            </div>\n          </div>\n        </div>\n      ))}\n    </div>\n  )\n}\n\nexport default ItemsPreviewTemplate\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/cart/components/sign-in-prompt/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/cart/templates/index.tsx","messages":[{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":31,"column":18,"nodeType":null,"messageId":"preferOptionalChain","endLine":31,"endColumn":37,"fix":{"range":[1069,1088],"text":"cart?.region"}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":34,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1212,1215],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1212,1215],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import ItemsTemplate from \"./items\"\nimport Summary from \"./summary\"\nimport EmptyCartMessage from \"../components/empty-cart-message\"\nimport SignInPrompt from \"../components/sign-in-prompt\"\nimport Divider from \"@modules/common/components/divider\"\nimport { HttpTypes } from \"@medusajs/types\"\n\nconst CartTemplate = ({\n  cart,\n  customer,\n}: {\n  cart: HttpTypes.StoreCart | null\n  customer: HttpTypes.StoreCustomer | null\n}) => {\n  return (\n    <div className=\"py-12\">\n      <div className=\"px-6 md:px-12 xl:px-16 2xl:px-20\" data-testid=\"cart-container\">\n        {cart?.items?.length ? (\n          <div className=\"grid grid-cols-1 small:grid-cols-[1fr_360px] gap-x-40\">\n            <div className=\"flex flex-col bg-white py-6 gap-y-6\">\n              {!customer && (\n                <>\n                  <SignInPrompt />\n                  <Divider />\n                </>\n              )}\n              <ItemsTemplate cart={cart} />\n            </div>\n            <div className=\"relative\">\n              <div className=\"flex flex-col gap-y-8 sticky top-12\">\n                {cart && cart.region && (\n                  <>\n                    <div className=\"bg-white py-6\">\n                      <Summary cart={cart as any} />\n                    </div>\n                  </>\n                )}\n              </div>\n            </div>\n          </div>\n        ) : (\n          <div>\n            <EmptyCartMessage />\n          </div>\n        )}\n      </div>\n    </div>\n  )\n}\n\nexport default CartTemplate\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/cart/templates/items.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/cart/templates/preview.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/cart/templates/summary.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/categories/templates/index.tsx","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":23,"column":23,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":23,"endColumn":25,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[803,805],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":43,"column":12,"nodeType":null,"messageId":"preferOptionalChain","endLine":55,"endColumn":15,"suggestions":[{"fix":{"range":[1432,1889],"text":"parents?.map((parent) => (\n              <span key={parent.id} className=\"text-ui-fg-subtle\">\n                <LocalizedClientLink\n                  className=\"mr-4 hover:text-black\"\n                  href={`/categories/${parent.handle}`}\n                  data-testid=\"category-parent-link\"\n                >\n                  {parent.name}\n                </LocalizedClientLink>\n                /\n              </span>\n            ))"},"messageId":"optionalChainSuggest","desc":"Change to an optional chain."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { notFound } from \"next/navigation\"\nimport { Suspense } from \"react\"\n\nimport SkeletonProductGrid from \"../../skeletons/templates/skeleton-product-grid/index\"\nimport { SortOptions } from \"../../store/components/refinement-list/sort-products/index\"\nimport PaginatedProducts from \"../../store/templates/paginated-products\"\nimport RefinementList from \"../../store/components/refinement-list/index\"\nimport LocalizedClientLink from \"../../common/components/localized-client-link/index\"\nimport { HttpTypes } from \"@medusajs/types\"\n\nexport default function CategoryTemplate({\n  category,\n  sortBy,\n  page,\n  countryCode,\n}: {\n  category: HttpTypes.StoreProductCategory\n  sortBy?: SortOptions\n  page?: string\n  countryCode: string\n}) {\n  const pageNumber = page ? parseInt(page) : 1\n  const sort = sortBy || \"created_at\"\n\n  if (!category || !countryCode) notFound()\n\n  const parents = [] as HttpTypes.StoreProductCategory[]\n\n  const getParents = (category: HttpTypes.StoreProductCategory) => {\n    if (category.parent_category) {\n      parents.push(category.parent_category)\n      getParents(category.parent_category)\n    }\n  }\n\n  getParents(category)\n\n  return (\n    <div className=\"pt-0 pb-8\" data-testid=\"category-container\">\n      {/* 標題區域 - 置中對齊 */}\n      <div className=\"px-4 md:px-8 lg:px-12 py-3 border-b border-gray-100 text-center\">\n        <div className=\"flex flex-row mb-1 text-2xl-semi gap-4 justify-center\">\n          {parents &&\n            parents.map((parent) => (\n              <span key={parent.id} className=\"text-ui-fg-subtle\">\n                <LocalizedClientLink\n                  className=\"mr-4 hover:text-black\"\n                  href={`/categories/${parent.handle}`}\n                  data-testid=\"category-parent-link\"\n                >\n                  {parent.name}\n                </LocalizedClientLink>\n                /\n              </span>\n            ))}\n          <h1 data-testid=\"category-page-title\" className=\"text-2xl font-semibold\">\n            {category.name}\n          </h1>\n        </div>\n        {category.description && (\n          <div className=\"mb-1 text-base text-gray-600 text-center\">\n            <p>{category.description}</p>\n          </div>\n        )}\n      </div>\n\n      {/* 篩選器區域 */}\n      <div className=\"px-4 md:px-8 lg:px-12 py-1 border-b border-gray-100\">\n        <RefinementList sortBy={sort} data-testid=\"sort-by-container\" />\n      </div>\n\n      <Suspense fallback={<SkeletonProductGrid />}>\n        <PaginatedProducts\n          sortBy={sort}\n          page={pageNumber}\n          categoryId={category.id}\n          countryCode={countryCode}\n          hideRefinementList={true}\n        />\n      </Suspense>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/checkout/components/address-select/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/checkout/components/addresses/index.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Button' is defined but never used.","line":7,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":16},{"ruleId":"unused-imports/no-unused-imports","severity":2,"message":"'Button' is defined but never used.","line":7,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":16,"fix":{"range":[222,230],"text":""}},{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":97,"column":14,"nodeType":null,"messageId":"preferOptionalChain","endLine":97,"endColumn":43,"fix":{"range":[2993,3022],"text":"cart?.shipping_address"}}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":2,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { setAddresses } from \"@lib/data/cart\"\nimport compareAddresses from \"@lib/util/compare-addresses\"\nimport { CheckCircleSolid } from \"@medusajs/icons\"\nimport { HttpTypes } from \"@medusajs/types\"\nimport { Button, Heading, Text, useToggleState } from \"@medusajs/ui\"\nimport Divider from \"@modules/common/components/divider\"\nimport Spinner from \"@modules/common/icons/spinner\"\nimport { usePathname, useRouter, useSearchParams } from \"next/navigation\"\nimport { useActionState } from \"react\"\nimport BillingAddress from \"../billing_address\"\nimport ErrorMessage from \"../error-message\"\nimport ShippingAddress from \"../shipping-address\"\nimport { SubmitButton } from \"../submit-button\"\n\nconst Addresses = ({\n  cart,\n  customer,\n}: {\n  cart: HttpTypes.StoreCart | null\n  customer: HttpTypes.StoreCustomer | null\n}) => {\n  const searchParams = useSearchParams()\n  const router = useRouter()\n  const pathname = usePathname()\n\n  const isOpen = searchParams.get(\"step\") === \"address\"\n\n  const { state: sameAsBilling, toggle: toggleSameAsBilling } = useToggleState(\n    cart?.shipping_address && cart?.billing_address\n      ? compareAddresses(cart?.shipping_address, cart?.billing_address)\n      : true\n  )\n\n  const handleEdit = () => {\n    router.push(pathname + \"?step=address\")\n  }\n\n  const [message, formAction] = useActionState(setAddresses, null)\n\n  return (\n    <div className=\"bg-white\">\n      <div className=\"flex flex-row items-center justify-between mb-6\">\n        <Heading\n          level=\"h2\"\n          className=\"flex flex-row text-3xl-regular gap-x-2 items-baseline\"\n        >\n          收貨地址\n          {!isOpen && <CheckCircleSolid />}\n        </Heading>\n        {!isOpen && cart?.shipping_address && (\n          <Text>\n            <button\n              onClick={handleEdit}\n              className=\"text-blue-600 hover:text-blue-600-hover\"\n              data-testid=\"edit-address-button\"\n            >\n              編輯\n            </button>\n          </Text>\n        )}\n      </div>\n      {isOpen ? (\n        <form action={formAction}>\n          <div className=\"pb-8\">\n            <ShippingAddress\n              customer={customer}\n              checked={sameAsBilling}\n              onChange={toggleSameAsBilling}\n              cart={cart}\n            />\n\n            {!sameAsBilling && (\n              <div>\n                <Heading\n                  level=\"h2\"\n                  className=\"text-3xl-regular gap-x-4 pb-6 pt-8\"\n                >\n                  帳單地址\n                </Heading>\n\n                <BillingAddress cart={cart} />\n              </div>\n            )}\n            <div className=\"mt-6\">\n              <SubmitButton className=\"w-full\" data-testid=\"submit-address-button\">\n                繼續選擇運送方式\n              </SubmitButton>\n            </div>\n            <ErrorMessage error={message} data-testid=\"address-error-message\" />\n          </div>\n        </form>\n      ) : (\n        <div>\n          <div className=\"text-small-regular\">\n            {cart && cart.shipping_address ? (\n              <div className=\"flex items-start gap-x-8\">\n                <div className=\"flex items-start gap-x-1 w-full\">\n                  <div\n                    className=\"flex flex-col w-1/3\"\n                    data-testid=\"shipping-address-summary\"\n                  >\n                    <Text className=\"txt-medium-plus text-gray-900 mb-1\">\n                      收貨地址\n                    </Text>\n                    <Text className=\"txt-medium text-gray-600\">\n                      {cart.shipping_address.first_name}{\" \"}\n                      {cart.shipping_address.last_name}\n                    </Text>\n                    <Text className=\"txt-medium text-gray-600\">\n                      {cart.shipping_address.address_1}{\" \"}\n                      {cart.shipping_address.address_2}\n                    </Text>\n                    <Text className=\"txt-medium text-gray-600\">\n                      {cart.shipping_address.postal_code},{\" \"}\n                      {cart.shipping_address.city}\n                    </Text>\n                    <Text className=\"txt-medium text-gray-600\">\n                      {cart.shipping_address.country_code?.toUpperCase()}\n                    </Text>\n                  </div>\n\n                  <div\n                    className=\"flex flex-col w-1/3 \"\n                    data-testid=\"shipping-contact-summary\"\n                  >\n                    <Text className=\"txt-medium-plus text-gray-900 mb-1\">\n                      聯絡資訊\n                    </Text>\n                    <Text className=\"txt-medium text-gray-600\">\n                      {cart.shipping_address.phone}\n                    </Text>\n                    <Text className=\"txt-medium text-gray-600\">\n                      {cart.email}\n                    </Text>\n                  </div>\n\n                  <div\n                    className=\"flex flex-col w-1/3\"\n                    data-testid=\"billing-address-summary\"\n                  >\n                    <Text className=\"txt-medium-plus text-gray-900 mb-1\">\n                      帳單地址\n                    </Text>\n\n                    {sameAsBilling ? (\n                      <Text className=\"txt-medium text-gray-600\">\n                        帳單地址與收貨地址相同。\n                      </Text>\n                    ) : (\n                      <>\n                        <Text className=\"txt-medium text-gray-600\">\n                          {cart.billing_address?.first_name}{\" \"}\n                          {cart.billing_address?.last_name}\n                        </Text>\n                        <Text className=\"txt-medium text-gray-600\">\n                          {cart.billing_address?.address_1}{\" \"}\n                          {cart.billing_address?.address_2}\n                        </Text>\n                        <Text className=\"txt-medium text-gray-600\">\n                          {cart.billing_address?.postal_code},{\" \"}\n                          {cart.billing_address?.city}\n                        </Text>\n                        <Text className=\"txt-medium text-gray-600\">\n                          {cart.billing_address?.country_code?.toUpperCase()}\n                        </Text>\n                      </>\n                    )}\n                  </div>\n                </div>\n              </div>\n            ) : (\n              <div>\n                <Spinner />\n              </div>\n            )}\n          </div>\n        </div>\n      )}\n      <Divider className=\"mt-8\" />\n    </div>\n  )\n}\n\nexport default Addresses\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/checkout/components/bank-transfer/index.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Button' is defined but never used.","line":5,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":31},{"ruleId":"unused-imports/no-unused-imports","severity":2,"message":"'Button' is defined but never used.","line":5,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":31,"fix":{"range":[131,139],"text":""}},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":27,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":27,"endColumn":18,"suggestions":[{"fix":{"range":[867,930],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":31,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":31,"endColumn":20,"suggestions":[{"fix":{"range":[1011,1060],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":40,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":40,"endColumn":20,"suggestions":[{"fix":{"range":[1358,1394],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":45,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1497,1500],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1497,1500],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":46,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":46,"endColumn":20,"suggestions":[{"fix":{"range":[1510,1554],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":1,"fixableWarningCount":0,"source":"\"use client\"\n\nimport React, { useEffect, useState } from \"react\"\nimport { HttpTypes } from \"@medusajs/types\"\nimport { Heading, Text, Button } from \"@medusajs/ui\"\nimport { useSearchParams, useRouter, usePathname } from \"next/navigation\"\nimport { placeOrder } from \"@lib/data/cart\"\nimport ErrorMessage from \"../error-message/index\"\n\ntype BankTransferProps = {\n  cart: HttpTypes.StoreCart\n}\n\nconst BankTransfer: React.FC<BankTransferProps> = ({ cart }) => {\n  const searchParams = useSearchParams()\n  const router = useRouter()\n  const pathname = usePathname()\n  const [error, setError] = useState(\"\")\n  const [orderId, setOrderId] = useState<string | null>(null)\n  const [isCreatingOrder, setIsCreatingOrder] = useState(false)\n\n  const createOrder = async () => {\n    if (isCreatingOrder || orderId) return // 防止重複建立訂單\n    \n    setIsCreatingOrder(true)\n    try {\n      console.log(\"Creating order for bank transfer, cart:\", cart.id)\n      const order = await placeOrder(cart.id)\n      \n      if (order) {\n        console.log(\"Order created successfully:\", order)\n        setOrderId(order.id)\n        \n        // 訂單創建成功後，跳轉到訂單確認步驟\n        const params = new URLSearchParams(searchParams.toString())\n        params.set('step', 'order-confirmed')\n        params.set('order_id', order.id)\n        \n        const newUrl = `${pathname}?${params.toString()}`\n        console.log(\"🚀 跳轉到訂單確認頁面:\", newUrl)\n        router.push(newUrl)\n      } else {\n        setError(\"訂單建立失敗，請重新嘗試\")\n      }\n    } catch (err: any) {\n      console.error(\"Order creation failed:\", err)\n      setError(\"訂單建立失敗：\" + err.message)\n    } finally {\n      setIsCreatingOrder(false)\n    }\n  }\n\n  useEffect(() => {\n    // 檢查是否已有訂單ID\n    const orderIdFromUrl = searchParams.get('order_id')\n    if (orderIdFromUrl) {\n      setOrderId(orderIdFromUrl)\n    } else {\n      // 如果沒有訂單ID，自動建立訂單\n      createOrder()\n    }\n  }, [searchParams])\n\n  if (error) {\n    return <ErrorMessage error={error} />\n  }\n\n  if (!orderId) {\n    return (\n      <div className=\"space-y-6\">\n        <Text>載入中...</Text>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div>\n        <Heading level=\"h2\" className=\"text-xl font-semibold\">\n          訂單成立\n        </Heading>\n        <div className=\"flex items-center gap-2 mt-2\">\n          <Text className=\"text-gray-600\">\n            訂單編號：{orderId}\n          </Text>\n          <span className=\"px-2 py-1 text-xs font-medium bg-orange-100 text-orange-800 rounded-full\">\n            未付款\n          </span>\n        </div>\n      </div>\n\n      <div className=\"border border-gray-200 rounded-lg p-6 bg-gray-50\">\n        <Heading level=\"h3\" className=\"text-lg font-medium mb-4\">\n          銀行轉帳資訊\n        </Heading>\n        \n        <div className=\"space-y-3\">\n          <div>\n            <Text className=\"font-medium\">銀行：</Text>\n            <Text>玉山銀行 (808)</Text>\n          </div>\n          \n          <div>\n            <Text className=\"font-medium\">戶名：</Text>\n            <Text>TIM韓式料理餐飲有限公司</Text>\n          </div>\n          \n          <div>\n            <Text className=\"font-medium\">帳號：</Text>\n            <Text>1234-567-890123</Text>\n          </div>\n          \n          <div>\n            <Text className=\"font-medium\">轉帳金額：</Text>\n            <Text className=\"text-lg font-semibold\">\n              NT$ {cart.total ? (cart.total / 100).toLocaleString() : 0}\n            </Text>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"bg-yellow-50 border border-yellow-200 rounded-lg p-4\">\n        <Text className=\"text-yellow-800\">\n          <strong>注意事項：</strong>\n          <br />\n          • 請於3個工作天內完成轉帳\n          <br />\n          • 轉帳後請保留收據\n          <br />\n          • 我們將於收到款項後通知您\n          <br />\n          • 如有疑問請聯繫客服：02-1234-5678\n        </Text>\n      </div>\n\n      <div className=\"space-y-3\">\n        <Text className=\"text-sm text-gray-600\">\n          感謝您的訂購！我們會在確認收到款項後儘快為您處理訂單。\n        </Text>\n      </div>\n    </div>\n  )\n}\n\nexport default BankTransfer\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/checkout/components/billing_address/index.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":7,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[304,307],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[304,307],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":8,"column":69,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":8,"endColumn":71,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[379,381],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":9,"column":67,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":9,"endColumn":69,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[452,454],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":10,"column":67,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":10,"endColumn":69,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[525,527],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":11,"column":63,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":11,"endColumn":65,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[594,596],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":12,"column":71,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":12,"endColumn":73,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[671,673],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":13,"column":57,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":13,"endColumn":59,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[734,736],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":14,"column":73,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":14,"endColumn":75,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[813,815],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":15,"column":65,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":15,"endColumn":67,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[884,886],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":16,"column":59,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":16,"endColumn":61,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[949,951],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":9,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { HttpTypes } from \"@medusajs/types\"\nimport Input from \"@modules/common/components/input\"\nimport React, { useState } from \"react\"\nimport CountrySelect from \"../country-select\"\n\nconst BillingAddress = ({ cart }: { cart: HttpTypes.StoreCart | null }) => {\n  const [formData, setFormData] = useState<any>({\n    \"billing_address.first_name\": cart?.billing_address?.first_name || \"\",\n    \"billing_address.last_name\": cart?.billing_address?.last_name || \"\",\n    \"billing_address.address_1\": cart?.billing_address?.address_1 || \"\",\n    \"billing_address.company\": cart?.billing_address?.company || \"\",\n    \"billing_address.postal_code\": cart?.billing_address?.postal_code || \"\",\n    \"billing_address.city\": cart?.billing_address?.city || \"\",\n    \"billing_address.country_code\": cart?.billing_address?.country_code || \"\",\n    \"billing_address.province\": cart?.billing_address?.province || \"\",\n    \"billing_address.phone\": cart?.billing_address?.phone || \"\",\n  })\n\n  const handleChange = (\n    e: React.ChangeEvent<\n      HTMLInputElement | HTMLInputElement | HTMLSelectElement\n    >\n  ) => {\n    setFormData({\n      ...formData,\n      [e.target.name]: e.target.value,\n    })\n  }\n\n  return (\n    <>\n      <div className=\"grid grid-cols-2 gap-4\">\n        <Input\n          label=\"姓氏\"\n          name=\"billing_address.last_name\"\n          autoComplete=\"family-name\"\n          value={formData[\"billing_address.last_name\"]}\n          onChange={handleChange}\n          required\n          data-testid=\"billing-last-name-input\"\n        />\n        <Input\n          label=\"名字\"\n          name=\"billing_address.first_name\"\n          autoComplete=\"given-name\"\n          value={formData[\"billing_address.first_name\"]}\n          onChange={handleChange}\n          required\n          data-testid=\"billing-first-name-input\"\n        />\n        <Input\n          label=\"縣市\"\n          name=\"billing_address.province\"\n          autoComplete=\"address-level1\"\n          value={formData[\"billing_address.province\"]}\n          onChange={handleChange}\n          required\n          data-testid=\"billing-province-input\"\n        />\n        <Input\n          label=\"鄉鎮市區\"\n          name=\"billing_address.city\"\n          autoComplete=\"address-level2\"\n          value={formData[\"billing_address.city\"]}\n          onChange={handleChange}\n          required\n          data-testid=\"billing-city-input\"\n        />\n        <Input\n          label=\"郵遞區號\"\n          name=\"billing_address.postal_code\"\n          autoComplete=\"postal-code\"\n          value={formData[\"billing_address.postal_code\"]}\n          onChange={handleChange}\n          required\n          data-testid=\"billing-postal-input\"\n        />\n        <Input\n          label=\"詳細地址\"\n          name=\"billing_address.address_1\"\n          autoComplete=\"address-line1\"\n          value={formData[\"billing_address.address_1\"]}\n          onChange={handleChange}\n          required\n          data-testid=\"billing-address-input\"\n        />\n        <Input\n          label=\"電話\"\n          name=\"billing_address.phone\"\n          autoComplete=\"tel\"\n          value={formData[\"billing_address.phone\"]}\n          onChange={handleChange}\n          required\n          data-testid=\"billing-phone-input\"\n        />\n        <Input\n          label=\"公司 (選填)\"\n          name=\"billing_address.company\"\n          value={formData[\"billing_address.company\"]}\n          onChange={handleChange}\n          autoComplete=\"organization\"\n          data-testid=\"billing-company-input\"\n        />\n        <CountrySelect\n          name=\"billing_address.country_code\"\n          autoComplete=\"country\"\n          region={cart?.region}\n          value={formData[\"billing_address.country_code\"]}\n          onChange={handleChange}\n          required\n          data-testid=\"billing-country-select\"\n        />\n      </div>\n    </>\n  )\n}\n\nexport default BillingAddress\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/checkout/components/checkout-form/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/checkout/components/checkout-item/index.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'convertToLocale' is defined but never used.","line":1,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":25},{"ruleId":"unused-imports/no-unused-imports","severity":2,"message":"'convertToLocale' is defined but never used.","line":1,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":25,"fix":{"range":[0,50],"text":""}},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":15,"column":51,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":15,"endColumn":53,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[637,639],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import { convertToLocale } from \"@lib/util/money\"\nimport { HttpTypes } from \"@medusajs/types\"\nimport { Text } from \"@medusajs/ui\"\nimport LocalizedClientLink from \"@modules/common/components/localized-client-link\"\nimport Thumbnail from \"@modules/products/components/thumbnail\"\nimport LineItemPrice from \"@modules/common/components/line-item-price\"\nimport LineItemUnitPrice from \"@modules/common/components/line-item-unit-price\"\n\ntype CheckoutItemProps = {\n  item: HttpTypes.StoreCartLineItem\n  currencyCode: string\n}\n\nconst CheckoutItem = ({ item, currencyCode }: CheckoutItemProps) => {\n  const productVariantTitle = item.variant?.title || \"\"\n  \n  return (\n    <div className=\"flex gap-4\">\n      {/* Product image */}\n      <LocalizedClientLink\n        href={`/products/${item.product_handle}`}\n        className=\"flex-shrink-0\"\n      >\n        <div className=\"w-20 h-20 rounded-lg overflow-hidden bg-gray-50 border border-gray-100\">\n          <Thumbnail\n            thumbnail={item.thumbnail}\n            images={item.variant?.product?.images}\n            size=\"square\"\n            className=\"w-full h-full object-cover\"\n          />\n        </div>\n      </LocalizedClientLink>\n\n      {/* Product info */}\n      <div className=\"flex-1 min-w-0\">\n        <div className=\"mb-3\">\n          <Text className=\"font-medium text-gray-900 text-sm leading-tight\">\n            {item.product_title}\n          </Text>\n          {productVariantTitle && (\n            <Text className=\"text-xs text-gray-500 mt-1\">\n              {productVariantTitle}\n            </Text>\n          )}\n        </div>\n        \n        {/* Price and quantity */}\n        <div className=\"space-y-2\">\n          <div className=\"flex items-center justify-between\">\n            <Text className=\"text-xs text-gray-500\">數量</Text>\n            <Text className=\"text-sm font-medium text-gray-900\">{item.quantity}</Text>\n          </div>\n          \n          <div className=\"flex items-center justify-between\">\n            <Text className=\"text-xs text-gray-500\">單價</Text>\n            <div className=\"text-right\">\n              <LineItemUnitPrice\n                item={item}\n                style=\"tight\"\n                currencyCode={currencyCode}\n              />\n            </div>\n          </div>\n          \n          <div className=\"flex items-center justify-between border-t border-gray-100 pt-2\">\n            <Text className=\"text-sm font-medium text-gray-900\">小計</Text>\n            <div className=\"text-right\">\n              <LineItemPrice\n                item={item}\n                style=\"tight\"\n                currencyCode={currencyCode}\n              />\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}\n\nexport default CheckoutItem\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/checkout/components/checkout-summary/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/checkout/components/country-select/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/checkout/components/delivery-address-form/index.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ConfirmedFormData' is defined but never used.","line":17,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":28},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'ConfirmedFormData' is defined but never used. Allowed unused vars must match /^_/u.","line":17,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":28},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'touched' is assigned a value but never used.","line":57,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":57,"endColumn":17},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'touched' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":57,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":57,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'setTouched' is assigned a value but never used.","line":57,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":57,"endColumn":29},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'setTouched' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":57,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":57,"endColumn":29},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":79,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":79,"endColumn":24,"suggestions":[{"fix":{"range":[1906,1938],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":97,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":97,"endColumn":20,"suggestions":[{"fix":{"range":[2336,2365],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"sonarjs/no-duplicate-string","severity":2,"message":"Define a constant instead of duplicating this literal 6 times.","line":212,"column":43,"nodeType":"Literal","endLine":212,"endColumn":60}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { useState, useEffect } from \"react\"\nimport { Button, Input, Label } from \"@medusajs/ui\"\nimport React from \"react\"\n\ninterface FormData {\n  first_name: string;\n  last_name: string;\n  phone: string;\n  city: string;\n  address_1: string;\n  address_2: string;\n  postal_code: string;\n}\n\ninterface ConfirmedFormData extends FormData {\n  confirmed: boolean;\n}\n\nconst initialFormData: FormData = {\n  first_name: \"\",\n  last_name: \"\",\n  phone: \"\",\n  city: \"\",\n  address_1: \"\",\n  address_2: \"\",\n  postal_code: \"\"\n}\n\ntype DeliveryAddressFormProps = {\n  onSubmit: (addressData: FormData) => void;\n  initialData?: Partial<FormData>;\n  isSubmitting?: boolean;\n}\n\nconst STORAGE_KEY = \"delivery_address_data\"\n\n// 台灣手機號碼驗證\nconst isValidTWPhone = (phone: string): boolean => {\n  return /^09\\d{8}$/.test(phone)\n}\n\n// 郵遞區號驗證\nconst isValidPostalCode = (code: string): boolean => {\n  return /^\\d{3,6}$/.test(code)\n}\n\nconst DeliveryAddressForm = ({ \n  onSubmit,\n  initialData = {},\n  isSubmitting = false\n}: DeliveryAddressFormProps): React.ReactElement => {\n  const [formData, setFormData] = useState<FormData>(initialFormData)\n  const [isFormConfirmed, setIsFormConfirmed] = useState(false)\n  const [errors, setErrors] = useState<Record<string, string>>({})\n  const [touched, setTouched] = useState<Record<string, boolean>>({})\n\n  const cities = [\n    \"臺北市\", \"新北市\", \"基隆市\", \"桃園市\", \"新竹市\", \"新竹縣\",\n    \"苗栗縣\", \"臺中市\", \"彰化縣\", \"南投縣\", \"雲林縣\", \"嘉義市\",\n    \"嘉義縣\", \"臺南市\", \"高雄市\", \"屏東縣\", \"宜蘭縣\", \"花蓮縣\",\n    \"臺東縣\", \"澎湖縣\", \"金門縣\", \"連江縣\"\n  ]\n\n  // 從 localStorage 載入儲存的資料\n  useEffect(() => {\n    const loadStoredData = () => {\n      const storedData = localStorage.getItem(STORAGE_KEY)\n      if (storedData) {\n        try {\n          const parsedData = JSON.parse(storedData)\n          setFormData(prev => ({\n            ...prev,\n            ...parsedData,\n            ...initialData\n          }))\n        } catch (e) {\n          console.error('無法解析儲存的收件資訊:', e)\n        }\n      } else if (initialData && Object.keys(initialData).length > 0) {\n        setFormData(prev => ({\n          ...prev,\n          ...initialData\n        }))\n      }\n    }\n\n    loadStoredData()\n  }, [initialData])\n\n  // 儲存資料到 localStorage\n  const saveToStorage = (data: FormData): void => {\n    try {\n      localStorage.setItem(STORAGE_KEY, JSON.stringify(data))\n    } catch (e) {\n      console.error('無法儲存收件資訊:', e)\n    }\n  }\n\n  // 表單驗證\n  const validateFormData = (data: FormData) => {\n    const newErrors: Record<string, string> = {}\n    \n    // 姓氏驗證\n    if (!data.last_name.trim()) {\n      newErrors.last_name = \"請輸入姓氏\"\n    } else if (data.last_name.length > 25) {\n      newErrors.last_name = \"姓氏過長\"\n    }\n\n    // 名字驗證\n    if (!data.first_name.trim()) {\n      newErrors.first_name = \"請輸入名字\"\n    } else if (data.first_name.length > 25) {\n      newErrors.first_name = \"名字過長\"\n    }\n\n    // 電話驗證\n    if (!data.phone.trim()) {\n      newErrors.phone = \"請輸入聯絡電話\"\n    } else if (!isValidTWPhone(data.phone)) {\n      newErrors.phone = \"請輸入正確的手機號碼格式\"\n    }\n\n    // 地址驗證\n    if (!data.city) {\n      newErrors.city = \"請選擇縣市\"\n    }\n\n    if (!data.address_1.trim()) {\n      newErrors.address_1 = \"請輸入詳細地址\"\n    } else if (data.address_1.length > 100) {\n      newErrors.address_1 = \"地址過長\"\n    }\n\n    // 郵遞區號驗證\n    if (!data.postal_code.trim()) {\n      newErrors.postal_code = \"請輸入郵遞區號\"\n    } else if (!isValidPostalCode(data.postal_code)) {\n      newErrors.postal_code = \"請輸入有效的郵遞區號\"\n    }\n\n    return newErrors\n  }\n\n  // 處理欄位變更\n  const handleChange = (\n    e: React.ChangeEvent<HTMLInputElement | HTMLSelectElement>\n  ) => {\n    const { name, value } = e.target\n    setFormData(prev => ({ ...prev, [name]: value }))\n    setIsFormConfirmed(false) // 當欄位變更時，重設確認狀態\n    \n    // 即時驗證\n    const fieldErrors = validateFormData({ ...formData, [name]: value })\n    if (fieldErrors[name]) {\n      setErrors(prev => ({ ...prev, [name]: fieldErrors[name] }))\n    } else {\n      setErrors(prev => {\n        const newErrors = { ...prev }\n        delete newErrors[name]\n        return newErrors\n      })\n    }\n  }\n\n  // 處理表單提交\n  const handleSubmit = (e?: React.FormEvent | React.MouseEvent) => {\n    if (e) {\n      e.preventDefault()\n    }\n    \n    const newErrors = validateFormData(formData)\n    setErrors(newErrors)\n\n    if (Object.keys(newErrors).length === 0) {\n      // 儲存到 localStorage\n      saveToStorage(formData)\n      \n      // 設置表單為已確認狀態\n      setIsFormConfirmed(true)\n      \n      // 調用父元件的 onSubmit，包含 country_code\n      const addressData = {\n        ...formData,\n        country_code: 'TW'\n      }\n      onSubmit(addressData)\n    } else {\n      // 滾動到第一個錯誤欄位\n      const firstErrorField = document.querySelector(\n        `[name=\"${Object.keys(newErrors)[0]}\"]`\n      )\n      firstErrorField?.scrollIntoView({ behavior: \"smooth\", block: \"center\" })\n    }\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* 姓名 */}\n      <div className=\"grid grid-cols-2 gap-4\">\n        <div>\n          <Label htmlFor=\"last_name\" className=\"mb-2 block\">\n            姓氏 <span className=\"text-rose-500\">*</span>\n          </Label>\n          <Input\n            id=\"last_name\"\n            name=\"last_name\"\n            value={formData.last_name}\n            onChange={handleChange}\n            className={errors.last_name ? \"border-rose-500\" : \"\"}\n            placeholder=\"請輸入姓氏\"\n            required\n          />\n          {errors.last_name && (\n            <p className=\"mt-1 text-rose-500 text-sm\">{errors.last_name}</p>\n          )}\n        </div>\n        <div>\n          <Label htmlFor=\"first_name\" className=\"mb-2 block\">\n            名字 <span className=\"text-rose-500\">*</span>\n          </Label>\n          <Input\n            id=\"first_name\"\n            name=\"first_name\"\n            value={formData.first_name}\n            onChange={handleChange}\n            className={errors.first_name ? \"border-rose-500\" : \"\"}\n            placeholder=\"請輸入名字\"\n            required\n          />\n          {errors.first_name && (\n            <p className=\"mt-1 text-rose-500 text-sm\">{errors.first_name}</p>\n          )}\n        </div>\n      </div>\n\n      {/* 電話 */}\n      <div>\n        <Label htmlFor=\"phone\" className=\"mb-2 block\">\n          聯絡電話 <span className=\"text-rose-500\">*</span>\n        </Label>\n        <Input\n          id=\"phone\"\n          name=\"phone\"\n          type=\"tel\"\n          value={formData.phone}\n          onChange={handleChange}\n          className={errors.phone ? \"border-rose-500\" : \"\"}\n          placeholder=\"請輸入手機號碼\"\n          required\n        />\n        {errors.phone && (\n          <p className=\"mt-1 text-rose-500 text-sm\">{errors.phone}</p>\n        )}\n      </div>\n\n      {/* 縣市 */}\n      <div>\n        <Label htmlFor=\"city\" className=\"mb-2 block\">\n          縣市 <span className=\"text-rose-500\">*</span>\n        </Label>\n        <select\n          id=\"city\"\n          name=\"city\"\n          value={formData.city}\n          onChange={handleChange}\n          className={`w-full h-10 bg-white border rounded-md px-4 py-2 focus:outline-none focus:ring-2 ${\n            errors.city ? \"border-rose-500\" : \"border-gray-200\"\n          }`}\n          style={{\n            '--tw-ring-color': 'var(--color-primary)',\n          } as React.CSSProperties}\n          required\n        >\n          <option value=\"\">請選擇縣市</option>\n          {cities.map(city => (\n            <option key={city} value={city}>{city}</option>\n          ))}\n        </select>\n        {errors.city && (\n          <p className=\"mt-1 text-rose-500 text-sm\">{errors.city}</p>\n        )}\n      </div>\n\n      {/* 地址 */}\n      <div>\n        <Label htmlFor=\"address_1\" className=\"mb-2 block\">\n          詳細地址 <span className=\"text-rose-500\">*</span>\n        </Label>\n        <Input\n          id=\"address_1\"\n          name=\"address_1\"\n          value={formData.address_1}\n          onChange={handleChange}\n          className={errors.address_1 ? \"border-rose-500\" : \"\"}\n          placeholder=\"請輸入詳細地址\"\n          required\n        />\n        {errors.address_1 && (\n          <p className=\"mt-1 text-rose-500 text-sm\">{errors.address_1}</p>\n        )}\n      </div>\n\n      {/* 郵遞區號 */}\n      <div>\n        <Label htmlFor=\"postal_code\" className=\"mb-2 block\">\n          郵遞區號 <span className=\"text-rose-500\">*</span>\n        </Label>\n        <Input\n          id=\"postal_code\"\n          name=\"postal_code\"\n          value={formData.postal_code}\n          onChange={handleChange}\n          className={errors.postal_code ? \"border-rose-500\" : \"\"}\n          placeholder=\"請輸入郵遞區號\"\n          required\n        />\n        {errors.postal_code && (\n          <p className=\"mt-1 text-rose-500 text-sm\">{errors.postal_code}</p>\n        )}\n      </div>\n\n      {/* 確認表單內容與付款按鈕 */}\n      {isFormConfirmed ? (\n        <div className=\"space-y-4\">\n          {/* 已確認的收件資訊 */}\n          <div className=\"p-4 bg-green-50 border border-green-200 rounded-lg\">\n            <div className=\"flex items-center gap-2 mb-2\">\n              <svg className=\"w-5 h-5 text-green-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 13l4 4L19 7\" />\n              </svg>\n              <h3 className=\"text-green-800 font-medium\">已確認的收件資訊</h3>\n            </div>\n            <dl className=\"space-y-1 text-sm text-green-700\">\n              <div className=\"grid grid-cols-3\">\n                <dt className=\"font-medium\">收件人：</dt>\n                <dd className=\"col-span-2\">{formData.last_name}{formData.first_name}</dd>\n              </div>\n              <div className=\"grid grid-cols-3\">\n                <dt className=\"font-medium\">聯絡電話：</dt>\n                <dd className=\"col-span-2\">{formData.phone}</dd>\n              </div>\n              <div className=\"grid grid-cols-3\">\n                <dt className=\"font-medium\">收件地址：</dt>\n                <dd className=\"col-span-2\">{formData.city} {formData.address_1}</dd>\n              </div>\n              <div className=\"grid grid-cols-3\">\n                <dt className=\"font-medium\">郵遞區號：</dt>\n                <dd className=\"col-span-2\">{formData.postal_code}</dd>\n              </div>\n            </dl>\n          </div>\n\n          {/* 修改按鈕 */}\n          <div className=\"mt-4\">\n            <Button \n              type=\"button\"\n              variant=\"secondary\"\n              onClick={() => setIsFormConfirmed(false)}\n              className=\"w-full\"\n            >\n              修改收件資料\n            </Button>\n          </div>\n        </div>\n      ) : (\n        <Button \n          type=\"button\"\n          variant=\"primary\"\n          disabled={isSubmitting}\n          className=\"w-full\"\n          onClick={(e) => {\n            e.preventDefault()\n            handleSubmit(e)\n          }}\n        >\n          確認收件資訊\n        </Button>\n      )}\n    </div>\n  )\n}\n\nexport default DeliveryAddressForm\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/checkout/components/discount-code/index.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Tooltip' is defined but never used.","line":3,"column":46,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":53},{"ruleId":"unused-imports/no-unused-imports","severity":2,"message":"'Tooltip' is defined but never used.","line":3,"column":46,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":53,"fix":{"range":[57,66],"text":""}},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'InformationCircleSolid' is defined but never used.","line":8,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":32},{"ruleId":"unused-imports/no-unused-imports","severity":2,"message":"'InformationCircleSolid' is defined but never used.","line":8,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":32,"fix":{"range":[257,314],"text":""}},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'items' is assigned a value but never used.","line":23,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":16},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'items' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":23,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":16},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":30,"column":70,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":30,"endColumn":77},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":42,"column":19,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":42,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'formAction' is assigned a value but never used.","line":52,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":52,"endColumn":29},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'formAction' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":52,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":52,"endColumn":29}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":2,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { Badge, Heading, Input, Label, Text, Tooltip } from \"@medusajs/ui\"\nimport React, { useActionState } from \"react\";\n\nimport { applyPromotions, submitPromotionForm } from \"@lib/data/cart\"\nimport { convertToLocale } from \"@lib/util/money\"\nimport { InformationCircleSolid } from \"@medusajs/icons\"\nimport { HttpTypes } from \"@medusajs/types\"\nimport Trash from \"@modules/common/icons/trash\"\nimport ErrorMessage from \"../error-message\"\nimport { SubmitButton } from \"../submit-button\"\n\ntype DiscountCodeProps = {\n  cart: HttpTypes.StoreCart & {\n    promotions: HttpTypes.StorePromotion[]\n  }\n}\n\nconst DiscountCode: React.FC<DiscountCodeProps> = ({ cart }) => {\n  const [isOpen, setIsOpen] = React.useState(false)\n\n  const { items = [], promotions = [] } = cart\n  const removePromotionCode = async (code: string) => {\n    const validPromotions = promotions.filter(\n      (promotion) => promotion.code !== code\n    )\n\n    await applyPromotions(\n      validPromotions.filter((p) => p.code === undefined).map((p) => p.code!)\n    )\n  }\n\n  const addPromotionCode = async (formData: FormData) => {\n    const code = formData.get(\"code\")\n    if (!code) {\n      return\n    }\n    const input = document.getElementById(\"promotion-input\") as HTMLInputElement\n    const codes = promotions\n      .filter((p) => p.code === undefined)\n      .map((p) => p.code!)\n    codes.push(code.toString())\n\n    await applyPromotions(codes)\n\n    if (input) {\n      input.value = \"\"\n    }\n  }\n\n  const [message, formAction] = useActionState(submitPromotionForm, null)\n\n  return (\n    <div className=\"w-full bg-white flex flex-col\">\n      <div className=\"txt-medium\">\n        <form action={(a) => addPromotionCode(a)} className=\"w-full mb-5\">\n          <Label className=\"flex gap-x-1 my-2 items-center\">\n            <button\n              onClick={() => setIsOpen(!isOpen)}\n              type=\"button\"\n              className=\"txt-medium text-blue-600 hover:text-blue-600-hover\"\n              data-testid=\"add-discount-button\"\n            >\n              新增優惠代碼\n            </button>\n\n            {/* <Tooltip content=\"You can add multiple promotion codes\">\n              <InformationCircleSolid color=\"var(--fg-muted)\" />\n            </Tooltip> */}\n          </Label>\n\n          {isOpen && (\n            <>\n              <div className=\"flex w-full gap-x-2\">\n                <Input\n                  className=\"size-full\"\n                  id=\"promotion-input\"\n                  name=\"code\"\n                  type=\"text\"\n                  autoFocus={false}\n                  data-testid=\"discount-input\"\n                />\n                <SubmitButton\n                  variant=\"secondary\"\n                  data-testid=\"discount-apply-button\"\n                >\n                  套用\n                </SubmitButton>\n              </div>\n\n              <ErrorMessage\n                error={message}\n                data-testid=\"discount-error-message\"\n              />\n            </>\n          )}\n        </form>\n\n        {promotions.length > 0 && (\n          <div className=\"w-full flex items-center\">\n            <div className=\"flex flex-col w-full\">\n              <Heading className=\"txt-medium mb-2\">\n                已套用的優惠：\n              </Heading>\n\n              {promotions.map((promotion) => {\n                return (\n                  <div\n                    key={promotion.id}\n                    className=\"flex items-center justify-between w-full max-w-full mb-2\"\n                    data-testid=\"discount-row\"\n                  >\n                    <Text className=\"flex gap-x-1 items-baseline txt-small-plus w-4/5 pr-1\">\n                      <span className=\"truncate\" data-testid=\"discount-code\">\n                        <Badge\n                          color={promotion.is_automatic ? \"green\" : \"grey\"}\n                          size=\"small\"\n                        >\n                          {promotion.code}\n                        </Badge>{\" \"}\n                        (\n                        {promotion.application_method?.value !== undefined &&\n                          promotion.application_method.currency_code !==\n                            undefined && (\n                            <>\n                              {promotion.application_method.type ===\n                              \"percentage\"\n                                ? `${promotion.application_method.value}%`\n                                : convertToLocale({\n                                    amount: Number(promotion.application_method.value),\n                                    currency_code:\n                                      promotion.application_method\n                                        .currency_code,\n                                  })}\n                            </>\n                          )}\n                        )\n                        {/* {promotion.is_automatic && (\n                          <Tooltip content=\"This promotion is automatically applied\">\n                            <InformationCircleSolid className=\"inline text-zinc-400\" />\n                          </Tooltip>\n                        )} */}\n                      </span>\n                    </Text>\n                    {!promotion.is_automatic && (\n                      <button\n                        className=\"flex items-center\"\n                        onClick={() => {\n                          if (!promotion.code) {\n                            return\n                          }\n\n                          removePromotionCode(promotion.code)\n                        }}\n                        data-testid=\"remove-discount-button\"\n                      >\n                        <Trash size={14} />\n                        <span className=\"sr-only\">\n                          從訂單中移除折扣碼\n                        </span>\n                      </button>\n                    )}\n                  </div>\n                )\n              })}\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  )\n}\n\nexport default DiscountCode\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/checkout/components/ecpay-payment/index.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":17,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[374,377],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[374,377],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'selectedStore' is assigned a value but never used.","line":27,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":23},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'selectedStore' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":27,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'setSelectedStore' is assigned a value but never used.","line":27,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":41},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'setSelectedStore' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":27,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":41},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is assigned a value but never used.","line":28,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":28,"endColumn":15},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'error' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":28,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":28,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":32,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[823,826],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[823,826],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":32,"column":67,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":32,"endColumn":69,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[876,878],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":47,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1261,1264],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1261,1264],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":49,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":49,"endColumn":20,"suggestions":[{"fix":{"range":[1302,1333],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { RadioGroup } from \"@headlessui/react\"\nimport { useState } from \"react\"\nimport { Heading, Text, clx } from \"@medusajs/ui\"\nimport { CheckCircleSolid, CreditCard } from \"@medusajs/icons\"\n\ntype ConvenienceStore = {\n  id: string\n  name: string\n  address: string\n  distance: number\n  type: '7-11' | '全家' | 'OK' | '萊爾富'\n}\n\ntype EcpayPaymentProps = {\n  cart: any\n  onPaymentMethodChange: (method: string) => void\n  selectedPaymentMethod: string\n}\n\nconst EcpayPayment: React.FC<EcpayPaymentProps> = ({\n  cart,\n  onPaymentMethodChange,\n  selectedPaymentMethod\n}) => {\n  const [selectedStore, setSelectedStore] = useState<ConvenienceStore | null>(null)\n  const [error, setError] = useState<string | null>(null)\n  \n  // 檢查是否選擇了超商配送\n  const isConvenienceStoreDelivery = cart?.shipping_methods?.some(\n    (method: any) => method.shipping_option?.name?.includes(\"超商\") || \n                     method.shipping_option?.name?.includes(\"便利商店\")\n  )\n\n  // 處理支付方式變更\n  const handlePaymentMethodChange = (method: string) => {\n    setError(null)\n    \n    try {\n      // 驗證選擇\n      if (method === 'ecpay_store_payment' && !isConvenienceStoreDelivery) {\n        throw new Error('超商取貨付款僅適用於超商取貨')\n      }\n      \n      onPaymentMethodChange(method)\n    } catch (err: any) {\n      setError(err.message)\n      console.error('支付方式變更錯誤:', err)\n    }\n  }\n\n  const paymentOptions = [\n    {\n      id: \"ecpay_credit_card\",\n      name: \"綠界刷卡\",\n      description: \"信用卡 / 金融卡 (VISA、Mastercard、JCB)\",\n      icon: <CreditCard className=\"w-5 h-5\" />,\n      available: true\n    },\n    {\n      id: \"ecpay_bank_transfer\",\n      name: \"銀行轉帳\",\n      description: \"手動銀行轉帳 (需要人工核帳)\",\n      icon: <div className=\"w-5 h-5 bg-blue-500 rounded flex items-center justify-center text-white text-xs font-bold\">銀</div>,\n      available: true\n    }\n  ]\n\n  return (\n    <div className=\"mb-6\">\n      <Heading level=\"h3\" className=\"text-base font-medium mb-4\">\n        綠界支付\n      </Heading>\n      <div className=\"grid grid-cols-1 gap-3\">\n        <RadioGroup \n          value={selectedPaymentMethod} \n          onChange={handlePaymentMethodChange}\n        >\n          <div className=\"space-y-3\">\n            {paymentOptions.map((option) => (\n              <RadioGroup.Option\n                key={option.id}\n                value={option.id}\n                disabled={!option.available}\n              >\n                {({ checked, disabled }) => (\n                  <div \n                    className={clx(\n                      \"relative flex cursor-pointer rounded-lg p-4 focus:outline-none border-2\",\n                      {\n                        \"cursor-not-allowed opacity-50\": disabled,\n                      }\n                    )}\n                    style={{\n                      backgroundColor: checked && !disabled ? \"var(--bg-secondary)\" : \"var(--bg-primary)\",\n                      borderColor: checked && !disabled ? \"var(--color-primary)\" : \n                                 disabled ? \"var(--border-secondary)\" : \"var(--border-primary)\"\n                    }}\n                  >\n                    <div className=\"flex w-full items-center justify-between\">\n                      <div className=\"flex items-center gap-3\">\n                        <div className={clx(\n                          \"flex items-center justify-center\",\n                          disabled ? \"text-gray-400\" : \"text-gray-700\"\n                        )}>\n                          {option.icon}\n                        </div>\n                        <div>\n                          <Text className={clx(\n                            \"font-medium\",\n                            disabled ? \"text-gray-400\" : \"text-gray-900\"\n                          )}>\n                            {option.name}\n                          </Text>\n                          <Text className={clx(\n                            \"text-sm mt-1\",\n                            disabled ? \"text-gray-400\" : \"text-gray-600\"\n                          )}>\n                            {option.description}\n                          </Text>\n                          {!option.available && option.id === \"ecpay_store_payment\" && (\n                            <Text className=\"text-xs text-orange-600 mt-1\">\n                              ※ 請先選擇超商取貨配送方式\n                            </Text>\n                          )}\n                        </div>\n                      </div>\n                      {checked && !disabled && (\n                        <CheckCircleSolid className=\"w-5 h-5\" style={{ color: \"var(--color-primary)\" }} />\n                      )}\n                    </div>\n                  </div>\n                )}\n              </RadioGroup.Option>\n            ))}\n          </div>\n        </RadioGroup>\n      </div>\n\n      {/* 如果選擇超商付款且是超商配送，顯示門市選擇 */}\n      {selectedPaymentMethod === \"ecpay_store_payment\" && isConvenienceStoreDelivery && (\n        <div className=\"mt-4 p-4 border border-gray-200 rounded-lg bg-gray-50\">\n          <Text className=\"text-sm mb-2\">請確認您選擇的便利商店與收件門市相同</Text>\n        </div>\n      )}\n      \n      {/* 信用卡說明 */}\n      {selectedPaymentMethod === \"ecpay_credit_card\" && (\n        <div className=\"mt-4 p-4 border border-gray-200 rounded-lg bg-gray-50\">\n          <Text className=\"text-sm mb-2\">信用卡付款說明：</Text>\n          <Text className=\"text-xs text-gray-600\">\n            訂單成立後，系統將帶您前往綠界支付頁面完成付款程序。\n          </Text>\n        </div>\n      )}\n      \n      {/* 超商付款說明 */}\n      {selectedPaymentMethod === \"ecpay_store_payment\" && (\n        <div className=\"mt-4 p-4 border border-gray-200 rounded-lg bg-gray-50\">\n          <Text className=\"text-sm mb-2\">超商付款說明：</Text>\n          <Text className=\"text-xs text-gray-600\">\n            訂單成立後，系統將產生付款代碼，請於繳費期限內至超商繳款。\n            超商付款需支付額外手續費。\n          </Text>\n        </div>\n      )}\n    </div>\n  )\n}\n\nexport default EcpayPayment\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/checkout/components/ecpay-store-map/index.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":10,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[285,288],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[285,288],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":11,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[321,324],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[321,324],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'hasSelection' is assigned a value but never used.","line":19,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":22},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'hasSelection' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":19,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":22},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":46,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":46,"endColumn":18,"suggestions":[{"fix":{"range":[1125,1155],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":49,"column":37,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":49,"endColumn":39,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1220,1222],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":50,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1275,1278],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1275,1278],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":50,"column":80,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":50,"endColumn":82,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1306,1308],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":64,"column":35,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":64,"endColumn":37,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1894,1896],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":65,"column":43,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":65,"endColumn":45,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1952,1954],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":67,"column":71,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":67,"endColumn":73,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2050,2052],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":68,"column":61,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":68,"endColumn":63,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2171,2173],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":71,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":71,"endColumn":18,"suggestions":[{"fix":{"range":[2250,2290],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":81,"column":43,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":81,"endColumn":45,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2614,2616],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":87,"column":11,"nodeType":null,"messageId":"preferOptionalChain","endLine":87,"endColumn":59,"suggestions":[{"fix":{"range":[2736,2784],"text":"contentType?.includes('text/html')"},"messageId":"optionalChainSuggest","desc":"Change to an optional chain."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":105,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":105,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3421,3424],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3421,3424],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":105,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":105,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3455,3458],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3455,3458],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":106,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":106,"endColumn":24,"suggestions":[{"fix":{"range":[3477,3509],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":142,"column":17,"nodeType":null,"messageId":"preferOptionalChain","endLine":142,"endColumn":71,"fix":{"range":[4902,4956],"text":"event.data?.type === 'LOGISTICS_SELECTED'"}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":143,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":143,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4986,4989],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4986,4989],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":152,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":152,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5280,5283],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5280,5283],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":161,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":161,"endColumn":20,"suggestions":[{"fix":{"range":[5512,5549],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":171,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":171,"endColumn":20,"suggestions":[{"fix":{"range":[5740,5777],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":11,"fatalErrorCount":0,"warningCount":12,"fixableErrorCount":1,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { useState, useEffect } from \"react\"\nimport { Button } from \"@medusajs/ui\"\nimport { MapPin } from \"@medusajs/icons\"\nimport { toast } from \"react-hot-toast\"\nimport LogisticsSelectionDisplay from \"../logistics-selection-display\"\n\ntype EcpayStoreMapProps = {\n  cart: any\n  onStoreSelected?: (storeInfo: any) => void\n}\n\nconst EcpayStoreMap: React.FC<EcpayStoreMapProps> = ({ \n  cart, \n  onStoreSelected \n}) => {\n  const [isLoading, setIsLoading] = useState(false)\n  const [hasSelection, setHasSelection] = useState(false)\n\n  // 檢查是否已有物流選擇\n  useEffect(() => {\n    const checkLogisticsSelection = () => {\n      const saved = localStorage.getItem('ecpay_logistics_selection')\n      setHasSelection(!!saved)\n    }\n\n    checkLogisticsSelection()\n\n    // 監聽物流選擇更新\n    const handleUpdate = () => {\n      checkLogisticsSelection()\n    }\n\n    window.addEventListener('logistics-selection-updated', handleUpdate)\n    \n    return () => {\n      window.removeEventListener('logistics-selection-updated', handleUpdate)\n    }\n  }, [])\n\n  const handleOpenStoreMap = async () => {\n    setIsLoading(true)\n    \n    try {\n      console.log('� 開啟綠界物流選擇頁面...')\n      \n      // 從購物車中取得商品資訊\n      const cartTotal = cart?.total || 500\n      const goodsName = cart?.items?.map((item: any) => item.title).join(', ') || '購物車商品'\n      \n      // 準備物流選擇參數\n      const logisticsParams = {\n        goodsAmount: Math.min(Math.max(cartTotal, 1), 20000), // 確保在1-20000範圍內\n        goodsName: goodsName.length > 50 ? goodsName.substring(0, 47) + '...' : goodsName,\n        senderName: '商店名稱', // 可以從設定中取得\n        senderZipCode: '100',\n        senderAddress: '台北市中正區重慶南路一段122號', // 可以從設定中取得\n        isCollection: 'N', // 是否代收貨款\n        temperature: '0001', // 常溫\n        specification: '0001', // 60cm\n        scheduledPickupTime: '4', // 不限時\n        enableSelectDeliveryTime: 'N',\n        remark: `訂單編號: ${cart?.id || 'Unknown'}`,\n        eshopMemberID: cart?.customer?.id || '',\n        // 必要的回調 URL\n        serverReplyURL: `${process.env.NEXT_PUBLIC_MEDUSA_BACKEND_URL || 'http://localhost:9000'}/store/ecpay/logistics-callback`,\n        clientReplyURL: `${process.env.NEXT_PUBLIC_BASE_URL || 'http://localhost:8000'}/api/ecpay/logistics/callback`\n      }\n      \n      console.log('📦 物流參數:', logisticsParams)\n      \n      const response = await fetch('/api/ecpay/express-map', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(logisticsParams)\n      })\n\n      if (!response.ok) {\n        const errorData = await response.json()\n        throw new Error(errorData.message || '無法開啟物流選擇頁面')\n      }\n\n      // 檢查回應類型\n      const contentType = response.headers.get('content-type')\n      \n      if (contentType && contentType.includes('text/html')) {\n        // HTML 回應 - 在新視窗開啟物流選擇頁面\n        const html = await response.text()\n        const logisticsWindow = window.open('', '_blank', 'width=900,height=700,scrollbars=yes,resizable=yes')\n        \n        if (logisticsWindow) {\n          logisticsWindow.document.write(html)\n          logisticsWindow.document.close()\n          \n          // 監聽物流選擇完成事件\n          const checkClosed = setInterval(() => {\n            if (logisticsWindow.closed) {\n              clearInterval(checkClosed)\n              toast.success('物流選擇視窗已關閉，請檢查是否已完成選擇')\n            }\n          }, 1000)\n          \n          // 設置全域回調函數來接收選擇結果\n          ;(window as any).onLogisticsSelected = (data: any) => {\n            console.log('✅ 收到物流選擇結果:', data)\n            \n            // 儲存物流選擇資訊到 localStorage\n            if (data.tempLogisticsID) {\n              const logisticsInfo = {\n                tempLogisticsID: data.tempLogisticsID,\n                logisticsType: data.logisticsType,\n                logisticsSubType: data.logisticsSubType,\n                receiverName: data.receiverName,\n                receiverPhone: data.receiverPhone,\n                receiverCellPhone: data.receiverCellPhone,\n                receiverAddress: data.receiverAddress,\n                receiverStoreID: data.receiverStoreID,\n                receiverStoreName: data.receiverStoreName,\n                selectedAt: data.selectedAt\n              }\n              \n              localStorage.setItem('ecpay_logistics_selection', JSON.stringify(logisticsInfo))\n              \n              // 觸發更新事件\n              window.dispatchEvent(new CustomEvent('logistics-selection-updated'))\n              \n              // 通知父組件\n              onStoreSelected?.(logisticsInfo)\n              \n              // 顯示成功訊息\n              const storeText = data.receiverStoreName ? \n                `已選擇：${data.receiverStoreName}` : \n                `已完成物流選擇 (${data.logisticsSubType})`\n              \n              toast.success(storeText)\n            }\n          }\n          \n          // 監聽 PostMessage\n          const handleMessage = (event: MessageEvent) => {\n            if (event.data && event.data.type === 'LOGISTICS_SELECTED') {\n              ;(window as any).onLogisticsSelected?.(event.data.data)\n            }\n          }\n          \n          window.addEventListener('message', handleMessage)\n          \n          // 清理函數\n          setTimeout(() => {\n            window.removeEventListener('message', handleMessage)\n            delete (window as any).onLogisticsSelected\n          }, 300000) // 5分鐘後清理\n          \n        } else {\n          throw new Error('無法開啟物流選擇視窗，請檢查瀏覽器彈窗設定')\n        }\n      } else {\n        // JSON 回應\n        const result = await response.json()\n        console.log('✅ 物流選擇 API 回應:', result)\n        \n        if (result.success) {\n          toast.success('物流選擇頁面已準備完成')\n        } else {\n          throw new Error(result.message)\n        }\n      }\n      \n    } catch (error) {\n      console.error('❌ 開啟物流選擇頁面失敗:', error)\n      toast.error(error instanceof Error ? error.message : '開啟物流選擇頁面失敗')\n    } finally {\n      setIsLoading(false)\n    }\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      {/* 顯示物流選擇結果 */}\n      <LogisticsSelectionDisplay />\n      \n      <div className=\"p-4 border rounded-lg\" style={{ \n        backgroundColor: \"var(--bg-secondary)\", \n        borderColor: \"var(--border-primary)\" \n      }}>\n        <h4 className=\"font-medium mb-2\" style={{ color: \"var(--text-primary)\" }}>\n          超商取貨門市選擇\n        </h4>\n        <p className=\"text-sm mb-4\" style={{ color: \"var(--text-secondary)\" }}>\n          點擊下方按鈕開啟綠界超商選擇頁面，可選擇 7-11、全家、萊爾富等超商門市\n        </p>\n        \n        <Button\n          onClick={handleOpenStoreMap}\n          disabled={isLoading}\n          className=\"w-full flex items-center gap-2\"\n          variant=\"secondary\"\n        >\n          <MapPin className=\"w-4 h-4\" />\n          {isLoading ? '開啟中...' : '選擇超商門市'}\n        </Button>\n      </div>\n      \n      {/* 使用說明 */}\n      <div className=\"text-xs space-y-1\" style={{ color: \"var(--text-tertiary)\" }}>\n        <div>• 點擊「選擇超商門市」會開啟綠界官方超商選擇頁面</div>\n        <div>• 可選擇 7-11、全家、萊爾富等超商門市</div>\n        <div>• 可進一步選擇指定門市位置</div>\n        <div>• 選擇完成後關閉視窗即可繼續結帳流程</div>\n      </div>\n    </div>\n  )\n}\n\nexport default EcpayStoreMap\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/checkout/components/error-message/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/checkout/components/logistics-selection-display/index.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":11,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[345,348],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[345,348],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":22,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":22,"endColumn":24,"suggestions":[{"fix":{"range":[663,698],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":117,"column":45,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":117,"endColumn":47,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3669,3671],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":120,"column":52,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":120,"endColumn":54,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3824,3826],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport React, { useState, useEffect } from 'react'\nimport { CheckCircleSolid, XMarkMini } from \"@medusajs/icons\"\n\ninterface LogisticsSelectionDisplayProps {\n  onClear?: () => void\n}\n\nconst LogisticsSelectionDisplay: React.FC<LogisticsSelectionDisplayProps> = ({ onClear }) => {\n  const [logisticsInfo, setLogisticsInfo] = useState<any>(null)\n\n  useEffect(() => {\n    // 從 localStorage 讀取物流選擇資訊\n    const loadLogisticsInfo = () => {\n      const saved = localStorage.getItem('ecpay_logistics_selection')\n      if (saved) {\n        try {\n          const parsed = JSON.parse(saved)\n          setLogisticsInfo(parsed)\n        } catch (error) {\n          console.error('解析物流選擇資訊失敗:', error)\n        }\n      }\n    }\n\n    // 初始載入\n    loadLogisticsInfo()\n\n    // 監聽 localStorage 變化\n    const handleStorageChange = (e: StorageEvent) => {\n      if (e.key === 'ecpay_logistics_selection') {\n        loadLogisticsInfo()\n      }\n    }\n\n    window.addEventListener('storage', handleStorageChange)\n    \n    // 也監聽自定義事件（同一頁面內的更新）\n    const handleCustomEvent = () => {\n      loadLogisticsInfo()\n    }\n    \n    window.addEventListener('logistics-selection-updated', handleCustomEvent)\n\n    return () => {\n      window.removeEventListener('storage', handleStorageChange)\n      window.removeEventListener('logistics-selection-updated', handleCustomEvent)\n    }\n  }, [])\n\n  const handleClear = () => {\n    localStorage.removeItem('ecpay_logistics_selection')\n    setLogisticsInfo(null)\n    onClear?.()\n    \n    // 觸發自定義事件\n    window.dispatchEvent(new CustomEvent('logistics-selection-updated'))\n  }\n\n  const getLogisticsTypeText = (logisticsType: string, logisticsSubType: string) => {\n    if (logisticsType === 'CVS') {\n      if (logisticsSubType.includes('UNIMART')) return '7-ELEVEN 超商取貨'\n      if (logisticsSubType.includes('FAMI')) return '全家便利商店取貨'\n      if (logisticsSubType.includes('HILIFE')) return '萊爾富便利商店取貨'\n      if (logisticsSubType.includes('OKMART')) return 'OK超商取貨'\n      return '便利商店取貨'\n    } else if (logisticsType === 'HOME') {\n      return '宅配到府'\n    }\n    return logisticsSubType\n  }\n\n  if (!logisticsInfo) {\n    return null\n  }\n\n  return (\n    <div className=\"p-4 border rounded-lg bg-green-50 border-green-200\">\n      <div className=\"flex items-start justify-between\">\n        <div className=\"flex items-start gap-3 flex-1\">\n          <CheckCircleSolid className=\"w-5 h-5 text-green-600 mt-0.5 flex-shrink-0\" />\n          \n          <div className=\"flex-1\">\n            <h4 className=\"font-medium text-green-800 mb-2\">\n              已選擇物流方式\n            </h4>\n            \n            <div className=\"space-y-2 text-sm text-green-700\">\n              <div>\n                <strong>配送方式：</strong>\n                {getLogisticsTypeText(logisticsInfo.logisticsType, logisticsInfo.logisticsSubType)}\n              </div>\n              \n              {logisticsInfo.receiverStoreName && (\n                <div>\n                  <strong>取貨門市：</strong>\n                  {logisticsInfo.receiverStoreName}\n                  {logisticsInfo.receiverStoreID && ` (${logisticsInfo.receiverStoreID})`}\n                </div>\n              )}\n              \n              {logisticsInfo.receiverName && (\n                <div>\n                  <strong>收件人：</strong>\n                  {logisticsInfo.receiverName}\n                </div>\n              )}\n              \n              {logisticsInfo.receiverAddress && !logisticsInfo.receiverStoreName && (\n                <div>\n                  <strong>收件地址：</strong>\n                  {logisticsInfo.receiverAddress}\n                </div>\n              )}\n              \n              {(logisticsInfo.receiverPhone || logisticsInfo.receiverCellPhone) && (\n                <div>\n                  <strong>聯絡電話：</strong>\n                  {logisticsInfo.receiverCellPhone || logisticsInfo.receiverPhone}\n                </div>\n              )}\n              \n              {logisticsInfo.tempLogisticsID && (\n                <div className=\"text-xs opacity-75\">\n                  物流訂單編號：{logisticsInfo.tempLogisticsID}\n                </div>\n              )}\n            </div>\n          </div>\n        </div>\n        \n        <button\n          onClick={handleClear}\n          className=\"p-1 hover:bg-green-100 rounded-full transition-colors\"\n          title=\"重新選擇\"\n        >\n          <XMarkMini className=\"w-4 h-4 text-green-600\" />\n        </button>\n      </div>\n    </div>\n  )\n}\n\nexport default LogisticsSelectionDisplay\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/checkout/components/order-confirmed/index.tsx","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":16,"column":3,"nodeType":"MemberExpression","messageId":"unexpected","endLine":16,"endColumn":14,"suggestions":[{"fix":{"range":[704,749],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":28,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":28,"endColumn":20,"suggestions":[{"fix":{"range":[997,1053],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":33,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":33,"endColumn":16,"suggestions":[{"fix":{"range":[1184,1225],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":35,"column":23,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":35,"endColumn":25,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1253,1255],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":37,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":37,"endColumn":18,"suggestions":[{"fix":{"range":[1285,1325],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":50,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":50,"endColumn":18,"suggestions":[{"fix":{"range":[1634,1675],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":51,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":51,"endColumn":18,"suggestions":[{"fix":{"range":[1682,1721],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":54,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":54,"endColumn":22,"suggestions":[{"fix":{"range":[1811,1848],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":57,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":57,"endColumn":24,"suggestions":[{"fix":{"range":[1920,1945],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":59,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":59,"endColumn":26,"suggestions":[{"fix":{"range":[1977,2017],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":62,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2064,2067],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2064,2067],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":63,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":63,"endColumn":24,"suggestions":[{"fix":{"range":[2084,2119],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":64,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":64,"endColumn":24,"suggestions":[{"fix":{"range":[2130,2182],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":67,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":67,"endColumn":22,"suggestions":[{"fix":{"range":[2229,2282],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":71,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":71,"endColumn":18,"suggestions":[{"fix":{"range":[2341,2376],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":72,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":72,"endColumn":18,"suggestions":[{"fix":{"range":[2383,2443],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":15,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { useSearchParams } from \"next/navigation\"\nimport { useEffect, useState } from \"react\"\nimport type { HttpTypes } from \"@medusajs/types\"\nimport { Heading } from \"@medusajs/ui\"\nimport CartTotals from \"../../../common/components/cart-totals/index\"\nimport Help from \"../../../order/components/help/index\"\nimport Items from \"../../../order/components/items/index\"\nimport OrderDetails from \"../../../order/components/order-details/index\"\nimport ShippingDetails from \"../../../order/components/shipping-details/index\"\nimport PaymentDetails from \"../../../order/components/payment-details/index\"\n\n// 客戶端訂單獲取函數\nconst fetchOrder = async (orderId: string): Promise<HttpTypes.StoreOrder> => {\n  console.log(\"🔍 fetchOrder 開始獲取訂單:\", orderId)\n  \n  try {\n    const response = await fetch(`/api/orders/${orderId}`, {\n      method: \"GET\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n    })\n\n    if (!response.ok) {\n      const errorText = await response.text()\n      console.error(\"❌ API 響應錯誤:\", response.status, errorText)\n      throw new Error(`Failed to fetch order: ${response.status} ${errorText}`)\n    }\n\n    const data = await response.json()\n    console.log(\"✅ fetchOrder 成功獲取訂單:\", data)\n    \n    return data.order || data\n  } catch (error) {\n    console.error(\"❌ fetchOrder 錯誤:\", error)\n    throw error\n  }\n}\n\nconst OrderConfirmed = () => {\n  const searchParams = useSearchParams()\n  const orderId = searchParams?.get(\"order_id\")\n  const [order, setOrder] = useState<HttpTypes.StoreOrder | null>(null)\n  const [loading, setLoading] = useState(true)\n\n  useEffect(() => {\n    if (orderId) {\n      console.log(\"🎉 載入訂單確認頁面，訂單ID:\", orderId)\n      console.log(\"🔍 開始呼叫 retrieveOrder...\")\n      fetchOrder(orderId)\n        .then((orderData: HttpTypes.StoreOrder) => {\n          console.log(\"✅ 訂單資料載入成功:\", orderData)\n          if (orderData) {\n            setOrder(orderData)\n            console.log(\"✅ 訂單狀態設置完成\")\n          } else {\n            console.error(\"❌ retrieveOrder 返回了空的資料\")\n          }\n        })\n        .catch((error: any) => {\n          console.error(\"❌ 載入訂單資料失敗:\", error)\n          console.error(\"❌ 錯誤詳情:\", error.message, error.stack)\n        })\n        .finally(() => {\n          console.log(\"🏁 retrieveOrder 完成，設置 loading = false\")\n          setLoading(false)\n        })\n    } else {\n      console.log(\"⚠️ 沒有訂單ID，無法載入訂單確認頁面\")\n      console.log(\"🔍 當前 searchParams:\", searchParams?.toString())\n      setLoading(false)\n    }\n  }, [orderId, searchParams])\n\n  if (loading) {\n    return (\n      <div className=\"flex flex-col gap-4 animate-pulse\">\n        <div className=\"h-8 bg-gray-200 rounded\"></div>\n        <div className=\"h-4 bg-gray-200 rounded w-3/4\"></div>\n        <div className=\"h-20 bg-gray-200 rounded\"></div>\n      </div>\n    )\n  }\n\n  if (!order) {\n    return (\n      <div className=\"text-center py-8\">\n        <h2 className=\"text-xl font-semibold text-red-600 mb-2\">無法載入訂單資訊</h2>\n        <p className=\"text-gray-600\">\n          {orderId ? \n            `訂單ID: ${orderId} - 請檢查訂單是否存在，或稍後再試。` : \n            \"沒有提供訂單ID，無法載入訂單資訊。\"\n          }\n        </p>\n        <div className=\"mt-4 text-sm text-gray-500\">\n          <p>目前URL參數: {searchParams?.toString()}</p>\n        </div>\n      </div>\n    )\n  }\n\n  // 直接複製 OrderCompletedTemplate 的內容，但移除服務器端功能\n  return (\n    <div className=\"py-6 min-h-[calc(100vh-64px)]\">\n      <div className=\"content-container flex flex-col justify-center items-center gap-y-10 max-w-4xl h-full w-full\">\n        <div\n          className=\"flex flex-col gap-4 max-w-4xl h-full bg-white w-full py-10\"\n          data-testid=\"order-complete-container\"\n        >\n          <Heading\n            level=\"h1\"\n            className=\"flex flex-col gap-y-3 text-ui-fg-base text-3xl mb-4\"\n          >\n            <span>謝謝您！</span>\n            <span>您的訂單已成功提交。</span>\n          </Heading>\n          <OrderDetails order={order} />\n          <Heading level=\"h2\" className=\"flex flex-row text-3xl-regular\">\n            摘要\n          </Heading>\n          <Items order={order} />\n          <CartTotals totals={order} />\n          <ShippingDetails order={order} />\n          <PaymentDetails order={order} />\n          <Help />\n        </div>\n      </div>\n    </div>\n  )\n}\n\nexport default OrderConfirmed\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/checkout/components/payment-button/banktransferpaymentbutton.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'cart' is defined but never used.","line":15,"column":38,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":42},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'cart' is defined but never used. Allowed unused args must match /^_/u.","line":15,"column":38,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":42},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":24,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":24,"endColumn":18,"suggestions":[{"fix":{"range":[674,708],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":27,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[792,795],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[792,795],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":28,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":28,"endColumn":20,"suggestions":[{"fix":{"range":[805,838],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { useState } from \"react\"\nimport { Button } from \"@medusajs/ui\"\nimport ErrorMessage from \"../error-message\"\nimport { HttpTypes } from \"@medusajs/types\"\nimport { placeOrder } from \"@lib/data/cart\"\n\ntype Props = {\n  cart: HttpTypes.StoreCart\n  notReady: boolean\n  \"data-testid\"?: string\n}\n\nconst BankTransferPaymentButton = ({ cart, notReady, \"data-testid\": dataTestId }: Props) => {\n  const [submitting, setSubmitting] = useState(false)\n  const [errorMessage, setErrorMessage] = useState<string | null>(null)\n\n  const handlePayment = async () => {\n    setSubmitting(true)\n    setErrorMessage(null)\n    try {\n      const result = await placeOrder()\n      console.log(\"銀行轉帳訂單建立成功:\", result)\n      // placeOrder 成功會自動跳轉到 order confirmed 頁面\n      // 不需要手動跳轉\n    } catch (err: any) {\n      console.error(\"銀行轉帳訂單建立失敗:\", err)\n      // 嘗試顯示更詳細的錯誤內容\n      if (err?.response) {\n        // 若有 response 物件（如 axios），顯示 response.data\n        //setErrorMessage(JSON.stringify(err.response.data));\n      } else if (err?.message) {\n        //setErrorMessage(err.message);\n      } else {\n        setErrorMessage(\"建立訂單失敗\");\n      }\n    } finally {\n      setSubmitting(false)\n    }\n  }\n\n  return (\n    <>\n      <Button\n        disabled={notReady}\n        onClick={handlePayment}\n        size=\"large\"\n        isLoading={submitting}\n        data-testid={dataTestId}\n      >\n        {submitting ? \"處理中...\" : \"確認訂單\"}\n      </Button>\n      <ErrorMessage\n        error={errorMessage}\n        data-testid=\"bank-transfer-payment-error-message\"\n      />\n    </>\n  )\n}\n\nexport default BankTransferPaymentButton\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/checkout/components/payment-button/ecpaypaymentbutton.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'useMemo' is defined but never used.","line":1,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":34},{"ruleId":"unused-imports/no-unused-imports","severity":2,"message":"'useMemo' is defined but never used.","line":1,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":34,"fix":{"range":[24,33],"text":""}},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ErrorMessage' is defined but never used.","line":3,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":20},{"ruleId":"unused-imports/no-unused-imports","severity":2,"message":"'ErrorMessage' is defined but never used.","line":3,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":20,"fix":{"range":[87,131],"text":""}},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'placeOrder' is defined but never used.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":20},{"ruleId":"unused-imports/no-unused-imports","severity":2,"message":"'placeOrder' is defined but never used.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":20,"fix":{"range":[175,219],"text":""}},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'de' is defined but never used.","line":7,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":12},{"ruleId":"unused-imports/no-unused-imports","severity":2,"message":"'de' is defined but never used.","line":7,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":12,"fix":{"range":[289,293],"text":""}},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'id' is defined but never used.","line":7,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":16},{"ruleId":"unused-imports/no-unused-imports","severity":2,"message":"'id' is defined but never used.","line":7,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":16,"fix":{"range":[292,296],"text":""}},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":33,"column":3,"nodeType":"MemberExpression","messageId":"unexpected","endLine":33,"endColumn":14,"suggestions":[{"fix":{"range":[943,1000],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'setSubmitting' is assigned a value but never used.","line":35,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":35,"endColumn":35},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'setSubmitting' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":35,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":35,"endColumn":35},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":44,"column":92,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":44,"endColumn":94,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1385,1387],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":47,"column":61,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":47,"endColumn":63,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1476,1478],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":50,"column":62,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":50,"endColumn":64,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1651,1653],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":54,"column":64,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":54,"endColumn":66,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1757,1759],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":57,"column":58,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":57,"endColumn":60,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1835,1837],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":60,"column":56,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":60,"endColumn":58,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1910,1912],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"prefer-const","severity":2,"message":"'paymentData' is never reassigned. Use 'const' instead.","line":83,"column":7,"nodeType":"Identifier","messageId":"useConst","endLine":83,"endColumn":31,"fix":{"range":[2364,2413],"text":"const paymentData: PaymentData = new PaymentData();"}},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":127,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":127,"endColumn":16,"suggestions":[{"fix":{"range":[3262,3303],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":144,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":144,"endColumn":24,"suggestions":[{"fix":{"range":[3533,3558],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":147,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":147,"endColumn":22,"suggestions":[{"fix":{"range":[3628,3670],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":149,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":149,"endColumn":22,"suggestions":[{"fix":{"range":[3682,3722],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":198,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":198,"endColumn":18,"suggestions":[{"fix":{"range":[4881,4915],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-alert","severity":2,"message":"Unexpected alert.","line":199,"column":7,"nodeType":"CallExpression","messageId":"unexpected","endLine":199,"endColumn":26},{"ruleId":"sonarjs/no-redundant-jump","severity":2,"message":"Remove this redundant jump.","line":205,"column":5,"nodeType":"ReturnStatement","messageId":"removeRedundantJump","endLine":205,"endColumn":11,"suggestions":[{"messageId":"suggestJumpRemoval","fix":{"range":[4947,4966],"text":""},"desc":"Remove this redundant jump"}]}],"suppressedMessages":[],"errorCount":21,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":6,"fixableWarningCount":0,"source":"import React, { useState, useMemo } from \"react\"\nimport { Button } from \"@medusajs/ui\"\nimport ErrorMessage from \"../error-message\"\nimport { HttpTypes } from \"@medusajs/types\"\nimport { placeOrder } from \"@lib/data/cart\"\nimport { PaymentData } from \"../../../../internal/ecpayments\"\nimport { de, id } from \"date-fns/locale\"\nimport {sdk} from \"@lib/config\";\nimport { removeCartIdClient } from \"@/lib/data/cart-storage\"\n\ntype Props = {\n  cart: HttpTypes.StoreCart\n  notReady: boolean\n  \"data-testid\"?: string\n}\n\nconst ECPayPaymentButton: React.FC<Props> = ({ cart, notReady, \"data-testid\": dataTestId }) => {\n    \n  const action:string = \"ECPayPaymentButton\"\n\n  let defaultError:string | null = null\n\n  const paymentSessions = cart.payment_collection?.payment_sessions\n\n  let paymentSessionID = \"\"\n\n  if (!paymentSessions || paymentSessions.length === 0){\n    defaultError = \"尚未建立支付會話\"\n  }else{\n    paymentSessionID = paymentSessions[0].id\n  }\n\n  console.log(action,\"payment session id\",paymentSessionID)\n\n  const [submitting, setSubmitting] = useState(false)\n  let errorMessage: string|null = defaultError\n  // const [errorMessage, setErrorMessage] = useState<string | null>(defaultError)\n\n\n  // 計算總金額（轉換為整數，ECPay 不接受小數）\n  const totalAmount = Math.round(cart.total || 0)\n\n  // 商品名稱（取購物車商品名稱，限制長度）\n  const itemName = cart.items?.map(item => item.product_title).join(',').substring(0, 200) || '購物車商品'\n\n  // ecpay API URL\n  const ecpayAPI = process.env.NEXT_PUBLIC_ECPAY_ACTION_URL || \"https://payment-stage.ecpay.com.tw/Cashier/AioCheckOut/V5\"\n\n  // ecpay在完成付款後callback的網址，這裡要指向medusa ecpay 轉換器\n  const returnURL = process.env.NEXT_PUBLIC_ECPAY_RETURN_URL || \"\"\n  // const returnURL = \"\"\n\n  // 特店代號\n  const merchantID = process.env.NEXT_PUBLIC_ECPAY_MERCHANT_ID || \"\"\n\n  // hash key\n  const hashKey = process.env.NEXT_PUBLIC_ECPAY_HASH_KEY || \"\"\n\n  // hash iv\n  const hashIV = process.env.NEXT_PUBLIC_ECPAY_HASH_IV || \"\"\n\n  if (returnURL === \"\"){\n    errorMessage = \"missing ECPay return URL\"\n    // setErrorMessage(\"missing ECPay return URL\")\n  }\n\n  if (merchantID === \"\"){\n    errorMessage = \"missing ECPay merchant ID\"\n  }\n\n  if (hashKey === \"\"){\n    errorMessage = \"missing ECPay hash key\"\n  }\n\n  if (hashIV === \"\"){\n    errorMessage = \"missing ECPay hash iv\"\n  }\n\n  \n\n  const tradeNo = Array.from({ length: 20 }, () => Math.floor(Math.random() * 10)).join(\"\");\n\n  let paymentData: PaymentData = new PaymentData();\n\n  paymentData.setHashKey(hashKey)\n\n  paymentData.setHashIV(hashIV)\n\n  paymentData.setMerchantID(merchantID);\n\n  paymentData.setMerchantTradeNo(tradeNo.toString())\n\n  paymentData.setMerchantTradeDate(new Date().toLocaleDateString('zh-TW', { \n    year: 'numeric', \n    month: '2-digit', \n    day: '2-digit', \n    hour: '2-digit', \n    minute: '2-digit', \n    second: '2-digit',\n    hour12: false,\n    timeZone: 'Asia/Taipei'\n  }).replace(/\\//g, '/').replace(',', ''))\n\n  paymentData.setPaymentType(\"aio\")\n\n  paymentData.setTotalAmount(totalAmount)\n\n  paymentData.setTradeDesc(\"商品購買\")\n\n  paymentData.setItemName(itemName)\n\n  paymentData.setReturnURL(returnURL)\n\n  \n\n  paymentData.setChoosePayment(\"ALL\")\n  \n  paymentData.setEncryptType(\"1\")\n\n  paymentData.setCustomField3(\"order_id\")\n\n  // data.setCustomField4(cart.id)\n\n  \n\n  if (errorMessage){\n    console.log(action,\"error:\",errorMessage)\n  }\n\n\n  const submitHandler = () => {\n\n    if (errorMessage){  \n      return\n    }\n\n\n    try{\n\n      sdk.store.cart.complete(cart.id).then((data) => {\n\n        if (data.type === \"cart\" && data.cart) {\n          // 發生錯誤\n          console.error(data.error)\n        } else if (data.type === \"order\" && data.order) {\n\n          console.log(\"order pleaced : \",data.order)\n\n          console.log(\"order ID : \",data.order.id)\n\n          const orderID: string = data.order.id\n\n          // 清除 cart id\n          removeCartIdClient()\n\n          // \"使用者\"付款完成後返回的網址\n\n          const clientBackURL = `${window.location.origin}/order/${orderID}/confirmed`\n\n          paymentData.setClientBackURL(clientBackURL)\n\n          paymentData.setCustomField4(data.order.id)\n\n          const params:URLSearchParams = paymentData.getDataParams();\n\n          // 建立隱藏表單\n          const form = document.createElement('form')\n          form.method = 'POST'\n          form.action = ecpayAPI\n          // form.target = '_blank' // 開啟新視窗\n          form.encType = 'application/x-www-form-urlencoded'\n\n          // 添加所有參數作為隱藏輸入欄位\n          params.forEach((value, key) => {\n            const input = document.createElement('input')\n            input.type = 'hidden'\n            input.name = key\n            input.value = value\n            form.appendChild(input)\n          })\n        \n          // 將表單添加到頁面並提交\n          document.body.appendChild(form)\n          form.submit()\n\n          // 移除表單\n          document.body.removeChild(form)\n          \n        }\n\n\n\n\n        \n      })\n      \n    }catch(error){\n      console.log(action,\"error:\",error)\n      alert(\"發生錯誤，請稍後再試\")\n    }\n\n\n    \n\n    return\n    \n\n    \n\n  }\n  \n\n  return !errorMessage ? (\n    <Button\n          onClick={submitHandler}\n          disabled={notReady || submitting}\n          size=\"large\"\n          isLoading={submitting}\n          data-testid={dataTestId}\n        >\n            {submitting ? \"處理中...\" : \"前往 ECPay 付款\"}\n        </Button>\n        // <form \n        //   method=\"POST\" \n        //   action={ecpayAPI}\n        //   target=\"_blank\"\n        //   encType=\"application/x-www-form-urlencoded\"\n        // >\n          \n        //   {Array.from(params.entries()).map(([key, value]) => (\n        //     <input key={key} type=\"hidden\" name={key} value={value} />\n        //   ))}\n          \n        //   <Button\n        //     type=\"submit\"\n        //     disabled={notReady || submitting}\n        //     size=\"large\"\n        //     isLoading={submitting}\n        //     data-testid={dataTestId}\n        //   >\n        //     {submitting ? \"處理中...\" : \"前往 ECPay 付款\"}\n        //   </Button>\n        // </form>\n  ):null;\n}\n\nexport default ECPayPaymentButton\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/checkout/components/payment-button/index.tsx","messages":[{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":22,"column":5,"nodeType":null,"messageId":"preferOptionalChain","endLine":23,"endColumn":27,"fix":{"range":[499,534],"text":"!cart?.shipping_address"}},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":36,"column":5,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":36,"endColumn":7,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[968,970],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":38,"column":46,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":38,"endColumn":48,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1064,1066],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":40,"column":3,"nodeType":"MemberExpression","messageId":"unexpected","endLine":40,"endColumn":14,"suggestions":[{"fix":{"range":[1098,1256],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":1,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { HttpTypes } from \"@medusajs/types\"\nimport React from \"react\"\nimport ECPayPaymentButton from \"./ecpaypaymentbutton\"\nimport BankTransferPaymentButton from \"./banktransferpaymentbutton\"\nimport ErrorMessage from \"../error-message\"\n\ntype PaymentButtonProps = {\n  cart: HttpTypes.StoreCart\n  \"data-testid\": string\n}\n\nconst PaymentButton: React.FC<PaymentButtonProps> = ({\n  cart,\n  \"data-testid\": dataTestId,\n}) => {\n\n  const action:string = \"PaymentButton\"\n\n  const notReady =\n    !cart ||\n    !cart.shipping_address ||\n    !cart.billing_address ||\n    !cart.email ||\n    (cart.shipping_methods?.length ?? 0) < 1\n\n  if (notReady){\n    return <ErrorMessage error=\"請先完成前置步驟\" data-testid=\"payment-not-ready-error\" />\n  }\n  \n  // 從 metadata 或 payment_session 中獲取支付方式\n  const selectedPaymentProvider = cart.metadata?.selected_payment_provider\n  const paymentSession = cart.payment_collection?.payment_sessions?.find(\n    (s) => s.status === \"pending\"\n  ) || cart.payment_collection?.payment_sessions?.[0]\n\n  const providerId = selectedPaymentProvider || paymentSession?.provider_id\n\n  console.log(action, \"支付方式選擇:\", { \n    selectedPaymentProvider, \n    paymentSessionProvider: paymentSession?.provider_id,\n    finalProviderId: providerId \n  })\n\n  // 根據支付方式渲染對應的按鈕\n  switch(providerId){\n    case \"ecpay_credit_card\":\n      return <ECPayPaymentButton cart={cart} notReady={notReady} data-testid={dataTestId} />;\n    case \"manual_manual\":\n    default:\n      return <BankTransferPaymentButton notReady={notReady} cart={cart} data-testid={dataTestId} />;\n  }  \n\n}\n\n// 其餘子按鈕（Stripe、BankTransfer、Manual）已拆分到個別檔案。\n\nexport default PaymentButton\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/checkout/components/payment-button/stripepaymentbutton.tsx","messages":[{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":79,"column":14,"nodeType":null,"messageId":"preferOptionalChain","endLine":79,"endColumn":52,"fix":{"range":[2229,2267],"text":"pi?.status === \"requires_capture\""}},{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":80,"column":14,"nodeType":null,"messageId":"preferOptionalChain","endLine":80,"endColumn":45,"fix":{"range":[2285,2316],"text":"pi?.status === \"succeeded\""}},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":85,"column":41,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":85,"endColumn":43,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2418,2420],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":90,"column":12,"nodeType":null,"messageId":"preferOptionalChain","endLine":90,"endColumn":72,"fix":{"range":[2479,2539],"text":"paymentIntent?.status === \"requires_capture\""}},{"ruleId":"sonarjs/no-redundant-jump","severity":2,"message":"Remove this redundant jump.","line":96,"column":9,"nodeType":"ReturnStatement","messageId":"removeRedundantJump","endLine":96,"endColumn":15,"suggestions":[{"messageId":"suggestJumpRemoval","fix":{"range":[2650,2666],"text":""},"desc":"Remove this redundant jump"}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":3,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { useState } from \"react\"\nimport { Button } from \"@medusajs/ui\"\nimport ErrorMessage from \"../error-message\"\nimport { HttpTypes } from \"@medusajs/types\"\nimport { placeOrder } from \"@lib/data/cart\"\nimport { useElements, useStripe } from \"@stripe/react-stripe-js\"\n\ntype Props = {\n  cart: HttpTypes.StoreCart\n  notReady: boolean\n  \"data-testid\"?: string\n}\n\nconst StripePaymentButton = ({\n  cart,\n  notReady,\n  \"data-testid\": dataTestId,\n}: Props) => {\n  const [submitting, setSubmitting] = useState(false)\n  const [errorMessage, setErrorMessage] = useState<string | null>(null)\n\n  const onPaymentCompleted = async () => {\n    await placeOrder()\n      .catch((err) => {\n        setErrorMessage(err.message)\n      })\n      .finally(() => {\n        setSubmitting(false)\n      })\n  }\n\n  const stripe = useStripe()\n  const elements = useElements()\n  const card = elements?.getElement(\"card\")\n\n  const session = cart.payment_collection?.payment_sessions?.find(\n    (s) => s.status === \"pending\"\n  )\n\n  const disabled = !stripe || !elements ? true : false\n\n  const handlePayment = async () => {\n    setSubmitting(true)\n\n    if (!stripe || !elements || !card || !cart) {\n      setSubmitting(false)\n      return\n    }\n\n    await stripe\n      .confirmCardPayment(session?.data.client_secret as string, {\n        payment_method: {\n          card: card,\n          billing_details: {\n            name:\n              cart.billing_address?.first_name +\n              \" \" +\n              cart.billing_address?.last_name,\n            address: {\n              city: cart.billing_address?.city ?? undefined,\n              country: cart.billing_address?.country_code ?? undefined,\n              line1: cart.billing_address?.address_1 ?? undefined,\n              line2: cart.billing_address?.address_2 ?? undefined,\n              postal_code: cart.billing_address?.postal_code ?? undefined,\n              state: cart.billing_address?.province ?? undefined,\n            },\n            email: cart.email,\n            phone: cart.billing_address?.phone ?? undefined,\n          },\n        },\n      })\n      .then(({ error, paymentIntent }) => {\n        if (error) {\n          const pi = error.payment_intent\n\n          if (\n            (pi && pi.status === \"requires_capture\") ||\n            (pi && pi.status === \"succeeded\")\n          ) {\n            onPaymentCompleted()\n          }\n\n          setErrorMessage(error.message || null)\n          return\n        }\n\n        if (\n          (paymentIntent && paymentIntent.status === \"requires_capture\") ||\n          paymentIntent.status === \"succeeded\"\n        ) {\n          return onPaymentCompleted()\n        }\n\n        return\n      })\n  }\n\n  return (\n    <>\n      <Button\n        disabled={disabled || notReady}\n        onClick={handlePayment}\n        size=\"large\"\n        isLoading={submitting}\n        data-testid={dataTestId}\n      >\n        送出訂單\n      </Button>\n      <ErrorMessage\n        error={errorMessage}\n        data-testid=\"stripe-payment-error-message\"\n      />\n    </>\n  )\n}\n\nexport default StripePaymentButton\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/checkout/components/payment-container/index.tsx","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":119,"column":43,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":119,"endColumn":45,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[4065,4067],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Radio as RadioGroupOption } from \"@headlessui/react\"\nimport { Text, clx } from \"@medusajs/ui\"\nimport React, { useContext, useMemo, type JSX } from \"react\"\n\nimport Radio from \"@modules/common/components/radio\"\nimport PaymentTest from \"@/app/(main)/[countryCode]/(checkout)/checkout/components/payment-test\"\n\nimport { isManual } from \"../../../../constants\"\nimport SkeletonCardDetails from \"@modules/skeletons/components/skeleton-card-details\"\nimport { CardElement } from \"@stripe/react-stripe-js\"\nimport { StripeCardElementOptions } from \"@stripe/stripe-js\"\nimport { StripeContext } from \"../payment-wrapper/stripe-wrapper\"\n\ntype PaymentContainerProps = {\n  paymentProviderId: string\n  selectedPaymentOptionId: string | null\n  disabled?: boolean\n  paymentInfoMap: Record<string, { title: string; icon: JSX.Element }>\n  children?: React.ReactNode\n}\n\nconst PaymentContainer: React.FC<PaymentContainerProps> = ({\n  paymentProviderId,\n  selectedPaymentOptionId,\n  paymentInfoMap,\n  disabled = false,\n  children,\n}) => {\n  const isDevelopment = process.env.NODE_ENV === \"development\"\n\n  return (\n    <RadioGroupOption\n      key={paymentProviderId}\n      value={paymentProviderId}\n      disabled={disabled}\n      className={clx(\n        \"flex flex-col gap-y-2 text-small-regular cursor-pointer py-4 border rounded-rounded px-8 mb-2 hover:shadow-borders-interactive-with-active\",\n        {\n          \"border-gray-900\":\n            selectedPaymentOptionId === paymentProviderId,\n        }\n      )}\n    >\n      <div className=\"flex items-center justify-between \">\n        <div className=\"flex items-center gap-x-4\">\n          <Radio checked={selectedPaymentOptionId === paymentProviderId} />\n          <Text className=\"text-base-regular\">\n            {paymentInfoMap[paymentProviderId]?.title || paymentProviderId}\n          </Text>\n          {isManual(paymentProviderId) && isDevelopment && (\n            <PaymentTest className=\"hidden small:block\" />\n          )}\n        </div>\n        <span className=\"justify-self-end text-gray-900\">\n          {paymentInfoMap[paymentProviderId]?.icon}\n        </span>\n      </div>\n      {isManual(paymentProviderId) && isDevelopment && (\n        <PaymentTest className=\"small:hidden text-[10px]\" />\n      )}\n      {children}\n    </RadioGroupOption>\n  )\n}\n\nexport default PaymentContainer\n\nexport const StripeCardContainer = ({\n  paymentProviderId,\n  selectedPaymentOptionId,\n  paymentInfoMap,\n  disabled = false,\n  setCardBrand,\n  setError,\n  setCardComplete,\n}: Omit<PaymentContainerProps, \"children\"> & {\n  setCardBrand: (brand: string) => void\n  setError: (error: string | null) => void\n  setCardComplete: (complete: boolean) => void\n}) => {\n  const stripeReady = useContext(StripeContext)\n\n  const useOptions: StripeCardElementOptions = useMemo(() => {\n    return {\n      style: {\n        base: {\n          fontFamily: \"var(--font-base)\",\n          color: \"#424270\",\n          \"::placeholder\": {\n            color: \"rgb(107 114 128)\",\n          },\n        },\n      },\n      classes: {\n        base: \"pt-3 pb-1 block w-full h-11 px-4 mt-0 bg-gray-50 border rounded-md appearance-none focus:outline-none focus:ring-0 focus:shadow-borders-interactive-with-active border-gray-200 hover:bg-gray-100 transition-all duration-300 ease-in-out\",\n      },\n    }\n  }, [])\n\n  return (\n    <PaymentContainer\n      paymentProviderId={paymentProviderId}\n      selectedPaymentOptionId={selectedPaymentOptionId}\n      paymentInfoMap={paymentInfoMap}\n      disabled={disabled}\n    >\n      {selectedPaymentOptionId === paymentProviderId &&\n        (stripeReady ? (\n          <div className=\"my-4 transition-all duration-150 ease-in-out\">\n            <Text className=\"text-sm text-gray-900 mb-1 font-medium\">\n              請輸入信用卡資料：\n            </Text>\n            <CardElement\n              options={useOptions as StripeCardElementOptions}\n              onChange={(e) => {\n                setCardBrand(\n                  e.brand && e.brand.charAt(0).toUpperCase() + e.brand.slice(1)\n                )\n                setError(e.error?.message || null)\n                setCardComplete(e.complete)\n              }}\n            />\n          </div>\n        ) : (\n          <SkeletonCardDetails />\n        ))}\n    </PaymentContainer>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/checkout/components/payment-wrapper/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/checkout/components/payment-wrapper/stripe-wrapper.tsx","messages":[{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":24,"column":19,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":24,"endColumn":34,"suggestions":[{"messageId":"suggestOptionalChain","fix":{"range":[638,639],"text":"?"},"desc":"Consider using the optional chain operator `?.` instead. This operator includes runtime checks, so it is safer than the compile-only non-null assertion operator."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":28,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":28,"endColumn":17,"suggestions":[{"fix":{"range":[712,770],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":33,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":33,"endColumn":17,"suggestions":[{"fix":{"range":[837,875],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":38,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":38,"endColumn":17,"suggestions":[{"fix":{"range":[964,1007],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { HttpTypes } from \"@medusajs/types\"\nimport { Elements } from \"@stripe/react-stripe-js\"\nimport { Stripe, StripeElementsOptions } from \"@stripe/stripe-js\"\nimport { createContext } from \"react\"\n\ntype StripeWrapperProps = {\n  paymentSession: HttpTypes.StorePaymentSession\n  stripeKey?: string\n  stripePromise: Promise<Stripe | null> | null\n  children: React.ReactNode\n}\n\nexport const StripeContext = createContext(false)\n\nconst StripeWrapper: React.FC<StripeWrapperProps> = ({\n  paymentSession,\n  stripeKey,\n  stripePromise,\n  children,\n}) => {\n  const options: StripeElementsOptions = {\n    clientSecret: paymentSession!.data?.client_secret as string | undefined,\n  }\n\n  if (!stripeKey) {\n    console.warn(\"Stripe 已停用：未設定 NEXT_PUBLIC_STRIPE_KEY 環境變數\")\n    return <div>{children}</div>\n  }\n\n  if (!stripePromise) {\n    console.warn(\"Stripe 已停用：無法載入 Stripe\")\n    return <div>{children}</div>\n  }\n\n  if (!paymentSession?.data?.client_secret) {\n    console.warn(\"Stripe 客戶端密鑰遺失，無法初始化 Stripe\")\n    return <div>{children}</div>\n  }\n\n  return (\n    <StripeContext.Provider value={true}>\n      <Elements options={options} stripe={stripePromise}>\n        {children}\n      </Elements>\n    </StripeContext.Provider>\n  )\n}\n\nexport default StripeWrapper\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/checkout/components/payment/ecpay-payment.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[246,249],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[246,249],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":26,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[727,730],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[727,730],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":26,"column":67,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":26,"endColumn":69,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[780,782],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { RadioGroup } from \"@headlessui/react\"\nimport { useState } from \"react\"\nimport { Heading, Text, clx } from \"@medusajs/ui\"\nimport { CheckCircleSolid, CreditCard } from \"@medusajs/icons\"\n\ninterface EcpayPaymentProps {\n  cart: any\n  onPaymentMethodChange: (method: string) => Promise<void>\n  selectedPaymentMethod: string\n  onError?: (error: string) => void\n}\n\nconst EcpayPayment: React.FC<EcpayPaymentProps> = ({\n  cart,\n  onPaymentMethodChange,\n  selectedPaymentMethod,\n  onError\n}) => {\n  const [isLoading, setIsLoading] = useState(false)\n  const [localError, setLocalError] = useState<string | null>(null)\n\n  // 檢查是否選擇了超商配送\n  const isConvenienceStoreDelivery = cart?.shipping_methods?.some(\n    (method: any) => method.shipping_option?.name?.includes(\"超商\") || \n                     method.shipping_option?.name?.includes(\"便利商店\")\n  )\n\n  // 支付選項\n  const paymentOptions = [\n    {\n      id: \"ecpay_credit_card\",\n      name: \"信用卡付款\",\n      description: \"VISA/Master/JCB\",\n      icon: <CreditCard className=\"w-5 h-5\" />,\n      available: true\n    },\n    {\n      id: \"ecpay_atm\",\n      name: \"ATM 轉帳\",\n      description: \"線上產生專屬虛擬帳號\",\n      icon: <span className=\"w-5 h-5 rounded flex items-center justify-center text-white text-xs\" style={{ backgroundColor: \"var(--color-primary)\" }}>ATM</span>,\n      available: true\n    },\n    {\n      id: \"ecpay_store_payment\",\n      name: \"超商取貨付款\",\n      description: \"僅適用於超商取貨\",\n      icon: <span className=\"w-5 h-5 bg-yellow-500 rounded flex items-center justify-center text-white text-xs\">超商</span>,\n      available: isConvenienceStoreDelivery\n    }\n  ]\n\n  // 處理支付方式變更\n  const handlePaymentMethodChange = async (method: string) => {\n    setIsLoading(true)\n    setLocalError(null)\n    \n    try {\n      // 驗證選擇\n      if (method === \"ecpay_store_payment\" && !isConvenienceStoreDelivery) {\n        throw new Error(\"超商取貨付款僅適用於超商取貨配送方式\")\n      }\n\n      await onPaymentMethodChange(method)\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : \"選擇付款方式時發生錯誤\"\n      setLocalError(errorMessage)\n      onError?.(errorMessage)\n    } finally {\n      setIsLoading(false)\n    }\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      <Heading level=\"h3\" className=\"text-base font-medium\">\n        綠界支付\n      </Heading>\n\n      {localError && (\n        <div className=\"p-4 bg-rose-50 border border-rose-200 rounded-lg\">\n          <Text className=\"text-rose-500 text-sm\">{localError}</Text>\n        </div>\n      )}\n\n      <RadioGroup \n        value={selectedPaymentMethod} \n        onChange={handlePaymentMethodChange}\n        className=\"space-y-4\"\n        disabled={isLoading}\n      >\n        <div className=\"space-y-2\">\n          {paymentOptions.map((option) => (\n            <RadioGroup.Option\n              key={option.id}\n              value={option.id}\n              disabled={!option.available || isLoading}\n            >\n              {({ active, checked, disabled }) => (\n                <div\n                  className={clx(\n                    \"relative flex cursor-pointer rounded-lg px-5 py-4 shadow-sm focus:outline-none border-2\",\n                    {\n                      \"bg-gray-50 cursor-not-allowed\": disabled,\n                    }\n                  )}\n                  style={{\n                    backgroundColor: disabled ? \"#f9fafb\" : checked ? \"var(--bg-secondary)\" : \"var(--bg-primary)\",\n                    borderColor: checked ? \"var(--color-primary)\" : \"var(--border-primary)\",\n                    boxShadow: active && !disabled ? \"0 0 0 2px var(--color-primary-light)\" : undefined\n                  }}\n                >\n                  <div className=\"flex w-full items-center justify-between\">\n                    <div className=\"flex items-center\">\n                      <div className=\"text-sm\">\n                        <RadioGroup.Label\n                          as=\"p\"\n                          className={clx(\n                            \"font-medium\",\n                            {\n                              \"text-gray-900\": !disabled,\n                              \"text-gray-400\": disabled\n                            }\n                          )}\n                        >\n                          {option.name}\n                        </RadioGroup.Label>\n                        <RadioGroup.Description\n                          as=\"span\"\n                          className={clx(\n                            \"inline text-sm\",\n                            {\n                              \"text-gray-500\": !disabled,\n                              \"text-gray-400\": disabled\n                            }\n                          )}\n                        >\n                          {option.description}\n                        </RadioGroup.Description>\n                      </div>\n                    </div>\n                    <div className=\"flex-shrink-0\">\n                      {option.icon}\n                    </div>\n                  </div>\n                  {checked && (\n                    <div className=\"absolute top-4 right-4\">\n                      <CheckCircleSolid \n                        className=\"h-5 w-5\"\n                        style={{ color: \"var(--color-primary)\" }}\n                      />\n                    </div>\n                  )}\n                </div>\n              )}\n            </RadioGroup.Option>\n          ))}\n        </div>\n      </RadioGroup>\n    </div>\n  )\n}\n\nexport default EcpayPayment","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/checkout/components/payment/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/checkout/components/review/index.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":11,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[330,333],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[330,333],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":15,"column":3,"nodeType":"MemberExpression","messageId":"unexpected","endLine":15,"endColumn":14,"suggestions":[{"fix":{"range":[379,413],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":44,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1255,1258],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1255,1258],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":45,"column":5,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":45,"endColumn":7,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1290,1292],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":47,"column":58,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":47,"endColumn":60,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1398,1400],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":51,"column":3,"nodeType":"MemberExpression","messageId":"unexpected","endLine":51,"endColumn":14,"suggestions":[{"fix":{"range":[1573,1726],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":60,"column":30,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":60,"endColumn":32,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1859,1861],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":107,"column":53,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":107,"endColumn":55,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3716,3718],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { Heading, Text, clx, Button } from \"@medusajs/ui\"\n\nimport PaymentButton from \"../payment-button\"\nimport { useSearchParams } from \"next/navigation\"\nimport { useRouter } from \"next/navigation\"\nimport { usePathname } from \"next/navigation\"\nimport { useCallback } from \"react\"\n\nconst Review = ({ cart }: { cart: any }) => {\n\n  const action:string = \"Review\"\n\n  console.log(action,\"購物車資料：\",cart);\n\n  const searchParams = useSearchParams()\n  const router = useRouter()\n  const pathname = usePathname()\n\n  const isOpen = searchParams.get(\"step\") === \"review\"\n\n  const createQueryString = useCallback(\n    (name: string, value: string) => {\n      const params = new URLSearchParams(searchParams)\n      params.set(name, value)\n      return params.toString()\n    },\n    [searchParams]\n  )\n\n  const handleBackToPayment = () => {\n    router.push(pathname + \"?\" + createQueryString(\"step\", \"payment\"), {\n      scroll: false,\n    })\n  }\n\n  const paidByGiftcard =\n    cart?.gift_cards && cart?.gift_cards?.length > 0 && cart?.total === 0\n\n  // 判斷支付方式 - 優先從 metadata 讀取，再從 payment_session 讀取\n  const selectedPaymentProvider = cart.metadata?.selected_payment_provider\n  const paymentSession = cart.payment_collection?.payment_sessions?.find(\n    (s: any) => s.status === \"pending\"\n  ) || cart.payment_collection?.payment_sessions?.[0]\n\n  const currentPaymentProvider = selectedPaymentProvider || paymentSession?.provider_id\n  const isECPayCredit = currentPaymentProvider === \"ecpay_credit_card\"\n  const isBankTransfer = currentPaymentProvider === \"manual_manual\"\n  \n  console.log(action, \"當前支付方式:\", { \n    selectedPaymentProvider, \n    paymentSessionProvider: paymentSession?.provider_id,\n    currentPaymentProvider \n  })\n\n  const previousStepsCompleted =\n    cart.shipping_address &&\n    cart.shipping_methods.length > 0 &&\n    (cart.payment_collection || paidByGiftcard)\n\n  return (\n    <div className=\"bg-white\">\n      <div className=\"flex flex-row items-center justify-between mb-6\">\n        <Heading\n          level=\"h2\"\n          className={clx(\n            \"flex flex-row text-3xl-regular gap-x-2 items-baseline\",\n            {\n              \"opacity-50 pointer-events-none select-none\": !isOpen,\n            }\n          )}\n        >\n          檢視訂單\n        </Heading>\n      </div>\n      {isOpen && previousStepsCompleted && (\n        <>\n          <div className=\"flex items-start gap-x-1 w-full mb-6\">\n            <div className=\"w-full\">\n              {isECPayCredit ? (\n                <div className=\"space-y-3\">\n                  <Text className=\"txt-medium-plus text-gray-900 mb-1\">\n                    點擊「前往綠界支付」按鈕後，系統將跳轉至綠界第三方金流平台進行刷卡支付。\n                  </Text>\n                  <Text className=\"txt-small text-gray-700\">\n                    • 支付完成後將自動返回訂單確認頁面<br/>\n                    • 請確保在支付過程中不要關閉瀏覽器視窗<br/>\n                    • 如有問題請聯繫客服\n                  </Text>\n                  <Text className=\"txt-small text-gray-600 mt-4\">\n                    點擊下方按鈕即表示您已閱讀、了解並接受我們的使用條款、銷售條款及退貨政策，並確認您已閱讀本站的隱私政策。\n                  </Text>\n                </div>\n              ) : isBankTransfer ? (\n                <div className=\"space-y-3\">\n                  <Text className=\"txt-medium-plus text-gray-900 mb-1\">\n                    您選擇了銀行轉帳付款方式，請於訂單確認後依照以下帳號進行轉帳：\n                  </Text>\n                  <div className=\"bg-gray-50 p-4 rounded-lg\">\n                    <Text className=\"txt-small font-medium text-gray-800\">\n                      銀行：玉山銀行 (808)<br/>\n                      帳號：0532-968-123456<br/>\n                      戶名：您的店家名稱有限公司\n                    </Text>\n                    <Text className=\"txt-xs text-gray-600 mt-2\">\n                      轉帳備註請填寫：訂單編號 {cart.display_id || 'PENDING'}\n                    </Text>\n                  </div>\n                  <Text className=\"txt-small text-red-600\">\n                    • 請於 3 個工作日內完成轉帳<br/>\n                    • 轉帳完成請保留轉帳證明並聯繫客服<br/>\n                    • 確認收款後將安排出貨\n                  </Text>\n                  <Text className=\"txt-small text-gray-600 mt-4\">\n                    點擊下方按鈕即表示您已閱讀、了解並接受我們的使用條款、銷售條款及退貨政策，並確認您已閱讀本站的隱私政策。\n                  </Text>\n                </div>\n              ) : (\n                <Text className=\"txt-medium-plus text-gray-900 mb-1\">\n                  點擊「送出訂單」按鈕，即表示您已閱讀、了解並接受我們的使用條款、銷售條款及退貨政策，並確認您已閱讀本站的隱私政策。\n                </Text>\n              )}\n            </div>\n          </div>\n          <div className=\"flex gap-4\">\n            <Button\n              variant=\"secondary\"\n              onClick={handleBackToPayment}\n              className=\"flex-1\"\n            >\n              上一步：修改付款方式\n            </Button>\n            <div className=\"flex-2\">\n              <PaymentButton cart={cart} data-testid=\"submit-order-button\" />\n            </div>\n          </div>\n        </>\n      )}\n    </div>\n  )\n}\n\nexport default Review\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/checkout/components/shipping-address/index.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":21,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[644,647],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[644,647],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":22,"column":71,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":22,"endColumn":73,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[722,724],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":23,"column":69,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":23,"endColumn":71,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[797,799],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":24,"column":69,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":24,"endColumn":71,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[872,874],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":25,"column":65,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":25,"endColumn":67,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[943,945],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":26,"column":73,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":26,"endColumn":75,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1022,1024],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":27,"column":59,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":27,"endColumn":61,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1087,1089],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":28,"column":75,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":28,"endColumn":77,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1168,1170],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":29,"column":67,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":29,"endColumn":69,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1241,1243],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":30,"column":61,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":30,"endColumn":63,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1308,1310],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":31,"column":24,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":31,"endColumn":26,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1338,1340],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":53,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":53,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1916,1919],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1916,1919],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":55,"column":60,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":55,"endColumn":62,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2009,2011],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":56,"column":58,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":56,"endColumn":60,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2073,2075],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":57,"column":58,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":57,"endColumn":60,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2137,2139],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":58,"column":54,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":58,"endColumn":56,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2197,2199],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":59,"column":62,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":59,"endColumn":64,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2265,2267],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":60,"column":48,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":60,"endColumn":50,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2319,2321],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":61,"column":64,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":61,"endColumn":66,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2389,2391],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":62,"column":56,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":62,"endColumn":58,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2451,2453],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":63,"column":50,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":63,"endColumn":52,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2507,2509],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":67,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2583,2586],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2583,2586],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":75,"column":9,"nodeType":null,"messageId":"preferOptionalChain","endLine":75,"endColumn":38,"fix":{"range":[2765,2794],"text":"cart?.shipping_address"}},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":97,"column":47,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":97,"endColumn":49,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3289,3291],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":21,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import { HttpTypes } from \"@medusajs/types\"\nimport { Container } from \"@medusajs/ui\"\nimport Checkbox from \"@modules/common/components/checkbox\"\nimport Input from \"@modules/common/components/input\"\nimport { mapKeys } from \"lodash\"\nimport React, { useEffect, useMemo, useState } from \"react\"\nimport AddressSelect from \"../address-select\"\nimport CountrySelect from \"../country-select\"\n\nconst ShippingAddress = ({\n  customer,\n  cart,\n  checked,\n  onChange,\n}: {\n  customer: HttpTypes.StoreCustomer | null\n  cart: HttpTypes.StoreCart | null\n  checked: boolean\n  onChange: () => void\n}) => {\n  const [formData, setFormData] = useState<Record<string, any>>({\n    \"shipping_address.first_name\": cart?.shipping_address?.first_name || \"\",\n    \"shipping_address.last_name\": cart?.shipping_address?.last_name || \"\",\n    \"shipping_address.address_1\": cart?.shipping_address?.address_1 || \"\",\n    \"shipping_address.company\": cart?.shipping_address?.company || \"\",\n    \"shipping_address.postal_code\": cart?.shipping_address?.postal_code || \"\",\n    \"shipping_address.city\": cart?.shipping_address?.city || \"\",\n    \"shipping_address.country_code\": cart?.shipping_address?.country_code || \"\",\n    \"shipping_address.province\": cart?.shipping_address?.province || \"\",\n    \"shipping_address.phone\": cart?.shipping_address?.phone || \"\",\n    email: cart?.email || \"\",\n  })\n\n  const countriesInRegion = useMemo(\n    () => cart?.region?.countries?.map((c) => c.iso_2),\n    [cart?.region]\n  )\n\n  // check if customer has saved addresses that are in the current region\n  const addressesInRegion = useMemo(\n    () =>\n      customer?.addresses.filter(\n        (a) => a.country_code && countriesInRegion?.includes(a.country_code)\n      ),\n    [customer?.addresses, countriesInRegion]\n  )\n\n  const setFormAddress = (\n    address?: HttpTypes.StoreCartAddress,\n    email?: string\n  ) => {\n    address &&\n      setFormData((prevState: Record<string, any>) => ({\n        ...prevState,\n        \"shipping_address.first_name\": address?.first_name || \"\",\n        \"shipping_address.last_name\": address?.last_name || \"\",\n        \"shipping_address.address_1\": address?.address_1 || \"\",\n        \"shipping_address.company\": address?.company || \"\",\n        \"shipping_address.postal_code\": address?.postal_code || \"\",\n        \"shipping_address.city\": address?.city || \"\",\n        \"shipping_address.country_code\": address?.country_code || \"\",\n        \"shipping_address.province\": address?.province || \"\",\n        \"shipping_address.phone\": address?.phone || \"\",\n      }))\n\n    email &&\n      setFormData((prevState: Record<string, any>) => ({\n        ...prevState,\n        email: email,\n      }))\n  }\n\n  useEffect(() => {\n    // Ensure cart is not null and has a shipping_address before setting form data\n    if (cart && cart.shipping_address) {\n      setFormAddress(cart?.shipping_address, cart?.email)\n    }\n\n    if (cart && !cart.email && customer?.email) {\n      setFormAddress(undefined, customer.email)\n    }\n  }, [cart]) // Add cart as a dependency\n\n  const handleChange = (\n    e: React.ChangeEvent<\n      HTMLInputElement | HTMLInputElement | HTMLSelectElement\n    >\n  ) => {\n    setFormData({\n      ...formData,\n      [e.target.name]: e.target.value,\n    })\n  }\n\n  return (\n    <>\n      {customer && (addressesInRegion?.length || 0) > 0 && (\n        <Container className=\"mb-6 flex flex-col gap-y-4 p-5\">\n          <p className=\"text-small-regular\">\n            {`Hi ${customer.first_name}, do you want to use one of your saved addresses?`}\n          </p>\n          <AddressSelect\n            addresses={customer.addresses}\n            addressInput={\n              mapKeys(formData, (_, key) =>\n                key.replace(\"shipping_address.\", \"\")\n              ) as HttpTypes.StoreCartAddress\n            }\n            onSelect={setFormAddress}\n          />\n        </Container>\n      )}\n      <div className=\"grid grid-cols-2 gap-4\">\n        <Input\n          label=\"姓氏\"\n          name=\"shipping_address.last_name\"\n          autoComplete=\"family-name\"\n          value={formData[\"shipping_address.last_name\"]}\n          onChange={handleChange}\n          required\n          data-testid=\"shipping-last-name-input\"\n        />\n        <Input\n          label=\"名字\"\n          name=\"shipping_address.first_name\"\n          autoComplete=\"given-name\"\n          value={formData[\"shipping_address.first_name\"]}\n          onChange={handleChange}\n          required\n          data-testid=\"shipping-first-name-input\"\n        />\n        <CountrySelect\n          name=\"shipping_address.country_code\"\n          autoComplete=\"country\"\n          region={cart?.region}\n          value={formData[\"shipping_address.country_code\"]}\n          onChange={handleChange}\n          required\n          data-testid=\"shipping-country-select\"\n        />\n        <Input\n          label=\"縣市\"\n          name=\"shipping_address.province\"\n          autoComplete=\"address-level1\"\n          value={formData[\"shipping_address.province\"]}\n          onChange={handleChange}\n          required\n          data-testid=\"shipping-province-input\"\n        />\n        <Input\n          label=\"鄉鎮市區\"\n          name=\"shipping_address.city\"\n          autoComplete=\"address-level2\"\n          value={formData[\"shipping_address.city\"]}\n          onChange={handleChange}\n          required\n          data-testid=\"shipping-city-input\"\n        />\n        <Input\n          label=\"郵遞區號\"\n          name=\"shipping_address.postal_code\"\n          autoComplete=\"postal-code\"\n          value={formData[\"shipping_address.postal_code\"]}\n          onChange={handleChange}\n          required\n          data-testid=\"shipping-postal-code-input\"\n        />\n        <div className=\"col-span-2\">\n          <Input\n            label=\"詳細地址\"\n            name=\"shipping_address.address_1\"\n            autoComplete=\"address-line1\"\n            value={formData[\"shipping_address.address_1\"]}\n            onChange={handleChange}\n            required\n            data-testid=\"shipping-address-input\"\n          />\n        </div>\n        <Input\n          label=\"公司/機構 (選填)\"\n          name=\"shipping_address.company\"\n          value={formData[\"shipping_address.company\"]}\n          onChange={handleChange}\n          autoComplete=\"organization\"\n          data-testid=\"shipping-company-input\"\n        />\n      </div>\n      <div className=\"my-8\">\n        <Checkbox\n          label=\"帳單地址與運送地址相同\"\n          name=\"same_as_billing\"\n          checked={checked}\n          onChange={onChange}\n          data-testid=\"billing-address-checkbox\"\n        />\n      </div>\n      <div className=\"grid grid-cols-2 gap-4 mb-4\">\n        <Input\n          label=\"電子信箱\"\n          name=\"email\"\n          type=\"email\"\n          title=\"請輸入有效的電子信箱地址。\"\n          autoComplete=\"email\"\n          value={formData.email}\n          onChange={handleChange}\n          required\n          data-testid=\"shipping-email-input\"\n        />\n        <Input\n          label=\"聯絡電話\"\n          name=\"shipping_address.phone\"\n          autoComplete=\"tel\"\n          value={formData[\"shipping_address.phone\"]}\n          onChange={handleChange}\n          required\n          data-testid=\"shipping-phone-input\"\n        />\n      </div>\n    </>\n  )\n}\n\nexport default ShippingAddress\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/checkout/components/shipping/index.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'formatAddress' is defined but never used.","line":24,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":23},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'formatAddress' is defined but never used. Allowed unused vars must match /^_/u.","line":24,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":23},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":24,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[945,948],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[945,948],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":44,"column":3,"nodeType":"MemberExpression","messageId":"unexpected","endLine":44,"endColumn":14,"suggestions":[{"fix":{"range":[1340,1434],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":45,"column":3,"nodeType":"MemberExpression","messageId":"unexpected","endLine":45,"endColumn":14,"suggestions":[{"fix":{"range":[1437,1498],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":46,"column":3,"nodeType":"MemberExpression","messageId":"unexpected","endLine":46,"endColumn":14,"suggestions":[{"fix":{"range":[1501,1595],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":46,"column":92,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":46,"endColumn":94,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1590,1592],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":55,"column":55,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":55,"endColumn":57,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1977,1979],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":64,"column":53,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":64,"endColumn":55,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2204,2206],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":82,"column":52,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":82,"endColumn":54,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2855,2857],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":82,"column":61,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":82,"endColumn":77},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'value' is defined but never used.","line":187,"column":32,"nodeType":null,"messageId":"unusedVar","endLine":187,"endColumn":37},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'value' is defined but never used. Allowed unused args must match /^_/u.","line":187,"column":32,"nodeType":null,"messageId":"unusedVar","endLine":187,"endColumn":37},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":223,"column":43,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":223,"endColumn":45,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[7189,7191],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":259,"column":39,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":259,"endColumn":53},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":294,"column":45,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":294,"endColumn":47,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[10321,10323],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":329,"column":39,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":329,"endColumn":53},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":381,"column":29,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":381,"endColumn":66},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":381,"column":29,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":381,"endColumn":58,"suggestions":[{"messageId":"suggestOptionalChain","fix":{"range":[13973,13974],"text":"?"},"desc":"Consider using the optional chain operator `?.` instead. This operator includes runtime checks, so it is safer than the compile-only non-null assertion operator."}]}],"suppressedMessages":[],"errorCount":10,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { RadioGroup, Radio } from \"@headlessui/react\"\nimport { setShippingMethod } from \"@lib/data/cart\"\nimport { calculatePriceForShippingOption } from \"@lib/data/fulfillment\"\nimport { convertToLocale } from \"@lib/util/money\"\nimport { CheckCircleSolid, Loader } from \"@medusajs/icons\"\nimport { HttpTypes } from \"@medusajs/types\"\nimport { Button, Heading, Text, clx } from \"@medusajs/ui\"\nimport ErrorMessage from \"@modules/checkout/components/error-message\"\nimport Divider from \"@modules/common/components/divider\"\nimport MedusaRadio from \"@modules/common/components/radio\"\nimport { usePathname, useRouter, useSearchParams } from \"next/navigation\"\nimport { useEffect, useState } from \"react\"\n\nconst PICKUP_OPTION_ON = \"__PICKUP_ON\"\nconst PICKUP_OPTION_OFF = \"__PICKUP_OFF\"\n\ntype ShippingProps = {\n  cart: HttpTypes.StoreCart\n  availableShippingMethods: HttpTypes.StoreCartShippingOption[] | null\n}\n\nfunction formatAddress(address: any) {\n  if (!address) return \"\"\n  \n  const parts = [\n    address.address_1,\n    address.city,\n    address.postal_code,\n  ].filter(Boolean)\n  \n  return parts.join(\", \")\n}\n\nconst Shipping: React.FC<ShippingProps> = ({\n  cart,\n  availableShippingMethods,\n}) => {\n  const [isLoading, setIsLoading] = useState(false)\n  const [isLoadingPrices, setIsLoadingPrices] = useState(true)\n\n  // Debug logs\n  console.log(\"🚚🚚🚚 Shipping component - availableShippingMethods:\", availableShippingMethods)\n  console.log(\"🛒🛒🛒 Shipping component - cart.id:\", cart?.id)\n  console.log(\"🔢🔢🔢 Available shipping methods count:\", availableShippingMethods?.length || 0)\n\n  const [showPickupOptions, setShowPickupOptions] =\n    useState<string>(PICKUP_OPTION_OFF)\n  const [calculatedPricesMap, setCalculatedPricesMap] = useState<\n    Record<string, number>\n  >({})\n  const [error, setError] = useState<string | null>(null)\n  const [shippingMethodId, setShippingMethodId] = useState<string | null>(\n    cart.shipping_methods?.at(-1)?.shipping_option_id || null\n  )\n\n  const searchParams = useSearchParams()\n  const router = useRouter()\n  const pathname = usePathname()\n\n  const isOpen = searchParams.get(\"step\") === \"delivery\"\n\n  const _shippingMethods = availableShippingMethods || []\n  const _pickupMethods: HttpTypes.StoreCartShippingOption[] = [] // 暫時為空，因為我們專注於配送\n\n  const hasPickupOptions = !!_pickupMethods?.length\n\n  useEffect(() => {\n    setIsLoadingPrices(true)\n\n    if (_shippingMethods?.length) {\n      const promises = _shippingMethods\n        .filter((sm) => sm.price_type === \"calculated\")\n        .map((sm) => calculatePriceForShippingOption(sm.id, cart.id))\n\n      if (promises.length) {\n        Promise.allSettled(promises).then((res) => {\n          const pricesMap: Record<string, number> = {}\n          res\n            .filter((r) => r.status === \"fulfilled\")\n            .forEach((p) => (pricesMap[p.value?.id || \"\"] = p.value?.amount!))\n\n          setCalculatedPricesMap(pricesMap)\n          setIsLoadingPrices(false)\n        })\n      } else {\n        setIsLoadingPrices(false)\n      }\n    } else {\n      setIsLoadingPrices(false)\n    }\n\n    if (_pickupMethods?.find((m) => m.id === shippingMethodId)) {\n      setShowPickupOptions(PICKUP_OPTION_ON)\n    }\n  }, [availableShippingMethods])\n\n  const handleEdit = () => {\n    router.push(pathname + \"?step=delivery\", { scroll: false })\n  }\n\n  const handleSubmit = () => {\n    router.push(pathname + \"?step=payment\", { scroll: false })\n  }\n\n  const handleSetShippingMethod = async (\n    id: string,\n    variant: \"shipping\" | \"pickup\"\n  ) => {\n    setError(null)\n\n    if (variant === \"pickup\") {\n      setShowPickupOptions(PICKUP_OPTION_ON)\n    } else {\n      setShowPickupOptions(PICKUP_OPTION_OFF)\n    }\n\n    let currentId: string | null = null\n    setIsLoading(true)\n    setShippingMethodId((prev) => {\n      currentId = prev\n      return id\n    })\n\n    await setShippingMethod({ cartId: cart.id, shippingMethodId: id })\n      .catch((err) => {\n        setShippingMethodId(currentId)\n        setError(err.message)\n      })\n      .finally(() => {\n        setIsLoading(false)\n      })\n  }\n\n  useEffect(() => {\n    setError(null)\n  }, [isOpen])\n\n  return (\n    <div className=\"bg-white\">\n      <div className=\"flex flex-row items-center justify-between mb-6\">\n        <Heading\n          level=\"h2\"\n          className={clx(\n            \"flex flex-row text-3xl-regular gap-x-2 items-baseline\",\n            {\n              \"opacity-50 pointer-events-none select-none\":\n                !isOpen && cart.shipping_methods?.length === 0,\n            }\n          )}\n        >\n          配送方式\n          {!isOpen && (cart.shipping_methods?.length ?? 0) > 0 && (\n            <CheckCircleSolid />\n          )}\n        </Heading>\n        {!isOpen &&\n          cart?.shipping_address &&\n          cart?.billing_address &&\n          cart?.email && (\n            <Text>\n              <button\n                onClick={handleEdit}\n                className=\"text-ui-fg-interactive hover:text-ui-fg-interactive-hover\"\n                data-testid=\"edit-delivery-button\"\n              >\n                編輯\n              </button>\n            </Text>\n          )}\n      </div>\n      {isOpen ? (\n        <>\n          <div className=\"grid\">\n            <div className=\"flex flex-col\">\n\n              <span className=\"mb-4 text-ui-fg-muted txt-medium\">\n                請選擇您希望的運送方式\n              </span>\n            </div>\n            <div data-testid=\"delivery-options-container\">\n              <div className=\"pb-8 md:pt-0 pt-2\">\n                {hasPickupOptions && (\n                  <RadioGroup\n                    value={showPickupOptions}\n                    onChange={(value) => {\n                      const id = _pickupMethods.find(\n                        (option) => !option.insufficient_inventory\n                      )?.id\n\n                      if (id) {\n                        handleSetShippingMethod(id, \"pickup\")\n                      }\n                    }}\n                  >\n                    <Radio\n                      value={PICKUP_OPTION_ON}\n                      data-testid=\"delivery-option-radio\"\n                      className={clx(\n                        \"flex items-center justify-between text-small-regular cursor-pointer py-4 border rounded-rounded px-8 mb-2 hover:shadow-borders-interactive-with-active\",\n                        {\n                          \"border-ui-border-interactive\":\n                            showPickupOptions === PICKUP_OPTION_ON,\n                        }\n                      )}\n                    >\n                      <div className=\"flex items-center gap-x-4\">\n                        <MedusaRadio\n                          checked={showPickupOptions === PICKUP_OPTION_ON}\n                        />\n                        <span className=\"text-base-regular\">\n                          Pick up your order\n                        </span>\n                      </div>\n                      <span className=\"justify-self-end text-ui-fg-base\">\n                        -\n                      </span>\n                    </Radio>\n                  </RadioGroup>\n                )}\n                <RadioGroup\n                  value={shippingMethodId || \"\"}\n                  onChange={(v) => v && handleSetShippingMethod(v, \"shipping\")}\n                >\n                  {_shippingMethods?.map((option) => {\n                    const isDisabled =\n                      option.price_type === \"calculated\" &&\n                      !isLoadingPrices &&\n                      typeof calculatedPricesMap[option.id] !== \"number\"\n\n                    return (\n                      <Radio\n                        key={option.id}\n                        value={option.id}\n                        data-testid=\"delivery-option-radio\"\n                        disabled={isDisabled}\n                        className={clx(\n                          \"flex items-center justify-between text-small-regular cursor-pointer py-4 border rounded-rounded px-8 mb-2 hover:shadow-borders-interactive-with-active\",\n                          {\n                            \"border-ui-border-interactive\":\n                              option.id === shippingMethodId,\n                            \"hover:shadow-brders-none cursor-not-allowed\":\n                              isDisabled,\n                          }\n                        )}\n                      >\n                        <div className=\"flex items-center gap-x-4\">\n                          <MedusaRadio\n                            checked={option.id === shippingMethodId}\n                          />\n                          <span className=\"text-base-regular\">\n                            {option.name}\n                          </span>\n                        </div>\n                        <span className=\"justify-self-end text-ui-fg-base\">\n                          {option.price_type === \"flat\" ? (\n                            convertToLocale({\n                              amount: option.amount!,\n                              currency_code: cart?.currency_code,\n                            })\n                          ) : calculatedPricesMap[option.id] ? (\n                            convertToLocale({\n                              amount: calculatedPricesMap[option.id],\n                              currency_code: cart?.currency_code,\n                            })\n                          ) : isLoadingPrices ? (\n                            <Loader />\n                          ) : (\n                            \"-\"\n                          )}\n                        </span>\n                      </Radio>\n                    )\n                  })}\n                </RadioGroup>\n              </div>\n            </div>\n          </div>\n\n          {showPickupOptions === PICKUP_OPTION_ON && (\n            <div className=\"grid\">\n              <div className=\"flex flex-col\">\n                <span className=\"font-medium txt-medium text-ui-fg-base\">\n                  店舖\n                </span>\n                <span className=\"mb-4 text-ui-fg-muted txt-medium\">\n                  選擇您附近的店舖\n                </span>\n              </div>\n              <div data-testid=\"delivery-options-container\">\n                <div className=\"pb-8 md:pt-0 pt-2\">\n                  <RadioGroup\n                    value={shippingMethodId || \"\"}\n                    onChange={(v) => v && handleSetShippingMethod(v, \"pickup\")}\n                  >\n                    {_pickupMethods?.map((option) => {\n                      return (\n                        <Radio\n                          key={option.id}\n                          value={option.id}\n                          disabled={option.insufficient_inventory}\n                          data-testid=\"delivery-option-radio\"\n                          className={clx(\n                            \"flex items-center justify-between text-small-regular cursor-pointer py-4 border rounded-rounded px-8 mb-2 hover:shadow-borders-interactive-with-active\",\n                            {\n                              \"border-ui-border-interactive\":\n                                option.id === shippingMethodId,\n                              \"hover:shadow-brders-none cursor-not-allowed\":\n                                option.insufficient_inventory,\n                            }\n                          )}\n                        >\n                          <div className=\"flex items-start gap-x-4\">\n                            <MedusaRadio\n                              checked={option.id === shippingMethodId}\n                            />\n                            <div className=\"flex flex-col\">\n                              <span className=\"text-base-regular\">\n                                {option.name}\n                              </span>\n                              <span className=\"text-base-regular text-ui-fg-muted\">\n                                {option.name} - Pickup Location\n                              </span>\n                            </div>\n                          </div>\n                          <span className=\"justify-self-end text-ui-fg-base\">\n                            {convertToLocale({\n                              amount: option.amount!,\n                              currency_code: cart?.currency_code,\n                            })}\n                          </span>\n                        </Radio>\n                      )\n                    })}\n                  </RadioGroup>\n                </div>\n              </div>\n            </div>\n          )}\n\n          <div>\n            <ErrorMessage\n              error={error}\n              data-testid=\"delivery-option-error-message\"\n            />\n          <div className=\"flex gap-4\">\n            <Button\n              variant=\"secondary\"\n              onClick={() => router.push(pathname + \"?step=address\", { scroll: false })}\n              className=\"flex-1\"\n            >\n              上一步：修改配送地址\n            </Button>\n            <div className=\"flex-2\">\n              <Button\n                size=\"large\"\n                className=\"w-full\"\n                onClick={handleSubmit}\n                isLoading={isLoading}\n                disabled={!cart.shipping_methods?.[0]}\n                data-testid=\"submit-delivery-option-button\"\n              >\n                繼續付款\n              </Button>\n            </div>\n          </div>\n          </div>\n        </>\n      ) : (\n        <div>\n          <div className=\"text-small-regular\">\n            {cart && (cart.shipping_methods?.length ?? 0) > 0 && (\n              <div className=\"flex flex-col w-1/3\">\n                <Text className=\"txt-medium-plus text-ui-fg-base mb-1\">\n                  配送方式\n                </Text>\n                <Text className=\"txt-medium text-ui-fg-subtle\">\n                  {cart.shipping_methods?.at(-1)?.name}{\" \"}\n                  {cart.shipping_methods?.at(-1)?.amount && convertToLocale({\n                    amount: cart.shipping_methods.at(-1)!.amount!,\n                    currency_code: cart?.currency_code,\n                  })}\n                </Text>\n              </div>\n            )}\n          </div>\n        </div>\n      )}\n      <Divider className=\"mt-8\" />\n    </div>\n  )\n}\n\nexport default Shipping","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/checkout/components/store-selector/index.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'useEffect' is defined but never used.","line":1,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":36},{"ruleId":"unused-imports/no-unused-imports","severity":2,"message":"'useEffect' is defined but never used.","line":1,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":36,"fix":{"range":[24,35],"text":""}},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'StoreSelectionData' is defined but never used.","line":20,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":29},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'StoreSelectionData' is defined but never used. Allowed unused vars must match /^_/u.","line":20,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'setSelectedStore' is assigned a value but never used.","line":30,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":30,"endColumn":41},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'setSelectedStore' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":30,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":30,"endColumn":41},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":77,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":77,"endColumn":18,"suggestions":[{"fix":{"range":[1576,1622],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":80,"column":66,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":80,"endColumn":68,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1711,1713],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":85,"column":83,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":85,"endColumn":85,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1992,1994],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-alert","severity":2,"message":"Unexpected alert.","line":107,"column":11,"nodeType":"CallExpression","messageId":"unexpected","endLine":107,"endColumn":36},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":114,"column":44,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":114,"endColumn":46,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2889,2891],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":115,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":115,"endColumn":19},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":115,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":115,"endColumn":19},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":122,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":122,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3108,3111],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3108,3111],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":123,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":123,"endColumn":20,"suggestions":[{"fix":{"range":[3121,3159],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-alert","severity":2,"message":"Unexpected alert.","line":124,"column":7,"nodeType":"CallExpression","messageId":"unexpected","endLine":124,"endColumn":44}],"suppressedMessages":[],"errorCount":13,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from \"react\";\n\n// 物流選項介面\ninterface LogisticsOption {\n  value: string;\n  label: string;\n  description: string;\n  icon: string;\n}\n\n// 選中門市資訊介面\ninterface SelectedStore {\n  CVSStoreID?: string;\n  CVSStoreName?: string;\n  CVSAddress?: string;\n  CVSTelephone?: string;\n  logisticsSubType?: string;\n}\n\ninterface StoreSelectionData {\n  storeId: string;\n  storeName: string;\n  storeAddress: string;\n  telephone?: string;\n  logisticsSubType: string;\n}\n\nconst StoreSelector: React.FC = () => {\n  const [selectedLogistics, setSelectedLogistics] = useState<string>(\"FAMI\");\n  const [selectedStore, setSelectedStore] = useState<SelectedStore | null>(null);\n  const [isLoading, setIsLoading] = useState(false);\n\n  // 物流選項\n  const logisticsOptions: LogisticsOption[] = [\n    {\n      value: \"FAMI\",\n      label: \"全家便利商店\",\n      description: \"全台據點最多，24小時營業\",\n      icon: \"🏪\"\n    },\n    {\n      value: \"UNIMART\", \n      label: \"7-ELEVEN\",\n      description: \"全台最大便利商店連鎖\",\n      icon: \"🏬\"\n    },\n    {\n      value: \"HILIFE\",\n      label: \"萊爾富\",\n      description: \"社區型便利商店\",\n      icon: \"🏪\"\n    },\n    {\n      value: \"FAMIC2C\",\n      label: \"全家店到店\",\n      description: \"全家便利商店店到店服務\",\n      icon: \"📦\"\n    },\n    {\n      value: \"UNIMARTC2C\",\n      label: \"7-ELEVEN交貨便\",\n      description: \"7-ELEVEN超商交貨便\",\n      icon: \"📦\"\n    },\n    {\n      value: \"HILIFEC2C\",\n      label: \"萊爾富店到店\",\n      description: \"萊爾富便利商店店到店\",\n      icon: \"📦\"\n    }\n  ];\n\n  // 使用物流選擇頁面代替電子地圖\n  const openLogisticsSelection = async () => {\n    try {\n      setIsLoading(true);\n      console.log('� 開啟物流選擇頁面:', selectedLogistics);\n\n      // 呼叫後端物流選擇 API\n      const baseUrl = process.env.NEXT_PUBLIC_MEDUSA_BACKEND_URL || 'http://localhost:9000'\n      const response = await fetch(`${baseUrl}/store/ecpay/logistics-selection`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'x-publishable-api-key': process.env.NEXT_PUBLIC_MEDUSA_PUBLISHABLE_KEY || ''\n        },\n        body: JSON.stringify({\n          goodsAmount: 500,\n          goodsName: \"商品配送\",\n          senderName: \"商家名稱\",\n          senderZipCode: \"100\", \n          senderAddress: \"台北市中正區\",\n          logisticsType: \"CVS\",\n          logisticsSubType: selectedLogistics\n        })\n      });\n\n      if (response.ok) {\n        const html = await response.text();\n        \n        // 在新視窗中開啟物流選擇頁面\n        const logisticsWindow = window.open('', 'ecpay_logistics', 'width=900,height=700,scrollbars=yes,resizable=yes');\n        if (logisticsWindow) {\n          logisticsWindow.document.write(html);\n          logisticsWindow.document.close();\n        } else {\n          alert('請允許彈出視窗以開啟物流選擇頁面');\n        }\n      } else {\n        // 更好的錯誤處理\n        let errorMessage = '物流選擇頁面生成失敗';\n        try {\n          const errorData = await response.json();\n          errorMessage = errorData.message || errorMessage;\n        } catch (e) {\n          // 如果回應不是 JSON，使用狀態文字\n          errorMessage = `${response.status} ${response.statusText}`;\n        }\n        throw new Error(errorMessage);\n      }\n\n    } catch (error: any) {\n      console.error('❌ 開啟物流選擇頁面失敗:', error);\n      alert(`開啟物流選擇頁面失敗: ${error.message}`);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  // 注意：使用物流選擇頁面後，門市選擇結果將透過回調 URL 處理\n  // 這裡不再需要監聽 postMessage 事件\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"bg-white p-6 rounded-lg border\">\n        <h3 className=\"text-lg font-semibold mb-4\">選擇取貨方式</h3>\n        \n        <div className=\"space-y-3\">\n          {logisticsOptions.map((option) => (\n            <label\n              key={option.value}\n              className=\"flex items-center space-x-3 p-3 border rounded-lg hover:bg-gray-50 cursor-pointer\"\n            >\n              <input\n                type=\"radio\"\n                name=\"logistics\"\n                value={option.value}\n                checked={selectedLogistics === option.value}\n                onChange={(e) => setSelectedLogistics(e.target.value)}\n                className=\"w-4 h-4 text-blue-600\"\n              />\n              <div className=\"flex items-center space-x-3 flex-1\">\n                <span className=\"text-2xl\">{option.icon}</span>\n                <div>\n                  <div className=\"font-medium\">{option.label}</div>\n                  <div className=\"text-sm text-gray-600\">{option.description}</div>\n                </div>\n              </div>\n            </label>\n          ))}\n        </div>\n\n        <button\n          onClick={openLogisticsSelection}\n          disabled={isLoading}\n          className=\"mt-4 w-full bg-blue-600 hover:bg-blue-700 disabled:opacity-50 text-white py-3 px-4 rounded-lg font-medium transition-colors\"\n        >\n          {isLoading ? '開啟選擇頁面中...' : '� 選擇取貨門市'}\n        </button>\n      </div>\n\n      {selectedStore && (\n        <div className=\"bg-green-50 border border-green-200 p-4 rounded-lg\">\n          <div className=\"flex items-start space-x-3\">\n            <div className=\"w-5 h-5 bg-green-600 rounded-full flex items-center justify-center mt-1 flex-shrink-0\">\n              <svg className=\"w-3 h-3 text-white\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                <path fillRule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clipRule=\"evenodd\" />\n              </svg>\n            </div>\n            <div className=\"space-y-1\">\n              <h4 className=\"font-semibold text-green-800\">已選擇門市</h4>\n              <div className=\"text-sm text-green-700\">\n                <div className=\"font-medium\">{selectedStore.CVSStoreName}</div>\n                <div>門市編號: {selectedStore.CVSStoreID}</div>\n                <div>地址: {selectedStore.CVSAddress}</div>\n                {selectedStore.CVSTelephone && (\n                  <div>電話: {selectedStore.CVSTelephone}</div>\n                )}\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default StoreSelector;\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/checkout/components/submit-button/index.tsx","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":26,"column":24,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":26,"endColumn":26,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[561,563],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { Button } from \"@medusajs/ui\"\nimport React from \"react\"\nimport { useFormStatus } from \"react-dom\"\n\nexport function SubmitButton({\n  children,\n  variant = \"primary\",\n  className,\n  \"data-testid\": dataTestId,\n}: {\n  children: React.ReactNode\n  variant?: \"primary\" | \"secondary\" | \"transparent\" | \"danger\" | null\n  className?: string\n  \"data-testid\"?: string\n}) {\n  const { pending } = useFormStatus()\n\n  return (\n    <Button\n      size=\"large\"\n      className={className}\n      type=\"submit\"\n      isLoading={pending}\n      variant={variant || \"primary\"}\n      data-testid={dataTestId}\n    >\n      {children}\n    </Button>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/checkout/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/checkout/templates/checkout-form/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/checkout/templates/checkout-summary/index.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":8,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[342,345],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[342,345],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Heading } from \"@medusajs/ui\"\n\nimport ItemsPreviewTemplate from \"@modules/cart/templates/preview\"\nimport DiscountCode from \"@modules/checkout/components/discount-code\"\nimport CartTotals from \"@modules/common/components/cart-totals\"\nimport Divider from \"@modules/common/components/divider\"\n\nconst CheckoutSummary = ({ cart }: { cart: any }) => {\n  return (\n    <div className=\"sticky top-0 flex flex-col-reverse small:flex-col gap-y-8 py-8 small:py-0 \">\n      <div className=\"w-full bg-white flex flex-col\">\n        <Divider className=\"my-6 small:hidden\" />\n        <Heading\n          level=\"h2\"\n          className=\"flex flex-row text-3xl-regular items-baseline\"\n        >\n          In your Cart\n        </Heading>\n        <Divider className=\"my-6\" />\n        <CartTotals totals={cart} />\n        <ItemsPreviewTemplate cart={cart} />\n        <div className=\"my-6\">\n          <DiscountCode cart={cart} />\n        </div>\n      </div>\n    </div>\n  )\n}\n\nexport default CheckoutSummary","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/checkout/templates/index.tsx","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":25,"column":42,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":25,"endColumn":44,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[966,968],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":27,"column":74,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":77,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1168,1171],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1168,1171],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":30,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":30,"endColumn":16,"suggestions":[{"fix":{"range":[1204,1259],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":32,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":32,"endColumn":18,"suggestions":[{"fix":{"range":[1286,1333],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":34,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":34,"endColumn":20,"suggestions":[{"fix":{"range":[1401,1448],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":38,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":38,"endColumn":22,"suggestions":[{"fix":{"range":[1572,1606],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":42,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":42,"endColumn":22,"suggestions":[{"fix":{"range":[1695,1748],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":49,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":49,"endColumn":20,"suggestions":[{"fix":{"range":[1896,1942],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":51,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":51,"endColumn":22,"suggestions":[{"fix":{"range":[2020,2066],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":64,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":64,"endColumn":24,"suggestions":[{"fix":{"range":[2520,2564],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":68,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":68,"endColumn":24,"suggestions":[{"fix":{"range":[2680,2707],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":71,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":71,"endColumn":24,"suggestions":[{"fix":{"range":[2760,2812],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":81,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":81,"endColumn":22,"suggestions":[{"fix":{"range":[3093,3122],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":92,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":92,"endColumn":20,"suggestions":[{"fix":{"range":[3368,3400],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":95,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":95,"endColumn":18,"suggestions":[{"fix":{"range":[3428,3465],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":158,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":158,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5426,5429],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5426,5429],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'router' is defined but never used.","line":162,"column":46,"nodeType":null,"messageId":"unusedVar","endLine":162,"endColumn":52},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'router' is defined but never used. Allowed unused args must match /^_/u.","line":162,"column":46,"nodeType":null,"messageId":"unusedVar","endLine":162,"endColumn":52},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'pathname' is defined but never used.","line":162,"column":54,"nodeType":null,"messageId":"unusedVar","endLine":162,"endColumn":62},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'pathname' is defined but never used. Allowed unused args must match /^_/u.","line":162,"column":54,"nodeType":null,"messageId":"unusedVar","endLine":162,"endColumn":62},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'isAccessible' is assigned a value but never used.","line":191,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":191,"endColumn":29},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'isAccessible' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":191,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":191,"endColumn":29}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":15,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { useSearchParams } from \"next/navigation\"\nimport type { HttpTypes } from \"@medusajs/types\"\nimport { useEffect, useState } from \"react\"\nimport { usePathname, useRouter } from \"next/navigation\"\nimport { listCartShippingMethods } from \"../../../lib/data/fulfillment\"\nimport { listCartPaymentMethods } from \"../../../lib/data/payment\"\nimport Addresses from \"../components/addresses\"\nimport Shipping from \"../components/shipping\"\nimport Payment from \"../components/payment\"\nimport OrderConfirmed from \"../components/order-confirmed\"\nimport Review from \"../components/review\"\nimport OrderSummary from \"./order-summary\"\n\ntype CheckoutTemplateProps = {\n  cart: HttpTypes.StoreCart | null\n  customer: HttpTypes.StoreCustomer | null\n}\n\nconst CheckoutTemplate = ({ cart, customer }: CheckoutTemplateProps) => {\n  const searchParams = useSearchParams()\n  const router = useRouter()\n  const pathname = usePathname()\n  const step = searchParams?.get(\"step\") || \"address\"\n  const [availableShippingMethods, setAvailableShippingMethods] = useState<HttpTypes.StoreCartShippingOption[]>([])\n  const [availablePaymentMethods, setAvailablePaymentMethods] = useState<any[]>([])\n\n  useEffect(() => {\n    console.log(\"🛒 CheckoutTemplate - cart.id:\", cart?.id)\n    if (cart?.id) {\n      console.log(\"📞 呼叫 listCartShippingMethods...\")\n      listCartShippingMethods(cart.id).then((methods) => {\n        console.log(\"📦 收到 shipping methods:\", methods)\n        if (methods && Array.isArray(methods)) {\n          setAvailableShippingMethods(methods)\n        } else {\n          console.log(\"⚠️ 配送方式為空或無效，設置為空陣列\")\n          setAvailableShippingMethods([])\n        }\n      }).catch((error) => {\n        console.error(\"❌ listCartShippingMethods 錯誤:\", error)\n        // 即使出錯也設置為空陣列，不阻止用戶操作\n        setAvailableShippingMethods([])\n      })\n\n      // 加載付款方式 - 目前主要提供銀行轉帳\n      if (cart.region?.id) {\n        console.log(\"💳 呼叫 listCartPaymentMethods...\")\n        listCartPaymentMethods(cart.region.id).then((methods) => {\n          console.log(\"💳 收到 payment methods:\", methods)\n          \n          // 總是提供銀行轉帳選項，無論後端返回什麼\n          const bankTransferMethod = {\n            id: 'pp_bank_transfer',\n            provider_id: 'pp_bank_transfer',\n            is_enabled: true\n          }\n          \n          if (methods && Array.isArray(methods) && methods.length > 0) {\n            // 合併後端方法和銀行轉帳\n            const combinedMethods = [bankTransferMethod, ...methods]\n            setAvailablePaymentMethods(combinedMethods)\n            console.log(\"💳 設置組合付款方式:\", combinedMethods)\n          } else {\n            // 只提供銀行轉帳\n            setAvailablePaymentMethods([bankTransferMethod])\n            console.log(\"💳 只設置銀行轉帳選項\")\n          }\n        }).catch((error) => {\n          console.error(\"❌ listCartPaymentMethods 錯誤:\", error)\n          // 出錯時提供銀行轉帳\n          const fallbackMethods = [\n            {\n              id: 'pp_bank_transfer', \n              provider_id: 'pp_bank_transfer',\n              is_enabled: true\n            }\n          ]\n          setAvailablePaymentMethods(fallbackMethods)\n          console.log(\"💳 錯誤回退，設置銀行轉帳\")\n        })\n      } else {\n        // 沒有region時也提供銀行轉帳\n        setAvailablePaymentMethods([\n          {\n            id: 'pp_bank_transfer',\n            provider_id: 'pp_bank_transfer', \n            is_enabled: true\n          }\n        ])\n        console.log(\"💳 無region，預設銀行轉帳\")\n      }\n    } else {\n      console.log(\"⚠️ 沒有 cart.id，無法獲取配送方式\")\n      setAvailableShippingMethods([])\n      setAvailablePaymentMethods([])\n    }\n  }, [cart?.id, cart?.region?.id])\n\n  if (!cart) {\n    return null\n  }\n\n  return (\n    <div className=\"min-h-screen bg-ui-bg-subtle\" data-testid=\"checkout-page\">\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-x-40 py-12\">\n          {/* Left side - Checkout form */}\n          <div className=\"w-full\" data-testid=\"checkout-form\">\n            {/* Steps indicator */}\n            <div className=\"mb-8\">\n              <StepsIndicator currentStep={step} cart={cart} router={router} pathname={pathname} />\n            </div>\n\n            {/* Step content */}\n            <div className=\"min-h-[400px]\">\n              {step === \"address\" && (\n                <Addresses\n                  cart={cart}\n                  customer={customer}\n                />\n              )}\n              {step === \"delivery\" && (\n                <Shipping cart={cart} availableShippingMethods={availableShippingMethods} />\n              )}\n              {step === \"payment\" && (\n                <Payment cart={cart} availablePaymentMethods={availablePaymentMethods} />\n              )}\n              {step === \"order-confirmed\" && (\n                <OrderConfirmed />\n              )}\n              {step === \"review\" && (\n                <Review cart={cart} />\n              )}\n              {step === \"step4\" && (\n                /* 這裡可以放步驟4的內容 */\n                <div>hahah</div>\n              )}\n            </div>\n          </div>\n\n          {/* Right side - Order summary */}\n          <div className=\"relative\" data-testid=\"checkout-summary\">\n            <div className=\"flex flex-col sticky top-8\">\n              <OrderSummary cart={cart} />\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}\n\ntype StepsIndicatorProps = {\n  currentStep: string\n  cart: HttpTypes.StoreCart\n  router: any\n  pathname: string\n}\n\nconst StepsIndicator = ({ currentStep, cart, router, pathname }: StepsIndicatorProps) => {\n  const steps = [\n    { id: \"address\", name: \"配送地址\", completed: false },\n    { id: \"delivery\", name: \"配送方式\", completed: false },\n    { id: \"payment\", name: \"付款方式\", completed: false },\n    { id: \"review\", name: \"檢視訂單\", completed: false },\n  ]\n\n  // Determine completion status based on cart state\n  const hasAddress = !!(cart.shipping_address && cart.email)\n  const hasShipping = !!(cart.shipping_methods && cart.shipping_methods.length > 0)\n  const hasPayment = !!(cart.payment_collection?.payment_sessions && cart.payment_collection.payment_sessions.length > 0)\n\n  const currentStepIndex = steps.findIndex(step => step.id === currentStep)\n\n  // 根據當前步驟和購物車狀態決定完成狀態\n  // 只有在已完成且不是當前步驟時才標記為完成\n  steps[0].completed = hasAddress && currentStepIndex > 0\n  steps[1].completed = hasAddress && hasShipping && currentStepIndex > 1\n  steps[2].completed = hasAddress && hasShipping && hasPayment && currentStepIndex > 2\n  steps[3].completed = hasAddress && hasShipping && hasPayment && currentStep === \"review\"\n\n  return (\n    <nav aria-label=\"結帳步驟\" className=\"mb-8\">\n      <ol className=\"flex items-center space-x-8\">\n        {steps.map((step, index) => {\n          const isCurrent = step.id === currentStep\n          const isCompleted = step.completed\n          // 只允許訪問當前步驟及之前的步驟（如果已完成的話）\n          const isAccessible = index <= currentStepIndex || isCompleted\n          // 如果用戶返回到之前的步驟，後面的步驟不應顯示為已完成\n          const shouldShowAsCompleted = isCompleted && !isCurrent\n\n          return (\n            <li key={step.id} className=\"flex items-center\">\n              <div className=\"flex items-center\">\n                <div\n                  className={`\n                    flex items-center justify-center w-8 h-8 rounded-full border-2 text-sm font-medium\n                    ${\n                      isCurrent\n                        ? \"bg-gray-900 border-gray-900 text-white\"\n                        : shouldShowAsCompleted\n                        ? \"bg-gray-900 border-gray-900 text-white\"\n                        : \"bg-gray-200 border-gray-300 text-gray-700\"\n                    }\n                  `}\n                >\n                  {shouldShowAsCompleted ? (\n                    <svg className=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                      <path\n                        fillRule=\"evenodd\"\n                        d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\"\n                        clipRule=\"evenodd\"\n                      />\n                    </svg>\n                  ) : (\n                    index + 1\n                  )}\n                </div>\n                <span\n                  className={`\n                    ml-3 text-sm font-medium\n                    ${\n                      isCurrent\n                        ? \"text-ui-fg-base\"\n                        : shouldShowAsCompleted\n                        ? \"text-ui-fg-subtle\"\n                        : \"text-ui-fg-muted\"\n                    }\n                  `}\n                >\n                  {step.name}\n                </span>\n              </div>\n              {index < steps.length - 1 && (\n                <div className=\"ml-8 w-8 h-px bg-ui-border-base\" />\n              )}\n            </li>\n          )\n        })}\n      </ol>\n    </nav>\n  )\n}\n\nexport default CheckoutTemplate\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/checkout/templates/order-summary.tsx","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":12,"column":79,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":12,"endColumn":81,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[398,400],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":28,"column":49,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":28,"endColumn":51,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[916,918],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { HttpTypes } from \"@medusajs/types\"\nimport CartTotals from \"@modules/common/components/cart-totals\"\nimport ItemsPreviewTemplate from \"@modules/cart/components/items-preview-template\"\n\ntype OrderSummaryProps = {\n  cart: HttpTypes.StoreCart\n}\n\nconst OrderSummary = ({ cart }: OrderSummaryProps) => {\n  const itemCount = cart.items?.reduce((acc, item) => acc + item.quantity, 0) || 0\n\n  return (\n    <div className=\"bg-white rounded-lg border border-ui-border-base p-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between mb-6 pb-4 border-b border-ui-border-base\">\n        <h2 className=\"text-xl font-semibold text-ui-fg-base\">\n          訂單摘要\n        </h2>\n        <span className=\"text-sm text-ui-fg-subtle\">\n          {itemCount} 件商品\n        </span>\n      </div>\n\n      {/* Items preview */}\n      <div className=\"mb-6\">\n        <ItemsPreviewTemplate items={cart.items || []} />\n      </div>\n\n      {/* Divider */}\n      <div className=\"border-t border-ui-border-base mb-6\" />\n\n      {/* Cart totals */}\n      <div className=\"space-y-4\">\n        <CartTotals totals={cart} />\n      </div>\n\n      {/* Additional info */}\n      <div className=\"mt-6 pt-4 border-t border-ui-border-base\">\n        <div className=\"text-xs text-ui-fg-subtle space-y-1\">\n          <p>* 稅金已包含在總價中</p>\n          <p>* 運費將在選擇配送方式後計算</p>\n        </div>\n      </div>\n    </div>\n  )\n}\n\nexport default OrderSummary\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/collections/templates/index.tsx","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":20,"column":23,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":20,"endColumn":25,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[601,603],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Suspense } from \"react\"\n\nimport SkeletonProductGrid from \"../../skeletons/templates/skeleton-product-grid/index\"\nimport { SortOptions } from \"../../store/components/refinement-list/sort-products/index\"\nimport PaginatedProducts from \"../../store/templates/paginated-products\"\nimport { HttpTypes } from \"@medusajs/types\"\n\nexport default function CollectionTemplate({\n  sortBy,\n  collection,\n  page,\n  countryCode,\n}: {\n  sortBy?: SortOptions\n  collection: HttpTypes.StoreCollection\n  page?: string\n  countryCode: string\n}) {\n  const pageNumber = page ? parseInt(page) : 1\n  const sort = sortBy || \"created_at\"\n\n  return (\n    <div className=\"pt-0 pb-8\">\n      <Suspense\n        fallback={\n          <SkeletonProductGrid\n            numberOfProducts={collection.products?.length}\n          />\n        }\n      >\n        <PaginatedProducts\n          sortBy={sort}\n          page={pageNumber}\n          collectionId={collection.id}\n          countryCode={countryCode}\n          hideRefinementList={true}\n        />\n      </Suspense>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/common/components/cart-totals/index.tsx","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":37,"column":66,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":37,"endColumn":68,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[920,922],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":56,"column":75,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":56,"endColumn":77,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1632,1634],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":62,"column":64,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":62,"endColumn":66,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1928,1930],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":86,"column":29,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":86,"endColumn":31,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2804,2806],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { convertToLocale } from \"@lib/util/money\"\nimport React from \"react\"\n\ntype CartTotalsProps = {\n  totals: {\n    total?: number | null\n    subtotal?: number | null\n    tax_total?: number | null\n    shipping_total?: number | null\n    discount_total?: number | null\n    gift_card_total?: number | null\n    currency_code: string\n    shipping_subtotal?: number | null\n  }\n}\n\nconst CartTotals: React.FC<CartTotalsProps> = ({ totals }) => {\n  const {\n    currency_code,\n    total,\n    subtotal,\n    tax_total,\n    discount_total,\n    gift_card_total,\n    shipping_subtotal,\n  } = totals\n\n  return (\n    <div>\n      <div className=\"flex flex-col gap-y-2 txt-medium text-ui-fg-subtle \">\n        <div className=\"flex items-center justify-between\">\n          <span className=\"flex gap-x-1 items-center\">\n            小計（不含運費和稅額）\n          </span>\n          <span data-testid=\"cart-subtotal\" data-value={subtotal || 0}>\n            {convertToLocale({ amount: subtotal ?? 0, currency_code })}\n          </span>\n        </div>\n        {!!discount_total && (\n          <div className=\"flex items-center justify-between\">\n            <span>折扣</span>\n            <span\n              className=\"text-ui-fg-interactive\"\n              data-testid=\"cart-discount\"\n              data-value={discount_total || 0}\n            >\n              -{\" \"}\n              {convertToLocale({ amount: discount_total ?? 0, currency_code })}\n            </span>\n          </div>\n        )}\n        <div className=\"flex items-center justify-between\">\n          <span>運費</span>\n          <span data-testid=\"cart-shipping\" data-value={shipping_subtotal || 0}>\n            {convertToLocale({ amount: shipping_subtotal ?? 0, currency_code })}\n          </span>\n        </div>\n        <div className=\"flex justify-between\">\n          <span className=\"flex gap-x-1 items-center \">稅額</span>\n          <span data-testid=\"cart-taxes\" data-value={tax_total || 0}>\n            {convertToLocale({ amount: tax_total ?? 0, currency_code })}\n          </span>\n        </div>\n        {!!gift_card_total && (\n          <div className=\"flex items-center justify-between\">\n            <span>禮品卡</span>\n            <span\n              className=\"text-ui-fg-interactive\"\n              data-testid=\"cart-gift-card-amount\"\n              data-value={gift_card_total || 0}\n            >\n              -{\" \"}\n              {convertToLocale({ amount: gift_card_total ?? 0, currency_code })}\n            </span>\n          </div>\n        )}\n      </div>\n      <div className=\"h-px w-full border-b border-gray-200 my-4\" />\n      <div className=\"flex items-center justify-between text-ui-fg-base mb-2 txt-medium \">\n        <span>總計</span>\n        <span\n          className=\"txt-xlarge-plus\"\n          data-testid=\"cart-total\"\n          data-value={total || 0}\n        >\n          {convertToLocale({ amount: total ?? 0, currency_code })}\n        </span>\n      </div>\n      <div className=\"h-px w-full border-b border-gray-200 mt-4\" />\n    </div>\n  )\n}\n\nexport default CartTotals\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/common/components/checkbox/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/common/components/delete-button/index.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":19,"column":37,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":40},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'err' is defined but never used. Allowed unused args must match /^_/u.","line":19,"column":37,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":40}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { deleteLineItem } from \"@lib/data/cart\"\nimport { Spinner, Trash } from \"@medusajs/icons\"\nimport { clx } from \"@medusajs/ui\"\nimport { useState } from \"react\"\n\nconst DeleteButton = ({\n  id,\n  children,\n  className,\n}: {\n  id: string\n  children?: React.ReactNode\n  className?: string\n}) => {\n  const [isDeleting, setIsDeleting] = useState(false)\n\n  const handleDelete = async (id: string) => {\n    setIsDeleting(true)\n    await deleteLineItem(id).catch((err) => {\n      setIsDeleting(false)\n    })\n  }\n\n  return (\n    <div\n      className={clx(\n        \"flex items-center justify-between text-small-regular\",\n        className\n      )}\n    >\n      <button\n        className=\"flex gap-x-1 text-ui-fg-subtle hover:text-ui-fg-base cursor-pointer\"\n        onClick={() => handleDelete(id)}\n      >\n        {isDeleting ? <Spinner className=\"animate-spin\" /> : <Trash />}\n        <span>{children}</span>\n      </button>\n    </div>\n  )\n}\n\nexport default DeleteButton\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/common/components/divider/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/common/components/filter-radio-group/index.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":10,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[221,224],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[221,224],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":11,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[251,254],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[251,254],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { EllipseMiniSolid } from \"@medusajs/icons\"\nimport { Label, RadioGroup, Text, clx } from \"@medusajs/ui\"\n\ntype FilterRadioGroupProps = {\n  title: string\n  items: {\n    value: string\n    label: string\n  }[]\n  value: any\n  handleChange: (...args: any[]) => void\n  \"data-testid\"?: string\n}\n\nconst FilterRadioGroup = ({\n  title,\n  items,\n  value,\n  handleChange,\n  \"data-testid\": dataTestId,\n}: FilterRadioGroupProps) => {\n  return (\n    <div className=\"flex flex-col\">\n      {title && <Text className=\"txt-compact-small-plus text-ui-fg-muted text-center mb-4\">{title}</Text>}\n      <RadioGroup data-testid={dataTestId} onValueChange={handleChange} className=\"grid grid-cols-3 gap-x-2 w-full\">\n        {items?.map((i) => (\n          <div\n            key={i.value}\n            className={clx(\"flex gap-x-2 items-center justify-center\", {\n              \"ml-[-23px]\": i.value === value,\n            })}\n          >\n            {i.value === value && <EllipseMiniSolid />}\n            <RadioGroup.Item\n              checked={i.value === value}\n              className=\"hidden peer\"\n              id={i.value}\n              value={i.value}\n            />\n            <Label\n              htmlFor={i.value}\n              className={clx(\n                \"!txt-compact-small !transform-none text-ui-fg-subtle hover:cursor-pointer text-center whitespace-nowrap\",\n                {\n                  \"text-ui-fg-base\": i.value === value,\n                }\n              )}\n              data-testid=\"radio-label\"\n              data-active={i.value === value}\n            >\n              {i.label}\n            </Label>\n          </div>\n        ))}\n      </RadioGroup>\n    </div>\n  )\n}\n\nexport default FilterRadioGroup\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/common/components/global-store-name/index.tsx","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":4,"column":56,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":4,"endColumn":58,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[169,171],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\n\nexport default function GlobalStoreName({ className = '' }: { className?: string }) {\n  const storeName = process.env.NEXT_PUBLIC_STORE_NAME || '蒂蒂安美髮沙龍';\n  \n  return (\n    <span className={className}>\n      {storeName}\n    </span>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/common/components/input/index.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'touched' is defined but never used.","line":19,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":32},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'touched' is defined but never used. Allowed unused args must match /^_/u.","line":19,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":32},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":34,"column":36,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":34,"endColumn":53}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Label } from \"@medusajs/ui\"\nimport React, { useEffect, useImperativeHandle, useState } from \"react\"\n\nimport Eye from \"@modules/common/icons/eye\"\nimport EyeOff from \"@modules/common/icons/eye-off\"\n\ntype InputProps = Omit<\n  Omit<React.InputHTMLAttributes<HTMLInputElement>, \"size\">,\n  \"placeholder\"\n> & {\n  label: string\n  errors?: Record<string, unknown>\n  touched?: Record<string, unknown>\n  name: string\n  topLabel?: string\n}\n\nconst Input = React.forwardRef<HTMLInputElement, InputProps>(\n  ({ type, name, label, touched, required, topLabel, ...props }, ref) => {\n    const inputRef = React.useRef<HTMLInputElement>(null)\n    const [showPassword, setShowPassword] = useState(false)\n    const [inputType, setInputType] = useState(type)\n\n    useEffect(() => {\n      if (type === \"password\" && showPassword) {\n        setInputType(\"text\")\n      }\n\n      if (type === \"password\" && !showPassword) {\n        setInputType(\"password\")\n      }\n    }, [type, showPassword])\n\n    useImperativeHandle(ref, () => inputRef.current!)\n\n    return (\n      <div className=\"flex flex-col w-full\">\n        {topLabel && (\n          <Label className=\"mb-2 txt-compact-medium-plus\">{topLabel}</Label>\n        )}\n        <div className=\"flex relative z-0 w-full txt-compact-medium\">\n          <input\n            type={inputType}\n            name={name}\n            placeholder=\" \"\n            required={required}\n            className=\"pt-4 pb-1 block w-full h-11 px-4 mt-0 bg-ui-bg-field border rounded-md appearance-none focus:outline-none focus:ring-0 focus:shadow-borders-interactive-with-active border-ui-border-base hover:bg-ui-bg-field-hover\"\n            {...props}\n            ref={inputRef}\n          />\n          <label\n            htmlFor={name}\n            onClick={() => inputRef.current?.focus()}\n            className=\"flex items-center justify-center mx-3 px-1 transition-all absolute duration-300 top-3 -z-1 origin-0 text-ui-fg-subtle\"\n          >\n            {label}\n            {required && <span className=\"text-rose-500\">*</span>}\n          </label>\n          {type === \"password\" && (\n            <button\n              type=\"button\"\n              onClick={() => setShowPassword(!showPassword)}\n              className=\"text-ui-fg-subtle px-4 focus:outline-none transition-all duration-150 outline-none focus:text-ui-fg-base absolute right-0 top-3\"\n            >\n              {showPassword ? <Eye /> : <EyeOff />}\n            </button>\n          )}\n        </div>\n      </div>\n    )\n  }\n)\n\nInput.displayName = \"Input\"\n\nexport default Input\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/common/components/interactive-link/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/common/components/line-item-options/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/common/components/line-item-price/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/common/components/line-item-unit-price/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/common/components/localized-client-link/index.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":21,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[465,468],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[465,468],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport Link from \"next/link\"\nimport { useParams } from \"next/navigation\"\nimport React from \"react\"\n\n/**\n * Use this component to create a Next.js `<Link />` that persists the current country code in the url,\n * without having to explicitly pass it as a prop.\n */\nconst LocalizedClientLink = ({\n  children,\n  href,\n  ...props\n}: {\n  children?: React.ReactNode\n  href: string\n  className?: string\n  onClick?: () => void\n  passHref?: true\n  [x: string]: any\n}) => {\n  const { countryCode: rawCountryCode } = useParams()\n  \n  // 確保 countryCode 有效，如果無效則使用默認值\n  const countryCode = rawCountryCode && \n                     typeof rawCountryCode === 'string' &&\n                     rawCountryCode !== 'api' && \n                     rawCountryCode.length === 2 && \n                     /^[a-z]{2}$/.test(rawCountryCode) \n                     ? rawCountryCode \n                     : 'tw'\n\n  // 避免重複添加 countryCode\n  const finalHref = href.startsWith(`/${countryCode}`) \n    ? href \n    : `/${countryCode}${href}`\n\n  return (\n    <Link href={finalHref} {...props}>\n      {children}\n    </Link>\n  )\n}\n\nexport default LocalizedClientLink\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/common/components/modal/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/common/components/native-select/index.tsx","messages":[{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":32,"column":11,"nodeType":null,"messageId":"preferOptionalChain","endLine":32,"endColumn":60,"fix":{"range":[821,870],"text":"innerRef.current?.value === \"\""}}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import { ChevronUpDown } from \"@medusajs/icons\"\nimport { clx } from \"@medusajs/ui\"\nimport {\n  SelectHTMLAttributes,\n  forwardRef,\n  useEffect,\n  useImperativeHandle,\n  useRef,\n  useState,\n} from \"react\"\n\nexport type NativeSelectProps = {\n  placeholder?: string\n  errors?: Record<string, unknown>\n  touched?: Record<string, unknown>\n} & SelectHTMLAttributes<HTMLSelectElement>\n\nconst NativeSelect = forwardRef<HTMLSelectElement, NativeSelectProps>(\n  (\n    { placeholder = \"Select...\", defaultValue, className, children, ...props },\n    ref\n  ) => {\n    const innerRef = useRef<HTMLSelectElement>(null)\n    const [isPlaceholder, setIsPlaceholder] = useState(false)\n\n    useImperativeHandle<HTMLSelectElement | null, HTMLSelectElement | null>(\n      ref,\n      () => innerRef.current\n    )\n\n    useEffect(() => {\n      if (innerRef.current && innerRef.current.value === \"\") {\n        setIsPlaceholder(true)\n      } else {\n        setIsPlaceholder(false)\n      }\n    }, [innerRef.current?.value])\n\n    return (\n      <div>\n        <div\n          onFocus={() => innerRef.current?.focus()}\n          onBlur={() => innerRef.current?.blur()}\n          className={clx(\n            \"relative flex items-center text-base-regular border border-ui-border-base bg-ui-bg-subtle rounded-md hover:bg-ui-bg-field-hover\",\n            className,\n            {\n              \"text-ui-fg-muted\": isPlaceholder,\n            }\n          )}\n        >\n          <select\n            ref={innerRef}\n            defaultValue={defaultValue}\n            {...props}\n            className=\"appearance-none flex-1 bg-transparent border-none px-4 py-2.5 transition-colors duration-150 outline-none \"\n          >\n            <option disabled value=\"\">\n              {placeholder}\n            </option>\n            {children}\n          </select>\n          <span className=\"absolute right-4 inset-y-0 flex items-center pointer-events-none \">\n            <ChevronUpDown />\n          </span>\n        </div>\n      </div>\n    )\n  }\n)\n\nNativeSelect.displayName = \"NativeSelect\"\n\nexport default NativeSelect\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/common/components/radio/index.tsx","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":10,"column":33,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":10,"endColumn":35,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[388,390],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const Radio = ({ checked, 'data-testid': dataTestId }: { checked: boolean, 'data-testid'?: string }) => {\n  return (\n    <>\n      <button\n        type=\"button\"\n        role=\"radio\"\n        aria-checked={checked}\n        data-state={checked ? \"checked\" : \"unchecked\"}\n        className=\"group relative flex h-5 w-5 items-center justify-center outline-none\"\n        data-testid={dataTestId || 'radio-button'}\n      >\n        <div className={`\n          flex h-[14px] w-[14px] items-center justify-center rounded-full border-2 transition-all\n          ${checked \n            ? 'bg-blue-500 border-blue-500' \n            : 'bg-white border-gray-300 hover:border-gray-400'\n          }\n        `}>\n          {checked && (\n            <div className=\"bg-white rounded-full h-1.5 w-1.5\"></div>\n          )}\n        </div>\n      </button>\n    </>\n  )\n}\n\nexport default Radio\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/common/components/sanity-content/index.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":6,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[152,155],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[152,155],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":12,"column":26,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":12,"endColumn":28,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[299,301],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":22,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[510,513],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[510,513],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":32,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[789,792],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[789,792],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":33,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[877,880],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[877,880],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":34,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[965,968],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[965,968],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":35,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1052,1055],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1052,1055],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":36,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1143,1146],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1143,1146],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":37,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1248,1251],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1248,1251],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":44,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1421,1424],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1421,1424],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":45,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1526,1529],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1526,1529],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":48,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1653,1656],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1653,1656],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":49,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1735,1738],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1735,1738],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":54,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1840,1843],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1840,1843],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":55,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1875,1878],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1875,1878],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":60,"column":34,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":60,"endColumn":36,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2044,2046],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":14,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { PortableText } from '@portabletext/react'\nimport Image from 'next/image'\n\nconst myPortableTextComponents = {\n  types: {\n    image: ({ value }: any) => {\n      if (!value?.asset?.url) return null;\n      \n      return (\n        <Image\n          src={value.asset.url}\n          alt={value.alt || \"Blog image\"}\n          width={800}\n          height={600}\n          className=\"w-full h-auto rounded-lg my-4\"\n          unoptimized\n        />\n      );\n    },\n  },\n  marks: {\n    link: ({ children, value }: any) => {\n      const rel = !value.href.startsWith('/') ? 'noreferrer noopener' : undefined;\n      return (\n        <a href={value.href} rel={rel} className=\"text-blue-600 hover:underline\">\n          {children}\n        </a>\n      );\n    },\n  },\n  block: {\n    h1: ({ children }: any) => <h1 className=\"text-3xl font-bold mb-4\">{children}</h1>,\n    h2: ({ children }: any) => <h2 className=\"text-2xl font-bold mb-3\">{children}</h2>,\n    h3: ({ children }: any) => <h3 className=\"text-xl font-bold mb-2\">{children}</h3>,\n    h4: ({ children }: any) => <h4 className=\"text-lg font-bold mb-2\">{children}</h4>,\n    normal: ({ children }: any) => <p className=\"mb-4 text-gray-700 leading-relaxed\">{children}</p>,\n    blockquote: ({ children }: any) => (\n      <blockquote className=\"border-l-4 border-gray-300 pl-4 italic my-4\">\n        {children}\n      </blockquote>\n    ),\n  },\n  list: {\n    bullet: ({ children }: any) => <ul className=\"list-disc list-inside mb-4 space-y-2\">{children}</ul>,\n    number: ({ children }: any) => <ol className=\"list-decimal list-inside mb-4 space-y-2\">{children}</ol>,\n  },\n  listItem: {\n    bullet: ({ children }: any) => <li className=\"text-gray-700\">{children}</li>,\n    number: ({ children }: any) => <li className=\"text-gray-700\">{children}</li>,\n  },\n}\n\ninterface SanityContentProps {\n  content: any; // PortableText 內容\n  blocks?: any; // 向後兼容\n}\n\nexport default function SanityContent({ content, blocks }: SanityContentProps) {\n  // 向後兼容：如果傳入 blocks，使用它；否則使用 content\n  const contentToRender = blocks || content;\n  \n  if (!contentToRender) {\n    return null;\n  }\n\n  return <PortableText value={contentToRender} components={myPortableTextComponents} />;\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/common/icons/back.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/common/icons/bancontact.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'size' is assigned a value but never used.","line":6,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":7},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'size' is assigned a value but never used. Allowed unused args must match /^_/u.","line":6,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":7}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from \"react\"\n\nimport { IconProps } from \"types/icon\"\n\nconst Ideal: React.FC<IconProps> = ({\n  size = \"20\",\n  color = \"currentColor\",\n  ...attributes\n}) => {\n  return (\n    <svg\n      width=\"24px\"\n      height=\"24px\"\n      viewBox=\"0 0 24 24\"\n      role=\"img\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n      fill={color}\n      {...attributes}\n    >\n      <title>Bancontact icon</title>\n      <path d=\"M21.385 9.768h-7.074l-4.293 5.022H1.557L3.84 12.1H1.122C.505 12.1 0 12.616 0 13.25v2.428c0 .633.505 1.15 1.122 1.15h12.933c.617 0 1.46-.384 1.874-.854l1.956-2.225 3.469-3.946.031-.035zm-1.123 1.279l-.751.855.75-.855zm2.616-3.875H9.982c-.617 0-1.462.384-1.876.853l-5.49 6.208h7.047l4.368-5.02h8.424l-2.263 2.689h2.686c.617 0 1.122-.518 1.122-1.151V8.323c0-.633-.505-1.15-1.122-1.15zm-1.87 3.024l-.374.427-.1.114.474-.54z\" />\n    </svg>\n  )\n}\n\nexport default Ideal\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/common/icons/bank.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/common/icons/chevron-down.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/common/icons/eye-off.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/common/icons/eye.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/common/icons/fast-delivery.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/common/icons/ideal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'size' is assigned a value but never used.","line":6,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":7},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'size' is assigned a value but never used. Allowed unused args must match /^_/u.","line":6,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":7}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from \"react\"\n\nimport { IconProps } from \"types/icon\"\n\nconst Ideal: React.FC<IconProps> = ({\n  size = \"20\",\n  color = \"currentColor\",\n  ...attributes\n}) => {\n  return (\n    <svg\n      width=\"20px\"\n      height=\"20px\"\n      viewBox=\"0 0 24 24\"\n      role=\"img\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n      fill={color}\n      {...attributes}\n    >\n      <title>iDEAL icon</title>\n      <path d=\"M.975 2.61v18.782h11.411c6.89 0 10.64-3.21 10.64-9.415 0-6.377-4.064-9.367-10.64-9.367H.975zm11.411-.975C22.491 1.635 24 8.115 24 11.977c0 6.7-4.124 10.39-11.614 10.39H0V1.635h12.386z M2.506 13.357h3.653v6.503H2.506z M6.602 10.082a2.27 2.27 0 1 1-4.54 0 2.27 2.27 0 0 1 4.54 0m1.396-1.057v2.12h.65c.45 0 .867-.13.867-1.077 0-.924-.463-1.043-.867-1.043h-.65zm10.85-1.054h1.053v3.174h1.56c-.428-5.758-4.958-7.002-9.074-7.002H7.999v3.83h.65c1.183 0 1.92.803 1.92 2.095 0 1.333-.719 2.129-1.92 2.129h-.65v7.665h4.388c6.692 0 9.021-3.107 9.103-7.665h-2.64V7.97zm-2.93 2.358h.76l-.348-1.195h-.063l-.35 1.195zm-1.643 1.87l1.274-4.228h1.497l1.274 4.227h-1.095l-.239-.818H15.61l-.24.818h-1.095zm-.505-1.054v1.052h-2.603V7.973h2.519v1.052h-1.467v.49h1.387v1.05H12.22v.58h1.55z\" />\n    </svg>\n  )\n}\n\nexport default Ideal\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/common/icons/map-pin.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/common/icons/medusa.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'size' is assigned a value but never used.","line":6,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":7},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'size' is assigned a value but never used. Allowed unused args must match /^_/u.","line":6,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":7}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from \"react\"\n\nimport { IconProps } from \"types/icon\"\n\nconst Medusa: React.FC<IconProps> = ({\n  size = \"20\",\n  color = \"#FFFFFF\",\n  ...attributes\n}) => {\n  return (\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      width=\"18\"\n      height=\"18\"\n      viewBox=\"0 0 18 18\"\n      fill=\"none\"\n      {...attributes}\n    >\n      <path\n        d=\"M15.2447 2.92183L11.1688 0.576863C9.83524 -0.192288 8.20112 -0.192288 6.86753 0.576863L2.77285 2.92183C1.45804 3.69098 0.631592 5.11673 0.631592 6.63627V11.345C0.631592 12.8833 1.45804 14.2903 2.77285 15.0594L6.84875 17.4231C8.18234 18.1923 9.81646 18.1923 11.15 17.4231L15.2259 15.0594C16.5595 14.2903 17.3672 12.8833 17.3672 11.345V6.63627C17.4048 5.11673 16.5783 3.69098 15.2447 2.92183ZM9.00879 13.1834C6.69849 13.1834 4.82019 11.3075 4.82019 9C4.82019 6.69255 6.69849 4.81657 9.00879 4.81657C11.3191 4.81657 13.2162 6.69255 13.2162 9C13.2162 11.3075 11.3379 13.1834 9.00879 13.1834Z\"\n        fill={color}\n      />\n    </svg>\n  )\n}\n\nexport default Medusa\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/common/icons/medusa/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/common/icons/nextjs.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'size' is assigned a value but never used.","line":6,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":7},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'size' is assigned a value but never used. Allowed unused args must match /^_/u.","line":6,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":7}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from \"react\"\n\nimport { IconProps } from \"types/icon\"\n\nconst NextJs: React.FC<IconProps> = ({\n  size = \"20\",\n  color = \"#FFFFFF\",\n  ...attributes\n}) => {\n  return (\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      width=\"18\"\n      height=\"18\"\n      viewBox=\"0 0 18 18\"\n      fill=\"none\"\n      {...attributes}\n    >\n      <path\n        d=\"M8.41117 0.0131402C8.3725 0.0166554 8.24946 0.0289589 8.13873 0.0377471C5.58488 0.267998 3.19273 1.64599 1.67764 3.76395C0.833977 4.94157 0.294381 6.27737 0.090495 7.69227C0.0184318 8.18617 0.00964355 8.33206 0.00964355 9.00172C0.00964355 9.67138 0.0184318 9.81726 0.090495 10.3112C0.579119 13.6876 2.98181 16.5244 6.24048 17.5755C6.82402 17.7636 7.43919 17.8919 8.13873 17.9692C8.41117 17.9991 9.58879 17.9991 9.86122 17.9692C11.0687 17.8356 12.0917 17.5368 13.1006 17.0218C13.2552 16.9427 13.2851 16.9216 13.264 16.9041C13.25 16.8935 12.5908 16.0094 11.7999 14.9408L10.3621 12.9986L8.56057 10.3323C7.56926 8.86638 6.75371 7.66767 6.74668 7.66767C6.73965 7.66591 6.73262 8.85056 6.7291 10.2971C6.72383 12.8299 6.72207 12.9318 6.69044 12.9916C6.64474 13.0777 6.60958 13.1128 6.53576 13.1515C6.47952 13.1796 6.43031 13.1849 6.1649 13.1849H5.86083L5.77998 13.1339C5.72725 13.1005 5.68858 13.0566 5.66222 13.0056L5.62531 12.9265L5.62882 9.40246L5.63409 5.87663L5.68858 5.80808C5.7167 5.77117 5.77646 5.72372 5.81865 5.70087C5.89071 5.66571 5.91883 5.6622 6.2229 5.6622C6.58146 5.6622 6.64122 5.67626 6.73438 5.7782C6.76074 5.80632 7.73623 7.27571 8.90331 9.04566C10.0704 10.8156 11.6663 13.2324 12.4502 14.4188L13.8739 16.5754L13.946 16.5279C14.584 16.1131 15.2589 15.5226 15.7933 14.9074C16.9305 13.6015 17.6634 12.009 17.9095 10.3112C17.9815 9.81726 17.9903 9.67138 17.9903 9.00172C17.9903 8.33206 17.9815 8.18617 17.9095 7.69227C17.4208 4.31585 15.0181 1.47901 11.7595 0.427943C11.1847 0.241633 10.5731 0.113326 9.88758 0.0359895C9.71885 0.0184131 8.55705 -0.000920974 8.41117 0.0131402ZM12.0917 5.45128C12.176 5.49346 12.2446 5.57432 12.2692 5.65868C12.2832 5.70438 12.2868 6.68163 12.2832 8.88395L12.278 12.0442L11.7208 11.19L11.1619 10.3358V8.03853C11.1619 6.55332 11.1689 5.71844 11.1795 5.67802C11.2076 5.57959 11.2691 5.50225 11.3535 5.45655C11.4255 5.41964 11.4519 5.41613 11.7278 5.41613C11.988 5.41613 12.0337 5.41964 12.0917 5.45128Z\"\n        fill={color}\n      />\n    </svg>\n  )\n}\n\nexport default NextJs\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/common/icons/nextjs/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/common/icons/package.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/common/icons/paypal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/common/icons/placeholder-image.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/common/icons/refresh.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/common/icons/spinner.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/common/icons/trash.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/common/icons/user.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/common/icons/x.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/common/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/home/components/content-section/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/home/components/featured-products-block/index.tsx","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":16,"column":3,"nodeType":"MemberExpression","messageId":"unexpected","endLine":16,"endColumn":14,"suggestions":[{"fix":{"range":[389,456],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":17,"column":3,"nodeType":"MemberExpression","messageId":"unexpected","endLine":17,"endColumn":14,"suggestions":[{"fix":{"range":[459,524],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from \"react\";\nimport FeaturedProducts from \"../featured-products\";\nimport { HttpTypes } from \"@medusajs/types\";\n\ntype FeaturedProductsBlockProps = {\n  collectionId: string;\n  collections: HttpTypes.StoreCollection[];\n  region: HttpTypes.StoreRegion;\n};\n\nconst FeaturedProductsBlock: React.FC<FeaturedProductsBlockProps> = ({\n  collectionId,\n  collections,\n  region,\n}) => {\n  console.log(\"FeaturedProductsBlock - collectionId:\", collectionId);\n  console.log(\"FeaturedProductsBlock - collections:\", collections);\n\n  const featuredCollections = collections.filter(\n    (collection) => collection.id === collectionId\n  );\n\n  if (featuredCollections.length === 0) {\n    return null;\n  }\n\n  return <FeaturedProducts collections={featuredCollections} region={region} />;\n};\n\nexport default FeaturedProductsBlock;\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/home/components/featured-products/index.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Text' is defined but never used.","line":3,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":14},{"ruleId":"unused-imports/no-unused-imports","severity":2,"message":"'Text' is defined but never used.","line":3,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":14,"fix":{"range":[116,152],"text":""}},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":21,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":21,"endColumn":18,"suggestions":[{"fix":{"range":[642,726],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import { HttpTypes } from \"@medusajs/types\"\nimport type { FeaturedProductsSection } from \"@lib/types/page-sections\"\nimport { Text } from \"@medusajs/ui\"\nimport { Suspense } from \"react\"\nimport ProductPreviewGrid from \"./product-rail\"\nimport SkeletonProductPreview from \"@modules/skeletons/components/skeleton-product-preview\"\n\ntype FeaturedProductsProps = {\n  collections: HttpTypes.StoreCollection[]\n  region: HttpTypes.StoreRegion\n  settings?: FeaturedProductsSection\n}\n\nexport default function FeaturedProducts({\n  collections,\n  region,\n  settings,\n}: FeaturedProductsProps) {\n  // 如果沒有收到必要的參數，返回 null\n  if (!collections || !region) {\n    console.error(\"FeaturedProducts - Missing required props:\", { collections, region })\n    return null\n  }\n\n  // 如果 collections 為空陣列，返回提示訊息\n  if (collections.length === 0) {\n    return (\n      <div className=\"w-full py-8 text-center text-gray-500\">\n        目前沒有精選商品\n      </div>\n    )\n  }\n\n  const renderTitle = (settings?: FeaturedProductsSection) => {\n    if (!settings) return null\n    const { showHeading, heading } = settings\n\n    if (!showHeading) return null\n\n    return (\n      <div className=\"mb-16 text-center px-4 md:px-8\">\n        {showHeading && heading && (\n          <h1 className=\"h1\">{heading}</h1>\n        )}\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"w-full py-6 md:py-12 xl:py-16 2xl:py-20\">\n      {collections.map((collection) => (\n        <section \n          key={collection.id} \n          className={settings?.showHeading ? \"py-8 md:py-12\" : \"py-0\"}\n        >\n          <div className=\"w-full\">\n            <div className=\"px-6 md:px-12 xl:px-16 2xl:px-20\">\n              {renderTitle(settings)}\n            </div>\n            <Suspense fallback={<SkeletonProductGrid />}>\n              <ProductPreviewGrid collection={collection} region={region} />\n            </Suspense>\n          </div>\n        </section>\n      ))}\n    </div>\n  )\n}\n\nconst SkeletonProductGrid = () => {\n  return (\n    <div className=\"px-6 md:px-12 xl:px-16 2xl:px-20\">\n      <div className=\"grid grid-cols-2 md:grid-cols-4 gap-0 w-full bg-neutral-200\">\n        {Array.from({ length: 4 }).map((_, i) => (\n          <div key={i} className=\"w-full bg-white\">\n            <SkeletonProductPreview />\n          </div>\n        ))}\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/home/components/featured-products/product-rail/index.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":20,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[624,627],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[624,627],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":23,"column":7,"nodeType":null,"messageId":"preferOptionalChain","endLine":23,"endColumn":41,"fix":{"range":[640,674],"text":"products?.length === 0"}}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import { HttpTypes } from \"@medusajs/types\"\nimport ProductPreview from \"@modules/products/components/product-preview\"\nimport { listProducts } from \"@lib/data/products\"\nimport { convertToStandardProducts } from \"@/lib/util/product-type-converter\"\n\ntype ProductPreviewGridProps = {\n  collection: HttpTypes.StoreCollection\n  region: HttpTypes.StoreRegion\n}\n\nexport default async function ProductPreviewGrid({\n  collection,\n  region,\n}: ProductPreviewGridProps) {\n  const { response: { products } } = await listProducts({\n    regionId: region.id,\n    queryParams: {\n      collection_id: [collection.id],\n      limit: 4\n    } as any\n  })\n\n  if (!products || products.length === 0) {\n    return null\n  }\n\n  // 轉換產品類型以匹配 HttpTypes.StoreProduct\n  const standardProducts = convertToStandardProducts(products)\n\n  return (\n    <div className=\"px-6 md:px-12 xl:px-16 2xl:px-20\">\n      <ul className=\"grid grid-cols-2 md:grid-cols-4 gap-0 w-full\">\n        {standardProducts.map(product => (\n          <li key={product.id} className=\"w-full bg-white\">\n            <ProductPreview \n              product={product}\n              isFeatured={collection.handle === \"featured\"}\n              countryCode=\"tw\"\n            />\n          </li>\n        ))}\n      </ul>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/home/components/google-maps-section/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/home/components/google-maps-section/map-frame.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/home/components/hero-section/index.tsx","messages":[{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":11,"column":7,"nodeType":null,"messageId":"preferOptionalChain","endLine":11,"endColumn":51,"fix":{"range":[226,270],"text":"banner.slides?.length === 0"}},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'processedSlides' is assigned a value but never used.","line":21,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":21,"endColumn":24},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'processedSlides' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":21,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":21,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'index' is defined but never used.","line":21,"column":66,"nodeType":null,"messageId":"unusedVar","endLine":21,"endColumn":71},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'index' is defined but never used. Allowed unused args must match /^_/u.","line":21,"column":66,"nodeType":null,"messageId":"unusedVar","endLine":21,"endColumn":71},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":24,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[689,692],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[689,692],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":29,"column":36,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":29,"endColumn":38,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[909,911],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":30,"column":36,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":30,"endColumn":38,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[951,953],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":40,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":40,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1337,1340],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1337,1340],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":45,"column":42,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":45,"endColumn":44,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1587,1589],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":46,"column":42,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":46,"endColumn":44,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1635,1637],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":9,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":1,"fixableWarningCount":0,"source":"\"use client\"\n\nimport Hero from \"../hero\"\nimport type { MainBanner, BannerSlide } from \"@lib/types/page-sections\"\n\ntype HeroSectionProps = {\n  banner: MainBanner\n}\n\nconst HeroSection = ({ banner }: HeroSectionProps) => {\n  if (!banner.slides || banner.slides.length === 0) {\n    return null\n  }\n  \n  // 根據是否顯示指示點決定手機版高度行為\n  const shouldUseFixedHeight = banner.settings?.showDots && banner.slides.length > 1\n  const mobileHeightClass = shouldUseFixedHeight \n    ? \"min-h-hero-mobile\" // 固定高度（扣掉 header）\n    : \"min-h-fit\" // 自適應內容高度\n  \n  const processedSlides = banner.slides.map((slide: BannerSlide, index: number) => {\n    return {\n      heading: slide.heading,\n      subheading: (slide as any).subheading,\n      desktopImage: slide.desktopImage,\n      desktopImageAlt: slide.desktopImageAlt,\n      mobileImage: slide.mobileImage,\n      mobileImageAlt: slide.mobileImageAlt,\n      buttonText: slide.buttonText || \"\",\n      buttonLink: slide.buttonLink || \"\"\n    }\n  });\n  \n  return (\n    <section className={`w-screen relative left-1/2 right-1/2 -ml-[50vw] -mr-[50vw] overflow-hidden ${mobileHeightClass} md:min-h-0`}>\n      <div className={`w-full h-auto ${mobileHeightClass} md:min-h-0`}>\n        <Hero\n          slides={banner.slides.map((slide: BannerSlide) => ({\n            heading: slide.heading,\n            subheading: (slide as any).subheading,\n            desktopImage: slide.desktopImage,\n            desktopImageAlt: slide.desktopImageAlt,\n            mobileImage: slide.mobileImage,\n            mobileImageAlt: slide.mobileImageAlt,\n            buttonText: slide.buttonText || \"\",\n            buttonLink: slide.buttonLink || \"\"\n          }))}\n          settings={banner.settings}\n        />\n      </div>\n    </section>\n  )\n}\n\nexport default HeroSection\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/home/components/hero/index.tsx","messages":[{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":46,"column":7,"nodeType":null,"messageId":"preferOptionalChain","endLine":46,"endColumn":32,"fix":{"range":[1126,1151],"text":"!slides?.length"}},{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":99,"column":9,"nodeType":null,"messageId":"preferOptionalChain","endLine":99,"endColumn":59,"fix":{"range":[2538,2588],"text":"e.changedTouches?.length === 0"}},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":119,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":119,"endColumn":20,"suggestions":[{"fix":{"range":[3257,3284],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":123,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":123,"endColumn":20,"suggestions":[{"fix":{"range":[3354,3381],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":161,"column":19,"nodeType":"JSXOpeningElement","endLine":167,"endColumn":21},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":164,"column":52,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":164,"endColumn":54,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[4849,4895],"text":"(slideItem.desktopImageAlt ?? slideItem.heading)"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":178,"column":19,"nodeType":"JSXOpeningElement","endLine":184,"endColumn":21},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":181,"column":51,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":181,"endColumn":53,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[5683,5728],"text":"(slideItem.mobileImageAlt ?? slideItem.heading)"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":2,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { Button, Heading } from \"@medusajs/ui\"\nimport { useState, useEffect, useRef } from \"react\"\nimport Link from \"next/link\"\n\ntype Slide = {\n  heading: string\n  subheading?: string\n  desktopImage: string\n  desktopImageAlt?: string\n  mobileImage: string\n  mobileImageAlt?: string\n  buttonText: string\n  buttonLink: string\n}\n\ntype Settings = {\n  autoplay: boolean\n  autoplaySpeed: number\n  showArrows: boolean\n  showDots: boolean\n}\n\ntype HeroProps = {\n  slides: Slide[]\n  settings: Settings\n}\n\nconst Hero = ({ slides, settings }: HeroProps) => {\n  const [currentSlide, setCurrentSlide] = useState(0)\n  const touchStartXRef = useRef<number | null>(null)\n  const touchStartTimeRef = useRef<number>(0)\n  const isSwipingRef = useRef<boolean>(false)\n\n  useEffect(() => {\n    if (!slides || slides.length <= 1 || !settings?.autoplay) return\n\n    const interval = setInterval(() => {\n      setCurrentSlide((prev) => (prev + 1) % slides.length)\n    }, (settings?.autoplaySpeed || 3) * 1000) // 將秒轉換為毫秒\n\n    return () => clearInterval(interval)\n  }, [slides?.length, settings?.autoplay, settings?.autoplaySpeed])\n\n  if (!slides || !slides.length) return null\n\n  const slide = slides[currentSlide]\n  \n  // 根據是否顯示指示點決定手機版高度行為\n  const shouldUseFixedHeight = settings?.showDots && slides.length > 1\n  const mobileHeightClass = shouldUseFixedHeight \n    ? \"min-h-hero-mobile\" // 固定高度（扣掉 header）\n    : \"min-h-fit\" // 自適應內容高度\n\n  const goToNextSlide = () => {\n    setCurrentSlide((prev) => (prev + 1) % slides.length)\n  }\n\n  const goToPrevSlide = () => {\n    setCurrentSlide((prev) => (prev - 1 + slides.length) % slides.length)\n  }\n\n  const goToSlide = (index: number) => {\n    setCurrentSlide(index)\n  }\n\n  // 觸摸手勢處理 - 增強版\n  const handleTouchStart = (e: React.TouchEvent) => {\n    // 防止多點觸控干擾\n    if (e.touches.length !== 1) return\n    \n    touchStartXRef.current = e.touches[0].clientX\n    touchStartTimeRef.current = Date.now()\n    isSwipingRef.current = false\n    \n    // 阻止預設行為，避免頁面滾動干擾\n    e.preventDefault()\n  }\n\n  const handleTouchMove = (e: React.TouchEvent) => {\n    if (touchStartXRef.current === null || e.touches.length !== 1) return\n    \n    const touchCurrentX = e.touches[0].clientX\n    const diffX = touchStartXRef.current - touchCurrentX\n    \n    // 降低滑動檢測閾值，提高敏感度\n    if (Math.abs(diffX) > 5) {\n      isSwipingRef.current = true\n      // 阻止頁面滾動\n      e.preventDefault()\n    }\n  }\n\n  const handleTouchEnd = (e: React.TouchEvent) => {\n    if (touchStartXRef.current === null) return\n    \n    // 確保有 changedTouches\n    if (!e.changedTouches || e.changedTouches.length === 0) return\n    \n    const touchEndX = e.changedTouches[0].clientX\n    const diffX = touchStartXRef.current - touchEndX\n    const diffTime = Date.now() - touchStartTimeRef.current\n    \n    // 調整參數以提高手勢識別精度\n    const minSwipeDistance = 30 // 降低最小滑動距離\n    const maxSwipeTime = 800 // 增加最大滑動時間\n    const minSwipeSpeed = minSwipeDistance / maxSwipeTime * 1000 // 最小滑動速度 (px/s)\n    const actualSpeed = Math.abs(diffX) / diffTime * 1000\n    \n    // 只有在有輪播圖片且滑動有效時才切換\n    if (slides.length > 1 && \n        Math.abs(diffX) > minSwipeDistance && \n        diffTime < maxSwipeTime &&\n        actualSpeed > minSwipeSpeed) {\n      \n      if (diffX > 0) {\n        // 向左滑動 - 下一張\n        console.log('📱 手勢滑動: 下一張')\n        goToNextSlide()\n      } else {\n        // 向右滑動 - 上一張\n        console.log('📱 手勢滑動: 上一張')  \n        goToPrevSlide()\n      }\n    }\n    \n    // 重置\n    touchStartXRef.current = null\n    isSwipingRef.current = false\n  }\n\n  return (\n    <div className={`hero-container relative w-full ${mobileHeightClass} md:min-h-0`}>\n      {/* 輪播圖片容器 - 根據設定決定手機版高度行為 */}\n      <div \n        className={`hero-image-container relative w-full overflow-hidden ${mobileHeightClass} md:min-h-0`}\n        onTouchStart={handleTouchStart}\n        onTouchMove={handleTouchMove}\n        onTouchEnd={handleTouchEnd}\n        style={{\n          touchAction: 'pan-y', // 允許垂直滾動，禁止水平滾動\n          userSelect: 'none', // 禁止選擇文字\n          WebkitUserSelect: 'none',\n          cursor: slides.length > 1 ? 'grab' : 'default'\n        }}\n      >\n        {slides.map((slideItem, index) => {\n          return (\n            <div\n              key={index}\n              className={`transition-opacity duration-1000 ease-in-out ${\n                index === currentSlide ? 'opacity-100' : 'opacity-0'\n              } ${index !== currentSlide ? 'absolute inset-0' : ''}`}\n            >\n              {/* 響應式圖片顯示邏輯 - 強制分離桌面和手機版 */}\n              \n              {/* 桌面版圖片容器 - 只在 md 以上顯示 */}\n              <div className=\"hidden md:block w-full\">\n                {slideItem.desktopImage && slideItem.desktopImage.trim() !== '' ? (\n                  <img\n                    key={`desktop-${index}-${slideItem.desktopImage.slice(-20)}`}\n                    src={slideItem.desktopImage}\n                    alt={slideItem.desktopImageAlt || slideItem.heading || `桌面版輪播圖片 ${index + 1}`}\n                    className=\"w-full h-auto object-cover\"\n                    loading={index === 0 ? 'eager' : 'lazy'}\n                  />\n                ) : (\n                  <div className=\"w-full bg-gray-300 flex items-center justify-center h-64\">\n                    <span className=\"text-gray-500\">桌面版圖片未設定</span>\n                  </div>\n                )}\n              </div>\n              \n              {/* 手機版圖片容器 - 只在 md 以下顯示 */}\n              <div className=\"block md:hidden w-full\">\n                {slideItem.mobileImage && slideItem.mobileImage.trim() !== '' ? (\n                  <img\n                    key={`mobile-${index}-${slideItem.mobileImage.slice(-20)}`}\n                    src={slideItem.mobileImage}\n                    alt={slideItem.mobileImageAlt || slideItem.heading || `手機版輪播圖片 ${index + 1}`}\n                    className={`w-full ${shouldUseFixedHeight ? 'h-hero-mobile' : 'h-auto'} object-cover`}\n                    loading={index === 0 ? 'eager' : 'lazy'}\n                  />\n                ) : (\n                  <div className=\"w-full bg-gray-300 flex items-center justify-center h-32\">\n                    <span className=\"text-gray-500 text-sm\">手機版圖片未設定</span>\n                  </div>\n                )}\n              </div>\n            </div>\n          )\n        })}\n      </div>\n      \n      {/* 內容覆蓋層 - 手機版滿屏垂直居中，桌面版底部對齊 */}\n      <div className=\"absolute inset-0 z-10 flex flex-col justify-center md:justify-end items-center text-center p-4 pb-16 md:pb-16 sm:p-16 md:p-16 lg:p-32 gap-3 sm:gap-6 bg-gradient-to-b from-black/10 via-black/30 to-black/60\">\n        <div \n          key={`slide-${currentSlide}`}\n          className=\"animate-fade-in-content max-w-[90%] sm:max-w-4xl\"\n        >\n          <Heading\n            level=\"h1\"\n            className=\"text-heading-1 text-white font-heading text-2xl sm:text-3xl md:text-5xl lg:text-6xl font-semibold tracking-tight mb-2 sm:mb-6\"\n            style={{\n              textShadow: \"0 2px 4px rgba(0,0,0,0.3)\",\n              letterSpacing: \"var(--letter-spacing-tight)\"\n            }}\n          >\n            {slide.heading}\n          </Heading>\n          {slide.subheading && (\n            <p\n              className=\"text-white/95 text-sm sm:text-base md:text-lg lg:text-xl mb-3 sm:mb-6 max-w-3xl mx-auto\"\n              style={{ textShadow: \"0 1px 2px rgba(0,0,0,0.25)\" }}\n            >\n              {slide.subheading}\n            </p>\n          )}\n          {slide.buttonText && slide.buttonLink && (\n            <Button asChild variant=\"secondary\" \n              className=\"btn bg-white hover:bg-white/90 text-gray-900 px-4 sm:px-8 py-2 sm:py-3 text-sm sm:text-base md:text-lg font-medium rounded-lg \n                shadow-lg transition-all duration-300 hover:shadow-xl hover:scale-[1.02]\"\n              style={{\n                letterSpacing: \"var(--letter-spacing-wide)\",\n                fontFamily: \"var(--font-base)\"\n              }}\n            >\n              <Link href={slide.buttonLink}>{slide.buttonText}</Link>\n            </Button>\n          )}\n        </div>\n      </div>\n\n      {/* 箭頭導航 - 只在有多張圖片且啟用箭頭時顯示 */}\n      {settings?.showArrows && slides.length > 1 && (\n        <>\n          {/* 上一張按鈕 */}\n          <button\n            onClick={goToPrevSlide}\n            className=\"absolute left-2 sm:left-4 top-1/2 transform -translate-y-1/2 z-20 bg-white/80 hover:bg-white text-gray-800 rounded-full p-2 sm:p-3 shadow-lg transition-all duration-300 hover:scale-110 focus:outline-none focus:ring-2 focus:ring-white/50\"\n            aria-label=\"上一張圖片\"\n          >\n            <svg \n              className=\"w-4 h-4 sm:w-6 sm:h-6\" \n              fill=\"none\" \n              stroke=\"currentColor\" \n              viewBox=\"0 0 24 24\"\n            >\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 19l-7-7 7-7\" />\n            </svg>\n          </button>\n\n          {/* 下一張按鈕 */}\n          <button\n            onClick={goToNextSlide}\n            className=\"absolute right-2 sm:right-4 top-1/2 transform -translate-y-1/2 z-20 bg-white/80 hover:bg-white text-gray-800 rounded-full p-2 sm:p-3 shadow-lg transition-all duration-300 hover:scale-110 focus:outline-none focus:ring-2 focus:ring-white/50\"\n            aria-label=\"下一張圖片\"\n          >\n            <svg \n              className=\"w-4 h-4 sm:w-6 sm:h-6\" \n              fill=\"none\" \n              stroke=\"currentColor\" \n              viewBox=\"0 0 24 24\"\n            >\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 5l7 7-7 7\" />\n            </svg>\n          </button>\n        </>\n      )}\n\n      {/* 點點導航 - 適應動態高度 */}\n      {settings?.showDots && slides.length > 1 && (\n        <div className=\"absolute bottom-4 sm:bottom-6 left-1/2 transform -translate-x-1/2 z-20 flex gap-2 sm:gap-3\">\n          {slides.map((_, index) => (\n            <button\n              key={`dot-${index}`}\n              onClick={() => goToSlide(index)}\n              className={`w-2 h-2 sm:w-3 sm:h-3 rounded-full transition-all duration-300 ${\n                index === currentSlide \n                  ? \"bg-white scale-110 shadow-lg\" \n                  : \"bg-white/60 hover:bg-white/80 scale-100\"\n              }`}\n              aria-label={`前往第 ${index + 1} 張圖片`}\n            />\n          ))}\n        </div>\n      )}\n    </div>\n  )\n}\n\nexport default Hero\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/home/components/image-text-block/index.tsx","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":32,"column":3,"nodeType":"MemberExpression","messageId":"unexpected","endLine":32,"endColumn":14,"suggestions":[{"fix":{"range":[666,792],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":40,"column":12,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":40,"endColumn":28},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":41,"column":28,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":41,"endColumn":30,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[886,888],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport Image from 'next/image'\nimport Link from 'next/link'\nimport { cn } from '@lib/util/cn'\n\ninterface ImageConfig {\n  url?: string\n  alt?: string\n  linkUrl?: string\n}\n\ninterface ImageTextBlockProps {\n  heading: string\n  content?: string\n  image?: ImageConfig\n  layout: 'imageLeft' | 'imageRight' | 'imageLeftImageRight' | 'textLeftTextRight' | 'centerText'\n  leftImage?: ImageConfig\n  rightImage?: ImageConfig\n  leftContent?: string\n  rightContent?: string\n  hideTitle?: boolean\n}\n\n// 圖片包裝組件\nconst ImageWrapper = ({ imageConfig, className, sizes }: { \n  imageConfig: ImageConfig\n  className?: string\n  sizes?: string \n}) => {\n  // 輸出圖片配置，幫助調試連結問題\n  console.log('ImageWrapper 處理圖片:', {\n    url: imageConfig.url,\n    alt: imageConfig.alt,\n    linkUrl: imageConfig.linkUrl\n  });\n\n  const imageElement = (\n    <Image\n      src={imageConfig.url!}\n      alt={imageConfig.alt || '區塊圖片'}\n      width={1920}\n      height={1080}\n      className={cn(\"w-full h-auto object-cover\", className)}\n      sizes={sizes}\n    />\n  )\n\n  if (imageConfig.linkUrl) {\n    return (\n      <Link href={imageConfig.linkUrl} className=\"block w-full relative z-20\" target=\"_blank\" rel=\"noopener noreferrer\">\n        {imageElement}\n      </Link>\n    )\n  }\n\n  return imageElement\n}\n\nconst ImageTextBlock = ({\n  heading,\n  content,\n  image,\n  layout,\n  leftImage,\n  rightImage,\n  leftContent,\n  rightContent,\n  hideTitle = false\n}: ImageTextBlockProps) => {\n  // 檢查是否真的有標題內容\n  const hasTitle = !hideTitle && heading && heading.trim().length > 0\n  \n  // 決定容器樣式\n  const containerClasses = (() => {\n    const isImageLayout = layout === 'imageLeft' || layout === 'imageRight' || layout === 'imageLeftImageRight'\n    \n    if (isImageLayout) {\n      return \"w-full max-w-none -mx-0 md:mx-0 px-0 md:px-0\"\n    }\n    \n    if (hasTitle) {\n      return \"w-full max-w-none -mx-0 md:mx-0 py-12 md:py-20 px-6 md:px-12\"\n    }\n    \n    return \"w-full max-w-none -mx-0 md:mx-0 px-6 md:px-12\"\n  })()\n  \n  return (\n    <div className={containerClasses}>\n      {/* 左圖右文布局 */}\n      {layout === 'imageLeft' && image?.url && (\n        <div className=\"grid md:grid-cols-2 items-center gap-0\">\n          <div className=\"relative w-full overflow-hidden\">\n            <ImageWrapper \n              imageConfig={image} \n              sizes=\"(max-width: 768px) 100vw, 50vw\"\n            />\n          </div>\n          <div className={cn(\n            \"flex flex-col justify-center px-4 py-6 md:px-12 xl:px-16 2xl:px-24 md:py-0\",\n            hasTitle ? \"space-y-6 md:space-y-8\" : \"space-y-4\"\n          )}>\n            {hasTitle && (\n              <h2 className=\"h1 mb-6 text-center\">\n                {heading}\n              </h2>\n            )}\n            {content && (\n              <div className=\"prose prose-lg max-w-none\" dangerouslySetInnerHTML={{ __html: content }} />\n            )}\n          </div>\n        </div>\n      )}\n\n      {/* 右圖左文布局 */}\n      {layout === 'imageRight' && image?.url && (\n        <div className=\"grid md:grid-cols-2 items-center gap-0\">\n          <div className={cn(\n            \"flex flex-col justify-center px-4 py-6 md:px-12 xl:px-16 2xl:px-24 md:py-0 order-2 md:order-1\",\n            hasTitle ? \"space-y-6 md:space-y-8\" : \"space-y-4\"\n          )}>\n            {hasTitle && (\n              <h2 className=\"text-2xl md:text-3xl lg:text-4xl font-bold mb-4 text-primary\">\n                {heading}\n              </h2>\n            )}\n            {content && (\n              <div className=\"prose prose-lg max-w-none\" dangerouslySetInnerHTML={{ __html: content }} />\n            )}\n          </div>\n          <div className=\"relative w-full overflow-hidden order-1 md:order-2\">\n            <ImageWrapper \n              imageConfig={image} \n              sizes=\"(max-width: 768px) 100vw, 50vw\"\n            />\n          </div>\n        </div>\n      )}\n\n      {/* 中間文字布局 */}\n      {layout === 'centerText' && (\n        <div className=\"max-w-4xl mx-auto px-6 md:px-12 xl:px-16 2xl:px-24\">\n          <div className={cn(\n            \"text-center\",\n            hasTitle ? \"space-y-8\" : \"space-y-4\"\n          )}>\n            {hasTitle && (\n              <h2 className=\"h1 mb-6\">\n                {heading}\n              </h2>\n            )}\n            {content && (\n              <div className=\"prose prose-lg max-w-none mx-auto\" dangerouslySetInnerHTML={{ __html: content }} />\n            )}\n          </div>\n        </div>\n      )}\n\n      {/* 雙圖布局 */}\n      {layout === 'imageLeftImageRight' && (\n        <div className=\"w-full max-w-none m-0 p-0\">\n          {hasTitle && (\n            <div className=\"text-center max-w-4xl mx-auto px-4 py-6 md:px-0 md:py-8\">\n              <h2 className=\"h1 mb-4 md:mb-8\">\n                {heading}\n              </h2>\n            </div>\n          )}\n          <div className=\"grid grid-cols-2 w-full m-0 p-0 gap-0\">\n            {leftImage?.url && (\n              <div className=\"relative w-full overflow-hidden m-0 p-0\">\n                <ImageWrapper \n                  imageConfig={leftImage} \n                  sizes=\"(max-width: 768px) 50vw, 50vw\"\n                />\n              </div>\n            )}\n            {rightImage?.url && (\n              <div className=\"relative w-full overflow-hidden m-0 p-0\">\n                <ImageWrapper \n                  imageConfig={rightImage} \n                  sizes=\"(max-width: 768px) 50vw, 50vw\"\n                />\n              </div>\n            )}\n          </div>\n        </div>\n      )}\n\n      {/* 雙文布局 */}\n      {layout === 'textLeftTextRight' && (\n        <div className=\"w-full max-w-none\">\n          {hasTitle && (\n            <div className=\"text-center max-w-4xl mx-auto mb-8\">\n              <h2 className=\"h1\">\n                {heading}\n              </h2>\n            </div>\n          )}\n          <div className=\"grid md:grid-cols-2 gap-8 px-6 md:px-12 xl:px-16 2xl:px-24\">\n            {leftContent && (\n              <div className=\"prose prose-lg max-w-none\">\n                <div dangerouslySetInnerHTML={{ __html: leftContent }} />\n              </div>\n            )}\n            {rightContent && (\n              <div className=\"prose prose-lg max-w-none\">\n                <div dangerouslySetInnerHTML={{ __html: rightContent }} />\n              </div>\n            )}\n          </div>\n        </div>\n      )}\n    </div>\n  )\n}\n\nexport default ImageTextBlock\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/home/components/main-section/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/home/components/product-display/index.tsx","messages":[{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":12,"column":7,"nodeType":null,"messageId":"preferOptionalChain","endLine":12,"endColumn":41,"fix":{"range":[324,358],"text":"products?.length === 0"}},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":25,"column":89,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":25,"endColumn":91,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[792,794],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":1,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { HttpTypes } from \"@medusajs/types\"\nimport ProductPreview from \"@modules/products/components/product-preview\"\n\ntype ProductDisplayProps = {\n  products: HttpTypes.StoreProduct[]\n  region: HttpTypes.StoreRegion\n}\n\nexport default function ProductDisplay({ products, region }: ProductDisplayProps) {\n  if (!products || products.length === 0) {\n    return (\n      <div className=\"w-full py-8 text-center text-gray-500\">\n        此分類暫無商品\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"w-full\">\n      <ul className=\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4\">\n        {products.map((product) => (\n          <li key={product.id} className=\"relative group\">\n            <ProductPreview product={product} countryCode={region.countries?.[0]?.iso_2 || \"tw\"} isFeatured />\n          </li>\n        ))}\n      </ul>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/home/components/service-cards-section/index.tsx","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":131,"column":51,"nodeType":"MemberExpression","messageId":"unexpected","endLine":131,"endColumn":64},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":149,"column":51,"nodeType":"MemberExpression","messageId":"unexpected","endLine":149,"endColumn":64},{"ruleId":"sonarjs/cognitive-complexity","severity":2,"message":"Refactor this function to reduce its Cognitive Complexity from 19 to the 15 allowed.","line":154,"column":57,"nodeType":null,"messageId":"refactorFunction","endLine":154,"endColumn":59},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":173,"column":80,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":173,"endColumn":82,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[5972,5974],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":214,"column":51,"nodeType":"MemberExpression","messageId":"unexpected","endLine":214,"endColumn":64},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'serviceTitle' is defined but never used.","line":223,"column":35,"nodeType":null,"messageId":"unusedVar","endLine":223,"endColumn":47},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'serviceTitle' is defined but never used. Allowed unused args must match /^_/u.","line":223,"column":35,"nodeType":null,"messageId":"unusedVar","endLine":223,"endColumn":47},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":254,"column":51,"nodeType":"MemberExpression","messageId":"unexpected","endLine":254,"endColumn":64},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":284,"column":51,"nodeType":"MemberExpression","messageId":"unexpected","endLine":284,"endColumn":64},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":384,"column":32,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":384,"endColumn":34,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[14860,14862],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'heading' is defined but never used.","line":405,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":405,"endColumn":10},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'heading' is defined but never used. Allowed unused args must match /^_/u.","line":405,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":405,"endColumn":10},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":430,"column":23,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":430,"endColumn":37}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { useState, useEffect } from 'react'\nimport { Select } from '@medusajs/ui'\nimport Image from 'next/image'\nimport clsx from 'clsx'\n\ninterface Stylist {\n  levelName: string\n  price: number\n  priceType?: 'up' | 'fixed'\n  stylistName?: string\n  stylistInstagramUrl?: string\n  isDefault?: boolean\n  cardImage?: {\n    url: string\n    alt?: string\n  }\n}\n\ninterface Card {\n  title: string\n  englishTitle: string\n  stylists?: Stylist[]\n}\n\n// 設計師選擇卡片元件\ninterface DesignerSelectorCardProps {\n  allStylists: string[]\n  selectedDesigner: string\n  onDesignerChange: (value: string) => void\n  isMounted: boolean\n}\n\nfunction DesignerSelectorCard({ \n  allStylists, \n  selectedDesigner, \n  onDesignerChange, \n  isMounted \n}: DesignerSelectorCardProps) {\n  if (!isMounted || allStylists.length === 0) return null\n\n  return (\n    <div className=\"group relative bg-white overflow-hidden transition-all duration-700 border border-stone-200/60 hover:border-stone-300/80 hover:-translate-y-2 hover:shadow-xl h-full\">\n      {/* 內容區域 - 填滿整張卡片高度並置中 */}\n      <div className=\"h-full flex flex-col items-center justify-center p-4 md:p-8 space-y-4 md:space-y-6\">\n        {/* 標題 - 繼承區塊標題屬性 */}\n        <div className=\"text-center space-y-2 md:space-y-4\">\n          <h1 className=\"text-xl md:text-2xl font-light text-stone-900 group-hover:text-stone-700 transition-colors duration-300 tracking-wide\">\n            選擇設計師\n          </h1>\n          <p className=\"text-[10px] md:text-xs text-stone-500 font-light tracking-[0.2em] uppercase\">\n            CHOOSE DESIGNER\n          </p>\n        </div>\n\n        {/* 下拉選單區域 */}\n        <div className=\"w-full space-y-3\">\n          <Select \n            value={selectedDesigner}\n            onValueChange={onDesignerChange}\n          >\n            <Select.Trigger className=\"w-full bg-white border-stone-200 hover:border-stone-300 py-3 px-4 text-stone-700 font-light tracking-wide\">\n              <Select.Value placeholder=\"所有設計師\" />\n            </Select.Trigger>\n            <Select.Content className=\"bg-white border-stone-200 shadow-lg max-h-60 overflow-y-auto z-50\">\n              <Select.Item value=\"all\" className=\"font-light tracking-wide text-stone-700 hover:bg-stone-50\">\n                所有設計師\n              </Select.Item>\n              {allStylists.map((designer) => (\n                <Select.Item \n                  key={designer} \n                  value={designer}\n                  className=\"font-light tracking-wide text-stone-700 hover:bg-stone-50\"\n                >\n                  {designer}\n                </Select.Item>\n              ))}\n            </Select.Content>\n          </Select>\n          \n          {/* 當前選擇顯示 - 與設計師資訊區域保持一致 */}\n          <div className=\"text-center\">\n            <span className=\"text-xs md:text-sm text-stone-600 font-light tracking-wide\">\n              {selectedDesigner === \"all\" ? \"所有設計師\" : selectedDesigner}\n            </span>\n          </div>\n        </div>\n      </div>\n\n      {/* 底部微光效果 */}\n      <div className=\"absolute bottom-0 left-0 w-full h-px bg-gradient-to-r from-transparent via-stone-200/50 to-transparent opacity-0 group-hover:opacity-100 transition-all duration-500\"></div>\n    </div>\n  )\n}\n\n// 服務卡片元件\ninterface ServiceCardProps {\n  card: Card\n  selectedDesigner: string\n}\n\nfunction ServiceCard({ card, selectedDesigner }: ServiceCardProps) {\n  if (!card) return null\n\n  const getCardPrice = (card: Card): string => {\n    try {\n      if (!Array.isArray(card?.stylists) || !card.stylists.length) {\n        return \"價格請洽詢\"\n      }\n      \n      if (selectedDesigner === \"all\") {\n        // 使用標示為預設的設計師價格\n        const defaultStylist = card.stylists.find(s => s.isDefault === true)\n        if (defaultStylist) {\n          const priceText = `NT$ ${defaultStylist.price}`\n          return defaultStylist.priceType === 'up' ? `${priceText} 起` : priceText\n        }\n        // 如果沒有預設設計師，顯示最低價格起\n        const minPrice = Math.min(...card.stylists.map(s => s.price))\n        return `NT$ ${minPrice} 起`\n      }\n      \n      const stylist = card.stylists.find((s) => s?.stylistName === selectedDesigner)\n      if (stylist?.price) {\n        const priceText = `NT$ ${stylist.price}`\n        return stylist.priceType === 'up' ? `${priceText} 起` : priceText\n      }\n      return \"價格請洽詢\"\n    } catch (error) {\n      if (process.env.NODE_ENV === 'development') console.error('Error calculating card price:', error)\n      return \"價格請洽詢\"\n    }\n  }\n\n  const getSelectedStylistLevel = (): string | null => {\n    try {\n      if (!Array.isArray(card?.stylists) || !card.stylists.length) return null\n      \n      if (selectedDesigner === \"all\") {\n        // 當選擇 \"all\" 時，使用標示為預設的設計師等級\n        const defaultStylist = card.stylists.find(s => s.isDefault === true)\n        return defaultStylist?.levelName ?? null\n      }\n      \n      const stylist = card.stylists.find((s) => s?.stylistName === selectedDesigner)\n      return stylist?.levelName ?? null\n    } catch (error) {\n      if (process.env.NODE_ENV === 'development') console.error('Error getting stylist level:', error)\n      return null\n    }\n  }\n\n  const getCardImage = (): { url: string; alt: string } => {\n    try {\n      // 優先級 1: 如果選擇了特定設計師，使用該設計師的專用圖片\n      if (selectedDesigner !== \"all\" && Array.isArray(card?.stylists) && card.stylists.length) {\n        const stylist = card.stylists.find((s) => s?.stylistName === selectedDesigner)\n        if (stylist?.cardImage?.url) {\n          return {\n            url: stylist.cardImage.url,\n            alt: stylist.cardImage.alt ?? `${stylist.stylistName} - ${card.title}`\n          }\n        }\n      }\n      \n      // 優先級 2: 當選擇 \"all\" 時，使用標示為預設的設計師圖片\n      if (Array.isArray(card?.stylists) && card.stylists.length > 0) {\n        const defaultStylist = card.stylists.find(s => s.isDefault === true)\n        if (defaultStylist?.cardImage?.url) {\n          return {\n            url: defaultStylist.cardImage.url,\n            alt: defaultStylist.cardImage.alt ?? `${defaultStylist.stylistName || '預設設計師'} - ${card.title}`\n          }\n        }\n      }\n      \n      // 優先級 3: 使用第一位有圖片的設計師（排除通用標籤）\n      if (Array.isArray(card?.stylists) && card.stylists.length > 0) {\n        const stylistWithImage = card.stylists.find(s => {\n          const hasImage = s?.cardImage?.url\n          const isNotGeneric = s?.stylistName && \n            !s.stylistName.toLowerCase().includes('all') &&\n            !s.stylistName.toLowerCase().includes('指定')\n          return hasImage && isNotGeneric\n        })\n        \n        if (stylistWithImage?.cardImage?.url) {\n          return {\n            url: stylistWithImage.cardImage.url,\n            alt: stylistWithImage.cardImage.alt ?? `${stylistWithImage.stylistName} - ${card.title}`\n          }\n        }\n      }\n      \n      // 優先級 4: 使用任意有圖片的設計師（包含通用）\n      if (Array.isArray(card?.stylists) && card.stylists.length > 0) {\n        const anyWithImage = card.stylists.find(s => s?.cardImage?.url)\n        if (anyWithImage?.cardImage?.url) {\n          return {\n            url: anyWithImage.cardImage.url,\n            alt: anyWithImage.cardImage.alt ?? card.title\n          }\n        }\n      }\n      \n      // 最後備選：使用預設圖片\n      const defaultImageUrl = getDefaultServiceImage(card.title)\n      return {\n        url: defaultImageUrl,\n        alt: card.title\n      }\n    } catch (error) {\n      if (process.env.NODE_ENV === 'development') console.error('Error getting card image:', error)\n      const defaultImageUrl = getDefaultServiceImage(card.title)\n      return {\n        url: defaultImageUrl,\n        alt: card.title\n      }\n    }\n  }\n\n  const getDefaultServiceImage = (serviceTitle: string): string => {\n    // 根據服務類型返回適合的預設圖片 - 暫時使用透明圖片避免 404 錯誤\n    return 'data:image/svg+xml,%3Csvg width=\"600\" height=\"450\" xmlns=\"http://www.w3.org/2000/svg\"%3E%3Crect width=\"100%25\" height=\"100%25\" fill=\"%23f3f4f6\"/%3E%3Ctext x=\"50%25\" y=\"50%25\" font-family=\"Arial\" font-size=\"20\" fill=\"%236b7280\" text-anchor=\"middle\" dy=\".3em\"%3E服務圖片%3C/text%3E%3C/svg%3E'\n  }\n\n  const getSelectedStylistName = (): string | null => {\n    try {\n      if (!Array.isArray(card?.stylists) || !card.stylists.length) return null\n      \n      if (selectedDesigner === \"all\") {\n        // 當選擇 \"all\" 時，優先使用標示為預設的設計師名稱\n        const defaultStylist = card.stylists.find(s => s.isDefault === true)\n        if (defaultStylist?.stylistName) {\n          // 排除通用標籤\n          const name = defaultStylist.stylistName\n          if (!name.toLowerCase().includes('all') && !name.toLowerCase().includes('指定')) {\n            return name\n          }\n        }\n        \n        // 如果沒有適合的預設設計師，找第一個非通用的設計師\n        const specificStylist = card.stylists.find(s => {\n          const name = s?.stylistName\n          return name && !name.toLowerCase().includes('all') && !name.toLowerCase().includes('指定')\n        })\n        return specificStylist?.stylistName ?? null\n      }\n      \n      const stylist = card.stylists.find((s) => s?.stylistName === selectedDesigner)\n      return stylist?.stylistName ?? null\n    } catch (error) {\n      if (process.env.NODE_ENV === 'development') console.error('Error getting stylist name:', error)\n      return null\n    }\n  }\n\n  const getSelectedStylistInstagramUrl = (): string | null => {\n    try {\n      if (!Array.isArray(card?.stylists) || !card.stylists.length) return null\n      \n      if (selectedDesigner === \"all\") {\n        // 當選擇 \"all\" 時，優先使用標示為預設的設計師 IG URL\n        const defaultStylist = card.stylists.find(s => s.isDefault === true)\n        if (defaultStylist?.stylistInstagramUrl) {\n          return defaultStylist.stylistInstagramUrl\n        }\n        \n        // 如果沒有適合的預設設計師，找第一個有 IG URL 的非通用設計師\n        const specificStylist = card.stylists.find(s => {\n          const name = s?.stylistName\n          return name && \n                 !name.toLowerCase().includes('all') && \n                 !name.toLowerCase().includes('指定') &&\n                 s.stylistInstagramUrl\n        })\n        return specificStylist?.stylistInstagramUrl ?? null\n      }\n      \n      const stylist = card.stylists.find((s) => s?.stylistName === selectedDesigner)\n      return stylist?.stylistInstagramUrl ?? null\n    } catch (error) {\n      if (process.env.NODE_ENV === 'development') console.error('Error getting stylist Instagram URL:', error)\n      return null\n    }\n  }\n\n  return (\n    <div className=\"group relative bg-white overflow-hidden transition-all duration-700 border border-stone-200/60 hover:border-stone-300/80 hover:-translate-y-2 hover:shadow-xl h-full\">\n      {/* 服務圖片區域 */}\n      {(() => {\n        const cardImage = getCardImage()\n        return cardImage.url ? (\n          <div className=\"aspect-[4/3] relative overflow-hidden bg-black\">\n            <Image\n              src={cardImage.url}\n              alt={cardImage.alt}\n              fill\n              className=\"object-contain transition-all duration-1000 group-hover:scale-105\"\n              sizes=\"(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 25vw\"\n            />\n            {/* 簡約漸層覆蓋層 */}\n            <div className=\"absolute inset-0 bg-gradient-to-t from-stone-900/20 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-all duration-500\" />\n\n            {/* 等級標籤 - 簡約設計 */}\n            {getSelectedStylistLevel() && (\n              <div className=\"absolute top-3 left-3 md:top-6 md:left-6 transform group-hover:scale-105 transition-transform duration-300\">\n                <div className=\"bg-stone-800/90 text-white px-2 py-1 shadow-sm text-[10px] md:text-xs font-medium tracking-widest uppercase inline-block\">\n                  {getSelectedStylistLevel()}\n                </div>\n              </div>\n            )}\n          </div>\n        ) : (\n          <div className=\"aspect-[4/3] relative overflow-hidden bg-gradient-to-br from-stone-50 to-stone-100 flex items-center justify-center\">\n            <div className=\"text-stone-400 text-sm font-medium tracking-wide\">\n              圖片暫不可用\n            </div>\n            {/* 簡約裝飾圖案 */}\n            <div className=\"absolute inset-0 opacity-5\">\n              <svg className=\"w-full h-full\" viewBox=\"0 0 200 200\" fill=\"none\">\n                <circle cx=\"100\" cy=\"100\" r=\"60\" stroke=\"currentColor\" strokeWidth=\"0.5\"/>\n                <circle cx=\"100\" cy=\"100\" r=\"40\" stroke=\"currentColor\" strokeWidth=\"0.5\"/>\n              </svg>\n            </div>\n          </div>\n        )\n      })()}\n\n      {/* 卡片內容區域 - Kitsuné 風格 */}\n      <div className=\"p-4 md:p-8 space-y-4 md:space-y-6\">\n        {/* 服務標題區域 - 固定高度確保對齊 */}\n        <div className=\"space-y-2 md:space-y-3 min-h-[4.5rem] md:min-h-[5.5rem]\">\n          {/* 主標題和價格 - 兩欄布局 */}\n          <div className=\"flex justify-between items-start\">\n            <div className=\"flex-1\">\n              <h1 className=\"text-xl md:text-2xl font-light text-stone-900 group-hover:text-stone-700 transition-colors duration-300 tracking-wide leading-tight\">\n                {card.title}\n              </h1>\n            </div>\n            {/* 價格區域 - 右側對齊 */}\n            <div className=\"ml-2 md:ml-4 text-right\">\n              <span className=\"text-base md:text-lg font-light text-stone-600 tracking-wide\">\n                {getCardPrice(card)}\n              </span>\n            </div>\n          </div>\n          {/* 英文副標題 - 全寬一欄布局 */}\n          {card.englishTitle && (\n            <div className=\"w-full\">\n              <p className=\"text-[10px] md:text-xs text-stone-500 font-light tracking-[0.2em] uppercase\">\n                {card.englishTitle}\n              </p>\n            </div>\n          )}\n        </div>\n\n        {/* 設計師資訊 - 簡約設計，始終顯示 */}\n        <div className=\"space-y-2 md:space-y-4 p-3 md:p-5 bg-stone-50/50 border border-stone-100/50\">\n          <div className=\"flex items-center space-x-2 md:space-x-3\">\n            <svg className=\"w-3 h-3 md:w-4 md:h-4 text-stone-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={1.5} d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\" />\n            </svg>\n            {(() => {\n              const stylistName = getSelectedStylistName()\n              const instagramUrl = getSelectedStylistInstagramUrl()\n              \n              if (stylistName && instagramUrl) {\n                return (\n                  <a \n                    href={instagramUrl}\n                    target=\"_blank\"\n                    rel=\"noopener noreferrer\"\n                    className=\"text-xs md:text-sm font-light text-stone-600 hover:text-stone-800 tracking-wide transition-colors duration-300 underline decoration-stone-300 hover:decoration-stone-500\"\n                  >\n                    {stylistName}\n                  </a>\n                )\n              }\n              \n              return (\n                <span className=\"text-xs md:text-sm font-light text-stone-600 tracking-wide\">\n                  {stylistName || \"所有設計師\"}\n                </span>\n              )\n            })()}\n          </div>\n        </div>\n      </div>\n\n      {/* 底部微光效果 - 更簡約 */}\n      <div className=\"absolute bottom-0 left-0 w-full h-px bg-gradient-to-r from-transparent via-stone-200/50 to-transparent opacity-0 group-hover:opacity-100 transition-all duration-500\"></div>\n    </div>\n  )\n}\n\ninterface ServiceCardsSectionProps {\n  heading?: string\n  cardsPerRow?: number\n  cards?: Card[]\n}\n\nexport default function ServiceCardsSection({\n  heading,\n  cardsPerRow = 4,\n  cards = [],\n}: ServiceCardsSectionProps) {\n  const [selectedDesigner, setSelectedDesigner] = useState<string>(\"all\")\n  const [isMounted, setIsMounted] = useState(false)\n\n  useEffect(() => {\n    setIsMounted(true)\n  }, [])\n\n  // 資料驗證\n  const validCards = cards?.filter(card => \n    card && \n    typeof card === 'object' && \n    'title' in card &&\n    'englishTitle' in card\n  ) ?? []\n\n  // 從有效卡片中提取設計師資訊，過濾掉通用標籤\n  const allStylists = Array.from(new Set(\n    validCards.flatMap(card => \n      Array.isArray(card?.stylists) \n        ? card.stylists\n            .filter((s): s is Stylist => s !== null && s !== undefined && typeof s.stylistName === 'string')\n            .map(s => s.stylistName!)\n            .filter(name => {\n              const lowercaseName = name.toLowerCase()\n              // 過濾掉通用設計師標籤（包含更多變體）\n              return !lowercaseName.includes('all stylists') && \n                     !lowercaseName.includes('all stylist') && \n                     !lowercaseName.includes('指定') &&\n                     lowercaseName !== 'all' &&\n                     name.trim().length > 0\n            })\n        : []\n    )\n  )).sort()\n\n  if (!validCards.length) {\n    return null\n  }\n\n  return (\n    <section className=\"py-0 bg-stone-50/30\">\n      <div className=\"max-w-none w-full\">\n        <div className={clsx(\n          \"grid grid-cols-2 gap-0 w-full\",\n          cardsPerRow === 3 && \"lg:grid-cols-3\",\n          cardsPerRow === 4 && \"lg:grid-cols-4\"\n        )}>\n          {/* 設計師選擇卡片 - 作為第一張卡片 */}\n          {allStylists.length > 0 && (\n            <div className=\"w-full\">\n              <DesignerSelectorCard \n                allStylists={allStylists}\n                selectedDesigner={selectedDesigner}\n                onDesignerChange={setSelectedDesigner}\n                isMounted={isMounted}\n              />\n            </div>\n          )}\n          \n          {/* 服務卡片 */}\n          {validCards.map((card, idx) => (\n            <div key={`${selectedDesigner}-${idx}`} className=\"w-full\">\n              <ServiceCard \n                card={card}\n                selectedDesigner={selectedDesigner}\n              />\n            </div>\n          ))}\n        </div>\n      </div>\n    </section>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/home/components/youtube-section.tsx","messages":[{"ruleId":"sonarjs/cognitive-complexity","severity":2,"message":"Refactor this function to reduce its Cognitive Complexity from 23 to the 15 allowed.","line":17,"column":20,"nodeType":null,"messageId":"refactorFunction","endLine":17,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'isPlaying' is assigned a value but never used.","line":22,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":19},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'isPlaying' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":22,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":19},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":29,"column":3,"nodeType":"MemberExpression","messageId":"unexpected","endLine":29,"endColumn":14,"suggestions":[{"fix":{"range":[934,1137],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":45,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":45,"endColumn":16,"suggestions":[{"fix":{"range":[1390,1530],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":55,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":55,"endColumn":18,"suggestions":[{"fix":{"range":[1720,1789],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":67,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":67,"endColumn":20,"suggestions":[{"fix":{"range":[2118,2173],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":72,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":72,"endColumn":16,"suggestions":[{"fix":{"range":[2248,2307],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":86,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":86,"endColumn":20,"suggestions":[{"fix":{"range":[2754,2795],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":98,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":98,"endColumn":18,"suggestions":[{"fix":{"range":[3044,3296],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"sonarjs/cognitive-complexity","severity":2,"message":"Refactor this function to reduce its Cognitive Complexity from 31 to the 15 allowed.","line":121,"column":45,"nodeType":null,"messageId":"refactorFunction","endLine":121,"endColumn":47},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":124,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":124,"endColumn":18,"suggestions":[{"fix":{"range":[3718,3780],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":128,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":128,"endColumn":16,"suggestions":[{"fix":{"range":[3814,4061],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":139,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":139,"endColumn":18,"suggestions":[{"fix":{"range":[4135,4200],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":142,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":142,"endColumn":20,"suggestions":[{"fix":{"range":[4300,4399],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":148,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":148,"endColumn":21,"suggestions":[{"fix":{"range":[4559,4650],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":149,"column":56,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":149,"endColumn":58,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[4706,4708],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":153,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":153,"endColumn":21,"suggestions":[{"fix":{"range":[4804,4896],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":154,"column":55,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":154,"endColumn":57,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[4951,4953],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":161,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":161,"endColumn":18,"suggestions":[{"fix":{"range":[5122,5233],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":162,"column":31,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":162,"endColumn":33,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[5264,5266],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":166,"column":51,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":166,"endColumn":53,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[5354,5356],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":171,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":171,"endColumn":18,"suggestions":[{"fix":{"range":[5516,5832],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":182,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":182,"endColumn":20,"suggestions":[{"fix":{"range":[5874,5950],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":188,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":188,"endColumn":21,"suggestions":[{"fix":{"range":[6068,6165],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":193,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":193,"endColumn":21,"suggestions":[{"fix":{"range":[6263,6361],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":198,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":198,"endColumn":18,"suggestions":[{"fix":{"range":[6483,6586],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":203,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":203,"endColumn":16,"suggestions":[{"fix":{"range":[6653,6719],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":218,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":218,"endColumn":20,"suggestions":[{"fix":{"range":[7122,7156],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":227,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":227,"endColumn":16,"suggestions":[{"fix":{"range":[7384,7554],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":242,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":242,"endColumn":20,"suggestions":[{"fix":{"range":[7736,7805],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":251,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":251,"endColumn":20,"suggestions":[{"fix":{"range":[8183,8289],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":260,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":260,"endColumn":18,"suggestions":[{"fix":{"range":[8504,8564],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":289,"column":3,"nodeType":"MemberExpression","messageId":"unexpected","endLine":289,"endColumn":14,"suggestions":[{"fix":{"range":[9518,9959],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":352,"column":29,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":352,"endColumn":31,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[11528,11530],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":360,"column":17,"nodeType":"MemberExpression","messageId":"unexpected","endLine":360,"endColumn":28,"suggestions":[{"fix":{"range":[12026,12065],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":364,"column":17,"nodeType":"MemberExpression","messageId":"unexpected","endLine":364,"endColumn":28,"suggestions":[{"fix":{"range":[12165,12195],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":367,"column":34,"nodeType":"MemberExpression","messageId":"unexpected","endLine":367,"endColumn":45},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":368,"column":35,"nodeType":"MemberExpression","messageId":"unexpected","endLine":368,"endColumn":46},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":369,"column":31,"nodeType":"MemberExpression","messageId":"unexpected","endLine":369,"endColumn":44},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":377,"column":29,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":377,"endColumn":31,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[12805,12807],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":378,"column":30,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":378,"endColumn":32,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[12848,12850],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":11,"fatalErrorCount":0,"warningCount":31,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { useState, useEffect, useCallback, memo, useRef } from \"react\"\nimport type { YoutubeSection } from \"@lib/types/page-sections\"\n\nconst STORAGE_KEY = 'youtube-timestamp'\n\nconst YouTubeSection = memo(({ \n  heading, \n  description, \n  videoUrl, \n  videoMode = 'youtube',\n  youtubeSettings, \n  uploadSettings,\n  videoSettings, // 向後兼容\n  fullWidth = true \n}: YoutubeSection) => {\n  const [videoId, setVideoId] = useState<string | null>(null)\n  const [isShorts, setIsShorts] = useState<boolean>(false)\n  const [timestamp, setTimestamp] = useState<number>(0)\n  const [error, setError] = useState<string | null>(null)\n  const [isPlaying, setIsPlaying] = useState<boolean>(true) // 預設自動播放\n  const [isMobile, setIsMobile] = useState<boolean | null>(null) // null 表示尚未初始化\n  // iframe 和 video 元素引用\n  const iframeRef = useRef<HTMLIFrameElement>(null)\n  const videoRef = useRef<HTMLVideoElement>(null)\n\n  // 立即 log 接收到的 props\n  console.log('🚀 YouTubeSection Component Mounted with props:', {\n    heading,\n    description,\n    videoUrl,\n    videoMode,\n    youtubeSettings,\n    uploadSettings,\n    videoSettings,\n    fullWidth\n  });  // 從 URL 提取 YouTube 影片 ID\n    // 判斷是否為上傳檔案模式\n  const isUploadMode = videoMode === 'upload'\n  \n  const extractVideoId = (url: string): { videoId: string | null; isShorts: boolean } => {\n    if (!url) return { videoId: null, isShorts: false };\n    \n    console.log('🔄 Processing video URL:', url, {\n      isMobile,\n      videoSettings,\n      timestamp: new Date().toLocaleTimeString()\n    });\n\n    // Check if it's a YouTube Shorts URL\n    const shortsPattern = /(?:youtube\\.com\\/shorts\\/)([^&\\n?#]+)/;\n    const shortsMatch = url.match(shortsPattern);\n    if (shortsMatch) {\n      console.log('🎬 YouTube Shorts detected, video ID:', shortsMatch[1]);\n      return { videoId: shortsMatch[1], isShorts: true };\n    }\n\n    // Standard YouTube URLs\n    const standardPatterns = [\n      /(?:youtube\\.com\\/watch\\?v=|youtu\\.be\\/|youtube\\.com\\/embed\\/)([^&\\n?#]+)/,\n    ];\n\n    for (const pattern of standardPatterns) {\n      const match = url.match(pattern);\n      if (match) {\n        console.log('✅ Standard YouTube video, ID:', match[1]);\n        return { videoId: match[1], isShorts: false };\n      }\n    }\n\n    console.log('❌ Could not extract video ID from URL:', url);\n    return { videoId: null, isShorts: false };\n  };\n\n  // 處理 YouTube iframe 的訊息\n  const handleMessage = useCallback((event: MessageEvent) => {\n    try {\n      if (event.origin !== \"https://www.youtube.com\") return\n      \n      const data = JSON.parse(event.data)\n      if (data.event === \"onStateChange\" && data.info === 2) { // 2 = 暫停\n        localStorage.setItem(STORAGE_KEY, Math.floor(data.time).toString())\n      }\n    } catch (err) {\n      console.error('處理 YouTube 訊息時發生錯誤:', err)\n    }\n  }, [])\n\n  // 響應式檢測 - 確保只在客戶端執行\n  useEffect(() => {\n    const checkIsMobile = () => {\n      if (typeof window === 'undefined') return\n      \n      const mobile = window.innerWidth < 768\n      const changed = mobile !== isMobile\n      \n      console.log('📱 Device detection:', { \n        windowWidth: window.innerWidth, \n        wasMobile: isMobile,\n        nowMobile: mobile,\n        changed,\n        userAgent: navigator.userAgent,\n        timestamp: new Date().toLocaleTimeString()\n      })\n      \n      if (changed || isMobile === null) {\n        setIsMobile(mobile)\n      }\n    }\n    \n    // 初始檢查\n    checkIsMobile()\n    \n    // 監聽視窗大小變化\n    window.addEventListener('resize', checkIsMobile)\n    return () => window.removeEventListener('resize', checkIsMobile)\n  }, [isMobile])\n\n  // 獲取當前應該使用的影片 URL\n  const getCurrentVideoUrl = useCallback(() => {\n    // 等待 isMobile 狀態初始化完成\n    if (isMobile === null) {\n      console.log('⏳ Waiting for mobile detection to initialize...')\n      return null\n    }\n    \n    console.log('🔍 Raw props received:', {\n      videoMode,\n      videoUrl,\n      youtubeSettings,\n      uploadSettings,\n      videoSettings,\n      propsKeys: Object.keys({ videoMode, videoUrl, youtubeSettings, uploadSettings, videoSettings })\n    })\n\n    // 處理上傳模式\n    if (videoMode === 'upload' && uploadSettings) {\n      console.log('📁 Upload mode detected, processing video files...')\n      \n      if (uploadSettings.useSameVideo && uploadSettings.desktopVideo?.asset?.url) {\n        console.log('🔄 Using same uploaded video for all devices:', uploadSettings.desktopVideo.asset.url)\n        return uploadSettings.desktopVideo.asset.url\n      }\n\n      // 檢查是否有有效的檔案 URL\n      if (isMobile && !uploadSettings.mobileVideo?.asset?.url) {\n        console.warn('⚠️ Mobile device detected but no mobile video file, falling back to desktop')\n        return uploadSettings.desktopVideo?.asset?.url || null\n      }\n      \n      if (!isMobile && !uploadSettings.desktopVideo?.asset?.url) {\n        console.warn('⚠️ Desktop device detected but no desktop video file, falling back to mobile')\n        return uploadSettings.mobileVideo?.asset?.url || null\n      }\n\n      const selectedVideoUrl = isMobile \n        ? uploadSettings.mobileVideo?.asset?.url \n        : uploadSettings.desktopVideo?.asset?.url\n      \n      console.log(`🎬 FINAL SELECTION - ${isMobile ? 'MOBILE 📱' : 'DESKTOP 🖥️'} uploaded video:`, selectedVideoUrl)\n      return selectedVideoUrl || null\n    }\n\n    // 處理 YouTube 模式（默認）\n    const activeYoutubeSettings = youtubeSettings || videoSettings // 向後兼容\n    \n    if (activeYoutubeSettings) {\n      const { desktopVideoUrl, mobileVideoUrl, useSameVideo } = activeYoutubeSettings\n      \n      console.log('� YouTube mode, VideoSettings breakdown:', {\n        hasDesktopUrl: !!desktopVideoUrl,\n        hasMobileUrl: !!mobileVideoUrl,\n        desktopVideoUrl,\n        mobileVideoUrl,\n        useSameVideo,\n        isMobile,\n        windowWidth: typeof window !== 'undefined' ? window.innerWidth : 'SSR'\n      })\n      \n      if (useSameVideo) {\n        console.log('🔄 Using same YouTube video for all devices:', desktopVideoUrl)\n        return desktopVideoUrl\n      }\n      \n      // 檢查是否有有效的 URL\n      if (isMobile && !mobileVideoUrl) {\n        console.warn('⚠️ Mobile device detected but no mobileVideoUrl provided, falling back to desktop')\n        return desktopVideoUrl\n      }\n      \n      if (!isMobile && !desktopVideoUrl) {\n        console.warn('⚠️ Desktop device detected but no desktopVideoUrl provided, falling back to mobile')\n        return mobileVideoUrl\n      }\n      \n      const selectedUrl = isMobile ? mobileVideoUrl : desktopVideoUrl\n      console.log(`🎬 FINAL SELECTION - ${isMobile ? 'MOBILE 📱' : 'DESKTOP 🖥️'} YouTube URL:`, selectedUrl)\n      return selectedUrl\n    }\n    \n    // 向後兼容：使用舊的 videoUrl\n    console.log('🔙 Using fallback videoUrl (no settings):', videoUrl)\n    return videoUrl\n  }, [videoMode, youtubeSettings, uploadSettings, videoSettings, videoUrl, isMobile])\n\n  useEffect(() => {\n    try {\n      // 從本地儲存讀取上次的播放時間\n      const savedTime = localStorage.getItem(STORAGE_KEY)\n      if (savedTime) {\n        const parsedTime = parseInt(savedTime)\n        if (!isNaN(parsedTime)) {\n          setTimestamp(parsedTime)\n        }\n      }\n    } catch (err) {\n      console.error('讀取播放時間時發生錯誤:', err)\n    }\n\n    window.addEventListener('message', handleMessage)\n    return () => window.removeEventListener('message', handleMessage)\n  }, [handleMessage])\n\n  useEffect(() => {\n    const currentVideoUrl = getCurrentVideoUrl()\n    console.log('🔄 Processing video URL:', currentVideoUrl, { \n      isMobile, \n      videoMode,\n      isUploadMode,\n      timestamp: new Date().toLocaleTimeString() \n    })\n    \n    // 先清空狀態以強制重新載入\n    setVideoId(null)\n    setIsShorts(false)\n    setError(null)\n    \n    if (currentVideoUrl) {\n      if (isUploadMode) {\n        // 上傳模式：直接使用檔案 URL\n        console.log('✅ Upload mode - using video file URL:', currentVideoUrl)\n        setVideoId(currentVideoUrl) // 對於上傳模式，我們直接儲存 URL\n        \n        // 檢查是否為垂直視頻（基於設定或檔案名稱）\n        const isVertical = Boolean(isMobile && uploadSettings?.mobileVideo?.asset?.url === currentVideoUrl)\n        setIsShorts(isVertical)\n      } else {\n        // YouTube 模式：提取 video ID\n        const { videoId: id, isShorts: shorts } = extractVideoId(currentVideoUrl)\n        console.log('✅ YouTube mode - Extracted video ID:', id, 'isShorts:', shorts, 'from URL:', currentVideoUrl)\n        setVideoId(id)\n        setIsShorts(shorts)\n        if (!id) {\n          setError('無法從 URL 提取有效的 YouTube 影片 ID')\n        }\n      }\n    } else if (isMobile !== null) {\n      // 只有在 isMobile 初始化完成後才顯示錯誤\n      console.log('❌ No video URL available after initialization')\n      setError('沒有可用的影片 URL')\n    }\n  }, [getCurrentVideoUrl, extractVideoId, isMobile, videoMode, isUploadMode, uploadSettings])\n\n  // 生成影片源 URL\n  const getVideoSrc = () => {\n    if (isUploadMode) {\n      // 上傳模式：返回當前處理過的影片 URL（儲存在 videoId 中）\n      return videoId\n    } else {\n      // YouTube 模式：使用 YouTube 內建參數來隱藏品牌元素\n      // controls=0: 完全隱藏控制項\n      // showinfo=0: 隱藏影片資訊  \n      // fs=0: 禁用全螢幕按鈕\n      // disablekb=1: 禁用鍵盤控制\n      // iv_load_policy=3: 隱藏註解\n      // cc_load_policy=0: 隱藏字幕\n      // modestbranding=1: 移除 YouTube 標誌\n      // rel=0: 不顯示相關影片\n      // autohide=1: 自動隱藏控制項\n      // wmode=transparent: 透明背景\n      return `https://www.youtube.com/embed/${videoId}?autoplay=1&mute=1&loop=1&playlist=${videoId}&controls=0&showinfo=0&fs=0&playsinline=1&rel=0&modestbranding=1&disablekb=1&iv_load_policy=3&cc_load_policy=0&autohide=1&wmode=transparent&start=${timestamp}&enablejsapi=1`\n    }\n  }\n\n  const videoSrc = getVideoSrc()\n\n  // 除錯資訊\n  console.log('🎬 Video Section render state:', {\n    error,\n    videoId,\n    videoUrl,\n    videoMode,\n    isUploadMode,\n    youtubeSettings,\n    uploadSettings,\n    videoSettings,\n    isMobile,\n    isShorts,\n    videoSrc,\n    isInitialized: isMobile !== null,\n    renderMode: isUploadMode ? 'VIDEO_ELEMENT' : 'YOUTUBE_IFRAME',\n    willRenderVideo: Boolean(isUploadMode && videoId),\n    willRenderIframe: Boolean(!isUploadMode && videoId)\n  })\n\n  // 初始化中\n  if (isMobile === null) {\n    return (\n      <div className=\"p-4 text-gray-500 text-center\">\n        <p>正在初始化響應式影片設定...</p>\n      </div>\n    )\n  }\n\n  if (error) {\n    return (\n      <div className=\"p-4 text-red-500 text-center\">\n        <p>{error}</p>\n        <p className=\"text-sm mt-2\">Debug: {JSON.stringify({ videoUrl, videoSettings, isMobile, windowWidth: typeof window !== 'undefined' ? window.innerWidth : 'SSR' })}</p>\n      </div>\n    )\n  }\n\n  if (!videoId) {\n    return (\n      <div className=\"p-4 text-gray-500 text-center\">\n        <p>載入影片中...</p>\n        <p className=\"text-sm mt-2\">Debug: {JSON.stringify({ videoUrl, videoSettings, isMobile, windowWidth: typeof window !== 'undefined' ? window.innerWidth : 'SSR' })}</p>\n      </div>\n    )\n  }\n\n  return (\n    <section className={`w-full ${fullWidth ? \"\" : \"container mx-auto px-4\"}`}>\n      <div className=\"max-w-none w-full\">\n        {heading && (\n          <h2 className=\"h1 text-center mb-6\">{heading}</h2>\n        )}\n        {/* YouTube Shorts 使用垂直全寬樣式，標準 YouTube 使用 16:9 */}\n        <div className={`group relative overflow-hidden ${\n          isShorts \n            ? \"pb-[177.78%] w-full md:max-w-sm md:mx-auto\" // 9:16 比例，手機全寬，桌面居中\n            : \"pb-[56.25%]\" // 16:9 比例，標準 YouTube\n        }`}>\n          {isUploadMode ? (\n            // 上傳模式：使用 HTML5 video 元素\n            <video\n              ref={videoRef}\n              key={`video-${videoId}-${isMobile}-${isShorts}`}\n              className=\"absolute top-0 left-0 w-full h-full border-0 object-cover\"\n              src={videoSrc || undefined}\n              autoPlay={isUploadMode ? uploadSettings?.autoplay : youtubeSettings?.autoplay}\n              loop={isUploadMode ? uploadSettings?.loop : youtubeSettings?.loop}\n              muted={(isUploadMode ? uploadSettings?.muted : youtubeSettings?.muted) !== false} // 預設靜音\n              controls={isUploadMode ? uploadSettings?.showControls : youtubeSettings?.showControls}\n              playsInline\n              preload=\"metadata\"\n              onPlay={() => {\n                console.log('🎬 Video started playing')\n                setIsPlaying(true)\n              }}\n              onPause={() => {\n                console.log('⏸️ Video paused')\n                setIsPlaying(false)\n              }}\n              onLoadStart={() => console.log('📂 Video file loading started')}\n              onLoadedData={() => console.log('✅ Video file loaded successfully')}\n              onError={(e) => console.error('❌ Video error:', e)}\n            />\n          ) : (\n            // YouTube 模式：使用 iframe\n            <iframe\n              ref={iframeRef}\n              key={`iframe-${videoId}-${isMobile}-${isShorts}`} // 當 videoId、isMobile 或 isShorts 改變時重新創建 iframe\n              className=\"absolute top-0 left-0 w-full h-full border-0\"\n              src={videoSrc || undefined}\n              title={heading || (isShorts ? \"YouTube Shorts\" : \"YouTube video\")}\n              allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\"\n              allowFullScreen={false}\n            />\n          )}\n        </div>\n        {description && (\n          <p className=\"text-body-large text-center mt-4\">{description}</p>\n        )}\n      </div>\n    </section>\n  )\n}, (prevProps, nextProps) => {\n  // 只有當這些屬性改變時才重新渲染\n  const videoSettingsEqual = JSON.stringify(prevProps.videoSettings) === JSON.stringify(nextProps.videoSettings)\n  \n  return (\n    prevProps.videoUrl === nextProps.videoUrl &&\n    prevProps.heading === nextProps.heading &&\n    prevProps.description === nextProps.description &&\n    prevProps.fullWidth === nextProps.fullWidth &&\n    videoSettingsEqual\n  )\n})\n\nYouTubeSection.displayName = 'YouTubeSection'\n\nexport default YouTubeSection","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/home/components/youtube-section/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/home/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/layout/components/account-button/index.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'customer' is assigned a value but never used.","line":9,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":18},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'customer' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":9,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":18},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":16,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[589,592],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[589,592],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":16,"column":46,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":16,"endColumn":48,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[603,605],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":18,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":21},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":18,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":21},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":19,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":19,"endColumn":20,"suggestions":[{"fix":{"range":[654,691],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport LocalizedClientLink from \"@modules/common/components/localized-client-link\"\nimport { StoreCustomer } from \"@medusajs/types\"\nimport { useEffect, useState } from \"react\"\nimport safeFetchGlobal from '../../../../lib/safe-fetch'\n\nexport default function AccountButton() {\n  const [customer, setCustomer] = useState<StoreCustomer | null>(null)\n\n  useEffect(() => {\n    const fetchCustomer = async () => {\n      try {\n        const data = await safeFetchGlobal('/api/customer', undefined, null)\n        if (data && typeof data === 'object') {\n          setCustomer((data as any).customer || null)\n        }\n      } catch (error) {\n        console.log('Customer not logged in')\n        setCustomer(null)\n      }\n    }\n    fetchCustomer()\n  }, [])\n\n  return (\n    <LocalizedClientLink\n      className=\"text-xs tracking-wider uppercase font-medium hover:text-black/70 transition-colors duration-200 flex items-center gap-2\"\n      href=\"/account\"\n      data-testid=\"nav-account-link\"\n    >\n      <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1\">\n        <path d=\"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2\"></path>\n        <circle cx=\"12\" cy=\"7\" r=\"4\"></circle>\n      </svg>\n      <span className=\"!text-xs !font-medium !leading-none\">帳戶</span>\n    </LocalizedClientLink>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/layout/components/cart-button/index.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":19,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[772,775],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[772,775],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":19,"column":36,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":19,"endColumn":38,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[782,784],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":22,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":22,"endColumn":20,"suggestions":[{"fix":{"range":[827,872],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":60,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":60,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1814,1817],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1814,1817],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":62,"column":9,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":62,"endColumn":11,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1863,1865],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport CartDropdown from \"../cart-dropdown\"\nimport LocalizedClientLink from \"@modules/common/components/localized-client-link\"\nimport { useEffect, useState, useCallback, useRef } from \"react\"\nimport { HttpTypes } from \"@medusajs/types\"\nimport safeFetchGlobal from '../../../../lib/safe-fetch'\n\nexport default function CartButton() {\n  const [cart, setCart] = useState<HttpTypes.StoreCart | null>(null)\n  const [showDropdown, setShowDropdown] = useState(false)\n  const dropdownRef = useRef<HTMLDivElement>(null)\n\n  // 獨立的獲取購物車函數 - 使用 API 路由而非 Server Action\n  const fetchCart = useCallback(async () => {\n    try {\n      const data = await safeFetchGlobal('/api/cart/get', undefined, null)\n      if (data && typeof data === 'object') {\n        setCart((data as any).cart || null)\n      }\n    } catch (error) {\n      console.error('Failed to fetch cart:', error)\n      setCart(null)\n    }\n  }, [])\n\n  // 點擊外部關閉下拉選單\n  useEffect(() => {\n    const handleClickOutside = (event: MouseEvent) => {\n      if (dropdownRef.current && !dropdownRef.current.contains(event.target as Node)) {\n        setShowDropdown(false)\n      }\n    }\n\n    if (showDropdown && typeof document !== 'undefined') {\n      document.addEventListener('mousedown', handleClickOutside)\n    }\n\n    return () => {\n      if (typeof document !== 'undefined') {\n        document.removeEventListener('mousedown', handleClickOutside)\n      }\n    }\n  }, [showDropdown])\n\n  useEffect(() => {\n    fetchCart()\n\n    // 添加全局事件監聽器來更新購物車\n    if (typeof window !== 'undefined') {\n      window.addEventListener('cartUpdate', fetchCart)\n    }\n    return () => {\n      if (typeof window !== 'undefined') {\n        window.removeEventListener('cartUpdate', fetchCart)\n      }\n    }\n  }, [fetchCart])\n\n  const totalItems = cart?.items?.reduce((acc: number, item: any) => {\n    return acc + item.quantity\n  }, 0) || 0\n\n  return (\n    <div className=\"relative\" ref={dropdownRef}>\n      {/* 桌機版 - 按鈕顯示下拉選單 */}\n      <button \n        onClick={() => setShowDropdown(!showDropdown)}\n        className=\"hidden lg:flex items-center gap-2 text-xs tracking-wider uppercase font-medium hover:text-black/70 transition-colors duration-200\"\n        aria-label=\"購物車\"\n      >\n        <div className=\"relative\">\n          <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1\">\n            <path d=\"M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z\"></path>\n            <line x1=\"3\" y1=\"6\" x2=\"21\" y2=\"6\"></line>\n            <path d=\"M16 10a4 4 0 0 1-8 0\"></path>\n          </svg>\n          {/* 桌機版數字徽章 - 覆蓋在 icon 上 */}\n          {totalItems > 0 && (\n            <span className=\"absolute -top-2 -right-2 bg-red-500 text-white text-xs w-5 h-5 rounded-full flex items-center justify-center font-medium\">\n              {totalItems}\n            </span>\n          )}\n        </div>\n        <span className=\"!text-xs !font-medium !leading-none\">\n          購物車\n        </span>\n      </button>\n\n      {/* 手機版 - 連結直接跳轉到購物車頁面 */}\n      <LocalizedClientLink\n        href=\"/cart\"\n        className=\"lg:hidden flex items-center gap-2 text-xs tracking-wider uppercase font-medium hover:text-black/70 transition-colors duration-200\"\n        aria-label=\"購物車\"\n      >\n        <div className=\"relative\">\n          <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1\">\n            <path d=\"M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z\"></path>\n            <line x1=\"3\" y1=\"6\" x2=\"21\" y2=\"6\"></line>\n            <path d=\"M16 10a4 4 0 0 1-8 0\"></path>\n          </svg>\n          {/* 手機版數字徽章 - 覆蓋在 icon 上 */}\n          {totalItems > 0 && (\n            <span className=\"absolute -top-2 -right-2 bg-red-500 text-white text-xs w-5 h-5 rounded-full flex items-center justify-center font-medium\">\n              {totalItems}\n            </span>\n          )}\n        </div>\n      </LocalizedClientLink>\n      \n      {/* 桌機版下拉選單 */}\n      {showDropdown && (\n        <div className=\"hidden lg:block absolute top-[calc(100%+1px)] right-0 bg-white border-x border-b border-gray-200 w-[420px] text-gray-900 z-50 shadow-lg\">\n          <CartDropdown cart={cart} onClose={() => setShowDropdown(false)} />\n        </div>\n      )}\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/layout/components/cart-dropdown/index.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'totalItems' is assigned a value but never used.","line":19,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":19},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'totalItems' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":19,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":19},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":22,"column":11,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":22,"endColumn":13,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[743,745],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":52,"column":8,"nodeType":null,"messageId":"preferOptionalChain","endLine":52,"endColumn":44,"fix":{"range":[1745,1781],"text":"cartState?.items?.length"}}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":1,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { convertToLocale } from \"@lib/util/money\"\nimport { HttpTypes } from \"@medusajs/types\"\nimport { Button } from \"@medusajs/ui\"\nimport DeleteButton from \"@modules/common/components/delete-button\"\nimport LineItemOptions from \"@modules/common/components/line-item-options\"\nimport LineItemPrice from \"@modules/common/components/line-item-price\"\nimport LocalizedClientLink from \"@modules/common/components/localized-client-link\"\nimport Thumbnail from \"@modules/products/components/thumbnail\"\n\nconst CartDropdown = ({\n  cart: cartState,\n  onClose,\n}: {\n  cart?: HttpTypes.StoreCart | null\n  onClose?: () => void\n}) => {\n  const totalItems =\n    cartState?.items?.reduce((acc, item) => {\n      return acc + item.quantity\n    }, 0) || 0\n\n  const subtotal = cartState?.subtotal ?? 0\n\n  return (\n    <div className=\"hidden small:block absolute top-[calc(100%+1px)] right-0 bg-white border-x border-b border-gray-200 w-[420px] text-ui-fg-base z-50 shadow-lg\">\n      <div className=\"p-6 flex items-center justify-between border-b border-gray-100\">\n        <h3 className=\"text-base font-semibold\">購物車</h3>\n        {onClose && (\n          <button\n            onClick={onClose}\n            className=\"text-gray-400 hover:text-gray-600 transition-colors duration-200 p-1\"\n            aria-label=\"關閉購物車\"\n          >\n            <svg \n              className=\"w-5 h-5\" \n              fill=\"none\" \n              stroke=\"currentColor\" \n              viewBox=\"0 0 24 24\"\n            >\n              <path \n                strokeLinecap=\"round\" \n                strokeLinejoin=\"round\" \n                strokeWidth={2} \n                d=\"M6 18L18 6M6 6l12 12\" \n              />\n            </svg>\n          </button>\n        )}\n      </div>\n      {cartState && cartState.items?.length ? (\n        <>\n          <div className=\"overflow-y-scroll max-h-[350px] px-6 py-4 grid grid-cols-1 gap-y-6 no-scrollbar\">\n            {cartState.items\n              .sort((a, b) => {\n                return (a.created_at ?? \"\") > (b.created_at ?? \"\")\n                  ? -1\n                  : 1\n              })\n              .map((item) => (\n                <div\n                  className=\"grid grid-cols-[90px_1fr_100px] gap-x-3 pr-4\"\n                  key={item.id}\n                  data-testid=\"cart-item\"\n                >\n                  <LocalizedClientLink\n                    href={`/products/${item.product_handle}`}\n                    className=\"w-24\"\n                  >\n                    <Thumbnail\n                      thumbnail={item.thumbnail}\n                      images={item.variant?.product?.images}\n                            size=\"square\"\n                          />\n                        </LocalizedClientLink>\n                  <div className=\"flex flex-col justify-between flex-1 min-h-[80px]\">\n                    <div className=\"flex flex-col flex-1\">\n                      <div className=\"flex flex-col\">\n                        <h4 className=\"text-sm font-medium leading-tight break-words\">\n                          <LocalizedClientLink\n                            href={`/products/${item.product_handle}`}\n                            data-testid=\"product-link\"\n                          >\n                            {item.title}\n                          </LocalizedClientLink>\n                        </h4>\n                        <div className=\"flex flex-col gap-1 mt-2\">\n                          <LineItemOptions\n                            variant={item.variant}\n                            data-testid=\"cart-item-variant\"\n                            data-value={item.variant}\n                          />\n                          <div className=\"flex items-center gap-3\">\n                            <span\n                              className=\"text-xs text-gray-600\"\n                              data-testid=\"cart-item-quantity\"\n                              data-value={item.quantity}\n                            >\n                              數量: {item.quantity}\n                            </span>\n                            <DeleteButton\n                              id={item.id}\n                              className=\"text-xs p-0 hover:text-red-600 transition-colors\"\n                              data-testid=\"cart-item-remove-button\"\n                            />\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                  <div className=\"flex flex-col justify-start items-end\">\n                    <LineItemPrice\n                      item={item}\n                      style=\"tight\"\n                      currencyCode={cartState.currency_code}\n                    />\n                  </div>\n                </div>\n              ))}\n          </div>\n          <div className=\"p-6 border-t border-gray-100 flex flex-col gap-y-4 text-sm\">\n            <div className=\"flex items-center justify-between\">\n              <span className=\"text-gray-700 font-medium\">\n                小計{\" \"}\n                <span className=\"font-normal text-xs text-gray-500\">(未含稅)</span>\n              </span>\n              <span\n                className=\"text-base font-semibold\"\n                data-testid=\"cart-subtotal\"\n                data-value={subtotal}\n              >\n                {convertToLocale({\n                  amount: subtotal,\n                  currency_code: cartState.currency_code,\n                })}\n              </span>\n            </div>\n            <LocalizedClientLink \n              href=\"/cart\" \n              passHref\n              onClick={onClose}\n            >\n              <Button\n                className=\"w-full\"\n                size=\"large\"\n                data-testid=\"go-to-cart-button\"\n              >\n                前往購物車\n              </Button>\n            </LocalizedClientLink>\n          </div>\n        </>\n      ) : (\n        <div className=\"px-6 py-12\">\n          <div className=\"flex flex-col gap-y-6 items-center justify-center text-center\">\n            <div className=\"bg-gray-100 text-gray-600 text-sm flex items-center justify-center w-12 h-12 rounded-full\">\n              <span>0</span>\n            </div>\n            <span className=\"text-sm text-gray-600\">您的購物車是空的</span>\n            <div>\n              <LocalizedClientLink href=\"/store\">\n                <>\n                  <span className=\"sr-only\">前往所有商品頁面</span>\n                  <Button size=\"base\">探索商品</Button>\n                </>\n              </LocalizedClientLink>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  )\n}\n\nexport default CartDropdown\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/layout/components/cart-mismatch-banner/index.tsx","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":29,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":29,"endColumn":20,"suggestions":[{"fix":{"range":[849,900],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":34,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":34,"endColumn":24,"suggestions":[{"fix":{"range":[1013,1044],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { transferCart } from \"@lib/data/customer\"\nimport { ExclamationCircleSolid } from \"@medusajs/icons\"\nimport { StoreCart, StoreCustomer } from \"@medusajs/types\"\nimport { Button } from \"@medusajs/ui\"\nimport { useState, useEffect } from \"react\"\n\nfunction CartMismatchBanner(props: {\n  customer: StoreCustomer\n  cart: StoreCart\n}) {\n  const { customer, cart } = props\n  const [isPending, setIsPending] = useState(false)\n  const [actionText, setActionText] = useState(\"重新同步購物車\")\n  const [shouldShow, setShouldShow] = useState(false)\n  const [autoRetryCount, setAutoRetryCount] = useState(0)\n\n  // 檢查是否需要顯示橫幅\n  useEffect(() => {\n    if (!customer || !!cart.customer_id || autoRetryCount >= 3) {\n      setShouldShow(false)\n      return\n    }\n\n    // 自動嘗試修復購物車關聯\n    const autoFix = async () => {\n      if (autoRetryCount < 2) {\n        console.log(`自動修復購物車關聯 (嘗試 ${autoRetryCount + 1})`)\n        try {\n          await transferCart()\n          // 如果成功，組件會重新渲染且不會顯示\n        } catch (error) {\n          console.error(\"自動修復失敗:\", error)\n          setAutoRetryCount(prev => prev + 1)\n          \n          // 第二次失敗後才顯示手動修復選項\n          if (autoRetryCount >= 1) {\n            setShouldShow(true)\n          } else {\n            // 等待 2 秒後再次嘗試\n            setTimeout(autoFix, 2000)\n          }\n        }\n      } else {\n        setShouldShow(true)\n      }\n    }\n\n    autoFix()\n  }, [customer, cart.customer_id, autoRetryCount])\n\n  if (!shouldShow) {\n    return null\n  }\n\n  const handleSubmit = async () => {\n    try {\n      setIsPending(true)\n      setActionText(\"同步中...\")\n\n      await transferCart()\n      // 成功後隱藏橫幅\n      setShouldShow(false)\n    } catch {\n      setActionText(\"重新同步購物車\")\n      setIsPending(false)\n    }\n  }\n\n  return (\n    <div className=\"flex items-center justify-center small:p-4 p-2 text-center bg-blue-50 small:gap-2 gap-1 text-sm mt-2 text-blue-800 border border-blue-200\">\n      <div className=\"flex flex-col small:flex-row small:gap-2 gap-1 items-center\">\n        <span className=\"flex items-center gap-1\">\n          <ExclamationCircleSolid className=\"inline\" />\n          購物車同步出現問題，正在嘗試修復...\n        </span>\n\n        <span>·</span>\n\n        <Button\n          variant=\"transparent\"\n          className=\"hover:bg-blue-100 active:bg-blue-100 focus:bg-blue-100 disabled:text-blue-400 text-blue-700 p-0 bg-transparent\"\n          size=\"base\"\n          disabled={isPending}\n          onClick={handleSubmit}\n        >\n          {actionText}\n        </Button>\n      </div>\n    </div>\n  )\n}\n\nexport default CartMismatchBanner\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/layout/components/copyright-year/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/layout/components/copyright/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/layout/components/country-select/index.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'StateType' is defined but never used.","line":13,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":19},{"ruleId":"unused-imports/no-unused-imports","severity":2,"message":"'StateType' is defined but never used.","line":13,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":19,"fix":{"range":[241,297],"text":""}}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":1,"fixableWarningCount":0,"source":"\"use client\"\n\nimport {\n  Listbox,\n  ListboxButton,\n  ListboxOption,\n  ListboxOptions,\n  Transition,\n} from \"@headlessui/react\"\nimport { Fragment, useEffect, useMemo, useState } from \"react\"\nimport ReactCountryFlag from \"react-country-flag\"\n\nimport { StateType } from \"@lib/hooks/use-toggle-state\"\nimport { useParams, usePathname } from \"next/navigation\"\nimport { updateRegion } from \"@lib/data/cart\"\nimport { HttpTypes } from \"@medusajs/types\"\n\ntype CountryOption = {\n  country: string\n  region: string\n  label: string\n}\n\ntype CountrySelectProps = {\n  regions: HttpTypes.StoreRegion[]\n}\n\nconst CountrySelect = ({ regions }: CountrySelectProps) => {\n  const [current, setCurrent] = useState<\n    | { country: string | undefined; region: string; label: string | undefined }\n    | undefined\n  >(undefined)\n  const [isMounted, setIsMounted] = useState(false)\n\n  const { countryCode } = useParams()\n  const currentPath = usePathname().split(`/${countryCode}`)[1]\n\n  const options = useMemo(() => {\n    return regions\n      ?.map((r) => {\n        return r.countries?.map((c) => ({\n          country: c.iso_2,\n          region: r.id,\n          label: c.display_name,\n        }))\n      })\n      .flat()\n      .sort((a, b) => (a?.label ?? \"\").localeCompare(b?.label ?? \"\"))\n  }, [regions])\n\n  useEffect(() => {\n    setIsMounted(true)\n  }, [])\n\n  useEffect(() => {\n    if (countryCode) {\n      const option = options?.find((o) => o?.country === countryCode)\n      setCurrent(option)\n    }\n  }, [options, countryCode])\n\n  const handleChange = (option: CountryOption) => {\n    updateRegion(option.country, currentPath)\n  }\n\n  // 防止 hydration 不匹配，只在客戶端渲染\n  if (!isMounted) {\n    return (\n      <div className=\"w-[60px]\">\n        <div className=\"py-1 w-full\">\n          <div className=\"txt-compact-small flex justify-center items-center\">\n            {current && (\n              <span className=\"flex items-center justify-center\">\n                <ReactCountryFlag\n                  svg\n                  style={{\n                    width: \"16px\",\n                    height: \"16px\",\n                  }}\n                  countryCode={current.country ?? \"\"}\n                />\n              </span>\n            )}\n          </div>\n        </div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"w-[60px]\">\n      <Listbox\n        as=\"div\"\n        defaultValue={\n          countryCode\n            ? options?.find((o) => o?.country === countryCode)\n            : undefined\n        }\n      >\n        {({ open }) => (\n          <>\n            <ListboxButton className=\"py-1 w-full\">\n              <div className=\"txt-compact-small flex justify-center items-center\">\n                {current && (\n                  <>\n                    <span className=\"flex items-center justify-center\">\n                      {/* @ts-ignore */}\n                      <ReactCountryFlag\n                        svg\n                        style={{\n                          width: \"16px\",\n                          height: \"16px\",\n                        }}\n                        countryCode={current.country ?? \"\"}\n                      />\n                    </span>\n                  </>\n                )}\n              </div>\n            </ListboxButton>\n            <div className=\"flex relative w-[60px] justify-end\">\n              <Transition\n                show={open}\n                as={Fragment}\n                leave=\"transition ease-in duration-150\"\n                leaveFrom=\"opacity-100\"\n                leaveTo=\"opacity-0\"\n              >\n                <ListboxOptions\n                  className=\"absolute top-full right-0 max-h-[442px] overflow-y-scroll z-[900] bg-white drop-shadow-md text-small-regular uppercase text-black no-scrollbar rounded-rounded w-[60px]\"\n                  static\n                >\n                  {options?.map((o, index) => {\n                    return (\n                      <ListboxOption\n                        key={index}\n                        value={o}\n                        onClick={() => { if (o) handleChange(o as CountryOption) }}\n                        className=\"py-2 hover:bg-gray-200 px-3 cursor-pointer flex items-center justify-center w-full\"\n                      >\n                        {/* @ts-ignore */}\n                        <ReactCountryFlag\n                          svg\n                          style={{\n                            width: \"16px\",\n                            height: \"16px\",\n                          }}\n                          countryCode={o?.country ?? \"\"}\n                        />\n                      </ListboxOption>\n                    )\n                  })}\n                </ListboxOptions>\n              </Transition>\n            </div>\n          </>\n        )}\n      </Listbox>\n    </div>\n  )\n}\nexport default CountrySelect\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/layout/components/header-height-setter/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/layout/components/medusa-cta/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/layout/components/mobile-menu.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'useMemo' is defined but never used.","line":3,"column":39,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":46},{"ruleId":"unused-imports/no-unused-imports","severity":2,"message":"'useMemo' is defined but never used.","line":3,"column":39,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":46,"fix":{"range":[50,59],"text":""}},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'headerData' is defined but never used.","line":17,"column":71,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":81},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'headerData' is defined but never used. Allowed unused args must match /^_/u.","line":17,"column":71,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":81},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":87,"column":15,"nodeType":"MemberExpression","messageId":"unexpected","endLine":87,"endColumn":26,"suggestions":[{"fix":{"range":[2753,2796],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":140,"column":14,"nodeType":null,"messageId":"preferOptionalChain","endLine":177,"endColumn":15,"fix":{"range":[4472,5806],"text":"navigation?.map(({ name, href }, index) => {\n              // 判斷是否為外部連結\n              const isExternal = /^(http|https|www)/.test(href)\n              // 判斷是否為首頁連結 (支援 / 和 /home)\n              const isHome = href === '/' || href === '/home'\n              // 處理連結\n              const processedHref = isExternal \n                ? href \n                : isHome \n                  ? '/'\n                  : href.startsWith('/') \n                    ? href \n                    : `/${href}`\n\n              const uniqueKey = `mobile-nav-${index}-${name.replace(/[^a-zA-Z0-9]/g, '')}-${href.replace(/[^a-zA-Z0-9]/g, '')}`\n\n              return isExternal ? (\n                <a\n                  key={uniqueKey}\n                  href={href}\n                  className=\"block py-2 text-lg\"\n                  target=\"_blank\" \n                  rel=\"noopener noreferrer\"\n                  onClick={() => setIsOpen(false)}\n                >\n                  {name}\n                </a>\n              ) : (\n                <LocalizedClientLink\n                  key={uniqueKey}\n                  href={processedHref}\n                  className=\"block py-2 text-lg\"\n                  onClick={() => setIsOpen(false)}\n                >\n                  {name}\n                </LocalizedClientLink>\n              )\n            })"}}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":2,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { useState, useRef, useEffect, useMemo } from \"react\"\nimport { XMarkIcon, Bars3Icon, MagnifyingGlassIcon } from \"@heroicons/react/24/outline\"\nimport { StoreRegion } from \"@medusajs/types\"\nimport LocalizedClientLink from \"@modules/common/components/localized-client-link\"\nimport CountrySelect from \"@modules/layout/components/country-select\"\nimport { SanityHeader, NavigationItem } from \"../../../types/global\"\n\ntype MobileMenuProps = {\n  regions: StoreRegion[]\n  navigation?: NavigationItem[]  // 更新為 NavigationItem[] 類型\n  categories?: Array<{id: string; handle: string; name: string}>\n  headerData?: SanityHeader\n}\n\nexport default function MobileMenu({ regions, navigation, categories, headerData }: MobileMenuProps) {\n  const [isOpen, setIsOpen] = useState(false)\n  const [showSearch, setShowSearch] = useState(false)\n  const [menuTopOffset, setMenuTopOffset] = useState(0)\n  const searchRef = useRef<HTMLInputElement>(null)\n\n  // 動態計算選單頂部偏移 - 確保選單緊貼導覽列底部\n  useEffect(() => {\n    const calculateMenuTopOffset = () => {\n      // 直接使用 sticky 導覽列的位置計算\n      const stickyNav = document.querySelector('.sticky.top-0')\n      \n      if (stickyNav) {\n        const stickyNavRect = stickyNav.getBoundingClientRect()\n        // 選單頂部位置 = sticky 導覽列頂部 + sticky 導覽列高度\n        const totalOffset = stickyNavRect.top + stickyNavRect.height\n        \n        setMenuTopOffset(totalOffset)\n      }\n    }\n\n    // 初始計算\n    calculateMenuTopOffset()\n\n    // 監聽視窗大小變化\n    window.addEventListener('resize', calculateMenuTopOffset)\n    \n    // 使用 MutationObserver 監聽 DOM 變化\n    const observer = new MutationObserver(() => {\n      // 延遲一點計算，確保 DOM 更新完成\n      setTimeout(calculateMenuTopOffset, 100)\n    })\n    const targetNode = document.body\n    observer.observe(targetNode, {\n      childList: true,\n      subtree: true,\n      attributes: true,\n      attributeFilter: ['class', 'style']\n    })\n\n    return () => {\n      window.removeEventListener('resize', calculateMenuTopOffset)\n      observer.disconnect()\n    }\n  }, [isOpen]) // 當選單開啟時重新計算\n\n  useEffect(() => {\n    if (showSearch && searchRef.current) {\n      searchRef.current.focus()\n    }\n  }, [showSearch])\n\n  useEffect(() => {\n    if (showSearch && searchRef.current) {\n      searchRef.current.focus()\n    }\n  }, [showSearch])\n\n  return (\n    <div className=\"block lg:hidden\">\n      <button\n        onClick={() => {\n          setIsOpen(true)\n          // 立即重新計算選單位置\n          setTimeout(() => {\n            const stickyNav = document.querySelector('.sticky.top-0')\n            if (stickyNav) {\n              const stickyNavRect = stickyNav.getBoundingClientRect()\n              const totalOffset = stickyNavRect.top + stickyNavRect.height\n              setMenuTopOffset(totalOffset)\n              console.log(`📱 開啟選單時位置: ${totalOffset}px`)\n            }\n          }, 10)\n        }}\n        className=\"flex items-center justify-center w-8 h-8\"\n        aria-label=\"開啟選單\"\n      >\n        <Bars3Icon className=\"w-6 h-6\" />\n      </button>\n\n      {isOpen && (\n        <div \n          className=\"fixed inset-x-0 bottom-0 z-[110] bg-white shadow-lg border-t border-gray-200\"\n          style={{\n            top: `${menuTopOffset}px`,\n            maxHeight: `calc(100vh - ${menuTopOffset}px)`,\n            overflowY: 'auto'\n          }}\n        >\n          <div className=\"flex items-center justify-between p-4 border-b\">\n            <div className=\"flex-1\"></div>\n            <button\n              onClick={() => setIsOpen(false)}\n              className=\"flex items-center justify-center w-8 h-8\"\n            >\n              <XMarkIcon className=\"w-6 h-6\" />\n            </button>\n          </div>\n          \n          <div className=\"p-4 space-y-4\">\n            {/* Search */}\n            <div className=\"flex items-center\">\n              {showSearch ? (\n                <div className=\"relative w-full\">\n                  <input\n                    ref={searchRef}\n                    type=\"text\"\n                    placeholder=\"搜尋商品...\"\n                    className=\"w-full p-2 border rounded-lg\"\n                    onBlur={() => setShowSearch(false)}\n                  />\n                </div>\n              ) : (\n                <button \n                  onClick={() => setShowSearch(true)}\n                  className=\"p-2\"\n                >\n                  <MagnifyingGlassIcon className=\"w-5 h-5\" />\n                </button>\n              )}\n            </div>\n\n            {/* Navigation */}\n            {navigation && navigation.map(({ name, href }, index) => {\n              // 判斷是否為外部連結\n              const isExternal = /^(http|https|www)/.test(href)\n              // 判斷是否為首頁連結 (支援 / 和 /home)\n              const isHome = href === '/' || href === '/home'\n              // 處理連結\n              const processedHref = isExternal \n                ? href \n                : isHome \n                  ? '/'\n                  : href.startsWith('/') \n                    ? href \n                    : `/${href}`\n\n              const uniqueKey = `mobile-nav-${index}-${name.replace(/[^a-zA-Z0-9]/g, '')}-${href.replace(/[^a-zA-Z0-9]/g, '')}`\n\n              return isExternal ? (\n                <a\n                  key={uniqueKey}\n                  href={href}\n                  className=\"block py-2 text-lg\"\n                  target=\"_blank\" \n                  rel=\"noopener noreferrer\"\n                  onClick={() => setIsOpen(false)}\n                >\n                  {name}\n                </a>\n              ) : (\n                <LocalizedClientLink\n                  key={uniqueKey}\n                  href={processedHref}\n                  className=\"block py-2 text-lg\"\n                  onClick={() => setIsOpen(false)}\n                >\n                  {name}\n                </LocalizedClientLink>\n              )\n            })}\n\n            {regions && (\n              <div className=\"pt-4 border-t\">\n                <CountrySelect regions={regions} />\n              </div>\n            )}\n\n            {/* Categories */}\n            {categories && categories.length > 0 && (\n              <div className=\"pt-2 border-t\">\n                <h3 className=\"py-2 font-medium\">商品分類</h3>\n                <div className=\"grid grid-cols-2 gap-2\">\n                  {categories.map((category) => (\n                    <LocalizedClientLink\n                      key={category.id}\n                      href={`/categories/${category.handle}`}\n                      className=\"block py-1 text-sm\"\n                      onClick={() => setIsOpen(false)}\n                    >\n                      {category.name}\n                    </LocalizedClientLink>\n                  ))}\n                </div>\n              </div>\n            )}\n\n            {/* Account only */}\n            <div className=\"pt-2 border-t\">\n              <LocalizedClientLink\n                href=\"/account\"\n                className=\"block py-2 text-lg\"\n                onClick={() => setIsOpen(false)}\n              >\n                Account\n              </LocalizedClientLink>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/layout/components/search-bar-client/index.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'lowerText' is assigned a value but never used.","line":108,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":108,"endColumn":20},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'lowerText' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":108,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":108,"endColumn":20},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":118,"column":61,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":118,"endColumn":63,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3392,3394],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":147,"column":89,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":147,"endColumn":92,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4510,4513],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4510,4513],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":147,"column":103,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":147,"endColumn":105,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[4524,4526],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":151,"column":77,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":151,"endColumn":80,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4757,4760],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4757,4760],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":151,"column":88,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":151,"endColumn":90,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[4768,4770],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":155,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":155,"endColumn":20,"suggestions":[{"fix":{"range":[4859,4888],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":237,"column":38,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":237,"endColumn":40,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[11227,11229],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":237,"column":165,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":237,"endColumn":167,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[11341,11389],"text":"(blog.excerpt ?? blog.bodyText?.substring(0, 150))"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":237,"column":202,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":237,"endColumn":204,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[11391,11393],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useRef, useEffect } from 'react'\nimport { useRouter, useParams } from 'next/navigation'\nimport Image from 'next/image'\nimport safeFetchGlobal from '../../../../lib/safe-fetch'\n\ntype ProductResult = {\n  id: string\n  title: string\n  handle: string\n  thumbnail?: string\n  price?: {\n    calculated_price: string\n    original_price?: string\n  }\n}\n\ntype BlogResult = {\n  id: string\n  title: string\n  slug: string\n  image?: string\n  publishedAt?: string\n  excerpt?: string\n  bodyText?: string\n  categories?: string[]\n}\n\ntype SearchResults = {\n  products: ProductResult[]\n  blogs: BlogResult[]\n  isLoading: boolean\n}\n\nconst SearchBarClient = () => {\n  const [searchQuery, setSearchQuery] = useState('')\n  const [results, setResults] = useState<SearchResults>({\n    products: [],\n    blogs: [],\n    isLoading: false,\n  })\n  const [showDropdown, setShowDropdown] = useState(false)\n  const inputRef = useRef<HTMLInputElement>(null)\n  const dropdownRef = useRef<HTMLDivElement>(null)\n  const router = useRouter()\n  const params = useParams()\n  const countryCode = (params?.countryCode as string) || 'tw'\n\n  useEffect(() => {\n    if (searchQuery.trim().length < 1) {\n      setResults({ products: [], blogs: [], isLoading: false })\n      setShowDropdown(false)\n      return\n    }\n\n    const timer = setTimeout(() => {\n      performSearch(searchQuery)\n      setShowDropdown(true)\n    }, 300)\n\n    return () => clearTimeout(timer)\n  }, [searchQuery])\n\n  useEffect(() => {\n    const handleClickOutside = (event: MouseEvent) => {\n      if (\n        inputRef.current &&\n        !inputRef.current.contains(event.target as Node) &&\n        dropdownRef.current &&\n        !dropdownRef.current.contains(event.target as Node)\n      ) {\n        setShowDropdown(false)\n      }\n    }\n\n    document.addEventListener('mousedown', handleClickOutside)\n    return () => document.removeEventListener('mousedown', handleClickOutside)\n  }, [])\n\n  useEffect(() => {\n    const handleEsc = (event: KeyboardEvent) => {\n      if (event.key === 'Escape' && showDropdown) setShowDropdown(false)\n    }\n\n    document.addEventListener('keydown', handleEsc)\n    return () => document.removeEventListener('keydown', handleEsc)\n  }, [showDropdown])\n\n  useEffect(() => {\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if (e.key === '/' && !(e.target instanceof HTMLInputElement) && !(e.target instanceof HTMLTextAreaElement)) {\n        e.preventDefault()\n        inputRef.current?.focus()\n      }\n    }\n\n    window.addEventListener('keydown', handleKeyDown)\n    return () => window.removeEventListener('keydown', handleKeyDown)\n  }, [])\n\n  const isChinese = (str: string): boolean => /[\\u4e00-\\u9fa5]/.test(str)\n\n  const highlightMatches = (text: string, query: string, type: 'title' | 'content' = 'title'): JSX.Element => {\n    if (!text || !query || query.trim() === '') return <>{text}</>\n\n    const highlightClass = type === 'title' ? 'text-red-600 font-extrabold text-xl' : 'text-red-600 text-sm'\n    const lowerText = text.toLowerCase()\n    const lowerQuery = query.toLowerCase()\n    const hasChinese = isChinese(query)\n\n    let queryUnits: string[] = []\n    if (hasChinese) {\n      Array.from(lowerQuery).forEach((char) => {\n        if (char.trim() !== '') queryUnits.push(char)\n      })\n      if (lowerQuery.match(/[a-z0-9]+/g)) {\n        const englishWords = lowerQuery.match(/[a-z0-9]+/g) || []\n        queryUnits = [...queryUnits, ...englishWords]\n      }\n    } else {\n      queryUnits = lowerQuery.split(/\\s+/).filter((w) => w.length > 0)\n    }\n\n    if (queryUnits.length === 0) return <>{text}</>\n    const patterns = queryUnits.map((u) => u.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'))\n    const regex = new RegExp(`(${patterns.join('|')})`, 'gi')\n    const parts = text.split(regex)\n\n    return (\n      <>\n        {parts.map((part, i) => {\n          const isMatch = queryUnits.some((u) => part.toLowerCase() === u.toLowerCase())\n          return isMatch ? <span key={i} className={highlightClass}>{part}</span> : <span key={i}>{part}</span>\n        })}\n      </>\n    )\n  }\n\n  const performSearch = async (query: string) => {\n    if (!query || query.trim().length < 1) return\n    setResults((prev) => ({ ...prev, isLoading: true }))\n\n    try {\n      let products: ProductResult[] = []\n      const productsJson = await safeFetchGlobal(`/api/products/search?q=${encodeURIComponent(query)}&format=simple`, undefined, null)\n      if (productsJson && typeof productsJson === 'object') products = (productsJson as any).products || []\n\n      let blogs: BlogResult[] = []\n      const blogsJson = await safeFetchGlobal(`/api/blogs/search?q=${encodeURIComponent(query)}`, undefined, null)\n      if (blogsJson && typeof blogsJson === 'object') blogs = (blogsJson as any).posts || []\n\n      setResults({ products, blogs, isLoading: false })\n    } catch (error) {\n      console.error('搜尋錯誤:', error)\n      setResults({ products: [], blogs: [], isLoading: false })\n    }\n  }\n\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => setSearchQuery(e.target.value)\n  const handleInputFocus = () => { if (searchQuery.trim().length >= 1) setShowDropdown(true) }\n  const handleFormSubmit = (e: React.FormEvent) => { e.preventDefault(); if (searchQuery.trim().length >= 1) { router.push(`/${countryCode}/search?q=${encodeURIComponent(searchQuery)}`); setShowDropdown(false) } }\n  const handleProductClick = (handle: string) => { router.push(`/${countryCode}/products/${handle}`); setShowDropdown(false) }\n  const handleBlogClick = (slug: string) => { router.push(`/${countryCode}/blog/${slug}`); setShowDropdown(false) }\n  const handleClickSearch = () => { if (searchQuery.trim().length >= 1) { router.push(`/${countryCode}/search?q=${encodeURIComponent(searchQuery)}`); setShowDropdown(false) } else { inputRef.current?.focus() } }\n\n  const { products, blogs, isLoading } = results\n  const hasResults = products.length > 0 || blogs.length > 0\n  const noResults = !isLoading && searchQuery.trim().length >= 1 && !hasResults\n\n  return (\n    <div className=\"relative group\">\n      <div className=\"flex items-center w-full\">\n        <div className=\"relative w-full border-b border-transparent group-hover:border-gray-200\">\n          <form onSubmit={handleFormSubmit}>\n            <input\n              ref={inputRef}\n              type=\"text\"\n              value={searchQuery}\n              onChange={handleInputChange}\n              onFocus={handleInputFocus}\n              placeholder=\"搜尋商品、Blog文章\"\n              className=\"w-[300px] py-1 pr-8 text-base bg-transparent focus:outline-none\"\n              aria-label=\"輸入關鍵字搜尋，例如：洗\"\n            />\n          </form>\n          <button onClick={handleClickSearch} className=\"absolute right-0 top-1/2 -translate-y-1/2\" aria-label=\"搜尋\">\n            <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1\" className=\"transition-transform duration-200 transform group-hover:scale-110\">\n              <circle cx=\"11\" cy=\"11\" r=\"8\"></circle>\n              <line x1=\"21\" y1=\"21\" x2=\"16.65\" y2=\"16.65\"></line>\n            </svg>\n          </button>\n        </div>\n      </div>\n\n      {showDropdown && searchQuery.trim().length >= 1 && (\n        <div ref={dropdownRef} className=\"absolute right-0 top-full mt-2 bg-white border border-gray-200 shadow-xl rounded-lg max-h-[75vh] overflow-y-auto z-[100] w-[450px]\">\n          {isLoading && (\n            <div className=\"flex justify-center py-5\"><div className=\"animate-spin rounded-full h-7 w-7 border-t-2 border-b-2 border-gray-900\"></div></div>\n          )}\n\n          {noResults && (\n            <div className=\"text-center py-6 px-4 text-gray-500\">找不到符合「<span className=\"text-gray-800 font-medium\">{searchQuery}</span>」的結果</div>\n          )}\n\n          {products.length > 0 && (\n            <div className=\"p-4\">\n              <h3 className=\"text-base font-semibold text-gray-800 mb-3\">商品</h3>\n              <div>\n                {products.map((product) => (\n                  <div key={product.id} className=\"flex items-center p-2.5 my-1 hover:bg-gray-50 rounded cursor-pointer transition-colors duration-150\" onClick={() => handleProductClick(product.handle)}>\n                    {product.thumbnail ? (\n                      <div className=\"w-10 h-10 relative mr-3 flex-shrink-0 border border-gray-100 rounded overflow-hidden\"><Image src={product.thumbnail} alt={product.title} fill className=\"object-cover rounded\"/></div>\n                    ) : (\n                      <div className=\"w-10 h-10 bg-gray-100 mr-3 rounded flex-shrink-0 flex items-center justify-center\"><svg className=\"w-6 h-6 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z\"></path></svg></div>\n                    )}\n                    <div>\n                      <p className=\"text-xl font-extrabold text-gray-900\">{highlightMatches(product.title, searchQuery, 'title')}</p>\n                      {product.price && (<p className=\"text-sm font-medium text-gray-700 mt-1\">{product.price.original_price && product.price.original_price !== product.price.calculated_price && (<span className=\"line-through text-gray-500 mr-2\">{product.price.original_price}</span>)}{product.price.calculated_price}</p>)}\n                    </div>\n                  </div>\n                ))}\n              </div>\n              {products.length > 10 && (<div className=\"text-center mt-3 py-2 text-sm font-medium text-gray-700 hover:text-gray-900 cursor-pointer hover:bg-gray-50 rounded\" onClick={() => { router.push(`/${countryCode}/search?q=${encodeURIComponent(searchQuery)}&type=products`); setShowDropdown(false); }}>查看全部 {products.length} 個商品結果 →</div>)}\n            </div>\n          )}\n\n          {blogs.length > 0 && (\n            <div className=\"p-4 border-t border-gray-100\">\n              <h3 className=\"text-base font-semibold text-gray-800 mb-3\">部落格文章</h3>\n              <div>\n                {blogs.map((blog) => (\n                  <div key={blog.id} className=\"flex p-2.5 my-1 hover:bg-gray-50 rounded cursor-pointer transition-colors duration-150\" onClick={() => handleBlogClick(blog.slug)}>\n                    {blog.image ? (<div className=\"w-10 h-10 relative mr-3 flex-shrink-0 border border-gray-100 rounded overflow-hidden\"><Image src={blog.image} alt={blog.title} fill className=\"object-cover rounded\"/></div>) : (<div className=\"w-10 h-10 bg-gray-100 mr-3 rounded flex-shrink-0 flex items-center justify-center\"><svg className=\"w-6 h-6 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z\"></path></svg></div>)}\n                    <div className=\"flex-1\">\n                      <p className=\"text-xl font-extrabold text-gray-900\">{highlightMatches(blog.title, searchQuery, 'title')}</p>\n                      {(blog.excerpt || blog.bodyText) && (<p className=\"text-sm text-gray-500 mt-1.5 line-clamp-2 leading-relaxed\">{highlightMatches((blog.excerpt || blog.bodyText?.substring(0, 150)) || '', searchQuery, 'content')}</p>)}\n                      <div className=\"flex items-center justify-between mt-1\">{blog.publishedAt && (<p className=\"text-xs text-gray-500\">{new Date(blog.publishedAt).toLocaleDateString('zh-TW')}</p>)}{blog.categories && blog.categories.length > 0 && (<div className=\"flex gap-1\">{blog.categories.slice(0, 2).map((category, index) => (<span key={`${blog.id}-cat-${index}`} className=\"text-xs px-1.5 py-0.5 bg-gray-100 text-gray-600 rounded\">{category}</span>))}{blog.categories.length > 2 && (<span className=\"text-xs text-gray-500\">+{blog.categories.length - 2}</span>)}</div>)}</div>\n                    </div>\n                  </div>\n                ))}\n                {blogs.length > 10 && (<div className=\"text-center mt-3 py-2 text-sm font-medium text-gray-700 hover:text-gray-900 cursor-pointer hover:bg-gray-50 rounded\" onClick={() => { router.push(`/${countryCode}/search?q=${encodeURIComponent(searchQuery)}&type=blogs`); setShowDropdown(false); }}>查看全部 {blogs.length} 篇文章結果 →</div>)}\n              </div>\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  )\n}\n\nexport default SearchBarClient\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/layout/components/search-modal/index.tsx","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":112,"column":34,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":112,"endColumn":36,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3051,3053],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":119,"column":28,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":119,"endColumn":30,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3283,3285],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":124,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":124,"endColumn":20,"suggestions":[{"fix":{"range":[3378,3403],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useEffect, useState, useRef } from 'react'\nimport { useRouter } from 'next/navigation'\nimport Image from 'next/image'\n\ntype ProductResult = {\n  id: string\n  title: string\n  handle: string\n  thumbnail?: string\n  price?: { calculated_price?: string }\n}\n\ntype BlogResult = {\n  id: string\n  title: string\n  slug: string\n  image?: string\n  publishedAt?: string\n}\n\ntype SearchResults = {\n  products: ProductResult[]\n  blogs: BlogResult[]\n  isLoading: boolean\n}\n\ntype Props = {\n  isOpen: boolean\n  onClose: () => void\n  searchQuery: string\n  onSearchSubmit?: (query: string) => void\n}\n\nfunction SearchModal({ isOpen, onClose, searchQuery, onSearchSubmit }: Props) {\n  const router = useRouter()\n  const inputRef = useRef<HTMLInputElement>(null)\n  const dropdownRef = useRef<HTMLDivElement>(null)\n  const [localQuery, setLocalQuery] = useState<string>(searchQuery)\n  const [showDropdown, setShowDropdown] = useState<boolean>(false)\n  const [results, setResults] = useState<SearchResults>({\n    products: [],\n    blogs: [],\n    isLoading: false,\n  })\n\n  useEffect(() => {\n    setLocalQuery(searchQuery)\n    if (searchQuery.trim().length >= 1) {\n      void performSearch(searchQuery)\n      setShowDropdown(true)\n    } else {\n      setResults({ products: [], blogs: [], isLoading: false })\n      setShowDropdown(false)\n    }\n  }, [searchQuery])\n\n  useEffect(() => {\n    if (localQuery.trim().length < 1) {\n      setResults({ products: [], blogs: [], isLoading: false })\n      setShowDropdown(false)\n      return\n    }\n    const timer = setTimeout(() => {\n      void performSearch(localQuery)\n      setShowDropdown(true)\n    }, 300)\n    return () => clearTimeout(timer)\n  }, [localQuery])\n\n  useEffect(() => {\n    if (isOpen && inputRef.current) {\n      inputRef.current.focus()\n    }\n  }, [isOpen])\n\n  useEffect(() => {\n    const handleClickOutside = (event: MouseEvent) => {\n      if (\n        inputRef.current &&\n        !inputRef.current.contains(event.target as Node) &&\n        dropdownRef.current &&\n        !dropdownRef.current.contains(event.target as Node)\n      ) {\n        setShowDropdown(false)\n      }\n    }\n    document.addEventListener('mousedown', handleClickOutside)\n    return () => document.removeEventListener('mousedown', handleClickOutside)\n  }, [])\n\n  useEffect(() => {\n    const handleEsc = (event: KeyboardEvent) => {\n      if (event.key === 'Escape') {\n        if (showDropdown) setShowDropdown(false)\n        else onClose()\n      }\n    }\n    document.addEventListener('keydown', handleEsc)\n    return () => document.removeEventListener('keydown', handleEsc)\n  }, [onClose, showDropdown])\n\n  const performSearch = async (query: string) => {\n    if (!query || query.trim().length < 1) return\n    setResults((prev) => ({ ...prev, isLoading: true }))\n    try {\n      const productsRes = await fetch(`/api/products/search?q=${encodeURIComponent(query)}&format=simple`)\n      let products: ProductResult[] = []\n      if (productsRes.ok) {\n        const data = await productsRes.json()\n        products = data.products || []\n      }\n\n      const blogsRes = await fetch(`/api/blogs/search?q=${encodeURIComponent(query)}`)\n      let blogs: BlogResult[] = []\n      if (blogsRes.ok) {\n        const data = await blogsRes.json()\n        blogs = data.posts || []\n      }\n\n      setResults({ products, blogs, isLoading: false })\n    } catch (e) {\n      console.error('搜尋錯誤:', e)\n      setResults({ products: [], blogs: [], isLoading: false })\n    }\n  }\n\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    setLocalQuery(e.target.value)\n    setShowDropdown(e.target.value.trim().length >= 2)\n  }\n\n  const handleInputFocus = () => {\n    if (localQuery.trim().length >= 2 && results.products.length > 0) {\n      setShowDropdown(true)\n    }\n  }\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault()\n    setShowDropdown(false)\n    if (onSearchSubmit) onSearchSubmit(localQuery)\n    else router.push(`/tw/search?q=${encodeURIComponent(localQuery)}`)\n    onClose()\n  }\n\n  const handleProductClick = (handle: string) => {\n    router.push(`/tw/products/${handle}`)\n    onClose()\n  }\n\n  const handleBlogClick = (slug: string) => {\n    router.push(`/tw/blog/${slug}`)\n    onClose()\n  }\n\n  if (!isOpen) return null\n\n  const { products, blogs, isLoading } = results\n  const hasResults = products.length > 0 || blogs.length > 0\n  const noResults = !isLoading && localQuery.trim().length >= 2 && !hasResults\n\n  return (\n    <div className=\"w-full relative\">\n      <div className=\"relative w-full\">\n        <form onSubmit={handleSubmit} className=\"flex items-center\">\n          <input\n            ref={inputRef}\n            type=\"search\"\n            value={localQuery}\n            onChange={handleInputChange}\n            onFocus={handleInputFocus}\n            placeholder=\"搜尋商品、Blog文章\"\n            className=\"w-full px-4 py-2 text-lg border border-gray-200 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-200\"\n            autoFocus\n          />\n          <button\n            type=\"submit\"\n            className=\"absolute right-12 top-1/2 -translate-y-1/2 px-4 py-1.5 bg-gray-900 text-white rounded-md hover:bg-gray-800 transition-colors\"\n          >\n            搜尋\n          </button>\n          <button\n            type=\"button\"\n            onClick={onClose}\n            className=\"absolute right-2 top-1/2 -translate-y-1/2 p-2 text-gray-500 hover:text-gray-700\"\n          >\n            <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path>\n            </svg>\n          </button>\n        </form>\n\n        {localQuery.trim().length >= 1 && localQuery.trim().length < 2 && (\n          <div className=\"text-xs text-gray-500 mt-1 px-4\">請至少輸入2個字元開始搜尋</div>\n        )}\n\n        {showDropdown && localQuery.trim().length >= 2 && (\n          <div\n            ref={dropdownRef}\n            className=\"absolute left-0 right-0 top-full bg-white border shadow-lg rounded-b-lg max-h-[70vh] overflow-y-auto z-[100] mt-1\"\n          >\n            {isLoading && (\n              <div className=\"flex justify-center py-4\">\n                <div className=\"animate-spin rounded-full h-6 w-6 border-t-2 border-b-2 border-gray-900\"></div>\n              </div>\n            )}\n\n            {noResults && <div className=\"text-center py-4 text-gray-500\">找不到符合「{localQuery}」的結果</div>}\n\n            {products.length > 0 && (\n              <div className=\"p-3\">\n                <h3 className=\"text-sm font-medium text-gray-700 mb-2\">商品</h3>\n                {products.map((product) => (\n                  <div\n                    key={product.id}\n                    className=\"flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer\"\n                    onClick={() => handleProductClick(product.handle)}\n                  >\n                    {product.thumbnail ? (\n                      <div className=\"w-10 h-10 relative mr-3 flex-shrink-0\">\n                        <Image src={product.thumbnail} alt={product.title} fill className=\"object-cover rounded\" />\n                      </div>\n                    ) : (\n                      <div className=\"w-10 h-10 bg-gray-100 mr-3 rounded flex-shrink-0 flex items-center justify-center\">\n                        <svg className=\"w-6 h-6 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z\"></path>\n                        </svg>\n                      </div>\n                    )}\n                    <div>\n                      <p className=\"text-sm font-medium text-gray-900\">{product.title}</p>\n                      {product.price?.calculated_price && (\n                        <p className=\"text-xs text-gray-700\">{product.price.calculated_price}</p>\n                      )}\n                    </div>\n                  </div>\n                ))}\n                {products.length > 10 && (\n                  <div\n                    className=\"text-center mt-2 text-sm text-gray-700 hover:text-gray-900 cursor-pointer\"\n                    onClick={() => {\n                      if (onSearchSubmit) onSearchSubmit(localQuery)\n                      else router.push(`/tw/search?q=${encodeURIComponent(localQuery)}`)\n                      setShowDropdown(false)\n                    }}\n                  >\n                    查看全部 {products.length} 個商品結果 →\n                  </div>\n                )}\n              </div>\n            )}\n\n            {blogs.length > 0 && (\n              <div className=\"p-3 border-t\">\n                <h3 className=\"text-sm font-medium text-gray-700 mb-2\">部落格文章</h3>\n                {blogs.map((blog) => (\n                  <div\n                    key={blog.id}\n                    className=\"flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer\"\n                    onClick={() => handleBlogClick(blog.slug)}\n                  >\n                    {blog.image ? (\n                      <div className=\"w-10 h-10 relative mr-3 flex-shrink-0\">\n                        <Image src={blog.image} alt={blog.title} fill className=\"object-cover rounded\" />\n                      </div>\n                    ) : (\n                      <div className=\"w-10 h-10 bg-gray-100 mr-3 rounded flex-shrink-0 flex items-center justify-center\">\n                        <svg className=\"w-6 h-6 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z\"></path>\n                        </svg>\n                      </div>\n                    )}\n                    <div>\n                      <p className=\"text-sm font-medium text-gray-900\">{blog.title}</p>\n                      {blog.publishedAt && (\n                        <p className=\"text-xs text-gray-500\">{new Date(blog.publishedAt).toLocaleDateString('zh-TW')}</p>\n                      )}\n                    </div>\n                  </div>\n                ))}\n                {blogs.length > 10 && (\n                  <div\n                    className=\"text-center mt-2 text-sm text-gray-700 hover:text-gray-900 cursor-pointer\"\n                    onClick={() => {\n                      if (onSearchSubmit) onSearchSubmit(localQuery)\n                      else router.push(`/tw/search?q=${encodeURIComponent(localQuery)}`)\n                      setShowDropdown(false)\n                    }}\n                  >\n                    查看全部 {blogs.length} 篇文章結果 →\n                  </div>\n                )}\n              </div>\n            )}\n          </div>\n        )}\n      </div>\n    </div>\n  )\n}\n\nexport default SearchModal\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/layout/components/side-menu/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/layout/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/layout/index.tsx","messages":[{"ruleId":null,"nodeType":null,"fatal":true,"severity":2,"message":"Parsing error: \"parserOptions.project\" has been provided for @typescript-eslint/parser.\nThe file was not found in any of the provided project(s): src/modules/layout/index.tsx"}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":1,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from \"react\"\n\nimport Nav from \"@modules/layout/templates/nav\"\n\nconst Layout: React.FC<{\n  children: React.ReactNode\n}> = ({ children }) => {\n  return (\n    <div>\n      <Nav />\n      <main className=\"relative\">{children}</main>\n    </div>\n  )\n}\n\nexport default Layout\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/layout/templates/footer/index.tsx","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":19,"column":29,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":19,"endColumn":31,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[678,680],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":20,"column":44,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":20,"endColumn":46,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[727,729],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":33,"column":48,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":33,"endColumn":50,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1263,1265],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":34,"column":48,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":34,"endColumn":50,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1341,1343],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":83,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":83,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3268,3271],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3268,3271],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":88,"column":50,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":88,"endColumn":52,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3478,3507],"text":"(link.url ?? link.internalLink)"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":88,"column":71,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":88,"endColumn":73,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3508,3510],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":93,"column":46,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":93,"endColumn":48,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3708,3710],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":106,"column":58,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":106,"endColumn":60,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[4300,4302],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":106,"column":91,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":106,"endColumn":93,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[4333,4335],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":106,"column":105,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":106,"endColumn":107,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[4347,4349],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":109,"column":43,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":109,"endColumn":45,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[4442,4463],"text":"(link.url ?? link.text)"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":109,"column":56,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":109,"endColumn":58,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[4464,4466],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":120,"column":52,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":120,"endColumn":54,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[5013,5015],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":123,"column":63,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":123,"endColumn":65,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[5224,5226],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":203,"column":47,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":203,"endColumn":49,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[12056,12058],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":15,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { listCategories } from \"@lib/data/categories\"\nimport { listCollections } from \"@lib/data/collections\"\nimport { getFooter } from \"@lib/sanity\"\nimport Image from \"next/image\"\n\nimport LocalizedClientLink from \"@modules/common/components/localized-client-link\"\nimport CopyrightYear from \"@modules/layout/components/copyright-year\"\n\nexport default async function Footer() {\n  const { collections } = await listCollections({\n    fields: \"*products\",\n  })\n  const productCategories = await listCategories()\n  const footer = await getFooter()\n\n  // 確保數據一致性\n  const collectionsData = collections || []\n  const categoriesData = productCategories || []\n  const footerData = footer || {}\n  const sectionsData = footerData.sections || []\n\n  return (\n    <footer className=\"border-t border-gray-200\">\n      <div className=\"max-w-none px-5 md:px-10 xl:px-16 2xl:px-20\">\n        <div className=\"py-12 md:py-20\">\n          {/* 使用 grid 來確保元素在一行內平均分布 */}\n          <div className=\"grid grid-cols-2 md:grid-cols-6 gap-y-10 md:gap-x-4\">\n            {/* 品牌區塊 */}\n            <div className=\"space-y-6\">\n              <LocalizedClientLink href=\"/\" className=\"block\">\n                <div className=\"w-40\">\n                  <Image\n                    src={footerData?.logo?.url || \"/images/44dto-bmpua.webp\"}\n                    alt={footerData?.logo?.alt || \"SALON\"}\n                    width={160}\n                    height={60}\n                    className=\"w-full\"\n                  />\n                </div>\n              </LocalizedClientLink>\n            </div>\n\n            {/* 商品系列 */}\n            <div className=\"space-y-6\">\n              <h3 className=\"text-xs font-semibold\">商品系列</h3>\n              <ul className=\"space-y-4\">\n                {collectionsData.slice(0, 3).map((collection) => (\n                  <li key={collection.id}>\n                    <LocalizedClientLink \n                      href={`/collections/${collection.handle}`}\n                      className=\"text-xs hover:text-black transition-colors\"\n                    >\n                      {collection.title}\n                    </LocalizedClientLink>\n                  </li>\n                ))}\n              </ul>\n            </div>\n\n            {/* 商品分類 */}\n            <div className=\"space-y-6\">\n              <h3 className=\"text-xs font-semibold\">商品分類</h3>\n              <ul className=\"space-y-4\">\n                {categoriesData.slice(0, 3).map((category) => (\n                  <li key={category.id}>\n                    <LocalizedClientLink \n                      href={`/categories/${category.handle}`}\n                      className=\"text-xs hover:text-black transition-colors\"\n                    >\n                      {category.name}\n                    </LocalizedClientLink>\n                  </li>\n                ))}\n              </ul>\n            </div>\n\n            {/* 自定義區域 - 從Sanity獲取 */}\n            {sectionsData.map((section, sectionIndex) => (\n              <div key={section.title || `section-${sectionIndex}`} className=\"space-y-6\">\n                <h3 className=\"text-xs font-semibold\">{section.title}</h3>\n                {section.links && section.links.length > 0 && (\n                  <ul className=\"space-y-4\">\n                    {section.links.map((link: any, linkIndex) => {\n                      // 如果沒有連結文字，跳過此連結\n                      if (!link.text) return null;\n                      \n                      // 檢查是否有 url\n                      const hasUrl = !!(link.url || link.internalLink || link.externalUrl);\n                      \n                      // 如果沒有 url，顯示純文本\n                      if (!hasUrl) {\n                        return (\n                          <li key={link.text || `link-${sectionIndex}-${linkIndex}`}>\n                            <span className=\"text-xs\">{link.text}</span>\n                          </li>\n                        );\n                      }\n                      \n                      // 檢查是否為內部連結\n                      const isInternal = \n                        link.linkType === 'internal' || \n                        (link.url?.startsWith('/') && !link.url?.startsWith('//'));\n                      \n                      // 取得最終 URL\n                      const finalUrl = \n                        (isInternal ? (link.internalLink || link.url) : (link.externalUrl || link.url)) || '#';\n                      \n                      return (\n                        <li key={link.url || link.text || `link-${sectionIndex}-${linkIndex}`}>\n                          {isInternal ? (\n                            <LocalizedClientLink \n                              href={finalUrl}\n                              className=\"text-xs hover:text-black transition-colors\"\n                            >\n                              {link.text}\n                            </LocalizedClientLink>\n                          ) : (\n                            // 處理各種外部連結類型\n                            (() => {\n                              const url = finalUrl || '';\n                              const isTel = url.startsWith('tel:');\n                              const isMailto = url.startsWith('mailto:');\n                              const isSpecialProtocol = isTel || isMailto;\n                              \n                              return (\n                                <a \n                                  href={url}\n                                  className=\"text-xs hover:text-black transition-colors\"\n                                  // 只有常規外部連結才在新標籤打開\n                                  target={isSpecialProtocol ? undefined : \"_blank\"}\n                                  // 只有常規外部連結才需要安全屬性\n                                  rel={isSpecialProtocol ? undefined : \"noopener noreferrer\"}\n                                >\n                                  {link.text}\n                                </a>\n                              );\n                            })()\n                          )}\n                        </li>\n                      );\n                    })}\n                  </ul>\n                )}\n                \n                {/* 如果是最後一個區塊，在內容下方顯示社群媒體圖標 */}\n                {sectionIndex === (sectionsData.length - 1) && (\n                  <div className=\"mt-6\">\n                    {/* 社群媒體圖標 */}\n                    <div className=\"flex space-x-4\">\n                      {footerData?.socialMedia?.facebook?.enabled && footerData.socialMedia.facebook.url && (\n                        <a href={footerData.socialMedia.facebook.url} className=\"text-gray-600 hover:text-black transition-colors\" target=\"_blank\" rel=\"noopener noreferrer\">\n                          <span className=\"sr-only\">Facebook</span>\n                          <svg className=\"h-6 w-6\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path fillRule=\"evenodd\" d=\"M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.878v-6.987h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.26c-1.243 0-1.63.771-1.63 1.562V12h2.773l-.443 2.89h-2.33v6.988C18.343 21.128 22 16.991 22 12z\" clipRule=\"evenodd\" />\n                          </svg>\n                        </a>\n                      )}\n                      {footerData?.socialMedia?.instagram?.enabled && footerData.socialMedia.instagram.url && (\n                        <a href={footerData.socialMedia.instagram.url} className=\"text-gray-600 hover:text-black transition-colors\" target=\"_blank\" rel=\"noopener noreferrer\">\n                          <span className=\"sr-only\">Instagram</span>\n                          <svg className=\"h-6 w-6\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path fillRule=\"evenodd\" d=\"M12.315 2c2.43 0 2.784.013 3.808.06 1.064.049 1.791.218 2.427.465a4.902 4.902 0 011.772 1.153 4.902 4.902 0 011.153 1.772c.247.636.416 1.363.465 2.427.048 1.067.06 1.407.06 4.123v.08c0 2.643-.012 2.987-.06 4.043-.049 1.064-.218 1.791-.465 2.427a4.902 4.902 0 01-1.153 1.772 4.902 4.902 0 01-1.772 1.153c-.636.247-1.363.416-2.427.465-1.067.048-1.407.06-4.123.06h-.08c-2.643 0-2.987-.012-4.043-.06-1.064-.049-1.791-.218-2.427-.465a4.902 4.902 0 01-1.772-1.153 4.902 4.902 0 01-1.153-1.772c-.247-.636-.416-1.363-.465-2.427-.047-1.024-.06-1.379-.06-3.808v-.63c0-2.43.013-2.784.06-3.808.049-1.064.218-1.791.465-2.427a4.902 4.902 0 011.153-1.772A4.902 4.902 0 015.45 2.525c.636-.247 1.363-.416 2.427-.465C8.901 2.013 9.256 2 11.685 2h.63zm-.081 1.802h-.468c-2.456 0-2.784.011-3.807.058-.975.045-1.504.207-1.857.344-.467.182-.8.398-1.15.748-.35.35-.566.683-.748 1.15-.137.353-.3.882-.344 1.857-.047 1.023-.058 1.351-.058 3.807v.468c0 2.456.011 2.784.058 3.807.045.975.207 1.504.344 1.857.182.466.399.8.748 1.15.35.35.683.566 1.15.748.353.137.882.3 1.857.344 1.054.048 1.37.058 4.041.058h.08c2.597 0 2.917-.01 3.96-.058.976-.045 1.505-.207 1.858-.344.466-.182.8-.398 1.15-.748.35-.35.566-.683.748-1.15.137-.353.3-.882.344-1.857.048-1.055.058-1.37.058-4.041v-.08c0-2.597-.01-2.917-.058-3.96-.045-.976-.207-1.505-.344-1.858a3.097 3.097 0 00-.748-1.15 3.098 3.098 0 00-1.15-.748c-.353-.137-.882-.3-1.857-.344-1.023-.047-1.351-.058-3.807-.058zM12 6.865a5.135 5.135 0 110 10.27 5.135 5.135 0 010-10.27zm0 1.802a3.333 3.333 0 100 6.666 3.333 3.333 0 000-6.666zm5.338-3.205a1.2 1.2 0 110 2.4 1.2 1.2 0 010-2.4z\" clipRule=\"evenodd\" />\n                          </svg>\n                        </a>\n                      )}\n                      {footerData?.socialMedia?.line?.enabled && footerData.socialMedia.line.url && (\n                        <a href={footerData.socialMedia.line.url} className=\"text-gray-600 hover:text-black transition-colors\" target=\"_blank\" rel=\"noopener noreferrer\">\n                          <span className=\"sr-only\">Line</span>\n                          <div className=\"h-6 w-6 flex items-center justify-center\">\n                            <span className=\"font-bold text-xs\">LINE</span>\n                          </div>\n                        </a>\n                      )}\n                      {footerData?.socialMedia?.youtube?.enabled && footerData.socialMedia.youtube.url && (\n                        <a href={footerData.socialMedia.youtube.url} className=\"text-gray-600 hover:text-black transition-colors\" target=\"_blank\" rel=\"noopener noreferrer\">\n                          <span className=\"sr-only\">YouTube</span>\n                          <svg className=\"h-6 w-6\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path d=\"M23.495 6.205a3.007 3.007 0 00-2.088-2.088c-1.87-.501-9.396-.501-9.396-.501s-7.507-.01-9.396.501A3.007 3.007 0 00.527 6.205a31.247 31.247 0 00-.522 5.805 31.247 31.247 0 00.522 5.783 3.007 3.007 0 002.088 2.088c1.868.502 9.396.502 9.396.502s7.506 0 9.396-.502a3.007 3.007 0 002.088-2.088 31.247 31.247 0 00.5-5.783 31.247 31.247 0 00-.5-5.805zM9.609 15.601V8.408l6.264 3.602z\" />\n                          </svg>\n                        </a>\n                      )}\n                      {footerData?.socialMedia?.twitter?.enabled && footerData.socialMedia.twitter.url && (\n                        <a href={footerData.socialMedia.twitter.url} className=\"text-gray-600 hover:text-black transition-colors\" target=\"_blank\" rel=\"noopener noreferrer\">\n                          <span className=\"sr-only\">Twitter/X</span>\n                          <svg className=\"h-6 w-6\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path d=\"M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z\" />\n                          </svg>\n                        </a>\n                      )}\n                    </div>\n                  </div>\n                )}\n                {/* 聯絡資訊已移除 */}\n              </div>\n            ))}\n          </div>\n        </div>\n\n        {/* Copyright */}\n        <div className=\"border-t border-gray-200 py-8\">\n          <div className=\"text-xs\">\n            <CopyrightYear \n              template={footerData?.copyright || \"© {year} SALON. All rights reserved.\"}\n            />\n          </div>\n        </div>\n      </div>\n    </footer>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/layout/templates/index.tsx","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":17,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":17,"endColumn":17,"suggestions":[{"fix":{"range":[448,484],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from \"react\"\nimport { Suspense } from \"react\"\nimport Nav from \"@modules/layout/templates/nav\"\nimport FaviconMeta from \"@/components/favicon-meta\"\nimport { getHeader } from \"@/lib/sanity\"\n\nasync function FaviconProvider() {\n  try {\n    const headerData = await getHeader()\n    return (\n      <FaviconMeta \n        faviconUrl={headerData?.favicon?.url} \n        altText={headerData?.favicon?.alt} \n      />\n    )\n  } catch (error) {\n    console.warn('無法載入 favicon:', error)\n    return null\n  }\n}\n\nconst Layout: React.FC<{\n  children: React.ReactNode\n}> = ({ children }) => {\n  return (\n    <div>\n      <Suspense fallback={null}>\n        <FaviconProvider />\n      </Suspense>\n      <Nav />\n      <main className=\"relative\">{children}</main>\n    </div>\n  )\n}\n\nexport default Layout\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/layout/templates/nav/index.tsx","messages":[{"ruleId":"sonarjs/cognitive-complexity","severity":2,"message":"Refactor this function to reduce its Cognitive Complexity from 23 to the 15 allowed.","line":18,"column":31,"nodeType":null,"messageId":"refactorFunction","endLine":18,"endColumn":34},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'collections' is assigned a value but never used.","line":20,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":20},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'collections' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":20,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":20},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":63,"column":52,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":63,"endColumn":54,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2561,2616],"text":"(headerData?.logoSize?.desktop ?? headerData?.logoHeight)"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":63,"column":78,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":63,"endColumn":80,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2617,2619],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'index' is defined but never used.","line":169,"column":88,"nodeType":null,"messageId":"unusedVar","endLine":169,"endColumn":93},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'index' is defined but never used. Allowed unused args must match /^_/u.","line":169,"column":88,"nodeType":null,"messageId":"unusedVar","endLine":169,"endColumn":93},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":238,"column":30,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":238,"endColumn":50},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":239,"column":50,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":239,"endColumn":52,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[10304,10306],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":244,"column":68,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":244,"endColumn":70,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[10604,10606],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":250,"column":30,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":250,"endColumn":50},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":251,"column":50,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":251,"endColumn":52,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[10886,10888],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":253,"column":62,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":253,"endColumn":64,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[11000,11002],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":256,"column":67,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":256,"endColumn":69,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[11203,11205],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":262,"column":43,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":262,"endColumn":45,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[11396,11398],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'index' is defined but never used.","line":306,"column":88,"nodeType":null,"messageId":"unusedVar","endLine":306,"endColumn":93},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'index' is defined but never used. Allowed unused args must match /^_/u.","line":306,"column":88,"nodeType":null,"messageId":"unusedVar","endLine":306,"endColumn":93}],"suppressedMessages":[],"errorCount":15,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Suspense } from \"react\"\nimport Image from \"next/image\"\n\nimport { listRegions } from \"../../../../lib/data/regions\"\nimport { listCollections } from \"../../../../lib/data/collections\"\nimport { listCategories } from \"../../../../lib/data/categories\"\nimport { StoreRegion } from \"@medusajs/types\"\nimport LocalizedClientLink from \"../../../common/components/localized-client-link\"\nimport CartButton from \"../../components/cart-button\"\nimport AccountButton from \"../../components/account-button\"\nimport CountrySelect from \"../../components/country-select\"\nimport { getHeader } from \"../../../../lib/sanity\"\nimport { SanityHeader } from \"../../../../types/global\"\nimport MobileMenu from \"../../components/mobile-menu\"\nimport SearchBarClient from \"../../components/search-bar-client\"\nimport HeaderHeightSetter from \"../../components/header-height-setter\"\n\nexport default async function Nav() {\n  const regions = await listRegions().then((regions: StoreRegion[]) => regions)\n  const collections = await listCollections().then((res) => res.collections)\n  const categories = await listCategories()\n  const headerData = await getHeader() as SanityHeader\n\n  // 從 Sanity 獲取跑馬燈資料\n  const enabledTexts = headerData?.marquee?.enabled \n    ? [\n        ...(headerData.marquee.text1?.enabled && headerData.marquee.text1?.content?.trim() \n            ? [{content: headerData.marquee.text1.content}] : []),\n        ...(headerData.marquee.text2?.enabled && headerData.marquee.text2?.content?.trim() \n            ? [{content: headerData.marquee.text2.content}] : []),\n        ...(headerData.marquee.text3?.enabled && headerData.marquee.text3?.content?.trim() \n            ? [{content: headerData.marquee.text3.content}] : [])\n      ]\n    : []\n\n  const marqueeTexts = enabledTexts.map(item => String(item.content)).filter(text => text.trim())\n  const textCount = marqueeTexts.length\n\n  const textDisplayTime = 3\n  const calculateAnimationDuration = (count: number) => {\n    if (count === 1) return textDisplayTime * 2\n    return count * textDisplayTime\n  }\n  \n  const animationDuration = calculateAnimationDuration(textCount)\n  const pauseOnHover = headerData?.marquee?.pauseOnHover !== false\n\n  const getMarqueeClass = (count: number) => {\n    if (count === 0) return ''\n    if (count === 1) return 'animate-marquee-1'\n    if (count === 2) return 'animate-marquee-2'\n    if (count === 3) return 'animate-marquee-3'\n    return 'animate-marquee'\n  }\n\n  const defaultAnnouncements = [\n    \"新會員首購享85折\",\n    \"全館消費滿$2000免運\",\n    \"會員點數最高30倍送\"\n  ]\n\n  // 計算主導覽列高度\n  const logoHeight = headerData?.logoSize?.desktop || headerData?.logoHeight || 36\n  const mainNavHeight = Math.max(48, logoHeight + 24)\n  \n  // 計算總 header 高度\n  const marqueeHeight = 36 // h-9 = 36px\n  const totalHeaderHeight = (headerData?.marquee?.enabled && textCount > 0) \n    ? marqueeHeight + mainNavHeight \n    : mainNavHeight\n\n  return (\n    <>\n      {/* 動態設置 header 高度 CSS 變數 */}\n      <HeaderHeightSetter totalHeight={totalHeaderHeight} />\n      \n      {/* 整合的導航容器：跑馬燈 + 主選單 + 分類列 */}\n      <div \n        className=\"sticky top-0 inset-x-0 z-[100] group transition-all duration-300\"\n      >\n        {/* 1. 跑馬燈部分 */}\n        {(headerData?.marquee?.enabled && textCount > 0) ? (\n          <div className=\"bg-gray-900 text-white overflow-hidden h-9\">\n            <div className=\"relative h-full\">\n              {headerData?.marquee?.linkUrl ? (\n                <a \n                  href={headerData.marquee.linkUrl} \n                  target=\"_blank\" \n                  rel=\"noopener noreferrer\" \n                  className=\"block w-full h-full\"\n                >\n                  <div \n                    className={`absolute inset-x-0 flex flex-col ${getMarqueeClass(textCount)} ${pauseOnHover ? 'hover:animation-paused' : ''}`}\n                    style={{ \n                      '--marquee-duration': `${animationDuration}s`\n                    } as React.CSSProperties}\n                  >\n                    {marqueeTexts.map((text, index) => (\n                      <div \n                        key={`marquee-link-${index}`} \n                        className=\"flex-none h-9 flex items-center justify-center text-xs text-white hover:underline\"\n                      >\n                        {text}\n                      </div>\n                    ))}\n                  </div>\n                </a>\n              ) : (\n                <div \n                  className={`absolute inset-x-0 flex flex-col ${getMarqueeClass(textCount)} ${pauseOnHover ? 'hover:animation-paused' : ''}`}\n                  style={{ \n                    '--marquee-duration': `${animationDuration}s`\n                  } as React.CSSProperties}\n                >\n                  {marqueeTexts.map((text, index) => (\n                    <div \n                      key={`marquee-nolink-${index}`} \n                      className=\"flex-none h-9 flex items-center justify-center text-xs text-white\"\n                    >\n                      {text}\n                    </div>\n                  ))}\n                </div>\n              )}\n            </div>\n          </div>\n        ) : (\n          <div className=\"bg-gray-900 text-white overflow-hidden h-9\">\n            <div className=\"relative h-full\">\n              <div className=\"absolute inset-x-0 flex flex-col animate-marquee\">\n                {defaultAnnouncements.map((text, index) => (\n                  <div key={`default-${index}`} className=\"flex-none h-9 flex items-center justify-center text-xs text-white\">\n                    {text}\n                  </div>\n                ))}\n                <div key=\"default-repeat\" className=\"flex-none h-9 flex items-center justify-center text-xs text-white\">\n                  {defaultAnnouncements[0]}\n                </div>\n              </div>\n            </div>\n          </div>\n        )}\n\n        {/* 2. 主選單導覽列 */}\n        <header \n          className=\"relative w-full border-b bg-white border-ui-border-base shadow-sm\"\n          style={{\n            height: `${mainNavHeight}px`\n          }}\n        >\n          <nav \n            className=\"px-6 md:px-12 xl:px-16 2xl:px-20 w-full h-full flex items-center\"\n          >\n            {/* 三等份布局容器 */}\n            <div className=\"w-full grid grid-cols-3 items-center\">\n              {/* 左側區塊 - 1/3 */}\n              <div className=\"flex items-center justify-start gap-x-6\">\n                {/* 手機版漢堡選單 - 螢幕寬度小於1024px時顯示 */}\n                <div className=\"block lg:hidden\">\n                  <MobileMenu \n                    regions={regions} \n                    navigation={headerData?.navigation}\n                    categories={categories}\n                    headerData={headerData}\n                  />\n                </div>\n                {/* 桌機版導航選單 - 螢幕寬度大於等於1024px時顯示 */}\n                <div className=\"hidden lg:flex items-center gap-x-6\">\n                  {headerData?.navigation?.filter((item: {name: string; href: string}, index: number) => {\n                    // 擴展的左側項目關鍵字：首頁、商品、Blog、關於我們、商店等\n                    const leftSideItems = [\n                      'home', 'homes', '首頁', '主頁',\n                      'product', 'products', 'shop', 'shopping', '商品', '產品', '購物',\n                      'blog', 'blogs', 'article', 'articles', 'news', '部落格', '文章', '新聞', '資訊',\n                      'about', 'about-us', 'aboutus', '關於', '關於我們', '公司簡介',\n                      'store', 'stores', '商店', '門市', '店面', '分店'\n                    ];\n                    \n                    const name = item.name.toLowerCase();\n                    const href = item.href.toLowerCase();\n                    \n                    return leftSideItems.some(keyword => \n                      name.includes(keyword.toLowerCase()) ||\n                      href.includes(keyword.toLowerCase())\n                    );\n                  }).map(({ name, href }: {name: string; href: string}, index: number) => {\n                    if (typeof name !== 'string' || typeof href !== 'string') {\n                      return null\n                    }\n\n                    const isExternal = /^(http|https|www)/.test(href)\n                    const isHome = href === '/' || href === '/home'\n                    const processedHref = isExternal \n                      ? href \n                      : isHome \n                        ? '/' \n                        : href.startsWith('/') \n                          ? href \n                          : `/${href}`\n\n                    const uniqueKey = `nav-left-${index}-${name.replace(/[^a-zA-Z0-9]/g, '')}`\n\n                    return isExternal ? (\n                      <a\n                        key={uniqueKey}\n                        href={processedHref}\n                        className=\"text-xs tracking-wider uppercase font-medium hover:text-black/70 transition-colors duration-200\"\n                        target=\"_blank\"\n                        rel=\"noopener noreferrer\"\n                      >\n                        <span className=\"!text-xs !font-medium !leading-none\">{name}</span>\n                      </a>\n                    ) : (\n                      <LocalizedClientLink\n                        key={uniqueKey}\n                        href={processedHref}\n                        className=\"text-xs tracking-wider uppercase font-medium hover:text-black/70 transition-colors duration-200\"\n                        data-testid={`${name.toLowerCase()}-link`}\n                      >\n                        <span className=\"!text-xs !font-medium !leading-none\">{name}</span>\n                      </LocalizedClientLink>\n                    )\n                  })}\n                </div>\n              </div>\n\n              {/* 中間區塊 - Logo 完全居中 - 1/3 */}\n              <div className=\"flex items-center justify-center\">\n                <LocalizedClientLink\n                  href=\"/\"\n                  className=\"txt-compact-xlarge-plus hover:text-ui-fg-base uppercase xsmall:text-lg cursor-pointer transition-transform duration-200 hover:scale-105\"\n                  data-testid=\"nav-store-link\"\n                >\n                  {headerData?.logo?.url ? (\n                    <>\n                      {/* Desktop Logo */}\n                      <Image\n                        src={headerData.logo.url!}\n                        alt={headerData.logo.alt || \"Store logo\"}\n                        width={200}\n                        height={logoHeight}\n                        className=\"w-auto object-contain transition-all duration-300 hidden md:block\"\n                        style={{ \n                          height: `${headerData?.logoSize?.desktop || logoHeight}px`,\n                          width: 'auto'\n                        }}\n                      />\n                      {/* Mobile Logo */}\n                      <Image\n                        src={headerData.logo.url!}\n                        alt={headerData.logo.alt || \"Store logo\"}\n                        width={200}\n                        height={headerData?.logoSize?.mobile || 28}\n                        className=\"w-auto object-contain transition-all duration-300 md:hidden\"\n                        style={{ \n                          height: `${headerData?.logoSize?.mobile || 28}px`,\n                          width: 'auto'\n                        }}\n                      />\n                    </>\n                  ) : (\n                    headerData?.storeName || \"Medusa Store\"\n                  )}\n                </LocalizedClientLink>\n              </div>\n              \n              {/* 右側區塊 - 1/3 */}\n              <div className=\"flex items-center justify-end gap-x-6\">\n                {/* 漢堡選單模式 - 只顯示圖標的帳戶和購物車 (小於1024px) */}\n                <div className=\"flex lg:hidden items-center gap-x-3\">\n                  {/* 只有圖標的帳戶按鈕 */}\n                  <LocalizedClientLink\n                    className=\"text-xs tracking-wider uppercase font-medium hover:text-black/70 transition-colors duration-200 flex items-center\"\n                    href=\"/account\"\n                    data-testid=\"nav-account-link-mobile\"\n                  >\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1\">\n                      <path d=\"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2\"></path>\n                      <circle cx=\"12\" cy=\"7\" r=\"4\"></circle>\n                    </svg>\n                  </LocalizedClientLink>\n                  \n                  {/* 只有圖標的購物車按鈕 */}\n                  <Suspense\n                    fallback={\n                      <LocalizedClientLink\n                        className=\"text-xs tracking-wider uppercase font-medium hover:text-black/70 transition-colors duration-200 flex items-center\"\n                        href=\"/cart\"\n                        data-testid=\"nav-cart-link-mobile\"\n                      >\n                        <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1\">\n                          <path d=\"M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z\"></path>\n                          <line x1=\"3\" y1=\"6\" x2=\"21\" y2=\"6\"></line>\n                          <path d=\"M16 10a4 4 0 0 1-8 0\"></path>\n                        </svg>\n                      </LocalizedClientLink>\n                    }\n                  >\n                    <CartButton />\n                  </Suspense>\n                </div>\n\n                {/* 桌機版導航項目和功能按鈕 - 在手機版隱藏 */}\n                <div className=\"hidden lg:flex items-center gap-x-4\">\n                  {/* 剩餘的導航項目 - 右側項目 */}\n                  {headerData?.navigation?.filter((item: {name: string; href: string}, index: number) => {\n                    // 擴展的左側項目關鍵字（需要與上面保持一致）\n                    const leftSideItems = [\n                      'home', 'homes', '首頁', '主頁',\n                      'product', 'products', 'shop', 'shopping', '商品', '產品', '購物',\n                      'blog', 'blogs', 'article', 'articles', 'news', '部落格', '文章', '新聞', '資訊',\n                      'about', 'about-us', 'aboutus', '關於', '關於我們', '公司簡介',\n                      'store', 'stores', '商店', '門市', '店面', '分店'\n                    ];\n                    \n                    // 右側項目關鍵字：服務、聯絡、幫助等\n                    const rightSideItems = [\n                      'service', 'services', '服務', '服務項目',\n                      'contact', 'contact-us', 'contactus', '聯絡', '聯絡我們', '聯繫',\n                      'help', 'support', 'faq', '幫助', '支援', '客服', '常見問題'\n                    ];\n                    \n                    const name = item.name.toLowerCase();\n                    const href = item.href.toLowerCase();\n                    \n                    // 檢查是否為左側項目\n                    const isLeftSideItem = leftSideItems.some(keyword => \n                      name.includes(keyword.toLowerCase()) ||\n                      href.includes(keyword.toLowerCase())\n                    );\n                    \n                    // 檢查是否為明確的右側項目\n                    const isRightSideItem = rightSideItems.some(keyword => \n                      name.includes(keyword.toLowerCase()) ||\n                      href.includes(keyword.toLowerCase())\n                    );\n                    \n                    // 返回右側項目：明確的右側項目，或者不是左側項目的其他項目\n                    return isRightSideItem || (!isLeftSideItem && !isRightSideItem);\n                  }).map(({ name, href }: {name: string; href: string}, index: number) => {\n                    if (typeof name !== 'string' || typeof href !== 'string') {\n                      return null\n                    }\n\n                    const isExternal = /^(http|https|www)/.test(href)\n                    const isHome = href === '/' || href === '/home'\n                    const processedHref = isExternal \n                      ? href \n                      : isHome \n                        ? '/' \n                        : href.startsWith('/') \n                          ? href \n                          : `/${href}`\n\n                    const uniqueKey = `nav-right-${index}-${name.replace(/[^a-zA-Z0-9]/g, '')}`\n\n                    return isExternal ? (\n                      <a\n                        key={uniqueKey}\n                        href={processedHref}\n                        className=\"text-xs tracking-wider uppercase font-medium hover:text-black/70 transition-colors duration-200\"\n                        target=\"_blank\"\n                        rel=\"noopener noreferrer\"\n                      >\n                        <span className=\"!text-xs !font-medium !leading-none\">{name}</span>\n                      </a>\n                    ) : (\n                      <LocalizedClientLink\n                        key={uniqueKey}\n                        href={processedHref}\n                        className=\"text-xs tracking-wider uppercase font-medium hover:text-black/70 transition-colors duration-200\"\n                        data-testid={`${name.toLowerCase()}-link`}\n                      >\n                        <span className=\"!text-xs !font-medium !leading-none\">{name}</span>\n                      </LocalizedClientLink>\n                    )\n                  })}\n                  \n                  {/* 功能按鈕 */}\n                  {regions && <CountrySelect regions={regions} />}\n                  <AccountButton />\n                  <Suspense\n                    fallback={\n                      <LocalizedClientLink\n                        className=\"text-xs tracking-wider uppercase font-medium hover:text-black/70 transition-colors duration-200 flex items-center gap-2\"\n                        href=\"/cart\"\n                        data-testid=\"nav-cart-link\"\n                      >\n                        <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1\">\n                          <path d=\"M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z\"></path>\n                          <line x1=\"3\" y1=\"6\" x2=\"21\" y2=\"6\"></line>\n                          <path d=\"M16 10a4 4 0 0 1-8 0\"></path>\n                        </svg>\n                        <span className=\"!text-xs !font-medium !leading-none\">購物車 (0)</span>\n                      </LocalizedClientLink>\n                    }\n                  >\n                    <CartButton />\n                  </Suspense>\n                </div>\n              </div>\n            </div>\n          </nav>\n        </header>\n\n        {/* 3. 分類導覽列 - 在漢堡選單模式隱藏 */}\n        <div className=\"hidden lg:block border-b border-ui-border-base bg-white shadow-sm\">\n          <div className=\"px-6 md:px-12 xl:px-16 2xl:px-20 max-w-none flex justify-between items-center py-2 text-xs text-neutral-600\">\n            <div className=\"flex items-center gap-x-6\">\n              {categories?.map((category: {id: string; handle: string; name: string}) => (\n                <LocalizedClientLink\n                  key={category.id}\n                  href={`/categories/${category.handle}`}\n                  className=\"text-xs tracking-wider uppercase font-medium hover:text-black/70 transition-colors duration-200\"\n                >\n                  <span className=\"!text-xs !font-medium !leading-none\">{category.name}</span>\n                </LocalizedClientLink>\n              ))}\n            </div>\n            <div className=\"relative group flex items-center\">\n              <SearchBarClient />\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* LINE 懸浮按鈕 */}\n      <a\n        href=\"https://page.line.me/timsfantasyworld?fbclid=PARlRTSAMmHoRleHRuA2FlbQIxMAABp_nJitfDUH8W4pRlcRgKeusvIELFdTvXpbu791GiXgPIOarBh8LO2Hg2YJrV_aem_9pdT5ans7oJyF7F17iQPHw\"\n        target=\"_blank\"\n        rel=\"noopener noreferrer\"\n        className=\"fixed bottom-6 right-6 bg-gray-900 hover:bg-gray-800 text-white border border-white/20 rounded-full px-6 py-3 shadow-lg transition-all duration-200 hover:-translate-y-0.5 z-[9999] flex items-center gap-3\"\n        aria-label=\"加入 LINE 好友\"\n      >\n        <svg \n          className=\"w-5 h-5\"\n          viewBox=\"0 0 24 24\" \n          fill=\"none\"\n          stroke=\"white\"\n          strokeWidth=\"2\"\n        >\n          <path d=\"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z\"/>\n        </svg>\n        <span className=\"text-white text-xs font-medium tracking-wide\">幫助</span>\n      </a>\n    </>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/order/components/help/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/order/components/item/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/order/components/items/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/order/components/onboarding-cta/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/order/components/order-details/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/order/components/order-summary/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/order/components/payment-details/index.tsx","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":16,"column":3,"nodeType":"MemberExpression","messageId":"unexpected","endLine":16,"endColumn":14,"suggestions":[{"fix":{"range":[481,521],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Container, Heading, Text } from \"@medusajs/ui\"\n\nimport { isStripe, paymentInfoMap } from \"../../../../constants\"\n\nimport { convertToLocale } from \"../../../../lib/util/money\"\nimport Divider from \"../../../common/components/divider/index\"\nimport { HttpTypes } from \"@medusajs/types\"\n\ntype PaymentDetailsProps = {\n  order: HttpTypes.StoreOrder\n}\n\nconst PaymentDetails = ({ order }: PaymentDetailsProps) => {\n  const payment = order.payment_collections?.[0].payments?.[0]\n\n  console.log(\"payment details:\", payment)\n\n  return (\n    <div>\n      <Heading level=\"h2\" className=\"flex flex-row text-3xl-regular my-6\">\n        付款資訊\n      </Heading>\n      <div>\n        {payment && (\n          <div className=\"flex items-start gap-x-1 w-full\">\n            <div className=\"flex flex-col w-1/3\">\n              <Text className=\"txt-medium-plus text-ui-fg-base mb-1\">\n                付款方式\n              </Text>\n              <Text\n                className=\"txt-medium text-ui-fg-subtle\"\n                data-testid=\"payment-method\"\n              >\n                {paymentInfoMap[payment.provider_id].title}\n              </Text>\n            </div>\n            <div className=\"flex flex-col w-2/3\">\n              <Text className=\"txt-medium-plus text-ui-fg-base mb-1\">\n                付款詳情\n              </Text>\n              <div className=\"flex gap-2 txt-medium text-ui-fg-subtle items-center\">\n                <Container className=\"flex items-center h-7 w-fit p-2 bg-ui-button-neutral-hover\">\n                  {paymentInfoMap[payment.provider_id].icon}\n                </Container>\n                <Text data-testid=\"payment-amount\">\n                  {isStripe(payment.provider_id) && payment.data?.card_last4\n                    ? `**** **** **** ${payment.data.card_last4}`\n                    : `${convertToLocale({\n                        amount: payment.amount,\n                        currency_code: order.currency_code,\n                      })} paid at ${new Date(\n                        payment.created_at ?? \"\"\n                      ).toLocaleString()}`}\n                </Text>\n              </div>\n            </div>\n          </div>\n        )}\n      </div>\n\n      <Divider className=\"mt-8\" />\n    </div>\n  )\n}\n\nexport default PaymentDetails\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/order/components/shipping-details/index.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":59,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":59,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2079,2082],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2079,2082],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { convertToLocale } from \"@lib/util/money\"\nimport { HttpTypes } from \"@medusajs/types\"\nimport { Heading, Text } from \"@medusajs/ui\"\n\nimport Divider from \"@modules/common/components/divider\"\n\ntype ShippingDetailsProps = {\n  order: HttpTypes.StoreOrder\n}\n\nconst ShippingDetails = ({ order }: ShippingDetailsProps) => {\n  return (\n    <div>\n      <Heading level=\"h2\" className=\"flex flex-row text-3xl-regular my-6\">\n        配送資訊\n      </Heading>\n      <div className=\"flex items-start gap-x-8\">\n        <div\n          className=\"flex flex-col w-1/3\"\n          data-testid=\"shipping-address-summary\"\n        >\n          <Text className=\"txt-medium-plus text-ui-fg-base mb-1\">\n            收件地址\n          </Text>\n          <Text className=\"txt-medium text-ui-fg-subtle\">\n            {order.shipping_address?.first_name}{\" \"}\n            {order.shipping_address?.last_name}\n          </Text>\n          <Text className=\"txt-medium text-ui-fg-subtle\">\n            {order.shipping_address?.address_1}{\" \"}\n            {order.shipping_address?.address_2}\n          </Text>\n          <Text className=\"txt-medium text-ui-fg-subtle\">\n            {order.shipping_address?.postal_code},{\" \"}\n            {order.shipping_address?.city}\n          </Text>\n          <Text className=\"txt-medium text-ui-fg-subtle\">\n            {order.shipping_address?.country_code?.toUpperCase()}\n          </Text>\n        </div>\n\n        <div\n          className=\"flex flex-col w-1/3 \"\n          data-testid=\"shipping-contact-summary\"\n        >\n          <Text className=\"txt-medium-plus text-ui-fg-base mb-1\">聯絡資訊</Text>\n          <Text className=\"txt-medium text-ui-fg-subtle\">\n            {order.shipping_address?.phone}\n          </Text>\n          <Text className=\"txt-medium text-ui-fg-subtle\">{order.email}</Text>\n        </div>\n\n        <div\n          className=\"flex flex-col w-1/3\"\n          data-testid=\"shipping-method-summary\"\n        >\n          <Text className=\"txt-medium-plus text-ui-fg-base mb-1\">配送方式</Text>\n          <Text className=\"txt-medium text-ui-fg-subtle\">\n            {(order as any).shipping_methods[0]?.name} (\n            {convertToLocale({\n              amount: order.shipping_methods?.[0].total ?? 0,\n              currency_code: order.currency_code,\n            })\n              .replace(/,/g, \"\")\n              .replace(/\\./g, \",\")}\n            )\n          </Text>\n        </div>\n      </div>\n      <Divider className=\"mt-8\" />\n    </div>\n  )\n}\n\nexport default ShippingDetails\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/order/components/transfer-actions/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/order/components/transfer-image/index.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'props' is defined but never used.","line":3,"column":24,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":29},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'props' is defined but never used. Allowed unused args must match /^_/u.","line":3,"column":24,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":29}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { SVGProps } from \"react\"\n\nconst TransferImage = (props: SVGProps<SVGSVGElement>) => (\n  <svg\n    width=\"280\"\n    height=\"181\"\n    viewBox=\"0 0 280 181\"\n    fill=\"none\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n  >\n    <rect\n      x=\"0.00428286\"\n      y=\"-0.742904\"\n      width=\"33.5\"\n      height=\"65.5\"\n      rx=\"6.75\"\n      transform=\"matrix(0.865865 0.500278 -0.871576 0.490261 189.756 88.938)\"\n      fill=\"#D4D4D8\"\n      stroke=\"#52525B\"\n      strokeWidth=\"1.5\"\n    />\n    <rect\n      x=\"0.00428286\"\n      y=\"-0.742904\"\n      width=\"33.5\"\n      height=\"65.5\"\n      rx=\"6.75\"\n      transform=\"matrix(0.865865 0.500278 -0.871576 0.490261 189.756 85.938)\"\n      fill=\"white\"\n      stroke=\"#52525B\"\n      strokeWidth=\"1.5\"\n    />\n    <path\n      d=\"M180.579 107.642L179.126 108.459\"\n      stroke=\"#52525B\"\n      strokeWidth=\"1.5\"\n      strokeLinecap=\"round\"\n      strokeLinejoin=\"round\"\n    />\n    <path\n      opacity=\"0.88\"\n      d=\"M182.305 110.046L180.257 110.034\"\n      stroke=\"#52525B\"\n      strokeWidth=\"1.5\"\n      strokeLinecap=\"round\"\n      strokeLinejoin=\"round\"\n    />\n    <path\n      opacity=\"0.75\"\n      d=\"M180.551 112.429L179.108 111.596\"\n      stroke=\"#52525B\"\n      strokeWidth=\"1.5\"\n      strokeLinecap=\"round\"\n      strokeLinejoin=\"round\"\n    />\n    <path\n      opacity=\"0.63\"\n      d=\"M176.347 113.397L176.354 112.23\"\n      stroke=\"#52525B\"\n      strokeWidth=\"1.5\"\n      strokeLinecap=\"round\"\n      strokeLinejoin=\"round\"\n    />\n    <path\n      opacity=\"0.5\"\n      d=\"M172.154 112.381L173.606 111.564\"\n      stroke=\"#52525B\"\n      strokeWidth=\"1.5\"\n      strokeLinecap=\"round\"\n      strokeLinejoin=\"round\"\n    />\n    <path\n      opacity=\"0.38\"\n      d=\"M170.428 109.977L172.476 109.989\"\n      stroke=\"#52525B\"\n      strokeWidth=\"1.5\"\n      strokeLinecap=\"round\"\n      strokeLinejoin=\"round\"\n    />\n    <path\n      opacity=\"0.25\"\n      d=\"M172.181 107.594L173.624 108.428\"\n      stroke=\"#52525B\"\n      strokeWidth=\"1.5\"\n      strokeLinecap=\"round\"\n      strokeLinejoin=\"round\"\n    />\n    <path\n      opacity=\"0.13\"\n      d=\"M176.386 106.626L176.379 107.793\"\n      stroke=\"#52525B\"\n      strokeWidth=\"1.5\"\n      strokeLinecap=\"round\"\n      strokeLinejoin=\"round\"\n    />\n    <rect\n      width=\"12\"\n      height=\"3\"\n      rx=\"1.5\"\n      transform=\"matrix(0.865865 0.500278 -0.871576 0.490261 196.447 92.7925)\"\n      fill=\"#D4D4D8\"\n    />\n    <rect\n      x=\"0.00428286\"\n      y=\"-0.742904\"\n      width=\"33.5\"\n      height=\"65.5\"\n      rx=\"6.75\"\n      transform=\"matrix(0.865865 0.500278 -0.871576 0.490261 117.023 46.9146)\"\n      fill=\"#D4D4D8\"\n      stroke=\"#52525B\"\n      strokeWidth=\"1.5\"\n    />\n    <rect\n      x=\"0.00428286\"\n      y=\"-0.742904\"\n      width=\"33.5\"\n      height=\"65.5\"\n      rx=\"6.75\"\n      transform=\"matrix(0.865865 0.500278 -0.871576 0.490261 117.023 43.9146)\"\n      fill=\"white\"\n      stroke=\"#52525B\"\n      strokeWidth=\"1.5\"\n    />\n    <rect\n      width=\"12\"\n      height=\"3\"\n      rx=\"1.5\"\n      transform=\"matrix(0.865865 0.500278 -0.871576 0.490261 123.714 50.769)\"\n      fill=\"#D4D4D8\"\n    />\n    <rect\n      width=\"17\"\n      height=\"3\"\n      rx=\"1.5\"\n      transform=\"matrix(0.865865 0.500278 -0.871576 0.490261 97.5555 67.458)\"\n      fill=\"#D4D4D8\"\n    />\n    <rect\n      width=\"12\"\n      height=\"3\"\n      rx=\"1.5\"\n      transform=\"matrix(0.865865 0.500278 -0.871576 0.490261 93.1976 69.9092)\"\n      fill=\"#D4D4D8\"\n    />\n    <path\n      d=\"M92.3603 64.4564C90.9277 63.6287 88.59 63.6152 87.148 64.4264C85.7059 65.2375 85.6983 66.5703 87.1308 67.398C88.5634 68.2257 90.9011 68.2392 92.3432 67.428C93.7852 66.6169 93.7929 65.2841 92.3603 64.4564ZM88.4382 66.6626C87.7221 66.2488 87.726 65.5822 88.4468 65.1768C89.1676 64.7713 90.3369 64.7781 91.0529 65.1918C91.769 65.6055 91.7652 66.2722 91.0444 66.6776C90.3236 67.083 89.1543 67.0763 88.4382 66.6626Z\"\n      fill=\"#A1A1AA\"\n    />\n    <rect\n      width=\"17\"\n      height=\"3\"\n      rx=\"1.5\"\n      transform=\"matrix(0.865865 0.500278 -0.871576 0.490261 109.758 60.5942)\"\n      fill=\"#D4D4D8\"\n    />\n    <rect\n      width=\"12\"\n      height=\"3\"\n      rx=\"1.5\"\n      transform=\"matrix(0.865865 0.500278 -0.871576 0.490261 105.4 63.0454)\"\n      fill=\"#D4D4D8\"\n    />\n    <path\n      d=\"M104.562 57.5926C103.13 56.7649 100.792 56.7514 99.35 57.5626C97.908 58.3737 97.9003 59.7065 99.3329 60.5342C100.765 61.3619 103.103 61.3754 104.545 60.5642C105.987 59.7531 105.995 58.4203 104.562 57.5926ZM103.858 59.3971L100.815 59.6265C100.683 59.6366 100.55 59.6133 100.449 59.5629C100.44 59.5584 100.432 59.5544 100.424 59.5499C100.339 59.5004 100.29 59.4335 100.29 59.3637L100.293 58.62C100.294 58.4751 100.501 58.3585 100.756 58.3599C101.01 58.3614 101.216 58.48 101.216 58.6256L101.214 59.0669L103.732 58.8768C103.983 58.8577 104.217 58.9584 104.251 59.1029C104.286 59.2468 104.11 59.3787 103.858 59.3976L103.858 59.3971Z\"\n      fill=\"#A1A1AA\"\n    />\n    <g clip-path=\"url(#clip0_20786_38285)\">\n      <path\n        d=\"M133.106 82.3025L140.49 82.345L140.514 78.1353\"\n        stroke=\"#A1A1AA\"\n        strokeWidth=\"1.5\"\n        strokeLinecap=\"round\"\n        strokeLinejoin=\"round\"\n      />\n    </g>\n    <g clip-path=\"url(#clip1_20786_38285)\">\n      <path\n        d=\"M143.496 88.3059L150.88 88.3485L150.905 84.1387\"\n        stroke=\"#A1A1AA\"\n        strokeWidth=\"1.5\"\n        strokeLinecap=\"round\"\n        strokeLinejoin=\"round\"\n      />\n    </g>\n    <g clip-path=\"url(#clip2_20786_38285)\">\n      <path\n        d=\"M153.887 94.3093L161.271 94.3519L161.295 90.1421\"\n        stroke=\"#A1A1AA\"\n        strokeWidth=\"1.5\"\n        strokeLinecap=\"round\"\n        strokeLinejoin=\"round\"\n      />\n    </g>\n    <g clip-path=\"url(#clip3_20786_38285)\">\n      <path\n        d=\"M126.113 89.6911L118.729 89.6486L118.705 93.8583\"\n        stroke=\"#A1A1AA\"\n        strokeWidth=\"1.5\"\n        strokeLinecap=\"round\"\n        strokeLinejoin=\"round\"\n      />\n    </g>\n    <g clip-path=\"url(#clip4_20786_38285)\">\n      <path\n        d=\"M136.504 95.6945L129.12 95.652L129.095 99.8618\"\n        stroke=\"#A1A1AA\"\n        strokeWidth=\"1.5\"\n        strokeLinecap=\"round\"\n        strokeLinejoin=\"round\"\n      />\n    </g>\n    <g clip-path=\"url(#clip5_20786_38285)\">\n      <path\n        d=\"M146.894 101.698L139.51 101.655L139.486 105.865\"\n        stroke=\"#A1A1AA\"\n        strokeWidth=\"1.5\"\n        strokeLinecap=\"round\"\n        strokeLinejoin=\"round\"\n      />\n    </g>\n    <defs>\n      <clipPath id=\"clip0_20786_38285\">\n        <rect\n          width=\"12\"\n          height=\"12\"\n          fill=\"white\"\n          transform=\"matrix(0.865865 0.500278 -0.871576 0.490261 138.36 75.1509)\"\n        />\n      </clipPath>\n      <clipPath id=\"clip1_20786_38285\">\n        <rect\n          width=\"12\"\n          height=\"12\"\n          fill=\"white\"\n          transform=\"matrix(0.865865 0.500278 -0.871576 0.490261 148.75 81.1543)\"\n        />\n      </clipPath>\n      <clipPath id=\"clip2_20786_38285\">\n        <rect\n          width=\"12\"\n          height=\"12\"\n          fill=\"white\"\n          transform=\"matrix(0.865865 0.500278 -0.871576 0.490261 159.14 87.1577)\"\n        />\n      </clipPath>\n      <clipPath id=\"clip3_20786_38285\">\n        <rect\n          width=\"12\"\n          height=\"12\"\n          fill=\"white\"\n          transform=\"matrix(0.865865 0.500278 -0.871576 0.490261 120.928 84.9561)\"\n        />\n      </clipPath>\n      <clipPath id=\"clip4_20786_38285\">\n        <rect\n          width=\"12\"\n          height=\"12\"\n          fill=\"white\"\n          transform=\"matrix(0.865865 0.500278 -0.871576 0.490261 131.318 90.9595)\"\n        />\n      </clipPath>\n      <clipPath id=\"clip5_20786_38285\">\n        <rect\n          width=\"12\"\n          height=\"12\"\n          fill=\"white\"\n          transform=\"matrix(0.865865 0.500278 -0.871576 0.490261 141.709 96.9629)\"\n        />\n      </clipPath>\n    </defs>\n  </svg>\n)\n\nexport default TransferImage\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/order/templates/order-completed-template.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/order/templates/order-details-template.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/products/components/categories-and-tags-tab/index.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[47,50],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[47,50],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"sonarjs/no-identical-functions","severity":2,"message":"Update this function so that its implementation is not identical to the one on line 11.","line":17,"column":27,"nodeType":null,"endLine":17,"endColumn":29},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":54,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2327,2330],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2327,2330],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":77,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3096,3099],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3096,3099],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"type CategoriesAndTagsTabProps = {\n  product?: any\n}\n\nconst TagIcon = () => (\n  <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z\" />\n  </svg>\n)\n\nconst CategoryIcon = () => (\n  <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10\" />\n  </svg>\n)\n\nconst CollectionIcon = () => (\n  <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10\" />\n  </svg>\n)\n\nconst CategoriesAndTagsTab = ({ product }: CategoriesAndTagsTabProps) => {\n  return (\n    <div className=\"text-small-regular py-8\">\n      <div className=\"grid grid-cols-1 gap-y-8\">\n        \n        {/* 系列 (Collection) */}\n        {product?.collection && (\n          <div>\n            <div className=\"flex items-center gap-x-2 mb-4\">\n              <CollectionIcon />\n              <span className=\"font-semibold\">商品系列</span>\n            </div>\n            <div className=\"flex flex-wrap gap-2\">\n              <span className=\"bg-purple-100 text-purple-800 px-3 py-1 rounded-full text-sm\">\n                {product.collection.title}\n              </span>\n            </div>\n            {product.collection.handle && (\n              <p className=\"text-xs text-gray-500 mt-2\">系列代碼: {product.collection.handle}</p>\n            )}\n          </div>\n        )}\n        \n        {/* 分類 (Categories) */}\n        {product?.categories && product.categories.length > 0 && (\n          <div>\n            <div className=\"flex items-center gap-x-2 mb-4\">\n              <CategoryIcon />\n              <span className=\"font-semibold\">商品分類</span>\n            </div>\n            <div className=\"flex flex-wrap gap-2\">\n              {product.categories.map((category: any) => (\n                <span \n                  key={category.id} \n                  className=\"bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm\"\n                >\n                  {category.name}\n                </span>\n              ))}\n            </div>\n            <p className=\"text-xs text-gray-500 mt-2\">\n              共 {product.categories.length} 個分類\n            </p>\n          </div>\n        )}\n\n        {/* 標籤 (Tags) */}\n        {product?.tags && product.tags.length > 0 && (\n          <div>\n            <div className=\"flex items-center gap-x-2 mb-4\">\n              <TagIcon />\n              <span className=\"font-semibold\">商品標籤</span>\n            </div>\n            <div className=\"flex flex-wrap gap-2\">\n              {product.tags.map((tag: any) => (\n                <span \n                  key={tag.id} \n                  className=\"bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm\"\n                >\n                  {tag.value}\n                </span>\n              ))}\n            </div>\n            <p className=\"text-xs text-gray-500 mt-2\">\n              共 {product.tags.length} 個標籤\n            </p>\n          </div>\n        )}\n        \n        {/* 空狀態提示 */}\n        {(!product?.collection && (!product?.categories || product.categories.length === 0) && (!product?.tags || product.tags.length === 0)) && (\n          <div className=\"text-gray-500 text-center py-8\">\n            <div className=\"flex flex-col items-center gap-4\">\n              <div className=\"flex items-center gap-2 text-gray-400\">\n                <CollectionIcon />\n                <CategoryIcon />\n                <TagIcon />\n              </div>\n              <p>此商品尚未設定系列、分類或標籤</p>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  )\n}\n\nexport default CategoriesAndTagsTab\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/products/components/collapsible-section/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/products/components/image-gallery/index.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Container' is defined but never used.","line":4,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":19},{"ruleId":"unused-imports/no-unused-imports","severity":2,"message":"'Container' is defined but never used.","line":4,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":19,"fix":{"range":[58,99],"text":""}}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":1,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { HttpTypes } from \"@medusajs/types\"\nimport { Container } from \"@medusajs/ui\"\nimport Image from \"next/image\"\nimport { useState } from \"react\"\n\ntype ImageGalleryProps = {\n  images: HttpTypes.StoreProductImage[]\n}\n\nconst ImageGallery = ({ images }: ImageGalleryProps) => {\n  const [selectedImageIndex, setSelectedImageIndex] = useState(0)\n\n  const handlePrevious = () => {\n    setSelectedImageIndex((prev) => (prev === 0 ? images.length - 1 : prev - 1))\n  }\n\n  const handleNext = () => {\n    setSelectedImageIndex((prev) => (prev === images.length - 1 ? 0 : prev + 1))\n  }\n\n  if (!images?.length) {\n    return null\n  }\n\n  return (\n    <div className=\"flex flex-col gap-4\">\n      {/* 主圖顯示區 */}\n      <div className=\"w-full overflow-hidden\">\n        <div className=\"relative aspect-[29/34] w-full bg-ui-bg-subtle\">\n          <Image\n            key={images[selectedImageIndex].id}\n            src={images[selectedImageIndex].url}\n            priority={true}\n            className=\"w-full h-full object-cover\"\n            alt={`Product image ${selectedImageIndex + 1}`}\n            fill\n            sizes=\"(max-width: 576px) 280px, (max-width: 768px) 360px, (max-width: 992px) 480px, 800px\"\n            style={{ objectFit: \"cover\" }}\n          />\n          \n          {images.length > 1 && (\n            <>\n              {/* 左箭頭 */}\n              <button \n                onClick={handlePrevious}\n                className=\"absolute left-4 top-1/2 transform -translate-y-1/2 text-black hover:text-gray-700 transition-all z-10 bg-white/60 p-1 rounded-full\"\n                aria-label=\"Previous image\"\n              >\n                <svg \n                  xmlns=\"http://www.w3.org/2000/svg\" \n                  width=\"32\" \n                  height=\"32\" \n                  viewBox=\"0 0 24 24\" \n                  fill=\"none\" \n                  stroke=\"currentColor\" \n                  strokeWidth=\"2\" \n                  strokeLinecap=\"round\" \n                  strokeLinejoin=\"round\"\n                  className=\"drop-shadow-[0_2px_3px_rgba(0,0,0,0.5)]\"\n                >\n                  <path d=\"M15 18l-6-6 6-6\" />\n                </svg>\n              </button>\n\n              {/* 右箭頭 */}\n              <button\n                onClick={handleNext}\n                className=\"absolute right-4 top-1/2 transform -translate-y-1/2 text-black hover:text-gray-700 transition-all z-10 bg-white/60 p-1 rounded-full\"\n                aria-label=\"Next image\"\n              >\n                <svg \n                  xmlns=\"http://www.w3.org/2000/svg\" \n                  width=\"32\" \n                  height=\"32\" \n                  viewBox=\"0 0 24 24\" \n                  fill=\"none\" \n                  stroke=\"currentColor\" \n                  strokeWidth=\"2\" \n                  strokeLinecap=\"round\" \n                  strokeLinejoin=\"round\"\n                  className=\"drop-shadow-[0_2px_3px_rgba(0,0,0,0.5)]\"\n                >\n                  <path d=\"M9 18l6-6-6-6\" />\n                </svg>\n              </button>\n\n              {/* 圖片計數器 */}\n              <div className=\"absolute bottom-3 right-3 bg-white/60 px-2 py-1 rounded text-xs font-medium\">\n                {selectedImageIndex + 1} / {images.length}\n              </div>\n            </>\n          )}\n        </div>\n      </div>\n      \n      {/* 縮圖列表 */}\n      {images.length > 1 && (\n        <div className=\"flex gap-2 overflow-x-auto scrollbar-hide\">\n          {images.map((image, index) => (\n            <button\n              key={`thumb-${image.id || `index-${index}`}`}\n              onClick={() => setSelectedImageIndex(index)}\n              className={`relative w-20 h-24 flex-shrink-0 border-2 transition-all ${\n                selectedImageIndex === index ? \"border-black\" : \"border-transparent hover:border-gray-300\"\n              }`}\n            >\n              <Image\n                src={image.url}\n                alt={`Thumbnail ${index + 1}`}\n                fill\n                className=\"object-cover\"\n                sizes=\"80px\"\n              />\n            </button>\n          ))}\n        </div>\n      )}\n    </div>\n  )\n}\n\nexport default ImageGallery\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/products/components/product-actions/index.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[805,808],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[805,808],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":42,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":42,"endColumn":18,"suggestions":[{"fix":{"range":[1397,1660],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":62,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":62,"endColumn":16,"suggestions":[{"fix":{"range":[1982,2292],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":68,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":68,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2244,2247],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2244,2247],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":105,"column":44,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":105,"endColumn":46,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3352,3354],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":121,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":121,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3669,3672],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3669,3672],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":122,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":122,"endColumn":16,"suggestions":[{"fix":{"range":[3677,3954],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":131,"column":51,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":131,"endColumn":53,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3981,4067],"text":"(variant.calculated_price?.calculated_amount ?? \n      variant.calculated_price?.amount)"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":132,"column":40,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":132,"endColumn":42,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[4068,4070],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":145,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":145,"endColumn":16,"suggestions":[{"fix":{"range":[4387,4519],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":171,"column":38,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":171,"endColumn":40,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[4979,4981],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":174,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":174,"endColumn":18,"suggestions":[{"fix":{"range":[5008,5041],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":180,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":180,"endColumn":20,"suggestions":[{"fix":{"range":[5325,5371],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":183,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":183,"endColumn":18,"suggestions":[{"fix":{"range":[5393,5420],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":188,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":188,"endColumn":20,"suggestions":[{"fix":{"range":[5558,5586],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":191,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":191,"endColumn":20,"suggestions":[{"fix":{"range":[5623,5657],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":204,"column":33,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":204,"endColumn":35,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[5967,5969],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":12,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { useIntersection } from \"@lib/hooks/use-in-view\"\nimport { HttpTypes } from \"@medusajs/types\"\nimport { Button } from \"@medusajs/ui\"\nimport Divider from \"@modules/common/components/divider\"\nimport OptionSelect from \"@modules/products/components/product-actions/option-select\"\nimport { isEqual } from \"lodash\"\nimport { useParams } from \"next/navigation\"\nimport { useEffect, useMemo, useRef, useState } from \"react\"\nimport ProductPrice from \"../product-price\"\nimport MobileActions from \"./mobile-actions\"\n\ntype ProductActionsProps = {\n  product: HttpTypes.StoreProduct\n  region: HttpTypes.StoreRegion\n  disabled?: boolean\n}\n\nconst optionsAsKeymap = (\n  variantOptions: HttpTypes.StoreProductVariant[\"options\"]\n) => {\n  return variantOptions?.reduce((acc: Record<string, string>, varopt: any) => {\n    acc[varopt.option_id] = varopt.value\n    return acc\n  }, {})\n}\n\nexport default function ProductActions({\n  product,\n  disabled,\n}: ProductActionsProps) {\n  const [options, setOptions] = useState<Record<string, string | undefined>>({})\n  const [isAdding, setIsAdding] = useState(false)\n  const countryCode = useParams().countryCode as string\n\n  // If there is only 1 variant, preselect the options\n  useEffect(() => {\n    if (product.variants?.length === 1) {\n      const variantOptions = optionsAsKeymap(product.variants[0].options)\n      setOptions(variantOptions ?? {})\n      console.log(\"🔧 自動預選單一變體:\", {\n        productTitle: product.title,\n        variantId: product.variants[0].id,\n        variantTitle: product.variants[0].title,\n        options: variantOptions,\n        calculated_price: product.variants[0].calculated_price\n      })\n    }\n  }, [product.variants])\n\n  const selectedVariant = useMemo(() => {\n    if (!product.variants || product.variants.length === 0) {\n      return\n    }\n\n    const variant = product.variants.find((v) => {\n      const variantOptions = optionsAsKeymap(v.options)\n      return isEqual(variantOptions, options)\n    })\n\n    console.log(\"🔍 變體選擇檢查:\", {\n      productTitle: product.title,\n      totalVariants: product.variants.length,\n      currentOptions: options,\n      selectedVariantId: variant?.id,\n      selectedVariantTitle: variant?.title,\n      hasCalculatedPrice: !!(variant as any)?.calculated_price?.calculated_amount\n    })\n\n    return variant\n  }, [product.variants, options])\n\n  // update the options when a variant is selected\n  const setOptionValue = (optionId: string, value: string) => {\n    setOptions((prev) => ({\n      ...prev,\n      [optionId]: value,\n    }))\n  }\n\n  //check if the selected options produce a valid variant\n  const isValidVariant = useMemo(() => {\n    return product.variants?.some((v) => {\n      const variantOptions = optionsAsKeymap(v.options)\n      return isEqual(variantOptions, options)\n    })\n  }, [product.variants, options])\n\n  // check if the selected variant is in stock\n  const inStock = useMemo(() => {\n    // If we don't manage inventory, we can always add to cart\n    if (selectedVariant && !selectedVariant.manage_inventory) {\n      return true\n    }\n\n    // If we allow back orders on the variant, we can add to cart\n    if (selectedVariant?.allow_backorder) {\n      return true\n    }\n\n    // If there is inventory available, we can add to cart\n    if (\n      selectedVariant?.manage_inventory &&\n      (selectedVariant?.inventory_quantity || 0) > 0\n    ) {\n      return true\n    }\n\n    // Otherwise, we can't add to cart\n    return false\n  }, [selectedVariant])\n\n  // 檢查選中的變體是否有價格設定\n  const hasPrice = useMemo(() => {\n    if (!selectedVariant) {\n      return false\n    }\n    \n    // 檢查是否有 calculated_price - 支援多種價格結構\n    const variant = selectedVariant as any\n    console.log(\"🔍 價格檢查:\", {\n      variantId: selectedVariant.id,\n      calculated_price: variant.calculated_price,\n      hasCalculatedAmount: !!(variant.calculated_price?.calculated_amount),\n      hasAmount: !!(variant.calculated_price?.amount),\n      fullVariant: variant\n    })\n    \n    return !!(\n      variant.calculated_price?.calculated_amount || \n      variant.calculated_price?.amount ||\n      (variant.prices && variant.prices.length > 0)\n    )\n  }, [selectedVariant])\n\n  const actionsRef = useRef<HTMLDivElement>(null)\n\n  const inView = useIntersection(actionsRef, \"0px\")\n\n  // add the selected variant to the cart\n  const handleAddToCart = async () => {\n    if (!selectedVariant?.id) return null\n\n    console.log(\"🛒 正在加入購物車:\", {\n      variantId: selectedVariant.id,\n      quantity: 1,\n      countryCode,\n      selectedVariant\n    })\n\n    setIsAdding(true)\n\n    try {\n      // 使用新的 API route\n      const response = await fetch('/api/cart/add', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          variantId: selectedVariant.id,\n          quantity: 1,\n          countryCode,\n        }),\n      })\n\n      const result = await response.json()\n\n      if (!response.ok) {\n        throw new Error(result.error || '加入購物車失敗')\n      }\n\n      console.log(\"✅ 成功加入購物車:\", result)\n      \n      // 如果 API 回傳 cartId，也在前端設定\n      if (result.cartId && typeof window !== 'undefined') {\n        localStorage.setItem('_medusa_cart_id', result.cartId)\n        document.cookie = `_medusa_cart_id=${result.cartId}; max-age=${60 * 60 * 24 * 7}; path=/; samesite=lax`\n        console.log(\"📱 前端儲存 Cart ID:\", result.cartId)\n      }\n      \n      console.log(\"💡 商品已加入購物車！\")\n      \n      // 觸發購物車更新事件\n      if (typeof window !== 'undefined') {\n        window.dispatchEvent(new CustomEvent('cartUpdate'))\n        console.log(\"🔄 已觸發購物車更新事件\")\n      }\n    } catch (error) {\n      console.error(\"❌ 加入購物車失敗:\", error)\n      // 可以在這裡添加用戶友好的錯誤提示\n    } finally {\n      setIsAdding(false)\n    }\n  }\n\n  return (\n    <>\n      <div className=\"flex flex-col gap-y-2\" ref={actionsRef}>\n        <div>\n          {(product.variants?.length ?? 0) > 1 && (\n            <div className=\"flex flex-col gap-y-4\">\n              {(product.options || []).map((option, index) => {\n                return (\n                  <div key={option.id ? `${option.id}-${option.title}` : `option-${index}-${option.title}`}>\n                    <OptionSelect\n                      option={option}\n                      current={options[option.id]}\n                      updateOption={setOptionValue}\n                      title={option.title ?? \"\"}\n                      data-testid=\"product-options\"\n                      disabled={!!disabled || isAdding}\n                    />\n                  </div>\n                )\n              })}\n              <Divider />\n            </div>\n          )}\n        </div>\n\n        <ProductPrice product={product} variant={selectedVariant} />\n\n        <Button\n          onClick={handleAddToCart}\n          disabled={\n            !inStock ||\n            !selectedVariant ||\n            !hasPrice ||\n            !!disabled ||\n            isAdding ||\n            !isValidVariant\n          }\n          variant=\"primary\"\n          className=\"w-full h-10\"\n          isLoading={isAdding}\n          data-testid=\"add-product-button\"\n        >\n          {!selectedVariant && !options\n            ? \"選擇規格\"\n            : !selectedVariant && options\n            ? \"請選擇規格\"\n            : !hasPrice\n            ? \"此地區暫無價格\"\n            : !inStock || !isValidVariant\n            ? \"缺貨\"\n            : \"加入購物車\"}\n        </Button>\n        <MobileActions\n          product={product}\n          variant={selectedVariant}\n          options={options}\n          updateOptions={setOptionValue}\n          inStock={inStock && hasPrice}\n          handleAddToCart={handleAddToCart}\n          isAdding={isAdding}\n          show={!inView}\n          optionsDisabled={!!disabled || isAdding}\n        />\n      </div>\n    </>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/products/components/product-actions/mobile-actions.tsx","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":50,"column":25,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":50,"endColumn":27,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1299,1328],"text":"(variantPrice ?? cheapestPrice)"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":50,"column":42,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":50,"endColumn":44,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1329,1331],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":177,"column":43,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":177,"endColumn":45,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[5998,6000],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Dialog, Transition } from \"@headlessui/react\"\nimport { Button, clx } from \"@medusajs/ui\"\nimport React, { Fragment, useMemo } from \"react\"\n\nimport useToggleState from \"@lib/hooks/use-toggle-state\"\nimport ChevronDown from \"@modules/common/icons/chevron-down\"\nimport X from \"@modules/common/icons/x\"\n\nimport { getProductPrice } from \"@lib/util/get-product-price\"\nimport OptionSelect from \"./option-select\"\nimport { HttpTypes } from \"@medusajs/types\"\nimport { isSimpleProduct } from \"@lib/util/product\"\n\ntype MobileActionsProps = {\n  product: HttpTypes.StoreProduct\n  variant?: HttpTypes.StoreProductVariant\n  options: Record<string, string | undefined>\n  updateOptions: (title: string, value: string) => void\n  inStock?: boolean\n  handleAddToCart: () => void\n  isAdding?: boolean\n  show: boolean\n  optionsDisabled: boolean\n}\n\nconst MobileActions: React.FC<MobileActionsProps> = ({\n  product,\n  variant,\n  options,\n  updateOptions,\n  inStock,\n  handleAddToCart,\n  isAdding,\n  show,\n  optionsDisabled,\n}) => {\n  const { state, open, close } = useToggleState()\n\n  const price = getProductPrice({\n    product: product,\n    variantId: variant?.id,\n  })\n\n  const selectedPrice = useMemo(() => {\n    if (!price) {\n      return null\n    }\n    const { variantPrice, cheapestPrice } = price\n\n    return variantPrice || cheapestPrice || null\n  }, [price])\n\n  const isSimple = isSimpleProduct(product)\n\n  return (\n    <>\n      <div\n        className={clx(\"lg:hidden inset-x-0 bottom-0 fixed\", {\n          \"pointer-events-none\": !show,\n        })}\n      >\n        <Transition\n          as={Fragment}\n          show={show}\n          enter=\"ease-in-out duration-300\"\n          enterFrom=\"opacity-0\"\n          enterTo=\"opacity-100\"\n          leave=\"ease-in duration-300\"\n          leaveFrom=\"opacity-100\"\n          leaveTo=\"opacity-0\"\n        >\n          <div\n            className=\"bg-white flex flex-col gap-y-3 justify-center items-center text-large-regular p-4 h-full w-full border-t border-gray-200\"\n            data-testid=\"mobile-actions\"\n          >\n            <div className=\"flex items-center gap-x-2\">\n              <span data-testid=\"mobile-title\">{product.title}</span>\n              <span>—</span>\n              {selectedPrice ? (\n                <div className=\"flex items-end gap-x-2 text-ui-fg-base\">\n                  {selectedPrice.price_type === \"sale\" && (\n                    <p>\n                      <span className=\"line-through text-small-regular\">\n                        {selectedPrice.original_price}\n                      </span>\n                    </p>\n                  )}\n                  <span\n                    className={clx({\n                      \"text-ui-fg-interactive\":\n                        selectedPrice.price_type === \"sale\",\n                    })}\n                  >\n                    {selectedPrice.calculated_price}\n                  </span>\n                </div>\n              ) : (\n                <div></div>\n              )}\n            </div>\n            <div className={clx(\"grid grid-cols-2 w-full gap-x-4\", {\n              \"!grid-cols-1\": isSimple\n            })}>\n              {!isSimple && <Button\n                onClick={open}\n                variant=\"secondary\"\n                className=\"w-full\"\n                data-testid=\"mobile-actions-button\"\n              >\n                <div className=\"flex items-center justify-between w-full\">\n                  <span>\n                    {variant\n                      ? Object.values(options).join(\" / \")\n                      : \"Select Options\"}\n                  </span>\n                  <ChevronDown />\n                </div>\n              </Button>}\n              <Button\n                onClick={handleAddToCart}\n                disabled={!inStock || !variant}\n                className=\"w-full\"\n                isLoading={isAdding}\n                data-testid=\"mobile-cart-button\"\n              >\n                {!variant\n                  ? \"Select variant\"\n                  : !inStock\n                  ? \"Out of stock\"\n                  : \"Add to cart\"}\n              </Button>\n            </div>\n          </div>\n        </Transition>\n      </div>\n      <Transition appear show={state} as={Fragment}>\n        <Dialog as=\"div\" className=\"relative z-[75]\" onClose={close}>\n          <Transition.Child\n            as={Fragment}\n            enter=\"ease-out duration-300\"\n            enterFrom=\"opacity-0\"\n            enterTo=\"opacity-100\"\n            leave=\"ease-in duration-200\"\n            leaveFrom=\"opacity-100\"\n            leaveTo=\"opacity-0\"\n          >\n            <div className=\"fixed inset-0 bg-gray-700 bg-opacity-75 backdrop-blur-sm\" />\n          </Transition.Child>\n\n          <div className=\"fixed bottom-0 inset-x-0\">\n            <div className=\"flex min-h-full h-full items-center justify-center text-center\">\n              <Transition.Child\n                as={Fragment}\n                enter=\"ease-out duration-300\"\n                enterFrom=\"opacity-0\"\n                enterTo=\"opacity-100\"\n                leave=\"ease-in duration-200\"\n                leaveFrom=\"opacity-100\"\n                leaveTo=\"opacity-0\"\n              >\n                <Dialog.Panel\n                  className=\"w-full h-full transform overflow-hidden text-left flex flex-col gap-y-3\"\n                  data-testid=\"mobile-actions-modal\"\n                >\n                  <div className=\"w-full flex justify-end pr-6\">\n                    <button\n                      onClick={close}\n                      className=\"bg-white w-12 h-12 rounded-full text-ui-fg-base flex justify-center items-center\"\n                      data-testid=\"close-modal-button\"\n                    >\n                      <X />\n                    </button>\n                  </div>\n                  <div className=\"bg-white px-6 py-12\">\n                    {(product.variants?.length ?? 0) > 1 && (\n                      <div className=\"flex flex-col gap-y-6\">\n                        {(product.options || []).map((option, index) => {\n                          return (\n                            <div key={option.id ? `${option.id}-${option.title}` : `option-${index}-${option.title}`}>\n                              <OptionSelect\n                                option={option}\n                                current={options[option.id]}\n                                updateOption={updateOptions}\n                                title={option.title ?? \"\"}\n                                disabled={optionsDisabled}\n                              />\n                            </div>\n                          )\n                        })}\n                      </div>\n                    )}\n                  </div>\n                </Dialog.Panel>\n              </Transition.Child>\n            </div>\n          </div>\n        </Dialog>\n      </Transition>\n    </>\n  )\n}\n\nexport default MobileActions\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/products/components/product-actions/option-select.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/products/components/product-info-tab/index.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[37,40],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[37,40],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":13,"column":34,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":13,"endColumn":36,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[417,419],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":81,"column":79,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":81,"endColumn":81,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2742,2744],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"type ProductTabsProps = {\n  product: any\n}\n\nconst ProductInfoTab = ({ product }: ProductTabsProps) => {\n  return (\n    <div className=\"text-small-regular py-8\">\n      <div className=\"grid grid-cols-1 gap-y-6\">\n        {/* 商品描述 */}\n        <div>\n          <span className=\"font-semibold text-base\">商品描述</span>\n          <p className=\"mt-2 text-base text-gray-700 whitespace-pre-line\">\n            {product.description || \"暫無商品描述\"}\n          </p>\n        </div>\n\n        {/* 基本規格和自定義屬性統一顯示 */}\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n          {/* 材質 */}\n          {product.material && (\n            <div>\n              <span className=\"font-semibold text-base\">材質</span>\n              <p className=\"mt-2 text-base text-gray-700\">{product.material}</p>\n            </div>\n          )}\n\n          {/* 品牌 (從 metadata 取得) */}\n          {product.metadata?.brand && (\n            <div>\n              <span className=\"font-semibold text-base\">品牌</span>\n              <p className=\"mt-2 text-base text-gray-700\">{product.metadata.brand}</p>\n            </div>\n          )}\n\n          {/* 重量 */}\n          {product.weight && (\n            <div>\n              <span className=\"font-semibold text-base\">重量</span>\n              <p className=\"mt-2 text-base text-gray-700\">{product.weight}g</p>\n            </div>\n          )}\n\n          {/* 顏色 (從 metadata 取得) */}\n          {product.metadata?.color && (\n            <div>\n              <span className=\"font-semibold text-base\">顏色</span>\n              <p className=\"mt-2 text-base text-gray-700\">{product.metadata.color}</p>\n            </div>\n          )}\n\n          {/* 尺寸 */}\n          {(product.length && product.width && product.height) && (\n            <div>\n              <span className=\"font-semibold text-base\">尺寸</span>\n              <p className=\"mt-2 text-base text-gray-700\">\n                {product.length}L x {product.width}W x {product.height}H cm\n              </p>\n            </div>\n          )}\n\n          {/* 尺寸選項 (從 metadata 取得) */}\n          {product.metadata?.size && (\n            <div>\n              <span className=\"font-semibold text-base\">尺寸選項</span>\n              <p className=\"mt-2 text-base text-gray-700\">{product.metadata.size}</p>\n            </div>\n          )}\n\n          {/* 產地 */}\n          {product.origin_country && (\n            <div>\n              <span className=\"font-semibold text-base\">產地</span>\n              <p className=\"mt-2 text-base text-gray-700\">{product.origin_country}</p>\n            </div>\n          )}\n\n          {/* 商品類型 */}\n          {product.type && (\n            <div>\n              <span className=\"font-semibold text-base\">商品類型</span>\n              <p className=\"mt-2 text-base text-gray-700\">{product.type.value || product.type}</p>\n            </div>\n          )}\n\n          {/* 商品狀態 */}\n          {product.status && (\n            <div>\n              <span className=\"font-semibold text-base\">狀態</span>\n              <p className=\"mt-2 text-base text-gray-700\">\n                <span className={`px-2 py-1 rounded-full text-xs ${\n                  product.status === 'published' ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'\n                }`}>\n                  {product.status === 'published' ? '已上架' : product.status === 'draft' ? '草稿' : product.status}\n                </span>\n              </p>\n            </div>\n          )}\n\n          {/* 商品編號 */}\n          {product.id && (\n            <div>\n              <span className=\"font-semibold text-base\">商品編號</span>\n              <p className=\"mt-2 text-sm text-gray-700 font-mono\">{product.id}</p>\n            </div>\n          )}\n\n          {/* 其他自定義屬性 (從 metadata) */}\n          {product.metadata && Object.entries(product.metadata).filter(([key, value]) => \n            !['brand', 'color', 'size'].includes(key) && value\n          ).map(([key, value]) => (\n            <div key={key}>\n              <span className=\"font-semibold text-base capitalize\">{key.replace(/_/g, ' ')}</span>\n              <p className=\"mt-2 text-base text-gray-700\">{String(value)}</p>\n            </div>\n          ))}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nexport default ProductInfoTab\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/products/components/product-onboarding-cta/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/products/components/product-preview/client-price.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/products/components/product-preview/index.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ProductOption' is defined but never used.","line":10,"column":6,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":19},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'ProductOption' is defined but never used. Allowed unused vars must match /^_/u.","line":10,"column":6,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":19},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":39,"column":70,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":39,"endColumn":72,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1039,1041],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'showVariantSelector' is assigned a value but never used.","line":61,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":61,"endColumn":29},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'showVariantSelector' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":61,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":61,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'setShowVariantSelector' is assigned a value but never used.","line":61,"column":31,"nodeType":null,"messageId":"unusedVar","endLine":61,"endColumn":53},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'setShowVariantSelector' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":61,"column":31,"nodeType":null,"messageId":"unusedVar","endLine":61,"endColumn":53},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'isHovered' is assigned a value but never used.","line":106,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":106,"endColumn":19},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'isHovered' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":106,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":106,"endColumn":19},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":138,"column":50,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":138,"endColumn":52,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[4241,4243],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_' is defined but never used.","line":177,"column":67,"nodeType":null,"messageId":"unusedVar","endLine":177,"endColumn":68},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":217,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":217,"endColumn":18,"suggestions":[{"fix":{"range":[6313,6343],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":221,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":221,"endColumn":16,"suggestions":[{"fix":{"range":[6368,6497],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":228,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":228,"endColumn":16,"suggestions":[{"fix":{"range":[6556,6594],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":231,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":231,"endColumn":18,"suggestions":[{"fix":{"range":[6628,6654],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":239,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":239,"endColumn":18,"suggestions":[{"fix":{"range":[6765,6877],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":261,"column":38,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":261,"endColumn":40,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[7293,7295],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":264,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":264,"endColumn":18,"suggestions":[{"fix":{"range":[7328,7376],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":270,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":270,"endColumn":20,"suggestions":[{"fix":{"range":[7660,7706],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":283,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":283,"endColumn":20,"suggestions":[{"fix":{"range":[8012,8062],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":12,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { getProductPrice } from \"@lib/util/get-product-price\"\nimport { HttpTypes } from \"@medusajs/types\"\nimport LocalizedClientLink from \"../../../common/components/localized-client-link/index\"\nimport { useEffect, useMemo, useState } from \"react\"\nimport Thumbnail from \"../thumbnail/index\"\nimport ClientPreviewPrice from \"./client-price\"\n\ntype ProductOption = {\n  title: string\n  values: string[]\n}\n\ntype SelectedOptions = {\n  [key: string]: string | null\n}\n\nexport default function ProductPreview({\n  product,\n  isFeatured,\n  countryCode = \"tw\",\n}: {\n  product: HttpTypes.StoreProduct\n  isFeatured?: boolean\n  countryCode?: string\n}) {\n  const { cheapestPrice } = getProductPrice({\n    product,\n  })\n\n  // 簡化的庫存狀態檢查\n  const productStockStatus = useMemo(() => {\n    if (!product.variants || product.variants.length === 0) {\n      return { isSoldOut: false, canPreorder: false }\n    }\n\n    const allVariantsOutOfStock = product.variants.every(variant => {\n      return variant.manage_inventory && (variant.inventory_quantity || 0) === 0\n    })\n\n    const canPreorder = product.variants.some(variant => {\n      return variant.allow_backorder === true\n    })\n\n    return {\n      isSoldOut: allVariantsOutOfStock && !canPreorder,\n      canPreorder: allVariantsOutOfStock && canPreorder\n    }\n  }, [product])\n\n  // 為了向後相容，保留 isProductSoldOut\n  const isProductSoldOut = productStockStatus.isSoldOut\n\n  const [selectedOptions, setSelectedOptions] = useState<SelectedOptions>({})\n  const [isAdding, setIsAdding] = useState(false)\n  const [error, setError] = useState<string | null>(null)\n  const [showSuccessMessage, setShowSuccessMessage] = useState(false)\n  const [currentImageIndex, setCurrentImageIndex] = useState(0)\n  const [isImageTransitioning, setIsImageTransitioning] = useState(false)\n  const [showVariantSelector, setShowVariantSelector] = useState(false)\n  const [showMobileOptions, setShowMobileOptions] = useState(false)\n\n  // 獲取所有可用圖片\n  const allImages = useMemo(() => {\n    const images = []\n    if (product.thumbnail) {\n      images.push(product.thumbnail)\n    }\n    if (product.images && product.images.length > 0) {\n      product.images.forEach(img => {\n        if (img.url && img.url !== product.thumbnail) {\n          images.push(img.url)\n        }\n      })\n    }\n    return images\n  }, [product.thumbnail, product.images])\n\n  // 切換圖片的通用函數，帶淡出淡入效果\n  const changeImage = (newIndex: number, e?: React.MouseEvent) => {\n    if (e) {\n      e.preventDefault()\n      e.stopPropagation()\n    }\n    if (allImages.length > 1 && newIndex !== currentImageIndex) {\n      setIsImageTransitioning(true)\n      setTimeout(() => {\n        setCurrentImageIndex(newIndex)\n        setIsImageTransitioning(false)\n      }, 150) // 淡出時間\n    }\n  }\n\n  // 切換到下一張圖片\n  const nextImage = (e: React.MouseEvent) => {\n    const newIndex = (currentImageIndex + 1) % allImages.length\n    changeImage(newIndex, e)\n  }\n\n  // 切換到上一張圖片\n  const prevImage = (e: React.MouseEvent) => {\n    const newIndex = (currentImageIndex - 1 + allImages.length) % allImages.length\n    changeImage(newIndex, e)\n  }\n  const [isHovered, setIsHovered] = useState(false)\n\n  // 使用 useMemo 優化產品選項的計算\n  const productOptions = useMemo(() => {\n    if (!product.options?.length) return []\n\n    // 直接使用產品的 options 結構，並按照特定順序排序\n    return product.options\n      .slice() // 創建副本避免修改原始數據\n      .sort((a, b) => {\n        // 確保特定選項的順序：尺寸 -> 顏色 -> 其他\n        const getOptionPriority = (title: string) => {\n          const lowerTitle = title.toLowerCase()\n          if (lowerTitle.includes('尺寸') || lowerTitle.includes('size')) return 1\n          if (lowerTitle.includes('顏色') || lowerTitle.includes('color')) return 2\n          return 3\n        }\n        \n        const priorityA = getOptionPriority(a.title)\n        const priorityB = getOptionPriority(b.title)\n        \n        if (priorityA !== priorityB) {\n          return priorityA - priorityB\n        }\n        \n        // 如果優先級相同，按照創建時間排序\n        const timeA = a.created_at ? new Date(a.created_at).getTime() : 0\n        const timeB = b.created_at ? new Date(b.created_at).getTime() : 0\n        return timeA - timeB\n      })\n      .map(option => ({\n        title: option.title,\n        values: option.values?.map(v => v.value) || []\n      }))\n  }, [product.options])\n\n  // 自動選擇單一選項值\n  const autoSelectSingleOptions = useMemo(() => {\n    const autoSelected: SelectedOptions = {}\n    \n    productOptions.forEach(option => {\n      if (option.values.length === 1) {\n        autoSelected[option.title] = option.values[0]\n      }\n    })\n    \n    return autoSelected\n  }, [productOptions])\n\n  // 在組件載入時自動選擇單一選項值\n  useEffect(() => {\n    if (Object.keys(autoSelectSingleOptions).length > 0) {\n      setSelectedOptions(prev => ({\n        ...autoSelectSingleOptions,\n        ...prev\n      }))\n    }\n  }, [autoSelectSingleOptions])\n\n  // 根據選擇的選項找到對應的變體\n  const findVariantId = (selectedOpts: SelectedOptions): string | undefined => {\n    if (!product.variants || product.variants.length === 0) {\n      return undefined\n    }\n\n    // 如果商品沒有選項，直接返回第一個變體\n    if (productOptions.length === 0) {\n      return product.variants[0]?.id\n    }\n\n    // 檢查是否有選擇的選項\n    const selectedEntries = Object.entries(selectedOpts).filter(([_, value]) => value !== null)\n    \n    // 如果沒有選擇任何選項，返回 undefined\n    if (selectedEntries.length === 0) return undefined\n    \n    // 如果選項數量不完整，也返回 undefined\n    if (selectedEntries.length < productOptions.length) return undefined\n\n    // 尋找匹配的變體\n    const matchedVariant = product.variants.find(variant => {\n      if (!variant.options) return false\n      \n      // 檢查變體的選項是否與選擇的選項匹配\n      return selectedEntries.every(([optionTitle, selectedValue]) => {\n        return variant.options?.some(variantOption => \n          variantOption.option?.title === optionTitle && \n          variantOption.value === selectedValue\n        )\n      }) && variant.options.length === selectedEntries.length\n    })\n\n    return matchedVariant?.id\n  }\n\n  const handleOptionSelect = async (optionTitle: string, value: string) => {\n    setSelectedOptions(prev => ({\n      ...prev,\n      [optionTitle]: value\n    }))\n  }\n\n  const handleAddToCart = async (e?: React.MouseEvent) => {\n    // 如果有傳入事件物件，則阻止預設行為\n    if (e) {\n      e.preventDefault()\n      e.stopPropagation()\n    }\n\n    // 防止重複點擊\n    if (isAdding) {\n      console.log(\"⚠️ 正在添加中，忽略重複點擊\")\n      return\n    }\n\n    console.log(\"🔍 ProductPreview 加入購物車檢查:\", {\n      productTitle: product.title,\n      selectedOptions,\n      productOptions\n    })\n\n    const variantId = findVariantId(selectedOptions)\n    console.log(\"🔍 找到的變體 ID:\", variantId)\n    \n    if (!variantId) {\n      console.log(\"❌ 沒有找到匹配的變體\")\n      setError(\"請選擇所有必要的選項\")\n      return\n    }\n\n    try {\n      setError(null)\n      setIsAdding(true)\n      console.log(\"🛒 ProductPreview 開始加入購物車:\", {\n        variantId,\n        quantity: 1,\n        countryCode\n      })\n      \n      // 使用新的 API endpoint\n      const response = await fetch('/api/cart/add', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          variantId,\n          quantity: 1,\n          countryCode,\n        }),\n      })\n\n      const result = await response.json()\n\n      if (!response.ok) {\n        throw new Error(result.error || '加入購物車失敗')\n      }\n      \n      console.log(\"✅ ProductPreview 成功加入購物車:\", result)\n      \n      // 如果 API 回傳 cartId，也在前端設定\n      if (result.cartId && typeof window !== 'undefined') {\n        localStorage.setItem('_medusa_cart_id', result.cartId)\n        document.cookie = `_medusa_cart_id=${result.cartId}; max-age=${60 * 60 * 24 * 7}; path=/; samesite=lax`\n        console.log(\"📱 前端儲存 Cart ID:\", result.cartId)\n      }\n      \n      setError(null)\n      // 觸發購物車更新事件\n      if (typeof window !== 'undefined') {\n        window.dispatchEvent(new CustomEvent('cartUpdate'))\n      }\n      setShowSuccessMessage(true)\n      setTimeout(() => {\n        setShowSuccessMessage(false)\n      }, 3000)\n    } catch (error) {\n      console.error(\"❌ ProductPreview 添加到購物車失敗:\", error)\n      setError(\"添加到購物車失敗，請稍後再試\")\n    } finally {\n      setIsAdding(false)\n    }\n  }\n\n  // 手機版按鈕點擊處理\n  const handleMobileButtonClick = (e: React.MouseEvent) => {\n    e.preventDefault()\n    e.stopPropagation()\n\n    // 檢查是否需要選擇選項\n    const hasMultipleOptions = productOptions.filter(option => option.values.length > 1).length > 0\n    const variantId = findVariantId(selectedOptions)\n\n    if (hasMultipleOptions && !variantId) {\n      // 如果有多個選項且沒有選擇，顯示選項彈窗\n      setShowMobileOptions(true)\n      return\n    }\n\n    // 否則直接加入購物車\n    handleAddToCart(e)\n  }\n\n  return (\n    <div className={`product-preview relative group w-full ${isFeatured ? 'featured-product-card' : ''}`}>\n      {/* 成功提示彈窗 */}\n      {showSuccessMessage && (\n        <div className=\"fixed top-4 left-1/2 transform -translate-x-1/2 z-50 bg-black/90 text-white px-4 py-2 rounded-md shadow-lg flex items-center space-x-2 animate-fade-in-down\">\n          <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 13l4 4L19 7\" />\n          </svg>\n          <span className=\"text-xs\">商品已加入購物車</span>\n        </div>\n      )}\n\n      {/* 手機版選項彈窗 */}\n      {showMobileOptions && (\n        <div className=\"fixed inset-0 z-[9999] flex items-center justify-center md:hidden p-4\">\n          {/* 背景遮罩 */}\n          <div \n            className=\"absolute inset-0 bg-black/50\"\n            onClick={() => setShowMobileOptions(false)}\n          />\n          \n          {/* 彈窗內容 */}\n          <div className=\"relative w-full max-w-sm bg-white rounded-2xl p-6 space-y-4 animate-slide-up max-h-[70vh] overflow-y-auto shadow-2xl\">\n            {/* 標題區域 */}\n            <div className=\"flex items-center justify-between\">\n              <h3 className=\"text-lg font-semibold\">選擇商品規格</h3>\n              <button\n                onClick={() => setShowMobileOptions(false)}\n                className=\"w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 transition-colors\"\n              >\n                <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={1.5} d=\"M6 18L18 6M6 6l12 12\" />\n                </svg>\n              </button>\n            </div>\n\n            {/* 商品資訊 */}\n            <div className=\"flex space-x-3 pb-4 border-b border-gray-100\">\n              <div className=\"w-20 h-20 rounded-lg overflow-hidden bg-gray-100 flex-shrink-0\">\n                <Thumbnail \n                  thumbnail={allImages[0]} \n                  images={allImages.map(url => ({ url }))}\n                  size=\"square\"\n                />\n              </div>\n              <div className=\"flex-1 min-w-0\">\n                <h4 className=\"text-sm font-medium text-gray-900 line-clamp-2\">{product.title}</h4>\n                {cheapestPrice && (\n                  <div className=\"mt-1\">\n                    <ClientPreviewPrice price={cheapestPrice} />\n                  </div>\n                )}\n              </div>\n            </div>\n\n            {/* 選項選擇 */}\n            <div className=\"space-y-4\">\n              {productOptions.filter(option => option.values.length > 1).map((option) => (\n                <div key={option.title} className=\"space-y-2\">\n                  <label className=\"text-sm font-medium text-gray-700\">\n                    {option.title}\n                  </label>\n                  <div className=\"grid grid-cols-3 gap-2\">\n                    {option.values.map((value) => {\n                      const isSelected = selectedOptions[option.title] === value\n                      return (\n                        <button\n                          key={value}\n                          onClick={() => handleOptionSelect(option.title, value)}\n                          className={`px-3 py-2 text-sm border rounded-lg transition-colors ${\n                            isSelected \n                              ? 'border-black bg-black text-white' \n                              : 'border-gray-200 hover:border-gray-300'\n                          }`}\n                        >\n                          {value}\n                        </button>\n                      )\n                    })}\n                  </div>\n                </div>\n              ))}\n            </div>\n\n            {/* 加入購物車按鈕 */}\n            <button\n              onClick={() => {\n                const variantId = findVariantId(selectedOptions)\n                if (variantId) {\n                  setShowMobileOptions(false)\n                  handleAddToCart()\n                }\n              }}\n              disabled={isAdding || !findVariantId(selectedOptions)}\n              className=\"w-full px-4 py-3 bg-black text-white text-sm font-medium rounded-lg hover:bg-gray-800 transition-colors disabled:bg-gray-200 disabled:text-gray-500\"\n            >\n              {isAdding ? \"處理中...\" : \n               productStockStatus.canPreorder ? \"預訂\" : \"加入購物車\"}\n            </button>\n          </div>\n        </div>\n      )}\n      \n      <div className=\"relative\">\n        <div \n          className=\"relative w-full pb-[133.33%] overflow-hidden bg-white\"\n          onMouseEnter={() => {\n            setIsHovered(true)\n            // 如果有多張圖片，hover時使用淡出淡入切換到第二張圖片\n            if (allImages.length > 1) {\n              changeImage(1)\n            }\n          }}\n          onMouseLeave={() => {\n            setIsHovered(false)\n            // 離開hover時使用淡出淡入恢復到主圖\n            changeImage(0)\n          }}\n        >\n          {/* 商品圖片區塊 */}\n          <LocalizedClientLink href={`/products/${product.handle}`} className=\"block absolute inset-0\">\n            <div className={`absolute inset-0 flex items-center justify-center transition-opacity duration-300 ${\n              isImageTransitioning ? 'opacity-0' : 'opacity-100'\n            } ${isFeatured ? 'product-image' : ''}`}>\n              <Thumbnail \n                thumbnail={allImages[currentImageIndex]} \n                images={allImages.map(url => ({ url }))}\n                size=\"full\"\n              />\n            </div>\n            \n            {/* 圖片切換箭頭 - 只在有多張圖片時顯示 */}\n            {allImages.length > 1 && (\n              <>\n                {/* 左箭頭 */}\n                <button\n                  onClick={prevImage}\n                  className=\"absolute left-3 top-1/2 -translate-y-1/2 z-40 text-black hover:text-gray-600 opacity-0 group-hover:opacity-100 transition-all duration-200 drop-shadow-lg\"\n                  aria-label=\"上一張圖片\"\n                >\n                  <svg className=\"w-8 h-8\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" strokeWidth={3}>\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M15 19l-7-7 7-7\" />\n                  </svg>\n                </button>\n                \n                {/* 右箭頭 */}\n                <button\n                  onClick={nextImage}\n                  className=\"absolute right-3 top-1/2 -translate-y-1/2 z-40 text-black hover:text-gray-600 opacity-0 group-hover:opacity-100 transition-all duration-200 drop-shadow-lg\"\n                  aria-label=\"下一張圖片\"\n                >\n                  <svg className=\"w-8 h-8\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" strokeWidth={3}>\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M9 5l7 7-7 7\" />\n                  </svg>\n                </button>\n                \n                {/* 圖片指示器 */}\n                <div className=\"absolute top-6 left-1/2 -translate-x-1/2 z-50 flex space-x-1 opacity-0 group-hover:opacity-100 transition-all duration-200\">\n                  {allImages.map((_, index) => (\n                    <button\n                      key={index}\n                      onClick={(e) => {\n                        e.preventDefault()\n                        e.stopPropagation()\n                        setCurrentImageIndex(index)\n                      }}\n                      className={`w-3 h-3 rounded-full transition-all duration-200 border-2 ${\n                        index === currentImageIndex \n                          ? 'bg-white border-white shadow-lg scale-110' \n                          : 'bg-white/50 border-white/70 hover:bg-white/80 hover:border-white shadow-md'\n                      }`}\n                    />\n                  ))}\n                </div>\n              </>\n            )}\n            \n            {/* 右上角庫存狀態標籤區域 */}\n            <div className=\"absolute top-2 right-2 z-30\">\n              {(isProductSoldOut || productStockStatus.canPreorder) && (\n                <div className={`px-2 py-1 text-xs font-semibold rounded-md shadow-md border\n                  ${isProductSoldOut \n                    ? 'bg-gray-600 text-white border-gray-700' \n                    : 'bg-blue-600 text-white border-blue-700'\n                  }`}>\n                  {isProductSoldOut ? '售完' : '預訂'}\n                </div>\n              )}\n            </div>\n            \n            {/* 售完狀態 - 只顯示反灰層 */}\n            {isProductSoldOut && (\n              <div className=\"absolute inset-0 bg-black/50 z-20 pointer-events-none\">\n              </div>\n            )}\n          </LocalizedClientLink>\n\n          {/* 手機版錯誤提示 */}\n          {error && (\n            <div className=\"md:hidden absolute bottom-0 left-0 right-0 bg-red-500 text-white text-xs text-center py-2 z-20\">\n              {error}\n            </div>\n          )}\n\n          {/* 桌機版 - 選項和加入購物車區塊 (hover 顯示) */}\n          {!isProductSoldOut && (\n            <div className=\"hidden md:block absolute bottom-0 left-0 right-0 \n                          opacity-0 group-hover:opacity-100 transition-all duration-200 ease-in-out transform translate-y-full group-hover:translate-y-0\">\n              <div className=\"w-full bg-white/95 backdrop-blur-[2px]\">\n                {productOptions\n                  .filter(option => option.values.length > 1) // 只顯示有多個選擇的選項\n                  .map((option, index) => (\n                  <div key={index} className=\"flex flex-col border-t first:border-t-0 border-black/[0.06]\">\n                    <div className=\"text-xs text-black/60 px-2 md:px-8 py-1 border-b border-black/[0.06]\">\n                      {option.title}\n                    </div>\n                    <div \n                      className=\"grid\"\n                      style={{ \n                        gridTemplateColumns: `repeat(${option.values.length}, minmax(0, 1fr))`\n                      }}\n                    >\n                      {option.values.map((value, valueIndex) => (\n                        <button\n                          key={valueIndex}\n                          onClick={(e) => {\n                            e.preventDefault()\n                            handleOptionSelect(option.title, value)\n                          }}\n                          className={`w-full py-3 border border-black text-sm transition-colors min-h-[40px]\n                            ${selectedOptions[option.title] === value \n                              ? 'bg-black text-white' \n                              : 'text-black hover:bg-black hover:text-white'}`}\n                        >\n                          {value}\n                        </button>\n                      ))}\n                    </div>\n                  </div>\n                ))}\n                \n                {/* 桌機版購物車按鈕 */}\n                <div>\n                  <button\n                    onClick={handleAddToCart}\n                    disabled={isAdding || (productOptions.filter(option => option.values.length > 1).length > 0 && !findVariantId(selectedOptions))}\n                    className=\"w-full px-4 py-3 border border-black text-sm hover:bg-black hover:text-white transition-colors disabled:bg-gray-200 disabled:text-gray-500 disabled:border-gray-200 min-h-[40px]\"\n                  >\n                    {isAdding ? \"處理中...\" : \n                     productStockStatus.canPreorder ? \"預訂\" : \"加入購物車\"}\n                  </button>\n                </div>\n                {error && (\n                  <div className=\"text-red-500 text-xs text-center p-2\">\n                    {error}\n                  </div>\n                )}\n              </div>\n            </div>\n          )}\n        </div>\n\n        {/* 商品資訊區塊 */}\n        <LocalizedClientLink href={`/products/${product.handle}`}>\n          <div className=\"px-3 md:px-8 py-3 mt-2\">\n            <h3 className=\"text-sm md:text-xs leading-tight mb-1\" data-testid=\"product-title\">\n              {product.title}\n            </h3>\n            {cheapestPrice && (\n              <div className=\"flex items-center justify-between mt-1\">\n                <div className=\"flex-grow\">\n                  <ClientPreviewPrice price={cheapestPrice} />\n                </div>\n                {/* 手機版 - 價格右側的加入購物車按鈕 */}\n                {!isProductSoldOut && (\n                  <button\n                    onClick={(e) => handleMobileButtonClick(e)}\n                    disabled={isAdding}\n                    className=\"md:hidden w-10 h-10 bg-black text-white rounded-md shadow-sm hover:bg-gray-800 transition-all duration-200 flex items-center justify-center disabled:bg-gray-400 disabled:cursor-not-allowed group/mbtn\"\n                    aria-label={\n                      (() => {\n                        if (isAdding) return \"處理中...\"\n                        const hasMultipleOptions = productOptions.filter(option => option.values.length > 1).length > 0\n                        const variantId = findVariantId(selectedOptions)\n                        if (hasMultipleOptions && !variantId) return \"選擇選項\"\n                        return productStockStatus.canPreorder ? \"預訂\" : \"加入購物車\"\n                      })()\n                    }\n                  >\n                    {isAdding ? (\n                      <div className=\"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin\"></div>\n                    ) : (\n                      <svg \n                        xmlns=\"http://www.w3.org/2000/svg\" \n                        width=\"16\" \n                        height=\"16\" \n                        viewBox=\"0 0 24 24\" \n                        fill=\"none\" \n                        stroke=\"white\" \n                        strokeWidth=\"1.5\"\n                        className=\"flex-shrink-0\"\n                        style={{ display: 'block' }}\n                      >\n                        <path d=\"M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z\"></path>\n                        <line x1=\"3\" y1=\"6\" x2=\"21\" y2=\"6\"></line>\n                        <path d=\"M16 10a4 4 0 0 1-8 0\"></path>\n                      </svg>\n                    )}\n                  </button>\n                )}\n              </div>\n            )}\n          </div>\n        </LocalizedClientLink>\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/products/components/product-preview/price.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/products/components/product-price/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/products/components/product-tabs/accordion.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'headingSize' is assigned a value but never used.","line":40,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":40,"endColumn":14},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'headingSize' is assigned a value but never used. Allowed unused args must match /^_/u.","line":40,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":40,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'triggerable' is defined but never used.","line":43,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":43,"endColumn":14},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'triggerable' is defined but never used. Allowed unused args must match /^_/u.","line":43,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":43,"endColumn":14},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":61,"column":28,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":61,"endColumn":30,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1781,1783],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Text, clx } from \"@medusajs/ui\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport React from \"react\"\n\ntype AccordionItemProps = AccordionPrimitive.AccordionItemProps & {\n  title: string\n  subtitle?: string\n  description?: string\n  required?: boolean\n  tooltip?: string\n  forceMountContent?: true\n  headingSize?: \"small\" | \"medium\" | \"large\"\n  customTrigger?: React.ReactNode\n  complete?: boolean\n  active?: boolean\n  triggerable?: boolean\n  children: React.ReactNode\n}\n\ntype AccordionProps =\n  | (AccordionPrimitive.AccordionSingleProps &\n      React.RefAttributes<HTMLDivElement>)\n  | (AccordionPrimitive.AccordionMultipleProps &\n      React.RefAttributes<HTMLDivElement>)\n\nconst Accordion: React.FC<AccordionProps> & {\n  Item: React.FC<AccordionItemProps>\n} = ({ children, ...props }) => {\n  return (\n    <AccordionPrimitive.Root {...props}>{children}</AccordionPrimitive.Root>\n  )\n}\n\nconst Item: React.FC<AccordionItemProps> = ({\n  title,\n  subtitle,\n  description,\n  children,\n  className,\n  headingSize = \"large\",\n  customTrigger = undefined,\n  forceMountContent = undefined,\n  triggerable,\n  ...props\n}) => {\n  return (\n    <AccordionPrimitive.Item\n      {...props}\n      className={clx(\n        \"border-grey-20 group border-t last:mb-0 last:border-b\",\n        \"py-3\",\n        className\n      )}\n    >\n      <AccordionPrimitive.Header className=\"px-1\">\n        <AccordionPrimitive.Trigger className=\"w-full\">\n          <div className=\"flex w-full items-center justify-between hover:bg-gray-50 transition-colors duration-150 py-2 px-2 rounded-md cursor-pointer\">\n            <div className=\"flex items-center gap-4\">\n              <Text className=\"text-ui-fg-subtle text-sm text-left\">{title}</Text>\n            </div>\n            {customTrigger || <MorphingTrigger />}\n          </div>\n          {subtitle && (\n            <Text as=\"span\" size=\"small\" className=\"mt-1 text-left\">\n              {subtitle}\n            </Text>\n          )}\n        </AccordionPrimitive.Trigger>\n      </AccordionPrimitive.Header>\n      <AccordionPrimitive.Content\n        forceMount={forceMountContent}\n        className={clx(\n          \"radix-state-closed:animate-accordion-close radix-state-open:animate-accordion-open radix-state-closed:pointer-events-none px-1\"\n        )}\n      >\n        <div className=\"inter-base-regular group-radix-state-closed:animate-accordion-close\">\n          {description && <Text>{description}</Text>}\n          <div className=\"w-full\">{children}</div>\n        </div>\n      </AccordionPrimitive.Content>\n    </AccordionPrimitive.Item>\n  )\n}\n\nAccordion.Item = Item\n\nconst MorphingTrigger = () => {\n  return (\n    <div className=\"text-gray-500 hover:text-gray-700 transition-colors p-1\">\n      <svg \n        className=\"w-4 h-4 transform transition-transform duration-200 group-radix-state-open:rotate-180\" \n        fill=\"none\" \n        stroke=\"currentColor\" \n        viewBox=\"0 0 24 24\"\n      >\n        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\n      </svg>\n    </div>\n  )\n}\n\nexport default Accordion\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/products/components/product-tabs/index.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":8,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[239,242],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[239,242],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":36,"column":34,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":36,"endColumn":36,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1135,1137],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport CollapsibleSection from \"../collapsible-section/index\"\nimport CategoriesAndTagsTab from \"../categories-and-tags-tab/index\"\nimport ShippingInfoTab from \"../shipping-info-tab/index\"\n\ntype ProductTabsProps = {\n  product: any\n}\n\nconst ProductTabs = ({ product }: ProductTabsProps) => {\n  return (\n    <div className=\"w-full\">\n      <CollapsibleSection title=\"商品資訊\" defaultOpen={false}>\n        <ProductInfoTab product={product} />\n      </CollapsibleSection>\n      \n      <CollapsibleSection title=\"分類與標籤\" defaultOpen={false}>\n        <CategoriesAndTagsTab product={product} />\n      </CollapsibleSection>\n      \n      <CollapsibleSection title=\"退換貨規則\" defaultOpen={false}>\n        <ShippingInfoTab product={product} />\n      </CollapsibleSection>\n    </div>\n  )\n}\n\nconst ProductInfoTab = ({ product }: ProductTabsProps) => {\n  return (\n    <div className=\"text-small-regular py-8\">\n      <div className=\"grid grid-cols-1 gap-y-6\">\n        <div>\n          <span className=\"font-semibold text-base\">商品描述</span>\n          <p className=\"mt-2 text-base text-gray-700 whitespace-pre-line\">\n            {product.description || \"暫無商品描述\"}\n          </p>\n        </div>\n        {product.material && (\n          <div>\n            <span className=\"font-semibold text-base\">材質</span>\n            <p className=\"mt-2 text-base text-gray-700\">{product.material}</p>\n          </div>\n        )}\n        {product.weight && (\n          <div>\n            <span className=\"font-semibold text-base\">重量</span>\n            <p className=\"mt-2 text-base text-gray-700\">{product.weight}g</p>\n          </div>\n        )}\n        {product.dimensions && (\n          <div>\n            <span className=\"font-semibold text-base\">尺寸</span>\n            <p className=\"mt-2 text-base text-gray-700\">\n              {product.dimensions.length} x {product.dimensions.width} x {product.dimensions.height} cm\n            </p>\n          </div>\n        )}\n      </div>\n    </div>\n  )\n}\n\nexport default ProductTabs\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/products/components/related-products/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/products/components/shipping-info-tab/index.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":6,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[101,104],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[101,104],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'product' is defined but never used.","line":17,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":35},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'product' is defined but never used. Allowed unused args must match /^_/u.","line":17,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":35},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":24,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":24,"endColumn":20,"suggestions":[{"fix":{"range":[476,518],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":28,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":28,"endColumn":20,"suggestions":[{"fix":{"range":[627,668],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":32,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":32,"endColumn":22,"suggestions":[{"fix":{"range":[764,822],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":35,"column":49,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":35,"endColumn":51,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[887,923],"text":"(pageData.grapesHtml ?? pageData.html)"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":35,"column":66,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":35,"endColumn":68,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[910,943],"text":"(pageData.html ?? pageData.content)"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":35,"column":86,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":35,"endColumn":88,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[944,946],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":36,"column":49,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":36,"endColumn":51,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[979,1013],"text":"(pageData.grapesCss ?? pageData.css)"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":36,"column":65,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":36,"endColumn":67,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1014,1016],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":37,"column":47,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":37,"endColumn":49,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1066,1068],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":41,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":41,"endColumn":24,"suggestions":[{"fix":{"range":[1241,1282],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":43,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1346,1349],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1346,1349],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":45,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1500,1503],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1500,1503],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":47,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1637,1640],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1637,1640],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":47,"column":80,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":47,"endColumn":82,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1656,1658],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":67,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":67,"endColumn":22,"suggestions":[{"fix":{"range":[2367,2641],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":81,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":81,"endColumn":24,"suggestions":[{"fix":{"range":[2851,2916],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":83,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":83,"endColumn":25,"suggestions":[{"fix":{"range":[2948,2982],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":98,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":98,"endColumn":24,"suggestions":[{"fix":{"range":[3465,3519],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":137,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":137,"endColumn":22,"suggestions":[{"fix":{"range":[4924,4963],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":9,"fatalErrorCount":0,"warningCount":13,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { useEffect, useState } from 'react'\n\ntype ShippingInfoTabProps = {\n  product?: any\n}\n\ninterface ReturnPageData {\n  grapesHtml: string\n  grapesCss: string\n  title: string\n}\n\n\n\nconst ShippingInfoTab = ({ product }: ShippingInfoTabProps) => {\n  const [returnPageData, setReturnPageData] = useState<ReturnPageData | null>(null)\n  const [loading, setLoading] = useState(true)\n\n  useEffect(() => {\n    const fetchReturnPage = async () => {\n      try {\n        console.log('正在從 Sanity CMS 獲取退換貨規則內容...')\n        \n        // 直接從 API 獲取純內容，不載入完整頁面\n        const response = await fetch('/api/pages/return')\n        console.log('API 回應狀態:', response.status)\n        \n        if (response.ok) {\n          const pageData = await response.json()\n          console.log('完整的頁面資料:', JSON.stringify(pageData, null, 2))\n          \n          // 檢查數據結構並提取內容\n          let htmlContent = pageData.grapesHtml || pageData.html || pageData.content || ''\n          const cssContent = pageData.grapesCss || pageData.css || ''\n          const titleContent = pageData.title || '退換貨規則'\n          \n          // 如果沒有直接的 HTML 內容，但有 homeModules，處理結構化內容\n          if (!htmlContent && pageData.homeModules && pageData.homeModules.length > 0) {\n            console.log('🔄 處理 homeModules 結構化內容...')\n            \n            pageData.homeModules.forEach((module: any) => {\n              if (module.moduleType === 'contentSection' && module.settings?.content) {\n                module.settings.content.forEach((block: any) => {\n                  if (block._type === 'block' && block.children) {\n                    const text = block.children.map((child: any) => child.text || '').join('')\n                    \n                    if (block.style === 'h2') {\n                      htmlContent += `<h2>${text}</h2>\\n`\n                    } else if (block.style === 'normal') {\n                      if (block.listItem === 'number') {\n                        htmlContent += `<li>${text}</li>\\n`\n                      } else {\n                        htmlContent += `<p>${text}</p>\\n`\n                      }\n                    }\n                  }\n                })\n              }\n            })\n            \n            // 將連續的 li 元素包裝在 ol 標籤中\n            htmlContent = htmlContent.replace(/(<li>.*?<\\/li>\\n)+/g, (match) => `<ol>\\n${match}</ol>\\n`)\n          }\n          \n          console.log('提取的內容:', {\n            html: htmlContent.substring(0, 200) + '...', // 只顯示前200個字符\n            htmlLength: htmlContent.length,\n            css: cssContent,\n            title: titleContent,\n            hasHomeModules: pageData.homeModules?.length > 0\n          })\n          \n          if (htmlContent) {\n            setReturnPageData({\n              grapesHtml: htmlContent,\n              grapesCss: cssContent,\n              title: titleContent\n            })\n            console.log('✅ 成功設置 returnPageData，HTML 長度:', htmlContent.length)\n          } else {\n            console.warn('⚠️ 沒有找到有效的 HTML 內容')\n            // 使用預設內容\n            setReturnPageData({\n              grapesHtml: `\n                <div class=\"return-policy-default\">\n                  <h2>退換貨政策</h2>\n                  <p>抱歉，無法載入詳細的退換貨規則。請聯繫客服獲取完整資訊。</p>\n                </div>\n              `,\n              grapesCss: '.return-policy-default { padding: 20px; }',\n              title: '退換貨規則'\n            })\n          }\n        } else {\n          const errorData = await response.json().catch(() => null)\n          console.error('API 回應錯誤:', response.status, errorData)\n          \n          // 如果 API 失敗，提供預設的退換貨規則內容\n          setReturnPageData({\n            grapesHtml: `\n              <div class=\"return-policy-content\">\n                <h2>退換貨政策</h2>\n                <div class=\"policy-section\">\n                  <h3>退貨條件</h3>\n                  <ul>\n                    <li>商品享有7天鑑賞期</li>\n                    <li>退貨商品須保持全新狀態</li>\n                    <li>個人衛生用品不可退換貨</li>\n                    <li>客製化商品不適用退換貨</li>\n                  </ul>\n                </div>\n                <div class=\"policy-section\">\n                  <h3>退貨流程</h3>\n                  <ol>\n                    <li>聯繫客服申請退貨</li>\n                    <li>填寫退貨申請表</li>\n                    <li>寄回商品並等待檢驗</li>\n                    <li>審核通過後進行退款</li>\n                  </ol>\n                </div>\n              </div>\n            `,\n            grapesCss: `\n              .return-policy-content { padding: 20px; font-family: Arial, sans-serif; }\n              .return-policy-content h2 { color: #333; margin-bottom: 20px; }\n              .return-policy-content h3 { color: #555; margin: 15px 0 10px 0; }\n              .policy-section { margin-bottom: 20px; }\n              .policy-section ul, .policy-section ol { padding-left: 20px; }\n              .policy-section li { margin-bottom: 5px; line-height: 1.6; }\n            `,\n            title: '退換貨規則'\n          })\n        }\n      } catch (error) {\n        console.error('獲取 return 頁面失敗:', error)\n        \n        // 錯誤時也提供預設內容\n        setReturnPageData({\n          grapesHtml: `\n            <div class=\"error-message\">\n              <h3>無法載入退換貨規則</h3>\n              <p>請聯繫客服獲取詳細資訊</p>\n              <p>客服電話：0800-123-456</p>\n              <p>客服信箱：service@example.com</p>\n            </div>\n          `,\n          grapesCss: `\n            .error-message { padding: 20px; text-align: center; color: #666; }\n            .error-message h3 { color: #e74c3c; margin-bottom: 15px; }\n            .error-message p { margin: 8px 0; }\n          `,\n          title: '退換貨規則'\n        })\n      } finally {\n        setLoading(false)\n      }\n    }\n\n    fetchReturnPage()\n  }, [])\n\n\n\n  if (loading) {\n    return (\n      <div className=\"text-small-regular py-8 max-h-96 overflow-y-auto\">\n        <div className=\"animate-pulse flex items-center space-x-2\">\n          <div className=\"w-4 h-4 bg-gray-300 rounded-full animate-bounce\"></div>\n          <span>載入退換貨規則中...</span>\n        </div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"text-small-regular py-8 max-h-96 overflow-y-auto\">\n      {returnPageData ? (\n        <div>\n          {/* 嵌入 return 頁面的 CSS */}\n          {returnPageData.grapesCss && (\n            <style dangerouslySetInnerHTML={{ __html: returnPageData.grapesCss }} />\n          )}\n          \n          {/* 確保字體樣式一致的額外 CSS */}\n          <style dangerouslySetInnerHTML={{ __html: `\n            .return-page-content {\n              font-family: Inter, system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n              font-size: 14px;\n              line-height: 1.6;\n              color: #374151;\n            }\n            .return-page-content h2 {\n              font-family: inherit;\n              font-weight: 600;\n              font-size: 1.25rem;\n              color: #111827;\n              margin-top: 1.5rem;\n              margin-bottom: 1rem;\n              border-bottom: 1px solid #e5e7eb;\n              padding-bottom: 0.5rem;\n            }\n            .return-page-content p {\n              font-family: inherit;\n              font-size: 14px;\n              line-height: 1.6;\n              color: #374151;\n              margin-bottom: 0.75rem;\n            }\n            .return-page-content ol {\n              margin: 1rem 0;\n              padding-left: 1.5rem;\n            }\n            .return-page-content li {\n              font-family: inherit;\n              font-size: 14px;\n              line-height: 1.6;\n              color: #374151;\n              margin-bottom: 0.5rem;\n            }\n          ` }} />\n          \n          {/* 嵌入 return 頁面的 HTML 內容 */}\n          <div \n            dangerouslySetInnerHTML={{ __html: returnPageData.grapesHtml }}\n            className=\"return-page-content prose prose-gray max-w-none\n                       [&>h2]:text-xl [&>h2]:font-semibold [&>h2]:text-gray-900 [&>h2]:mb-4 [&>h2]:mt-6 [&>h2]:border-b [&>h2]:border-gray-200 [&>h2]:pb-2\n                       [&>p]:text-gray-700 [&>p]:leading-relaxed [&>p]:mb-3 [&>p]:text-sm\n                       [&>ol]:pl-6 [&>ol]:space-y-2 [&>ol]:my-4\n                       [&>li]:text-gray-700 [&>li]:leading-relaxed [&>li]:text-sm [&>li]:mb-2\n                       [&>h3]:text-lg [&>h3]:font-medium [&>h3]:text-gray-800 [&>h3]:mb-3 [&>h3]:mt-4\"\n            style={{ minHeight: '100px', fontFamily: 'inherit' }}\n          />\n\n        </div>\n      ) : (\n        <div className=\"text-center text-gray-500 py-8\">\n          <p>退換貨規則內容載入失敗</p>\n          <p className=\"text-sm mt-2\">請聯繫客服獲取詳細資訊</p>\n          <p className=\"text-xs mt-4\">客服電話：0800-123-456</p>\n        </div>\n      )}\n    </div>\n  )\n}\n\nexport default ShippingInfoTab\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/products/components/store-name.tsx","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":17,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":17,"endColumn":24,"suggestions":[{"fix":{"range":[427,450],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":21,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":21,"endColumn":22,"suggestions":[{"fix":{"range":[525,557],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport React, { useEffect, useState } from \"react\"\n\n// 客戶端店名顯示組件\nconst StoreName = () => {\n  const [storeName, setStoreName] = useState(\"Loading...\")\n\n  useEffect(() => {\n    const fetchStoreName = async () => {\n      try {\n        const response = await fetch('/api/store-name')\n        if (response.ok) {\n          const data = await response.json()\n          setStoreName(data.name)\n        } else {\n          console.error('獲取店名失敗')\n          setStoreName(\"SALON\")\n        }\n      } catch (error) {\n        console.error('獲取店名時出錯:', error)\n        setStoreName(\"SALON\")\n      }\n    }\n\n    fetchStoreName()\n  }, [])\n\n  return (\n    <div className=\"uppercase text-xs tracking-widest text-gray-500\">{storeName}</div>\n  )\n}\n\nexport default StoreName\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/products/components/thumbnail/index.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":10,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[268,271],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[268,271],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":25,"column":34,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":25,"endColumn":36,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[596,598],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Container, clx } from \"@medusajs/ui\"\nimport Image from \"next/image\"\nimport React from \"react\"\n\nimport PlaceholderImage from \"@modules/common/icons/placeholder-image\"\n\ntype ThumbnailProps = {\n  thumbnail?: string | null\n  // TODO: Fix image typings\n  images?: any[] | null\n  size?: \"small\" | \"medium\" | \"large\" | \"full\" | \"square\"\n  isFeatured?: boolean\n  className?: string\n  \"data-testid\"?: string\n}\n\nconst Thumbnail: React.FC<ThumbnailProps> = ({\n  thumbnail,\n  images,\n  size = \"small\",\n  isFeatured,\n  className,\n  \"data-testid\": dataTestid,\n}) => {\n  const initialImage = thumbnail || images?.[0]?.url\n\n  return (\n    <Container\n      className={clx(\n        \"relative w-full overflow-hidden p-4 bg-ui-bg-subtle shadow-elevation-card-rest rounded-large group-hover:shadow-elevation-card-hover transition-shadow ease-in-out duration-150\",\n        className,\n        {\n          \"aspect-[11/14]\": isFeatured,\n          \"aspect-[9/16]\": !isFeatured && size !== \"square\",\n          \"aspect-[1/1]\": size === \"square\",\n          \"w-[180px]\": size === \"small\",\n          \"w-[290px]\": size === \"medium\",\n          \"w-[440px]\": size === \"large\",\n          \"w-full\": size === \"full\",\n        }\n      )}\n      data-testid={dataTestid}\n    >\n      <ImageOrPlaceholder image={initialImage} size={size} />\n    </Container>\n  )\n}\n\nconst ImageOrPlaceholder = ({\n  image,\n  size,\n}: Pick<ThumbnailProps, \"size\"> & { image?: string }) => {\n  return image ? (\n    <Image\n      src={image}\n      alt=\"Thumbnail\"\n      className=\"absolute inset-0 object-cover object-center\"\n      draggable={false}\n      quality={50}\n      sizes=\"(max-width: 576px) 280px, (max-width: 768px) 360px, (max-width: 992px) 480px, 800px\"\n      fill\n    />\n  ) : (\n    <div className=\"w-full h-full absolute inset-0 flex items-center justify-center\">\n      <PlaceholderImage size={size === \"small\" ? 16 : 24} />\n    </div>\n  )\n}\n\nexport default Thumbnail\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/products/templates/index.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ProductInfoTab' is defined but never used.","line":7,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":22},{"ruleId":"unused-imports/no-unused-imports","severity":2,"message":"'ProductInfoTab' is defined but never used.","line":7,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":22,"fix":{"range":[329,404],"text":""}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":13,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[657,660],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[657,660],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":14,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[671,674],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[671,674],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":23,"column":7,"nodeType":null,"messageId":"preferOptionalChain","endLine":23,"endColumn":30,"fix":{"range":[809,832],"text":"!product?.id"}},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":66,"column":51,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":66,"endColumn":53,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2382,2384],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":2,"fixableWarningCount":0,"source":"import React, { Suspense } from \"react\"\n\nimport ImageGallery from \"@modules/products/components/image-gallery\"\nimport ProductActions from \"@modules/products/components/product-actions\"\nimport RelatedProducts from \"@modules/products/components/related-products\"\nimport ProductTabs from \"@modules/products/components/product-tabs\"\nimport ProductInfoTab from \"@modules/products/components/product-info-tab\"\nimport SkeletonRelatedProducts from \"@modules/skeletons/templates/skeleton-related-products\"\nimport { ProductActionProvider } from \"@lib/context/product-context\"\nimport StoreName from \"../components/store-name\"\n\ntype ProductTemplateProps = {\n  product: any\n  region: any\n  countryCode: string\n}\n\nconst ProductTemplate: React.FC<ProductTemplateProps> = ({\n  product,\n  region,\n  countryCode,\n}) => {\n  if (!product || !product.id) {\n    return <div>產品未找到</div>\n  }\n\n  return (\n    <div className=\"min-h-screen\">\n      {/* 麵包屑導航 - 緊湊設計 */}\n      <div className=\"bg-gray-50 border-b\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3\">\n          <nav className=\"flex text-sm\" aria-label=\"Breadcrumb\">\n            <ol className=\"flex items-center space-x-2\">\n              <li>\n                <a href=\"/\" className=\"text-gray-500 hover:text-gray-900 transition-colors\">\n                  首頁\n                </a>\n              </li>\n              {product.collection && (\n                <>\n                  <li className=\"text-gray-400\">/</li>\n                  <li>\n                    <a href={`/collections/${product.collection.handle}`} className=\"text-gray-500 hover:text-gray-900 transition-colors\">\n                      {product.collection.title}\n                    </a>\n                  </li>\n                </>\n              )}\n              <li className=\"text-gray-400\">/</li>\n              <li>\n                <span className=\"text-gray-900 font-medium\">\n                  {product.title}\n                </span>\n              </li>\n            </ol>\n          </nav>\n        </div>\n      </div>\n\n      {/* 主要商品區塊 */}\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\" data-testid=\"product-container\">\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-x-8 gap-y-10\">\n          \n          {/* 圖片區塊 - 左側 */}\n          <div className=\"lg:sticky lg:top-16 lg:self-start\">\n            <ImageGallery images={product?.images || []} />\n          </div>\n\n          {/* 產品資訊區塊 - 右側 */}\n          <div className=\"lg:max-w-lg\">\n            {/* 品牌 */}\n            <div className=\"mb-4\">\n              <StoreName />\n            </div>\n            \n            {/* 產品標題 */}\n            <h1 className=\"text-3xl font-bold text-gray-900 sm:text-4xl mb-4\">\n              {product.title}\n            </h1>\n            \n            {/* 產品副標題 */}\n            {product.subtitle && (\n              <p className=\"text-lg text-gray-600 mb-6\">{product.subtitle}</p>\n            )}\n\n            {/* 購買操作區塊 */}\n            <div className=\"mb-8\">\n              <ProductActionProvider>\n                <Suspense\n                  fallback={\n                    <div className=\"py-8 animate-pulse\">\n                      <div className=\"h-6 bg-gray-200 rounded mb-4\"></div>\n                      <div className=\"h-12 bg-gray-200 rounded mb-4\"></div>\n                      <div className=\"h-12 bg-gray-200 rounded\"></div>\n                    </div>\n                  }\n                >\n                  <ProductActions product={product} region={region} />\n                </Suspense>\n              </ProductActionProvider>\n            </div>\n\n            {/* 產品詳細資訊選單 */}\n            <div className=\"space-y-8\">\n              <div>\n                <ProductTabs product={product} />\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* 相關商品區塊 */}\n      <div className=\"bg-gray-50 py-16 mt-16\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\" data-testid=\"related-products-container\">\n          <div className=\"text-center mb-10\">\n            <h2 className=\"text-2xl font-bold text-gray-900 mb-4\">您可能也會喜歡</h2>\n            <p className=\"text-gray-600\">為您精心挑選的相關商品</p>\n          </div>\n          <Suspense fallback={<SkeletonRelatedProducts />}>\n            <RelatedProducts product={product} countryCode={countryCode} />\n          </Suspense>\n        </div>\n      </div>\n    </div>\n  )\n}\n\nexport default ProductTemplate","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/products/templates/product-actions-wrapper/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/products/templates/product-info/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/shipping/components/free-shipping-price-nudge/index.tsx","messages":[{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":20,"column":21,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":22,"endColumn":5},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":20,"column":40,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":20,"endColumn":42,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[578,580],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":103,"column":30,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":103,"endColumn":32,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[3289,3291],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":243,"column":52,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":243,"endColumn":54,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[7400,7402],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { convertToLocale } from \"@lib/util/money\"\nimport { CheckCircleSolid, XMark } from \"@medusajs/icons\"\nimport {\n  HttpTypes,\n  StoreCart,\n  StoreCartShippingOption,\n  StorePrice,\n} from \"@medusajs/types\"\nimport { Button, clx } from \"@medusajs/ui\"\nimport LocalizedClientLink from \"@modules/common/components/localized-client-link\"\nimport { useState } from \"react\"\nimport { StoreFreeShippingPrice } from \"../../../../types/global\"\n\nconst computeTarget = (\n  cart: HttpTypes.StoreCart,\n  price: HttpTypes.StorePrice\n) => {\n  const priceRule = (price.price_rules || []).find(\n    (pr) => pr.attribute === \"item_total\"\n  )!\n\n  const currentAmount = cart.item_total\n  const targetAmount = parseFloat(priceRule.value)\n\n  if (priceRule.operator === \"gt\") {\n    return {\n      current_amount: currentAmount,\n      target_amount: targetAmount,\n      target_reached: currentAmount > targetAmount,\n      target_remaining:\n        currentAmount > targetAmount ? 0 : targetAmount + 1 - currentAmount,\n      remaining_percentage: (currentAmount / targetAmount) * 100,\n    }\n  } else if (priceRule.operator === \"gte\") {\n    return {\n      current_amount: currentAmount,\n      target_amount: targetAmount,\n      target_reached: currentAmount > targetAmount,\n      target_remaining:\n        currentAmount > targetAmount ? 0 : targetAmount - currentAmount,\n      remaining_percentage: (currentAmount / targetAmount) * 100,\n    }\n  } else if (priceRule.operator === \"lt\") {\n    return {\n      current_amount: currentAmount,\n      target_amount: targetAmount,\n      target_reached: targetAmount > currentAmount,\n      target_remaining:\n        targetAmount > currentAmount ? 0 : currentAmount + 1 - targetAmount,\n      remaining_percentage: (currentAmount / targetAmount) * 100,\n    }\n  } else if (priceRule.operator === \"lte\") {\n    return {\n      current_amount: currentAmount,\n      target_amount: targetAmount,\n      target_reached: targetAmount > currentAmount,\n      target_remaining:\n        targetAmount > currentAmount ? 0 : currentAmount - targetAmount,\n      remaining_percentage: (currentAmount / targetAmount) * 100,\n    }\n  } else {\n    return {\n      current_amount: currentAmount,\n      target_amount: targetAmount,\n      target_reached: currentAmount === targetAmount,\n      target_remaining:\n        targetAmount > currentAmount ? 0 : targetAmount - currentAmount,\n      remaining_percentage: (currentAmount / targetAmount) * 100,\n    }\n  }\n}\n\nexport default function ShippingPriceNudge({\n  variant = \"inline\",\n  cart,\n  shippingOptions,\n}: {\n  variant?: \"popup\" | \"inline\"\n  cart: StoreCart\n  shippingOptions: StoreCartShippingOption[]\n}) {\n  if (!cart || !shippingOptions?.length) {\n    return\n  }\n\n  // Check if any shipping options have a conditional price based on item_total\n  const freeShippingPrice = shippingOptions\n    .map((shippingOption) => {\n      const calculatedPrice = shippingOption.calculated_price\n\n      if (!calculatedPrice) {\n        return\n      }\n\n      // Get all prices that are:\n      // 1. Currency code is same as the cart's\n      // 2. Have a rule that is set on item_total\n      const validCurrencyPrices = shippingOption.prices.filter(\n        (price) =>\n          price.currency_code === cart.currency_code &&\n          (price.price_rules || []).some(\n            (priceRule) => priceRule.attribute === \"item_total\"\n          )\n      )\n\n      return validCurrencyPrices.map((price) => {\n        return {\n          ...price,\n          shipping_option_id: shippingOption.id,\n          ...computeTarget(cart, price),\n        }\n      })\n    })\n    .flat(1)\n    .filter(Boolean)\n    // We focus here entirely on free shipping, but this can be edited to handle multiple layers\n    // of reduced shipping prices.\n    .find((price) => price?.amount === 0)\n\n  if (!freeShippingPrice) {\n    return\n  }\n\n  if (variant === \"popup\") {\n    return <FreeShippingPopup cart={cart} price={freeShippingPrice} />\n  } else {\n    return <FreeShippingInline cart={cart} price={freeShippingPrice} />\n  }\n}\n\nfunction FreeShippingInline({\n  cart,\n  price,\n}: {\n  cart: StoreCart\n  price: StorePrice & {\n    target_reached: boolean\n    target_remaining: number\n    remaining_percentage: number\n  }\n}) {\n  return (\n    <div className=\"bg-neutral-100 p-2 rounded-lg border\">\n      <div className=\"space-y-1.5\">\n        <div className=\"flex justify-between text-xs text-neutral-600\">\n          <div>\n            {price.target_reached ? (\n              <div className=\"flex items-center gap-1.5\">\n                <CheckCircleSolid className=\"text-green-500 inline-block\" />{\" \"}\n                Free Shipping unlocked!\n              </div>\n            ) : (\n              `Unlock Free Shipping`\n            )}\n          </div>\n\n          <div\n            className={clx(\"visible\", {\n              \"opacity-0 invisible\": price.target_reached,\n            })}\n          >\n            Only{\" \"}\n            <span className=\"text-neutral-950\">\n              {convertToLocale({\n                amount: price.target_remaining,\n                currency_code: cart.currency_code,\n              })}\n            </span>{\" \"}\n            away\n          </div>\n        </div>\n        <div className=\"flex justify-between gap-1\">\n          <div\n            className={clx(\n              \"bg-gradient-to-r from-zinc-400 to-zinc-500 h-1 rounded-full max-w-full duration-500 ease-in-out\",\n              {\n                \"from-green-400 to-green-500\": price.target_reached,\n              }\n            )}\n            style={{ width: `${price.remaining_percentage}%` }}\n          ></div>\n          <div className=\"bg-neutral-300 h-1 rounded-full w-fit flex-grow\"></div>\n        </div>\n      </div>\n    </div>\n  )\n}\n\nfunction FreeShippingPopup({\n  cart,\n  price,\n}: {\n  cart: StoreCart\n  price: StoreFreeShippingPrice\n}) {\n  const [isClosed, setIsClosed] = useState(false)\n\n  return (\n    <div\n      className={clx(\n        \"fixed bottom-5 right-5 flex flex-col items-end gap-2 transition-all duration-500 ease-in-out z-10\",\n        {\n          \"opacity-0 invisible delay-1000\": price.target_reached,\n          \"opacity-0 invisible\": isClosed,\n          \"opacity-100 visible\": !price.target_reached && !isClosed,\n        }\n      )}\n    >\n      <div>\n        <Button\n          className=\"rounded-full bg-neutral-900 shadow-none outline-none border-none text-[15px] p-2\"\n          onClick={() => setIsClosed(true)}\n        >\n          <XMark />\n        </Button>\n      </div>\n\n      <div className=\"w-[400px] bg-black text-white p-6 rounded-lg \">\n        <div className=\"pb-4\">\n          <div className=\"space-y-3\">\n            <div className=\"flex justify-between text-[15px] text-neutral-400\">\n              <div>\n                {price.target_reached ? (\n                  <div className=\"flex items-center gap-1.5\">\n                    <CheckCircleSolid className=\"text-green-500 inline-block\" />{\" \"}\n                    Free Shipping unlocked!\n                  </div>\n                ) : (\n                  `Unlock Free Shipping`\n                )}\n              </div>\n\n              <div\n                className={clx(\"visible\", {\n                  \"opacity-0 invisible\": price.target_reached,\n                })}\n              >\n                Only{\" \"}\n                <span className=\"text-white\">\n                  {convertToLocale({\n                    amount: price.target_remaining || 0,  // 添加默認值處理\n                    currency_code: cart.currency_code,\n                  })}\n                </span>{\" \"}\n                away\n              </div>\n            </div>\n            <div className=\"flex justify-between gap-1\">\n              <div\n                className={clx(\n                  \"bg-gradient-to-r from-zinc-400 to-zinc-500 h-1.5 rounded-full max-w-full duration-500 ease-in-out\",\n                  {\n                    \"from-green-400 to-green-500\": price.target_reached,\n                  }\n                )}\n                style={{ width: `${price.remaining_percentage}%` }}\n              ></div>\n              <div className=\"bg-zinc-600 h-1.5 rounded-full w-fit flex-grow\"></div>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"flex gap-3\">\n          <LocalizedClientLink\n            className=\"rounded-2xl bg-transparent shadow-none outline-none border-[1px] border-white text-[15px] py-2.5 px-4\"\n            href=\"/cart\"\n          >\n            View cart\n          </LocalizedClientLink>\n\n          <LocalizedClientLink\n            className=\"flex-grow rounded-2xl bg-white text-neutral-950 shadow-none outline-none border-[1px] border-white text-[15px] py-2.5 px-4 text-center\"\n            href=\"/store\"\n          >\n            View products\n          </LocalizedClientLink>\n        </div>\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/skeletons/components/skeleton-button/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/skeletons/components/skeleton-card-details/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/skeletons/components/skeleton-cart-item/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/skeletons/components/skeleton-cart-totals/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/skeletons/components/skeleton-code-form/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/skeletons/components/skeleton-line-item/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/skeletons/components/skeleton-order-confirmed-header/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/skeletons/components/skeleton-order-information/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/skeletons/components/skeleton-order-items/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/skeletons/components/skeleton-order-summary/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/skeletons/components/skeleton-product-preview/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/skeletons/templates/skeleton-cart-page/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/skeletons/templates/skeleton-order-confirmed/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/skeletons/templates/skeleton-product-grid/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/skeletons/templates/skeleton-related-products/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/store/components/infinite-products.tsx","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":67,"column":51,"nodeType":"MemberExpression","messageId":"unexpected","endLine":67,"endColumn":64}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { useEffect, useState } from \"react\"\nimport { listProducts } from \"@lib/data/products\"\nimport ProductPreview from \"../../products/components/product-preview/index\"\nimport { HttpTypes } from \"@medusajs/types\"\nimport { convertToStandardProducts } from \"../../../lib/util/product-type-converter\"\n\nconst LIMIT = 12\n\ntype InfiniteProductsProps = {\n  initialProducts: HttpTypes.StoreProduct[]\n  params: {\n    countryCode: string\n    queryParams?: HttpTypes.FindParams & HttpTypes.StoreProductParams\n  }\n  totalCount: number\n}\n\nexport default function InfiniteProducts({\n  initialProducts,\n  params,\n  totalCount,\n}: InfiniteProductsProps) {\n  const [products, setProducts] = useState(initialProducts)\n  const [hasMore, setHasMore] = useState(initialProducts.length < totalCount)\n  const [isLoading, setIsLoading] = useState(false)\n  const [pageParam, setPageParam] = useState(2) // 從第2頁開始，因為第1頁已經載入\n\n  // 簡單的 intersection observer\n  const [observerTarget, setObserverTarget] = useState<HTMLDivElement | null>(null)\n\n  useEffect(() => {\n    if (!observerTarget) return\n\n    const observer = new IntersectionObserver(\n      (entries) => {\n        if (entries[0].isIntersecting && hasMore && !isLoading) {\n          fetchMoreProducts()\n        }\n      },\n      { threshold: 0.1 }\n    )\n\n    observer.observe(observerTarget)\n    return () => observer.disconnect()\n  }, [observerTarget, hasMore, isLoading])\n\n  const fetchMoreProducts = async () => {\n    setIsLoading(true)\n    try {\n      const { response } = await listProducts({\n        pageParam,\n        countryCode: params.countryCode,\n        queryParams: {\n          ...params.queryParams,\n          limit: LIMIT,\n        },\n      })\n\n      // 轉換產品類型以匹配 HttpTypes.StoreProduct\n      const standardProducts = convertToStandardProducts(response.products)\n      setProducts((prev) => [...prev, ...standardProducts])\n      setPageParam((prev) => prev + 1)\n      setHasMore(products.length + response.products.length < totalCount)\n    } catch (error) {\n      if (process.env.NODE_ENV === 'development') console.error(\"載入更多商品時出錯:\", error)\n    } finally {\n      setIsLoading(false)\n    }\n  }\n\n  return (\n    <div className=\"flex-1\">\n      <ul className=\"grid grid-cols-2 md:grid-cols-4 gap-0 w-full\">\n        {products.map((product) => (\n          <li key={product.id} className=\"w-full bg-white\">\n            <ProductPreview product={product} countryCode=\"tw\" />\n          </li>\n        ))}\n      </ul>\n      {hasMore && (\n        <div\n          className=\"py-16 flex items-center justify-center\"\n          ref={setObserverTarget}\n        >\n          {isLoading && (\n            <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900\"></div>\n          )}\n        </div>\n      )}\n      {!hasMore && products.length > 0 && (\n        <div className=\"py-16 text-center text-gray-500\">\n          已顯示所有商品\n        </div>\n      )}\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/store/components/pagination/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/store/components/refinement-list/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/store/components/refinement-list/sort-products/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/store/templates/index.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'page' is defined but never used.","line":11,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":7},{"ruleId":"unused-imports/no-unused-vars","severity":2,"message":"'page' is defined but never used. Allowed unused args must match /^_/u.","line":11,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":7},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":18,"column":23,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":18,"endColumn":25,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[496,498],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Suspense } from \"react\"\n\nimport SkeletonProductGrid from \"@modules/skeletons/templates/skeleton-product-grid\"\nimport { SortOptions } from \"@modules/store/components/refinement-list/sort-products\"\nimport RefinementList from \"@modules/store/components/refinement-list\"\n\nimport InfiniteScrollProducts from \"./infinite-scroll-products\"\n\nconst StoreTemplate = ({\n  sortBy,\n  page,\n  countryCode,\n}: {\n  sortBy?: SortOptions\n  page?: string\n  countryCode: string\n}) => {\n  const sort = sortBy || \"created_at\"\n\n  return (\n    <div className=\"pt-0 pb-8\" data-testid=\"store-container\">\n      {/* 標題區域 - 置中對齊 */}\n      <div className=\"px-4 md:px-8 lg:px-12 py-3 border-b border-gray-100 text-center\">\n        <h1 data-testid=\"store-page-title\" className=\"text-2xl font-semibold mb-1\">\n          所有商品\n        </h1>\n        <p className=\"text-base text-gray-600\">\n          探索我們的完整商品系列\n        </p>\n      </div>\n\n      {/* 篩選器區域 */}\n      <div className=\"px-4 md:px-8 lg:px-12 py-1 border-b border-gray-100\">\n        <RefinementList sortBy={sort} data-testid=\"sort-by-container\" />\n      </div>\n\n      <Suspense fallback={<SkeletonProductGrid />}>\n        <InfiniteScrollProducts\n          sortBy={sort}\n          countryCode={countryCode}\n        />\n      </Suspense>\n    </div>\n  )\n}\n\nexport default StoreTemplate\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/store/templates/infinite-scroll-products.tsx","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":17,"column":47,"nodeType":"MemberExpression","messageId":"unexpected","endLine":17,"endColumn":58},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":25,"column":49,"nodeType":"MemberExpression","messageId":"unexpected","endLine":25,"endColumn":60},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":29,"column":47,"nodeType":"MemberExpression","messageId":"unexpected","endLine":29,"endColumn":58},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":44,"column":47,"nodeType":"MemberExpression","messageId":"unexpected","endLine":44,"endColumn":58},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":54,"column":47,"nodeType":"MemberExpression","messageId":"unexpected","endLine":54,"endColumn":58}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { getRegion } from \"@lib/data/regions\"\nimport { listProducts } from \"@lib/data/products\"\nimport { SortOptions } from \"../components/refinement-list/sort-products/index\"\nimport { sortProducts } from \"@lib/util/sort-products\"\nimport InfiniteProducts from \"../components/infinite-products\"\nimport { convertToStandardProducts } from \"../../../lib/util/product-type-converter\"\n\nconst PRODUCT_LIMIT = 12\n\nexport default async function InfiniteScrollProducts({\n  sortBy,\n  countryCode,\n}: {\n  sortBy: SortOptions\n  countryCode: string\n}) {\n  if (process.env.NODE_ENV === 'development') console.log(\"🏪 InfiniteScrollProducts called with:\", {\n    sortBy,\n    countryCode\n  })\n\n  const region = await getRegion(countryCode)\n\n  if (!region) {\n    if (process.env.NODE_ENV === 'development') console.log(\"🏪 InfiniteScrollProducts - No region found for:\", countryCode)\n    return null\n  }\n\n  if (process.env.NODE_ENV === 'development') console.log(\"🏪 InfiniteScrollProducts - Region found:\", {\n    id: region.id,\n    name: region.name\n  })\n\n  const {\n    response: { products, count },\n  } = await listProducts({\n    pageParam: 1,\n    queryParams: {\n      limit: PRODUCT_LIMIT,\n    },\n    countryCode,\n  })\n\n  if (process.env.NODE_ENV === 'development') console.log(\"🏪 InfiniteScrollProducts - Products loaded:\", {\n    count: products?.length,\n    totalCount: count,\n    productIds: products?.map(p => p.id)\n  })\n\n  // 先排序再轉換類型\n  const sortedLocalProducts = sortProducts(products, sortBy)\n  const sortedProducts = convertToStandardProducts(sortedLocalProducts)\n\n  if (process.env.NODE_ENV === 'development') console.log(\"🏪 InfiniteScrollProducts - Products sorted:\", {\n    sortBy,\n    sortedCount: sortedProducts?.length\n  })\n\n  return (\n    <InfiniteProducts\n      initialProducts={sortedProducts}\n      params={{\n        countryCode,\n        queryParams: {\n          limit: PRODUCT_LIMIT,\n        },\n      }}\n      totalCount={count}\n    />\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/modules/store/templates/paginated-products.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":38,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[957,960],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[957,960],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":89,"column":42,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":89,"endColumn":44,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2166,2168],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { listProductsWithSort } from \"@lib/data/products\"\nimport { getRegion } from \"@lib/data/regions\"\nimport ProductPreview from \"../../products/components/product-preview\"\nimport { Pagination } from \"../components/pagination\"\nimport { SortOptions } from \"../components/refinement-list/sort-products/index\"\nimport RefinementList from \"../components/refinement-list\"\nimport { useEffect, useState } from \"react\"\n\nconst PRODUCT_LIMIT = 12\n\ntype PaginatedProductsParams = {\n  limit: number\n  collection_id?: string[]\n  category_id?: string[]\n  id?: string[]\n  order?: string\n}\n\nexport default function PaginatedProducts({\n  sortBy,\n  page,\n  collectionId,\n  categoryId,\n  productsIds,\n  countryCode,\n  hideRefinementList = false,\n}: {\n  sortBy?: SortOptions\n  page: number\n  collectionId?: string\n  categoryId?: string\n  productsIds?: string[]\n  countryCode: string\n  hideRefinementList?: boolean\n}) {\n  const [products, setProducts] = useState<any[]>([])\n  const [totalPages, setTotalPages] = useState(0)\n\n  useEffect(() => {\n    const fetchProducts = async () => {\n      const queryParams: PaginatedProductsParams = {\n        limit: 12,\n      }\n\n      if (collectionId) {\n        queryParams[\"collection_id\"] = [collectionId]\n      }\n\n      if (categoryId) {\n        queryParams[\"category_id\"] = [categoryId]\n      }\n\n      if (productsIds) {\n        queryParams[\"id\"] = productsIds\n      }\n\n      if (sortBy === \"created_at\") {\n        queryParams[\"order\"] = \"created_at\"\n      }\n\n      const region = await getRegion(countryCode)\n\n      if (!region) {\n        return\n      }\n\n      const {\n        response: { products: fetchedProducts, count },\n      } = await listProductsWithSort({\n        page,\n        queryParams,\n        sortBy,\n        countryCode,\n      })\n\n      setProducts(fetchedProducts)\n      setTotalPages(Math.ceil(count / PRODUCT_LIMIT))\n    }\n\n    fetchProducts()\n  }, [collectionId, categoryId, productsIds, sortBy, page, countryCode])\n\n  return (\n    <div className=\"flex flex-col\">\n      {!hideRefinementList && (\n        <div className=\"mb-8 px-4 md:px-8 lg:px-12 flex justify-center\">\n          <RefinementList sortBy={sortBy || \"created_at\"} />\n        </div>\n      )}\n      <div>\n        <ul\n          className=\"grid grid-cols-2 md:grid-cols-4 gap-0 w-full bg-white\"\n          data-testid=\"products-list\"\n        >\n          {products.map((p) => {\n            return (\n              <li key={p.id} className=\"w-full\">\n                <ProductPreview product={p} countryCode=\"tw\" />\n              </li>\n            )\n          })}\n        </ul>\n        {totalPages > 1 && !hideRefinementList && (\n          <div className=\"mt-8 px-4 md:px-8 lg:px-12 flex justify-center\">\n            <Pagination\n              data-testid=\"product-pagination\"\n              page={page}\n              totalPages={totalPages}\n            />\n          </div>\n        )}\n        {totalPages > 1 && hideRefinementList && (\n          <div className=\"mt-8 flex justify-center\">\n            <Pagination\n              data-testid=\"product-pagination\"\n              page={page}\n              totalPages={totalPages}\n            />\n          </div>\n        )}\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/queries/fragments.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/queries/service-card-section.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/queries/service-cards.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/sanity-client/client.ts","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":4,"column":56,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":4,"endColumn":58,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[153,155],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":5,"column":51,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":5,"endColumn":53,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[218,220],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { ClientConfig, createClient } from '@sanity/client'\n\nconst sanityConfig: ClientConfig = {\n  projectId: process.env.NEXT_PUBLIC_SANITY_PROJECT_ID || 'm7o2mv1n',\n  dataset: process.env.NEXT_PUBLIC_SANITY_DATASET || 'production',\n  apiVersion: '2023-05-30',\n  useCdn: true,\n  perspective: 'published' as const\n}\n\nif (!sanityConfig.projectId) {\n  throw new Error('未設定 Sanity Project ID')\n}\n\nexport const client = createClient(sanityConfig)","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/sanity-client/image.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/sanity-client/index.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":9,"column":3,"nodeType":"MemberExpression","messageId":"unexpected","endLine":9,"endColumn":15,"suggestions":[{"fix":{"range":[322,395],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":10,"column":3,"nodeType":"MemberExpression","messageId":"unexpected","endLine":10,"endColumn":15,"suggestions":[{"fix":{"range":[398,471],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":18,"column":22,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":18,"endColumn":24,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[727,729],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":51,"column":49,"nodeType":"MemberExpression","messageId":"unexpected","endLine":51,"endColumn":62},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":66,"column":49,"nodeType":"MemberExpression","messageId":"unexpected","endLine":66,"endColumn":62}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createClient } from 'next-sanity'\nimport { BlogPostType, CategoryType } from './types'\n\n// 檢查 token 並提供開發時警告\nconst publicToken = process.env.NEXT_PUBLIC_SANITY_TOKEN\nconst serverToken = process.env.SANITY_API_TOKEN\n\nif (typeof window === 'undefined' && !serverToken && process.env.NODE_ENV === 'development') {\n  console.warn('⚠️ [Sanity] 缺少 SANITY_API_TOKEN 環境變數，server-side 寫入功能將受限。')\n  console.warn('📝 請在 .env.local 中加入: SANITY_API_TOKEN=你的_sanity_寫入_token')\n}\n\nexport const client = createClient({\n  projectId: process.env.NEXT_PUBLIC_SANITY_PROJECT_ID,\n  dataset: process.env.NEXT_PUBLIC_SANITY_DATASET,\n  apiVersion: \"2024-01-01\",\n  useCdn: !serverToken, // 如果沒有 server token，則使用 CDN（只讀模式）\n  token: publicToken || serverToken, // 支援兩種 token 名稱\n})\n\nexport async function getAllPosts(category?: string, limit: number = 50): Promise<BlogPostType[]> {\n  try {\n    // 建立基本查詢\n    const baseQuery = `*[_type == \"post\"`\n    const categoryFilter = category ? ` && \"${category}\" in categories[]->title` : \"\"\n    const query = `${baseQuery}${categoryFilter}] | order(publishedAt desc) [0...${limit}] {\n      title,\n      slug,\n      mainImage {\n        asset->{\n          url\n        }\n      },\n      publishedAt,\n      excerpt,\n      categories[]->{\n        _id,\n        title\n      },\n      author->{\n        name,\n        image\n      },\n      status,\n      _id\n    }`\n\n    const posts = await client.fetch<BlogPostType[]>(query)\n    return posts || []\n  } catch (error) {\n    if (process.env.NODE_ENV === 'development') console.error('[getAllPosts] 從 Sanity 獲取部落格文章時發生錯誤:', error)\n    return []\n  }\n}\n\nexport async function getCategories(): Promise<CategoryType[]> {\n  try {\n    const query = `*[_type == \"category\"] {\n      _id,\n      title\n    }`\n    \n    const categories = await client.fetch<CategoryType[]>(query)\n    return categories || []\n  } catch (error) {\n    if (process.env.NODE_ENV === 'development') console.error('[getCategories] 從 Sanity 獲取分類時發生錯誤:', error)\n    return []\n  }\n}\n\n// 為了向後兼容，添加默認導出\nexport default client\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/sanity-client/lib/client.ts","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":4,"column":56,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":4,"endColumn":58,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[139,141],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":5,"column":51,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":5,"endColumn":53,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[204,206],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createClient } from '@sanity/client'\n\nexport const client = createClient({\n  projectId: process.env.NEXT_PUBLIC_SANITY_PROJECT_ID || 'm7o2mv1n',\n  dataset: process.env.NEXT_PUBLIC_SANITY_DATASET || 'production',\n  apiVersion: '2024-08-26',\n  useCdn: process.env.NODE_ENV === 'production'\n})\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/sanity-client/types.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":28,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[433,436],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[433,436],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"export interface SanityImageAsset {\n  _id: string;\n  url: string;\n}\n\nexport interface SanityImage {\n  asset: SanityImageAsset;\n}\n\nexport interface BlogPostType {\n  _id: string;\n  title: string;\n  slug: {\n    current: string;\n  };\n  mainImage: {\n    asset: {\n      url: string;\n    };\n  };\n  publishedAt: string;\n  categories?: CategoryType[];\n  excerpt?: string;\n  author?: {\n    name: string;\n    image?: SanityImage;\n  };\n  body?: any; // PortableText content\n  status?: string;\n}\n\nexport interface CategoryType {\n  _id: string;\n  title: string;\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/sanity-client/utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/services/get-service-cards.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":52,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":52,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1042,1045],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1042,1045],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":55,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1118,1121],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1118,1121],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":56,"column":39,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":56,"endColumn":41,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1163,1165],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":58,"column":51,"nodeType":"MemberExpression","messageId":"unexpected","endLine":58,"endColumn":63},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":68,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":68,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1594,1597],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1594,1597],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":71,"column":30,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":71,"endColumn":32,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1676,1678],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import client from \"../lib/sanity\"\n\nexport type ServiceCardType = {\n  title: string\n  englishTitle: string\n  stylists: {\n    levelName: string\n    price: number\n    stylistName?: string\n    cardImage?: {\n      url: string\n      alt?: string\n    }\n  }[]\n}\n\nexport type ServiceCardsType = {\n  isActive: boolean\n  heading?: string\n  subheading?: string\n  cardsPerRow: number\n  cards: ServiceCardType[]\n}\n\nexport async function getServiceCards(): Promise<ServiceCardsType | null> {\n  if (!client) throw new Error('Sanity client is not configured')\n\n  const query = `*[_type == \"homePage\"][0] {\n    mainSections[] {\n      _type == \"serviceCardSection\" => {\n        isActive,\n        heading,\n        subheading,\n        cardsPerRow,\n        cards[] {\n          title,\n          englishTitle,\n          stylists[] {\n            levelName,\n            price,\n            stylistName,\n            \"cardImage\": cardImage {\n              \"url\": asset->url,\n              \"alt\": alt\n            }\n          }\n        }\n      }\n    }\n  }`\n\n  let result: any = null\n  try {\n    result = await client.fetch(query)\n  } catch (error: any) {\n    const msg = String(error?.message || error)\n    if (error?.name === 'AbortError' || msg.includes('The user aborted a request') || msg.includes('signal is aborted')) {\n      if (process.env.NODE_ENV === 'development') console.warn('Sanity fetch aborted (handled) in getServiceCards:', msg)\n      result = null\n    } else {\n      throw error\n    }\n  }\n  \n  if (!result?.mainSections) return null\n\n  const serviceCardsSection = result.mainSections.find(\n    (section: any) => section?._type === 'serviceCardSection'\n  )\n\n  return serviceCardsSection || null\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/types/affiliate-admin.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/types/affiliate.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/types/ecpay_aio_nodejs.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/types/footer.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/types/global.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":30,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[464,467],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[464,467],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":138,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":138,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2308,2311],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2308,2311],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":139,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":139,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2321,2324],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2321,2324],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// 全域型別定義\nimport { HttpTypes } from '@medusajs/types'\n\n// Sanity 相關型別\nexport interface FeaturedProduct {\n  id: string\n  title: string\n  handle: string\n  thumbnail?: string\n  price?: number\n  currency_code?: string\n}\n\nexport interface BlogPost {\n  _id: string\n  title: string\n  slug: {\n    current: string\n  }\n  publishedAt: string\n  _createdAt: string\n  mainImage?: {\n    asset: {\n      url: string\n    }\n  }\n  categories?: Array<{\n    title: string\n  }>\n  body?: any[]\n  status?: string\n}\n\n// Cart 型別\nexport interface Cart {\n  id: string\n  items: CartItem[]\n  region?: HttpTypes.StoreRegion\n  total: number\n  subtotal: number\n  tax_total?: number\n  shipping_total?: number\n  created_at: string\n  updated_at: string\n}\n\nexport interface CartItem {\n  id: string\n  title: string\n  description?: string\n  quantity: number\n  unit_price: number\n  total: number\n  variant?: {\n    id: string\n    title: string\n    sku?: string\n  }\n  thumbnail?: string\n}\n\n// 產品型別擴展\nexport interface ProductExtended {\n  collection_id?: string\n  tags?: HttpTypes.StoreProductTag[]\n}\n\n// 產品查詢參數擴展\nexport interface StoreProductParamsExtended extends HttpTypes.StoreProductParams {\n  collection_id?: string[]\n  tag_id?: string[]  // 修正為 string[] 類型\n  is_giftcard?: boolean\n  id?: string[]\n}\n\n// 地區轉換函數\nexport interface Region {\n  id: string\n  name: string\n  currency_code: string\n  countries: Array<{\n    id: string\n    iso_2: string\n    display_name: string\n  }>\n}\n\n// Sanity Header 型別\nexport interface SanityHeader {\n  _id: string\n  title?: string\n  navigation?: NavigationItem[]\n  logo?: SanityImage\n  favicon?: SanityImage\n  showSearch?: boolean\n  storeName?: string\n  logoWidth?: number\n  logoHeight?: number\n  logoSize?: {\n    desktop?: number\n    mobile?: number\n  }\n  marquee?: {\n    enabled?: boolean\n    text1?: {\n      enabled?: boolean\n      content?: string\n    }\n    text2?: {\n      enabled?: boolean\n      content?: string\n    }\n    text3?: {\n      enabled?: boolean\n      content?: string\n    }\n    linkUrl?: string\n    pauseOnHover?: boolean\n  }\n}\n\nexport interface NavigationItem {\n  _key: string\n  title: string\n  name: string\n  url?: string\n  href: string\n  submenu?: NavigationItem[]\n}\n\nexport interface SanityImage {\n  _type: 'image'\n  asset: {\n    _ref: string\n    _type: 'reference'\n  }\n  alt?: string\n  hotspot?: any\n  crop?: any\n  url?: string\n}\n\n// 價格相關型別\nexport interface VariantPrice {\n  currency_code: string\n  amount: number\n  calculated_amount?: number\n  original_amount?: number\n  calculated_price?: string\n  original_price?: string\n  calculated_price_number?: number\n  original_price_number?: number\n  price_type?: 'sale' | 'regular'\n  percentage_diff?: string\n}\n\nexport interface StoreFreeShippingPrice {\n  amount: number\n  currency_code: string\n  target_reached?: boolean\n  target_remaining?: number\n  remaining_percentage?: number\n}\n\n// Footer 型別\nexport interface Footer {\n  _id: string\n  title?: string\n  sections?: FooterSection[]\n  contactInfo?: ContactInfo\n  social?: SocialLink[]\n  copyright?: string\n}\n\nexport interface FooterSection {\n  _key: string\n  title: string\n  links: FooterLink[]\n}\n\nexport interface FooterLink {\n  _key: string\n  title: string\n  url: string\n}\n\nexport interface ContactInfo {\n  phone?: string\n  email?: string\n  address?: string\n}\n\nexport interface SocialLink {\n  _key: string\n  platform: string\n  url: string\n}","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/types/icon.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/types/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/types/main-section.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/types/medusa-adapters.ts","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":51,"column":37,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":51,"endColumn":39,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1557,1559],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":60,"column":34,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":60,"endColumn":36,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1858,1860],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Medusa 類型適配器\n * 解決本地類型與官方 @medusajs/types 的兼容性問題\n */\n\nimport type { LocalHttpTypes } from './medusa-local'\n\n// 適配後的 StoreCountry - 將 num_code 轉換為 string\nexport interface AdaptedStoreCountry extends Omit<LocalHttpTypes.StoreCountry, 'num_code'> {\n  num_code: string; // 官方期望 string 類型\n}\n\n// 適配後的 StoreRegion - 使用適配的 StoreCountry\nexport interface AdaptedStoreRegion extends Omit<LocalHttpTypes.StoreRegion, 'countries'> {\n  countries?: AdaptedStoreCountry[];\n}\n\n// 適配後的 StoreCollection - metadata 可為 null\nexport interface AdaptedStoreCollection extends Omit<LocalHttpTypes.StoreCollection, 'metadata'> {\n  metadata: Record<string, unknown> | null;\n}\n\n// 適配後的 StoreProduct - 使用適配的 StoreCollection\nexport interface AdaptedStoreProduct extends Omit<LocalHttpTypes.StoreProduct, 'collection' | 'metadata'> {\n  collection?: AdaptedStoreCollection | null; // 支援 null\n  metadata: Record<string, unknown> | null;\n}\n\n// 類型轉換工具函數\nexport const typeAdapters = {\n  // StoreCountry 適配器\n  adaptStoreCountry(country: LocalHttpTypes.StoreCountry): AdaptedStoreCountry {\n    return {\n      ...country,\n      num_code: country.num_code.toString() // number → string\n    };\n  },\n\n  // StoreRegion 適配器\n  adaptStoreRegion(region: LocalHttpTypes.StoreRegion): AdaptedStoreRegion {\n    return {\n      ...region,\n      countries: region.countries?.map(this.adaptStoreCountry)\n    };\n  },\n\n  // StoreCollection 適配器\n  adaptStoreCollection(collection: LocalHttpTypes.StoreCollection): AdaptedStoreCollection {\n    return {\n      ...collection,\n      metadata: collection.metadata || null // undefined → null\n    };\n  },\n\n  // StoreProduct 適配器\n  adaptStoreProduct(product: LocalHttpTypes.StoreProduct): AdaptedStoreProduct {\n    return {\n      ...product,\n      collection: product.collection ? this.adaptStoreCollection(product.collection) : null,\n      metadata: product.metadata || null\n    };\n  },\n\n  // 批量適配器\n  adaptStoreRegions(regions: LocalHttpTypes.StoreRegion[]): AdaptedStoreRegion[] {\n    return regions.map(this.adaptStoreRegion.bind(this));\n  },\n\n  adaptStoreProducts(products: LocalHttpTypes.StoreProduct[]): AdaptedStoreProduct[] {\n    return products.map(this.adaptStoreProduct.bind(this));\n  },\n\n  adaptStoreCollections(collections: LocalHttpTypes.StoreCollection[]): AdaptedStoreCollection[] {\n    return collections.map(this.adaptStoreCollection.bind(this));\n  }\n};\n\n// 重新導出適配後的類型，供元件使用\nexport type {\n  AdaptedStoreCountry as StoreCountry,\n  AdaptedStoreRegion as StoreRegion, \n  AdaptedStoreCollection as StoreCollection,\n  AdaptedStoreProduct as StoreProduct\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/types/medusa-local.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":90,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":90,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2449,2452],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2449,2452],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":124,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":124,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3221,3224],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3221,3224],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":155,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":155,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4043,4046],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4043,4046],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":179,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":179,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4506,4509],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4506,4509],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// 本地 Medusa 類型定義\n// 用於解決 @medusajs/types 在 devDependencies 中的問題\n\n// 導入必要的基礎類型\ninterface BaseCalculatedPriceSet {\n  id: string;\n  is_calculated_price_price_list?: boolean;\n  is_calculated_price_tax_inclusive?: boolean;\n  calculated_amount: number | null;\n  calculated_amount_with_tax?: number | null;\n  calculated_amount_without_tax?: number | null;\n  is_original_price_price_list?: boolean;\n  is_original_price_tax_inclusive?: boolean;\n  original_amount: number | null;\n  original_amount_with_tax: number | null;\n  original_amount_without_tax: number | null;\n  currency_code: string | null;\n  calculated_price?: {\n    id: string | null;\n    price_list_id: string | null;\n    price_list_type: string | null;\n    min_quantity: number | null;\n    max_quantity: number | null;\n  };\n  original_price?: {\n    id: string | null;\n    price_list_id: string | null;\n    price_list_type: string | null;\n    min_quantity: number | null;\n    max_quantity: number | null;\n  };\n}\n\nexport declare namespace LocalHttpTypes {\n  // 基礎查詢參數類型\n  export interface FindParams {\n    expand?: string\n    fields?: string\n    offset?: number\n    limit?: number\n    order?: string\n  }\n\n  // Collection 相關類型\n  export interface StoreCollectionListResponse {\n    collections: StoreCollection[]\n    count: number\n    offset: number\n    limit: number\n  }\n\n  export interface StoreProduct {\n    id: string\n    title: string\n    subtitle: string | null\n    description: string | undefined\n    handle: string\n    is_giftcard: boolean\n    status: \"draft\" | \"proposed\" | \"published\" | \"rejected\"\n    thumbnail: string | undefined\n    weight: number | null\n    length: number | null\n    height: number | null\n    width: number | null\n    hs_code: string | null\n    origin_country: string | null\n    mid_code: string | null\n    material: string | null\n    collection_id: string | null\n    type_id: string | null\n    discountable: boolean\n    external_id: string | null\n    created_at: string\n    updated_at: string\n    deleted_at: string | null\n    metadata: Record<string, unknown> | null\n    images: StoreProductImage[] | null\n    options: StoreProductOption[] | null\n    variants: StoreProductVariant[] | null\n    categories: StoreProductCategory[] | null\n    tags: StoreProductTag[] | null\n    collection: StoreCollection | null\n    type: StoreProductType | null\n  }\n\n  export interface StoreProductImage {\n    id: string\n    url: string\n    rank: number\n    metadata?: Record<string, any>\n  }\n\n  export interface StoreProductOption {\n    id: string\n    title: string\n    values: StoreProductOptionValue[]\n  }\n\n  export interface StoreProductOptionValue {\n    id: string\n    value: string\n    option_id: string\n  }\n\n  export interface StoreProductVariant {\n    id: string\n    title: string\n    sku: string | null\n    barcode: string | null\n    ean: string | null\n    upc: string | null\n    variant_rank: number | null\n    inventory_quantity: number\n    allow_backorder: boolean\n    manage_inventory: boolean\n    hs_code: string | null\n    origin_country: string | null\n    mid_code: string | null\n    material: string | null\n    weight: number | null\n    length: number | null\n    height: number | null\n    width: number | null\n    metadata: Record<string, any> | null\n    prices: StoreProductVariantPrice[] | null\n    options: StoreProductOptionValue[] | null\n    calculated_price?: BaseCalculatedPriceSet\n    created_at: string\n    updated_at: string\n    deleted_at: string | null\n  }\n\n  export interface StoreProductVariantPrice {\n    id: string\n    currency_code: string\n    amount: number\n    min_quantity?: number\n    max_quantity?: number\n  }\n\n  export interface StoreProductCategory {\n    id: string\n    name: string\n    description: string\n    handle: string\n    is_active: boolean\n    is_internal: boolean\n    rank: number | null\n    parent_category_id: string | null\n    parent_category: StoreProductCategory | null\n    category_children: StoreProductCategory[]\n    created_at: string\n    updated_at: string\n    deleted_at: string | null\n    metadata?: Record<string, any>\n  }\n\n  export interface StoreProductTag {\n    id: string\n    value: string\n    created_at: string\n    updated_at: string\n  }\n\n  export interface StoreCollection {\n    id: string\n    title: string\n    handle: string\n    created_at: string\n    updated_at: string\n    metadata: Record<string, unknown> | null\n  }\n\n  export interface StoreProductType {\n    id: string\n    value: string\n    created_at: string\n    updated_at: string\n    metadata?: Record<string, any>\n  }\n\n  export interface StoreRegion {\n    id: string\n    name: string\n    currency_code: string\n    automatic_taxes: boolean\n    tax_rate?: number\n    tax_code?: string\n    countries: StoreCountry[]\n  }\n\n  export interface StoreCountry {\n    id: string\n    iso_2: string\n    iso_3: string\n    num_code: string\n    name: string\n    display_name: string\n  }\n\n  // API 響應類型\n  export interface StoreProductsResponse {\n    products: StoreProduct[]\n    count: number\n    offset: number\n    limit: number\n  }\n\n  export interface StoreProductParams {\n    id?: string[]\n    q?: string\n    collection_id?: string[]\n    category_id?: string[]\n    tag_id?: string[]\n    type_id?: string[]\n    is_giftcard?: boolean\n    created_at?: {\n      lt?: string\n      gt?: string\n      lte?: string\n      gte?: string\n    }\n    updated_at?: {\n      lt?: string\n      gt?: string\n      lte?: string\n      gte?: string\n    }\n    fields?: string\n    expand?: string\n    limit?: number\n    offset?: number\n    order?: string\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/types/medusa.d.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'StoreCartShippingOption' is defined but never used.","line":8,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":26},{"ruleId":"unused-imports/no-unused-imports","severity":2,"message":"'StoreCartShippingOption' is defined but never used.","line":8,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":26,"fix":{"range":[84,112],"text":""}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":24,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[460,463],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[460,463],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":39,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[746,749],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[746,749],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":128,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":128,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2504,2507],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2504,2507],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":130,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":130,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2627,2630],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2627,2630],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":131,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":131,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2698,2701],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2698,2701],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":132,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":132,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2792,2795],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2792,2795],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":136,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":136,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2952,2955],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2952,2955],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":140,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":140,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3101,3104],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3101,3104],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":142,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":142,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3218,3221],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3218,3221],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":1,"fixableWarningCount":0,"source":"/**\n * Medusa 型別定義\n * 擴展和補充 @medusajs/types 的缺失型別定義\n */\n\nimport type { \n  StoreCart, \n  StoreCartShippingOption,\n  StoreShippingOption,\n  StoreProduct,\n  StoreRegion,\n  StoreCustomer,\n  StoreOrder\n} from \"@medusajs/types\"\n\ndeclare module \"@medusajs/types\" {\n  // 擴展 StoreCartShippingOption 缺失的屬性\n  interface StoreCartShippingOption {\n    service_zone?: {\n      id: string\n      name: string\n      fulfillment_set_id: string\n      type: string\n      geo_zones: any[]\n    }\n    service_zone_id?: string\n  }\n\n  // 擴展 StoreCart 補充可能未定義的屬性\n  interface StoreCart {\n    shipping_methods?: StoreCartShippingOption[]\n  }\n\n  // 補充可能缺失的 Store 類型\n  interface StoreShippingMethod {\n    id: string\n    name: string\n    amount: number\n    data?: Record<string, any>\n    shipping_option?: StoreShippingOption\n  }\n\n  // 擴展 StoreProduct 補充 Sanity 整合屬性\n  interface StoreProduct {\n    sanity_product_id?: string\n    description?: string\n    thumbnail?: string\n    collection_id?: string\n    tag_id?: string[]\n    is_giftcard?: boolean\n    images?: Array<{\n      id: string\n      url: string\n    }>\n  }\n\n  // 產品查詢參數類型\n  interface StoreProductParams {\n    collection_id?: string[]\n    tag_id?: string[]\n    is_giftcard?: boolean\n  }\n\n  // 價格相關類型\n  interface VariantPrice {\n    amount: number\n    calculated_price?: string\n    calculated_price_number?: number\n    original_price?: string\n    original_price_number?: number\n    currency_code?: string\n    price_type?: 'sale' | 'regular'\n    percentage_diff?: string\n  }\n\n  // 免運費相關類型\n  interface StoreFreeShippingPrice {\n    target_reached?: boolean\n    target_remaining?: number\n    remaining_percentage?: number\n  }\n\n  // Collection 類型擴展\n  interface StoreCollection {\n    deleted_at?: string | null\n  }\n\n  // 補充 Store API 回應格式\n  interface StoreResponse<T> {\n    data: T\n    message?: string\n    status?: number\n  }\n\n  // 購物車相關補充型別\n  interface StoreCartLineItem {\n    id: string\n    title: string\n    description?: string\n    thumbnail?: string\n    quantity: number\n    unit_price: number\n    total: number\n    variant?: {\n      id: string\n      title: string\n      product: StoreProduct\n    }\n  }\n\n  // 結帳相關補充型別  \n  interface StoreCheckoutSession {\n    id: string\n    cart_id: string\n    payment_status: string\n    fulfillment_status: string\n  }\n}\n\n// 全域 Medusa 客戶端型別\ndeclare global {\n  interface MedusaClient {\n    regions: {\n      list(): Promise<{ regions: StoreRegion[] }>\n      retrieve(id: string): Promise<{ region: StoreRegion }>\n    }\n    carts: {\n      create(data: any): Promise<{ cart: StoreCart }>\n      retrieve(id: string): Promise<{ cart: StoreCart }>\n      update(id: string, data: any): Promise<{ cart: StoreCart }>\n      addLineItem(id: string, data: any): Promise<{ cart: StoreCart }>\n      updateLineItem(cartId: string, lineId: string, data: any): Promise<{ cart: StoreCart }>\n      deleteLineItem(cartId: string, lineId: string): Promise<{ cart: StoreCart }>\n    }\n    products: {\n      list(params?: any): Promise<{ products: StoreProduct[] }>\n      retrieve(id: string): Promise<{ product: StoreProduct }>\n    }\n    customers: {\n      create(data: any): Promise<{ customer: StoreCustomer }>\n      retrieve(): Promise<{ customer: StoreCustomer }>\n      update(data: any): Promise<{ customer: StoreCustomer }>\n    }\n    orders: {\n      list(): Promise<{ orders: StoreOrder[] }>\n      retrieve(id: string): Promise<{ order: StoreOrder }>\n    }\n  }\n\n  // Medusa 配置型別\n  interface MedusaConfig {\n    baseUrl: string\n    publishableKey?: string\n    debug?: boolean\n  }\n}\n\nexport {}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/types/page-sections.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/types/pages.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/types/sanity.d.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":296,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":296,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5531,5534],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5531,5534],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":309,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":309,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5763,5766],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5763,5766],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Sanity 型別定義\n * 為 Sanity CMS 相關類型提供完整定義\n */\n\nimport type { PortableTextBlock } from \"@portabletext/types\"\n\n// 基礎 Sanity 型別\nexport interface SanityDocument {\n  _id: string\n  _type: string\n  _createdAt: string\n  _updatedAt: string\n  _rev?: string\n}\n\n// Sanity 圖片型別\nexport interface SanityImage {\n  _type: \"image\"\n  asset: {\n    _ref: string\n    _type: \"reference\"\n  }\n  alt?: string\n  caption?: string\n  url: string // 確保 url 屬性存在\n}\n\n// Sanity 參考型別\nexport interface SanityReference {\n  _type: \"reference\"\n  _ref: string\n}\n\n// Header 型別定義\nexport interface SanityHeader extends SanityDocument {\n  _type: \"header\"\n  logo?: SanityImage\n  logoHeight?: number // 添加缺失的 logoHeight 屬性\n  logoWidth?: number  // 添加缺失的 logoWidth 屬性\n  logoSize?: {        // 添加 logoSize 屬性\n    desktop?: number\n    mobile?: number\n  }\n  storeName?: string  // 添加缺失的 storeName 屬性\n  navigation?: NavigationItem[] // 更新為 NavigationItem 類型\n  marquee?: {         // 添加 marquee 屬性\n    enabled?: boolean\n    text1?: {\n      enabled?: boolean\n      content?: string\n    }\n    text2?: {\n      enabled?: boolean\n      content?: string\n    }\n    text3?: {\n      enabled?: boolean\n      content?: string\n    }\n    linkUrl?: string\n    pauseOnHover?: boolean\n  }\n}\n\n// Navigation Item 型別定義\nexport interface NavigationItem {\n  _key?: string\n  _type?: string\n  name: string    // 必需屬性，符合模板中的使用\n  href: string    // 必需屬性，符合模板中的使用\n  submenu?: NavigationItem[]\n}\n\n// Footer Link 型別定義\nexport interface FooterLink {\n  _key?: string\n  text: string\n  linkType?: 'internal' | 'external'\n  internalLink?: string\n  externalUrl?: string\n  url?: string     // 向後兼容字段\n  href?: string    // 更早的向後兼容字段\n}\n\n// Footer 型別定義\nexport interface SanityFooter extends SanityDocument {\n  _type: \"footer\"\n  // 基本資訊\n  title?: string\n  logo?: SanityImage\n  logoWidth?: number\n  copyright?: string\n  \n  // 聯絡資訊已經移除\n  \n  // 社群媒體\n  socialMedia?: {\n    facebook?: {\n      enabled?: boolean\n      url?: string\n    }\n    instagram?: {\n      enabled?: boolean\n      url?: string\n    }\n    line?: {\n      enabled?: boolean\n      url?: string\n    }\n    youtube?: {\n      enabled?: boolean\n      url?: string\n    }\n    twitter?: {\n      enabled?: boolean\n      url?: string\n    }\n  }\n  \n  // 區段資訊\n  sections?: Array<{\n    _key: string\n    title: string\n    links?: FooterLink[]\n  }>\n  \n  // 簡化連結格式\n  links?: Array<{\n    title: string\n    href: string\n  }>\n  \n  // 社群連結（簡化格式）\n  socialLinks?: Array<{\n    platform: string\n    url: string\n  }>\n}\n\n// FooterData 別名，用於向後兼容\nexport type FooterData = SanityFooter;\n\n// 內容區塊型別\nexport interface SanityContentSection extends SanityDocument {\n  _type: \"contentSection\"\n  title?: string\n  content?: PortableTextBlock[]\n  image?: SanityImage\n}\n\n// Blog 文章型別\nexport interface SanityPost extends SanityDocument {\n  _type: \"post\"\n  title: string\n  slug: {\n    current: string\n  }\n  author?: SanityReference\n  categories?: SanityReference[]\n  publishedAt?: string\n  excerpt?: string\n  body?: PortableTextBlock[]\n  mainImage?: SanityImage\n  seo?: SanitySEO\n}\n\n// 作者型別\nexport interface SanityAuthor extends SanityDocument {\n  _type: \"author\"\n  name: string\n  slug: {\n    current: string\n  }\n  image?: SanityImage\n  bio?: PortableTextBlock[]\n}\n\n// 分類型別\nexport interface SanityCategory extends SanityDocument {\n  _type: \"category\"\n  title: string\n  slug: {\n    current: string\n  }\n  description?: string\n}\n\n// 產品型別\nexport interface SanityProduct extends SanityDocument {\n  _type: \"product\"\n  title: string\n  slug: {\n    current: string\n  }\n  description?: PortableTextBlock[]\n  images?: SanityImage[]\n  price?: number\n  medusaProductId?: string\n  categories?: SanityReference[]\n  tags?: string[]\n  seo?: SanitySEO\n}\n\n// SEO 型別\nexport interface SanitySEO {\n  title?: string\n  description?: string\n  keywords?: string[]\n  openGraph?: {\n    title?: string\n    description?: string\n    image?: SanityImage\n  }\n}\n\n// 頁面型別\nexport interface SanityPage extends SanityDocument {\n  _type: \"page\"\n  title: string\n  slug: {\n    current: string\n  }\n  content?: PortableTextBlock[]\n  seo?: SanitySEO\n  blocks?: Array<SanityContentBlock>\n}\n\n// 內容區塊聯合型別\nexport type SanityContentBlock = \n  | SanityMainBanner\n  | SanityContentSection\n  | SanityImageTextBlock\n  | SanityBlogSection\n  | SanityYoutubeSection\n  | SanityFeaturedProducts\n  | SanityServiceCardSection\n\n// 橫幅區塊\nexport interface SanityMainBanner extends SanityDocument {\n  _type: \"mainBanner\"\n  title?: string\n  subtitle?: string\n  image?: SanityImage\n  ctaText?: string\n  ctaLink?: string\n}\n\n// 圖文區塊\nexport interface SanityImageTextBlock extends SanityDocument {\n  _type: \"imageTextBlock\"\n  title?: string\n  content?: PortableTextBlock[]\n  image?: SanityImage\n  imagePosition?: \"left\" | \"right\"\n}\n\n// Blog 區塊\nexport interface SanityBlogSection extends SanityDocument {\n  _type: \"blogSection\"\n  title?: string\n  posts?: SanityReference[]\n  showCount?: number\n}\n\n// YouTube 區塊\nexport interface SanityYoutubeSection extends SanityDocument {\n  _type: \"youtubeSection\"\n  title?: string\n  videoId?: string\n  description?: PortableTextBlock[]\n}\n\n// 特色產品區塊\nexport interface SanityFeaturedProducts extends SanityDocument {\n  _type: \"featuredProducts\"\n  title?: string\n  products?: SanityReference[]\n}\n\n// 服務卡片區塊\nexport interface SanityServiceCardSection extends SanityDocument {\n  _type: \"serviceCardSection\"\n  title?: string\n  cards?: Array<{\n    title: string\n    description: string\n    icon?: SanityImage\n    link?: string\n  }>\n}\n\n// Content Props for components\nexport interface SanityContentProps {\n  content: PortableTextBlock[]\n  blocks?: any[] // 支援自定義區塊\n}\n\n// Sanity Client 相關型別\nexport interface SanityClientConfig {\n  projectId: string\n  dataset: string\n  apiVersion: string\n  useCdn?: boolean\n  token?: string\n}\n\n// GROQ 查詢結果型別\nexport interface SanityQueryResult<T = any> {\n  query: string\n  result: T\n  ms: number\n}\n\n// 聲明全域模組擴展\ndeclare global {\n  namespace Sanity {\n    interface Document extends SanityDocument {}\n    interface Image extends SanityImage {}\n    interface Reference extends SanityReference {}\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/types/sanity.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":57,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[928,931],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[928,931],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"export interface SanityImageCrop {\n  _type: 'sanity.imageCrop'\n  top: number\n  bottom: number\n  left: number\n  right: number\n}\n\nexport interface SanityImageHotspot {\n  _type: 'sanity.imageHotspot'\n  x: number\n  y: number\n  height: number\n  width: number\n}\n\nexport interface SanityImage {\n  _type: 'image'\n  asset: {\n    _ref: string\n    _type: 'reference'\n  }\n  crop?: SanityImageCrop\n  hotspot?: SanityImageHotspot\n}\n\nexport interface FeaturedProduct {\n  heading: string\n  showHeading: boolean\n  showSubheading: boolean\n  collection_id: string\n  isActive: boolean\n}\n\nexport interface BlogPost {\n  _id: string\n  _type: 'post'\n  title: string\n  slug: {\n    current: string\n    _type: 'slug'\n  }\n  mainImage: {\n    asset: {\n      url: string\n      _ref: string\n      _type: 'reference'\n    }\n  }\n  publishedAt: string\n  excerpt?: string\n  categories?: Category[]\n  author?: {\n    name: string\n    image?: SanityImage\n  }\n  body?: any // Portable Text 內容\n  status?: string\n}\n\nexport interface Category {\n  _id: string\n  _type: 'category'\n  title: string\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/types/sections.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/types/service-cards.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/util/cn.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/util/compare-addresses.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[91,94],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[91,94],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[106,109],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[106,109],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { isEqual, pick } from \"lodash\"\n\nexport default function compareAddresses(address1: any, address2: any) {\n  return isEqual(\n    pick(address1, [\n      \"first_name\",\n      \"last_name\",\n      \"address_1\",\n      \"company\",\n      \"postal_code\",\n      \"city\",\n      \"country_code\",\n      \"province\",\n      \"phone\",\n    ]),\n    pick(address2, [\n      \"first_name\",\n      \"last_name\",\n      \"address_1\",\n      \"company\",\n      \"postal_code\",\n      \"city\",\n      \"country_code\",\n      \"province\",\n      \"phone\",\n    ])\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/util/env.ts","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":2,"column":43,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":2,"endColumn":45,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[76,78],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"export const getBaseURL = () => {\n  return process.env.NEXT_PUBLIC_BASE_URL || \"https://localhost:8000\"\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/util/get-precentage-diff.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/util/get-product-price.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":5,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[190,193],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[190,193],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":37,"column":7,"nodeType":null,"messageId":"preferOptionalChain","endLine":37,"endColumn":30,"fix":{"range":[1173,1196],"text":"!product?.id"}},{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":2,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":42,"column":9,"nodeType":null,"messageId":"preferOptionalChain","endLine":42,"endColumn":46,"fix":{"range":[1288,1325],"text":"!product?.variants?.length"}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":46,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1381,1384],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1381,1384],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":47,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1422,1425],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1422,1425],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":48,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1468,1471],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1468,1471],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":48,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1476,1479],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1476,1479],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":63,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1784,1787],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1784,1787],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":2,"fixableWarningCount":0,"source":"import { HttpTypes } from \"@medusajs/types\"\nimport { getPercentageDiff } from \"./get-precentage-diff\"\nimport { convertToLocale } from \"./money\"\n\nexport const getPricesForVariant = (variant: any) => {\n  if (!variant?.calculated_price?.calculated_amount) {\n    return null\n  }\n\n  return {\n    calculated_price_number: variant.calculated_price.calculated_amount,\n    calculated_price: convertToLocale({\n      amount: variant.calculated_price.calculated_amount,\n      currency_code: variant.calculated_price.currency_code,\n    }),\n    original_price_number: variant.calculated_price.original_amount,\n    original_price: convertToLocale({\n      amount: variant.calculated_price.original_amount,\n      currency_code: variant.calculated_price.currency_code,\n    }),\n    currency_code: variant.calculated_price.currency_code,\n    price_type: variant.calculated_price.calculated_price.price_list_type,\n    percentage_diff: getPercentageDiff(\n      variant.calculated_price.original_amount,\n      variant.calculated_price.calculated_amount\n    ),\n  }\n}\n\nexport function getProductPrice({\n  product,\n  variantId,\n}: {\n  product: HttpTypes.StoreProduct\n  variantId?: string\n}) {\n  if (!product || !product.id) {\n    throw new Error(\"No product provided\")\n  }\n\n  const cheapestPrice = () => {\n    if (!product || !product.variants?.length) {\n      return null\n    }\n\n    const cheapestVariant: any = product.variants\n      .filter((v: any) => !!v.calculated_price)\n      .sort((a: any, b: any) => {\n        return (\n          a.calculated_price.calculated_amount -\n          b.calculated_price.calculated_amount\n        )\n      })[0]\n\n    return getPricesForVariant(cheapestVariant)\n  }\n\n  const variantPrice = () => {\n    if (!product || !variantId) {\n      return null\n    }\n\n    const variant: any = product.variants?.find(\n      (v) => v.id === variantId || v.sku === variantId\n    )\n\n    if (!variant) {\n      return null\n    }\n\n    return getPricesForVariant(variant)\n  }\n\n  return {\n    product,\n    cheapestPrice: cheapestPrice(),\n    variantPrice: variantPrice(),\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/util/isEmpty.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[32,35],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[32,35],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[95,98],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[95,98],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[155,158],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[155,158],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":8,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[318,321],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[318,321],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"export const isObject = (input: any) => input instanceof Object\nexport const isArray = (input: any) => Array.isArray(input)\nexport const isEmpty = (input: any) => {\n  return (\n    input === null ||\n    input === undefined ||\n    (isObject(input) && Object.keys(input).length === 0) ||\n    (isArray(input) && (input as any[]).length === 0) ||\n    (typeof input === \"string\" && input.trim().length === 0)\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/util/medusa-error.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[43,46],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[43,46],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":7,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":7,"endColumn":20,"suggestions":[{"fix":{"range":[313,353],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":8,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":8,"endColumn":20,"suggestions":[{"fix":{"range":[360,412],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":9,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":9,"endColumn":20,"suggestions":[{"fix":{"range":[419,471],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":10,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":10,"endColumn":20,"suggestions":[{"fix":{"range":[478,527],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":14,"column":49,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":14,"endColumn":51,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[642,644],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"export default function medusaError(error: any): never {\n  if (error.response) {\n    // The request was made and the server responded with a status code\n    // that falls out of the range of 2xx\n    const u = new URL(error.config.url, error.config.baseURL)\n    if (process.env.NODE_ENV === 'development') {\n      console.error(\"Resource:\", u.toString())\n      console.error(\"Response data:\", error.response.data)\n      console.error(\"Status code:\", error.response.status)\n      console.error(\"Headers:\", error.response.headers)\n    }\n\n    // Extracting the error message from the response data\n    const message = error.response.data.message || error.response.data\n\n    throw new Error(message.charAt(0).toUpperCase() + message.slice(1) + \".\")\n  } else if (error.request) {\n    // The request was made but no response was received\n    throw new Error(\"No response received: \" + error.request)\n  } else {\n    // Something happened in setting up the request that triggered an Error\n    throw new Error(\"Error setting up the request: \" + error.message)\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/util/money.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/util/product.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/util/repeat.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/util/retry.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":19,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[453,456],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[453,456],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":73,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1507,1510],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1507,1510],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":74,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":74,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1562,1565],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1562,1565],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":78,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1675,1678],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1675,1678],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":86,"column":20,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":86,"endColumn":22,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1925,1927],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":111,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":111,"endColumn":20,"suggestions":[{"fix":{"range":[2501,2620],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":111,"column":62,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":111,"endColumn":64,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2554,2556],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":111,"column":107,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":111,"endColumn":109,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[2599,2601],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":126,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":126,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2861,2864],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2861,2864],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * 重試機制工具函數\n * 用於網絡請求或其他可能失敗的異步操作\n */\n\n/**\n * 使用重試機制執行異步函數\n * @param fn 需要重試的異步函數\n * @param options 重試選項\n * @returns 函數執行結果\n */\nexport async function withRetry<T>(\n  fn: () => Promise<T>,\n  options: {\n    retries?: number;          // 重試次數 (默認3次)\n    initialDelay?: number;     // 初始延遲時間(毫秒) (默認300ms)\n    backoffFactor?: number;    // 延遲時間增加係數 (默認1.5)\n    maxDelay?: number;         // 最大延遲時間(毫秒) (默認10000ms)\n    onRetry?: (attempt: number, error: any, delay: number) => void; // 重試回調\n  } = {}\n): Promise<T> {\n  const {\n    retries = 3,\n    initialDelay = 300,\n    backoffFactor = 1.5,\n    maxDelay = 10000,\n    onRetry,\n  } = options\n\n  let attempt = 0\n  let delay = initialDelay\n\n  while (true) {\n    try {\n      return await fn()\n    } catch (error) {\n      attempt++\n      \n      if (attempt > retries) {\n        throw error\n      }\n      \n      // 計算下一次重試的延遲時間\n      delay = Math.min(delay * backoffFactor, maxDelay)\n      \n      // 執行重試回調（如果有）\n      if (onRetry) {\n        onRetry(attempt, error, delay)\n      }\n      \n      // 等待指定時間後重試\n      await new Promise(resolve => setTimeout(resolve, delay))\n    }\n  }\n}\n\n/**\n * 使用重試機制的 fetch 函數\n * \n * @param url 請求URL\n * @param options fetch選項\n * @param retryOptions 重試選項\n * @returns Response 對象\n */\nexport async function fetchWithRetry(\n  url: string | URL | Request,\n  options?: RequestInit,\n  retryOptions?: {\n    retries?: number;\n    initialDelay?: number;\n    backoffFactor?: number;\n    maxDelay?: number;\n    onRetry?: (attempt: number, error: any, delay: number) => void;\n    shouldRetry?: (error: any, response?: Response) => boolean; // 判斷是否應該重試\n  }\n): Promise<Response> {\n  const {\n    shouldRetry = (error: any, response?: Response) => {\n      // 默認重試所有網絡錯誤和5xx錯誤\n      if (error) return true\n      if (response && (response.status >= 500 || response.status === 429)) return true\n      return false\n    },\n    onRetry,\n    ...restOptions\n  } = retryOptions || {}\n\n  return withRetry(\n    async () => {\n      try {\n        const response = await fetch(url, options)\n        \n        // 如果響應不成功且應該重試，則拋出錯誤\n        if (!response.ok && shouldRetry(null, response)) {\n          throw new Error(`HTTP error! status: ${response.status}`)\n        }\n        \n        return response\n      } catch (error) {\n        // 如果應該重試此錯誤，則重新拋出以觸發重試\n        if (shouldRetry(error)) {\n          throw error\n        }\n        // 否則，讓錯誤繼續傳播\n        throw error\n      }\n    },\n    {\n      ...restOptions,\n      onRetry: (attempt, error, delay) => {\n        console.log(`重試請求 (${attempt}/${restOptions?.retries || 3}), 延遲: ${delay}ms, 錯誤: ${error?.message || 'Unknown error'}`)\n        onRetry?.(attempt, error, delay)\n      }\n    }\n  )\n}\n\n/**\n * 使用重試機制的 fetchJSON 函數\n * \n * @param url 請求URL\n * @param options fetch選項\n * @param retryOptions 重試選項\n * @returns 解析後的JSON數據\n */\nexport async function fetchJSONWithRetry<T = any>(\n  url: string | URL | Request,\n  options?: RequestInit,\n  retryOptions?: Parameters<typeof fetchWithRetry>[2]\n): Promise<T> {\n  const response = await fetchWithRetry(url, options, retryOptions)\n  return response.json() as Promise<T>\n}\n\nexport default {\n  withRetry,\n  fetchWithRetry,\n  fetchJSONWithRetry\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/util/sort-products.ts","messages":[{"ruleId":"jsdoc/require-param-description","severity":1,"message":"Missing JSDoc @param \"products\" description.","line":10,"column":1,"nodeType":"Block","endLine":10,"endColumn":1},{"ruleId":"jsdoc/require-param-description","severity":1,"message":"Missing JSDoc @param \"sortBy\" description.","line":11,"column":1,"nodeType":"Block","endLine":11,"endColumn":1},{"ruleId":"prefer-const","severity":2,"message":"'sortedProducts' is never reassigned. Use 'const' instead.","line":18,"column":7,"nodeType":"Identifier","messageId":"useConst","endLine":18,"endColumn":21,"fix":{"range":[509,560],"text":"const sortedProducts = products as MinPricedProduct[]"}},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":26,"column":71,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":26,"endColumn":73,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[915,917],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":36,"column":20,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":36,"endColumn":32},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":36,"column":35,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":36,"endColumn":47},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":44,"column":18,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":44,"endColumn":31},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":44,"column":54,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":44,"endColumn":67}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import { HttpTypes } from \"@medusajs/types\"\nimport { SortOptions } from \"@modules/store/components/refinement-list/sort-products\"\n\ninterface MinPricedProduct extends HttpTypes.StoreProduct {\n  _minPrice?: number\n}\n\n/**\n * Helper function to sort products by price until the store API supports sorting by price\n * @param products\n * @param sortBy\n * @returns products sorted by price\n */\nexport function sortProducts(\n  products: HttpTypes.StoreProduct[],\n  sortBy: SortOptions\n): HttpTypes.StoreProduct[] {\n  let sortedProducts = products as MinPricedProduct[]\n\n  if ([\"price_asc\", \"price_desc\"].includes(sortBy)) {\n    // Precompute the minimum price for each product\n    sortedProducts.forEach((product) => {\n      if (product.variants && product.variants.length > 0) {\n        product._minPrice = Math.min(\n          ...product.variants.map(\n            (variant) => variant?.calculated_price?.calculated_amount || 0\n          )\n        )\n      } else {\n        product._minPrice = Infinity\n      }\n    })\n\n    // Sort products based on the precomputed minimum prices\n    sortedProducts.sort((a, b) => {\n      const diff = a._minPrice! - b._minPrice!\n      return sortBy === \"price_asc\" ? diff : -diff\n    })\n  }\n\n  if (sortBy === \"created_at\") {\n    sortedProducts.sort((a, b) => {\n      return (\n        new Date(b.created_at!).getTime() - new Date(a.created_at!).getTime()\n      )\n    })\n  }\n\n  return sortedProducts\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/web-components/base.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":21,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[530,533],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[530,533],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { createRoot, Root } from 'react-dom/client'\nimport React from 'react'\n\nexport type ReactWC<Props> = {\n  setProps: (props: Props) => void\n  disconnect: () => void\n}\n\nexport function defineReactWebComponent<Props>(\n  tag: string,\n  Component: React.ComponentType<Props>,\n  options?: { styles?: string }\n): void {\n  if (typeof window === 'undefined') return\n  if (customElements.get(tag)) return\n\n  class ReactElement extends HTMLElement {\n    private root: Root | null = null\n    private currentProps: Props | any\n    private shadow: ShadowRoot\n\n    constructor() {\n      super()\n      this.shadow = this.attachShadow({ mode: 'open' })\n      if (options?.styles) {\n        const style = document.createElement('style')\n        style.textContent = options.styles\n        this.shadow.appendChild(style)\n      }\n      const mount = document.createElement('div')\n      mount.setAttribute('data-mount', 'true')\n      this.shadow.appendChild(mount)\n      this.root = createRoot(mount)\n    }\n\n    static get observedAttributes() { return ['data-props'] }\n\n    connectedCallback() {\n      this.render()\n    }\n\n    disconnectedCallback() {\n      if (this.root) {\n        this.root.unmount()\n      }\n    }\n\n    set props(p: Props) {\n      this.currentProps = p\n      this.render()\n    }\n\n    attributeChangedCallback(name: string, _old: string | null, value: string | null) {\n      if (name === 'data-props') {\n        try {\n          const parsed = value ? JSON.parse(value) : undefined\n          if (parsed) {\n            this.currentProps = parsed\n            this.render()\n          }\n        } catch { /* ignore */ }\n      }\n    }\n\n    private render() {\n      if (!this.root) return\n      this.root.render(React.createElement(Component, this.currentProps))\n    }\n  }\n\n  customElements.define(tag, ReactElement)\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/raychou/tim-web/medusa_decoupled/frontend/src/web-components/home-hero-section.tsx","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":29,"column":30,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":29,"endColumn":32,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[769,771],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":30,"column":38,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":30,"endColumn":40,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[813,815],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":31,"column":42,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":31,"endColumn":44,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[861,863],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":32,"column":48,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":32,"endColumn":50,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[915,917],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":33,"column":40,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":33,"endColumn":42,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[961,963],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":34,"column":46,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":34,"endColumn":48,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1013,1015],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":35,"column":38,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":35,"endColumn":40,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1057,1059],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":36,"column":38,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":36,"endColumn":40,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1101,1103],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport React from 'react'\nimport { defineReactWebComponent } from './base'\nimport HeroSection from '@/modules/home/components/hero-section'\nimport type { BannerSlide, BannerSettings } from '@/lib/types/page-sections'\n\ntype Props = {\n  // 可直接傳入完整 slides/settings\n  slides?: BannerSlide[]\n  settings?: BannerSettings\n  // 也允許以個別屬性快速帶入第一張幻燈片的重要欄位\n  title?: string\n  subheading?: string\n  desktopImage?: string\n  desktopImageAlt?: string\n  mobileImage?: string\n  mobileImageAlt?: string\n  buttonText?: string\n  buttonLink?: string\n}\n\nconst styles = `:host{display:block}`\n\nconst WCInner: React.FC<Props> = (props) => {\n  const slides: BannerSlide[] = Array.isArray(props.slides) && props.slides.length\n    ? props.slides\n    : [{\n        heading: props.title || '',\n        subheading: props.subheading || '',\n        desktopImage: props.desktopImage || '',\n        desktopImageAlt: props.desktopImageAlt || '',\n        mobileImage: props.mobileImage || '',\n        mobileImageAlt: props.mobileImageAlt || '',\n        buttonText: props.buttonText || '',\n        buttonLink: props.buttonLink || '',\n      }]\n\n  const settings: BannerSettings = {\n    autoplay: props.settings?.autoplay ?? true,\n    autoplaySpeed: props.settings?.autoplaySpeed ?? 5,\n    showArrows: props.settings?.showArrows ?? true,\n    showDots: props.settings?.showDots ?? true,\n  }\n\n  return (\n    <div>\n      <HeroSection banner={{ _type: 'mainBanner', isActive: true, slides, settings }} />\n    </div>\n  )\n}\n\ndefineReactWebComponent<Props>('home-hero-section', WCInner, { styles })\n\nexport {}\n\n","usedDeprecatedRules":[]}]
